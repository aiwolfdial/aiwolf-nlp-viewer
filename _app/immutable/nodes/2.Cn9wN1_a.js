import{b as ie,d as De,a as L,t as R}from"../chunks/disclose-version.0HFg1qD0.js";import{i as pe}from"../chunks/legacy.C6KCpk-9.js";import{v as M,L as P,a5 as ge,a4 as Le,I as re,m as me,H as xe,am as be,J as Re,K as le,M as te,w as U,ai as Ne,ao as Q,N as ye,n as ne,O as Oe,D as oe,ap as Se,aq as $e,al as Me,ar as Ce,q as Ee,a9 as Ve,a3 as He,z as ve,as as Fe,at as Ye,au as qe,af as we,aj as ze,ah as Be,G as Ge,av as Ue,p as ke,c as m,r as p,s as A,t as S,h,a as Ae,a1 as z,aw as Ke,ax as ce,ay as We,f as Xe,az as ue,B}from"../chunks/runtime.BQMbqn8H.js";import{a as C,h as Je,e as G}from"../chunks/store.BFak2Tfs.js";import{p as ae,i as V}from"../chunks/props.E7He8GK1.js";import{b as Pe}from"../chunks/paths.DviN8iqs.js";function Z(a,e){return e}function Qe(a,e,t,r){for(var o=[],s=e.length,i=0;i<s;i++)$e(e[i].e,o,!0);var f=s>0&&o.length===0&&t!==null;if(f){var d=t.parentNode;Me(d),d.append(t),r.clear(),H(a,e[0].prev,e[s-1].next)}Ce(o,()=>{for(var b=0;b<s;b++){var c=e[b];f||(r.delete(c.k),H(a,c.prev,c.next)),Ee(c.e,!f)}})}function j(a,e,t,r,o,s=null){var i=a,f={flags:e,items:new Map,first:null};{var d=a;i=M?P(ge(d)):d.appendChild(Le())}M&&re();var b=null,c=!1;me(()=>{var x=t(),l=xe(x)?x:x==null?[]:be(x),n=l.length;if(c&&n===0)return;c=n===0;let g=!1;if(M){var k=i.data===Re;k!==(n===0)&&(i=le(),P(i),te(!1),g=!0)}if(M){for(var y=null,_,E=0;E<n;E++){if(U.nodeType===8&&U.data===Ne){i=U,g=!0,te(!1);break}var I=l[E],v=r(I,E);_=Ie(U,f,y,null,I,v,E,o,e),f.items.set(v,_),y=_}n>0&&P(le())}if(!M){var u=Ve;Ze(l,f,i,o,e,(u.f&Q)!==0,r)}s!==null&&(n===0?b?ye(b):b=ne(()=>s(i)):b!==null&&Oe(b,()=>{b=null})),g&&te(!0),t()}),M&&(i=U)}function Ze(a,e,t,r,o,s,i){var f=a.length,d=e.items,b=e.first,c=b,x,l=null,n=[],g=[],k,y,_,E;for(E=0;E<f;E+=1){if(k=a[E],y=i(k,E),_=d.get(y),_===void 0){var I=c?c.e.nodes_start:t;l=Ie(I,e,l,l===null?e.first:l.next,k,y,E,r,o),d.set(y,l),n=[],g=[],c=l.next;continue}if(je(_,k,E),_.e.f&Q&&ye(_.e),_!==c){if(x!==void 0&&x.has(_)){if(n.length<g.length){var v=g[0],u;l=v.prev;var w=n[0],T=n[n.length-1];for(u=0;u<n.length;u+=1)fe(n[u],v,t);for(u=0;u<g.length;u+=1)x.delete(g[u]);H(e,w.prev,T.next),H(e,l,w),H(e,T,v),c=v,l=T,E-=1,n=[],g=[]}else x.delete(_),fe(_,c,t),H(e,_.prev,_.next),H(e,_,l===null?e.first:l.next),H(e,l,_),l=_;continue}for(n=[],g=[];c!==null&&c.k!==y;)(s||!(c.e.f&Q))&&(x??(x=new Set)).add(c),g.push(c),c=c.next;if(c===null)continue;_=c}n.push(_),l=_,c=_.next}if(c!==null||x!==void 0){for(var N=x===void 0?[]:be(x);c!==null;)(s||!(c.e.f&Q))&&N.push(c),c=c.next;var F=N.length;if(F>0){var Y=f===0?t:null;Qe(e,N,Y,d)}}oe.first=e.first&&e.first.e,oe.last=l&&l.e}function je(a,e,t,r){Se(a.v,e),a.i=t}function Ie(a,e,t,r,o,s,i,f,d){var b=(d&Ye)!==0,c=(d&qe)===0,x=b?c?He(o):ve(o):o,l=d&Fe?ve(i):i,n={i:l,v:x,k:s,a:null,e:null,prev:t,next:r};try{return n.e=ne(()=>f(a,x,l),M),n.e.prev=t&&t.e,n.e.next=r&&r.e,t===null?e.first=n:(t.next=n,t.e.next=n.e),r!==null&&(r.prev=n,r.e.prev=n.e),n}finally{}}function fe(a,e,t){for(var r=a.next?a.next.e.nodes_start:t,o=e?e.e.nodes_start:t,s=a.e.nodes_start;s!==r;){var i=we(s);o.before(s),s=i}}function H(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function et(a,e,t,r,o){var s=a,i="",f;me(()=>{if(i===(i=e()??"")){M&&re();return}f!==void 0&&(Ee(f),f=void 0),i!==""&&(f=ne(()=>{if(M){U.data;for(var d=re(),b=d;d!==null&&(d.nodeType!==8||d.data!=="");)b=d,d=we(d);if(d===null)throw ze(),Be;ie(U,b),s=P(d);return}var c=i+"",x=De(c);ie(ge(x),x.lastChild),s.before(x)}))})}function tt(a,e,t,r){var o=a.__attributes??(a.__attributes={});M&&(o[e]=a.getAttribute(e),a.nodeName==="LINK")||o[e]!==(o[e]=t)&&(t==null?a.removeAttribute(e):typeof t!="string"&&at(a).includes(e)?a[e]=t:a.setAttribute(e,t))}var de=new Map;function at(a){var e=de.get(a.nodeName);if(e)return e;de.set(a.nodeName,e=[]);for(var t,r=a,o=Element.prototype;o!==r;){t=Ue(r);for(var s in t)t[s].set&&e.push(s);r=Ge(r)}return e}function se(a,e,t){if(t){if(a.classList.contains(e))return;a.classList.add(e)}else{if(!a.classList.contains(e))return;a.classList.remove(e)}}function J(a){return function(...e){var t=e[0];return t.preventDefault(),a==null?void 0:a.apply(this,e)}}function _e(a,e){var s;var t=(s=a.$$events)==null?void 0:s[e.type],r=xe(t)?t.slice():t==null?[]:[t];for(var o of r)o.call(this,e)}function he(a){const e={};return a.forEach(t=>{const[r,o,...s]=t.split(",");e[r]||(e[r]=rt()),st(e[r],o,s)}),e}function rt(){return{status:{},talks:[],votes:[],execution:null,divine:null,attackVotes:[],attack:null,result:null}}function st(a,e,t){const o={status:([s,i,f,d])=>{a.status[s]={role:i,status:f,name:d}},talk:([s,i,f,d])=>{a.talks.push({talkIdx:s,turn:i,agentIdx:f,text:d})},vote:([s,i])=>{a.votes.push({voteAgentIdx:s,targetAgentIdx:i})},execute:([s,i])=>{a.execution={agentIdx:s,role:i}},divine:([s,i,f])=>{a.divine={agentIdx:s,targetAgentIdx:i,result:f}},attackVote:([s,i])=>{a.attackVotes.push({voteAgentIdx:s,targetAgentIdx:i})},attack:([s,i])=>{a.attack={agentIdx:s,isSuccessful:i==="true"}},result:([s,i,f])=>{a.result={villagers:s,werewolves:i,winSide:f}}}[e];o&&o(t)}function W(a,e,t){var o;const r=(o=a[e])==null?void 0:o.status[t];return r?`Agent[${t}] (${r.name})`:`Agent[${t}]`}function nt(a){const e=a.match(/>>Agent\[\d+\]/);return e?a.replace(e[0],`<strong>${e[0]}</strong>`).trim():a.trim()}var it=R("<li><strong> </strong> </li>"),lt=R('<section class="status-section"><h3>エージェント</h3> <ul></ul></section>'),ot=R('<div class="divine-section"><h3>占い結果</h3> <p> </p></div>'),vt=R('<div class="attack-section"><h3>襲撃結果</h3> <p> </p></div>'),ct=R('<div class="execution-section"><h3>追放結果</h3> <p> </p></div>'),ut=R('<section class="game-events"><!> <!> <!></section>'),ft=R('<div class="talk"><strong> </strong> <!></div>'),dt=R('<section class="game-result-section"><h3>ゲーム結果</h3> <p> </p></section>'),_t=R('<div class="day-column"><div class="day-section"><h2> </h2> <div class="scrollable-content"><!> <!> <section class="talks-section"><h3>会話ログ</h3> <div class="talks"></div></section> <!></div></div></div>');function ht(a,e){ke(e,!1);let t=ae(e,"day",8),r=ae(e,"dayLog",8),o=ae(e,"processedLogs",8);function s(v){switch(v){case"VILLAGER":return"村人";case"SEER":return"占い師";case"MEDIUM":return"霊能者";case"BODYGUARD":return"狩人";case"WEREWOLF":return"人狼";case"POSSESSED":return"狂人";case"FOX":return"妖狐";default:return v}}function i(v){switch(v){case"ALIVE":return"生存";case"DEAD":return"死亡";default:return v}}pe();var f=_t(),d=m(f),b=m(d),c=m(b);p(b);var x=A(b,2),l=m(x);{var n=v=>{var u=lt(),w=A(m(u),2);j(w,5,()=>Object.entries(r().status),Z,(T,N)=>{let F=()=>h(N)[0],Y=()=>h(N)[1];var K=it(),D=m(K),O=m(D,!0);S(()=>C(O,W(o(),t(),F()))),p(D);const $=z(()=>s(Y().role)??""),q=z(()=>i(Y().status)??"");var X=A(D);S(()=>C(X,` ${h($)} -
                ${h(q)}`)),p(K),S(()=>se(K,"over",Y().status!=="ALIVE")),L(T,K)}),p(w),p(u),L(v,u)};V(l,v=>{Object.keys(r().status).length>0&&v(n)})}var g=A(l,2);{var k=v=>{var u=ut(),w=m(u);{var T=D=>{var O=ot(),$=A(m(O),2);const q=z(()=>W(o(),t(),r().divine.agentIdx)??""),X=z(()=>W(o(),t(),r().divine.targetAgentIdx)??""),ee=z(()=>r().divine.result??"");var Te=m($);S(()=>C(Te,`${h(q)} が
                ${h(X)}
                を占った結果:
                ${h(ee)}`)),p($),p(O),L(D,O)};V(w,D=>{r().divine&&D(T)})}var N=A(w,2);{var F=D=>{var O=vt(),$=A(m(O),2),q=m($);S(()=>C(q,`${W(o(),t(),r().attack.agentIdx)??""} への襲撃:
                ${(r().attack.isSuccessful?"成功":"失敗")??""}`)),p($),p(O),L(D,O)};V(N,D=>{r().attack&&D(F)})}var Y=A(N,2);{var K=D=>{var O=ct(),$=A(m(O),2);const q=z(()=>W(o(),t(),r().execution.agentIdx)??""),X=z(()=>s(r().execution.role)??"");var ee=m($);S(()=>C(ee,`${h(q)} が追放されました
                (役職: ${h(X)})`)),p($),p(O),L(D,O)};V(Y,D=>{r().execution&&D(K)})}p(u),L(v,u)};V(g,v=>{(r().divine||r().attack||r().execution)&&v(k)})}var y=A(g,2),_=A(m(y),2);j(_,5,()=>r().talks,Z,(v,u)=>{var w=ft(),T=m(w),N=m(T,!0);S(()=>C(N,W(o(),t(),h(u).agentIdx))),p(T);var F=A(T,2);et(F,()=>nt(h(u).text)),p(w),S(()=>se(w,"over",h(u).text==="Over")),L(v,w)}),p(_),p(y);var E=A(y,2);{var I=v=>{var u=dt(),w=A(m(u),2),T=m(w);p(w),p(u),S(()=>C(T,`村人: ${r().result.villagers??""}人 人狼: ${r().result.werewolves??""}人
            勝利陣営: ${r().result.winSide??""}`)),L(v,u)};V(E,v=>{r().result&&v(I)})}p(x),p(d),p(f),S(()=>C(c,`Day ${t()??""}`)),L(a,f),Ae()}var pt=R('<link rel="stylesheet">'),gt=R('<div tabindex="0" class="file-input-container" role="button"><label class="file-input-label"><input type="file" accept=".log" multiple> <span>ファイルを選択もしくはドラッグアンドドロップしてください</span></label></div>'),mt=R('<div class="tab-wrapper"><button class="tab-button"> </button> <button class="close-button" aria-label="Close tab">✕</button></div>'),xt=R('<div class="tabs-container"><div class="tabs"></div></div> <div class="werewolf-log-viewer"><div class="days-container"></div></div>',1),bt=R('<main><pre class="title">aiwolf-nlp-viewer</pre> <!> <!></main>');function Tt(a,e){ke(e,!1);let t=ue([]),r=ue(0);function o(l){const n=l.target;Array.from(n.files||[]).forEach(k=>{const y=new FileReader;y.onload=_=>{var v;const I=(((v=_.target)==null?void 0:v.result)??"").split(`
`).filter(u=>u.trim());B(t,[...h(t),{name:k.name,data:I,processed:he(I)}]),B(r,h(t).length-1)},y.readAsText(k)})}function s(l){var g;Array.from(((g=l.dataTransfer)==null?void 0:g.files)||[]).forEach(k=>{const y=new FileReader;y.onload=_=>{var v;const I=(((v=_.target)==null?void 0:v.result)??"").split(`
`).filter(u=>u.trim());B(t,[...h(t),{name:k.name,data:I,processed:he(I)}]),B(r,h(t).length-1)},y.readAsText(k)})}function i(l){B(t,h(t).filter((n,g)=>g!==l)),h(r)>=h(t).length&&B(r,h(t).length-1)}pe();var f=bt();Je(l=>{var n=pt();Ke.title="aiwolf-nlp-viewer",tt(n,"href",`${Pe??""}/global.css`),L(l,n)}),G("dragover",ce,J(function(l){_e.call(this,e,l)})),G("drop",ce,J(s));var d=A(m(f),2);{var b=l=>{var n=gt(),g=m(n),k=m(g);We(2),p(g),p(n),G("change",k,o),G("dragover",n,J(function(y){_e.call(this,e,y)})),G("drop",n,J(s)),L(l,n)};V(d,l=>{h(t).length===0&&l(b)})}var c=A(d,2);{var x=l=>{var n=xt(),g=Xe(n),k=m(g);j(k,5,()=>h(t),Z,(E,I,v)=>{var u=mt(),w=m(u),T=m(w,!0);p(w);var N=A(w,2);p(u),S(()=>{se(u,"active",h(r)===v),C(T,h(I).name)}),G("click",w,()=>B(r,v)),G("click",N,()=>i(v)),L(E,u)}),p(k),p(g);var y=A(g,2),_=m(y);j(_,5,()=>Object.entries(h(t)[h(r)].processed),Z,(E,I)=>{let v=()=>h(I)[0],u=()=>h(I)[1];ht(E,{get day(){return v()},get dayLog(){return u()},get processedLogs(){return h(t)[h(r)].processed}})}),p(_),p(y),L(l,n)};V(c,l=>{h(t).length>0&&l(x)})}p(f),L(a,f),Ae()}export{Tt as component};
