import{t as $e,a as Ne,c as Wi,b as Hl}from"../chunks/C96Obp6N.js";import{aN as Wr,p as Vn,i as Ut,ap as As,t as nt,a as Wn,aA as Pr,c as V,s as $,b as F,aG as ys,r as H,aB as Es,f as kr,$ as ac,aO as sc}from"../chunks/BP9y4yKp.js";import{d as Yn,s as ve,e as Yi,h as oc}from"../chunks/DZNU9N6A.js";import{i as Lt}from"../chunks/C4IGXha7.js";import{e as Ts,i as Ss}from"../chunks/DbFYbdTt.js";import{s as qi,a as Bt,r as Vt,L as lc,b as Vl,c as hr}from"../chunks/DlJVdtuQ.js";import{s as Yr,c as uc}from"../chunks/Z3TIC2Rx.js";import{I as fc,b as dc,s as xs}from"../chunks/CfHWT9s-.js";import{b as hc}from"../chunks/CaDVcpVM.js";import{b as Sr}from"../chunks/CpCB4Eu6.js";import{s as qn,a as Tr,b as cc}from"../chunks/XBNY5BM4.js";import{p as vc}from"../chunks/xCmSONZG.js";import{o as jn,a as ql}from"../chunks/CUbQW9Gg.js";import{$ as Xn,d as gc}from"../chunks/Cj9fvRom.js";import{p as mc}from"../chunks/CYYdlGtH.js";import{b as pc}from"../chunks/D90TZfxR.js";import{b as yc}from"../chunks/DBOqFBuJ.js";class jl{static fromJson(P){return JSON.parse(P)}static toJson(P){return JSON.stringify(P,null,2)}}const Xl="realtime-settings",ms={name:!0,team:!1,role:!1},Wl={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:ms,bubble:ms,text:ms,largeScale:!1}};function Ec(){const Z=localStorage.getItem(Xl);if(Z)try{return jl.fromJson(Z)}catch(P){console.error("Failed to parse realtime settings:",P)}return zl(Wl),Wl}function zl(Z){localStorage.setItem(Xl,jl.toJson(Z))}const qr=Wr(Ec());qr.subscribe(zl);function Tc(Z){return Array.from({length:Z},(P,Ae)=>Sc(Ae+1))}function Sc(Z){return{idx:Z,team:"Undefined",name:fc(Z),profile:void 0,avatar:void 0,role:"Undefined",is_alive:!0}}function At(Z,P,Ae){if(Ae===void 0)return"該当なし";const Je=P.agents.find(J=>J.idx===Ae);if(!Je)return"該当なし";const q=[];return Z!=null&&Z.name&&q.push(Je.name),Z!=null&&Z.team&&q.push(Je.team),Z!=null&&Z.role&&q.push(Je.role),q.filter(Boolean).join(" ")}function Vi(Z,P){return(Z||P)&&!(Z&&P)}const xc=()=>({status:"disconnected",entries:{}});function Ac(){const{subscribe:Z,update:P}=Wr(xc());let Ae=null,Je=null;qr.subscribe(j=>{Je=j});function q(){if(!Je)return;P(fe=>({...fe,status:"connecting"}));const j=new URL(Je.connection.url);Je.connection.token&&j.searchParams.set("token",Je.connection.token),Ae=new WebSocket(j),Ae.onopen=()=>{P(fe=>({...fe,status:"connected"}))},Ae.onclose=()=>{P(fe=>({...fe,status:"disconnected"})),Ae=null},Ae.onerror=()=>{P(fe=>({...fe,status:"disconnected"})),Ae=null},Ae.onmessage=fe=>{try{const me=JSON.parse(fe.data);console.log("Received packet:",me),P(Pe=>Ke(Pe,me))}catch(me){console.error("Failed to parse message:",me)}}}function J(){Ae&&(P(j=>({...j,status:"disconnected"})),Ae.close(),Ae=null)}async function te(){try{const j=await navigator.clipboard.readText();await oe(j)}catch(j){console.error("Failed to load JSONL from clipboard:",j)}}async function oe(j){if(!j.trim())return;const fe=ne(j);if(fe.length===0){console.error("No valid packets found");return}const me=Ve(fe);Ae&&(Ae.close(),Ae=null),P(Pe=>({...Pe,status:"loaded",entries:me})),console.log(`JSONL data loaded: ${fe.length} packets across ${Object.keys(me).length} games`)}async function Ct(j){for(const fe of Array.from(j)){const me=new FileReader;me.onload=async Pe=>{var Ue;const ae=(Ue=Pe.target)==null?void 0:Ue.result;await oe(ae)},me.readAsText(fe)}}function Ke(j,fe){const me={...j.entries};return me[fe.id]||(me[fe.id]=[]),me[fe.id].push(fe),{...j,entries:me}}function ne(j){const fe=j.trim().split(`
`),me=[];for(let Pe=0;Pe<fe.length;Pe++){const ae=fe[Pe].trim();if(ae)try{const Ue=JSON.parse(ae);me.push(Ue)}catch{return console.error(`Line ${Pe+1} is not valid JSON:`,ae),[]}}return me}function Ve(j){const fe={};return j.forEach(me=>{fe[me.id]||(fe[me.id]=[]),fe[me.id].push(me)}),Object.keys(fe).forEach(me=>{fe[me].sort((Pe,ae)=>Pe.day!==ae.day?Pe.day-ae.day:Pe.is_day!==ae.is_day?Pe.is_day?-1:1:Pe.idx-ae.idx)}),fe}return{subscribe:Z,connect:q,disconnect:J,loadFromClipboard:te,loadFromFiles:Ct,entries:{subscribe:j=>Z(fe=>j(fe.entries))}}}const Cr=Ac();var Lc=(Z,P,Ae)=>{P()===F(Ae).idx?P(void 0):P(F(Ae).idx)},bc=$e('<pre class="base-content text-2xl select-none"> </pre>'),Rc=$e('<pre class="base-content select-none"> </pre>'),Ic=$e('<pre class="base-content text-2xl select-none"> </pre>'),_c=$e('<pre class="base-content select-none"> </pre>'),Dc=$e('<pre class="base-content text-2xl select-none"> </pre>'),kc=$e('<pre class="base-content select-none"> </pre>'),Cc=$e('<div><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"></button></div></div> <div class="mt-2"><!> <!> <!></div></div>'),Pc=$e(`<div class="h-full flex flex-col"><div class="bg-secondary"></div> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><pre class="base-content w-2/5 text-5xl font-bold opacity-70 absolute top-0 left-0 -mt-4 ml-8 select-none"> <br> <br> </pre> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><span class="text-xs">イラスト:石黒正数氏, VOICEVOX:四国めたん,ずんだもん,春日部つむぎ,
        波音リツ,玄野武宏,白上虎太郎,青山龍星,冥鳴ひまり,九州そら,もち子(cv
        明日葉よもぎ),剣崎雌雄,WhiteCUL,後鬼,No.7,ちび式じい,
        櫻歌ミコ,小夜/SAYO,ナースロボ＿タイプＴ,†聖騎士 紅桜†,雀松朱司,
        麒ヶ島宗麟,春歌ナナ,猫使アル,猫使ビィ,中国うさぎ,栗田まろん,
        あいえるたん,満別花丸,琴詠ニア,Voidoll(CV:丹下桜),ぞん子,中部つるぎ</span></aside></footer></div>`);function wc(Z,P){Vn(P,!0);const[Ae,Je]=qn(),q=()=>Tr(Xn,"$_",Ae);let J=mc(P,"focusIdx",15),te=Pr(void 0);const oe=qr.subscribe(Le=>{Ut(te,Le,!0)});jn(oe);let Ct=ys(()=>{var Le,Ee,U,Oe,st,B,I,p,re,K,X,pe,he,ce;switch(P.packet.event){case"未接続":return q()("realtime.events.disconnected");case"トーク":return P.packet.message;case"囁き":return Vi(J()===void 0,((Le=P.packet.agents.find(z=>z.idx===J()))==null?void 0:Le.role)==="WEREWOLF")?P.packet.message:q()("realtime.events.whispered");case"襲撃投票":return Vi(J()===void 0,P.packet.from_idx===J())?q()("realtime.events.attack_voted_with_target",{values:{from:At((Ee=F(te))==null?void 0:Ee.display.bubble,P.packet,P.packet.from_idx),to:At((U=F(te))==null?void 0:U.display.bubble,P.packet,P.packet.to_idx)}}):q()("realtime.events.attack_voted");case"投票":return Vi(J()===void 0,P.packet.from_idx===J())?q()("realtime.events.voted_with_target",{values:{from:At((Oe=F(te))==null?void 0:Oe.display.bubble,P.packet,P.packet.from_idx),to:At((st=F(te))==null?void 0:st.display.bubble,P.packet,P.packet.to_idx)}}):q()("realtime.events.voted",{values:{from:At((B=F(te))==null?void 0:B.display.bubble,P.packet,P.packet.from_idx)}});case"追放":return P.packet.to_idx===void 0?q()("realtime.events.no_execute"):q()("realtime.events.executed",{values:{target:At((I=F(te))==null?void 0:I.display.bubble,P.packet,P.packet.to_idx)}});case"襲撃":return P.packet.to_idx===void 0?q()("realtime.events.no_attack"):P.packet.from_idx===-1?q()("realtime.events.attacked_but_guarded",{values:{target:At((p=F(te))==null?void 0:p.display.bubble,P.packet,P.packet.to_idx)}}):q()("realtime.events.attacked",{values:{target:At((re=F(te))==null?void 0:re.display.bubble,P.packet,P.packet.to_idx)}});case"占い":if(Vi(J()===void 0,P.packet.from_idx===J())){const z=(K=P.packet.agents.find(Re=>Re.idx===P.packet.to_idx))==null?void 0:K.role,se=z?dc[z]:void 0;return q()("realtime.events.divined_with_result",{values:{from:At((X=F(te))==null?void 0:X.display.bubble,P.packet,P.packet.from_idx),to:At((pe=F(te))==null?void 0:pe.display.bubble,P.packet,P.packet.to_idx),result:se?q()(`game.species.${se}`):""}})}return q()("realtime.events.divined");case"護衛":return Vi(J()===void 0,P.packet.from_idx===J())?q()("realtime.events.guarded_with_target",{values:{from:At((he=F(te))==null?void 0:he.display.bubble,P.packet,P.packet.from_idx),to:At((ce=F(te))==null?void 0:ce.display.bubble,P.packet,P.packet.to_idx)}}):q()("realtime.events.guarded");case"終了":return q()("realtime.events.game_ended",{values:{winner:P.packet.message}});default:return P.packet.message??q()("realtime.events.unknown")}}),Ke,ne,Ve,j,fe;ql(()=>(window.addEventListener("resize",me),()=>{window.removeEventListener("resize",me)})),As(()=>{me()});function me(){var st;if(!ne||!Ve||!Ke)return;const Le=Ke.getBoundingClientRect();if([ne,Ve].forEach(B=>{B.width=Le.width,B.height=Le.height;const I=B.getContext("2d");I&&(I.clearRect(0,0,B.width,B.height),I.globalAlpha=1,I.lineWidth=2)}),J()!==void 0&&(P.packet.event==="囁き"&&((st=P.packet.agents.find(B=>B.idx===J()))==null?void 0:st.role)!=="WEREWOLF"||P.packet.event==="占い"&&P.packet.from_idx!==J()||P.packet.event==="投票"&&P.packet.from_idx!==J()||P.packet.event==="襲撃投票"&&P.packet.from_idx!==J()))return;const Ee=ne.getContext("2d"),U=Ve.getContext("2d");if(!Ee||!U)return;const Oe=Ve.getBoundingClientRect();if(P.packet.from_idx!==void 0&&P.packet.to_idx!==void 0){const B=document.getElementById(`agent-${P.packet.from_idx}`);if(!(B instanceof HTMLElement))return;const I=B.getBoundingClientRect(),p=I.left+I.width/2-Oe.left,re=I.top+I.height/2-Oe.top,K=document.getElementById(`agent-${P.packet.to_idx}`);if(!(K instanceof HTMLElement))return;const X=K.getBoundingClientRect();Pe(U,p,re,X.left+X.width/2-Oe.left,X.top+X.height/2-Oe.top,!1,getComputedStyle(fe).getPropertyValue("background-color"))}if(P.packet.bubble_idx!==void 0){const B=document.getElementById(`agent-${P.packet.bubble_idx}`);if(!(B instanceof HTMLElement))return;const I=B.getBoundingClientRect(),p=I.left+I.width/2-Oe.left,re=I.top+I.height/2-Oe.top;Pe(Ee,Oe.width/2,Oe.height/2,p,re,!0,getComputedStyle(j).getPropertyValue("background-color"))}}function Pe(Le,Ee,U,Oe,st,B,I){const p=B?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];Le.strokeStyle=Le.fillStyle=I,Le.beginPath();let re=Oe-Ee,K=st-U,X=Math.sqrt(re*re+K*K),pe=K/X,he=re/X,ce=[];ce.push(0,0);for(let z=0;z<p.length;z+=2){let se=p[z],Re=p[z+1];ce.push(se<0?X+se:se,Re)}ce.push(X,0);for(let z=p.length;z>0;z-=2){let se=p[z-2],Re=p[z-1];ce.push(se<0?X+se:se,-Re)}ce.push(0,0);for(let z=0;z<ce.length;z+=2){let se=ce[z]*he-ce[z+1]*pe+Ee,Re=ce[z]*pe+ce[z+1]*he+U;z===0?Le.moveTo(se,Re):Le.lineTo(se,Re)}Le.fill()}var ae=Pc(),Ue=V(ae);Sr(Ue,Le=>fe=Le,()=>fe);var Pt=$(Ue,2),Ze=V(Pt),gt=V(Ze),at=V(gt,!0),Gt=$(at,2,!0),Wt=$(Gt,2,!0);H(gt);var He=$(gt,2);Sr(He,Le=>ne=Le,()=>ne);var Mt=$(He,2);Sr(Mt,Le=>Ve=Le,()=>Ve);var mt=$(Mt,2),dt=V(mt),Kt=V(dt),pt=V(Kt,!0);H(Kt),H(dt),H(mt),Sr(mt,Le=>j=Le,()=>j);var Qt=$(mt,2);Ts(Qt,17,()=>P.packet.agents,Ss,(Le,Ee,U)=>{var Oe=Cc();let st;var B=V(Oe),I=V(B);let p,re;var K=V(I);K.__click=[Lc,J,Ee];var X=V(K);H(K),H(I),H(B);var pe=$(B,2),he=V(pe);{var ce=We=>{var we=Wi(),le=kr(we);{var ot=Te=>{var ee=bc(),Me=V(ee,!0);H(ee),nt(()=>ve(Me,F(Ee).name)),Ne(Te,ee)},$t=Te=>{var ee=Rc(),Me=V(ee,!0);H(ee),nt(()=>ve(Me,F(Ee).name)),Ne(Te,ee)};Lt(le,Te=>{var ee;(ee=F(te))!=null&&ee.display.largeScale?Te(ot):Te($t,!1)})}Ne(We,we)};Lt(he,We=>{var we;(we=F(te))!=null&&we.display.canvas.name&&We(ce)})}var z=$(he,2);{var se=We=>{var we=Wi(),le=kr(we);{var ot=Te=>{var ee=Ic(),Me=V(ee,!0);H(ee),nt(()=>ve(Me,F(Ee).team)),Ne(Te,ee)},$t=Te=>{var ee=_c(),Me=V(ee,!0);H(ee),nt(()=>ve(Me,F(Ee).team)),Ne(Te,ee)};Lt(le,Te=>{var ee;(ee=F(te))!=null&&ee.display.largeScale?Te(ot):Te($t,!1)})}Ne(We,we)};Lt(z,We=>{var we;(we=F(te))!=null&&we.display.canvas.team&&We(se)})}var Re=$(z,2);{var bt=We=>{var we=Wi(),le=kr(we);{var ot=Te=>{var ee=Dc(),Me=V(ee,!0);H(ee),nt(()=>ve(Me,F(Ee).role)),Ne(Te,ee)},$t=Te=>{var ee=kc(),Me=V(ee,!0);H(ee),nt(()=>ve(Me,F(Ee).role)),Ne(Te,ee)};Lt(le,Te=>{var ee;(ee=F(te))!=null&&ee.display.largeScale?Te(ot):Te($t,!1)})}Ne(We,we)};Lt(Re,We=>{var we;(we=F(te))!=null&&we.display.canvas.role&&(F(Ee).idx===J()||J()===void 0)&&We(bt)})}H(pe),H(Oe),nt((We,we,le)=>{st=Yr(Oe,1,"absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-104i6df",null,st,We),xs(Oe,`--angle: ${U*(360/P.packet.agents.length)}`),qi(Oe,"id",`agent-${F(Ee).idx??""}`),p=Yr(I,1,"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2 svelte-104i6df",null,p,we),re=xs(I,"",re,{opacity:F(Ee).is_alive?1:.25}),qi(X,"src",le),qi(X,"alt",F(Ee).name)},[()=>({"bg-focus":F(Ee).idx===J()}),()=>({"ring-info":F(Ee).is_alive,"ring-error":!F(Ee).is_alive}),()=>F(Ee).avatar===void 0?`${pc}/images/male/${F(Ee).idx.toString().padStart(2,"0")}.png`:F(Ee).avatar]),Ne(Le,Oe)}),H(Ze),Sr(Ze,Le=>Ke=Le,()=>Ke),H(Pt),Es(2),H(ae),nt((Le,Ee,U)=>{var Oe;ve(at,Le),ve(Gt,Ee),ve(Wt,U),mt.hidden=!F(Ct),Yr(Kt,1,uc((Oe=F(te))!=null&&Oe.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center")),ve(pt,F(Ct))},[()=>q()("realtime.day",{values:{day:P.packet.day}}),()=>P.packet.is_day?q()("realtime.daytime"):q()("realtime.nighttime"),()=>q()(`realtime.eventTypes.${P.packet.event}`,{default:P.packet.event})]),Ne(Z,ae),Wn(),Je()}Yn(["click"]);var ps={exports:{}},Yl;function Mc(){return Yl||(Yl=1,function(Z,P){(function Ae(Je){(function(q,J){Z.exports=J()})(this,function(){function q(a,o){(o==null||o>a.length)&&(o=a.length);for(var n=0,r=Array(o);n<o;n++)r[n]=a[n];return r}function J(a,o,n){if(me())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,o);var e=new(a.bind.apply(a,r));return n&&Ue(e,n.prototype),e}function te(a,o){for(var n=0;n<o.length;n++){var r=o[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,Ze(r.key),r)}}function oe(a,o,n){return o&&te(a.prototype,o),n&&te(a,n),Object.defineProperty(a,"prototype",{writable:!1}),a}function Ct(a,o){var n=typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(n)return(n=n.call(a)).next.bind(n);if(Array.isArray(a)||(n=gt(a))||o){n&&(a=n);var r=0;return function(){return r>=a.length?{done:!0}:{done:!1,value:a[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ke(a,o,n){return(o=Ze(o))in a?Object.defineProperty(a,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[o]=n,a}function ne(){return ne=Object.assign?Object.assign.bind():function(a){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var r in n)({}).hasOwnProperty.call(n,r)&&(a[r]=n[r])}return a},ne.apply(null,arguments)}function Ve(a){return Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},Ve(a)}function j(a,o){a.prototype=Object.create(o.prototype),a.prototype.constructor=a,Ue(a,o)}function fe(a){try{return Function.toString.call(a).indexOf("[native code]")!==-1}catch{return typeof a=="function"}}function me(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(me=function(){return!!a})()}function Pe(a,o){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);o&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),n.push.apply(n,r)}return n}function ae(a){for(var o=1;o<arguments.length;o++){var n=arguments[o]!=null?arguments[o]:{};o%2?Pe(Object(n),!0).forEach(function(r){Ke(a,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):Pe(Object(n)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(n,r))})}return a}function Ue(a,o){return Ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Ue(a,o)}function Pt(a,o){if(typeof a!="object"||!a)return a;var n=a[Symbol.toPrimitive];if(n!==void 0){var r=n.call(a,o);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(a)}function Ze(a){var o=Pt(a,"string");return typeof o=="symbol"?o:o+""}function gt(a,o){if(a){if(typeof a=="string")return q(a,o);var n={}.toString.call(a).slice(8,-1);return n==="Object"&&a.constructor&&(n=a.constructor.name),n==="Map"||n==="Set"?Array.from(a):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(a,o):void 0}}function at(a){var o=typeof Map=="function"?new Map:void 0;return at=function(n){if(n===null||!fe(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(n))return o.get(n);o.set(n,r)}function r(){return J(n,arguments,Ve(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Ue(r,n)},at(a)}function Gt(){try{return crypto.randomUUID()}catch{try{var a=URL.createObjectURL(new Blob),o=a.toString();return URL.revokeObjectURL(a),o.slice(o.lastIndexOf("/")+1)}catch{var n=new Date().getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var s=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(i=="x"?s:s&3|8).toString(16)});return r}}}function Wt(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var He={exports:{}},Mt;function mt(){return Mt||(Mt=1,function(a){var o=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function e(l,u,f){this.fn=l,this.context=u,this.once=f||!1}function t(l,u,f,d,h){if(typeof f!="function")throw new TypeError("The listener must be a function");var c=new e(f,d||l,h),v=n?n+u:u;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],c]:l._events[v].push(c):(l._events[v]=c,l._eventsCount++),l}function i(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function s(){this._events=new r,this._eventsCount=0}s.prototype.eventNames=function(){var u=[],f,d;if(this._eventsCount===0)return u;for(d in f=this._events)o.call(f,d)&&u.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},s.prototype.listeners=function(u){var f=n?n+u:u,d=this._events[f];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,c=d.length,v=new Array(c);h<c;h++)v[h]=d[h].fn;return v},s.prototype.listenerCount=function(u){var f=n?n+u:u,d=this._events[f];return d?d.fn?1:d.length:0},s.prototype.emit=function(u,f,d,h,c,v){var g=n?n+u:u;if(!this._events[g])return!1;var m=this._events[g],y=arguments.length,E,T;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,f),!0;case 3:return m.fn.call(m.context,f,d),!0;case 4:return m.fn.call(m.context,f,d,h),!0;case 5:return m.fn.call(m.context,f,d,h,c),!0;case 6:return m.fn.call(m.context,f,d,h,c,v),!0}for(T=1,E=new Array(y-1);T<y;T++)E[T-1]=arguments[T];m.fn.apply(m.context,E)}else{var S=m.length,x;for(T=0;T<S;T++)switch(m[T].once&&this.removeListener(u,m[T].fn,void 0,!0),y){case 1:m[T].fn.call(m[T].context);break;case 2:m[T].fn.call(m[T].context,f);break;case 3:m[T].fn.call(m[T].context,f,d);break;case 4:m[T].fn.call(m[T].context,f,d,h);break;default:if(!E)for(x=1,E=new Array(y-1);x<y;x++)E[x-1]=arguments[x];m[T].fn.apply(m[T].context,E)}}return!0},s.prototype.on=function(u,f,d){return t(this,u,f,d,!1)},s.prototype.once=function(u,f,d){return t(this,u,f,d,!0)},s.prototype.removeListener=function(u,f,d,h){var c=n?n+u:u;if(!this._events[c])return this;if(!f)return i(this,c),this;var v=this._events[c];if(v.fn)v.fn===f&&(!h||v.once)&&(!d||v.context===d)&&i(this,c);else{for(var g=0,m=[],y=v.length;g<y;g++)(v[g].fn!==f||h&&!v[g].once||d&&v[g].context!==d)&&m.push(v[g]);m.length?this._events[c]=m.length===1?m[0]:m:i(this,c)}return this},s.prototype.removeAllListeners=function(u){var f;return u?(f=n?n+u:u,this._events[f]&&i(this,f)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,a.exports=s}(He)),He.exports}var dt=mt(),Kt=Wt(dt),pt={exports:{}},Qt;function Le(){return Qt||(Qt=1,function(a,o){(function(n){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,e=/^(?=([^\/?#]*))\1([^]*)$/,t=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(l,u,f){if(f=f||{},l=l.trim(),u=u.trim(),!u){if(!f.alwaysNormalize)return l;var d=s.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=s.normalizePath(d.path),s.buildURLFromParts(d)}var h=s.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return f.alwaysNormalize?(h.path=s.normalizePath(h.path),s.buildURLFromParts(h)):u;var c=s.parseURL(l);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&c.path[0]!=="/"){var v=e.exec(c.path);c.netLoc=v[1],c.path=v[2]}c.netLoc&&!c.path&&(c.path="/");var g={scheme:c.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(g.netLoc=c.netLoc,h.path[0]!=="/"))if(!h.path)g.path=c.path,h.params||(g.params=c.params,h.query||(g.query=c.query));else{var m=c.path,y=m.substring(0,m.lastIndexOf("/")+1)+h.path;g.path=s.normalizePath(y)}return g.path===null&&(g.path=f.alwaysNormalize?s.normalizePath(h.path):h.path),s.buildURLFromParts(g)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(t,"");l.length!==(l=l.replace(i,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};a.exports=s})()}(pt)),pt.exports}var Ee=Le(),U=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},Oe=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=st},st=Number.MAX_SAFE_INTEGER||9007199254740991,B=function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a}({}),I=function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a}({}),p=function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a}({}),re={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},K={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},X=function(){function a(n,r,e){r===void 0&&(r=0),e===void 0&&(e=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=n,this.alpha_=n?Math.exp(Math.log(.5)/n):0,this.estimate_=r,this.totalWeight_=e}var o=a.prototype;return o.sample=function(r,e){var t=Math.pow(this.alpha_,r);this.estimate_=e*(1-t)+t*this.estimate_,this.totalWeight_+=r},o.getTotalWeight=function(){return this.totalWeight_},o.getEstimate=function(){if(this.alpha_){var r=1-Math.pow(this.alpha_,this.totalWeight_);if(r)return this.estimate_/r}return this.estimate_},a}(),pe=function(){function a(n,r,e,t){t===void 0&&(t=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new X(n),this.fast_=new X(r),this.defaultTTFB_=t,this.ttfb_=new X(n)}var o=a.prototype;return o.update=function(r,e){var t=this.slow_,i=this.fast_,s=this.ttfb_;t.halfLife!==r&&(this.slow_=new X(r,t.getEstimate(),t.getTotalWeight())),i.halfLife!==e&&(this.fast_=new X(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==r&&(this.ttfb_=new X(r,s.getEstimate(),s.getTotalWeight()))},o.sample=function(r,e){r=Math.max(r,this.minDelayMs_);var t=8*e,i=r/1e3,s=t/i;this.fast_.sample(i,s),this.slow_.sample(i,s)},o.sampleTTFB=function(r){var e=r/1e3,t=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(t,Math.max(r,5))},o.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},o.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},o.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},o.destroy=function(){},oe(a,[{key:"defaultEstimate",get:function(){return this.defaultEstimate_}}])}(),he=function(o,n){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;var r="["+o+"]:";this.trace=ce,this.debug=n.debug.bind(null,r),this.log=n.log.bind(null,r),this.warn=n.warn.bind(null,r),this.info=n.info.bind(null,r),this.error=n.error.bind(null,r)},ce=function(){},z={trace:ce,debug:ce,log:ce,warn:ce,info:ce,error:ce};function se(){return ne({},z)}function Re(a,o){var n=self.console[a];return n?n.bind(self.console,(o?"["+o+"] ":"")+"["+a+"] >"):ce}function bt(a,o,n){return o[a]?o[a].bind(o):Re(a,n)}var We=se();function we(a,o,n){var r=se();if(typeof console=="object"&&a===!0||typeof a=="object"){var e=["debug","log","info","warn","error"];e.forEach(function(t){r[t]=bt(t,a,n)});try{r.log('Debug logs enabled for "'+o+'" in hls.js version 1.6.2')}catch{return se()}e.forEach(function(t){We[t]=bt(t,a)})}else ne(We,r);return r}var le=We;function ot(a){if(a===void 0&&(a=!0),!(typeof self>"u")){var o=(a||!self.MediaSource)&&self.ManagedMediaSource;return o||self.MediaSource||self.WebKitMediaSource}}function $t(a){return typeof self<"u"&&a===self.ManagedMediaSource}function Te(a,o){var n=Object.keys(a),r=Object.keys(o),e=n.length,t=r.length;return!e||!t||e===t&&!n.some(function(i){return r.indexOf(i)===-1})}function ee(a,o){if(o===void 0&&(o=!1),typeof TextDecoder<"u"){var n=new TextDecoder("utf-8"),r=n.decode(a);if(o){var e=r.indexOf("\0");return e!==-1?r.substring(0,e):r}return r.replace(/\0/g,"")}for(var t=a.length,i,s,l,u="",f=0;f<t;){if(i=a[f++],i===0&&o)return u;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(i);break;case 12:case 13:s=a[f++],u+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=a[f++],l=a[f++],u+=String.fromCharCode((i&15)<<12|(s&63)<<6|(l&63)<<0);break}}return u}var Me={hexDump:function(o){for(var n="",r=0;r<o.length;r++){var e=o[r].toString(16);e.length<2&&(e="0"+e),n+=e}return n}},Jt=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},be={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},wt=function(){function a(n){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof n=="string"&&(n={url:n}),this.base=n,Zt(this,"stats")}var o=a.prototype;return o.setByteRange=function(r,e){var t=r.split("@",2),i;t.length===1?i=(e==null?void 0:e.byteRangeEndOffset)||0:i=parseInt(t[1]),this._byteRange=[i,parseInt(t[0])+i]},o.clearElementaryStreamInfo=function(){var r=this.elementaryStreams;r[be.AUDIO]=null,r[be.VIDEO]=null,r[be.AUDIOVIDEO]=null},oe(a,[{key:"baseurl",get:function(){return this.base.url}},{key:"byteRange",get:function(){return this._byteRange===null?[]:this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"elementaryStreams",get:function(){if(this._streams===null){var r;this._streams=(r={},r[be.AUDIO]=null,r[be.VIDEO]=null,r[be.AUDIOVIDEO]=null,r)}return this._streams},set:function(r){this._streams=r}},{key:"hasStats",get:function(){return this._stats!==null}},{key:"hasStreams",get:function(){return this._streams!==null}},{key:"stats",get:function(){return this._stats===null&&(this._stats=new Jt),this._stats},set:function(r){this._stats=r}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ee.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(r){this._url=r}}])}();function Se(a){return a.sn!=="initSegment"}var ht=function(a){function o(r,e){var t;return t=a.call(this,e)||this,t._decryptdata=null,t._programDateTime=null,t._ref=null,t._bitrate=void 0,t.rawProgramDateTime=null,t.tagList=[],t.duration=0,t.sn=0,t.levelkeys=void 0,t.type=void 0,t.loader=null,t.keyLoader=null,t.level=-1,t.cc=0,t.startPTS=void 0,t.endPTS=void 0,t.startDTS=void 0,t.endDTS=void 0,t.start=0,t.playlistOffset=0,t.deltaPTS=void 0,t.maxStartPTS=void 0,t.minEndPTS=void 0,t.data=void 0,t.bitrateTest=!1,t.title=null,t.initSegment=null,t.endList=void 0,t.gap=void 0,t.urlId=0,t.type=r,t}j(o,a);var n=o.prototype;return n.addStart=function(e){this.setStart(this.start+e)},n.setStart=function(e){this.start=e,this._ref&&(this._ref.start=e)},n.setDuration=function(e){this.duration=e,this._ref&&(this._ref.duration=e)},n.setKeyFormat=function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}},n.abortRequests=function(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()},n.setElementaryStreamInfo=function(e,t,i,s,l,u){u===void 0&&(u=!1);var f=this.elementaryStreams,d=f[e];if(!d){f[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:l,partial:u};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,i),d.startDTS=Math.min(d.startDTS,s),d.endDTS=Math.max(d.endDTS,l)},oe(o,[{key:"byteLength",get:function(){if(this.hasStats){var e=this.stats.total;if(e)return e}if(this.byteRange){var t=this.byteRange[0],i=this.byteRange[1];if(U(t)&&U(i))return i-t}return null}},{key:"bitrate",get:function(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null},set:function(e){this._bitrate=e}},{key:"decryptdata",get:function(){var e=this.levelkeys;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null)return null;var e=U(this.duration)?this.duration:0;return this.programDateTime+e*1e3}},{key:"encrypted",get:function(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}},{key:"programDateTime",get:function(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime},set:function(e){if(!U(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}},{key:"ref",get:function(){return Se(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}}])}(wt),Rt=function(a){function o(n,r,e,t,i){var s;s=a.call(this,e)||this,s.fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.duration=n.decimalFloatingPoint("DURATION"),s.gap=n.bool("GAP"),s.independent=n.bool("INDEPENDENT"),s.relurl=n.enumeratedString("URI"),s.fragment=r,s.index=t;var l=n.enumeratedString("BYTERANGE");return l&&s.setByteRange(l,i),i&&(s.fragOffset=i.fragOffset+i.duration),s}return j(o,a),oe(o,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var r=this.elementaryStreams;return!!(r.audio||r.video||r.audiovideo)}}])}(wt);function yt(a,o){var n=Object.getPrototypeOf(a);if(n){var r=Object.getOwnPropertyDescriptor(n,o);return r||yt(n,o)}}function Zt(a,o){var n=yt(a,o);n&&(n.enumerable=!0,Object.defineProperty(a,o,n))}var lt=Math.pow(2,32)-1,xr=[].push,It={video:1,audio:2,id3:3,text:4};function De(a){return String.fromCharCode.apply(null,a)}function Yt(a,o){var n=a[o]<<8|a[o+1];return n<0?65536+n:n}function Q(a,o){var n=er(a,o);return n<0?4294967296+n:n}function wr(a,o){var n=Q(a,o);return n*=Math.pow(2,32),n+=Q(a,o+4),n}function er(a,o){return a[o]<<24|a[o+1]<<16|a[o+2]<<8|a[o+3]}function Mr(a,o,n){a[o]=n>>24,a[o+1]=n>>16&255,a[o+2]=n>>8&255,a[o+3]=n&255}function gi(a){for(var o=a.byteLength,n=0;n<o;){var r=Q(a,n);if(r>8&&a[n+4]===109&&a[n+5]===111&&a[n+6]===111&&a[n+7]===102)return!0;n=r>1?n+r:o}return!1}function de(a,o){var n=[];if(!o.length)return n;for(var r=a.byteLength,e=0;e<r;){var t=Q(a,e),i=De(a.subarray(e+4,e+8)),s=t>1?e+t:r;if(i===o[0])if(o.length===1)n.push(a.subarray(e+8,s));else{var l=de(a.subarray(e+8,s),o.slice(1));l.length&&xr.apply(n,l)}e=s}return n}function mi(a){var o=[],n=a[0],r=8,e=Q(a,r);r+=4;var t=0,i=0;n===0?(t=Q(a,r),i=Q(a,r+4),r+=8):(t=wr(a,r),i=wr(a,r+8),r+=16),r+=2;var s=a.length+i,l=Yt(a,r);r+=2;for(var u=0;u<l;u++){var f=r,d=Q(a,f);f+=4;var h=d&2147483647,c=(d&2147483648)>>>31;if(c===1)return le.warn("SIDX has hierarchical references (not supported)"),null;var v=Q(a,f);f+=4,o.push({referenceSize:h,subsegmentDuration:v,info:{duration:v/e,start:s,end:s+h-1}}),s+=h,f+=4,r=f}return{earliestPresentationTime:t,timescale:e,version:n,referencesCount:l,references:o}}function jr(a){for(var o=[],n=de(a,["moov","trak"]),r=0;r<n.length;r++){var e=n[r],t=de(e,["tkhd"])[0];if(t){var i=t[0],s=Q(t,i===0?12:20),l=de(e,["mdia","mdhd"])[0];if(l){i=l[0];var u=Q(l,i===0?12:20),f=de(e,["mdia","hdlr"])[0];if(f){var d=De(f.subarray(8,12)),h={soun:be.AUDIO,vide:be.VIDEO}[d],c=de(e,["mdia","minf","stbl","stsd"])[0],v=pi(c);h?(o[s]={timescale:u,type:h,stsd:v},o[h]=ae({timescale:u,id:s},v)):o[s]={timescale:u,type:d,stsd:v}}}}}var g=de(a,["moov","mvex","trex"]);return g.forEach(function(m){var y=Q(m,4),E=o[y];E&&(E.default={duration:Q(m,12),flags:Q(m,20)})}),o}function pi(a){var o=a.subarray(8),n=o.subarray(86),r=De(o.subarray(4,8)),e=r,t,i=r==="enca"||r==="encv";if(i){var s=de(o,[r])[0],l=s.subarray(r==="enca"?28:78),u=de(l,["sinf"]);u.forEach(function(Tt){var vt=de(Tt,["schm"])[0];if(vt){var ft=De(vt.subarray(4,8));if(ft==="cbcs"||ft==="cenc"){var Qe=de(Tt,["frma"])[0];Qe&&(e=De(Qe))}}})}var f=e;switch(e){case"avc1":case"avc2":case"avc3":case"avc4":{var d=de(n,["avcC"])[0];d&&d.length>3&&(e+="."+Fr(d[1])+Fr(d[2])+Fr(d[3]),t=Xr(f==="avc1"?"dva1":"dvav",n));break}case"mp4a":{var h=de(o,[r])[0],c=de(h.subarray(28),["esds"])[0];if(c&&c.length>7){var v=4;if(c[v++]!==3)break;v=Or(c,v),v+=2;var g=c[v++];if(g&128&&(v+=2),g&64&&(v+=c[v++]),c[v++]!==4)break;v=Or(c,v);var m=c[v++];if(m===64)e+="."+Fr(m);else break;if(v+=12,c[v++]!==5)break;v=Or(c,v);var y=c[v++],E=(y&248)>>3;E===31&&(E+=1+((y&7)<<3)+((c[v]&224)>>5)),e+="."+E}break}case"hvc1":case"hev1":{var T=de(n,["hvcC"])[0];if(T&&T.length>12){var S=T[1],x=["","A","B","C"][S>>6],A=S&31,L=Q(T,2),_=(S&32)>>5?"H":"L",k=T[12],R=T.subarray(6,12);e+="."+x+A,e+="."+L.toString(16).toUpperCase(),e+="."+_+k;for(var b="",D=R.length;D--;){var C=R[D];if(C||b){var N=C.toString(16).toUpperCase();b="."+N+b}}e+=b}t=Xr(f=="hev1"?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{e=Xr(e,n)||e;break}case"vp09":{var O=de(n,["vpcC"])[0];if(O&&O.length>6){var M=O[4],G=O[5],Y=O[6]>>4&15;e+="."+Ot(M)+"."+Ot(G)+"."+Ot(Y)}break}case"av01":{var W=de(n,["av1C"])[0];if(W&&W.length>2){var ie=W[1]>>>5,xe=W[1]&31,ue=W[2]>>>7?"H":"M",_e=(W[2]&64)>>6,ge=(W[2]&32)>>5,ke=ie===2&&_e?ge?12:10:_e?10:8,Ce=(W[2]&16)>>4,Be=(W[2]&8)>>3,tt=(W[2]&4)>>2,ze=W[2]&3,Ye=1,rt=1,je=1,ye=0;e+="."+ie+"."+Ot(xe)+ue+"."+Ot(ke)+"."+Ce+"."+Be+tt+ze+"."+Ot(Ye)+"."+Ot(rt)+"."+Ot(je)+"."+ye,t=Xr("dav1",n)}break}}return{codec:e,encrypted:i,supplemental:t}}function Xr(a,o){var n=de(o,["dvvC"]),r=n.length?n[0]:de(o,["dvcC"])[0];if(r){var e=r[2]>>1&127,t=r[2]<<5&32|r[3]>>3&31;return a+"."+Ot(e)+"."+Ot(t)}}function Or(a,o){for(var n=o+5;a[o++]&128&&o<n;);return o}function Fr(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function Ot(a){return(a<10?"0":"")+a}function zn(a,o){if(!a||!o)return a;var n=o.keyId;if(n&&o.isCommonEncryption){var r=de(a,["moov","trak"]);r.forEach(function(e){var t=de(e,["mdia","minf","stbl","stsd"])[0],i=t.subarray(8),s=de(i,["enca"]),l=s.length>0;l||(s=de(i,["encv"])),s.forEach(function(u){var f=l?u.subarray(28):u.subarray(78),d=de(f,["sinf"]);d.forEach(function(h){var c=zr(h);if(c){var v=c.subarray(8,24);v.some(function(g){return g!==0})||(le.log("[eme] Patching keyId in 'enc"+(l?"a":"v")+">sinf>>tenc' box: "+Me.hexDump(v)+" -> "+Me.hexDump(n)),c.set(n,8))}})})})}return a}function zr(a){var o=de(a,["schm"])[0];if(o){var n=De(o.subarray(4,8));if(n==="cbcs"||n==="cenc")return de(a,["schi","tenc"])[0]}return null}function yi(a,o){return de(o,["moof","traf"]).reduce(function(n,r){var e=de(r,["tfdt"])[0],t=e[0],i=de(r,["tfhd"]).reduce(function(s,l){var u=Q(l,4),f=a[u];if(f){var d=Q(e,4);if(t===1){if(d===lt)return le.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),s;d*=lt+1,d+=Q(e,8)}var h=f.timescale||9e4,c=d/h;if(U(c)&&(s===null||c<s))return c}return s},null);return i!==null&&U(i)&&(n===null||i<n)?i:n},null)}function Qn(a,o){for(var n=0,r=0,e=0,t=de(a,["moof","traf"]),i=0;i<t.length;i++){var s=t[i],l=de(s,["tfhd"])[0],u=Q(l,4),f=o[u];if(f){var d=f.default,h=Q(l,0)|(d==null?void 0:d.flags),c=d==null?void 0:d.duration;h&8&&(h&2?c=Q(l,12):c=Q(l,8));for(var v=f.timescale||9e4,g=de(s,["trun"]),m=0;m<g.length;m++){if(n=Ei(g[m]),!n&&c){var y=Q(g[m],4);n=c*y}f.type===be.VIDEO?r+=n/v:f.type===be.AUDIO&&(e+=n/v)}}}if(r===0&&e===0){for(var E=1/0,T=0,S=0,x=de(a,["sidx"]),A=0;A<x.length;A++){var L=mi(x[A]);if(L!=null&&L.references){E=Math.min(E,L.earliestPresentationTime/L.timescale);var _=L.references.reduce(function(k,R){return k+R.info.duration||0},0);T=Math.max(T,_+L.earliestPresentationTime/L.timescale),S=T-E}}if(S&&U(S))return S}return r||e}function Ei(a){var o=Q(a,0),n=8;o&1&&(n+=4),o&4&&(n+=4);for(var r=0,e=Q(a,4),t=0;t<e;t++){if(o&256){var i=Q(a,n);r+=i,n+=4}o&512&&(n+=4),o&1024&&(n+=4),o&2048&&(n+=4)}return r}function Ti(a,o,n){de(o,["moof","traf"]).forEach(function(r){de(r,["tfhd"]).forEach(function(e){var t=Q(e,4),i=a[t];if(i){var s=i.timescale||9e4;de(r,["tfdt"]).forEach(function(l){var u=l[0],f=n*s;if(f){var d=Q(l,4);if(u===0)d-=f,d=Math.max(d,0),Mr(l,4,d);else{d*=Math.pow(2,32),d+=Q(l,8),d-=f,d=Math.max(d,0);var h=Math.floor(d/(lt+1)),c=Math.floor(d%(lt+1));Mr(l,4,h),Mr(l,8,c)}}})}})})}function $n(a){var o={valid:null,remainder:null},n=de(a,["moof"]);if(n.length<2)return o.remainder=a,o;var r=n[n.length-1];return o.valid=a.slice(0,r.byteOffset-8),o.remainder=a.slice(r.byteOffset-8),o}function _t(a,o){var n=new Uint8Array(a.length+o.length);return n.set(a),n.set(o,a.length),n}function Qr(a,o){var n=[],r=o.samples,e=o.timescale,t=o.id,i=!1,s=de(r,["moof"]);return s.map(function(l){var u=l.byteOffset-8,f=de(l,["traf"]);f.map(function(d){var h=de(d,["tfdt"]).map(function(c){var v=c[0],g=Q(c,4);return v===1&&(g*=Math.pow(2,32),g+=Q(c,8)),g/e})[0];return h!==void 0&&(a=h),de(d,["tfhd"]).map(function(c){var v=Q(c,4),g=Q(c,0)&16777215,m=(g&1)!==0,y=(g&2)!==0,E=(g&8)!==0,T=0,S=(g&16)!==0,x=0,A=(g&32)!==0,L=8;v===t&&(m&&(L+=8),y&&(L+=4),E&&(T=Q(c,L),L+=4),S&&(x=Q(c,L),L+=4),A&&(L+=4),o.type==="video"&&(i=$r(o.codec)),de(d,["trun"]).map(function(_){var k=_[0],R=Q(_,0)&16777215,b=(R&1)!==0,D=0,C=(R&4)!==0,N=(R&256)!==0,O=0,M=(R&512)!==0,G=0,Y=(R&1024)!==0,W=(R&2048)!==0,ie=0,xe=Q(_,4),ue=8;b&&(D=Q(_,ue),ue+=4),C&&(ue+=4);for(var _e=D+u,ge=0;ge<xe;ge++){if(N?(O=Q(_,ue),ue+=4):O=T,M?(G=Q(_,ue),ue+=4):G=x,Y&&(ue+=4),W&&(k===0?ie=Q(_,ue):ie=er(_,ue),ue+=4),o.type===be.VIDEO)for(var ke=0;ke<G;){var Ce=Q(r,_e);if(_e+=4,ji(i,r[_e])){var Be=r.subarray(_e,_e+Ce);Si(Be,i?2:1,a+ie/e,n)}_e+=Ce,ke+=Ce+4}a+=O/e}}))})})}),n}function $r(a){if(!a)return!1;var o=a.substring(0,4);return o==="hvc1"||o==="hev1"||o==="dvh1"||o==="dvhe"}function ji(a,o){if(a){var n=o>>1&63;return n===39||n===40}else{var r=o&31;return r===6}}function Si(a,o,n,r){var e=xi(a),t=0;t+=o;for(var i=0,s=0,l=0;t<e.length;){i=0;do{if(t>=e.length)break;l=e[t++],i+=l}while(l===255);s=0;do{if(t>=e.length)break;l=e[t++],s+=l}while(l===255);var u=e.length-t,f=t;if(s<u)t+=s;else if(s>u){le.error("Malformed SEI payload. "+s+" is too small, only "+u+" bytes left to parse.");break}if(i===4){var d=e[f++];if(d===181){var h=Yt(e,f);if(f+=2,h===49){var c=Q(e,f);if(f+=4,c===1195456820){var v=e[f++];if(v===3){var g=e[f++],m=31&g,y=64&g,E=y?2+m*3:0,T=new Uint8Array(E);if(y){T[0]=g;for(var S=1;S<E;S++)T[S]=e[f++]}r.push({type:v,payloadType:i,pts:n,bytes:T})}}}}}else if(i===5&&s>16){for(var x=[],A=0;A<16;A++){var L=e[f++].toString(16);x.push(L.length==1?"0"+L:L),(A===3||A===5||A===7||A===9)&&x.push("-")}for(var _=s-16,k=new Uint8Array(_),R=0;R<_;R++)k[R]=e[f++];r.push({payloadType:i,pts:n,uuid:x.join(""),userData:ee(k),userDataBytes:k})}}}function xi(a){for(var o=a.byteLength,n=[],r=1;r<o-2;)a[r]===0&&a[r+1]===0&&a[r+2]===3?(n.push(r+2),r+=2):r++;if(n.length===0)return a;var e=o-n.length,t=new Uint8Array(e),i=0;for(r=0;r<e;i++,r++)i===n[0]&&(i++,n.shift()),t[r]=a[i];return t}function Xi(a){var o=a[0],n="",r="",e=0,t=0,i=0,s=0,l=0,u=0;if(o===0){for(;De(a.subarray(u,u+1))!=="\0";)n+=De(a.subarray(u,u+1)),u+=1;for(n+=De(a.subarray(u,u+1)),u+=1;De(a.subarray(u,u+1))!=="\0";)r+=De(a.subarray(u,u+1)),u+=1;r+=De(a.subarray(u,u+1)),u+=1,e=Q(a,12),t=Q(a,16),s=Q(a,20),l=Q(a,24),u=28}else if(o===1){u+=4,e=Q(a,u),u+=4;var f=Q(a,u);u+=4;var d=Q(a,u);for(u+=4,i=Math.pow(2,32)*f+d,Oe(i)||(i=Number.MAX_SAFE_INTEGER,le.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),s=Q(a,u),u+=4,l=Q(a,u),u+=4;De(a.subarray(u,u+1))!=="\0";)n+=De(a.subarray(u,u+1)),u+=1;for(n+=De(a.subarray(u,u+1)),u+=1;De(a.subarray(u,u+1))!=="\0";)r+=De(a.subarray(u,u+1)),u+=1;r+=De(a.subarray(u,u+1)),u+=1}var h=a.subarray(u,a.byteLength);return{schemeIdUri:n,value:r,timeScale:e,presentationTime:i,presentationTimeDelta:t,eventDuration:s,id:l,payload:h}}function Jn(a){for(var o=arguments.length,n=new Array(o>1?o-1:0),r=1;r<o;r++)n[r-1]=arguments[r];for(var e=n.length,t=8,i=e;i--;)t+=n[i].byteLength;var s=new Uint8Array(t);for(s[0]=t>>24&255,s[1]=t>>16&255,s[2]=t>>8&255,s[3]=t&255,s.set(a,4),i=0,t=8;i<e;i++)s.set(n[i],t),t+=n[i].byteLength;return s}function zi(a,o,n){if(a.byteLength!==16)throw new RangeError("Invalid system id");var r,e;r=0,e=new Uint8Array;var t;r>0?(t=new Uint8Array(4),o.length>0&&new DataView(t.buffer).setUint32(0,o.length,!1)):t=new Uint8Array;var i=new Uint8Array(4);return n&&n.byteLength>0&&new DataView(i.buffer).setUint32(0,n.byteLength,!1),Jn([112,115,115,104],new Uint8Array([r,0,0,0]),a,t,e,i,n||new Uint8Array)}function Ai(a){var o=[];if(a instanceof ArrayBuffer)for(var n=a.byteLength,r=0;r+32<n;){var e=new DataView(a,r),t=Zn(e);o.push(t),r+=t.size}return o}function Zn(a){var o=a.getUint32(0),n=a.byteOffset,r=a.byteLength;if(r<o)return{offset:n,size:r};var e=a.getUint32(4);if(e!==1886614376)return{offset:n,size:o};var t=a.getUint32(8)>>>24;if(t!==0&&t!==1)return{offset:n,size:o};var i=a.buffer,s=Me.hexDump(new Uint8Array(i,n+12,16)),l=a.getUint32(28),u=null,f=null;if(t===0){if(o-32<l||l<22)return{offset:n,size:o};f=new Uint8Array(i,n+32,l)}else if(t===1){if(!l||r<n+32+l*16+16)return{offset:n,size:o};u=[];for(var d=0;d<l;d++)u.push(new Uint8Array(i,n+32+d*16,16))}return{version:t,systemId:s,kids:u,data:f,offset:n,size:o}}var Li=function(){return/\(Windows.+Firefox\//i.test(navigator.userAgent)},qe={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function nr(a,o){var n=qe[o];return!!n&&!!n[a.slice(0,4)]}function ar(a,o,n){return n===void 0&&(n=!0),!a.split(",").some(function(r){return!cr(r,o,n)})}function cr(a,o,n){var r;n===void 0&&(n=!0);var e=ot(n);return(r=e==null?void 0:e.isTypeSupported(Dt(a,o)))!=null?r:!1}function Dt(a,o){return o+"/mp4;codecs="+a}function qt(a){if(a){var o=a.substring(0,4);return qe.video[o]}return 2}function vr(a){var o=Li();return a.split(",").reduce(function(n,r){var e=o&&$r(r),t=e?9:qe.video[r];return t?(t*2+n)/(n?3:2):(qe.audio[r]+n)/(n?2:1)},0)}var bi={};function ea(a,o){if(o===void 0&&(o=!0),bi[a])return bi[a];for(var n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[a],r=0;r<n.length;r++){var e;if(cr(n[r],"audio",o))return bi[a]=n[r],n[r];if(n[r]==="mp3"&&(e=ot(o))!=null&&e.isTypeSupported("audio/mpeg"))return""}return a}var ta=/flac|opus|mp4a\.40\.34/i;function Jr(a,o){return o===void 0&&(o=!0),a.replace(ta,function(n){return ea(n.toLowerCase(),o)})}function ra(a,o){var n=[];if(a)for(var r=a.split(","),e=0;e<r.length;e++)nr(r[e],"video")||n.push(r[e]);return o&&n.push(o),n.join(",")}function Zr(a,o){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1))return a;if(o){var n=o.split(",");if(n.length>1){if(a){for(var r=n.length;r--;)if(n[r].substring(0,4)===a.substring(0,4))return n[r]}return n[0]}}return o||a}function ia(a){for(var o=a.split(","),n=0;n<o.length;n++){var r=o[n].split(".");if(r.length>2){var e=r.shift()+".";e+=parseInt(r.shift()).toString(16),e+=("000"+parseInt(r.shift()).toString(16)).slice(-4),o[n]=e}}return o.join(",")}function na(a){if(a.startsWith("av01.")){for(var o=a.split("."),n=["0","111","01","01","01","0"],r=o.length;r>4&&r<10;r++)o[r]=n[r-4];return o.join(".")}return a}function Qi(a){var o=ot(a)||{isTypeSupported:function(){return!1}};return{mpeg:o.isTypeSupported("audio/mpeg"),mp3:o.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:o.isTypeSupported('audio/mp4; codecs="ac-3"')}}function $i(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var Ji={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Zi(a,o){return{supported:!1,configurations:o,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:a}}var en={};function aa(a,o,n,r,e,t){var i=a.audioCodec?a.audioGroups:null,s=t==null?void 0:t.audioCodec,l=t==null?void 0:t.channels,u=l?parseInt(l):s?1/0:2,f=null;if(i!=null&&i.length)try{i.length===1&&i[0]?f=o.groups[i[0]].channels:f=i.reduce(function(d,h){if(h){var c=o.groups[h];if(!c)throw new Error("Audio track group "+h+" not found");Object.keys(c.channels).forEach(function(v){d[v]=(d[v]||0)+c.channels[v]})}return d},{2:0})}catch{return!0}return a.videoCodec!==void 0&&(a.width>1920&&a.height>1088||a.height>1920&&a.width>1088||a.frameRate>Math.max(r,30)||a.videoRange!=="SDR"&&a.videoRange!==n||a.bitrate>Math.max(e,8e6))||!!f&&U(u)&&Object.keys(f).some(function(d){return parseInt(d)>u})}function tn(a,o,n){var r=a.videoCodec,e=a.audioCodec;if(!r&&!e||!n)return Promise.resolve(Ji);var t=[];if(r){var i={width:a.width,height:a.height,bitrate:Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)),framerate:a.frameRate||30},s=a.videoRange;s!=="SDR"&&(i.transferFunction=s.toLowerCase());var l=r.split(","),u=navigator.userAgent;if(l.some(function(f){return $r(f)})&&Li())return Promise.resolve(Zi(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: ("+u+")"),t));t.push.apply(t,l.map(function(f){return{type:"media-source",video:ae(ae({},i),{},{contentType:Dt(na(f),"video")})}}))}return e&&a.audioGroups&&a.audioGroups.forEach(function(f){var d;f&&((d=o.groups[f])==null||d.tracks.forEach(function(h){if(h.groupId===f){var c=h.channels||"",v=parseFloat(c);U(v)&&v>2&&t.push.apply(t,e.split(",").map(function(g){return{type:"media-source",audio:{contentType:Dt(g,"audio"),channels:""+v}}}))}}))}),Promise.all(t.map(function(f){var d=sa(f);return en[d]||(en[d]=n.decodingInfo(f))})).then(function(f){return{supported:!f.some(function(d){return!d.supported}),configurations:t,decodingInfoResults:f}}).catch(function(f){return{supported:!1,configurations:t,decodingInfoResults:[],error:f}})}function sa(a){var o=a.audio,n=a.video,r=n||o;if(r){var e=$i(r.contentType);if(n)return"r"+n.height+"x"+n.width+"f"+Math.ceil(n.framerate)+(n.transferFunction||"sd")+"_"+e+"_"+Math.ceil(n.bitrate/1e5);if(o)return"c"+o.channels+(o.spatialRendering?"s":"n")+"_"+e}return""}var Ri=["NONE","TYPE-0","TYPE-1",null];function oa(a){return Ri.indexOf(a)>-1}var Nr=["SDR","PQ","HLG"];function rn(a){return!!a&&Nr.indexOf(a)>-1}var Ur={No:"",Yes:"YES",v2:"v2"};function Ii(a){var o=a.canSkipUntil,n=a.canSkipDateRanges,r=a.age,e=r<o/2;return o&&e?n?Ur.v2:Ur.Yes:Ur.No}var _i=function(){function a(n,r,e){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=n,this.part=r,this.skip=e}var o=a.prototype;return o.addDirectives=function(r){var e=new self.URL(r);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},a}(),Ar=function(){function a(n){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[n.url],this._attrs=[n.attrs],this.bitrate=n.bitrate,n.details&&(this.details=n.details),this.id=n.id||0,this.name=n.name,this.width=n.width||0,this.height=n.height||0,this.frameRate=n.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=n.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=n.audioCodec,this.videoCodec=n.videoCodec,this.codecSet=[n.videoCodec,n.audioCodec].filter(function(t){return!!t}).map(function(t){return t.substring(0,4)}).join(","),"supplemental"in n){var r;this.supplemental=n.supplemental;var e=(r=n.supplemental)==null?void 0:r.videoCodec;e&&e!==n.videoCodec&&(this.codecSet+=","+e.substring(0,4))}this.addGroupId("audio",n.attrs.AUDIO),this.addGroupId("text",n.attrs.SUBTITLES)}var o=a.prototype;return o.hasAudioGroup=function(r){return Di(this._audioGroups,r)},o.hasSubtitleGroup=function(r){return Di(this._subtitleGroups,r)},o.addGroupId=function(r,e){if(e){if(r==="audio"){var t=this._audioGroups;t||(t=this._audioGroups=[]),t.indexOf(e)===-1&&t.push(e)}else if(r==="text"){var i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(e)===-1&&i.push(e)}}},o.addFallback=function(){},oe(a,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(r){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var r;return(r=this.audioGroups)==null?void 0:r[0]}},{key:"textGroupId",get:function(){var r;return(r=this.subtitleGroups)==null?void 0:r[0]}}])}();function Di(a,o){return!o||!a?!1:a.indexOf(o)!==-1}function nn(){if(typeof matchMedia=="function"){var a=matchMedia("(dynamic-range: high)"),o=matchMedia("bad query");if(a.media!==o.media)return a.matches===!0}return!1}function an(a,o){var n=!1,r=[];if(a&&(n=a!=="SDR",r=[a]),o){r=o.allowedVideoRanges||Nr.slice(0);var e=r.join("")!=="SDR"&&!o.videoCodec;n=o.preferHDR!==void 0?o.preferHDR:e&&nn(),n||(r=["SDR"])}return{preferHDR:n,allowedVideoRanges:r}}var sn=function(o){var n=new WeakSet;return function(r,e){if(o&&(e=o(r,e)),typeof e=="object"&&e!==null){if(n.has(e))return;n.add(e)}return e}},Ge=function(o,n){return JSON.stringify(o,sn(n))};function on(a,o,n,r,e){for(var t=Object.keys(a),i=r==null?void 0:r.channels,s=r==null?void 0:r.audioCodec,l=e==null?void 0:e.videoCodec,u=i&&parseInt(i)===2,f=!1,d=!1,h=1/0,c=1/0,v=1/0,g=1/0,m=0,y=[],E=an(o,e),T=E.preferHDR,S=E.allowedVideoRanges,x=function(){var D=a[t[A]];f||(f=D.channels[2]>0),h=Math.min(h,D.minHeight),c=Math.min(c,D.minFramerate),v=Math.min(v,D.minBitrate);var C=S.filter(function(N){return D.videoRanges[N]>0});C.length>0&&(d=!0)},A=t.length;A--;)x();h=U(h)?h:0,c=U(c)?c:0;var L=Math.max(1080,h),_=Math.max(30,c);v=U(v)?v:n,n=Math.max(v,n),d||(o=void 0);var k=t.length>1,R=t.reduce(function(b,D){var C=a[D];if(D===b)return b;if(y=d?S.filter(function(N){return C.videoRanges[N]>0}):[],k){if(C.minBitrate>n)return sr(D,"min bitrate of "+C.minBitrate+" > current estimate of "+n),b;if(!C.hasDefaultAudio)return sr(D,"no renditions with default or auto-select sound found"),b;if(s&&D.indexOf(s.substring(0,4))%5!==0)return sr(D,'audio codec preference "'+s+'" not found'),b;if(i&&!u){if(!C.channels[i])return sr(D,"no renditions with "+i+" channel sound found (channels options: "+Object.keys(C.channels)+")"),b}else if((!s||u)&&f&&C.channels[2]===0)return sr(D,"no renditions with stereo sound found"),b;if(C.minHeight>L)return sr(D,"min resolution of "+C.minHeight+" > maximum of "+L),b;if(C.minFramerate>_)return sr(D,"min framerate of "+C.minFramerate+" > maximum of "+_),b;if(!y.some(function(N){return C.videoRanges[N]>0}))return sr(D,"no variants with VIDEO-RANGE of "+Ge(y)+" found"),b;if(l&&D.indexOf(l.substring(0,4))%5!==0)return sr(D,'video codec preference "'+l+'" not found'),b;if(C.maxScore<m)return sr(D,"max score of "+C.maxScore+" < selected max of "+m),b}return b&&(vr(D)>=vr(b)||C.fragmentError>a[b].fragmentError)?b:(g=C.minIndex,m=C.maxScore,D)},void 0);return{codecSet:R,videoRanges:y,preferHDR:T,minFramerate:c,minBitrate:v,minIndex:g}}function sr(a,o){le.log('[abr] start candidates with "'+a+'" ignored because '+o)}function Ls(a){return a.reduce(function(o,n){var r=o.groups[n.groupId];r||(r=o.groups[n.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(n);var e=n.channels||"2";return r.channels[e]=(r.channels[e]||0)+1,r.hasDefault=r.hasDefault||n.default,r.hasAutoSelect=r.hasAutoSelect||n.autoselect,r.hasDefault&&(o.hasDefaultAudio=!0),r.hasAutoSelect&&(o.hasAutoSelectAudio=!0),o},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Ql(a,o,n,r){return a.slice(n,r+1).reduce(function(e,t,i){if(!t.codecSet)return e;var s=t.audioGroups,l=e[t.codecSet];l||(e[t.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!s,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,t.bitrate);var u=Math.min(t.height,t.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,t.frameRate),l.minIndex=Math.min(l.minIndex,i),l.maxScore=Math.max(l.maxScore,t.score),l.fragmentError+=t.fragmentError,l.videoRanges[t.videoRange]=(l.videoRanges[t.videoRange]||0)+1,s&&s.forEach(function(f){if(f){var d=o.groups[f];d&&(l.hasDefaultAudio=l.hasDefaultAudio||o.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!o.hasDefaultAudio&&!o.hasAutoSelectAudio,Object.keys(d.channels).forEach(function(h){l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}}),e},{})}function bs(a){if(!a)return a;var o=a,n=o.lang,r=o.assocLang,e=o.characteristics,t=o.channels,i=o.audioCodec;return{lang:n,assocLang:r,characteristics:e,channels:t,audioCodec:i}}function or(a,o,n){if("attrs"in a){var r=o.indexOf(a);if(r!==-1)return r}for(var e=0;e<o.length;e++){var t=o[e];if(Br(a,t,n))return e}return-1}function Br(a,o,n){var r=a.groupId,e=a.name,t=a.lang,i=a.assocLang,s=a.default,l=a.forced;return(r===void 0||o.groupId===r)&&(e===void 0||o.name===e)&&(t===void 0||$l(t,o.lang))&&(t===void 0||o.assocLang===i)&&(s===void 0||o.default===s)&&(l===void 0||o.forced===l)&&(!("characteristics"in a)||Jl(a.characteristics||"",o.characteristics))&&(n===void 0||n(a,o))}function $l(a,o){return o===void 0&&(o="--"),a.length===o.length?a===o:a.startsWith(o)||o.startsWith(a)}function Jl(a,o){o===void 0&&(o="");var n=a.split(","),r=o.split(",");return n.length===r.length&&!n.some(function(e){return r.indexOf(e)===-1})}function Gr(a,o){var n=a.audioCodec,r=a.channels;return(n===void 0||(o.audioCodec||"").substring(0,4)===n.substring(0,4))&&(r===void 0||r===(o.channels||"2"))}function Zl(a,o,n,r,e){var t=o[r],i=o.reduce(function(h,c,v){var g=c.uri,m=h[g]||(h[g]=[]);return m.push(v),h},{}),s=i[t.uri];s.length>1&&(r=Math.max.apply(Math,s));var l=t.videoRange,u=t.frameRate,f=t.codecSet.substring(0,4),d=Rs(o,r,function(h){if(h.videoRange!==l||h.frameRate!==u||h.codecSet.substring(0,4)!==f)return!1;var c=h.audioGroups,v=n.filter(function(g){return!c||c.indexOf(g.groupId)!==-1});return or(a,v,e)>-1});return d>-1?d:Rs(o,r,function(h){var c=h.audioGroups,v=n.filter(function(g){return!c||c.indexOf(g.groupId)!==-1});return or(a,v,e)>-1})}function Rs(a,o,n){for(var r=o;r>-1;r--)if(n(a[r]))return r;for(var e=o+1;e<a.length;e++)if(n(a[e]))return e;return-1}function ln(a,o){var n;return!!a&&a!==((n=o.loadLevelObj)==null?void 0:n.uri)}var eu=function(a){function o(r){var e;return e=a.call(this,"abr",r.logger)||this,e.hls=void 0,e.lastLevelLoadSec=0,e.lastLoadedFragLevel=-1,e.firstSelection=-1,e._nextAutoLevel=-1,e.nextAutoLevelKey="",e.audioTracksByGroup=null,e.codecTiers=null,e.timer=-1,e.fragCurrent=null,e.partCurrent=null,e.bitrateTestDelay=0,e.rebufferNotice=-1,e.bwEstimator=void 0,e._abandonRulesCheck=function(t){var i,s=e,l=s.fragCurrent,u=s.partCurrent,f=s.hls,d=f.autoLevelEnabled,h=f.media;if(!(!l||!h)){var c=performance.now(),v=u?u.stats:l.stats,g=u?u.duration:l.duration,m=c-v.loading.start,y=f.minAutoLevel,E=l.level,T=e._nextAutoLevel;if(v.aborted||v.loaded&&v.loaded===v.total||E<=y){e.clearTimer(),e._nextAutoLevel=-1;return}if(d){var S=T>-1&&T!==E,x=!!t||S;if(!(!x&&(h.paused||!h.playbackRate||!h.readyState))){var A=f.mainForwardBufferInfo;if(!(!x&&A===null)){var L=e.bwEstimator.getEstimateTTFB(),_=Math.abs(h.playbackRate);if(!(m<=Math.max(L,1e3*(g/(_*2))))){var k=A?A.len/_:0,R=v.loading.first?v.loading.first-v.loading.start:-1,b=v.loaded&&R>-1,D=e.getBwEstimate(),C=f.levels,N=C[E],O=Math.max(v.loaded,Math.round(g*(l.bitrate||N.averageBitrate)/8)),M=b?m-R:m;M<1&&b&&(M=Math.min(m,v.loaded*8/D));var G=b?v.loaded*1e3/M:0,Y=L/1e3,W=G?(O-v.loaded)/G:O*8/D+Y;if(!(W<=k)){var ie=G?G*8:D,xe=((i=(t==null?void 0:t.details)||e.hls.latestLevelDetails)==null?void 0:i.live)===!0,ue=e.hls.config.abrBandWidthUpFactor,_e=Number.POSITIVE_INFINITY,ge;for(ge=E-1;ge>y;ge--){var ke=C[ge].maxBitrate,Ce=!C[ge].details||xe;if(_e=e.getTimeToLoadFrag(Y,ie,g*ke,Ce),_e<Math.min(k,g+Y))break}if(!(_e>=W)&&!(_e>g*10)){b?e.bwEstimator.sample(m-Math.min(L,R),v.loaded):e.bwEstimator.sampleTTFB(m);var Be=C[ge].maxBitrate;e.getBwEstimate()*ue>Be&&e.resetEstimator(Be);var tt=e.findBestLevel(Be,y,ge,0,k,1,1);tt>-1&&(ge=tt),e.warn("Fragment "+l.sn+(u?" part "+u.index:"")+" of level "+E+` is loading too slowly;
      Fragment duration: `+l.duration.toFixed(3)+`
      Time to underbuffer: `+k.toFixed(3)+` s
      Estimated load time for current fragment: `+W.toFixed(3)+` s
      Estimated load time for down switch fragment: `+_e.toFixed(3)+` s
      TTFB estimate: `+(R|0)+` ms
      Current BW estimate: `+(U(D)?D|0:"Unknown")+` bps
      New BW estimate: `+(e.getBwEstimate()|0)+` bps
      Switching to level `+ge+" @ "+(Be|0)+" bps"),f.nextLoadLevel=f.nextAutoLevel=ge,e.clearTimer();var ze=function(){if(e.clearTimer(),e.fragCurrent===l&&e.hls.loadLevel===ge&&ge>0){var rt=e.getStarvationDelay();if(e.warn("Aborting inflight request "+(ge>0?"and switching down":"")+`
      Fragment duration: `+l.duration.toFixed(3)+` s
      Time to underbuffer: `+rt.toFixed(3)+" s"),l.abortRequests(),e.fragCurrent=e.partCurrent=null,ge>y){var je=e.findBestLevel(e.hls.levels[y].bitrate,y,ge,0,rt,1,1);je===-1&&(je=y),e.hls.nextLoadLevel=e.hls.nextAutoLevel=je,e.resetEstimator(e.hls.levels[je].bitrate)}}};S||W>_e*2?ze():e.timer=self.setInterval(ze,_e*1e3),f.trigger(p.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:u,stats:v})}}}}}}}},e.hls=r,e.bwEstimator=e.initEstimator(),e.registerListeners(),e}j(o,a);var n=o.prototype;return n.resetEstimator=function(e){e&&(this.log("setting initial bwe to "+e),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},n.initEstimator=function(){var e=this.hls.config;return new pe(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)},n.registerListeners=function(){var e=this.hls;e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.FRAG_LOADING,this.onFragLoading,this),e.on(p.FRAG_LOADED,this.onFragLoaded,this),e.on(p.FRAG_BUFFERED,this.onFragBuffered,this),e.on(p.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(p.LEVEL_LOADED,this.onLevelLoaded,this),e.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(p.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(p.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.FRAG_LOADING,this.onFragLoading,this),e.off(p.FRAG_LOADED,this.onFragLoaded,this),e.off(p.FRAG_BUFFERED,this.onFragBuffered,this),e.off(p.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(p.LEVEL_LOADED,this.onLevelLoaded,this),e.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(p.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(p.ERROR,this.onError,this))},n.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},n.onManifestLoading=function(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},n.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},n.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},n.onFragLoading=function(e,t){var i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}},n.onLevelSwitching=function(e,t){this.clearTimer()},n.onError=function(e,t){if(!t.fatal)switch(t.details){case I.BUFFER_ADD_CODEC_ERROR:case I.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case I.FRAG_LOAD_TIMEOUT:{var i=t.frag,s=this.fragCurrent,l=this.partCurrent;if(i&&s&&i.sn===s.sn&&i.level===s.level){var u=performance.now(),f=l?l.stats:i.stats,d=u-f.loading.start,h=f.loading.first?f.loading.first-f.loading.start:-1,c=f.loaded&&h>-1;if(c){var v=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(v,h),f.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}},n.getTimeToLoadFrag=function(e,t,i,s){var l=e+i/t,u=s?e+this.lastLevelLoadSec:0;return l+u},n.onLevelLoaded=function(e,t){var i=this.hls.config,s=t.stats.loading,l=s.end-s.first;U(l)&&(this.lastLevelLoadSec=l/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)},n.onFragLoaded=function(e,t){var i=t.frag,s=t.part,l=s?s.stats:i.stats;if(i.type===K.MAIN&&this.bwEstimator.sampleTTFB(l.loading.first-l.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),i.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var u=s?s.duration:i.duration,f=this.hls.levels[i.level],d=(f.loaded?f.loaded.bytes:0)+l.loaded,h=(f.loaded?f.loaded.duration:0)+u;f.loaded={bytes:d,duration:h},f.realBitrate=Math.round(8*d/h)}if(i.bitrateTest){var c={stats:l,frag:i,part:s,id:i.type};this.onFragBuffered(p.FRAG_BUFFERED,c),i.bitrateTest=!1}else this.lastLoadedFragLevel=i.level}},n.onFragBuffered=function(e,t){var i=t.frag,s=t.part,l=s!=null&&s.stats.loaded?s.stats:i.stats;if(!l.aborted&&!this.ignoreFragment(i)){var u=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(u,l.loaded),l.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}},n.ignoreFragment=function(e){return e.type!==K.MAIN||e.sn==="initSegment"},n.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},n.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},n.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,i=this.hls;if(i.levels.length<=1)return i.loadLevel;var s=i.maxAutoLevel,l=i.config,u=i.minAutoLevel,f=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),h=this.getStarvationDelay(),c=l.abrBandWidthFactor,v=l.abrBandWidthUpFactor;if(h){var g=this.findBestLevel(d,u,s,h,0,c,v);if(g>=0)return this.rebufferNotice=-1,g}var m=f?Math.min(f,l.maxStarvationDelay):l.maxStarvationDelay;if(!h){var y=this.bitrateTestDelay;if(y){var E=f?Math.min(f,l.maxLoadingDelay):l.maxLoadingDelay;m=E-y,this.info("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),c=v=1}}var T=this.findBestLevel(d,u,s,h,m,c,v);if(this.rebufferNotice!==T&&(this.rebufferNotice=T,this.info((h?"rebuffering expected":"buffer is empty")+", optimal quality level "+T)),T>-1)return T;var S=i.levels[u],x=i.loadLevelObj;return x&&(S==null?void 0:S.bitrate)<x.bitrate?u:i.loadLevel},n.getStarvationDelay=function(){var e=this.hls,t=e.media;if(!t)return 1/0;var i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i},n.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},n.findBestLevel=function(e,t,i,s,l,u,f){var d,h=this,c=s+l,v=this.lastLoadedFragLevel,g=v===-1?this.hls.firstLevel:v,m=this.fragCurrent,y=this.partCurrent,E=this.hls,T=E.levels,S=E.allAudioTracks,x=E.loadLevel,A=E.config;if(T.length===1)return 0;var L=T[g],_=!!((d=this.hls.latestLevelDetails)!=null&&d.live),k=x===-1||v===-1,R,b="SDR",D=(L==null?void 0:L.frameRate)||0,C=A.audioPreference,N=A.videoPreference,O=this.audioTracksByGroup||(this.audioTracksByGroup=Ls(S)),M=-1;if(k){if(this.firstSelection!==-1)return this.firstSelection;var G=this.codecTiers||(this.codecTiers=Ql(T,O,t,i)),Y=on(G,b,e,C,N),W=Y.codecSet,ie=Y.videoRanges,xe=Y.minFramerate,ue=Y.minBitrate,_e=Y.minIndex,ge=Y.preferHDR;M=_e,R=W,b=ge?ie[ie.length-1]:ie[0],D=xe,e=Math.max(e,ue),this.log("picked start tier "+Ge(Y))}else R=L==null?void 0:L.codecSet,b=L==null?void 0:L.videoRange;for(var ke=y?y.duration:m?m.duration:0,Ce=this.bwEstimator.getEstimateTTFB()/1e3,Be=[],tt=function(){var je,ye=T[Ye],Tt=Ye>g;if(!ye)return 0;if(A.useMediaCapabilities&&!ye.supportedResult&&!ye.supportedPromise){var vt=navigator.mediaCapabilities;typeof(vt==null?void 0:vt.decodingInfo)=="function"&&(aa(ye,O,b,D,e,C)||$r(ye.videoCodec))?(ye.supportedPromise=tn(ye,O,vt),ye.supportedPromise.then(function(zt){if(h.hls){ye.supportedResult=zt;var ui=h.hls.levels,ir=ui.indexOf(ye);zt.error?h.warn('MediaCapabilities decodingInfo error: "'+zt.error+'" for level '+ir+" "+Ge(zt)):zt.supported||(h.warn("Unsupported MediaCapabilities decodingInfo result for level "+ir+" "+Ge(zt)),ir>-1&&ui.length>1&&(h.log("Removing unsupported level "+ir),h.hls.removeLevel(ir),h.hls.loadLevel===-1&&(h.hls.nextLoadLevel=0)))}})):ye.supportedResult=Ji}if((R&&ye.codecSet!==R||b&&ye.videoRange!==b||Tt&&D>ye.frameRate||!Tt&&D>0&&D<ye.frameRate||ye.supportedResult&&!((je=ye.supportedResult.decodingInfoResults)!=null&&je[0].smooth))&&(!k||Ye!==M))return Be.push(Ye),0;var ft=ye.details,Qe=(y?ft==null?void 0:ft.partTarget:ft==null?void 0:ft.averagetargetduration)||ke,St;Tt?St=f*e:St=u*e;var Xe=ke&&s>=ke*2&&l===0?ye.averageBitrate:ye.maxBitrate,it=h.getTimeToLoadFrag(Ce,St,Xe*Qe,ft===void 0),dr=St>=Xe&&(Ye===v||ye.loadError===0&&ye.fragmentError===0)&&(it<=Ce||!U(it)||_&&!h.bitrateTestDelay||it<c);if(dr){var Ir=h.forcedAutoLevel;return Ye!==x&&(Ir===-1||Ir!==x)&&(Be.length&&h.trace("Skipped level(s) "+Be.join(",")+" of "+i+' max with CODECS and VIDEO-RANGE:"'+T[Be[0]].codecs+'" '+T[Be[0]].videoRange+'; not compatible with "'+R+'" '+b),h.info("switch candidate:"+g+"->"+Ye+" adjustedbw("+Math.round(St)+")-bitrate="+Math.round(St-Xe)+" ttfb:"+Ce.toFixed(1)+" avgDuration:"+Qe.toFixed(1)+" maxFetchDuration:"+c.toFixed(1)+" fetchDuration:"+it.toFixed(1)+" firstSelection:"+k+" codecSet:"+ye.codecSet+" videoRange:"+ye.videoRange+" hls.loadLevel:"+x)),k&&(h.firstSelection=Ye),{v:Ye}}},ze,Ye=i;Ye>=t;Ye--)if(ze=tt(),ze!==0&&ze)return ze.v;return-1},n.deriveNextAutoLevel=function(e){var t=this.hls,i=t.maxAutoLevel,s=t.minAutoLevel;return Math.min(Math.max(e,s),i)},oe(o,[{key:"firstAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.minAutoLevel,s=this.getBwEstimate(),l=this.hls.config.maxStarvationDelay,u=this.findBestLevel(s,i,t,0,l,1,1);if(u>-1)return u;var f=this.hls.firstLevel,d=Math.min(Math.max(f,i),t);return this.warn("Could not find best starting auto level. Defaulting to first in playlist "+f+" clamped to "+d),d}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var e=this.forcedAutoLevel,t=this.bwEstimator,i=t.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;var l=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){var u=this.hls.levels;if(u.length>Math.max(e,l)&&u[e].loadError<=u[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l},set:function(e){var t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}}])}(he),la={search:function(o,n){for(var r=0,e=o.length-1,t=null,i=null;r<=e;){t=(r+e)/2|0,i=o[t];var s=n(i);if(s>0)r=t+1;else if(s<0)e=t-1;else return i}return null}};function tu(a,o,n){if(o===null||!Array.isArray(a)||!a.length||!U(o))return null;var r=a[0].programDateTime;if(o<(r||0))return null;var e=a[a.length-1].endProgramDateTime;if(o>=(e||0))return null;n=n||0;for(var t=0;t<a.length;++t){var i=a[t];if(iu(o,n,i))return i}return null}function Kr(a,o,n,r,e){n===void 0&&(n=0),r===void 0&&(r=0),e===void 0&&(e=.005);var t=null;if(a){t=o[1+a.sn-o[0].sn]||null;var i=a.endDTS-n;i>0&&i<15e-7&&(n+=15e-7),t&&a.level!==t.level&&t.end<=a.end&&(t=o[2+a.sn-o[0].sn]||null)}else n===0&&o[0].start===0&&(t=o[0]);if(t&&((!a||a.level===t.level)&&Is(n,r,t)===0||ru(t,a,Math.min(e,r))))return t;var s=la.search(o,Is.bind(null,n,r));return s&&(s!==a||!t)?s:t}function ru(a,o,n){if(o&&o.start===0&&o.level<a.level&&(o.endPTS||0)>0){var r=o.tagList.reduce(function(e,t){return t[0]==="INF"&&(e+=parseFloat(t[1])),e},n);return a.start<=r}return!1}function Is(a,o,n){if(a===void 0&&(a=0),o===void 0&&(o=0),n.start<=a&&n.start+n.duration>a)return 0;var r=Math.min(o,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=a?1:n.start-r>a&&n.start?-1:0}function iu(a,o,n){var r=Math.min(o,n.duration+(n.deltaPTS?n.deltaPTS:0))*1e3,e=n.endProgramDateTime||0;return e-r>a}function _s(a,o){return la.search(a,function(n){return n.cc<o?1:n.cc>o?-1:0})}function nu(a,o,n){if(a&&a.startCC<=o&&a.endCC>=o){var r=n.start,e=n.end,t=a.fragments;if(!n.relurl){var i=a.fragmentHint;i&&(t=t.concat(i))}return la.search(t,function(s){return s.cc<o||s.end<=r?1:s.cc>o||s.start>=e?-1:0})}return null}function un(a){switch(a.details){case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_TIMEOUT:case I.LEVEL_LOAD_TIMEOUT:case I.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ds(a,o){var n=un(o);return a.default[(n?"timeout":"error")+"Retry"]}function ua(a,o){var n=a.backoff==="linear"?1:Math.pow(2,o);return Math.min(n*a.retryDelayMs,a.maxRetryDelayMs)}function ks(a){return ae(ae({},a),{errorRetry:null,timeoutRetry:null})}function fn(a,o,n,r){if(!a)return!1;var e=r==null?void 0:r.code,t=o<a.maxNumRetry&&(au(e)||!!n);return a.shouldRetry?a.shouldRetry(a,o,n,r,t):t}function au(a){return a===0&&navigator.onLine===!1||!!a&&(a<400||a>499)}var kt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},tr={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2},su=function(a){function o(r){var e;return e=a.call(this,"error-controller",r.logger)||this,e.hls=void 0,e.playlistError=0,e.penalizedRenditions={},e.hls=r,e.registerListeners(),e}j(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(p.ERROR,this.onError,this),e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.LEVEL_UPDATED,this.onLevelUpdated,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(p.ERROR,this.onError,this),e.off(p.ERROR,this.onErrorOut,this),e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.LEVEL_UPDATED,this.onLevelUpdated,this))},n.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},n.startLoad=function(e){},n.stopLoad=function(){this.playlistError=0},n.getVariantLevelIndex=function(e){return(e==null?void 0:e.type)===K.MAIN?e.level:this.hls.loadLevel},n.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},n.onLevelUpdated=function(){this.playlistError=0},n.onError=function(e,t){var i;if(!t.fatal){var s=this.hls,l=t.context;switch(t.details){case I.FRAG_LOAD_ERROR:case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_ERROR:case I.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case I.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=ki();return}case I.FRAG_GAP:case I.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=kt.SendAlternateToPenaltyBox;return}case I.LEVEL_EMPTY_ERROR:case I.LEVEL_PARSING_ERROR:{var u,f,d=t.parent===K.MAIN?t.level:s.loadLevel;t.details===I.LEVEL_EMPTY_ERROR&&((u=t.context)!=null&&(f=u.levelDetails)!=null&&f.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,d))}return;case I.LEVEL_LOAD_ERROR:case I.LEVEL_LOAD_TIMEOUT:typeof(l==null?void 0:l.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l.level));return;case I.AUDIO_TRACK_LOAD_ERROR:case I.AUDIO_TRACK_LOAD_TIMEOUT:case I.SUBTITLE_LOAD_ERROR:case I.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){var h=s.loadLevelObj;if(h&&(l.type===re.AUDIO_TRACK&&h.hasAudioGroup(l.groupId)||l.type===re.SUBTITLE_TRACK&&h.hasSubtitleGroup(l.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=kt.SendAlternateToPenaltyBox,t.errorAction.flags=tr.MoveAllAlternatesMatchingHost;return}}return;case I.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var c=s.loadLevelObj,v=c==null?void 0:c.attrs["HDCP-LEVEL"];v?t.errorAction={action:kt.SendAlternateToPenaltyBox,flags:tr.MoveAllAlternatesMatchingHDCP,hdcpLevel:v}:this.keySystemError(t)}return;case I.BUFFER_ADD_CODEC_ERROR:case I.REMUX_ALLOC_ERROR:case I.BUFFER_APPEND_ERROR:if(!t.errorAction){var g;t.errorAction=this.getLevelSwitchAction(t,(g=t.level)!=null?g:s.loadLevel)}return;case I.INTERNAL_EXCEPTION:case I.BUFFER_APPENDING_ERROR:case I.BUFFER_FULL_ERROR:case I.LEVEL_SWITCH_ERROR:case I.BUFFER_STALLED_ERROR:case I.BUFFER_SEEK_OVER_HOLE:case I.BUFFER_NUDGE_ON_STALL:t.errorAction=ki();return}t.type===B.KEY_SYSTEM_ERROR&&this.keySystemError(t)}},n.keySystemError=function(e){var t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)},n.getPlaylistRetryOrSwitchAction=function(e,t){var i=this.hls,s=Ds(i.config.playlistLoadPolicy,e),l=this.playlistError++,u=fn(s,l,un(e),e.response);if(u)return{action:kt.RetryRequest,flags:tr.None,retryConfig:s,retryCount:l};var f=this.getLevelSwitchAction(e,t);return s&&(f.retryConfig=s,f.retryCount=l),f},n.getFragRetryOrSwitchAction=function(e){var t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],l=t.config,u=l.fragLoadPolicy,f=l.keyLoadPolicy,d=Ds(e.details.startsWith("key")?f:u,e),h=t.levels.reduce(function(g,m){return g+m.fragmentError},0);if(s){e.details!==I.FRAG_GAP&&s.fragmentError++;var c=fn(d,h,un(e),e.response);if(c)return{action:kt.RetryRequest,flags:tr.None,retryConfig:d,retryCount:h}}var v=this.getLevelSwitchAction(e,i);return d&&(v.retryConfig=d,v.retryCount=h),v},n.getLevelSwitchAction=function(e,t){var i=this.hls;t==null&&(t=i.loadLevel);var s=this.hls.levels[t];if(s){var l,u,f=e.details;s.loadError++,f===I.BUFFER_APPEND_ERROR&&s.fragmentError++;var d=-1,h=i.levels,c=i.loadLevel,v=i.minAutoLevel,g=i.maxAutoLevel;i.autoLevelEnabled||(i.loadLevel=-1);for(var m=(l=e.frag)==null?void 0:l.type,y=m===K.AUDIO&&f===I.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===I.BUFFER_ADD_CODEC_ERROR||f===I.BUFFER_APPEND_ERROR),E=y&&h.some(function(b){var D=b.audioCodec;return s.audioCodec!==D}),T=e.sourceBufferName==="video"&&(f===I.BUFFER_ADD_CODEC_ERROR||f===I.BUFFER_APPEND_ERROR),S=T&&h.some(function(b){var D=b.codecSet,C=b.audioCodec;return s.codecSet!==D&&s.audioCodec===C}),x=(u=e.context)!=null?u:{},A=x.type,L=x.groupId,_=function(){var D=(R+c)%h.length;if(D!==c&&D>=v&&D<=g&&h[D].loadError===0){var C,N,O=h[D];if(f===I.FRAG_GAP&&m===K.MAIN&&e.frag){var M=h[D].details;if(M){var G=Kr(e.frag,M.fragments,e.frag.start);if(G!=null&&G.gap)return 0}}else{if(A===re.AUDIO_TRACK&&O.hasAudioGroup(L)||A===re.SUBTITLE_TRACK&&O.hasSubtitleGroup(L))return 0;if(m===K.AUDIO&&(C=s.audioGroups)!=null&&C.some(function(Y){return O.hasAudioGroup(Y)})||m===K.SUBTITLE&&(N=s.subtitleGroups)!=null&&N.some(function(Y){return O.hasSubtitleGroup(Y)})||E&&s.audioCodec===O.audioCodec||!E&&s.audioCodec!==O.audioCodec||S&&s.codecSet===O.codecSet)return 0}return d=D,1}},k,R=h.length;R--&&(k=_(),!(k!==0&&k===1)););if(d>-1&&i.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:kt.SendAlternateToPenaltyBox,flags:tr.None,nextAutoLevel:d}}return{action:kt.SendAlternateToPenaltyBox,flags:tr.MoveAllAlternatesMatchingHost}},n.onErrorOut=function(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case kt.DoNothing:break;case kt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==I.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'+t.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}},n.sendAlternateToPenaltyBox=function(e){var t=this.hls,i=e.errorAction;if(i){var s=i.flags,l=i.hdcpLevel,u=i.nextAutoLevel;switch(s){case tr.None:this.switchLevel(e,u);break;case tr.MoveAllAlternatesMatchingHDCP:l&&(t.maxHdcpLevel=Ri[Ri.indexOf(l)-1],i.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower');break}i.resolved||this.switchLevel(e,u)}},n.switchLevel=function(e,t){if(t!==void 0&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===I.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo"))for(var i=$i(e.mimeType),s=this.hls.levels,l=s.length;l--;)s[l][e.sourceBufferName+"Codec"]===i&&this.hls.removeLevel(l)},o}(he);function ki(a){var o={action:kt.DoNothing,flags:tr.None};return a&&(o.resolved=!0),o}var ut={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},ou=function(){function a(n){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=n,this._registerListeners()}var o=a.prototype;return o._registerListeners=function(){var r=this.hls;r.on(p.MANIFEST_LOADING,this.onManifestLoading,this),r.on(p.BUFFER_APPENDED,this.onBufferAppended,this),r.on(p.FRAG_BUFFERED,this.onFragBuffered,this),r.on(p.FRAG_LOADED,this.onFragLoaded,this)},o._unregisterListeners=function(){var r=this.hls;r.off(p.MANIFEST_LOADING,this.onManifestLoading,this),r.off(p.BUFFER_APPENDED,this.onBufferAppended,this),r.off(p.FRAG_BUFFERED,this.onFragBuffered,this),r.off(p.FRAG_LOADED,this.onFragLoaded,this)},o.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},o.getAppendedFrag=function(r,e){var t=this.activePartLists[e];if(t)for(var i=t.length;i--;){var s=t[i];if(!s)break;var l=s.end;if(s.start<=r&&l!==null&&r<=l)return s}return this.getBufferedFrag(r,e)},o.getBufferedFrag=function(r,e){return this.getFragAtPos(r,e,!0)},o.getFragAtPos=function(r,e,t){for(var i=this.fragments,s=Object.keys(i),l=s.length;l--;){var u=i[s[l]];if((u==null?void 0:u.body.type)===e&&(!t||u.buffered)){var f=u.body;if(f.start<=r&&r<=f.end)return f}}return null},o.detectEvictedFragments=function(r,e,t,i,s){var l=this;this.timeRanges&&(this.timeRanges[r]=e);var u=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(function(f){var d=l.fragments[f];if(d&&!(u>=d.body.sn)){if(!d.buffered&&(!d.loaded||s)){d.body.type===t&&l.removeFragment(d.body);return}var h=d.range[r];if(h){if(h.time.length===0){l.removeFragment(d.body);return}h.time.some(function(c){var v=!l.isTimeBuffered(c.startPTS,c.endPTS,e);return v&&l.removeFragment(d.body),v})}}})},o.detectPartialFragments=function(r){var e=this,t=this.timeRanges;if(!(!t||r.frag.sn==="initSegment")){var i=r.frag,s=ei(i),l=this.fragments[s];if(!(!l||l.buffered&&i.gap)){var u=!i.relurl;if(Object.keys(t).forEach(function(d){var h=i.elementaryStreams[d];if(h){var c=t[d],v=u||h.partial===!0;l.range[d]=e.getBufferedTimes(i,r.part,v,c)}}),l.loaded=null,Object.keys(l.range).length){l.buffered=!0;var f=l.body.endList=i.endList||l.body.endList;f&&(this.endListFragments[l.body.type]=l),dn(l)||this.removeParts(i.sn-1,i.type)}else this.removeFragment(l.body)}}},o.removeParts=function(r,e){var t=this.activePartLists[e];t&&(this.activePartLists[e]=Cs(t,function(i){return i.fragment.sn>=r}))},o.fragBuffered=function(r,e){var t=ei(r),i=this.fragments[t];!i&&e&&(i=this.fragments[t]={body:r,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},r.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},o.getBufferedTimes=function(r,e,t,i){for(var s={time:[],partial:t},l=r.start,u=r.end,f=r.minEndPTS||u,d=r.maxStartPTS||l,h=0;h<i.length;h++){var c=i.start(h)-this.bufferPadding,v=i.end(h)+this.bufferPadding;if(d>=c&&f<=v){s.time.push({startPTS:Math.max(l,i.start(h)),endPTS:Math.min(u,i.end(h))});break}else if(l<v&&u>c){var g=Math.max(l,i.start(h)),m=Math.min(u,i.end(h));m>g&&(s.partial=!0,s.time.push({startPTS:g,endPTS:m}))}else if(u<=c)break}return s},o.getPartialFragment=function(r){var e=null,t,i,s,l=0,u=this.bufferPadding,f=this.fragments;return Object.keys(f).forEach(function(d){var h=f[d];h&&dn(h)&&(i=h.body.start-u,s=h.body.end+u,r>=i&&r<=s&&(t=Math.min(r-i,s-r),l<=t&&(e=h.body,l=t)))}),e},o.isEndListAppended=function(r){var e=this.endListFragments[r];return e!==void 0&&(e.buffered||dn(e))},o.getState=function(r){var e=ei(r),t=this.fragments[e];return t?t.buffered?dn(t)?ut.PARTIAL:ut.OK:ut.APPENDING:ut.NOT_LOADED},o.isTimeBuffered=function(r,e,t){for(var i,s,l=0;l<t.length;l++){if(i=t.start(l)-this.bufferPadding,s=t.end(l)+this.bufferPadding,r>=i&&e<=s)return!0;if(e<=i)return!1}return!1},o.onManifestLoading=function(){this.removeAllFragments()},o.onFragLoaded=function(r,e){if(!(e.frag.sn==="initSegment"||e.frag.bitrateTest)){var t=e.frag,i=e.part?null:e,s=ei(t);this.fragments[s]={body:t,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}},o.onBufferAppended=function(r,e){var t=e.frag,i=e.part,s=e.timeRanges,l=e.type;if(t.sn!=="initSegment"){var u=t.type;if(i){var f=this.activePartLists[u];f||(this.activePartLists[u]=f=[]),f.push(i)}this.timeRanges=s;var d=s[l];this.detectEvictedFragments(l,d,u,i)}},o.onFragBuffered=function(r,e){this.detectPartialFragments(e)},o.hasFragment=function(r){var e=ei(r);return!!this.fragments[e]},o.hasFragments=function(r){var e=this.fragments,t=Object.keys(e);if(!r)return t.length>0;for(var i=t.length;i--;){var s=e[t[i]];if((s==null?void 0:s.body.type)===r)return!0}return!1},o.hasParts=function(r){var e;return!!((e=this.activePartLists[r])!=null&&e.length)},o.removeFragmentsInRange=function(r,e,t,i,s){var l=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach(function(u){var f=l.fragments[u];if(f){var d=f.body;d.type!==t||i&&!d.gap||d.start<e&&d.end>r&&(f.buffered||s)&&l.removeFragment(d)}})},o.removeFragment=function(r){var e=ei(r);r.clearElementaryStreamInfo();var t=this.activePartLists[r.type];if(t){var i=r.sn;this.activePartLists[r.type]=Cs(t,function(s){return s.fragment.sn!==i})}delete this.fragments[e],r.endList&&delete this.endListFragments[r.type]},o.removeAllFragments=function(){var r,e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;var t=(r=this.hls)==null||(e=r.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(function(i){return i.clearElementaryStreamInfo()})},a}();function dn(a){var o,n,r;return a.buffered&&(a.body.gap||((o=a.range.video)==null?void 0:o.partial)||((n=a.range.audio)==null?void 0:n.partial)||((r=a.range.audiovideo)==null?void 0:r.partial))}function ei(a){return a.type+"_"+a.level+"_"+a.sn}function Cs(a,o){return a.filter(function(n){var r=o(n);return r||n.clearElementaryStreamInfo(),r})}var Lr={cbc:0,ctr:1},lu=function(){function a(n,r,e){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=n,this.aesIV=r,this.aesMode=e}var o=a.prototype;return o.decrypt=function(r,e){switch(this.aesMode){case Lr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,r);case Lr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,r);default:throw new Error("[AESCrypto] invalid aes mode "+this.aesMode)}},a}();function uu(a){var o=a.byteLength,n=o&&new DataView(a.buffer).getUint8(o-1);return n?a.slice(0,o-n):a}var fu=function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var o=a.prototype;return o.uint8ArrayToUint32Array_=function(r){for(var e=new DataView(r),t=new Uint32Array(4),i=0;i<4;i++)t[i]=e.getUint32(i*4);return t},o.initTable=function(){var r=this.sBox,e=this.invSBox,t=this.subMix,i=t[0],s=t[1],l=t[2],u=t[3],f=this.invSubMix,d=f[0],h=f[1],c=f[2],v=f[3],g=new Uint32Array(256),m=0,y=0,E=0;for(E=0;E<256;E++)E<128?g[E]=E<<1:g[E]=E<<1^283;for(E=0;E<256;E++){var T=y^y<<1^y<<2^y<<3^y<<4;T=T>>>8^T&255^99,r[m]=T,e[T]=m;var S=g[m],x=g[S],A=g[x],L=g[T]*257^T*16843008;i[m]=L<<24|L>>>8,s[m]=L<<16|L>>>16,l[m]=L<<8|L>>>24,u[m]=L,L=A*16843009^x*65537^S*257^m*16843008,d[T]=L<<24|L>>>8,h[T]=L<<16|L>>>16,c[T]=L<<8|L>>>24,v[T]=L,m?(m=S^g[g[g[A^S]]],y^=g[g[y]]):m=y=1}},o.expandKey=function(r){for(var e=this.uint8ArrayToUint32Array_(r),t=!0,i=0;i<e.length&&t;)t=e[i]===this.key[i],i++;if(!t){this.key=e;var s=this.keySize=e.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);var l=this.ksRows=(s+6+1)*4,u,f,d=this.keySchedule=new Uint32Array(l),h=this.invKeySchedule=new Uint32Array(l),c=this.sBox,v=this.rcon,g=this.invSubMix,m=g[0],y=g[1],E=g[2],T=g[3],S,x;for(u=0;u<l;u++){if(u<s){S=d[u]=e[u];continue}x=S,u%s===0?(x=x<<8|x>>>24,x=c[x>>>24]<<24|c[x>>>16&255]<<16|c[x>>>8&255]<<8|c[x&255],x^=v[u/s|0]<<24):s>6&&u%s===4&&(x=c[x>>>24]<<24|c[x>>>16&255]<<16|c[x>>>8&255]<<8|c[x&255]),d[u]=S=(d[u-s]^x)>>>0}for(f=0;f<l;f++)u=l-f,f&3?x=d[u]:x=d[u-4],f<4||u<=4?h[f]=x:h[f]=m[c[x>>>24]]^y[c[x>>>16&255]]^E[c[x>>>8&255]]^T[c[x&255]],h[f]=h[f]>>>0}},o.networkToHostOrderSwap=function(r){return r<<24|(r&65280)<<8|(r&16711680)>>8|r>>>24},o.decrypt=function(r,e,t){for(var i=this.keySize+6,s=this.invKeySchedule,l=this.invSBox,u=this.invSubMix,f=u[0],d=u[1],h=u[2],c=u[3],v=this.uint8ArrayToUint32Array_(t),g=v[0],m=v[1],y=v[2],E=v[3],T=new Int32Array(r),S=new Int32Array(T.length),x,A,L,_,k,R,b,D,C,N,O,M,G,Y,W=this.networkToHostOrderSwap;e<T.length;){for(C=W(T[e]),N=W(T[e+1]),O=W(T[e+2]),M=W(T[e+3]),k=C^s[0],R=M^s[1],b=O^s[2],D=N^s[3],G=4,Y=1;Y<i;Y++)x=f[k>>>24]^d[R>>16&255]^h[b>>8&255]^c[D&255]^s[G],A=f[R>>>24]^d[b>>16&255]^h[D>>8&255]^c[k&255]^s[G+1],L=f[b>>>24]^d[D>>16&255]^h[k>>8&255]^c[R&255]^s[G+2],_=f[D>>>24]^d[k>>16&255]^h[R>>8&255]^c[b&255]^s[G+3],k=x,R=A,b=L,D=_,G=G+4;x=l[k>>>24]<<24^l[R>>16&255]<<16^l[b>>8&255]<<8^l[D&255]^s[G],A=l[R>>>24]<<24^l[b>>16&255]<<16^l[D>>8&255]<<8^l[k&255]^s[G+1],L=l[b>>>24]<<24^l[D>>16&255]<<16^l[k>>8&255]<<8^l[R&255]^s[G+2],_=l[D>>>24]<<24^l[k>>16&255]<<16^l[R>>8&255]<<8^l[b&255]^s[G+3],S[e]=W(x^g),S[e+1]=W(_^m),S[e+2]=W(L^y),S[e+3]=W(A^E),g=C,m=N,y=O,E=M,e=e+4}return S.buffer},a}(),du=function(){function a(n,r,e){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=n,this.key=r,this.aesMode=e}var o=a.prototype;return o.expandKey=function(){var r=hu(this.aesMode);return this.subtle.importKey("raw",this.key,{name:r},!1,["encrypt","decrypt"])},a}();function hu(a){switch(a){case Lr.cbc:return"AES-CBC";case Lr.ctr:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode "+a)}}var cu=16,fa=function(){function a(n,r){var e=r===void 0?{}:r,t=e.removePKCS7Padding,i=t===void 0?!0:t;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=n.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var o=a.prototype;return o.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},o.isSync=function(){return this.useSoftware},o.flush=function(){var r=this.currentResult,e=this.remainderData;if(!r||e)return this.reset(),null;var t=new Uint8Array(r);return this.reset(),this.removePKCS7Padding?uu(t):t},o.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},o.decrypt=function(r,e,t,i){var s=this;return this.useSoftware?new Promise(function(l,u){var f=ArrayBuffer.isView(r)?r:new Uint8Array(r);s.softwareDecrypt(f,e,t,i);var d=s.flush();d?l(d.buffer):u(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(r),e,t,i)},o.softwareDecrypt=function(r,e,t,i){var s=this.currentIV,l=this.currentResult,u=this.remainderData;if(i!==Lr.cbc||e.byteLength!==16)return le.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(r=_t(u,r),this.remainderData=null);var f=this.getValidChunk(r);if(!f.length)return null;s&&(t=s);var d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new fu),d.expandKey(e);var h=l;return this.currentResult=d.decrypt(f.buffer,0,t),this.currentIV=f.slice(-16).buffer,h||null},o.webCryptoDecrypt=function(r,e,t,i){var s=this;if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(r,e,t,i));this.key=e,this.fastAesKey=new du(this.subtle,e,i)}return this.fastAesKey.expandKey().then(function(l){if(!s.subtle)return Promise.reject(new Error("web crypto not initialized"));s.logOnce("WebCrypto AES decrypt");var u=new lu(s.subtle,new Uint8Array(t),i);return u.decrypt(r.buffer,l)}).catch(function(l){return le.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+l.name+": "+l.message),s.onWebCryptoError(r,e,t,i)})},o.onWebCryptoError=function(r,e,t,i){var s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(r,e,t,i);var l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")},o.getValidChunk=function(r){var e=r,t=r.length-r.length%cu;return t!==r.length&&(e=r.slice(0,t),this.remainderData=r.slice(t)),e},o.logOnce=function(r){this.logEnabled&&(le.log("[decrypter]: "+r),this.logEnabled=!1)},a}(),Ps=Math.pow(2,17),vu=function(){function a(n){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=n}var o=a.prototype;return o.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},o.abort=function(){this.loader&&this.loader.abort()},o.load=function(r,e){var t=this,i=r.url;if(!i)return Promise.reject(new gr({type:B.NETWORK_ERROR,details:I.FRAG_LOAD_ERROR,fatal:!1,frag:r,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var s=this.config,l=s.fLoader,u=s.loader;return new Promise(function(f,d){if(t.loader&&t.loader.destroy(),r.gap)if(r.tagList.some(function(y){return y[0]==="GAP"})){d(Ms(r));return}else r.gap=!1;var h=t.loader=l?new l(s):new u(s),c=ws(r);r.loader=h;var v=ks(s.fragLoadPolicy.default),g={loadPolicy:v,timeout:v.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:r.sn==="initSegment"?1/0:Ps};r.stats=h.stats;var m={onSuccess:function(E,T,S,x){t.resetLoader(r,h);var A=E.data;S.resetIV&&r.decryptdata&&(r.decryptdata.iv=new Uint8Array(A.slice(0,16)),A=A.slice(16)),f({frag:r,part:null,payload:A,networkDetails:x})},onError:function(E,T,S,x){t.resetLoader(r,h),d(new gr({type:B.NETWORK_ERROR,details:I.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:ae({url:i,data:void 0},E),error:new Error("HTTP Error "+E.code+" "+E.text),networkDetails:S,stats:x}))},onAbort:function(E,T,S){t.resetLoader(r,h),d(new gr({type:B.NETWORK_ERROR,details:I.INTERNAL_ABORTED,fatal:!1,frag:r,error:new Error("Aborted"),networkDetails:S,stats:E}))},onTimeout:function(E,T,S){t.resetLoader(r,h),d(new gr({type:B.NETWORK_ERROR,details:I.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:S,stats:E}))}};e&&(m.onProgress=function(y,E,T,S){return e({frag:r,part:null,payload:T,networkDetails:S})}),h.load(c,g,m)})},o.loadPart=function(r,e,t){var i=this;this.abort();var s=this.config,l=s.fLoader,u=s.loader;return new Promise(function(f,d){if(i.loader&&i.loader.destroy(),r.gap||e.gap){d(Ms(r,e));return}var h=i.loader=l?new l(s):new u(s),c=ws(r,e);r.loader=h;var v=ks(s.fragLoadPolicy.default),g={loadPolicy:v,timeout:v.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ps};e.stats=h.stats,h.load(c,g,{onSuccess:function(y,E,T,S){i.resetLoader(r,h),i.updateStatsFromPart(r,e);var x={frag:r,part:e,payload:y.data,networkDetails:S};t(x),f(x)},onError:function(y,E,T,S){i.resetLoader(r,h),d(new gr({type:B.NETWORK_ERROR,details:I.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:e,response:ae({url:c.url,data:void 0},y),error:new Error("HTTP Error "+y.code+" "+y.text),networkDetails:T,stats:S}))},onAbort:function(y,E,T){r.stats.aborted=e.stats.aborted,i.resetLoader(r,h),d(new gr({type:B.NETWORK_ERROR,details:I.INTERNAL_ABORTED,fatal:!1,frag:r,part:e,error:new Error("Aborted"),networkDetails:T,stats:y}))},onTimeout:function(y,E,T){i.resetLoader(r,h),d(new gr({type:B.NETWORK_ERROR,details:I.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:e,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:T,stats:y}))}})})},o.updateStatsFromPart=function(r,e){var t=r.stats,i=e.stats,s=i.total;if(t.loaded+=i.loaded,s){var l=Math.round(r.duration/e.duration),u=Math.min(Math.round(t.loaded/s),l),f=l-u,d=f*Math.round(t.loaded/u);t.total=t.loaded+d}else t.total=Math.max(t.loaded,t.total);var h=t.loading,c=i.loading;h.start?h.first+=c.first-c.start:(h.start=c.start,h.first=c.first),h.end=c.end},o.resetLoader=function(r,e){r.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},a}();function ws(a,o){o===void 0&&(o=null);var n=o||a,r={frag:a,part:o,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},e=n.byteRangeStartOffset,t=n.byteRangeEndOffset;if(U(e)&&U(t)){var i,s=e,l=t;if(a.sn==="initSegment"&&gu((i=a.decryptdata)==null?void 0:i.method)){var u=t-e;u%16&&(l=t+(16-u%16)),e!==0&&(r.resetIV=!0,s=e-16)}r.rangeStart=s,r.rangeEnd=l}return r}function Ms(a,o){var n=new Error("GAP "+(a.gap?"tag":"attribute")+" found"),r={type:B.MEDIA_ERROR,details:I.FRAG_GAP,fatal:!1,frag:a,error:n,networkDetails:null};return o&&(r.part=o),(o||a).stats.aborted=!0,new gr(r)}function gu(a){return a==="AES-128"||a==="AES-256"}var gr=function(a){function o(n){var r;return r=a.call(this,n.error.message)||this,r.data=void 0,r.data=n,r}return j(o,a),o}(at(Error)),Os=function(a){function o(r,e){var t;return t=a.call(this,r,e)||this,t._boundTick=void 0,t._tickTimer=null,t._tickInterval=null,t._tickCallCount=0,t._boundTick=t.tick.bind(t),t}j(o,a);var n=o.prototype;return n.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},n.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},n.onHandlerDestroyed=function(){},n.hasInterval=function(){return!!this._tickInterval},n.hasNextTick=function(){return!!this._tickTimer},n.setInterval=function(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},n.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},n.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},n.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},n.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},n.doTick=function(){},o}(he),da=function(o,n,r,e,t,i){e===void 0&&(e=0),t===void 0&&(t=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=hn(),this.buffering={audio:hn(),video:hn(),audiovideo:hn()},this.level=o,this.sn=n,this.id=r,this.size=e,this.part=t,this.partial=i};function hn(){return{start:0,executeStart:0,executeEnd:0,end:0}}var Fs={length:0,start:function(){return 0},end:function(){return 0}},Ie=function(){function a(){}return a.isBuffered=function(n,r){if(n){for(var e=a.getBuffered(n),t=e.length;t--;)if(r>=e.start(t)&&r<=e.end(t))return!0}return!1},a.bufferedRanges=function(n){if(n){var r=a.getBuffered(n);return a.timeRangesToArray(r)}return[]},a.timeRangesToArray=function(n){for(var r=[],e=0;e<n.length;e++)r.push({start:n.start(e),end:n.end(e)});return r},a.bufferInfo=function(n,r,e){if(n){var t=a.bufferedRanges(n);if(t.length)return a.bufferedInfo(t,r,e)}return{len:0,start:r,end:r,bufferedIndex:-1}},a.bufferedInfo=function(n,r,e){r=Math.max(0,r),n.length>1&&n.sort(function(y,E){return y.start-E.start||E.end-y.end});var t=-1,i=[];if(e)for(var s=0;s<n.length;s++){r>=n[s].start&&r<=n[s].end&&(t=s);var l=i.length;if(l){var u=i[l-1].end;n[s].start-u<e?n[s].end>u&&(i[l-1].end=n[s].end):i.push(n[s])}else i.push(n[s])}else i=n;for(var f=0,d,h=r,c=r,v=0;v<i.length;v++){var g=i[v].start,m=i[v].end;if(t===-1&&r>=g&&r<=m&&(t=v),r+e>=g&&r<m)h=g,c=m,f=c-r;else if(r+e<g){d=g;break}}return{len:f,start:h||0,end:c||0,nextStart:d,buffered:n,bufferedIndex:t}},a.getBuffered=function(n){try{return n.buffered||Fs}catch(r){return le.log("failed to get media.buffered",r),Fs}},a}(),Ns=/\{\$([a-zA-Z0-9-_]+)\}/g;function Us(a){return Ns.test(a)}function ha(a,o){if(a.variableList!==null||a.hasVariableRefs){var n=a.variableList;return o.replace(Ns,function(r){var e=r.substring(2,r.length-1),t=n==null?void 0:n[e];return t===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+e+'"')),r):t})}return o}function Bs(a,o,n){var r=a.variableList;r||(a.variableList=r={});var e,t;if("QUERYPARAM"in o){e=o.QUERYPARAM;try{var i=new self.URL(n).searchParams;if(i.has(e))t=i.get(e);else throw new Error('"'+e+'" does not match any query parameter in URI: "'+n+'"')}catch(s){a.playlistParsingError||(a.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+s.message))}}else e=o.NAME,t=o.VALUE;e in r?a.playlistParsingError||(a.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+e+'"')):r[e]=t||""}function mu(a,o,n){var r=o.IMPORT;if(n&&r in n){var e=a.variableList;e||(a.variableList=e={}),e[r]=n[r]}else a.playlistParsingError||(a.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+r+'"'))}var pu=/^(\d+)x(\d+)$/,Gs=/(.+?)=(".*?"|.*?)(?:,|$)/g,et=function(){function a(n,r){typeof n=="string"&&(n=a.parseAttrList(n,r)),ne(this,n)}var o=a.prototype;return o.decimalInteger=function(r){var e=parseInt(this[r],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},o.hexadecimalInteger=function(r){if(this[r]){var e=(this[r]||"0x").slice(2);e=(e.length&1?"0":"")+e;for(var t=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)t[i]=parseInt(e.slice(i*2,i*2+2),16);return t}return null},o.hexadecimalIntegerAsNumber=function(r){var e=parseInt(this[r],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},o.decimalFloatingPoint=function(r){return parseFloat(this[r])},o.optionalFloat=function(r,e){var t=this[r];return t?parseFloat(t):e},o.enumeratedString=function(r){return this[r]},o.enumeratedStringList=function(r,e){var t=this[r];return(t?t.split(/[ ,]+/):[]).reduce(function(i,s){return i[s.toLowerCase()]=!0,i},e)},o.bool=function(r){return this[r]==="YES"},o.decimalResolution=function(r){var e=pu.exec(this[r]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},a.parseAttrList=function(r,e){var t,i={},s='"';for(Gs.lastIndex=0;(t=Gs.exec(r))!==null;){var l=t[1].trim(),u=t[2],f=u.indexOf(s)===0&&u.lastIndexOf(s)===u.length-1,d=!1;if(f)u=u.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(e&&(f||d))u=ha(e,u);else if(!d&&!f)switch(l){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":le.warn(r+": attribute "+l+" is missing quotes")}i[l]=u}return i},oe(a,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(r){return r.substring(0,2)==="X-"})}}])}(),yu="com.apple.hls.interstitial";function Eu(a){return a!=="ID"&&a!=="CLASS"&&a!=="CUE"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function Tu(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}var Ks=function(){function a(o,n,r){var e;if(r===void 0&&(r=0),this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(n==null?void 0:n.tagAnchor)||null,this.tagOrder=(e=n==null?void 0:n.tagOrder)!=null?e:r,n){var t=n.attr;for(var i in t)if(Object.prototype.hasOwnProperty.call(o,i)&&o[i]!==t[i]){le.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+o.ID+'"'),this._badValueForSameId=i;break}o=ne(new et({}),t,o)}if(this.attr=o,n?(this._startDate=n._startDate,this._cue=n._cue,this._endDate=n._endDate,this._dateAtEnd=n._dateAtEnd):this._startDate=new Date(o["START-DATE"]),"END-DATE"in this.attr){var s=(n==null?void 0:n.endDate)||new Date(this.attr["END-DATE"]);U(s.getTime())&&(this._endDate=s)}}return oe(a,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"cue",get:function(){var n=this._cue;return n===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):n}},{key:"startTime",get:function(){var n=this.tagAnchor;return n===null||n.programDateTime===null?(le.warn('Expected tagAnchor Fragment with PDT set for DateRange "'+this.id+'": '+n),NaN):n.start+(this.startDate.getTime()-n.programDateTime)/1e3}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var n=this._endDate||this._dateAtEnd;if(n)return n;var r=this.duration;return r!==null?this._dateAtEnd=new Date(this._startDate.getTime()+r*1e3):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var n=this.attr.decimalFloatingPoint("DURATION");if(U(n))return n}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isInterstitial",get:function(){return this.class===yu}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&U(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}])}(),Su=10,xu=function(){function a(n){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=n}var o=a.prototype;return o.reloaded=function(r){if(!r){this.advanced=!0,this.updated=!0;return}var e=this.lastPartSn-r.lastPartSn,t=this.lastPartIndex-r.lastPartIndex;this.updated=this.endSN!==r.endSN||!!t||!!e||!this.live,this.advanced=this.endSN>r.endSN||e>0||e===0&&t>0,this.updated||this.advanced?this.misses=Math.floor(r.misses*.6):this.misses=r.misses+1},oe(a,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?U(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||Su}},{key:"drift",get:function(){var r=this.driftEndTime-this.driftStartTime;if(r>0){var e=this.driftEnd-this.driftStart;return e*1e3/r}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var r;return(r=this.fragments)!=null&&r.length?this.fragments[this.fragments.length-1].end:0}},{key:"fragmentStart",get:function(){var r;return(r=this.fragments)!=null&&r.length?this.fragments[0].start:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].index:-1}},{key:"maxPartIndex",get:function(){var r=this.partList;if(r){var e=this.lastPartIndex;if(e!==-1){for(var t=r.length;t--;)if(r[t].index>e)return r[t].index;return e}}return 0}},{key:"lastPartSn",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}},{key:"expired",get:function(){if(this.live&&this.age&&this.misses<3){var r=this.partEnd-this.fragmentStart;return this.age>Math.max(r,this.totalduration)+this.levelTargetDuration}return!1}}])}();function ti(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function ca(a){switch(a){case"AES-128":case"AES-256":return Lr.cbc;case"AES-256-CTR":return Lr.ctr;default:throw new Error("invalid full segment method "+a)}}function va(a){return Uint8Array.from(atob(a),function(o){return o.charCodeAt(0)})}function ga(a){return Uint8Array.from(unescape(encodeURIComponent(a)),function(o){return o.charCodeAt(0)})}function Au(a){var o=ga(a).subarray(0,16),n=new Uint8Array(16);return n.set(o,16-o.length),n}function Lu(a){var o=function(r,e,t){var i=r[e];r[e]=r[t],r[t]=i};o(a,0,3),o(a,1,2),o(a,4,5),o(a,6,7)}function bu(a){var o=a.split(":"),n=null;if(o[0]==="data"&&o.length===2){var r=o[1].split(";"),e=r[r.length-1].split(",");if(e.length===2){var t=e[0]==="base64",i=e[1];t?(r.splice(-1,1),n=va(i)):n=Au(i)}}return n}var cn=typeof self<"u"?self:void 0,Fe={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ft={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ma(a){switch(a){case Ft.FAIRPLAY:return Fe.FAIRPLAY;case Ft.PLAYREADY:return Fe.PLAYREADY;case Ft.WIDEVINE:return Fe.WIDEVINE;case Ft.CLEARKEY:return Fe.CLEARKEY}}var vn={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function pa(a){if(a===vn.WIDEVINE)return Fe.WIDEVINE;if(a===vn.PLAYREADY)return Fe.PLAYREADY;if(a===vn.CENC||a===vn.CLEARKEY)return Fe.CLEARKEY}function ya(a){switch(a){case Fe.FAIRPLAY:return Ft.FAIRPLAY;case Fe.PLAYREADY:return Ft.PLAYREADY;case Fe.WIDEVINE:return Ft.WIDEVINE;case Fe.CLEARKEY:return Ft.CLEARKEY}}function gn(a){var o=a.drmSystems,n=a.widevineLicenseUrl,r=o?[Fe.FAIRPLAY,Fe.WIDEVINE,Fe.PLAYREADY,Fe.CLEARKEY].filter(function(e){return!!o[e]}):[];return!r[Fe.WIDEVINE]&&n&&r.push(Fe.WIDEVINE),r}var Hs=function(a){return cn!=null&&(a=cn.navigator)!=null&&a.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Ru(a,o,n,r){var e;switch(a){case Fe.FAIRPLAY:e=["cenc","sinf"];break;case Fe.WIDEVINE:case Fe.PLAYREADY:e=["cenc"];break;case Fe.CLEARKEY:e=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+a)}return Iu(e,o,n,r)}function Iu(a,o,n,r){var e={initDataTypes:a,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:o.map(function(t){return{contentType:"audio/mp4; codecs="+t,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null}}),videoCapabilities:n.map(function(t){return{contentType:"video/mp4; codecs="+t,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}})};return[e]}function _u(a){var o;return a.sessionType==="persistent-license"||!!((o=a.sessionTypes)!=null&&o.some(function(n){return n==="persistent-license"}))}function Vs(a){var o=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),n=String.fromCharCode.apply(null,Array.from(o)),r=n.substring(n.indexOf("<"),n.length),e=new DOMParser,t=e.parseFromString(r,"text/xml"),i=t.getElementsByTagName("KID")[0];if(i){var s=i.childNodes[0]?i.childNodes[0].nodeValue:i.getAttribute("VALUE");if(s){var l=va(s).subarray(0,16);return Lu(l),l}}return null}var mn={},Ea=function(){function a(n,r,e,t,i){t===void 0&&(t=[1]),i===void 0&&(i=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=n,this.uri=r,this.keyFormat=e,this.keyFormatVersions=t,this.iv=i,this.encrypted=n?n!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ti(n)}a.clearKeyUriToKeyIdMap=function(){mn={}};var o=a.prototype;return o.isSupported=function(){if(this.method){if(ti(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ft.FAIRPLAY:case Ft.WIDEVINE:case Ft.PLAYREADY:case Ft.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},o.getDecryptData=function(r){if(!this.encrypted||!this.uri)return null;if(ti(this.method)&&this.uri&&!this.iv){typeof r!="number"&&(le.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),r=0);var e=Du(r),t=new a(this.method,this.uri,"identity",this.keyFormatVersions,e);return t}var i=bu(this.uri);if(i)switch(this.keyFormat){case Ft.WIDEVINE:this.pssh=i,i.length>=22&&(this.keyId=i.subarray(i.length-22,i.length-6));break;case Ft.PLAYREADY:{var s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=zi(s,null,i),this.keyId=Vs(i);break}default:{var l=i.subarray(0,16);if(l.length!==16){var u=new Uint8Array(16);u.set(l,16-l.length),l=u}this.keyId=l;break}}if(!this.keyId||this.keyId.byteLength!==16){var f=mn[this.uri];if(!f){var d=Object.keys(mn).length%Number.MAX_SAFE_INTEGER;f=new Uint8Array(16);var h=new DataView(f.buffer,12,4);h.setUint32(0,d),mn[this.uri]=f}this.keyId=f}return this},a}();function Du(a){for(var o=new Uint8Array(16),n=12;n<16;n++)o[n]=a>>8*(15-n)&255;return o}var Ws=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Ys=/#EXT-X-MEDIA:(.*)/g,ku=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ta=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Cu=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Ci=function(){function a(){}return a.findGroup=function(n,r){for(var e=0;e<n.length;e++){var t=n[e];if(t.id===r)return t}},a.resolve=function(n,r){return Ee.buildAbsoluteURL(r,n,{alwaysNormalize:!0})},a.isMediaPlaylist=function(n){return ku.test(n)},a.parseMasterPlaylist=function(n,r){var e=Us(n),t={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:e},i=[];Ws.lastIndex=0;for(var s;(s=Ws.exec(n))!=null;)if(s[1]){var l,u=new et(s[1],t),f=ha(t,s[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:a.resolve(f,r)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),zs(u.CODECS,d);var c=u["SUPPLEMENTAL-CODECS"];c&&(d.supplemental={},zs(c,d.supplemental)),(l=d.unknownCodecs)!=null&&l.length||i.push(d),t.levels.push(d)}else if(s[3]){var v=s[3],g=s[4];switch(v){case"SESSION-DATA":{var m=new et(g,t),y=m["DATA-ID"];y&&(t.sessionData===null&&(t.sessionData={}),t.sessionData[y]=m);break}case"SESSION-KEY":{var E=js(g,r,t);E.encrypted&&E.isSupported()?(t.sessionKeys===null&&(t.sessionKeys=[]),t.sessionKeys.push(E)):le.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+g+'"');break}case"DEFINE":{{var T=new et(g,t);Bs(t,T,r)}break}case"CONTENT-STEERING":{var S=new et(g,t);t.contentSteering={uri:a.resolve(S["SERVER-URI"],r),pathwayId:S["PATHWAY-ID"]||"."};break}case"START":{t.startTimeOffset=Xs(g);break}}}var x=i.length>0&&i.length<t.levels.length;return t.levels=x?i:t.levels,t.levels.length===0&&(t.playlistParsingError=new Error("no levels found in manifest")),t},a.parseMasterPlaylistMedia=function(n,r,e){var t,i={},s=e.levels,l={AUDIO:s.map(function(x){return{id:x.attrs.AUDIO,audioCodec:x.audioCodec}}),SUBTITLES:s.map(function(x){return{id:x.attrs.SUBTITLES,textCodec:x.textCodec}}),"CLOSED-CAPTIONS":[]},u=0;for(Ys.lastIndex=0;(t=Ys.exec(n))!==null;){var f=new et(t[1],e),d=f.TYPE;if(d){var h=l[d],c=i[d]||[];i[d]=c;var v=f.LANGUAGE,g=f["ASSOC-LANGUAGE"],m=f.CHANNELS,y=f.CHARACTERISTICS,E=f["INSTREAM-ID"],T={attrs:f,bitrate:0,id:u++,groupId:f["GROUP-ID"]||"",name:f.NAME||v||"",type:d,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:v,url:f.URI?a.resolve(f.URI,r):""};if(g&&(T.assocLang=g),m&&(T.channels=m),y&&(T.characteristics=y),E&&(T.instreamId=E),h!=null&&h.length){var S=a.findGroup(h,T.groupId)||h[0];Qs(T,S,"audioCodec"),Qs(T,S,"textCodec")}c.push(T)}}return i},a.parseLevelPlaylist=function(n,r,e,t,i,s){var l,u={url:r},f=new xu(r),d=f.fragments,h=[],c=null,v=0,g=0,m=0,y=0,E=0,T=null,S=new ht(t,u),x,A,L,_=-1,k=!1,R=null,b;if(Ta.lastIndex=0,f.m3u8=n,f.hasVariableRefs=Us(n),((l=Ta.exec(n))==null?void 0:l[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(x=Ta.exec(n))!==null;){k&&(k=!1,S=new ht(t,u),S.playlistOffset=m,S.start=m,S.sn=v,S.cc=y,E&&(S.bitrate=E),S.level=e,c&&(S.initSegment=c,c.rawProgramDateTime&&(S.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null),R&&(S.setByteRange(R),R=null)));var D=x[1];if(D){S.duration=parseFloat(D);var C=(" "+x[2]).slice(1);S.title=C||null,S.tagList.push(C?["INF",D,C]:["INF",D])}else if(x[3]){if(U(S.duration)){S.playlistOffset=m,S.start=m,L&&Js(S,L,f),S.sn=v,S.level=e,S.cc=y,d.push(S);var N=(" "+x[3]).slice(1);S.relurl=ha(f,N),Sa(S,T,h),T=S,m+=S.duration,v++,g=0,k=!0}}else{if(x=x[0].match(Cu),!x){le.warn("No matches on slow regex match for level playlist!");continue}for(A=1;A<x.length&&x[A]===void 0;A++);var O=(" "+x[A]).slice(1),M=(" "+x[A+1]).slice(1),G=x[A+2]?(" "+x[A+2]).slice(1):null;switch(O){case"BYTERANGE":T?S.setByteRange(M,T):S.setByteRange(M);break;case"PROGRAM-DATE-TIME":S.rawProgramDateTime=M,S.tagList.push(["PROGRAM-DATE-TIME",M]),_===-1&&(_=d.length);break;case"PLAYLIST-TYPE":f.type&&mr(f,O,x),f.type=M.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?mr(f,O,x):d.length>0&&Zs(f,O,x),v=f.startSN=parseInt(M);break;case"SKIP":{f.skippedSegments&&mr(f,O,x);var Y=new et(M,f),W=Y.decimalInteger("SKIPPED-SEGMENTS");if(U(W)){f.skippedSegments+=W;for(var ie=W;ie--;)d.push(null);v+=W}var xe=Y.enumeratedString("RECENTLY-REMOVED-DATERANGES");xe&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(xe.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&mr(f,O,x),f.targetduration=Math.max(parseInt(M),1);break;case"VERSION":f.version!==null&&mr(f,O,x),f.version=parseInt(M);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||mr(f,O,x),f.live=!1;break;case"#":(M||G)&&S.tagList.push(G?[M,G]:[M]);break;case"DISCONTINUITY":y++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([O]);break;case"BITRATE":S.tagList.push([O,M]),E=parseInt(M)*1e3,U(E)?S.bitrate=E:E=0;break;case"DATERANGE":{var ue=new et(M,f),_e=new Ks(ue,f.dateRanges[ue.ID],f.dateRangeTagCount);f.dateRangeTagCount++,_e.isValid||f.skippedSegments?f.dateRanges[_e.id]=_e:le.warn('Ignoring invalid DATERANGE tag: "'+M+'"'),S.tagList.push(["EXT-X-DATERANGE",M]);break}case"DEFINE":{{var ge=new et(M,f);"IMPORT"in ge?mu(f,ge,s):Bs(f,ge,r)}break}case"DISCONTINUITY-SEQUENCE":f.startCC!==0?mr(f,O,x):d.length>0&&Zs(f,O,x),f.startCC=y=parseInt(M);break;case"KEY":{var ke=js(M,r,f);if(ke.isSupported()){if(ke.method==="NONE"){L=void 0;break}L||(L={}),L[ke.keyFormat]&&(L=ne({},L)),L[ke.keyFormat]=ke}else le.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+M+'"');break}case"START":f.startTimeOffset=Xs(M);break;case"MAP":{var Ce=new et(M,f);if(S.duration){var Be=new ht(t,u);$s(Be,Ce,e,L),c=Be,S.initSegment=c,c.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=c.rawProgramDateTime)}else{var tt=S.byteRangeEndOffset;if(tt){var ze=S.byteRangeStartOffset;R=tt-ze+"@"+ze}else R=null;$s(S,Ce,e,L),c=S,k=!0}c.cc=y;break}case"SERVER-CONTROL":{b&&mr(f,O,x),b=new et(M),f.canBlockReload=b.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=b.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&b.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=b.optionalFloat("PART-HOLD-BACK",0),f.holdBack=b.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&mr(f,O,x);var Ye=new et(M);f.partTarget=Ye.decimalFloatingPoint("PART-TARGET");break}case"PART":{var rt=f.partList;rt||(rt=f.partList=[]);var je=g>0?rt[rt.length-1]:void 0,ye=g++,Tt=new et(M,f),vt=new Rt(Tt,S,u,ye,je);rt.push(vt),S.duration+=vt.duration;break}case"PRELOAD-HINT":{var ft=new et(M,f);f.preloadHint=ft;break}case"RENDITION-REPORT":{var Qe=new et(M,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(Qe);break}default:le.warn("line parsed but not handled: "+x);break}}}T&&!T.relurl?(d.pop(),m-=T.duration,f.partList&&(f.fragmentHint=T)):f.partList&&(Sa(S,T,h),S.cc=y,f.fragmentHint=S,L&&Js(S,L,f)),f.targetduration||(f.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));var St=d.length,Xe=d[0],it=d[St-1];if(m+=f.skippedSegments*f.targetduration,m>0&&St&&it){f.averagetargetduration=m/St;var dr=it.sn;f.endSN=dr!=="initSegment"?dr:0,f.live||(it.endList=!0),Xe&&f.startCC===void 0&&(f.startCC=Xe.cc),_>0&&(wu(d,_),Xe&&h.unshift(Xe))}else f.endSN=0,f.startCC=0;return f.fragmentHint&&(m+=f.fragmentHint.duration),f.totalduration=m,h.length&&f.dateRangeTagCount&&Xe&&qs(h,f),f.endCC=y,f},a}();function qs(a,o){for(var n=a.length,r=a[n-1],e=o.live?1/0:o.totalduration,t=Object.keys(o.dateRanges),i=t.length;i--;){var s=o.dateRanges[t[i]],l=s.startDate.getTime();s.tagAnchor=r.ref;for(var u=n;u--;){var f=Pu(o,l,a,u,e);if(f!==-1){s.tagAnchor=o.fragments[f].ref;break}}}}function Pu(a,o,n,r,e){var t=n[r];if(t){var i=t.programDateTime;if(o>=i||r===0){var s,l=(((s=n[r+1])==null?void 0:s.start)||e)-t.start;if(o<=i+l*1e3){var u=n[r].sn-a.startSN,f=a.fragments;if(f.length>n.length)for(var d=n[r+1]||f[f.length-1],h=d.sn-a.startSN,c=h;c>u;c--){var v=f[c].programDateTime;if(o>=v&&o<v+f[c].duration*1e3)return c}return u}}}return-1}function js(a,o,n){var r,e,t=new et(a,n),i=(r=t.METHOD)!=null?r:"",s=t.URI,l=t.hexadecimalInteger("IV"),u=t.KEYFORMATVERSIONS,f=(e=t.KEYFORMAT)!=null?e:"identity";s&&t.IV&&!l&&le.error("Invalid IV: "+t.IV);var d=s?Ci.resolve(s,o):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Ea(i,d,f,h,l)}function Xs(a){var o=new et(a),n=o.decimalFloatingPoint("TIME-OFFSET");return U(n)?n:null}function zs(a,o){var n=(a||"").split(/[ ,]+/).filter(function(r){return r});["video","audio","text"].forEach(function(r){var e=n.filter(function(t){return nr(t,r)});e.length&&(o[r+"Codec"]=e.map(function(t){return t.split("/")[0]}).join(","),n=n.filter(function(t){return e.indexOf(t)===-1}))}),o.unknownCodecs=n}function Qs(a,o,n){var r=o[n];r&&(a[n]=r)}function wu(a,o){for(var n=a[o],r=o;r--;){var e=a[r];if(!e)return;e.programDateTime=n.programDateTime-e.duration*1e3,n=e}}function Sa(a,o,n){a.rawProgramDateTime?n.push(a):o!=null&&o.programDateTime&&(a.programDateTime=o.endProgramDateTime)}function $s(a,o,n,r){a.relurl=o.URI,o.BYTERANGE&&a.setByteRange(o.BYTERANGE),a.level=n,a.sn="initSegment",r&&(a.levelkeys=r),a.initSegment=null}function Js(a,o,n){a.levelkeys=o;var r=n.encryptedFragments;(!r.length||r[r.length-1].levelkeys!==o)&&Object.keys(o).some(function(e){return o[e].isCommonEncryption})&&r.push(a)}function mr(a,o,n){a.playlistParsingError=new Error("#EXT-X-"+o+" must not appear more than once ("+n[0]+")")}function Zs(a,o,n){a.playlistParsingError=new Error("#EXT-X-"+o+" must appear before the first Media Segment ("+n[0]+")")}function xa(a,o){var n=o.startPTS;if(U(n)){var r=0,e;o.sn>a.sn?(r=n-a.start,e=a):(r=a.start-n,e=o),e.duration!==r&&e.setDuration(r)}else if(o.sn>a.sn){var t=a.cc===o.cc;t&&a.minEndPTS?o.setStart(a.start+(a.minEndPTS-a.start)):o.setStart(a.start+a.duration)}else o.setStart(Math.max(a.start-o.duration,0))}function eo(a,o,n,r,e,t){var i=r-n;i<=0&&(le.warn("Fragment should have a positive duration",o),r=n+o.duration,t=e+o.duration);var s=n,l=r,u=o.startPTS,f=o.endPTS;if(U(u)){var d=Math.abs(u-n);U(o.deltaPTS)?o.deltaPTS=Math.max(d,o.deltaPTS):o.deltaPTS=d,s=Math.max(n,u),n=Math.min(n,u),e=Math.min(e,o.startDTS),l=Math.min(r,f),r=Math.max(r,f),t=Math.max(t,o.endDTS)}var h=n-o.start;o.start!==0&&o.setStart(n),o.setDuration(r-o.start),o.startPTS=n,o.maxStartPTS=s,o.startDTS=e,o.endPTS=r,o.minEndPTS=l,o.endDTS=t;var c=o.sn;if(!a||c<a.startSN||c>a.endSN)return 0;var v,g=c-a.startSN,m=a.fragments;for(m[g]=o,v=g;v>0;v--)xa(m[v],m[v-1]);for(v=g;v<m.length-1;v++)xa(m[v],m[v+1]);return a.fragmentHint&&xa(m[m.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,h}function Mu(a,o){if(a!==o){for(var n=null,r=a.fragments,e=r.length-1;e>=0;e--){var t=r[e].initSegment;if(t){n=t;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;var i;Nu(a,o,function(v,g,m,y){if(!o.startCC&&g.cc!==v.cc){for(var E,T,S=v.cc-g.cc,x=m;x<y.length;x++)y[x].cc+=S;o.startCC=(E=(T=no(a,o.startSN-1))==null?void 0:T.cc)!=null?E:y[0].cc,o.endCC=y[y.length-1].cc}U(v.startPTS)&&U(v.endPTS)&&(g.setStart(g.startPTS=v.startPTS),g.startDTS=v.startDTS,g.maxStartPTS=v.maxStartPTS,g.endPTS=v.endPTS,g.endDTS=v.endDTS,g.minEndPTS=v.minEndPTS,g.setDuration(v.endPTS-v.startPTS),g.duration&&(i=g),o.PTSKnown=o.alignedSliding=!0),v.hasStreams&&(g.elementaryStreams=v.elementaryStreams),g.loader=v.loader,v.hasStats&&(g.stats=v.stats),v.initSegment&&(g.initSegment=v.initSegment,n=v.initSegment)});var s=o.fragments,l=o.fragmentHint?s.concat(o.fragmentHint):s;if(n&&l.forEach(function(v){var g;v&&(!v.initSegment||v.initSegment.relurl===((g=n)==null?void 0:g.relurl))&&(v.initSegment=n)}),o.skippedSegments)if(o.deltaUpdateFailed=s.some(function(v){return!v}),o.deltaUpdateFailed){le.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=o.skippedSegments;u--;)s.shift();o.startSN=s[0].sn}else{o.endCC=s[s.length-1].cc,o.canSkipDateRanges&&(o.dateRanges=Ou(a.dateRanges,o));var f=a.fragments.filter(function(v){return v.rawProgramDateTime});if(a.hasProgramDateTime&&!o.hasProgramDateTime)for(var d=1;d<l.length;d++)l[d].programDateTime===null&&Sa(l[d],l[d-1],f);qs(f,o)}Fu(a.partList,o.partList,function(v,g){g.elementaryStreams=v.elementaryStreams,g.stats=v.stats}),i?eo(o,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):ro(a,o),s.length&&(o.totalduration=o.edge-s[0].start),o.driftStartTime=a.driftStartTime,o.driftStart=a.driftStart;var h=o.advancedDateTime;if(o.advanced&&h){var c=o.edge;o.driftStart||(o.driftStartTime=h,o.driftStart=c),o.driftEndTime=h,o.driftEnd=c}else o.driftEndTime=a.driftEndTime,o.driftEnd=a.driftEnd,o.advancedDateTime=a.advancedDateTime;o.requestScheduled===-1&&(o.requestScheduled=a.requestScheduled)}}function Ou(a,o){var n=o.dateRanges,r=o.recentlyRemovedDateranges,e=ne({},a);r&&r.forEach(function(s){delete e[s]});var t=Object.keys(e),i=t.length;return i&&Object.keys(n).forEach(function(s){var l=e[s],u=new Ks(n[s].attr,l);u.isValid?(e[s]=u,l||(u.tagOrder+=i)):le.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+Ge(n[s].attr)+'"')}),e}function Fu(a,o,n){if(a&&o)for(var r=0,e=0,t=a.length;e<=t;e++){var i=a[e],s=o[e+r];i&&s&&i.index===s.index&&i.fragment.sn===s.fragment.sn?n(i,s):r--}}function Nu(a,o,n){for(var r=o.skippedSegments,e=Math.max(a.startSN,o.startSN)-o.startSN,t=(a.fragmentHint?1:0)+(r?o.endSN:Math.min(a.endSN,o.endSN))-o.startSN,i=o.startSN-a.startSN,s=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,l=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,u=e;u<=t;u++){var f=l[i+u],d=s[u];if(r&&!d&&f&&(d=o.fragments[u]=f),f&&d){if(n(f,d,u,s),f.url&&f.url!==d.url){o.playlistParsingError=to("media sequence mismatch "+d.sn+":",a,o,f,d);return}else if(f.cc!==d.cc){o.playlistParsingError=to("discontinuity sequence mismatch ("+f.cc+"!="+d.cc+")",a,o,f,d);return}}}}function to(a,o,n,r,e){return new Error(a+" "+e.url+`
Playlist starting @`+o.startSN+`
`+o.m3u8+`

Playlist starting @`+n.startSN+`
`+n.m3u8)}function ro(a,o,n){n===void 0&&(n=!0);var r=o.startSN+o.skippedSegments-a.startSN,e=a.fragments,t=r>=0,i=0;if(t&&r<e.length)i=e[r].start;else if(t&&o.startSN===a.endSN+1)i=a.fragmentEnd;else if(t&&n)i=a.fragmentStart+r*o.levelTargetDuration;else if(!o.skippedSegments&&o.fragmentStart===0)i=a.fragmentStart;else return;Aa(o,i)}function Aa(a,o){if(o){for(var n=a.fragments,r=a.skippedSegments;r<n.length;r++)n[r].addStart(o);a.fragmentHint&&a.fragmentHint.addStart(o)}}function io(a,o){o===void 0&&(o=1/0);var n=1e3*a.targetduration;if(a.updated){var r=a.fragments,e=4;if(r.length&&n*e>o){var t=r[r.length-1].duration*1e3;t<n&&(n=t)}}else n/=2;return Math.round(n)}function no(a,o,n){if(!a)return null;var r=a.fragments[o-a.startSN];return r||(r=a.fragmentHint,r&&r.sn===o)?r:o<a.startSN&&n&&n.sn===o?n:null}function ao(a,o,n){return a?so(a.partList,o,n):null}function so(a,o,n){if(a)for(var r=a.length;r--;){var e=a[r];if(e.index===n&&e.fragment.sn===o)return e}return null}function oo(a){a.forEach(function(o,n){var r;(r=o.details)==null||r.fragments.forEach(function(e){e.level=n,e.initSegment&&(e.initSegment.level=n)})})}function Pi(a,o){for(var n=0,r=a.length;n<r;n++){var e;if(((e=a[n])==null?void 0:e.cc)===o)return a[n]}return null}function Uu(a,o){return!!(a&&o.startCC<a.endCC&&o.endCC>a.startCC)}function lo(a,o){if(a){var n=a.start+o;a.start=a.startPTS=n,a.endPTS=n+a.duration}}function uo(a,o){for(var n=o.fragments,r=0,e=n.length;r<e;r++)lo(n[r],a);o.fragmentHint&&lo(o.fragmentHint,a),o.alignedSliding=!0}function Bu(a,o){a&&(fo(o,a),!o.alignedSliding&&a&&pn(o,a),!o.alignedSliding&&a&&!o.skippedSegments&&ro(a,o,!1))}function fo(a,o){if(Uu(o,a)){var n=Math.min(o.endCC,a.endCC),r=Pi(o.fragments,n),e=Pi(a.fragments,n);if(!(!r||!e)){le.log("Aligning playlist at start of dicontinuity sequence "+n);var t=r.start-e.start;uo(t,a)}}}function pn(a,o){if(!(!a.hasProgramDateTime||!o.hasProgramDateTime)){var n=a.fragments,r=o.fragments;if(!(!n.length||!r.length)){var e,t,i=Math.min(o.endCC,a.endCC);o.startCC<i&&a.startCC<i&&(e=Pi(r,i),t=Pi(n,i)),(!e||!t)&&(e=r[Math.floor(r.length/2)],t=Pi(n,e.cc)||n[Math.floor(n.length/2)]);var s=e.programDateTime,l=t.programDateTime;if(!(!s||!l)){var u=(l-s)/1e3-(t.start-e.start);uo(u,a)}}}}var Gu={toString:function(o){for(var n="",r=o.length,e=0;e<r;e++)n+="["+o.start(e).toFixed(3)+"-"+o.end(e).toFixed(3)+"]";return n}},w={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},La=function(a){function o(r,e,t,i,s){var l;return l=a.call(this,i,r.logger)||this,l.hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=w.STOPPED,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.buffering=!0,l.loadingParts=!1,l.loopSn=void 0,l.onMediaSeeking=function(){var u=l,f=u.config,d=u.fragCurrent,h=u.media,c=u.mediaBuffer,v=u.state,g=h?h.currentTime:0,m=Ie.bufferInfo(c||h,g,f.maxBufferHole);if(l.log("media seeking to "+(U(g)?g.toFixed(3):g)+", state: "+v),l.state===w.ENDED)l.resetLoadingState();else if(d){var y=f.maxFragLookUpTolerance,E=d.start-y,T=d.start+d.duration+y;if(!m.len||T<m.start||E>m.end){var S=g>T;(g<E||S)&&(S&&d.loader&&(l.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),d.abortRequests(),l.resetLoadingState()),l.fragPrevious=null)}}if(h){l.fragmentTracker.removeFragmentsInRange(g,1/0,l.playlistType,!0);var x=l.lastCurrentTime;if(g>x&&(l.lastCurrentTime=g),!l.loadingParts){var A=Math.max(m.end,g),L=l.shouldLoadParts(l.getLevelDetails(),A);L&&(l.log("LL-Part loading ON after seeking to "+g.toFixed(2)+" with buffer @"+A.toFixed(2)),l.loadingParts=L)}}!l.hls.hasEnoughToStart&&!m.len&&(l.log("setting startPosition to "+g+" because of seek before start"),l.nextLoadPosition=l.startPosition=g),l.tickImmediate()},l.onMediaEnded=function(){l.log("setting startPosition to 0 because media ended"),l.startPosition=l.lastCurrentTime=0},l.playlistType=s,l.hls=r,l.fragmentLoader=new vu(r.config),l.keyLoader=t,l.fragmentTracker=e,l.config=r.config,l.decrypter=new fa(r.config),l}j(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(p.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(p.ERROR,this.onError,this)},n.doTick=function(){this.onTickEnd()},n.onTickEnd=function(){},n.startLoad=function(e){},n.stopLoad=function(){if(this.state!==w.STOPPED){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=w.STOPPED}},n.pauseBuffering=function(){this.buffering=!1},n.resumeBuffering=function(){this.buffering=!0},n._streamEnded=function(e,t){if(t.live||!this.media)return!1;var i=e.end||0,s=this.config.timelineOffset||0;if(i<=s)return!1;var l=e.nextStart,u=l&&l>s&&l<t.edge;if(u||this.media.currentTime<e.start)return!1;var f=t.partList;if(f!=null&&f.length){var d=f[f.length-1],h=Ie.isBuffered(this.media,d.start+d.duration/2);return h}var c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)},n.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}},n.onMediaAttached=function(e,t){var i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);var s=this.config;this.levels&&s.autoStartLoad&&this.state===w.STOPPED&&this.startLoad(s.startPosition)},n.onMediaDetaching=function(e,t){var i=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},n.onManifestLoading=function(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1},n.onError=function(e,t){},n.onManifestLoaded=function(e,t){this.startTimeOffset=t.startTimeOffset},n.onHandlerDestroying=function(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),a.prototype.onHandlerDestroying.call(this),this.hls=this.onMediaSeeking=this.onMediaEnded=null},n.onHandlerDestroyed=function(){this.state=w.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,a.prototype.onHandlerDestroyed.call(this)},n.loadFragment=function(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)},n._loadFragForPlayback=function(e,t,i){var s=this,l=function(f){var d=f.frag;if(s.fragContextChanged(d)){s.warn(d.type+" sn: "+d.sn+(f.part?" part: "+f.part.index:"")+" of "+s.fragInfo(d,!1,f.part)+") was dropped during download."),s.fragmentTracker.removeFragment(d);return}d.stats.chunkCount++,s._handleFragmentLoadProgress(f)};this._doFragLoad(e,t,i,l).then(function(u){if(u){var f=s.state,d=u.frag;if(s.fragContextChanged(d)){(f===w.FRAG_LOADING||!s.fragCurrent&&f===w.PARSING)&&(s.fragmentTracker.removeFragment(d),s.state=w.IDLE);return}"payload"in u&&(s.log("Loaded "+d.type+" sn: "+d.sn+" of "+s.playlistLabel()+" "+d.level),s.hls.trigger(p.FRAG_LOADED,u)),s._handleFragmentLoadComplete(u)}}).catch(function(u){s.state===w.STOPPED||s.state===w.ERROR||(s.warn("Frag error: "+((u==null?void 0:u.message)||u)),s.resetFragmentLoading(e))})},n.clearTrackerIfNeeded=function(e){var t,i=this.fragmentTracker,s=i.getState(e);if(s===ut.APPENDING){var l=e.type,u=this.getFwdBufferInfo(this.mediaBuffer,l),f=Math.max(e.duration,u?u.len:this.config.maxBufferLength),d=this.backtrackFragment,h=d?e.sn-d.sn:0;(h===1||this.reduceMaxBufferLength(f,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===ut.PARTIAL&&i.removeFragment(e))},n.checkLiveUpdate=function(e){if(e.updated&&!e.live){var t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)},n.waitForLive=function(e){var t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)},n.flushMainBuffer=function(e,t,i){if(i===void 0&&(i=null),!!(e-t)){var s={startOffset:e,endOffset:t,type:i};this.hls.trigger(p.BUFFER_FLUSHING,s)}},n._loadInitSegment=function(e,t){var i=this;this._doFragLoad(e,t).then(function(s){var l=s==null?void 0:s.frag;if(!l||i.fragContextChanged(l)||!i.levels)throw new Error("init load aborted");return s}).then(function(s){var l=i.hls,u=s.frag,f=s.payload,d=u.decryptdata;if(f&&f.byteLength>0&&d!=null&&d.key&&d.iv&&ti(d.method)){var h=self.performance.now();return i.decrypter.decrypt(new Uint8Array(f),d.key.buffer,d.iv.buffer,ca(d.method)).catch(function(c){throw l.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:u}),c}).then(function(c){var v=self.performance.now();return l.trigger(p.FRAG_DECRYPTED,{frag:u,payload:c,stats:{tstart:h,tdecrypt:v}}),s.payload=c,i.completeInitSegmentLoad(s)})}return i.completeInitSegmentLoad(s)}).catch(function(s){i.state===w.STOPPED||i.state===w.ERROR||(i.warn(s),i.resetFragmentLoading(e))})},n.completeInitSegmentLoad=function(e){var t=this.levels;if(!t)throw new Error("init load aborted, missing levels");var i=e.frag.stats;this.state!==w.STOPPED&&(this.state=w.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()},n.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.sn!==t.sn||e.level!==t.level},n.fragBufferedComplete=function(e,t){var i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+this.fragInfo(e,!1,t)+" > buffer:"+(i?Gu.toString(Ie.getBuffered(i)):"(detached)")+")"),Se(e)){var s;if(e.type!==K.SUBTITLE){var l=e.elementaryStreams;if(!Object.keys(l).some(function(f){return!!l[f]})){this.state=w.IDLE;return}}var u=(s=this.levels)==null?void 0:s[e.level];u!=null&&u.fragmentError&&(this.log("Resetting level fragment error count of "+u.fragmentError+" on frag buffered"),u.fragmentError=0)}this.state=w.IDLE},n._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var i=e.frag,s=e.part,l=e.partsLoaded,u=!l||l.length===0||l.some(function(d){return!d}),f=new da(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!u);t.flush(f)}},n._handleFragmentLoadProgress=function(e){},n._doFragLoad=function(e,t,i,s){var l,u=this;i===void 0&&(i=null),this.fragCurrent=e;var f=t==null?void 0:t.details;if(!this.levels||!f)throw new Error("frag load aborted, missing level"+(f?"":" detail")+"s");var d=null;e.encrypted&&!((l=e.decryptdata)!=null&&l.key)?(this.log("Loading key for "+e.sn+" of ["+f.startSN+"-"+f.endSN+"], "+this.playlistLabel()+" "+e.level),this.state=w.KEY_LOADING,this.fragCurrent=e,d=this.keyLoader.load(e).then(function(S){if(!u.fragContextChanged(S.frag))return u.hls.trigger(p.KEY_LOADED,S),u.state===w.KEY_LOADING&&(u.state=w.IDLE),S}),this.hls.trigger(p.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(d=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&f.encryptedFragments.length&&this.keyLoader.loadClear(e,f.encryptedFragments);var h=this.fragPrevious;if(Se(e)&&(!h||e.sn!==h.sn)){var c=this.shouldLoadParts(t.details,e.end);c!==this.loadingParts&&(this.log("LL-Part loading "+(c?"ON":"OFF")+" loading sn "+(h==null?void 0:h.sn)+"->"+e.sn),this.loadingParts=c)}if(i=Math.max(e.start,i||0),this.loadingParts&&Se(e)){var v=f.partList;if(v&&s){i>e.end&&f.fragmentHint&&(e=f.fragmentHint);var g=this.getNextPart(v,e,i);if(g>-1){var m=v[g];e=this.fragCurrent=m.fragment,this.log("Loading "+e.type+" sn: "+e.sn+" part: "+m.index+" ("+g+"/"+(v.length-1)+") of "+this.fragInfo(e,!1,m)+") cc: "+e.cc+" ["+f.startSN+"-"+f.endSN+"], target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=m.start+m.duration,this.state=w.FRAG_LOADING;var y;return d?y=d.then(function(S){return!S||u.fragContextChanged(S.frag)?null:u.doFragPartsLoad(e,m,t,s)}).catch(function(S){return u.handleFragLoadError(S)}):y=this.doFragPartsLoad(e,m,t,s).catch(function(S){return u.handleFragLoadError(S)}),this.hls.trigger(p.FRAG_LOADING,{frag:e,part:m,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(v,i))return Promise.resolve(null)}}if(Se(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @"+i.toFixed(2)),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading "+e.type+" sn: "+e.sn+" of "+this.fragInfo(e,!1)+") cc: "+e.cc+" "+(f?"["+f.startSN+"-"+f.endSN+"]":"")+", target: "+parseFloat(i.toFixed(3))),U(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=w.FRAG_LOADING;var E=this.config.progressive,T;return E&&d?T=d.then(function(S){return!S||u.fragContextChanged(S==null?void 0:S.frag)?null:u.fragmentLoader.load(e,s)}).catch(function(S){return u.handleFragLoadError(S)}):T=Promise.all([this.fragmentLoader.load(e,E?s:void 0),d]).then(function(S){var x=S[0];return!E&&x&&s&&s(x),x}).catch(function(S){return u.handleFragLoadError(S)}),this.hls.trigger(p.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):T},n.doFragPartsLoad=function(e,t,i,s){var l=this;return new Promise(function(u,f){var d,h=[],c=(d=i.details)==null?void 0:d.partList,v=function(m){l.fragmentLoader.loadPart(e,m,s).then(function(y){h[m.index]=y;var E=y.part;l.hls.trigger(p.FRAG_LOADED,y);var T=ao(i.details,e.sn,m.index+1)||so(c,e.sn,m.index+1);if(T)v(T);else return u({frag:e,part:E,partsLoaded:h})}).catch(f)};v(t)})},n.handleFragLoadError=function(e){if("data"in e){var t=e.data;e.data&&t.details===I.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(p.ERROR,t)}else this.hls.trigger(p.ERROR,{type:B.OTHER_ERROR,details:I.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},n._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(!t||this.state!==w.PARSING){!this.fragCurrent&&this.state!==w.STOPPED&&this.state!==w.ERROR&&(this.state=w.IDLE);return}var i=t.frag,s=t.part,l=t.level,u=self.performance.now();i.stats.parsing.end=u,s&&(s.stats.parsing.end=u);var f=this.getLevelDetails(),d=f&&i.sn>f.endSN,h=d||this.shouldLoadParts(f,i.end);h!==this.loadingParts&&(this.log("LL-Part loading "+(h?"ON":"OFF")+" after parsing segment ending @"+i.end.toFixed(2)),this.loadingParts=h),this.updateLevelTiming(i,s,l,e.partial)},n.shouldLoadParts=function(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var i,s=e.partList[0],l=s.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=l){var u,f=this.hls.hasEnoughToStart?((u=this.media)==null?void 0:u.currentTime)||this.lastCurrentTime:this.getLoadPosition();if(f>s.start-s.fragment.duration)return!0}}}return!1},n.getCurrentContext=function(e){var t=this.levels,i=this.fragCurrent,s=e.level,l=e.sn,u=e.part;if(!(t!=null&&t[s]))return this.warn("Levels object was unset while buffering fragment "+l+" of "+this.playlistLabel()+" "+s+". The current chunk will not be buffered."),null;var f=t[s],d=f.details,h=u>-1?ao(d,l,u):null,c=h?h.fragment:no(d,l,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:h,level:f}):null},n.bufferFragmentData=function(e,t,i,s,l){var u;if(!(!e||this.state!==w.PARSING)){var f=e.data1,d=e.data2,h=f;if(f&&d&&(h=_t(f,d)),!!((u=h)!=null&&u.length)){var c={type:e.type,frag:t,part:i,chunkMeta:s,parent:t.type,data:h};if(this.hls.trigger(p.BUFFER_APPENDING,c),e.dropped&&e.independent&&!i){if(l)return;this.flushBufferGap(t)}}}},n.flushBufferGap=function(e){var t=this.media;if(t){if(!Ie.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}var i=t.currentTime,s=Ie.bufferInfo(t,i,0),l=e.duration,u=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),f=Math.max(Math.min(e.start-u,s.end-u),i+u);e.start-f>u&&this.flushMainBuffer(f,e.start)}},n.getFwdBufferInfo=function(e,t){var i,s=this.getLoadPosition();if(!U(s))return null;var l=this.lastCurrentTime>s,u=l||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,u)},n.getFwdBufferInfoAtPos=function(e,t,i,s){var l=Ie.bufferInfo(e,t,s);if(l.len===0&&l.nextStart!==void 0){var u=this.fragmentTracker.getBufferedFrag(t,i);if(u&&(l.nextStart<=u.end||u.gap)){var f=Math.max(Math.min(l.nextStart,u.end)-t,s);return Ie.bufferInfo(e,t,f)}}return l},n.getMaxBufferLength=function(e){var t=this.config,i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)},n.reduceMaxBufferLength=function(e,t){var i=this.config,s=Math.max(Math.min(e-t,i.maxBufferLength),t),l=Math.max(e-t*3,i.maxMaxBufferLength/2,s);return l>=s?(i.maxMaxBufferLength=l,this.warn("Reduce max buffer length to "+l+"s"),!0):!1},n.getAppendedFrag=function(e,t){var i;t===void 0&&(t=K.MAIN);var s=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(e,t);return s&&"fragment"in s?s.fragment:s},n.getNextFragment=function(e,t){var i=t.fragments,s=i.length;if(!s)return null;var l=this.config,u=i[0].start,f=l.lowLatencyMode&&!!t.partList,d=null;if(t.live){var h=l.initialLiveManifestSize;if(s<h)return this.warn("Not enough fragments to start playback (have: "+s+", need: "+h+")"),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<u){var c;f&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t,i);var v=this.hls.startPosition,g=this.hls.liveSyncPosition,m=d?(v!==-1&&v>=u?v:g)||d.start:e;this.log("Setting startPosition to "+m+" to match start frag at live edge. mainStart: "+v+" liveSyncPosition: "+g+" frag.start: "+((c=d)==null?void 0:c.start)),this.startPosition=this.nextLoadPosition=m}}else e<=u&&(d=i[0]);if(!d){var y=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,y,t)}var E=this.filterReplacedPrimary(d,t);if(!E&&d){var T=d.sn-t.startSN;E=this.filterReplacedPrimary(i[T+1]||null,t)}return this.mapToInitFragWhenRequired(E)},n.isLoopLoading=function(e,t){var i=this.fragmentTracker.getState(e);return(i===ut.OK||i===ut.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t},n.getNextFragmentLoopLoading=function(e,t,i,s,l){var u=null;if(e.gap&&(u=this.getNextFragment(this.nextLoadPosition,t),u&&!u.gap&&i.nextStart)){var f=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s,0);if(f!==null&&i.len+f.len>=l){var d=u.sn;return this.loopSn!==d&&(this.log('buffer full after gaps in "'+s+'" playlist starting at sn: '+d),this.loopSn=d),null}}return this.loopSn=void 0,u},n.filterReplacedPrimary=function(e,t){if(!e)return e;if(ho(this.hls.config)&&e.type!==K.SUBTITLE){var i=this.hls.interstitialsManager,s=i==null?void 0:i.bufferingItem;if(s){var l=s.event;if(l){if(l.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}var u=i==null?void 0:i.playerQueue;if(u)for(var f=u.length;f--;){var d=u[f].interstitial;if(d.appendInPlace&&e.start>=d.startTime&&e.end<=d.resumeTime)return null}}return e},n.mapToInitFragWhenRequired=function(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e},n.getNextPart=function(e,t,i){for(var s=-1,l=!1,u=!0,f=0,d=e.length;f<d;f++){var h=e[f];if(u=u&&!h.independent,s>-1&&i<h.start)break;var c=h.loaded;c?s=-1:(l||h.independent||u)&&h.fragment===t&&(s=f),l=c}return s},n.loadedEndOfParts=function(e,t){var i=e[e.length-1];return i&&t>i.start&&i.loaded},n.getInitialLiveFragment=function(e,t){var i=this.fragPrevious,s=null;if(i){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),s=tu(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){var l=i.sn+1;if(l>=e.startSN&&l<=e.endSN){var u=t[l-e.startSN];i.cc===u.cc&&(s=u,this.log("Live playlist, switching playlist, load frag with next SN: "+s.sn))}s||(s=_s(t,i.cc),s&&this.log("Live playlist, switching playlist, load frag with same CC: "+s.sn))}}else{var f=this.hls.liveSyncPosition;f!==null&&(s=this.getFragmentAtPosition(f,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s},n.getFragmentAtPosition=function(e,t,i){var s=this.config,l=this.fragPrevious,u=i.fragments,f=i.endSN,d=i.fragmentHint,h=s.maxFragLookUpTolerance,c=i.partList,v=!!(this.loadingParts&&c!=null&&c.length&&d);v&&d&&!this.bitrateTest&&c[c.length-1].fragment.sn===d.sn&&(u=u.concat(d),f=d.sn);var g;if(e<t){var m,y=e<this.lastCurrentTime,E=y||e>t-h||(m=this.media)!=null&&m.paused||!this.startFragRequested?0:h;g=Kr(l,u,e,E)}else g=u[u.length-1];if(g){var T=g.sn-i.startSN,S=this.fragmentTracker.getState(g);if((S===ut.OK||S===ut.PARTIAL&&g.gap)&&(l=g),l&&g.sn===l.sn&&(!v||c[0].fragment.sn>g.sn||!i.live&&!v)){var x=l&&g.level===l.level;if(x){var A=u[T+1];g.sn<f&&this.fragmentTracker.getState(A)!==ut.OK?g=A:g=null}}}return g},n.alignPlaylists=function(e,t,i){var s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;var l=e.fragmentStart,u=!t,f=e.alignedSliding&&U(l);if(u||!f&&!l){Bu(i,e);var d=e.fragmentStart;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" fragments: "+s),d}return l},n.waitForCdnTuneIn=function(e){var t=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*t)},n.setStartPosition=function(e,t){var i=this.startPosition;i<t&&(i=-1);var s=this.timelineOffset;if(i===-1){var l=this.startTimeOffset!==null,u=l?this.startTimeOffset:e.startTimeOffset;u!==null&&U(u)?(i=t+u,u<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log("Setting startPosition to "+i+" for start time offset "+u+" found in "+(l?"multivariant":"media")+" playlist"),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge "+i),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+s}this.nextLoadPosition=i+s},n.getLoadPosition=function(){var e,t=this.media,i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i},n.handleFragLoadAborted=function(e,t){this.transmuxer&&e.type===this.playlistType&&Se(e)&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of "+this.playlistLabel()+" "+e.level+" was aborted"),this.resetFragmentLoading(e))},n.resetFragmentLoading=function(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==w.FRAG_LOADING_WAITING_RETRY)&&(this.state=w.IDLE)},n.onFragmentOrKeyLoadError=function(e,t){if(t.chunkMeta&&!t.frag){var i=this.getCurrentContext(t.chunkMeta);i&&(t.frag=i.frag)}var s=t.frag;if(!(!s||s.type!==e||!this.levels)){if(this.fragContextChanged(s)){var l;this.warn("Frag load error must match current frag to retry "+s.url+" > "+((l=this.fragCurrent)==null?void 0:l.url));return}var u=t.details===I.FRAG_GAP;u&&this.fragmentTracker.fragBuffered(s,!0);var f=t.errorAction,d=f||{},h=d.action,c=d.flags,v=d.retryCount,g=v===void 0?0:v,m=d.retryConfig,y=!!f&&!!m,E=y&&h===kt.RetryRequest,T=y&&!f.resolved&&c===tr.MoveAllAlternatesMatchingHost;if(!E&&T&&Se(s)&&!s.endList)this.resetFragmentErrors(e),this.treatAsGap(s),f.resolved=!0;else if((E||T)&&g<m.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);var S=ua(m,g);this.warn("Fragment "+s.sn+" of "+e+" "+s.level+" errored with "+t.details+", retrying loading "+(g+1)+"/"+m.maxNumRetry+" in "+S+"ms"),f.resolved=!0,this.retryDate=self.performance.now()+S,this.state=w.FRAG_LOADING_WAITING_RETRY}else if(m&&f)if(this.resetFragmentErrors(e),g<m.maxNumRetry)!u&&h!==kt.RemoveAlternatePermanently&&(f.resolved=!0);else{this.warn(t.details+" reached or exceeded max retry ("+g+")");return}else h===kt.SendAlternateToPenaltyBox?this.state=w.WAITING_LEVEL:this.state=w.ERROR;this.tickImmediate()}},n.reduceLengthAndFlushBuffer=function(e){if(this.state===w.PARSING||this.state===w.PARSED){var t=e.frag,i=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,i),l=s&&s.len>.5;l&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);var u=!l;return u&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+i+" buffer"),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),u}return!1},n.resetFragmentErrors=function(e){e===K.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==w.STOPPED&&(this.state=w.IDLE)},n.afterBufferFlushed=function(e,t,i){if(e){var s=Ie.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===w.ENDED&&this.resetLoadingState()}},n.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==w.STOPPED&&(this.state=w.IDLE)},n.resetStartWhenNotLoaded=function(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;var t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},n.resetWhenMissingContext=function(e){this.warn("The loading context changed while buffering fragment "+e.sn+" of "+this.playlistLabel()+" "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},n.removeUnbufferedFrags=function(e){e===void 0&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},n.updateLevelTiming=function(e,t,i,s){var l=this,u=i.details;if(!u){this.warn("level.details undefined");return}var f=Object.keys(e.elementaryStreams).reduce(function(c,v){var g=e.elementaryStreams[v];if(g){var m=g.endPTS-g.startPTS;if(m<=0)return l.warn("Could not parse fragment "+e.sn+" "+v+" duration reliably ("+m+")"),c||!1;var y=s?0:eo(u,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS);return l.hls.trigger(p.LEVEL_PTS_UPDATED,{details:u,level:i,drift:y,type:v,frag:e,start:g.startPTS,end:g.endPTS}),!0}return c},!1);if(!f){var d;if(i.fragmentError===0&&this.treatAsGap(e,i),((d=this.transmuxer)==null?void 0:d.error)===null){var h=new Error("Found no media in fragment "+e.sn+" of "+this.playlistLabel()+" "+e.level+" resetting transmuxer to fallback to playlist timing");if(this.warn(h.message),this.hls.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:e,reason:"Found no media in msn "+e.sn+" of "+this.playlistLabel()+' "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}}this.state=w.PARSED,this.log("Parsed "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+this.fragInfo(e,!1,t)+")"),this.hls.trigger(p.FRAG_PARSED,{frag:e,part:t})},n.playlistLabel=function(){return this.playlistType===K.MAIN?"level":"track"},n.fragInfo=function(e,t,i){var s,l;return t===void 0&&(t=!0),this.playlistLabel()+" "+e.level+" ("+(i?"part":"frag")+":["+((s=t&&!i?e.startPTS:(i||e).start)!=null?s:NaN).toFixed(3)+"-"+((l=t&&!i?e.endPTS:(i||e).end)!=null?l:NaN).toFixed(3)+"]"+(i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):"")},n.treatAsGap=function(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)},n.resetTransmuxer=function(){var e;(e=this.transmuxer)==null||e.reset()},n.recoverWorkerError=function(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},oe(o,[{key:"startPositionValue",get:function(){var e=this.nextLoadPosition,t=this.startPosition;return t===-1&&e?e:t}},{key:"bufferingEnabled",get:function(){return this.buffering}},{key:"inFlightFrag",get:function(){return{frag:this.fragCurrent,state:this.state}}},{key:"timelineOffset",get:function(){var e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}},{key:"primaryPrefetch",get:function(){if(ho(this.hls.config)){var e,t,i=(e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event;if(i)return!0}return!1}},{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}])}(Os);function ho(a){return!!a.interstitialsController&&a.enableInterstitialPlayback!==!1}var co=function(){function a(){this.chunks=[],this.dataLength=0}var o=a.prototype;return o.push=function(r){this.chunks.push(r),this.dataLength+=r.length},o.flush=function(){var r=this.chunks,e=this.dataLength,t;if(r.length)r.length===1?t=r[0]:t=Ku(r,e);else return new Uint8Array(0);return this.reset(),t},o.reset=function(){this.chunks.length=0,this.dataLength=0},a}();function Ku(a,o){for(var n=new Uint8Array(o),r=0,e=0;e<a.length;e++){var t=a[e];n.set(t,r),r+=t.length}return n}function vo(a,o){return o+10<=a.length&&a[o]===51&&a[o+1]===68&&a[o+2]===73&&a[o+3]<255&&a[o+4]<255&&a[o+6]<128&&a[o+7]<128&&a[o+8]<128&&a[o+9]<128}function ba(a,o){return o+10<=a.length&&a[o]===73&&a[o+1]===68&&a[o+2]===51&&a[o+3]<255&&a[o+4]<255&&a[o+6]<128&&a[o+7]<128&&a[o+8]<128&&a[o+9]<128}function yn(a,o){var n=0;return n=(a[o]&127)<<21,n|=(a[o+1]&127)<<14,n|=(a[o+2]&127)<<7,n|=a[o+3]&127,n}function wi(a,o){for(var n=o,r=0;ba(a,o);){r+=10;var e=yn(a,o+6);r+=e,vo(a,o+10)&&(r+=10),o+=r}if(r>0)return a.subarray(n,n+r)}function Hu(a,o,n,r){var e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],t=o[n+2],i=t>>2&15;if(i>12){var s=new Error("invalid ADTS sampling index:"+i);a.emit(p.ERROR,p.ERROR,{type:B.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!0,error:s,reason:s.message});return}var l=(t>>6&3)+1,u=o[n+3]>>6&3|(t&1)<<2,f="mp4a.40."+l,d=e[i],h=i;(l===5||l===29)&&(h-=3);var c=[l<<3|(h&14)>>1,(h&1)<<7|u<<3];return le.log("manifest codec:"+r+", parsed codec:"+f+", channels:"+u+", rate:"+d+" (ADTS object type:"+l+" sampling index:"+i+")"),{config:c,samplerate:d,channelCount:u,codec:f,parsedCodec:f,manifestCodec:r}}function go(a,o){return a[o]===255&&(a[o+1]&246)===240}function mo(a,o){return a[o+1]&1?7:9}function Ra(a,o){return(a[o+3]&3)<<11|a[o+4]<<3|(a[o+5]&224)>>>5}function Vu(a,o){return o+5<a.length}function En(a,o){return o+1<a.length&&go(a,o)}function Wu(a,o){return Vu(a,o)&&go(a,o)&&Ra(a,o)<=a.length-o}function Yu(a,o){if(En(a,o)){var n=mo(a,o);if(o+n>=a.length)return!1;var r=Ra(a,o);if(r<=n)return!1;var e=o+r;return e===a.length||En(a,e)}return!1}function po(a,o,n,r,e){if(!a.samplerate){var t=Hu(o,n,r,e);if(!t)return;ne(a,t)}}function yo(a){return 1024*9e4/a}function qu(a,o){var n=mo(a,o);if(o+n<=a.length){var r=Ra(a,o)-n;if(r>0)return{headerLength:n,frameLength:r}}}function Eo(a,o,n,r,e){var t=yo(a.samplerate),i=r+e*t,s=qu(o,n),l;if(s){var u=s.frameLength,f=s.headerLength,d=f+u,h=Math.max(0,n+d-o.length);h?(l=new Uint8Array(d-f),l.set(o.subarray(n+f,o.length),0)):l=o.subarray(n+f,n+d);var c={unit:l,pts:i};return h||a.samples.push(c),{sample:c,length:d,missing:h}}var v=o.length-n;l=new Uint8Array(v),l.set(o.subarray(n,o.length),0);var g={unit:l,pts:i};return{sample:g,length:v,missing:-1}}function ju(a,o){return ba(a,o)&&yn(a,o+6)+10<=a.length-o}function Xu(a){if(!(a.size<2)){var o=ee(a.data,!0),n=new Uint8Array(a.data.subarray(o.length+1));return{key:a.type,info:o,data:n.buffer}}}function zu(a){if(!(a.size<2)){if(a.type==="TXXX"){var o=1,n=ee(a.data.subarray(o),!0);o+=n.length+1;var r=ee(a.data.subarray(o));return{key:a.type,info:n,data:r}}var e=ee(a.data.subarray(1));return{key:a.type,info:"",data:e}}}function Qu(a){if(a.type==="WXXX"){if(a.size<2)return;var o=1,n=ee(a.data.subarray(o),!0);o+=n.length+1;var r=ee(a.data.subarray(o));return{key:a.type,info:n,data:r}}var e=ee(a.data);return{key:a.type,info:"",data:e}}function $u(a){return btoa(String.fromCharCode.apply(String,a))}function To(a,o){if(a<0)return-To(-a,o);var n=Math.pow(10,o),r=Math.abs(a*n%1-.5)<Number.EPSILON;if(r){var e=Math.floor(a*n);return(e%2===0?e:e+1)/n}else return Math.round(a*n)/n}function Ju(a,o){var n=new URL(a),r=new URL(o);if(n.origin!==r.origin)return a;for(var e=n.pathname.split("/").slice(1),t=r.pathname.split("/").slice(1,-1);e[0]===t[0];)e.shift(),t.shift();for(;t.length;)t.shift(),e.unshift("..");return e.join("/")}function Zu(a){return a instanceof ArrayBuffer?a:a.byteOffset==0&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer}function Ia(a,o,n){return o===void 0&&(o=0),n===void 0&&(n=1/0),ef(a,o,n,Uint8Array)}function ef(a,o,n,r){var e=tf(a),t=1;"BYTES_PER_ELEMENT"in r&&(t=r.BYTES_PER_ELEMENT);var i=rf(a)?a.byteOffset:0,s=(i+a.byteLength)/t,l=(i+o)/t,u=Math.floor(Math.max(0,Math.min(l,s))),f=Math.floor(Math.min(u+Math.max(n,0),s));return new r(e,u,f-u)}function tf(a){return a instanceof ArrayBuffer?a:a.buffer}function rf(a){return a&&a.buffer instanceof ArrayBuffer&&a.byteLength!==void 0&&a.byteOffset!==void 0}function nf(a){var o={key:a.type,description:"",data:"",mimeType:null,pictureType:null},n=3;if(!(a.size<2)){if(a.data[0]!==n){console.log("Ignore frame with unrecognized character encoding");return}var r=a.data.subarray(1).indexOf(0);if(r!==-1){var e=ee(Ia(a.data,1,r)),t=a.data[2+r],i=a.data.subarray(3+r).indexOf(0);if(i!==-1){var s=ee(Ia(a.data,3+r,i)),l;return e==="-->"?l=ee(Ia(a.data,4+r+i)):l=Zu(a.data.subarray(4+r+i)),o.mimeType=e,o.pictureType=t,o.description=s,o.data=l,o}}}}function af(a){return a.type==="PRIV"?Xu(a):a.type[0]==="W"?Qu(a):a.type==="APIC"?nf(a):zu(a)}function sf(a){var o=String.fromCharCode(a[0],a[1],a[2],a[3]),n=yn(a,4),r=10;return{type:o,size:n,data:a.subarray(r,r+n)}}var Tn=10,of=10;function So(a){for(var o=0,n=[];ba(a,o);){var r=yn(a,o+6);a[o+5]>>6&1&&(o+=Tn),o+=Tn;for(var e=o+r;o+of<e;){var t=sf(a.subarray(o)),i=af(t);i&&n.push(i),o+=t.size+Tn}vo(a,o)&&(o+=Tn)}return n}function xo(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function lf(a){if(a.data.byteLength===8){var o=new Uint8Array(a.data),n=o[3]&1,r=(o[4]<<23)+(o[5]<<15)+(o[6]<<7)+o[7];return r/=45,n&&(r+=4772185884e-2),Math.round(r)}}function _a(a){for(var o=So(a),n=0;n<o.length;n++){var r=o[n];if(xo(r))return lf(r)}}var Ht=function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a}({});function lr(a,o){return a===void 0&&(a=""),o===void 0&&(o=9e4),{type:a,id:-1,pid:-1,inputTimeScale:o,sequenceNumber:-1,samples:[],dropped:0}}var Da=function(){function a(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var o=a.prototype;return o.resetInitSegment=function(r,e,t,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},o.resetTimeStamp=function(r){this.initPTS=r,this.resetContiguity()},o.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},o.canParse=function(r,e){return!1},o.appendFrame=function(r,e,t){},o.demux=function(r,e){this.cachedData&&(r=_t(this.cachedData,r),this.cachedData=null);var t=wi(r,0),i=t?t.length:0,s,l=this._audioTrack,u=this._id3Track,f=t?_a(t):void 0,d=r.length;for((this.basePTS===null||this.frameIndex===0&&U(f))&&(this.basePTS=uf(f,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),t&&t.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:t,type:Ht.audioId3,duration:Number.POSITIVE_INFINITY});i<d;){if(this.canParse(r,i)){var h=this.appendFrame(l,r,i);h?(this.frameIndex++,this.lastPTS=h.sample.pts,i+=h.length,s=i):i=d}else ju(r,i)?(t=wi(r,i),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:t,type:Ht.audioId3,duration:Number.POSITIVE_INFINITY}),i+=t.length,s=i):i++;if(i===d&&s!==d){var c=r.slice(s);this.cachedData?this.cachedData=_t(this.cachedData,c):this.cachedData=c}}return{audioTrack:l,videoTrack:lr(),id3Track:u,textTrack:lr()}},o.demuxSampleAes=function(r,e,t){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},o.flush=function(r){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:lr(),id3Track:this._id3Track,textTrack:lr()}},o.destroy=function(){this.cachedData=null,this._audioTrack=this._id3Track=void 0},a}(),uf=function(o,n,r){if(U(o))return o*90;var e=r?r.baseTime*9e4/r.timescale:0;return n*9e4+e},Sn=null,ff=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],df=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],hf=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],cf=[0,1,1,4];function Ao(a,o,n,r,e){if(!(n+24>o.length)){var t=Lo(o,n);if(t&&n+t.frameLength<=o.length){var i=t.samplesPerFrame*9e4/t.sampleRate,s=r+e*i,l={unit:o.subarray(n,n+t.frameLength),pts:s,dts:s};return a.config=[],a.channelCount=t.channelCount,a.samplerate=t.sampleRate,a.samples.push(l),{sample:l,length:t.frameLength,missing:0}}}}function Lo(a,o){var n=a[o+1]>>3&3,r=a[o+1]>>1&3,e=a[o+2]>>4&15,t=a[o+2]>>2&3;if(n!==1&&e!==0&&e!==15&&t!==3){var i=a[o+2]>>1&1,s=a[o+3]>>6,l=n===3?3-r:r===3?3:4,u=ff[l*14+e-1]*1e3,f=n===3?0:n===2?1:2,d=df[f*3+t],h=s===3?1:2,c=hf[n][r],v=cf[r],g=c*8*v,m=Math.floor(c*u/d+i)*v;if(Sn===null){var y=navigator.userAgent||"",E=y.match(/Chrome\/(\d+)/i);Sn=E?parseInt(E[1]):0}var T=!!Sn&&Sn<=87;return T&&r===2&&u>=224e3&&s===0&&(a[o+3]=a[o+3]|128),{sampleRate:d,channelCount:h,frameLength:m,samplesPerFrame:g}}}function ka(a,o){return a[o]===255&&(a[o+1]&224)===224&&(a[o+1]&6)!==0}function bo(a,o){return o+1<a.length&&ka(a,o)}function vf(a,o){var n=4;return ka(a,o)&&n<=a.length-o}function Ro(a,o){if(o+1<a.length&&ka(a,o)){var n=4,r=Lo(a,o),e=n;r!=null&&r.frameLength&&(e=r.frameLength);var t=o+e;return t===a.length||bo(a,t)}return!1}var gf=function(a){function o(r,e){var t;return t=a.call(this)||this,t.observer=void 0,t.config=void 0,t.observer=r,t.config=e,t}j(o,a);var n=o.prototype;return n.resetInitSegment=function(e,t,i,s){a.prototype.resetInitSegment.call(this,e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}},o.probe=function(e,t){if(!e)return!1;var i=wi(e,0),s=(i==null?void 0:i.length)||0;if(Ro(e,s))return!1;for(var l=e.length;s<l;s++)if(Yu(e,s))return t.log("ADTS sync word found !"),!0;return!1},n.canParse=function(e,t){return Wu(e,t)},n.appendFrame=function(e,t,i){po(e,this.observer,t,i,e.manifestCodec);var s=Eo(e,t,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s},o}(Da),Io=function(o,n){var r=0,e=5;n+=e;for(var t=new Uint32Array(1),i=new Uint32Array(1),s=new Uint8Array(1);e>0;){s[0]=o[n];var l=Math.min(e,8),u=8-l;i[0]=4278190080>>>24+u<<u,t[0]=(s[0]&i[0])>>u,r=r?r<<l|t[0]:t[0],n+=1,e-=l}return r},mf=function(a){function o(r){var e;return e=a.call(this)||this,e.observer=void 0,e.observer=r,e}j(o,a);var n=o.prototype;return n.resetInitSegment=function(e,t,i,s){a.prototype.resetInitSegment.call(this,e,t,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}},n.canParse=function(e,t){return t+64<e.length},n.appendFrame=function(e,t,i){var s=_o(e,t,i,this.basePTS,this.frameIndex);if(s!==-1){var l=e.samples[e.samples.length-1];return{sample:l,length:s,missing:0}}},o.probe=function(e){if(!e)return!1;var t=wi(e,0);if(!t)return!1;var i=t.length;return e[i]===11&&e[i+1]===119&&_a(t)!==void 0&&Io(e,i)<16},o}(Da);function _o(a,o,n,r,e){if(n+8>o.length||o[n]!==11||o[n+1]!==119)return-1;var t=o[n+4]>>6;if(t>=3)return-1;var i=[48e3,44100,32e3],s=i[t],l=o[n+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920],f=u[l*3+t]*2;if(n+f>o.length)return-1;var d=o[n+6]>>5,h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));var c=(o[n+6]<<8|o[n+7])>>12-h&1,v=[2,1,2,3,3,4,4,5],g=v[d]+c,m=o[n+5]>>3,y=o[n+5]&7,E=new Uint8Array([t<<6|m<<1|y>>2,(y&3)<<6|d<<3|c<<2|l>>4,l<<4&224]),T=1536/s*9e4,S=r+e*T,x=o.subarray(n,n+f);return a.config=E,a.channelCount=g,a.samplerate=s,a.samples.push({unit:x,pts:S}),f}var pf=function(a){function o(){return a.apply(this,arguments)||this}j(o,a);var n=o.prototype;return n.resetInitSegment=function(e,t,i,s){a.prototype.resetInitSegment.call(this,e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}},o.probe=function(e){if(!e)return!1;var t=wi(e,0),i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&_a(t)!==void 0&&Io(e,i)<=16)return!1;for(var s=e.length;i<s;i++)if(Ro(e,i))return le.log("MPEG Audio sync word found !"),!0;return!1},n.canParse=function(e,t){return vf(e,t)},n.appendFrame=function(e,t,i){if(this.basePTS!==null)return Ao(e,t,i,this.basePTS,this.frameIndex)},o}(Da),yf=/\/emsg[-/]ID3/i,Ef=function(){function a(n,r){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}var o=a.prototype;return o.resetTimeStamp=function(){},o.resetInitSegment=function(r,e,t,i){var s=this.videoTrack=lr("video",1),l=this.audioTrack=lr("audio",1),u=this.txtTrack=lr("text",1);if(this.id3Track=lr("id3",1),this.timeOffset=0,!!(r!=null&&r.byteLength)){var f=jr(r);if(f.video){var d=f.video,h=d.id,c=d.timescale,v=d.codec,g=d.supplemental;s.id=h,s.timescale=u.timescale=c,s.codec=v,s.supplemental=g}if(f.audio){var m=f.audio,y=m.id,E=m.timescale,T=m.codec;l.id=y,l.timescale=E,l.codec=T}u.id=It.text,s.sampleDuration=0,s.duration=l.duration=i}},o.resetContiguity=function(){this.remainderData=null},a.probe=function(r){return gi(r)},o.demux=function(r,e){this.timeOffset=e;var t=r,i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(t=_t(this.remainderData,r));var l=$n(t);this.remainderData=l.remainder,i.samples=l.valid||new Uint8Array}else i.samples=t;var u=this.extractID3Track(i,e);return s.samples=Qr(e,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:u,textTrack:this.txtTrack}},o.flush=function(){var r=this.timeOffset,e=this.videoTrack,t=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(e,this.timeOffset);return t.samples=Qr(r,e),{videoTrack:e,audioTrack:lr(),id3Track:i,textTrack:lr()}},o.extractID3Track=function(r,e){var t=this,i=this.id3Track;if(r.samples.length){var s=de(r.samples,["emsg"]);s&&s.forEach(function(l){var u=Xi(l);if(yf.test(u.schemeIdUri)){var f=Do(u,e),d=u.eventDuration===4294967295?Number.POSITIVE_INFINITY:u.eventDuration/u.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var h=u.payload;i.samples.push({data:h,len:h.byteLength,dts:f,pts:f,type:Ht.emsg,duration:d})}else if(t.config.enableEmsgKLVMetadata&&u.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){var c=Do(u,e);i.samples.push({data:u.payload,len:u.payload.byteLength,dts:c,pts:c,type:Ht.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i},o.demuxSampleAes=function(r,e,t){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},o.destroy=function(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0},a}();function Do(a,o){return U(a.presentationTime)?a.presentationTime/a.timeScale:o+a.presentationTimeDelta/a.timeScale}var Tf=function(){function a(n,r,e){this.keyData=void 0,this.decrypter=void 0,this.keyData=e,this.decrypter=new fa(r,{removePKCS7Padding:!1})}var o=a.prototype;return o.decryptBuffer=function(r){return this.decrypter.decrypt(r,this.keyData.key.buffer,this.keyData.iv.buffer,Lr.cbc)},o.decryptAacSample=function(r,e,t){var i=this,s=r[e].unit;if(!(s.length<=16)){var l=s.subarray(16,s.length-s.length%16),u=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(u).then(function(f){var d=new Uint8Array(f);s.set(d,16),i.decrypter.isSync()||i.decryptAacSamples(r,e+1,t)})}},o.decryptAacSamples=function(r,e,t){for(;;e++){if(e>=r.length){t();return}if(!(r[e].unit.length<32)&&(this.decryptAacSample(r,e,t),!this.decrypter.isSync()))return}},o.getAvcEncryptedData=function(r){for(var e=Math.floor((r.length-48)/160)*16+16,t=new Int8Array(e),i=0,s=32;s<r.length-16;s+=160,i+=16)t.set(r.subarray(s,s+16),i);return t},o.getAvcDecryptedUnit=function(r,e){for(var t=new Uint8Array(e),i=0,s=32;s<r.length-16;s+=160,i+=16)r.set(t.subarray(i,i+16),s);return r},o.decryptAvcSample=function(r,e,t,i,s){var l=this,u=xi(s.data),f=this.getAvcEncryptedData(u);this.decryptBuffer(f.buffer).then(function(d){s.data=l.getAvcDecryptedUnit(u,d),l.decrypter.isSync()||l.decryptAvcSamples(r,e,t+1,i)})},o.decryptAvcSamples=function(r,e,t,i){if(r instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,t=0){if(e>=r.length){i();return}for(var s=r[e].units;!(t>=s.length);t++){var l=s[t];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(r,e,t,i,l),!this.decrypter.isSync()))return}}},a}(),ko=function(){function a(){this.VideoSample=null}var o=a.prototype;return o.createVideoSample=function(r,e,t){return{key:r,frame:!1,pts:e,dts:t,units:[],length:0}},o.getLastNalUnit=function(r){var e,t=this.VideoSample,i;if((!t||t.units.length===0)&&(t=r[r.length-1]),(e=t)!=null&&e.units){var s=t.units;i=s[s.length-1]}return i},o.pushAccessUnit=function(r,e){if(r.units.length&&r.frame){if(r.pts===void 0){var t=e.samples,i=t.length;if(i){var s=t[i-1];r.pts=s.pts,r.dts=s.dts}else{e.dropped++;return}}e.samples.push(r)}},o.parseNALu=function(r,e,t){var i=e.byteLength,s=r.naluState||0,l=s,u=[],f=0,d,h,c,v=-1,g=0;for(s===-1&&(v=0,g=this.getNALuType(e,0),s=0,f=1);f<i;){if(d=e[f++],!s){s=d?0:1;continue}if(s===1){s=d?0:2;continue}if(!d)s=3;else if(d===1){if(h=f-s-1,v>=0){var m={data:e.subarray(v,h),type:g};u.push(m)}else{var y=this.getLastNalUnit(r.samples);y&&(l&&f<=4-l&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-l)),h>0&&(y.data=_t(y.data,e.subarray(0,h)),y.state=0))}f<i?(c=this.getNALuType(e,f),v=f,g=c,s=0):s=-1}else s=0}if(v>=0&&s>=0){var E={data:e.subarray(v,i),type:g,state:s};u.push(E)}if(u.length===0){var T=this.getLastNalUnit(r.samples);T&&(T.data=_t(T.data,e))}return r.naluState=s,u},a}(),Mi=function(){function a(n){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=n,this.bytesAvailable=n.byteLength,this.word=0,this.bitsAvailable=0}var o=a.prototype;return o.loadWord=function(){var r=this.data,e=this.bytesAvailable,t=r.byteLength-e,i=new Uint8Array(4),s=Math.min(4,e);if(s===0)throw new Error("no bytes available");i.set(r.subarray(t,t+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s},o.skipBits=function(r){var e;r=Math.min(r,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>r?(this.word<<=r,this.bitsAvailable-=r):(r-=this.bitsAvailable,e=r>>3,r-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=r,this.bitsAvailable-=r)},o.readBits=function(r){var e=Math.min(this.bitsAvailable,r),t=this.word>>>32-e;if(r>32&&le.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=r-e,e>0&&this.bitsAvailable?t<<e|this.readBits(e):t},o.skipLZ=function(){var r;for(r=0;r<this.bitsAvailable;++r)if((this.word&2147483648>>>r)!==0)return this.word<<=r,this.bitsAvailable-=r,r;return this.loadWord(),r+this.skipLZ()},o.skipUEG=function(){this.skipBits(1+this.skipLZ())},o.skipEG=function(){this.skipBits(1+this.skipLZ())},o.readUEG=function(){var r=this.skipLZ();return this.readBits(r+1)-1},o.readEG=function(){var r=this.readUEG();return 1&r?1+r>>>1:-1*(r>>>1)},o.readBoolean=function(){return this.readBits(1)===1},o.readUByte=function(){return this.readBits(8)},o.readUShort=function(){return this.readBits(16)},o.readUInt=function(){return this.readBits(32)},a}(),Co=function(a){function o(){return a.apply(this,arguments)||this}j(o,a);var n=o.prototype;return n.parsePES=function(e,t,i,s){var l=this,u=this.parseNALu(e,i.data,s),f=this.VideoSample,d,h=!1;i.data=null,f&&u.length&&!e.audFound&&(this.pushAccessUnit(f,e),f=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(function(c){var v,g;switch(c.type){case 1:{var m=!1;d=!0;var y=c.data;if(h&&y.length>4){var E=l.readSliceType(y);(E===2||E===4||E===7||E===9)&&(m=!0)}if(m){var T;(T=f)!=null&&T.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null)}f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.frame=!0,f.key=m;break}case 5:d=!0,(v=f)!=null&&v.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null),f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0,f.frame=!0;break;case 6:{d=!0,Si(c.data,1,i.pts,t.samples);break}case 7:{var S,x;d=!0,h=!0;var A=c.data,L=l.readSPS(A);if(!e.sps||e.width!==L.width||e.height!==L.height||((S=e.pixelRatio)==null?void 0:S[0])!==L.pixelRatio[0]||((x=e.pixelRatio)==null?void 0:x[1])!==L.pixelRatio[1]){e.width=L.width,e.height=L.height,e.pixelRatio=L.pixelRatio,e.sps=[A];for(var _=A.subarray(1,4),k="avc1.",R=0;R<3;R++){var b=_[R].toString(16);b.length<2&&(b="0"+b),k+=b}e.codec=k}break}case 8:d=!0,e.pps=[c.data];break;case 9:d=!0,e.audFound=!0,(g=f)!=null&&g.frame&&(l.pushAccessUnit(f,e),f=null),f||(f=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;case 12:d=!0;break;default:d=!1;break}if(f&&d){var D=f.units;D.push(c)}}),s&&f&&(this.pushAccessUnit(f,e),this.VideoSample=null)},n.getNALuType=function(e,t){return e[t]&31},n.readSliceType=function(e){var t=new Mi(e);return t.readUByte(),t.readUEG(),t.readUEG()},n.skipScalingList=function(e,t){for(var i=8,s=8,l,u=0;u<e;u++)s!==0&&(l=t.readEG(),s=(i+l+256)%256),i=s===0?i:s},n.readSPS=function(e){var t=new Mi(e),i=0,s=0,l=0,u=0,f,d,h,c=t.readUByte.bind(t),v=t.readBits.bind(t),g=t.readUEG.bind(t),m=t.readBoolean.bind(t),y=t.skipBits.bind(t),E=t.skipEG.bind(t),T=t.skipUEG.bind(t),S=this.skipScalingList.bind(this);c();var x=c();if(v(5),y(3),c(),T(),x===100||x===110||x===122||x===244||x===44||x===83||x===86||x===118||x===128){var A=g();if(A===3&&y(1),T(),T(),y(1),m())for(d=A!==3?8:12,h=0;h<d;h++)m()&&(h<6?S(16,t):S(64,t))}T();var L=g();if(L===0)g();else if(L===1)for(y(1),E(),E(),f=g(),h=0;h<f;h++)E();T(),y(1);var _=g(),k=g(),R=v(1);R===0&&y(1),y(1),m()&&(i=g(),s=g(),l=g(),u=g());var b=[1,1];if(m()&&m()){var D=c();switch(D){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:{b=[c()<<8|c(),c()<<8|c()];break}}}return{width:Math.ceil((_+1)*16-i*2-s*2),height:(2-R)*(k+1)*16-(R?2:4)*(l+u),pixelRatio:b}},o}(ko),Po=function(a){function o(){for(var r,e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r=a.call.apply(a,[this].concat(t))||this,r.initVPS=null,r}j(o,a);var n=o.prototype;return n.parsePES=function(e,t,i,s){var l=this,u=this.parseNALu(e,i.data,s),f=this.VideoSample,d,h=!1;i.data=null,f&&u.length&&!e.audFound&&(this.pushAccessUnit(f,e),f=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(function(c){var v,g;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:f||(f=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts)),f.frame=!0,d=!0;break;case 16:case 17:case 18:case 21:if(d=!0,h){var m;(m=f)!=null&&m.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null)}f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0,f.frame=!0;break;case 19:case 20:d=!0,(v=f)!=null&&v.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null),f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0,f.frame=!0;break;case 39:d=!0,Si(c.data,2,i.pts,t.samples);break;case 32:d=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ne(e.params,l.readVPS(c.data)),l.initVPS=c.data),e.vps=[c.data];break;case 33:if(d=!0,h=!0,e.vps!==void 0&&e.vps[0]!==l.initVPS&&e.sps!==void 0&&!l.matchSPS(e.sps[0],c.data)&&(l.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){var y=l.readSPS(c.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(var E in y.params)e.params[E]=y.params[E]}l.pushParameterSet(e.sps,c.data,e.vps),f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0;break;case 34:if(d=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];var T=l.readPPS(c.data);for(var S in T)e.params[S]=T[S]}l.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:d=!0,e.audFound=!0,(g=f)!=null&&g.frame&&(l.pushAccessUnit(f,e),f=null),f||(f=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;default:d=!1;break}if(f&&d){var x=f.units;x.push(c)}}),s&&f&&(this.pushAccessUnit(f,e),this.VideoSample=null)},n.pushParameterSet=function(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)},n.getNALuType=function(e,t){return(e[t]&126)>>>1},n.ebsp2rbsp=function(e){for(var t=new Uint8Array(e.byteLength),i=0,s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[i]=e[s],i++);return new Uint8Array(t.buffer,0,i)},n.pushAccessUnit=function(e,t){a.prototype.pushAccessUnit.call(this,e,t),this.initVPS&&(this.initVPS=null)},n.readVPS=function(e){var t=new Mi(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);var i=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:s}},n.readSPS=function(e){var t=new Mi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);var i=t.readBits(3);t.readBoolean();for(var s=t.readBits(2),l=t.readBoolean(),u=t.readBits(5),f=t.readUByte(),d=t.readUByte(),h=t.readUByte(),c=t.readUByte(),v=t.readUByte(),g=t.readUByte(),m=t.readUByte(),y=t.readUByte(),E=t.readUByte(),T=t.readUByte(),S=t.readUByte(),x=[],A=[],L=0;L<i;L++)x.push(t.readBoolean()),A.push(t.readBoolean());if(i>0)for(var _=i;_<8;_++)t.readBits(2);for(var k=0;k<i;k++)x[k]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),A[k]&&t.readUByte();t.readUEG();var R=t.readUEG();R==3&&t.skipBits(1);var b=t.readUEG(),D=t.readUEG(),C=t.readBoolean(),N=0,O=0,M=0,G=0;C&&(N+=t.readUEG(),O+=t.readUEG(),M+=t.readUEG(),G+=t.readUEG());for(var Y=t.readUEG(),W=t.readUEG(),ie=t.readUEG(),xe=t.readBoolean(),ue=xe?0:i;ue<=i;ue++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();var _e=t.readBoolean();if(_e){var ge=t.readBoolean();if(ge)for(var ke=0;ke<4;ke++)for(var Ce=0;Ce<(ke===3?2:6);Ce++){var Be=t.readBoolean();if(!Be)t.readUEG();else{var tt=Math.min(64,1<<4+(ke<<1));ke>1&&t.readEG();for(var ze=0;ze<tt;ze++)t.readEG()}}}t.readBoolean(),t.readBoolean();var Ye=t.readBoolean();Ye&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());for(var rt=t.readUEG(),je=0,ye=0;ye<rt;ye++){var Tt=!1;if(ye!==0&&(Tt=t.readBoolean()),Tt){ye===rt&&t.readUEG(),t.readBoolean(),t.readUEG();for(var vt=0,ft=0;ft<=je;ft++){var Qe=t.readBoolean(),St=!1;Qe||(St=t.readBoolean()),(Qe||St)&&vt++}je=vt}else{var Xe=t.readUEG(),it=t.readUEG();je=Xe+it;for(var dr=0;dr<Xe;dr++)t.readUEG(),t.readBoolean();for(var Ir=0;Ir<it;Ir++)t.readUEG(),t.readBoolean()}}var zt=t.readBoolean();if(zt)for(var ui=t.readUEG(),ir=0;ir<ui;ir++){for(var wn=0;wn<ie+4;wn++)t.readBits(1);t.readBits(1)}var fi=0,_r=1,di=1,Dr=!0,Mn=1,hi=0;t.readBoolean(),t.readBoolean();var Gi=!1,On=t.readBoolean();if(On){var Ki=t.readBoolean();if(Ki){var xt=t.readUByte(),Fn=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Nn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];xt>0&&xt<16?(_r=Fn[xt-1],di=Nn[xt-1]):xt===255&&(_r=t.readBits(16),di=t.readBits(16))}var ls=t.readBoolean();ls&&t.readBoolean();var us=t.readBoolean();if(us){t.readBits(3),t.readBoolean();var fs=t.readBoolean();fs&&(t.readUByte(),t.readUByte(),t.readUByte())}var ds=t.readBoolean();ds&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Gi=t.readBoolean(),Gi&&(N+=t.readUEG(),O+=t.readUEG(),M+=t.readUEG(),G+=t.readUEG());var hs=t.readBoolean();if(hs){Mn=t.readBits(32),hi=t.readBits(32);var ci=t.readBoolean();ci&&t.readUEG();var Un=t.readBoolean();if(Un){var Bn=t.readBoolean(),Gn=t.readBoolean(),Hi=!1;(Bn||Gn)&&(Hi=t.readBoolean(),Hi&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Hi&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(var Ol=0;Ol<=i;Ol++){Dr=t.readBoolean();var ec=Dr||t.readBoolean(),Fl=!1;ec?t.readEG():Fl=t.readBoolean();var Nl=Fl?1:t.readUEG()+1;if(Bn)for(var Ul=0;Ul<Nl;Ul++)t.readUEG(),t.readUEG(),Hi&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Gn)for(var Bl=0;Bl<Nl;Bl++)t.readUEG(),t.readUEG(),Hi&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}var tc=t.readBoolean();tc&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),fi=t.readUEG())}var Gl=b,Kl=D;if(C||Gi){var Kn=1,cs=1;R===1?Kn=cs=2:R==2&&(Kn=2),Gl=b-Kn*O-Kn*N,Kl=D-cs*G-cs*M}for(var rc=s?["A","B","C"][s]:"",ic=f<<24|d<<16|h<<8|c,vs=0,Hn=0;Hn<32;Hn++)vs=(vs|(ic>>Hn&1)<<31-Hn)>>>0;var gs=vs.toString(16);u===1&&gs==="2"&&(gs="6");var nc=l?"H":"L";return{codecString:"hvc1."+rc+u+"."+gs+"."+nc+S+".B0",params:{general_tier_flag:l,general_profile_idc:u,general_profile_space:s,general_profile_compatibility_flags:[f,d,h,c],general_constraint_indicator_flags:[v,g,m,y,E,T],general_level_idc:S,bit_depth:Y+8,bit_depth_luma_minus8:Y,bit_depth_chroma_minus8:W,min_spatial_segmentation_idc:fi,chroma_format_idc:R,frame_rate:{fixed:Dr,fps:hi/Mn}},width:Gl,height:Kl,pixelRatio:[_r,di]}},n.readPPS=function(e){var t=new Mi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);var i=t.readBoolean();i&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);var s=t.readBoolean(),l=t.readBoolean(),u=1;return l&&s?u=0:l?u=3:s&&(u=2),{parallelismType:u}},n.matchSPS=function(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)},o}(ko),ct=188,Sf=function(){function a(n,r,e,t){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=n,this.config=r,this.typeSupported=e,this.logger=t,this.videoParser=null}a.probe=function(r,e){var t=a.syncOffset(r);return t>0&&e.warn("MPEG2-TS detected but first sync word found @ offset "+t),t!==-1},a.syncOffset=function(r){for(var e=r.length,t=Math.min(ct*5,e-ct)+1,i=0;i<t;){for(var s=!1,l=-1,u=0,f=i;f<e;f+=ct)if(r[f]===71&&(e-f===ct||r[f+ct]===71)){if(u++,l===-1&&(l=f,l!==0&&(t=Math.min(l+ct*99,r.length-ct)+1)),s||(s=Ca(r,f)===0),s&&u>1&&(l===0&&u>2||f+ct>t))return l}else{if(u)return-1;break}i++}return-1},a.createTrack=function(r,e){return{container:r==="video"||r==="audio"?"video/mp2t":void 0,type:r,id:It[r],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:r==="audio"?e:void 0}};var o=a.prototype;return o.resetInitSegment=function(r,e,t,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=a.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=a.createTrack("audio",i),this._id3Track=a.createTrack("id3"),this._txtTrack=a.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=t},o.resetTimeStamp=function(){},o.resetContiguity=function(){var r=this._audioTrack,e=this._videoTrack,t=this._id3Track;r&&(r.pesData=null),e&&(e.pesData=null),t&&(t.pesData=null),this.aacOverFlow=null,this.remainderData=null},o.demux=function(r,e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!1),t||(this.sampleAes=null);var s,l=this._videoTrack,u=this._audioTrack,f=this._id3Track,d=this._txtTrack,h=l.pid,c=l.pesData,v=u.pid,g=f.pid,m=u.pesData,y=f.pesData,E=null,T=this.pmtParsed,S=this._pmtId,x=r.length;if(this.remainderData&&(r=_t(this.remainderData,r),x=r.length,this.remainderData=null),x<ct&&!i)return this.remainderData=r,{audioTrack:u,videoTrack:l,id3Track:f,textTrack:d};var A=Math.max(0,a.syncOffset(r));x-=(x-A)%ct,x<r.byteLength&&!i&&(this.remainderData=new Uint8Array(r.buffer,x,r.buffer.byteLength-x));for(var L=0,_=A;_<x;_+=ct)if(r[_]===71){var k=!!(r[_+1]&64),R=Ca(r,_),b=(r[_+3]&48)>>4,D=void 0;if(b>1){if(D=_+5+r[_+4],D===_+ct)continue}else D=_+4;switch(R){case h:if(k){if(c&&(s=ri(c,this.logger))){if(this.videoParser===null)switch(l.segmentCodec){case"avc":this.videoParser=new Co;break;case"hevc":this.videoParser=new Po;break}this.videoParser!==null&&this.videoParser.parsePES(l,d,s,!1)}c={data:[],size:0}}c&&(c.data.push(r.subarray(D,_+ct)),c.size+=_+ct-D);break;case v:if(k){if(m&&(s=ri(m,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,s);break;case"mp3":this.parseMPEGPES(u,s);break;case"ac3":this.parseAC3PES(u,s);break}m={data:[],size:0}}m&&(m.data.push(r.subarray(D,_+ct)),m.size+=_+ct-D);break;case g:k&&(y&&(s=ri(y,this.logger))&&this.parseID3PES(f,s),y={data:[],size:0}),y&&(y.data.push(r.subarray(D,_+ct)),y.size+=_+ct-D);break;case 0:k&&(D+=r[D]+1),S=this._pmtId=xf(r,D);break;case S:{k&&(D+=r[D]+1);var C=Af(r,D,this.typeSupported,t,this.observer,this.logger);h=C.videoPid,h>0&&(l.pid=h,l.segmentCodec=C.segmentVideoCodec),v=C.audioPid,v>0&&(u.pid=v,u.segmentCodec=C.segmentAudioCodec),g=C.id3Pid,g>0&&(f.pid=g),E!==null&&!T&&(this.logger.warn("MPEG-TS PMT found at "+_+" after unknown PID '"+E+"'. Backtracking to sync byte @"+A+" to parse all TS packets."),E=null,_=A-188),T=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=R;break}}else L++;L>0&&Pa(this.observer,new Error("Found "+L+" TS packet/s that do not start with 0x47"),void 0,this.logger),l.pesData=c,u.pesData=m,f.pesData=y;var N={audioTrack:u,videoTrack:l,id3Track:f,textTrack:d};return i&&this.extractRemainingSamples(N),N},o.flush=function(){var r=this.remainderData;this.remainderData=null;var e;return r?e=this.demux(r,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},o.extractRemainingSamples=function(r){var e=r.audioTrack,t=r.videoTrack,i=r.id3Track,s=r.textTrack,l=t.pesData,u=e.pesData,f=i.pesData,d;if(l&&(d=ri(l,this.logger))){if(this.videoParser===null)switch(t.segmentCodec){case"avc":this.videoParser=new Co;break;case"hevc":this.videoParser=new Po;break}this.videoParser!==null&&(this.videoParser.parsePES(t,s,d,!0),t.pesData=null)}else t.pesData=l;if(u&&(d=ri(u,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,d);break;case"mp3":this.parseMPEGPES(e,d);break;case"ac3":this.parseAC3PES(e,d);break}e.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=u;f&&(d=ri(f,this.logger))?(this.parseID3PES(i,d),i.pesData=null):i.pesData=f},o.demuxSampleAes=function(r,e,t){var i=this.demux(r,t,!0,!this.config.progressive),s=this.sampleAes=new Tf(this.observer,this.config,e);return this.decrypt(i,s)},o.decrypt=function(r,e){return new Promise(function(t){var i=r.audioTrack,s=r.videoTrack;i.samples&&i.segmentCodec==="aac"?e.decryptAacSamples(i.samples,0,function(){s.samples?e.decryptAvcSamples(s.samples,0,0,function(){t(r)}):t(r)}):s.samples&&e.decryptAvcSamples(s.samples,0,0,function(){t(r)})})},o.destroy=function(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0},o.parseAACPES=function(r,e){var t=0,i=this.aacOverFlow,s=e.data;if(i){this.aacOverFlow=null;var l=i.missing,u=i.sample.unit.byteLength;if(l===-1)s=_t(i.sample.unit,s);else{var f=u-l;i.sample.unit.set(s.subarray(0,l),f),r.samples.push(i.sample),t=i.missing}}var d,h;for(d=t,h=s.length;d<h-1&&!En(s,d);d++);if(d!==t){var c,v=d<h-1;if(v?c="AAC PES did not start with ADTS header,offset:"+d:c="No ADTS header found in AAC PES",Pa(this.observer,new Error(c),v,this.logger),!v)return}po(r,this.observer,s,d,this.audioCodec);var g;if(e.pts!==void 0)g=e.pts;else if(i){var m=yo(r.samplerate);g=i.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var y=0,E;d<h;)if(E=Eo(r,s,d,g,y),d+=E.length,E.missing){this.aacOverFlow=E;break}else for(y++;d<h-1&&!En(s,d);d++);},o.parseMPEGPES=function(r,e){var t=e.data,i=t.length,s=0,l=0,u=e.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<i;)if(bo(t,l)){var f=Ao(r,t,l,u,s);if(f)l+=f.length,s++;else break}else l++},o.parseAC3PES=function(r,e){{var t=e.data,i=e.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}for(var s=t.length,l=0,u=0,f;u<s&&(f=_o(r,t,u,i,l++))>0;)u+=f}},o.parseID3PES=function(r,e){if(e.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var t=ne({},e,{type:this._videoTrack?Ht.emsg:Ht.audioId3,duration:Number.POSITIVE_INFINITY});r.samples.push(t)},a}();function Ca(a,o){return((a[o+1]&31)<<8)+a[o+2]}function xf(a,o){return(a[o+10]&31)<<8|a[o+11]}function Af(a,o,n,r,e,t){var i={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},s=(a[o+1]&15)<<8|a[o+2],l=o+3+s-4,u=(a[o+10]&15)<<8|a[o+11];for(o+=12+u;o<l;){var f=Ca(a,o),d=(a[o+3]&15)<<8|a[o+4];switch(a[o]){case 207:if(!r){wa("ADTS AAC",t);break}case 15:i.audioPid===-1&&(i.audioPid=f);break;case 21:i.id3Pid===-1&&(i.id3Pid=f);break;case 219:if(!r){wa("H.264",t);break}case 27:i.videoPid===-1&&(i.videoPid=f);break;case 3:case 4:!n.mpeg&&!n.mp3?t.log("MPEG audio found, not supported in this browser"):i.audioPid===-1&&(i.audioPid=f,i.segmentAudioCodec="mp3");break;case 193:if(!r){wa("AC-3",t);break}case 129:n.ac3?i.audioPid===-1&&(i.audioPid=f,i.segmentAudioCodec="ac3"):t.log("AC-3 audio found, not supported in this browser");break;case 6:if(i.audioPid===-1&&d>0)for(var h=o+5,c=d;c>2;){var v=a[h];switch(v){case 106:n.ac3!==!0?t.log("AC-3 audio found, not supported in this browser for now"):(i.audioPid=f,i.segmentAudioCodec="ac3");break}var g=a[h+1]+2;h+=g,c-=g}break;case 194:case 135:return Pa(e,new Error("Unsupported EC-3 in M2TS found"),void 0,t),i;case 36:i.videoPid===-1&&(i.videoPid=f,i.segmentVideoCodec="hevc",t.log("HEVC in M2TS found"));break}o+=d+5}return i}function Pa(a,o,n,r){r.warn("parsing error: "+o.message),a.emit(p.ERROR,p.ERROR,{type:B.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:o,reason:o.message})}function wa(a,o){o.log(a+" with AES-128-CBC encryption found in unencrypted stream")}function ri(a,o){var n=0,r,e,t,i,s,l=a.data;if(!a||a.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=_t(l[0],l[1]),l.splice(1,1);r=l[0];var u=(r[0]<<16)+(r[1]<<8)+r[2];if(u===1){if(e=(r[4]<<8)+r[5],e&&e>a.size-6)return null;var f=r[7];f&192&&(i=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,f&64?(s=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,i-s>60*9e4&&(o.warn(Math.round((i-s)/9e4)+"s delta between PTS and DTS, align them"),i=s)):s=i),t=r[8];var d=t+9;if(a.size<=d)return null;a.size-=d;for(var h=new Uint8Array(a.size),c=0,v=l.length;c<v;c++){r=l[c];var g=r.byteLength;if(d)if(d>g){d-=g;continue}else r=r.subarray(d),g-=d,d=0;h.set(r,n),n+=g}return e&&(e-=t+3),{data:h,pts:i,dts:s,len:e}}return null}var Lf=function(){function a(){}return a.getSilentFrame=function(n,r){switch(n){case"mp4a.40.2":if(r===1)return new Uint8Array([0,200,0,128,35,128]);if(r===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(r===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(r===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(r===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(r===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(r===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},a}(),br=Math.pow(2,32)-1,Et=function(){function a(){}return a.init=function(){a.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var n;for(n in a.types)a.types.hasOwnProperty(n)&&(a.types[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:r,audio:e};var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=i,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,s,u,s,l),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,t))},a.box=function(n){for(var r=8,e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];for(var s=t.length,l=s;s--;)r+=t[s].byteLength;var u=new Uint8Array(r);for(u[0]=r>>24&255,u[1]=r>>16&255,u[2]=r>>8&255,u[3]=r&255,u.set(n,4),s=0,r=8;s<l;s++)u.set(t[s],r),r+=t[s].byteLength;return u},a.hdlr=function(n){return a.box(a.types.hdlr,a.HDLR_TYPES[n])},a.mdat=function(n){return a.box(a.types.mdat,n)},a.mdhd=function(n,r){r*=n;var e=Math.floor(r/(br+1)),t=Math.floor(r%(br+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255,t>>24,t>>16&255,t>>8&255,t&255,85,196,0,0]))},a.mdia=function(n){return a.box(a.types.mdia,a.mdhd(n.timescale||0,n.duration||0),a.hdlr(n.type),a.minf(n))},a.mfhd=function(n){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255]))},a.minf=function(n){return n.type==="audio"?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(n)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(n))},a.moof=function(n,r,e){return a.box(a.types.moof,a.mfhd(n),a.traf(e,r))},a.moov=function(n){for(var r=n.length,e=[];r--;)e[r]=a.trak(n[r]);return a.box.apply(null,[a.types.moov,a.mvhd(n[0].timescale||0,n[0].duration||0)].concat(e).concat(a.mvex(n)))},a.mvex=function(n){for(var r=n.length,e=[];r--;)e[r]=a.trex(n[r]);return a.box.apply(null,[a.types.mvex].concat(e))},a.mvhd=function(n,r){r*=n;var e=Math.floor(r/(br+1)),t=Math.floor(r%(br+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255,t>>24,t>>16&255,t>>8&255,t&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,i)},a.sdtp=function(n){var r=n.samples||[],e=new Uint8Array(4+r.length),t,i;for(t=0;t<r.length;t++)i=r[t].flags,e[t+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return a.box(a.types.sdtp,e)},a.stbl=function(n){return a.box(a.types.stbl,a.stsd(n),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(n){var r=[],e=[],t,i,s;for(t=0;t<n.sps.length;t++)i=n.sps[t],s=i.byteLength,r.push(s>>>8&255),r.push(s&255),r=r.concat(Array.prototype.slice.call(i));for(t=0;t<n.pps.length;t++)i=n.pps[t],s=i.byteLength,e.push(s>>>8&255),e.push(s&255),e=e.concat(Array.prototype.slice.call(i));var l=a.box(a.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|n.sps.length].concat(r).concat([n.pps.length]).concat(e))),u=n.width,f=n.height,d=n.pixelRatio[0],h=n.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,h>>24,h>>16&255,h>>8&255,h&255])))},a.esds=function(n){var r=n.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2].concat(r,[6,1,2]))},a.audioStsd=function(n){var r=n.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount||0,0,16,0,0,0,0,r>>8&255,r&255,0,0])},a.mp4a=function(n){return a.box(a.types.mp4a,a.audioStsd(n),a.box(a.types.esds,a.esds(n)))},a.mp3=function(n){return a.box(a.types[".mp3"],a.audioStsd(n))},a.ac3=function(n){return a.box(a.types["ac-3"],a.audioStsd(n),a.box(a.types.dac3,n.config))},a.stsd=function(n){var r=n.segmentCodec;if(n.type==="audio"){if(r==="aac")return a.box(a.types.stsd,a.STSD,a.mp4a(n));if(r==="ac3"&&n.config)return a.box(a.types.stsd,a.STSD,a.ac3(n));if(r==="mp3"&&n.codec==="mp3")return a.box(a.types.stsd,a.STSD,a.mp3(n))}else if(n.pps&&n.sps){if(r==="avc")return a.box(a.types.stsd,a.STSD,a.avc1(n));if(r==="hevc"&&n.vps)return a.box(a.types.stsd,a.STSD,a.hvc1(n))}else throw new Error("video track missing pps or sps");throw new Error("unsupported "+n.type+" segment codec ("+r+"/"+n.codec+")")},a.tkhd=function(n){var r=n.id,e=(n.duration||0)*(n.timescale||0),t=n.width||0,i=n.height||0,s=Math.floor(e/(br+1)),l=Math.floor(e%(br+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,t>>8&255,t&255,0,0,i>>8&255,i&255,0,0]))},a.traf=function(n,r){var e=a.sdtp(n),t=n.id,i=Math.floor(r/(br+1)),s=Math.floor(r%(br+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255])),a.trun(n,e.length+16+20+8+16+8+8),e)},a.trak=function(n){return n.duration=n.duration||4294967295,a.box(a.types.trak,a.tkhd(n),a.mdia(n))},a.trex=function(n){var r=n.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(n,r){var e=n.samples||[],t=e.length,i=12+16*t,s=new Uint8Array(i),l,u,f,d,h,c;for(r+=8+i,s.set([n.type==="video"?1:0,0,15,1,t>>>24&255,t>>>16&255,t>>>8&255,t&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0),l=0;l<t;l++)u=e[l],f=u.duration,d=u.size,h=u.flags,c=u.cts,s.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,c>>>24&255,c>>>16&255,c>>>8&255,c&255],12+16*l);return a.box(a.types.trun,s)},a.initSegment=function(n){a.types||a.init();var r=a.moov(n),e=_t(a.FTYP,r);return e},a.hvc1=function(n){for(var r=n.params,e=[n.vps,n.sps,n.pps],t=4,i=new Uint8Array([1,r.general_profile_space<<6|(r.general_tier_flag?32:0)|r.general_profile_idc,r.general_profile_compatibility_flags[0],r.general_profile_compatibility_flags[1],r.general_profile_compatibility_flags[2],r.general_profile_compatibility_flags[3],r.general_constraint_indicator_flags[0],r.general_constraint_indicator_flags[1],r.general_constraint_indicator_flags[2],r.general_constraint_indicator_flags[3],r.general_constraint_indicator_flags[4],r.general_constraint_indicator_flags[5],r.general_level_idc,240|r.min_spatial_segmentation_idc>>8,255&r.min_spatial_segmentation_idc,252|r.parallelismType,252|r.chroma_format_idc,248|r.bit_depth_luma_minus8,248|r.bit_depth_chroma_minus8,0,parseInt(r.frame_rate.fps),t-1|r.temporal_id_nested<<2|r.num_temporal_layers<<3|(r.frame_rate.fixed?64:0),e.length]),s=i.length,l=0;l<e.length;l+=1){s+=3;for(var u=0;u<e[l].length;u+=1)s+=2+e[l][u].length}var f=new Uint8Array(s);f.set(i,0),s=i.length;for(var d=e.length-1,h=0;h<e.length;h+=1){f.set(new Uint8Array([32+h|(h===d?128:0),0,e[h].length]),s),s+=3;for(var c=0;c<e[h].length;c+=1)f.set(new Uint8Array([e[h][c].length>>8,e[h][c].length&255]),s),s+=2,f.set(e[h][c],s),s+=e[h][c].length}var v=a.box(a.types.hvcC,f),g=n.width,m=n.height,y=n.pixelRatio[0],E=n.pixelRatio[1];return a.box(a.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),v,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,E>>24,E>>16&255,E>>8&255,E&255])))},a}();Et.types=void 0,Et.HDLR_TYPES=void 0,Et.STTS=void 0,Et.STSC=void 0,Et.STCO=void 0,Et.STSZ=void 0,Et.VMHD=void 0,Et.SMHD=void 0,Et.STSD=void 0,Et.FTYP=void 0,Et.DINF=void 0;var wo=9e4;function Ma(a,o,n,r){n===void 0&&(n=1),r===void 0&&(r=!1);var e=a*o*n;return r?Math.round(e):e}function bf(a,o,n,r){return n===void 0&&(n=1),r===void 0&&(r=!1),Ma(a,o,1/n,r)}function Oi(a,o){return Ma(a,1e3,1/wo,o)}function Rf(a,o){return o===void 0&&(o=1),Ma(a,wo,1/o)}var If=10*1e3,_f=1024,Df=1152,kf=1536,ii=null,Oa=null;function Mo(a,o,n,r){return{duration:o,size:n,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}var xn=function(){function a(n,r,e,t){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=n,this.config=r,this.typeSupported=e,this.logger=t,this.ISGenerated=!1,ii===null){var i=navigator.userAgent||"",s=i.match(/Chrome\/(\d+)/i);ii=s?parseInt(s[1]):0}if(Oa===null){var l=navigator.userAgent.match(/Safari\/(\d+)/i);Oa=l?parseInt(l[1]):0}}var o=a.prototype;return o.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},o.resetTimeStamp=function(r){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=r},o.resetNextTimestamp=function(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},o.resetInitSegment=function(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},o.getVideoStartPts=function(r){var e=!1,t=r[0].pts,i=r.reduce(function(s,l){var u=l.pts,f=u-s;return f<-4294967296&&(e=!0,u=jt(u,t),f=u-s),f>0?s:u},t);return e&&this.logger.debug("PTS rollover detected"),i},o.remux=function(r,e,t,i,s,l,u,f){var d,h,c,v,g,m,y=s,E=s,T=r.pid>-1,S=e.pid>-1,x=e.samples.length,A=r.samples.length>0,L=u&&x>0||x>1,_=(!T||A)&&(!S||L)||this.ISGenerated||u;if(_){if(this.ISGenerated){var k,R,b,D,C=this.videoTrackConfig;(C&&(e.width!==C.width||e.height!==C.height||((k=e.pixelRatio)==null?void 0:k[0])!==((R=C.pixelRatio)==null?void 0:R[0])||((b=e.pixelRatio)==null?void 0:b[1])!==((D=C.pixelRatio)==null?void 0:D[1]))||!C&&L||this.nextAudioPts===null&&A)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(r,e,s,l));var N=this.isVideoContiguous,O=-1,M;if(L&&(O=Cf(e.samples),!N&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,O>0){this.logger.warn("[mp4-remuxer]: Dropped "+O+" out of "+x+" video samples due to a missing keyframe");var G=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(O),e.dropped+=O,E+=(e.samples[0].pts-G)/e.inputTimeScale,M=E}else O===-1&&(this.logger.warn("[mp4-remuxer]: No keyframe found out of "+x+" video samples"),m=!1);if(this.ISGenerated){if(A&&L){var Y=this.getVideoStartPts(e.samples),W=jt(r.samples[0].pts,Y)-Y,ie=W/e.inputTimeScale;y+=Math.max(0,ie),E+=Math.max(0,-ie)}if(A){if(r.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(r,e,s,l)),h=this.remuxAudio(r,y,this.isAudioContiguous,l,S||L||f===K.AUDIO?E:void 0),L){var xe=h?h.endPTS-h.startPTS:0;e.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(r,e,s,l)),d=this.remuxVideo(e,E,N,xe)}}else L&&(d=this.remuxVideo(e,E,N,0));d&&(d.firstKeyFrame=O,d.independent=O!==-1,d.firstKeyFramePTS=M)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(t.samples.length&&(g=Oo(t,s,this._initPTS,this._initDTS)),i.samples.length&&(v=Fo(i,s,this._initPTS))),{audio:h,video:d,initSegment:c,independent:m,text:v,id3:g}},o.generateIS=function(r,e,t,i){var s=r.samples,l=e.samples,u=this.typeSupported,f={},d=this._initPTS,h=!d||i,c="audio/mp4",v,g,m;if(h&&(v=g=1/0),r.config&&s.length){switch(r.timescale=r.samplerate,r.segmentCodec){case"mp3":u.mpeg?(c="audio/mpeg",r.codec=""):u.mp3&&(r.codec="mp3");break;case"ac3":r.codec="ac-3";break}f.audio={id:"audio",container:c,codec:r.codec,initSegment:r.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):Et.initSegment([r]),metadata:{channelCount:r.channelCount}},h&&(m=r.inputTimeScale,!d||m!==d.timescale?v=g=s[0].pts-Math.round(m*t):h=!1)}if(e.sps&&e.pps&&l.length){if(e.timescale=e.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Et.initSegment([e]),metadata:{width:e.width,height:e.height}},h)if(m=e.inputTimeScale,!d||m!==d.timescale){var y=this.getVideoStartPts(l),E=Math.round(m*t);g=Math.min(g,jt(l[0].dts,y)-E),v=Math.min(v,y-E)}else h=!1;this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:v,timescale:m},this._initDTS={baseTime:g,timescale:m}):v=m=void 0,{tracks:f,initPTS:v,timescale:m}},o.remuxVideo=function(r,e,t,i){var s=r.inputTimeScale,l=r.samples,u=[],f=l.length,d=this._initPTS,h=this.nextAvcDts,c=8,v=this.videoSampleDuration,g,m,y=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,T=!1;if(!t||h===null){var S=e*s,x=l[0].pts-jt(l[0].dts,l[0].pts);ii&&h!==null&&Math.abs(S-x-h)<15e3?t=!0:h=S-x}for(var A=d.baseTime*s/d.timescale,L=0;L<f;L++){var _=l[L];_.pts=jt(_.pts-A,h),_.dts=jt(_.dts-A,h),_.dts<l[L>0?L-1:L].dts&&(T=!0)}T&&l.sort(function(ci,Un){var Bn=ci.dts-Un.dts,Gn=ci.pts-Un.pts;return Bn||Gn}),g=l[0].dts,m=l[l.length-1].dts;var k=m-g,R=k?Math.round(k/(f-1)):v||r.inputTimeScale/30;if(t){var b=g-h,D=b>R,C=b<-1;if((D||C)&&(D?this.logger.warn((r.segmentCodec||"").toUpperCase()+": "+Oi(b,!0)+" ms ("+b+"dts) hole between fragments detected at "+e.toFixed(3)):this.logger.warn((r.segmentCodec||"").toUpperCase()+": "+Oi(-b,!0)+" ms ("+b+"dts) overlapping between fragments detected at "+e.toFixed(3)),!C||h>=l[0].pts||ii)){g=h;var N=l[0].pts-b;if(D)l[0].dts=g,l[0].pts=N;else for(var O=!0,M=0;M<l.length&&!(l[M].dts>N&&O);M++){var G=l[M].pts;if(l[M].dts-=b,l[M].pts-=b,M<l.length-1){var Y=l[M+1].pts,W=l[M].pts,ie=Y<=W,xe=Y<=G;O=ie==xe}}this.logger.log("Video: Initial PTS/DTS adjusted: "+Oi(N,!0)+"/"+Oi(g,!0)+", delta: "+Oi(b,!0)+" ms")}}g=Math.max(0,g);for(var ue=0,_e=0,ge=g,ke=0;ke<f;ke++){for(var Ce=l[ke],Be=Ce.units,tt=Be.length,ze=0,Ye=0;Ye<tt;Ye++)ze+=Be[Ye].data.length;_e+=ze,ue+=tt,Ce.length=ze,Ce.dts<ge?(Ce.dts=ge,ge+=R/4|0||1):ge=Ce.dts,y=Math.min(Ce.pts,y),E=Math.max(Ce.pts,E)}m=l[f-1].dts;var rt=_e+4*ue+8,je;try{je=new Uint8Array(rt)}catch(ci){this.observer.emit(p.ERROR,p.ERROR,{type:B.MUX_ERROR,details:I.REMUX_ALLOC_ERROR,fatal:!1,error:ci,bytes:rt,reason:"fail allocating video mdat "+rt});return}var ye=new DataView(je.buffer);ye.setUint32(0,rt),je.set(Et.types.mdat,4);for(var Tt=!1,vt=Number.POSITIVE_INFINITY,ft=Number.POSITIVE_INFINITY,Qe=Number.NEGATIVE_INFINITY,St=Number.NEGATIVE_INFINITY,Xe=0;Xe<f;Xe++){for(var it=l[Xe],dr=it.units,Ir=0,zt=0,ui=dr.length;zt<ui;zt++){var ir=dr[zt],wn=ir.data,fi=ir.data.byteLength;ye.setUint32(c,fi),c+=4,je.set(wn,c),c+=fi,Ir+=4+fi}var _r=void 0;if(Xe<f-1)v=l[Xe+1].dts-it.dts,_r=l[Xe+1].pts-it.pts;else{var di=this.config,Dr=Xe>0?it.dts-l[Xe-1].dts:R;if(_r=Xe>0?it.pts-l[Xe-1].pts:R,di.stretchShortVideoTrack&&this.nextAudioPts!==null){var Mn=Math.floor(di.maxBufferHole*s),hi=(i?y+i*s:this.nextAudioPts)-it.pts;hi>Mn?(v=hi-Dr,v<0?v=Dr:Tt=!0,this.logger.log("[mp4-remuxer]: It is approximately "+hi/90+" ms to the next segment; using duration "+v/90+" ms for the last video frame.")):v=Dr}else v=Dr}var Gi=Math.round(it.pts-it.dts);vt=Math.min(vt,v),Qe=Math.max(Qe,v),ft=Math.min(ft,_r),St=Math.max(St,_r),u.push(Mo(it.key,v,Ir,Gi))}if(u.length){if(ii){if(ii<70){var On=u[0].flags;On.dependsOn=2,On.isNonSync=0}}else if(Oa&&St-ft<Qe-vt&&R/Qe<.025&&u[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Ki=g,xt=0,Fn=u.length;xt<Fn;xt++){var Nn=Ki+u[xt].duration,ls=Ki+u[xt].cts;if(xt<Fn-1){var us=Nn+u[xt+1].cts;u[xt].duration=us-ls}else u[xt].duration=xt?u[xt-1].duration:R;u[xt].cts=0,Ki=Nn}}}v=Tt||!v?R:v,this.nextAvcDts=h=m+v,this.videoSampleDuration=v,this.isVideoContiguous=!0;var fs=Et.moof(r.sequenceNumber++,g,ne(r,{samples:u})),ds="video",hs={data1:fs,data2:je,startPTS:y/s,endPTS:(E+v)/s,startDTS:g/s,endDTS:h/s,type:ds,hasAudio:!1,hasVideo:!0,nb:u.length,dropped:r.dropped};return r.samples=[],r.dropped=0,hs},o.getSamplesPerFrame=function(r){switch(r.segmentCodec){case"mp3":return Df;case"ac3":return kf;default:return _f}},o.remuxAudio=function(r,e,t,i,s){var l=r.inputTimeScale,u=r.samplerate?r.samplerate:l,f=l/u,d=this.getSamplesPerFrame(r),h=d*f,c=this._initPTS,v=r.segmentCodec==="mp3"&&this.typeSupported.mpeg,g=[],m=s!==void 0,y=r.samples,E=v?0:8,T=this.nextAudioPts||-1,S=e*l,x=c.baseTime*l/c.timescale;if(this.isAudioContiguous=t=t||y.length&&T>0&&(i&&Math.abs(S-T)<9e3||Math.abs(jt(y[0].pts-x,S)-T)<20*h),y.forEach(function(Qe){Qe.pts=jt(Qe.pts-x,S)}),!t||T<0){if(y=y.filter(function(Qe){return Qe.pts>=0}),!y.length)return;s===0?T=0:i&&!m?T=Math.max(0,S):T=y[0].pts}if(r.segmentCodec==="aac")for(var A=this.config.maxAudioFramesDrift,L=0,_=T;L<y.length;L++){var k=y[L],R=k.pts,b=R-_,D=Math.abs(1e3*b/l);if(b<=-A*h&&m)L===0&&(this.logger.warn("Audio frame @ "+(R/l).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*b/l)+" ms."),this.nextAudioPts=T=_=R);else if(b>=A*h&&D<If&&m){var C=Math.round(b/h);_=R-C*h,_<0&&(C--,_+=h),L===0&&(this.nextAudioPts=T=_),this.logger.warn("[mp4-remuxer]: Injecting "+C+" audio frame @ "+(_/l).toFixed(3)+"s due to "+Math.round(1e3*b/l)+" ms gap.");for(var N=0;N<C;N++){var O=Math.max(_,0),M=Lf.getSilentFrame(r.parsedCodec||r.manifestCodec||r.codec,r.channelCount);M||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),M=k.unit.subarray()),y.splice(L,0,{unit:M,pts:O}),_+=h,L++}}k.pts=_,_+=h}for(var G=null,Y=null,W,ie=0,xe=y.length;xe--;)ie+=y[xe].unit.byteLength;for(var ue=0,_e=y.length;ue<_e;ue++){var ge=y[ue],ke=ge.unit,Ce=ge.pts;if(Y!==null){var Be=g[ue-1];Be.duration=Math.round((Ce-Y)/f)}else if(t&&r.segmentCodec==="aac"&&(Ce=T),G=Ce,ie>0){ie+=E;try{W=new Uint8Array(ie)}catch(Qe){this.observer.emit(p.ERROR,p.ERROR,{type:B.MUX_ERROR,details:I.REMUX_ALLOC_ERROR,fatal:!1,error:Qe,bytes:ie,reason:"fail allocating audio mdat "+ie});return}if(!v){var tt=new DataView(W.buffer);tt.setUint32(0,ie),W.set(Et.types.mdat,4)}}else return;W.set(ke,E);var ze=ke.byteLength;E+=ze,g.push(Mo(!0,d,ze,0)),Y=Ce}var Ye=g.length;if(Ye){var rt=g[g.length-1];this.nextAudioPts=T=Y+f*rt.duration;var je=v?new Uint8Array(0):Et.moof(r.sequenceNumber++,G/f,ne({},r,{samples:g}));r.samples=[];var ye=G/l,Tt=T/l,vt="audio",ft={data1:je,data2:W,startPTS:ye,endPTS:Tt,startDTS:ye,endDTS:Tt,type:vt,hasAudio:!0,hasVideo:!1,nb:Ye};return this.isAudioContiguous=!0,ft}},a}();function jt(a,o){var n;if(o===null)return a;for(o<a?n=-8589934592:n=8589934592;Math.abs(a-o)>4294967296;)a+=n;return a}function Cf(a){for(var o=0;o<a.length;o++)if(a[o].key)return o;return-1}function Oo(a,o,n,r){var e=a.samples.length;if(e){for(var t=a.inputTimeScale,i=0;i<e;i++){var s=a.samples[i];s.pts=jt(s.pts-n.baseTime*t/n.timescale,o*t)/t,s.dts=jt(s.dts-r.baseTime*t/r.timescale,o*t)/t}var l=a.samples;return a.samples=[],{samples:l}}}function Fo(a,o,n){var r=a.samples.length;if(r){for(var e=a.inputTimeScale,t=0;t<r;t++){var i=a.samples[t];i.pts=jt(i.pts-n.baseTime*e/n.timescale,o*e)/e}a.samples.sort(function(l,u){return l.pts-u.pts});var s=a.samples;return a.samples=[],{samples:s}}}var Pf=function(){function a(n,r,e,t){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=t}var o=a.prototype;return o.destroy=function(){},o.resetTimeStamp=function(r){this.initPTS=r,this.lastEndTime=null},o.resetNextTimestamp=function(){this.lastEndTime=null},o.resetInitSegment=function(r,e,t,i){this.audioCodec=e,this.videoCodec=t,this.generateInitSegment(zn(r,i)),this.emitInitSegment=!0},o.generateInitSegment=function(r){var e=this.audioCodec,t=this.videoCodec;if(!(r!=null&&r.byteLength)){this.initTracks=void 0,this.initData=void 0;return}var i=this.initData=jr(r);i.audio&&(e=No(i.audio,be.AUDIO)),i.video&&(t=No(i.video,be.VIDEO));var s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:e+","+t,supplemental:i.video.supplemental,initSegment:r,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:e,initSegment:r,id:"audio"}:i.video?s.video={container:"video/mp4",codec:t,supplemental:i.video.supplemental,initSegment:r,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s},o.remux=function(r,e,t,i,s,l){var u,f,d=this.initPTS,h=this.lastEndTime,c={audio:void 0,video:void 0,text:i,id3:t,initSegment:void 0};U(h)||(h=this.lastEndTime=s||0);var v=e.samples;if(!(v!=null&&v.length))return c;var g={initPTS:void 0,timescale:1},m=this.initData;if((u=m)!=null&&u.length||(this.generateInitSegment(v),m=this.initData),!((f=m)!=null&&f.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);var y=Qn(v,m),E=yi(m,v),T=E===null?s:E;(l||!d)&&(wf(d,T,s,y)||g.timescale!==d.timescale)&&(g.initPTS=T-s,d&&d.timescale===1&&this.logger.warn("Adjusting initPTS @"+s+" from "+d.baseTime/d.timescale+" to "+g.initPTS),this.initPTS=d={baseTime:g.initPTS,timescale:1});var S=r?T-d.baseTime/d.timescale:h,x=S+y;Ti(m,v,d.baseTime/d.timescale),y>0?this.lastEndTime=x:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var A=!!m.audio,L=!!m.video,_="";A&&(_+="audio"),L&&(_+="video");var k={data1:v,startPTS:S,startDTS:S,endPTS:x,endDTS:x,type:_,hasAudio:A,hasVideo:L,nb:1,dropped:0};return c.audio=k.type==="audio"?k:void 0,c.video=k.type!=="audio"?k:void 0,c.initSegment=g,c.id3=Oo(t,s,d,d),i.samples.length&&(c.text=Fo(i,s,d)),c},a}();function wf(a,o,n,r){if(a===null)return!0;var e=Math.max(r,1),t=o-a.baseTime/a.timescale;return Math.abs(t-n)>e}function No(a,o){var n=a==null?void 0:a.codec;if(n&&n.length>4)return n;if(o===be.AUDIO){if(n==="ec-3"||n==="ac-3"||n==="alac")return n;if(n==="fLaC"||n==="Opus"){var r=!1;return Jr(n,r)}return le.warn('Unhandled audio codec "'+n+'" in mp4 MAP'),n||"mp4a"}return le.warn('Unhandled video codec "'+n+'" in mp4 MAP'),n||"avc1"}var pr;try{pr=self.performance.now.bind(self.performance)}catch{pr=Date.now}var An=[{demux:Ef,remux:Pf},{demux:Sf,remux:xn},{demux:gf,remux:xn},{demux:pf,remux:xn}];An.splice(2,0,{demux:mf,remux:xn});var Fa=function(){function a(n,r,e,t,i,s){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=n,this.typeSupported=r,this.config=e,this.id=i,this.logger=s}var o=a.prototype;return o.configure=function(r){this.transmuxConfig=r,this.decrypter&&this.decrypter.reset()},o.push=function(r,e,t,i){var s=this,l=t.transmuxing;l.executeStart=pr();var u=new Uint8Array(r),f=this.currentTransmuxState,d=this.transmuxConfig;i&&(this.currentTransmuxState=i);var h=i||f,c=h.contiguous,v=h.discontinuity,g=h.trackSwitch,m=h.accurateTimeOffset,y=h.timeOffset,E=h.initSegmentChange,T=d.audioCodec,S=d.videoCodec,x=d.defaultInitPts,A=d.duration,L=d.initSegmentData,_=Mf(u,e);if(_&&ti(_.method)){var k=this.getDecrypter(),R=ca(_.method);if(k.isSync()){var b=k.softwareDecrypt(u,_.key.buffer,_.iv.buffer,R),D=t.part>-1;if(D){var C=k.flush();b=C&&C.buffer}if(!b)return l.executeEnd=pr(),Na(t);u=new Uint8Array(b)}else return this.asyncResult=!0,this.decryptionPromise=k.webCryptoDecrypt(u,_.key.buffer,_.iv.buffer,R).then(function(Y){var W=s.push(Y,null,t);return s.decryptionPromise=null,W}),this.decryptionPromise}var N=this.needsProbing(v,g);if(N){var O=this.configureTransmuxer(u);if(O)return this.logger.warn("[transmuxer] "+O.message),this.observer.emit(p.ERROR,p.ERROR,{type:B.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,error:O,reason:O.message}),l.executeEnd=pr(),Na(t)}(v||g||E||N)&&this.resetInitSegment(L,T,S,A,e),(v||E||N)&&this.resetInitialTimestamp(x),c||this.resetContiguity();var M=this.transmux(u,_,y,m,t);this.asyncResult=Hr(M);var G=this.currentTransmuxState;return G.contiguous=!0,G.discontinuity=!1,G.trackSwitch=!1,l.executeEnd=pr(),M},o.flush=function(r){var e=this,t=r.transmuxing;t.executeStart=pr();var i=this.decrypter,s=this.currentTransmuxState,l=this.decryptionPromise;if(l)return this.asyncResult=!0,l.then(function(){return e.flush(r)});var u=[],f=s.timeOffset;if(i){var d=i.flush();d&&u.push(this.push(d.buffer,null,r))}var h=this.demuxer,c=this.remuxer;if(!h||!c){t.executeEnd=pr();var v=[Na(r)];return this.asyncResult?Promise.resolve(v):v}var g=h.flush(f);return Hr(g)?(this.asyncResult=!0,g.then(function(m){return e.flushRemux(u,m,r),u})):(this.flushRemux(u,g,r),this.asyncResult?Promise.resolve(u):u)},o.flushRemux=function(r,e,t){var i=e.audioTrack,s=e.videoTrack,l=e.id3Track,u=e.textTrack,f=this.currentTransmuxState,d=f.accurateTimeOffset,h=f.timeOffset;this.logger.log("[transmuxer.ts]: Flushed "+this.id+" sn: "+t.sn+(t.part>-1?" part: "+t.part:"")+" of "+(this.id===K.MAIN?"level":"track")+" "+t.level);var c=this.remuxer.remux(i,s,l,u,h,d,!0,this.id);r.push({remuxResult:c,chunkMeta:t}),t.transmuxing.executeEnd=pr()},o.resetInitialTimestamp=function(r){var e=this.demuxer,t=this.remuxer;!e||!t||(e.resetTimeStamp(r),t.resetTimeStamp(r))},o.resetContiguity=function(){var r=this.demuxer,e=this.remuxer;!r||!e||(r.resetContiguity(),e.resetNextTimestamp())},o.resetInitSegment=function(r,e,t,i,s){var l=this.demuxer,u=this.remuxer;!l||!u||(l.resetInitSegment(r,e,t,i),u.resetInitSegment(r,e,t,s))},o.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},o.transmux=function(r,e,t,i,s){var l;return e&&e.method==="SAMPLE-AES"?l=this.transmuxSampleAes(r,e,t,i,s):l=this.transmuxUnencrypted(r,t,i,s),l},o.transmuxUnencrypted=function(r,e,t,i){var s=this.demuxer.demux(r,e,!1,!this.config.progressive),l=s.audioTrack,u=s.videoTrack,f=s.id3Track,d=s.textTrack,h=this.remuxer.remux(l,u,f,d,e,t,!1,this.id);return{remuxResult:h,chunkMeta:i}},o.transmuxSampleAes=function(r,e,t,i,s){var l=this;return this.demuxer.demuxSampleAes(r,e,t).then(function(u){var f=l.remuxer.remux(u.audioTrack,u.videoTrack,u.id3Track,u.textTrack,t,i,!1,l.id);return{remuxResult:f,chunkMeta:s}})},o.configureTransmuxer=function(r){for(var e=this.config,t=this.observer,i=this.typeSupported,s,l=0,u=An.length;l<u;l++){var f;if((f=An[l].demux)!=null&&f.probe(r,this.logger)){s=An[l];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");var d=this.demuxer,h=this.remuxer,c=s.remux,v=s.demux;(!h||!(h instanceof c))&&(this.remuxer=new c(t,e,i,this.logger)),(!d||!(d instanceof v))&&(this.demuxer=new v(t,e,i,this.logger),this.probe=v.probe)},o.needsProbing=function(r,e){return!this.demuxer||!this.remuxer||r||e},o.getDecrypter=function(){var r=this.decrypter;return r||(r=this.decrypter=new fa(this.config)),r},a}();function Mf(a,o){var n=null;return a.byteLength>0&&(o==null?void 0:o.key)!=null&&o.iv!==null&&o.method!=null&&(n=o),n}var Na=function(o){return{remuxResult:{},chunkMeta:o}};function Hr(a){return"then"in a&&a.then instanceof Function}var Of=function(o,n,r,e,t){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=o,this.videoCodec=n,this.initSegmentData=r,this.duration=e,this.defaultInitPts=t||null},Ff=function(o,n,r,e,t,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=o,this.contiguous=n,this.accurateTimeOffset=r,this.trackSwitch=e,this.timeOffset=t,this.initSegmentChange=i},Ua=[];typeof Je<"u"&&Je&&Nf();function Nf(){self.addEventListener("message",function(a){var o=a.data,n=o.instanceNo;if(n!==void 0){var r=Ua[n];if(o.cmd==="reset"&&(delete Ua[o.resetNo],r&&r.destroy(),o.cmd="init"),o.cmd==="init"){var e=JSON.parse(o.config),t=new Kt;t.on(p.FRAG_DECRYPTED,ni),t.on(p.ERROR,ni);var i=we(e.debug,o.id);Uf(i,n),Ua[n]=new Fa(t,o.typeSupported,e,"",o.id,i),ni("init",null,n);return}if(r)switch(o.cmd){case"configure":{r.configure(o.config);break}case"demux":{var s=r.push(o.data,o.decryptdata,o.chunkMeta,o.state);Hr(s)?s.then(function(f){Ba(self,f,n)}).catch(function(f){ni(p.ERROR,{instanceNo:n,type:B.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,chunkMeta:o.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker push error"},n)}):Ba(self,s,n);break}case"flush":{var l=o.chunkMeta,u=r.flush(l);Hr(u)?u.then(function(f){Bo(self,f,l,n)}).catch(function(f){ni(p.ERROR,{type:B.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,chunkMeta:o.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker flush error"},n)}):Bo(self,u,l,n);break}}}})}function Ba(a,o,n){if(Bf(o.remuxResult))return!1;var r=[],e=o.remuxResult,t=e.audio,i=e.video;return t&&Uo(r,t),i&&Uo(r,i),a.postMessage({event:"transmuxComplete",data:o,instanceNo:n},r),!0}function Uo(a,o){o.data1&&a.push(o.data1.buffer),o.data2&&a.push(o.data2.buffer)}function Bo(a,o,n,r){var e=o.reduce(function(t,i){return Ba(a,i,r)||t},!1);e||a.postMessage({event:"transmuxComplete",data:o[0],instanceNo:r}),a.postMessage({event:"flush",data:n,instanceNo:r})}function ni(a,o,n){self.postMessage({event:a,data:o,instanceNo:n})}function Uf(a,o){var n=function(t){var i=function(l){ni("workerLog",{logType:t,message:l},o)};a[t]=i};for(var r in a)n(r)}function Bf(a){return!a.audio&&!a.video&&!a.text&&!a.id3&&!a.initSegment}var Fi="1.6.2",ai={};function Gf(){return typeof Ae=="function"}function Kf(){var a=ai[Fi];if(a)return a.clientCount++,a;var o=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+Ae.toString()+")(true);"],{type:"text/javascript"}),n=self.URL.createObjectURL(o),r=new self.Worker(n),e={worker:r,objectURL:n,clientCount:1};return ai[Fi]=e,e}function Hf(a){var o=ai[a];if(o)return o.clientCount++,o;var n=new self.URL(a,self.location.href).href,r=new self.Worker(n),e={worker:r,scriptURL:n,clientCount:1};return ai[a]=e,e}function Vf(a){var o=ai[a||Fi];if(o){var n=o.clientCount--;if(n===1){var r=o.worker,e=o.objectURL;delete ai[a||Fi],e&&self.URL.revokeObjectURL(e),r.terminate()}}}var Go=0,Ko=function(){function a(n,r,e,t){var i=this;this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Go++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=function(c){var v=c.data,g=i.hls;if(!(!g||!(v!=null&&v.event)||v.instanceNo!==i.instanceNo))switch(v.event){case"init":{var m,y=(m=i.workerContext)==null?void 0:m.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{i.handleTransmuxComplete(v.data);break}case"flush":{i.onFlush(v.data);break}case"workerLog":{g.logger[v.data.logType]&&g.logger[v.data.logType](v.data.message);break}default:{v.data=v.data||{},v.data.frag=i.frag,v.data.part=i.part,v.data.id=i.id,g.trigger(v.event,v.data);break}}},this.onWorkerError=function(c){if(i.hls){var v=new Error(c.message+"  ("+c.filename+":"+c.lineno+")");i.hls.config.enableWorker=!1,i.hls.logger.warn('Error in "'+i.id+'" Web Worker, fallback to inline'),i.hls.trigger(p.ERROR,{type:B.OTHER_ERROR,details:I.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:v})}};var s=n.config;this.hls=n,this.id=r,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=e,this.onFlush=t;var l=function(v,g){g=g||{},g.frag=i.frag||void 0,v===p.ERROR&&(g=g,g.parent=i.id,g.part=i.part,i.error=g.error),i.hls.trigger(v,g)};this.observer=new Kt,this.observer.on(p.FRAG_DECRYPTED,l),this.observer.on(p.ERROR,l);var u=Qi(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){var f=this.hls.logger,d=s.workerPath||Gf();if(d){try{s.workerPath?(f.log("loading Web Worker "+s.workerPath+' for "'+r+'"'),this.workerContext=Hf(s.workerPath)):(f.log('injecting Web Worker for "'+r+'"'),this.workerContext=Kf());var h=this.workerContext.worker;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:r,config:Ge(s)})}catch(c){f.warn('Error setting up "'+r+'" Web Worker, fallback to inline',c),this.terminateWorker(),this.error=null,this.transmuxer=new Fa(this.observer,u,s,"",r,n.logger)}return}}this.transmuxer=new Fa(this.observer,u,s,"",r,n.logger)}var o=a.prototype;return o.reset=function(){if(this.frag=null,this.part=null,this.workerContext){var r=this.instanceNo;this.instanceNo=Go++;var e=this.hls.config,t=Qi(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:r,typeSupported:t,id:this.id,config:Ge(e)})}},o.terminateWorker=function(){if(this.workerContext){var r=this.workerContext.worker;this.workerContext=null,r.removeEventListener("message",this.onWorkerMessage),r.removeEventListener("error",this.onWorkerError),Vf(this.hls.config.workerPath)}},o.destroy=function(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{var r=this.transmuxer;r&&(r.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null},o.push=function(r,e,t,i,s,l,u,f,d,h){var c,v,g=this;d.transmuxing.start=self.performance.now();var m=this.instanceNo,y=this.transmuxer,E=l?l.start:s.start,T=s.decryptdata,S=this.frag,x=!(S&&s.cc===S.cc),A=!(S&&d.level===S.level),L=S?d.sn-S.sn:-1,_=this.part?d.part-this.part.index:-1,k=L===0&&d.id>1&&d.id===(S==null?void 0:S.stats.chunkCount),R=!A&&(L===1||L===0&&(_===1||k&&_<=0)),b=self.performance.now();(A||L||s.stats.parsing.start===0)&&(s.stats.parsing.start=b),l&&(_||!R)&&(l.stats.parsing.start=b);var D=!(S&&((c=s.initSegment)==null?void 0:c.url)===((v=S.initSegment)==null?void 0:v.url)),C=new Ff(x,R,f,A,E,D);if(!R||x||D){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for "+s.type+" sn: "+d.sn+(d.part>-1?" part: "+d.part:"")+" "+(this.id===K.MAIN?"level":"track")+": "+d.level+" id: "+d.id+`
        discontinuity: `+x+`
        trackSwitch: `+A+`
        contiguous: `+R+`
        accurateTimeOffset: `+f+`
        timeOffset: `+E+`
        initSegmentChange: `+D);var N=new Of(t,i,e,u,h);this.configureTransmuxer(N)}if(this.frag=s,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:m,cmd:"demux",data:r,decryptdata:T,chunkMeta:d,state:C},r instanceof ArrayBuffer?[r]:[]);else if(y){var O=y.push(r,T,d,C);Hr(O)?O.then(function(M){g.handleTransmuxComplete(M)}).catch(function(M){g.transmuxerError(M,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(O)}},o.flush=function(r){var e=this;r.transmuxing.start=self.performance.now();var t=this.instanceNo,i=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:r});else if(i){var s=i.flush(r);Hr(s)?s.then(function(l){e.handleFlushResult(l,r)}).catch(function(l){e.transmuxerError(l,r,"transmuxer-interface flush error")}):this.handleFlushResult(s,r)}},o.transmuxerError=function(r,e,t){this.hls&&(this.error=r,this.hls.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:r,err:r,reason:t}))},o.handleFlushResult=function(r,e){var t=this;r.forEach(function(i){t.handleTransmuxComplete(i)}),this.onFlush(e)},o.configureTransmuxer=function(r){var e=this.instanceNo,t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:r}):t&&t.configure(r)},o.handleTransmuxComplete=function(r){r.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(r)},a}(),Ho=100,Wf=function(a){function o(r,e,t){var i;return i=a.call(this,r,e,t,"audio-stream-controller",K.AUDIO)||this,i.mainAnchor=null,i.mainFragLoading=null,i.audioOnly=!1,i.bufferedTrack=null,i.switchingTrack=null,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.flushing=!1,i.bufferFlushed=!1,i.cachedTrackLoadedData=null,i.registerListeners(),i}j(o,a);var n=o.prototype;return n.onHandlerDestroying=function(){this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this),this.resetItem()},n.resetItem=function(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null},n.registerListeners=function(){a.prototype.registerListeners.call(this);var e=this.hls;e.on(p.LEVEL_LOADED,this.onLevelLoaded,this),e.on(p.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(p.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(p.BUFFER_RESET,this.onBufferReset,this),e.on(p.BUFFER_CREATED,this.onBufferCreated,this),e.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(p.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(p.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(p.FRAG_LOADING,this.onFragLoading,this),e.on(p.FRAG_BUFFERED,this.onFragBuffered,this)},n.unregisterListeners=function(){var e=this.hls;e&&(a.prototype.unregisterListeners.call(this),e.off(p.LEVEL_LOADED,this.onLevelLoaded,this),e.off(p.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(p.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(p.BUFFER_RESET,this.onBufferReset,this),e.off(p.BUFFER_CREATED,this.onBufferCreated,this),e.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(p.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(p.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(p.FRAG_LOADING,this.onFragLoading,this),e.off(p.FRAG_BUFFERED,this.onFragBuffered,this))},n.onInitPtsFound=function(e,t){var i=t.frag,s=t.id,l=t.initPTS,u=t.timescale;if(s===K.MAIN){var f=i.cc,d=this.fragCurrent;if(this.initPTS[f]={baseTime:l,timescale:u},this.log("InitPTS for cc: "+f+" found from main: "+l+"/"+u),this.mainAnchor=i,this.state===w.WAITING_INIT_PTS){var h=this.waitingData;(!h&&!this.loadingParts||h&&h.frag.cc!==f)&&(this.nextLoadPosition=this.findSyncFrag(i).start),this.tick()}else!this.hls.hasEnoughToStart&&d&&d.cc!==f?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(i).start,d.abortRequests(),this.resetLoadingState()):this.state===w.IDLE&&this.tick()}},n.findSyncFrag=function(e){var t=this.getLevelDetails(),i=e.cc;return nu(t,i,e)||t&&_s(t.fragments,i)||e},n.startLoad=function(e,t){if(!this.levels){this.startPosition=e,this.state=w.STOPPED;return}var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(Ho),i>0&&e===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),e=i,this.state=w.IDLE):this.state=w.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()},n.doTick=function(){switch(this.state){case w.IDLE:this.doTickIdle();break;case w.WAITING_TRACK:{var e=this.levels,t=this.trackId,i=e==null?void 0:e[t],s=i==null?void 0:i.details;if(s&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(s))break;this.state=w.WAITING_INIT_PTS}break}case w.FRAG_LOADING_WAITING_RETRY:{var l,u=performance.now(),f=this.retryDate;if(!f||u>=f||(l=this.media)!=null&&l.seeking){var d=this.levels,h=this.trackId;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((d==null?void 0:d[h])||null),this.state=w.IDLE}break}case w.WAITING_INIT_PTS:{var c=this.waitingData;if(c){var v=c.frag,g=c.part,m=c.cache,y=c.complete,E=this.mainAnchor;if(this.initPTS[v.cc]!==void 0){this.waitingData=null,this.state=w.FRAG_LOADING;var T=m.flush().buffer,S={frag:v,part:g,payload:T,networkDetails:null};this._handleFragmentLoadProgress(S),y&&a.prototype._handleFragmentLoadComplete.call(this,S)}else E&&E.cc!==c.frag.cc&&(this.log("Waiting fragment cc ("+v.cc+") cancelled because video is at cc "+E.cc),this.nextLoadPosition=this.findSyncFrag(E).start,this.clearWaitingFragment())}else this.state=w.IDLE}}this.onTickEnd()},n.clearWaitingFragment=function(){var e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==w.STOPPED&&(this.state=w.IDLE))},n.resetLoadingState=function(){this.clearWaitingFragment(),a.prototype.resetLoadingState.call(this)},n.onTickEnd=function(){var e=this.media;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)},n.doTickIdle=function(){var e,t=this.hls,i=this.levels,s=this.media,l=this.trackId,u=t.config;if(!(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!u.startFragPrefetch)||!(i!=null&&i[l]))){var f=i[l],d=f.details;if(!d||this.waitForLive(f)||this.waitForCdnTuneIn(d)){this.state=w.WAITING_TRACK,this.startFragRequested=!1;return}var h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,be.AUDIO,K.AUDIO));var c=this.getFwdBufferInfo(h,K.AUDIO);if(c!==null){if(!this.switchingTrack&&this._streamEnded(c,d)){t.trigger(p.BUFFER_EOS,{type:"audio"}),this.state=w.ENDED;return}var v=c.len,g=t.maxBufferLength,m=d.fragments,y=m[0].start,E=this.getLoadPosition(),T=this.flushing?E:c.end;if(this.switchingTrack&&s){var S=E;d.PTSKnown&&S<y&&(c.end>y||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=y+.05)}if(!(v>=g&&!this.switchingTrack&&T<m[m.length-1].start)){var x=this.getNextFragment(T,d);if(x&&this.isLoopLoading(x,T)&&(x=this.getNextFragmentLoopLoading(x,d,c,K.MAIN,g)),!x){this.bufferFlushed=!0;return}var A=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&A&&Se(x)&&!x.endList&&(!d.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(A)===ut.OK&&(this.mainFragLoading=A=null),A&&Se(A))){if(x.start>A.end){var L=this.fragmentTracker.getFragAtPos(T,K.MAIN);L&&L.end>A.end&&(A=L,this.mainFragLoading={frag:L,targetBufferTime:null})}var _=x.start>A.end;if(_)return}this.loadFragment(x,f,T)}}}},n.onMediaDetaching=function(e,t){this.bufferFlushed=this.flushing=!1,a.prototype.onMediaDetaching.call(this,e,t)},n.onAudioTracksUpdated=function(e,t){var i=t.audioTracks;this.resetTransmuxer(),this.levels=i.map(function(s){return new Ar(s)})},n.onAudioTrackSwitching=function(e,t){var i=!!t.url;this.trackId=t.id;var s=this.fragCurrent;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==w.STOPPED&&(this.setInterval(Ho),this.state=w.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())},n.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1},n.onLevelLoaded=function(e,t){this.mainDetails=t.details;var i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(p.AUDIO_TRACK_LOADED,i))},n.onAudioTrackLoaded=function(e,t){var i,s=this.levels,l=t.details,u=t.id,f=t.groupId,d=t.track;if(!s){this.warn("Audio tracks reset while loading track "+u+' "'+d.name+'" of "'+f+'"');return}var h=this.mainDetails;if(!h||l.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=t,this.state!==w.STOPPED&&(this.state=w.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log("Audio track "+u+' "'+d.name+'" of "'+f+'" loaded ['+l.startSN+","+l.endSN+"]"+(l.lastPartSn?"[part-"+l.lastPartSn+"-"+l.lastPartIndex+"]":"")+",duration:"+l.totalduration);var c=s[u],v=0;if(l.live||(i=c.details)!=null&&i.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(c.details){var g;v=this.alignPlaylists(l,c.details,(g=this.levelLastLoaded)==null?void 0:g.details)}l.alignedSliding||(fo(l,h),l.alignedSliding||pn(l,h),v=l.fragmentStart)}c.details=l,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(h,v),this.hls.trigger(p.AUDIO_TRACK_UPDATED,{details:l,id:u,groupId:t.groupId}),this.state===w.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=w.IDLE),this.tick()},n._handleFragmentLoadProgress=function(e){var t,i=e.frag,s=e.part,l=e.payload,u=this.config,f=this.trackId,d=this.levels;if(!d){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var h=d[f];if(!h){this.warn("Audio track is undefined on fragment load progress");return}var c=h.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}var v=u.defaultAudioCodec||h.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new Ko(this.hls,K.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var m=this.initPTS[i.cc],y=(t=i.initSegment)==null?void 0:t.data;if(m!==void 0){var E=!1,T=s?s.index:-1,S=T!==-1,x=new da(i.level,i.sn,i.stats.chunkCount,l.byteLength,T,S);g.push(l,y,v,"",i,s,c.totalduration,E,x,m)}else{this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+f);var A=this.waitingData=this.waitingData||{frag:i,part:s,cache:new co,complete:!1},L=A.cache;L.push(new Uint8Array(l)),this.state!==w.STOPPED&&(this.state=w.WAITING_INIT_PTS)}},n._handleFragmentLoadComplete=function(e){if(this.waitingData){this.waitingData.complete=!0;return}a.prototype._handleFragmentLoadComplete.call(this,e)},n.onBufferReset=function(){this.mediaBuffer=null},n.onBufferCreated=function(e,t){this.bufferFlushed=this.flushing=!1;var i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)},n.onFragLoading=function(e,t){!this.audioOnly&&t.frag.type===K.MAIN&&Se(t.frag)&&(this.mainFragLoading=t,this.state===w.IDLE&&this.tick())},n.onFragBuffered=function(e,t){var i=t.frag,s=t.part;if(i.type!==K.AUDIO){!this.audioOnly&&i.type===K.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(s?" p: "+s.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));return}if(Se(i)){this.fragPrevious=i;var l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(p.AUDIO_TRACK_SWITCHED,ae({},l)))}this.fragBufferedComplete(i,s),this.media&&this.tick()},n.onError=function(e,t){var i;if(t.fatal){this.state=w.ERROR;return}switch(t.details){case I.FRAG_GAP:case I.FRAG_PARSING_ERROR:case I.FRAG_DECRYPT_ERROR:case I.FRAG_LOAD_ERROR:case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_ERROR:case I.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(K.AUDIO,t);break;case I.AUDIO_TRACK_LOAD_ERROR:case I.AUDIO_TRACK_LOAD_TIMEOUT:case I.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===w.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===re.AUDIO_TRACK&&(this.state=w.IDLE);break;case I.BUFFER_ADD_CODEC_ERROR:case I.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case I.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case I.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}},n.onBufferFlushing=function(e,t){var i=t.type;i!==be.VIDEO&&(this.flushing=!0)},n.onBufferFlushed=function(e,t){var i=t.type;if(i!==be.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===w.ENDED&&(this.state=w.IDLE);var s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,i,K.AUDIO),this.tick())}},n._handleTransmuxComplete=function(e){var t,i="audio",s=this.hls,l=e.remuxResult,u=e.chunkMeta,f=this.getCurrentContext(u);if(!f){this.resetWhenMissingContext(u);return}var d=f.frag,h=f.part,c=f.level,v=c.details,g=l.audio,m=l.text,y=l.id3,E=l.initSegment;if(this.fragContextChanged(d)||!v){this.fragmentTracker.removeFragment(d);return}if(this.state=w.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){var T=d.initSegment||d;this._bufferInitSegment(c,E.tracks,T,u),s.trigger(p.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:E.tracks})}if(g){var S=g.startPTS,x=g.endPTS,A=g.startDTS,L=g.endDTS;h&&(h.elementaryStreams[be.AUDIO]={startPTS:S,endPTS:x,startDTS:A,endDTS:L}),d.setElementaryStreamInfo(be.AUDIO,S,x,A,L),this.bufferFragmentData(g,d,h,u)}if(y!=null&&(t=y.samples)!=null&&t.length){var _=ne({id:i,frag:d,details:v},y);s.trigger(p.FRAG_PARSING_METADATA,_)}if(m){var k=ne({id:i,frag:d,details:v},m);s.trigger(p.FRAG_PARSING_USERDATA,k)}},n._bufferInitSegment=function(e,t,i,s){if(this.state===w.PARSING&&(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!!t.audio)){var l=t.audio;l.id=K.AUDIO;var u=e.audioCodec;this.log("Init audio buffer, container:"+l.container+", codecs[level/parsed]=["+u+"/"+l.codec+"]"),u&&u.split(",").length===1&&(l.levelCodec=u),this.hls.trigger(p.BUFFER_CODECS,t);var f=l.initSegment;if(f!=null&&f.byteLength){var d={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:f};this.hls.trigger(p.BUFFER_APPENDING,d)}this.tickImmediate()}},n.loadFragment=function(e,t,i){var s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===ut.NOT_LOADED||s===ut.PARTIAL){var l;if(!Se(e))this._loadInitSegment(e,t);else if((l=t.details)!=null&&l.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=w.WAITING_INIT_PTS;var u=this.mainDetails;u&&u.fragmentStart!==t.details.fragmentStart&&pn(t.details,u)}else a.prototype.loadFragment.call(this,e,t,i)}else this.clearTrackerIfNeeded(e)},n.flushAudioIfNeeded=function(e){if(this.media&&this.bufferedTrack){var t=this.bufferedTrack,i=t.name,s=t.lang,l=t.assocLang,u=t.characteristics,f=t.audioCodec,d=t.channels;Br({name:i,lang:s,assocLang:l,characteristics:u,audioCodec:f,channels:d},e,Gr)||(ln(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}},n.completeAudioSwitch=function(e){var t=this.hls;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(p.AUDIO_TRACK_SWITCHED,ae({},e))},o}(La),Ga=function(a){function o(r,e){var t;return t=a.call(this,e,r.logger)||this,t.hls=void 0,t.canLoad=!1,t.timer=-1,t.hls=r,t}j(o,a);var n=o.prototype;return n.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},n.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},n.startLoad=function(){this.canLoad=!0,this.loadPlaylist()},n.stopLoad=function(){this.canLoad=!1,this.clearTimer()},n.switchParams=function(e,t,i){var s=t==null?void 0:t.renditionReports;if(s){for(var l=-1,u=0;u<s.length;u++){var f=s[u],d=void 0;try{d=new self.URL(f.URI,t.url).href}catch(y){this.warn("Could not construct new URL for Rendition Report: "+y),d=f.URI||""}if(d===e){l=u;break}else d===e.substring(0,d.length)&&(l=u)}if(l!==-1){var h=s[l],c=parseInt(h["LAST-MSN"])||(t==null?void 0:t.lastPartSn),v=parseInt(h["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var g=Math.min(t.age-t.partTarget,t.targetduration);v>=0&&g>t.partTarget&&(v+=1)}var m=i&&Ii(i);return new _i(c,v>=0?v:void 0,m)}}},n.loadPlaylist=function(e){this.clearTimer()},n.loadingPlaylist=function(e,t){this.clearTimer()},n.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},n.getUrlWithDirectives=function(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}return e},n.playlistLoaded=function(e,t,i){var s=t.details,l=t.stats,u=self.performance.now(),f=l.loading.first?Math.max(0,u-l.loading.first):0;s.advancedDateTime=Date.now()-f;var d=this.hls.config.timelineOffset;if(d!==s.appliedTimelineOffset){var h=Math.max(d||0,0);s.appliedTimelineOffset=h,s.fragments.forEach(function(ie){ie.start=ie.playlistOffset+h})}if(s.live||i!=null&&i.live){var c="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(i),i&&s.fragments.length>0){Mu(i,s);var v=s.playlistParsingError;if(v){this.warn(v);var g=this.hls;if(!g.config.ignorePlaylistParsingErrors){var m,y=t.networkDetails;g.trigger(p.ERROR,{type:B.NETWORK_ERROR,details:I.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:v,reason:v.message,level:t.level||void 0,parent:(m=s.fragments[0])==null?void 0:m.type,networkDetails:y,stats:l});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=l.loading.start);var E=this.hls.mainForwardBufferInfo,T=E?E.end-E.len:0,S=(s.edge-T)*1e3,x=io(s,S);if(s.requestScheduled+x<u?s.requestScheduled=u:s.requestScheduled+=x,this.log("live playlist "+e+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED")),!this.canLoad||!s.live)return;var A,L=void 0,_=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var k=this.hls.config.lowLatencyMode,R=s.lastPartSn,b=s.endSN,D=s.lastPartIndex,C=D!==-1,N=R===b;C?N?(L=b+1,_=k?0:D):(L=R,_=k?D+1:s.maxPartIndex):L=b+1;var O=s.age,M=O+s.ageHeader,G=Math.min(M-s.partTarget,s.targetduration*1.5);if(G>0){if(M>s.targetduration*3)this.log("Playlist last advanced "+O.toFixed(2)+"s ago. Omitting segment and part directives."),L=void 0,_=void 0;else if(i!=null&&i.tuneInGoal&&M-s.partTarget>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+G+" with playlist age: "+s.age),G=0;else{var Y=Math.floor(G/s.targetduration);if(L+=Y,_!==void 0){var W=Math.round(G%s.targetduration/s.partTarget);_+=W}this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+O.toFixed(2)+"s goal: "+G+" skip sn "+Y+" to part "+_)}s.tuneInGoal=G}if(A=this.getDeliveryDirectives(s,t.deliveryDirectives,L,_),k||!N){s.requestScheduled=u,this.loadingPlaylist(c,A);return}}else(s.canBlockReload||s.canSkipUntil)&&(A=this.getDeliveryDirectives(s,t.deliveryDirectives,L,_));A&&L!==void 0&&s.canBlockReload&&(s.requestScheduled=l.loading.first+Math.max(x-f*2,x/2)),this.scheduleLoading(c,A,s)}else this.clearTimer()},n.scheduleLoading=function(e,t,i){var s=this,l=i||e.details;if(!l){this.loadingPlaylist(e,t);return}var u=self.performance.now(),f=l.requestScheduled;if(u>=f){this.loadingPlaylist(e,t);return}var d=f-u;this.log("reload live playlist "+(e.name||e.bitrate+"bps")+" in "+Math.round(d)+" ms"),this.clearTimer(),this.timer=self.setTimeout(function(){return s.loadingPlaylist(e,t)},d)},n.getDeliveryDirectives=function(e,t,i,s){var l=Ii(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,l=Ur.No),new _i(i,s,l)},n.checkRetry=function(e){var t=this,i=e.details,s=un(e),l=e.errorAction,u=l||{},f=u.action,d=u.retryCount,h=d===void 0?0:d,c=u.retryConfig,v=!!l&&!!c&&(f===kt.RetryRequest||!l.resolved&&f===kt.SendAlternateToPenaltyBox);if(v){var g;if(h>=c.maxNumRetry)return!1;if(s&&(g=e.context)!=null&&g.deliveryDirectives)this.warn("Retrying playlist loading "+(h+1)+"/"+c.maxNumRetry+' after "'+i+'" without delivery-directives'),this.loadPlaylist();else{var m=ua(c,h);this.clearTimer(),this.timer=self.setTimeout(function(){return t.loadPlaylist()},m),this.warn("Retrying playlist loading "+(h+1)+"/"+c.maxNumRetry+' after "'+i+'" in '+m+"ms")}e.levelRetry=!0,l.resolved=!0}return v},o}(he);function Vo(a,o){if(a.length!==o.length)return!1;for(var n=0;n<a.length;n++)if(!Ni(a[n].attrs,o[n].attrs))return!1;return!0}function Ni(a,o,n){var r=a["STABLE-RENDITION-ID"];return r&&!n?r===o["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(function(e){return a[e]!==o[e]})}function Ka(a,o){return o.label.toLowerCase()===a.name.toLowerCase()&&(!o.language||o.language.toLowerCase()===(a.lang||"").toLowerCase())}var Yf=function(a){function o(r){var e;return e=a.call(this,r,"audio-track-controller")||this,e.tracks=[],e.groupIds=null,e.tracksInGroup=[],e.trackId=-1,e.currentTrack=null,e.selectDefaultTrack=!0,e.registerListeners(),e}j(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.MANIFEST_PARSED,this.onManifestParsed,this),e.on(p.LEVEL_LOADING,this.onLevelLoading,this),e.on(p.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(p.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(p.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.MANIFEST_PARSED,this.onManifestParsed,this),e.off(p.LEVEL_LOADING,this.onLevelLoading,this),e.off(p.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(p.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(p.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,a.prototype.destroy.call(this)},n.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(e,t){this.tracks=t.audioTracks||[]},n.onAudioTrackLoaded=function(e,t){var i=t.id,s=t.groupId,l=t.details,u=this.tracksInGroup[i];if(!u||u.groupId!==s){this.warn("Audio track with id:"+i+" and group:"+s+" not found in active group "+(u==null?void 0:u.groupId));return}var f=u.details;u.details=t.details,this.log("Audio track "+i+' "'+u.name+'" lang:'+u.lang+" group:"+s+" loaded ["+l.startSN+"-"+l.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,t,f)},n.onLevelLoading=function(e,t){this.switchLevel(t.level)},n.onLevelSwitching=function(e,t){this.switchLevel(t.level)},n.switchLevel=function(e){var t=this.hls.levels[e];if(t){var i=t.audioGroups||null,s=this.groupIds,l=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(function(E){return(s==null?void 0:s.indexOf(E))===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var u=this.tracks.filter(function(E){return!i||i.indexOf(E.groupId)!==-1});if(u.length)this.selectDefaultTrack&&!u.some(function(E){return E.default})&&(this.selectDefaultTrack=!1),u.forEach(function(E,T){E.id=T});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=u;var f=this.hls.config.audioPreference;if(!l&&f){var d=or(f,u,Gr);if(d>-1)l=u[d];else{var h=or(f,this.tracks);l=this.tracks[h]}}var c=this.findTrackId(l);c===-1&&l&&(c=this.findTrackId(null));var v={audioTracks:u};this.log("Updating audio tracks, "+u.length+" track(s) found in group(s): "+(i==null?void 0:i.join(","))),this.hls.trigger(p.AUDIO_TRACKS_UPDATED,v);var g=this.trackId;if(c!==-1&&g===-1)this.setAudioTrack(c);else if(u.length&&g===-1){var m,y=new Error("No audio track selected for current audio group-ID(s): "+((m=this.groupIds)==null?void 0:m.join(","))+" track count: "+u.length);this.warn(y.message),this.hls.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}},n.onError=function(e,t){t.fatal||!t.context||t.context.type===re.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)},n.setAudioOption=function(e){var t=this.hls;if(t.config.audioPreference=e,e){var i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){var s=this.currentTrack;if(s&&Br(e,s,Gr))return s;var l=or(e,this.tracksInGroup,Gr);if(l>-1){var u=this.tracksInGroup[l];return this.setAudioTrack(l),u}else if(s){var f=t.loadLevel;f===-1&&(f=t.firstAutoLevel);var d=Zl(e,t.levels,i,f,Gr);if(d===-1)return null;t.nextLoadLevel=d}if(e.channels||e.audioCodec){var h=or(e,i);if(h>-1)return i[h]}}}return null},n.setAudioTrack=function(e){var t=this.tracksInGroup;if(e<0||e>=t.length){this.warn("Invalid audio track id: "+e);return}this.selectDefaultTrack=!1;var i=this.currentTrack,s=t[e],l=s.details&&!s.details.live;if(!(e===this.trackId&&s===i&&l)&&(this.log("Switching to audio-track "+e+' "'+s.name+'" lang:'+s.lang+" group:"+s.groupId+" channels:"+s.channels),this.trackId=e,this.currentTrack=s,this.hls.trigger(p.AUDIO_TRACK_SWITCHING,ae({},s)),!l)){var u=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(u)}},n.findTrackId=function(e){for(var t=this.tracksInGroup,i=0;i<t.length;i++){var s=t[i];if(!(this.selectDefaultTrack&&!s.default)&&(!e||Br(e,s,Gr)))return i}if(e){for(var l=e.name,u=e.lang,f=e.assocLang,d=e.characteristics,h=e.audioCodec,c=e.channels,v=0;v<t.length;v++){var g=t[v];if(Br({name:l,lang:u,assocLang:f,characteristics:d,audioCodec:h,channels:c},g,Gr))return v}for(var m=0;m<t.length;m++){var y=t[m];if(Ni(e.attrs,y.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return m}for(var E=0;E<t.length;E++){var T=t[E];if(Ni(e.attrs,T.attrs,["LANGUAGE"]))return E}}return-1},n.loadPlaylist=function(e){a.prototype.loadPlaylist.call(this);var t=this.currentTrack;this.shouldLoadPlaylist(t)&&ln(t.url,this.hls)&&this.scheduleLoading(t,e)},n.loadingPlaylist=function(e,t){a.prototype.loadingPlaylist.call(this,e,t);var i=e.id,s=e.groupId,l=this.getUrlWithDirectives(e.url,t),u=e.details,f=u==null?void 0:u.age;this.log("Loading audio-track "+i+' "'+e.name+'" lang:'+e.lang+" group:"+s+((t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+l),this.hls.trigger(p.AUDIO_TRACK_LOADING,{url:l,id:i,groupId:s,deliveryDirectives:t||null,track:e})},oe(o,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}])}(Ga),qf=function(){function a(n){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=n}var o=a.prototype;return o.destroy=function(){this.tracks=this.queues=null},o.append=function(r,e,t){if(!(this.queues===null||this.tracks===null)){var i=this.queues[e];i.push(r),i.length===1&&!t&&this.executeNext(e)}},o.appendBlocker=function(r){var e=this;return new Promise(function(t){var i={label:"async-blocker",execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};e.append(i,r)})},o.prependBlocker=function(r){var e=this;return new Promise(function(t){if(e.queues){var i={label:"async-blocker-prepend",execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};e.queues[r].unshift(i)}})},o.removeBlockers=function(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(function(r){var e,t=(e=r[0])==null?void 0:e.label;(t==="async-blocker"||t==="async-blocker-prepend")&&(r[0].execute(),r.splice(0,1))})},o.unblockAudio=function(r){if(this.queues!==null){var e=this.queues.audio;e[0]===r&&this.shiftAndExecuteNext("audio")}},o.executeNext=function(r){if(!(this.queues===null||this.tracks===null)){var e=this.queues[r];if(e.length){var t=e[0];try{t.execute()}catch(l){var i;if(t.onError(l),this.queues===null||this.tracks===null)return;var s=(i=this.tracks[r])==null?void 0:i.buffer;s!=null&&s.updating||this.shiftAndExecuteNext(r)}}}},o.shiftAndExecuteNext=function(r){this.queues!==null&&(this.queues[r].shift(),this.executeNext(r))},o.current=function(r){var e;return((e=this.queues)==null?void 0:e[r][0])||null},o.toString=function(){var r=this.queues,e=this.tracks;return r===null||e===null?"<destroyed>":`
`+this.list("video")+`
`+this.list("audio")+`
`+this.list("audiovideo")+"}"},o.list=function(r){var e,t;return(e=this.queues)!=null&&e[r]||(t=this.tracks)!=null&&t[r]?r+": ("+this.listSbInfo(r)+") "+this.listOps(r):""},o.listSbInfo=function(r){var e,t=(e=this.tracks)==null?void 0:e[r],i=t==null?void 0:t.buffer;return i?"SourceBuffer"+(i.updating?" updating":"")+(t.ended?" ended":"")+(t.ending?" ending":""):"none"},o.listOps=function(r){var e;return((e=this.queues)==null?void 0:e[r].map(function(t){return t.label}).join(", "))||""},a}(),Wo=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Yo="HlsJsTrackRemovedError",jf=function(a){function o(n){var r;return r=a.call(this,n)||this,r.name=Yo,r}return j(o,a),o}(at(Error)),Xf=function(a){function o(r,e){var t;return t=a.call(this,"buffer-controller",r.logger)||this,t.hls=void 0,t.fragmentTracker=void 0,t.details=null,t._objectUrl=null,t.operationQueue=null,t.bufferCodecEventsTotal=0,t.media=null,t.mediaSource=null,t.lastMpegAudioChunk=null,t.blockedAudioAppend=null,t.lastVideoAppendEnd=0,t.appendSource=void 0,t.transferData=void 0,t.overrides=void 0,t.appendErrors={audio:0,video:0,audiovideo:0},t.tracks={},t.sourceBuffers=[[null,null],[null,null]],t._onEndStreaming=function(i){var s;t.hls&&((s=t.mediaSource)==null?void 0:s.readyState)==="open"&&t.hls.pauseBuffering()},t._onStartStreaming=function(i){t.hls&&t.hls.resumeBuffering()},t._onMediaSourceOpen=function(i){var s=t,l=s.media,u=s.mediaSource;i&&t.log("Media source opened"),!(!l||!u)&&(u.removeEventListener("sourceopen",t._onMediaSourceOpen),l.removeEventListener("emptied",t._onMediaEmptied),t.updateDuration(),t.hls.trigger(p.MEDIA_ATTACHED,{media:l,mediaSource:u}),t.mediaSource!==null&&t.checkPendingTracks())},t._onMediaSourceClose=function(){t.log("Media source closed")},t._onMediaSourceEnded=function(){t.log("Media source ended")},t._onMediaEmptied=function(){var i=t,s=i.mediaSrc,l=i._objectUrl;s!==l&&t.error("Media element src was set while attaching MediaSource ("+l+" > "+s+")")},t.hls=r,t.fragmentTracker=e,t.appendSource=$t(ot(r.config.preferManagedMediaSource)),t.initTracks(),t.registerListeners(),t}j(o,a);var n=o.prototype;return n.hasSourceTypes=function(){return Object.keys(this.tracks).length>0},n.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null},n.registerListeners=function(){var e=this.hls;e.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.MANIFEST_PARSED,this.onManifestParsed,this),e.on(p.BUFFER_RESET,this.onBufferReset,this),e.on(p.BUFFER_APPENDING,this.onBufferAppending,this),e.on(p.BUFFER_CODECS,this.onBufferCodecs,this),e.on(p.BUFFER_EOS,this.onBufferEos,this),e.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(p.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(p.FRAG_PARSED,this.onFragParsed,this),e.on(p.FRAG_CHANGED,this.onFragChanged,this),e.on(p.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.MANIFEST_PARSED,this.onManifestParsed,this),e.off(p.BUFFER_RESET,this.onBufferReset,this),e.off(p.BUFFER_APPENDING,this.onBufferAppending,this),e.off(p.BUFFER_CODECS,this.onBufferCodecs,this),e.off(p.BUFFER_EOS,this.onBufferEos,this),e.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(p.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(p.FRAG_PARSED,this.onFragParsed,this),e.off(p.FRAG_CHANGED,this.onFragChanged,this),e.off(p.ERROR,this.onError,this)},n.transferMedia=function(){var e=this,t=this.media,i=this.mediaSource;if(!t)return null;var s={};if(this.operationQueue){var l=this.isUpdating();l||this.operationQueue.removeBlockers();var u=this.isQueued();(l||u)&&this.warn("Transfering MediaSource with"+(u?" operations in queue":"")+(l?" updating SourceBuffer(s)":"")+" "+this.operationQueue),this.operationQueue.destroy()}var f=this.transferData;return!this.sourceBufferCount&&f&&f.mediaSource===i?ne(s,f.tracks):this.sourceBuffers.forEach(function(d){var h=d[0];h&&(s[h]=ne({},e.tracks[h]),e.removeBuffer(h)),d[0]=d[1]=null}),{media:t,mediaSource:i,tracks:s}},n.initTracks=function(){var e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0},n.onManifestLoading=function(){this.bufferCodecEventsTotal=0,this.details=null},n.onManifestParsed=function(e,t){var i,s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(s+" bufferCodec event(s) expected."),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()},n.onMediaAttaching=function(e,t){var i=this.media=t.media,s=ot(this.appendSource);if(this.transferData=this.overrides=void 0,i&&s){var l=!!t.mediaSource;(l||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);var u=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(u),l)this._objectUrl=i.src,this.attachTransferred();else{var f=this._objectUrl=self.URL.createObjectURL(u);if(this.appendSource)try{i.removeAttribute("src");var d=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||d&&u instanceof d,qo(i),zf(i,f),i.load()}catch{i.src=f}else i.src=f}i.addEventListener("emptied",this._onMediaEmptied)}},n.assignMediaSource=function(e){var t,i;this.log((((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created")+" media source: "+((i=e.constructor)==null?void 0:i.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))},n.attachTransferred=function(){var e=this,t=this.media,i=this.transferData;if(!(!i||!t)){var s=this.tracks,l=i.tracks,u=l?Object.keys(l):null,f=u?u.length:0,d=function(){e.media&&e.mediaSourceOpenOrEnded&&e._onMediaSourceOpen()};if(l&&u&&f){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log("attachTransferred: (bufferCodecEventsTotal "+this.bufferCodecEventsTotal+`)
required tracks: `+Ge(s,function(g,m){return g==="initSegment"?void 0:m})+`;
transfer tracks: `+Ge(l,function(g,m){return g==="initSegment"?void 0:m})+"}"),!Te(l,s)){i.mediaSource=null,i.tracks=void 0;var h=t.currentTime,c=this.details,v=Math.max(h,(c==null?void 0:c.fragments[0].start)||0);if(v-h>1){this.log("attachTransferred: waiting for playback to reach new tracks start time "+h+" -> "+v);return}this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'+Object.keys(l)+'"->"'+Object.keys(s)+'") start time: '+v+" currentTime: "+h),this.onMediaDetaching(p.MEDIA_DETACHING,{}),this.onMediaAttaching(p.MEDIA_ATTACHING,i),t.currentTime=v;return}this.transferData=void 0,u.forEach(function(g){var m=g,y=l[m];if(y){var E=y.buffer;if(E){var T=e.fragmentTracker,S=y.id;if(T.hasFragments(S)||T.hasParts(S)){var x=Ie.getBuffered(E);T.detectEvictedFragments(m,x,S,null,!0)}var A=Ha(m),L=[m,E];e.sourceBuffers[A]=L,E.updating&&e.operationQueue&&e.operationQueue.prependBlocker(m),e.trackSourceBuffer(m,y)}}}),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}},n.onMediaDetaching=function(e,t){var i=this,s=!!t.transferMedia;this.transferData=this.overrides=void 0;var l=this.media,u=this.mediaSource,f=this._objectUrl;if(u){if(this.log("media source "+(s?"transferring":"detaching")),s)this.sourceBuffers.forEach(function(v){var g=v[0];g&&i.removeBuffer(g)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){var d=u.readyState==="open";try{for(var h=u.sourceBuffers,c=h.length;c--;)d&&h[c].abort(),u.removeSourceBuffer(h[c]);d&&u.endOfStream()}catch(v){this.warn("onMediaDetaching: "+v.message+" while calling endOfStream")}}this.sourceBufferCount&&this.onBufferReset()}u.removeEventListener("sourceopen",this._onMediaSourceOpen),u.removeEventListener("sourceended",this._onMediaSourceEnded),u.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(u.removeEventListener("startstreaming",this._onStartStreaming),u.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}l&&(l.removeEventListener("emptied",this._onMediaEmptied),s||(f&&self.URL.revokeObjectURL(f),this.mediaSrc===f?(l.removeAttribute("src"),this.appendSource&&qo(l),l.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(p.MEDIA_DETACHED,t)},n.onBufferReset=function(){var e=this;this.sourceBuffers.forEach(function(t){var i=t[0];i&&e.resetBuffer(i)}),this.initTracks()},n.resetBuffer=function(e){var t,i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(l){this.warn("onBufferReset "+e,l)}delete this.tracks[e]},n.removeBuffer=function(e){this.removeBufferListeners(e),this.sourceBuffers[Ha(e)]=[null,null];var t=this.tracks[e];t&&(t.buffer=void 0)},n.resetQueue=function(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new qf(this.tracks)},n.onBufferCodecs=function(e,t){var i=this,s=this.tracks,l=Object.keys(t);this.log('BUFFER_CODECS: "'+l+'" (current SB count '+this.sourceBufferCount+")");var u="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),f=!u&&this.sourceBufferCount&&this.media&&l.some(function(d){return!s[d]});if(u||f){this.warn('Unsupported transition between "'+Object.keys(s)+'" and "'+l+'" SourceBuffers');return}l.forEach(function(d){var h,c,v,g=t[d],m=g.id,y=g.codec,E=g.levelCodec,T=g.container,S=g.metadata,x=g.supplemental,A=s[d],L=(h=i.transferData)==null||(c=h.tracks)==null?void 0:c[d],_=L!=null&&L.buffer?L:A,k=(_==null?void 0:_.pendingCodec)||(_==null?void 0:_.codec),R=_==null?void 0:_.levelCodec;A||(A=s[d]={buffer:void 0,listeners:[],codec:y,supplemental:x,container:T,levelCodec:E,metadata:S,id:m});var b=Zr(k,R),D=b==null?void 0:b.replace(Wo,"$1"),C=Zr(y,E),N=(v=C)==null?void 0:v.replace(Wo,"$1");C&&b&&D!==N&&(d.slice(0,5)==="audio"&&(C=Jr(C,i.appendSource)),i.log("switching codec "+k+" to "+C),C!==(A.pendingCodec||A.codec)&&(A.pendingCodec=C),A.container=T,i.appendChangeType(d,T,C))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()},n.appendChangeType=function(e,t,i){var s=this,l=t+";codecs="+i,u={label:"change-type="+l,execute:function(){var d=s.tracks[e];if(d){var h=d.buffer;h!=null&&h.changeType&&(s.log("changing "+e+" sourceBuffer type to "+l),h.changeType(l),d.codec=i,d.container=t)}s.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(d){s.warn("Failed to change "+e+" SourceBuffer type",d)}};this.append(u,e,this.isPending(this.tracks[e]))},n.blockAudio=function(e){var t,i=this,s=e.start,l=s+e.duration*.05,u=((t=this.fragmentTracker.getAppendedFrag(s,K.MAIN))==null?void 0:t.gap)===!0;if(!u){var f={label:"block-audio",execute:function(){var h,c=i.tracks.video;(i.lastVideoAppendEnd>l||c!=null&&c.buffer&&Ie.isBuffered(c.buffer,l)||((h=i.fragmentTracker.getAppendedFrag(l,K.MAIN))==null?void 0:h.gap)===!0)&&(i.blockedAudioAppend=null,i.shiftAndExecuteNext("audio"))},onStart:function(){},onComplete:function(){},onError:function(h){i.warn("Error executing block-audio operation",h)}};this.blockedAudioAppend={op:f,frag:e},this.append(f,"audio",!0)}},n.unblockAudio=function(){var e=this.blockedAudioAppend,t=this.operationQueue;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))},n.onBufferAppending=function(e,t){var i=this,s=this.tracks,l=t.data,u=t.type,f=t.parent,d=t.frag,h=t.part,c=t.chunkMeta,v=c.buffering[u],g=d.sn,m=self.performance.now();v.start=m;var y=d.stats.buffering,E=h?h.stats.buffering:null;y.start===0&&(y.start=m),E&&E.start===0&&(E.start=m);var T=s.audio,S=!1;u==="audio"&&(T==null?void 0:T.container)==="audio/mpeg"&&(S=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var x=this.tracks.video,A=x==null?void 0:x.buffer;if(A&&g!=="initSegment"){var L=h||d,_=this.blockedAudioAppend;if(u==="audio"&&f!=="main"&&!this.blockedAudioAppend){var k=L.start,R=k+L.duration*.05,b=A.buffered,D=this.currentOp("video");!b.length&&!D?this.blockAudio(L):!D&&!Ie.isBuffered(A,R)&&this.lastVideoAppendEnd<R&&this.blockAudio(L)}else if(u==="video"){var C=L.end;if(_){var N=_.frag.start;(C>N||C<this.lastVideoAppendEnd||Ie.isBuffered(A,N))&&this.unblockAudio()}this.lastVideoAppendEnd=C}}var O=(h||d).start,M={label:"append-"+u,execute:function(){if(v.executeStart=self.performance.now(),S){var Y=i.tracks[u];if(Y){var W=Y.buffer;if(W){var ie=O-W.timestampOffset;Math.abs(ie)>=.1&&(i.log("Updating audio SourceBuffer timestampOffset to "+O+" (delta: "+ie+") sn: "+g+")"),W.timestampOffset=O)}}}i.appendExecutor(l,u)},onStart:function(){},onComplete:function(){var Y=self.performance.now();v.executeEnd=v.end=Y,y.first===0&&(y.first=Y),E&&E.first===0&&(E.first=Y);var W={};i.sourceBuffers.forEach(function(ie){var xe=ie[0],ue=ie[1];xe&&(W[xe]=Ie.getBuffered(ue))}),i.appendErrors[u]=0,u==="audio"||u==="video"?i.appendErrors.audiovideo=0:(i.appendErrors.audio=0,i.appendErrors.video=0),i.hls.trigger(p.BUFFER_APPENDED,{type:u,frag:d,part:h,chunkMeta:c,parent:d.type,timeRanges:W})},onError:function(Y){var W,ie={type:B.MEDIA_ERROR,parent:d.type,details:I.BUFFER_APPEND_ERROR,sourceBufferName:u,frag:d,part:h,chunkMeta:c,error:Y,err:Y,fatal:!1},xe=(W=i.media)==null?void 0:W.error;if(Y.code===DOMException.QUOTA_EXCEEDED_ERR)ie.details=I.BUFFER_FULL_ERROR;else if(Y.code===DOMException.INVALID_STATE_ERR&&i.mediaSourceOpenOrEnded&&!xe)ie.errorAction=ki(!0);else if(Y.name===Yo&&i.sourceBufferCount===0)ie.errorAction=ki(!0);else{var ue=++i.appendErrors[u];i.warn("Failed "+ue+"/"+i.hls.config.appendErrorMaxRetry+' times to append segment in "'+u+'" sourceBuffer ('+(xe||"no media error")+")"),(ue>=i.hls.config.appendErrorMaxRetry||xe)&&(ie.fatal=!0)}i.hls.trigger(p.ERROR,ie)}};this.append(M,u,this.isPending(this.tracks[u]))},n.getFlushOp=function(e,t,i){var s=this;return this.log('queuing "'+e+'" remove '+t+"-"+i),{label:"remove",execute:function(){s.removeExecutor(e,t,i)},onStart:function(){},onComplete:function(){s.hls.trigger(p.BUFFER_FLUSHED,{type:e})},onError:function(u){s.warn("Failed to remove "+t+"-"+i+' from "'+e+'" SourceBuffer',u)}}},n.onBufferFlushing=function(e,t){var i=this,s=t.type,l=t.startOffset,u=t.endOffset;s?this.append(this.getFlushOp(s,l,u),s):this.sourceBuffers.forEach(function(f){var d=f[0];d&&i.append(i.getFlushOp(d,l,u),d)})},n.onFragParsed=function(e,t){var i=this,s=t.frag,l=t.part,u=[],f=l?l.elementaryStreams:s.elementaryStreams;f[be.AUDIOVIDEO]?u.push("audiovideo"):(f[be.AUDIO]&&u.push("audio"),f[be.VIDEO]&&u.push("video"));var d=function(){var c=self.performance.now();s.stats.buffering.end=c,l&&(l.stats.buffering.end=c);var v=l?l.stats:s.stats;i.hls.trigger(p.FRAG_BUFFERED,{frag:s,part:l,stats:v,id:s.type})};u.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+s.type+" level: "+s.level+" sn: "+s.sn),this.blockBuffers(d,u).catch(function(h){i.warn("Fragment buffered callback "+h),i.stepOperationQueue(i.sourceBufferTypes)})},n.onFragChanged=function(e,t){this.trimBuffers()},n.onBufferEos=function(e,t){var i=this,s;this.sourceBuffers.forEach(function(f){var d=f[0];if(d){var h=i.tracks[d];(!t.type||t.type===d)&&(h.ending=!0,h.ended||(h.ended=!0,i.log(d+" buffer reached EOS")))}});var l=((s=this.overrides)==null?void 0:s.endOfStream)!==!1,u=this.sourceBufferCount>0&&!this.sourceBuffers.some(function(f){var d,h=f[0];return h&&!((d=i.tracks[h])!=null&&d.ended)});u&&(l?(this.log("Queueing EOS"),this.blockUntilOpen(function(){i.tracksEnded();var f=i.mediaSource;if(!f||f.readyState!=="open"){f&&i.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+f.readyState);return}i.log("Calling mediaSource.endOfStream()"),f.endOfStream(),i.hls.trigger(p.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(p.BUFFERED_TO_END,void 0)))},n.tracksEnded=function(){var e=this;this.sourceBuffers.forEach(function(t){var i=t[0];if(i!==null){var s=e.tracks[i];s&&(s.ending=!1)}})},n.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.updateDuration())},n.updateDuration=function(){var e=this,t=this.getDurationAndRange();t&&this.blockUntilOpen(function(){return e.updateMediaSource(t)})},n.onError=function(e,t){if(t.details===I.BUFFER_APPEND_ERROR&&t.frag){var i,s=(i=t.errorAction)==null?void 0:i.nextAutoLevel;U(s)&&s!==t.frag.level&&this.resetAppendErrors()}},n.resetAppendErrors=function(){this.appendErrors={audio:0,video:0,audiovideo:0}},n.trimBuffers=function(){var e=this.hls,t=this.details,i=this.media;if(!(!i||t===null)&&this.sourceBufferCount){var s=e.config,l=i.currentTime,u=t.levelTargetDuration,f=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(U(f)&&f>=0){var d=Math.max(f,u),h=Math.floor(l/u)*u-d;this.flushBackBuffer(l,u,h)}if(U(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){var c=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),v=Math.max(c,u),g=Math.floor(l/u)*u+v;this.flushFrontBuffer(l,u,g)}}},n.flushBackBuffer=function(e,t,i){var s=this;this.sourceBuffers.forEach(function(l){var u=l[0],f=l[1];if(f){var d=Ie.getBuffered(f);if(d.length>0&&i>d.start(0)){var h;s.hls.trigger(p.BACK_BUFFER_REACHED,{bufferEnd:i});var c=s.tracks[u];if((h=s.details)!=null&&h.live)s.hls.trigger(p.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(c!=null&&c.ended){s.log("Cannot flush "+u+" back buffer while SourceBuffer is in ended state");return}s.hls.trigger(p.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:u})}}})},n.flushFrontBuffer=function(e,t,i){var s=this;this.sourceBuffers.forEach(function(l){var u=l[0],f=l[1];if(f){var d=Ie.getBuffered(f),h=d.length;if(h<2)return;var c=d.start(h-1),v=d.end(h-1);if(i>c||e>=c&&e<=v)return;s.hls.trigger(p.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:u})}})},n.getDurationAndRange=function(){var e,t=this.details,i=this.mediaSource;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;var s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){var l=t.fragments.length;if(l&&t.live&&i.setLiveSeekableRange){var u=Math.max(0,t.fragmentStart),f=Math.max(u,s);return{duration:1/0,start:u,end:f}}return{duration:1/0}}var d=(e=this.overrides)==null?void 0:e.duration;if(d)return U(d)?{duration:d}:null;var h=this.media.duration,c=U(i.duration)?i.duration:0;return s>c&&s>h||!U(h)?{duration:s}:null},n.updateMediaSource=function(e){var t=e.duration,i=e.start,s=e.end,l=this.mediaSource;!this.media||!l||l.readyState!=="open"||(l.duration!==t&&(U(t)&&this.log("Updating MediaSource duration to "+t.toFixed(3)),l.duration=t),i!==void 0&&s!==void 0&&(this.log("MediaSource duration is set to "+l.duration+". Setting seekable range to "+i+"-"+s+"."),l.setLiveSeekableRange(i,s)))},n.checkPendingTracks=function(){var e=this.bufferCodecEventsTotal,t=this.pendingTrackCount,i=this.tracks;if(this.log("checkPendingTracks (pending: "+t+" codec events expected: "+e+") "+Ge(i)),this.tracksReady){var s,l=(s=this.transferData)==null?void 0:s.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}},n.bufferCreated=function(){var e=this;if(this.sourceBufferCount){var t={};this.sourceBuffers.forEach(function(s){var l=s[0],u=s[1];if(l){var f=e.tracks[l];t[l]={buffer:u,container:f.container,codec:f.codec,supplemental:f.supplemental,levelCodec:f.levelCodec,id:f.id,metadata:f.metadata}}}),this.hls.trigger(p.BUFFER_CREATED,{tracks:t}),this.log("SourceBuffers created. Running queue: "+this.operationQueue),this.sourceBuffers.forEach(function(s){var l=s[0];e.executeNext(l)})}else{var i=new Error("could not create source buffer for media codec(s)");this.hls.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:i,reason:i.message})}},n.createSourceBuffers=function(){var e=this.tracks,t=this.sourceBuffers,i=this.mediaSource;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(var s in e){var l=s,u=e[l];if(this.isPending(u)){var f=this.getTrackCodec(u,l),d=u.container+";codecs="+f;u.codec=f,this.log("creating sourceBuffer("+d+")"+(this.currentOp(l)?" Queued":"")+" "+Ge(u));try{var h=i.addSourceBuffer(d),c=Ha(l),v=[l,h];t[c]=v,u.buffer=h}catch(m){var g;this.error("error while trying to add sourceBuffer: "+m.message),this.shiftAndExecuteNext(l),(g=this.operationQueue)==null||g.removeBlockers(),delete this.tracks[l],this.hls.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:l,mimeType:d,parent:u.id});return}this.trackSourceBuffer(l,u)}}this.bufferCreated()},n.getTrackCodec=function(e,t){var i=e.supplemental,s=e.codec;i&&(t==="video"||t==="audiovideo")&&ar(i,"video")&&(s=ra(s,i));var l=Zr(s,e.levelCodec);return l?t.slice(0,5)==="audio"?Jr(l,this.appendSource):l:""},n.trackSourceBuffer=function(e,t){var i=this,s=t.buffer;if(s){var l=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:l,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",function(u,f){var d=f.removedRanges;d!=null&&d.length&&i.hls.trigger(p.BUFFER_FLUSHED,{type:u})})}},n.onSBUpdateStart=function(e){var t=this.currentOp(e);t&&t.onStart()},n.onSBUpdateEnd=function(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}var i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))},n.onSBUpdateError=function(e,t){var i,s=new Error(e+" SourceBuffer error. MediaSource readyState: "+((i=this.mediaSource)==null?void 0:i.readyState));this.error(""+s,t),this.hls.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});var l=this.currentOp(e);l&&l.onError(s)},n.removeExecutor=function(e,t,i){var s=this.media,l=this.mediaSource,u=this.tracks[e],f=u==null?void 0:u.buffer;if(!s||!l||!f){this.warn("Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),this.shiftAndExecuteNext(e);return}var d=U(s.duration)?s.duration:1/0,h=U(l.duration)?l.duration:1/0,c=Math.max(0,t),v=Math.min(i,d,h);v>c&&(!u.ending||u.ended)?(u.ended=!1,this.log("Removing ["+c+","+v+"] from the "+e+" SourceBuffer"),f.remove(c,v)):this.shiftAndExecuteNext(e)},n.appendExecutor=function(e,t){var i=this.tracks[t],s=i==null?void 0:i.buffer;if(!s)throw new jf("Attempting to append to the "+t+" SourceBuffer, but it does not exist");i.ending=!1,i.ended=!1,s.appendBuffer(e)},n.blockUntilOpen=function(e){var t=this;if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(function(i){t.warn("SourceBuffer blocked callback "+i),t.stepOperationQueue(t.sourceBufferTypes)});else try{e()}catch(i){this.warn("Callback run without blocking "+this.operationQueue+" "+i)}},n.isUpdating=function(){return this.sourceBuffers.some(function(e){var t=e[0],i=e[1];return t&&i.updating})},n.isQueued=function(){var e=this;return this.sourceBuffers.some(function(t){var i=t[0];return i&&!!e.currentOp(i)})},n.isPending=function(e){return!!e&&!e.buffer},n.blockBuffers=function(e,t){var i=this;if(t===void 0&&(t=this.sourceBufferTypes),!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);var s=this.operationQueue,l=t.map(function(f){return i.appendBlocker(f)}),u=t.length>1&&!!this.blockedAudioAppend;return u&&this.unblockAudio(),Promise.all(l).then(function(f){s===i.operationQueue&&(e(),i.stepOperationQueue(i.sourceBufferTypes))})},n.stepOperationQueue=function(e){var t=this;e.forEach(function(i){var s,l=(s=t.tracks[i])==null?void 0:s.buffer;!l||l.updating||t.shiftAndExecuteNext(i)})},n.append=function(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)},n.appendBlocker=function(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)},n.currentOp=function(e){return this.operationQueue?this.operationQueue.current(e):null},n.executeNext=function(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)},n.shiftAndExecuteNext=function(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)},n.addBufferListener=function(e,t,i){var s=this.tracks[e];if(s){var l=s.buffer;if(l){var u=i.bind(this,e);s.listeners.push({event:t,listener:u}),l.addEventListener(t,u)}}},n.removeBufferListeners=function(e){var t=this.tracks[e];if(t){var i=t.buffer;i&&(t.listeners.forEach(function(s){i.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}},oe(o,[{key:"mediaSourceOpenOrEnded",get:function(){var e,t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}},{key:"sourceBufferTracks",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(t,i){var s=e.tracks[i];return t[i]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},t},{})}},{key:"bufferedToEnd",get:function(){var e=this;return this.sourceBufferCount>0&&!this.sourceBuffers.some(function(t){var i,s,l=t[0];return l&&(!((i=e.tracks[l])!=null&&i.ended)||((s=e.tracks[l])==null?void 0:s.ending))})}},{key:"tracksReady",get:function(){var e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}},{key:"mediaSrc",get:function(){var e,t,i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}},{key:"pendingTrackCount",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(t,i){return t+(e.isPending(e.tracks[i])?1:0)},0)}},{key:"sourceBufferCount",get:function(){return this.sourceBuffers.reduce(function(e,t){var i=t[0];return e+(i?1:0)},0)}},{key:"sourceBufferTypes",get:function(){return this.sourceBuffers.map(function(e){var t=e[0];return t}).filter(function(e){return!!e})}}])}(he);function qo(a){var o=a.querySelectorAll("source");[].slice.call(o).forEach(function(n){a.removeChild(n)})}function zf(a,o){var n=self.document.createElement("source");n.type="video/mp4",n.src=o,a.appendChild(n)}function Ha(a){return a==="audio"?1:0}var Qf=function(){function a(n){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=n,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var o=a.prototype;return o.setStreamController=function(r){this.streamController=r},o.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},o.registerListeners=function(){var r=this.hls;r.on(p.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(p.MANIFEST_PARSED,this.onManifestParsed,this),r.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(p.BUFFER_CODECS,this.onBufferCodecs,this),r.on(p.MEDIA_DETACHING,this.onMediaDetaching,this)},o.unregisterListener=function(){var r=this.hls;r.off(p.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(p.MANIFEST_PARSED,this.onManifestParsed,this),r.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(p.BUFFER_CODECS,this.onBufferCodecs,this),r.off(p.MEDIA_DETACHING,this.onMediaDetaching,this)},o.onFpsDropLevelCapping=function(r,e){var t=this.hls.levels[e.droppedLevel];this.isLevelAllowed(t)&&this.restrictedLevels.push({bitrate:t.bitrate,height:t.height,width:t.width})},o.onMediaAttaching=function(r,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},o.onManifestParsed=function(r,e){var t=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onLevelsUpdated=function(r,e){this.timer&&U(this.autoLevelCapping)&&this.detectPlayerSize()},o.onBufferCodecs=function(r,e){var t=this.hls;t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onMediaDetaching=function(){this.stopCapping(),this.media=null},o.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}var r=this.hls.levels;if(r.length){var e=this.hls,t=this.getMaxLevel(r.length-1);t!==this.autoLevelCapping&&e.logger.log("Setting autoLevelCapping to "+t+": "+r[t].height+"p@"+r[t].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),e.autoLevelCapping=t,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},o.getMaxLevel=function(r){var e=this,t=this.hls.levels;if(!t.length)return-1;var i=t.filter(function(s,l){return e.isLevelAllowed(s)&&l<=r});return this.clientRect=null,a.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},o.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},o.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},o.getDimensions=function(){if(this.clientRect)return this.clientRect;var r=this.media,e={width:0,height:0};if(r){var t=r.getBoundingClientRect();e.width=t.width,e.height=t.height,!e.width&&!e.height&&(e.width=t.right-t.left||r.width||0,e.height=t.bottom-t.top||r.height||0)}return this.clientRect=e,e},o.isLevelAllowed=function(r){var e=this.restrictedLevels;return!e.some(function(t){return r.bitrate===t.bitrate&&r.width===t.width&&r.height===t.height})},a.getMaxLevelByMediaSize=function(r,e,t){if(!(r!=null&&r.length))return-1;for(var i=function(h,c){return c?h.width!==c.width||h.height!==c.height:!0},s=r.length-1,l=Math.max(e,t),u=0;u<r.length;u+=1){var f=r[u];if((f.width>=l||f.height>=l)&&i(f,r[u+1])){s=u;break}}return s},oe(a,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var r=1;if(!this.hls.config.ignoreDevicePixelRatio)try{r=self.devicePixelRatio}catch{}return Math.min(r,this.hls.config.maxDevicePixelRatio)}}])}(),$f={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Nt=$f,Jf={HLS:"h"},Zf=Jf,ed="CMCD-Object",td="CMCD-Request",rd="CMCD-Session",id="CMCD-Status",Ui={OBJECT:ed,REQUEST:td,SESSION:rd,STATUS:id},si,nd=(si={},si[Ui.OBJECT]=["br","d","ot","tb"],si[Ui.REQUEST]=["bl","dl","mtp","nor","nrr","su"],si[Ui.SESSION]=["cid","pr","sf","sid","st","v"],si[Ui.STATUS]=["bs","rtp"],si),Va=function a(o,n){Array.isArray(o)&&(o=o.map(function(r){return r instanceof a?r:new a(r)})),this.value=o,this.params=n},ad="Dict";function sd(a){return Array.isArray(a)?JSON.stringify(a):a instanceof Map?"Map{}":a instanceof Set?"Set{}":typeof a=="object"?JSON.stringify(a):String(a)}function od(a,o,n,r){return new Error("failed to "+a+' "'+sd(o)+'" as '+n,{cause:r})}function ur(a,o,n){return od("serialize",a,o,n)}var jo=function(o){this.description=o},Xo="Bare Item",ld="Boolean";function ud(a){if(typeof a!="boolean")throw ur(a,ld);return a?"?1":"?0"}var fd="Byte Sequence";function dd(a){if(ArrayBuffer.isView(a)===!1)throw ur(a,fd);return":"+$u(a)+":"}var hd="Integer";function cd(a){return a<-999999999999999||999999999999999<a}function zo(a){if(cd(a))throw ur(a,hd);return a.toString()}function vd(a){return"@"+zo(a.getTime()/1e3)}var gd="Decimal";function md(a){var o=To(a,3);if(Math.floor(Math.abs(o)).toString().length>12)throw ur(a,gd);var n=o.toString();return n.includes(".")?n:n+".0"}var pd="String",yd=/[\x00-\x1f\x7f]+/;function Ed(a){if(yd.test(a))throw ur(a,pd);return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Td(a){return a.description||a.toString().slice(7,-1)}var Sd="Token";function Qo(a){var o=Td(a);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(o)===!1)throw ur(o,Sd);return o}function Wa(a){switch(typeof a){case"number":if(!U(a))throw ur(a,Xo);return Number.isInteger(a)?zo(a):md(a);case"string":return Ed(a);case"symbol":return Qo(a);case"boolean":return ud(a);case"object":if(a instanceof Date)return vd(a);if(a instanceof Uint8Array)return dd(a);if(a instanceof jo)return Qo(a);default:throw ur(a,Xo)}}var xd="Key";function Ya(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw ur(a,xd);return a}function qa(a){return a==null?"":Object.entries(a).map(function(o){var n=o[0],r=o[1];return r===!0?";"+Ya(n):";"+Ya(n)+"="+Wa(r)}).join("")}function $o(a){return a instanceof Va?""+Wa(a.value)+qa(a.params):Wa(a)}function Ad(a){return"("+a.value.map($o).join(" ")+")"+qa(a.params)}function Ld(a,o){if(o===void 0&&(o={whitespace:!0}),typeof a!="object")throw ur(a,ad);var n=a instanceof Map?a.entries():Object.entries(a),r=o!=null&&o.whitespace?" ":"";return Array.from(n).map(function(e){var t=e[0],i=e[1];i instanceof Va||(i=new Va(i));var s=Ya(t);return i.value===!0?s+=qa(i.params):(s+="=",Array.isArray(i.value)?s+=Ad(i):s+=$o(i)),s}).join(","+r)}function bd(a,o){return Ld(a,o)}function Rd(a){return a==="ot"||a==="sf"||a==="st"}function Id(a){return typeof a=="number"?U(a):a!=null&&a!==""&&a!==!1}var Ln=function(o){return Math.round(o)},_d=function(o,n){return n!=null&&n.baseUrl&&(o=Ju(o,n.baseUrl)),encodeURIComponent(o)},bn=function(o){return Ln(o/100)*100},Dd={br:Ln,d:Ln,bl:bn,dl:bn,mtp:bn,nor:_d,rtp:bn,tb:Ln};function kd(a,o){var n={};if(a==null||typeof a!="object")return n;var r=Object.keys(a).sort(),e=ne({},Dd,o==null?void 0:o.formatters),t=o==null?void 0:o.filter;return r.forEach(function(i){if(!(t!=null&&t(i))){var s=a[i],l=e[i];l&&(s=l(s,o)),!(i==="v"&&s===1)&&(i=="pr"&&s===1||Id(s)&&(Rd(i)&&typeof s=="string"&&(s=new jo(s)),n[i]=s))}}),n}function Jo(a,o){return o===void 0&&(o={}),a?bd(kd(a,o),ne({whitespace:!1},o)):""}function Cd(a,o){o===void 0&&(o={});var n={};if(!a)return n;var r=Object.entries(a),e=Object.entries(nd).concat(Object.entries((o==null?void 0:o.customHeaderMap)||{})),t=r.reduce(function(i,s){var l,u,f=s[0],d=s[1],h=((l=e.find(function(c){return c[1].includes(f)}))===null||l===void 0?void 0:l[0])||Ui.REQUEST;return(u=i[h])!==null&&u!==void 0||(i[h]={}),i[h][f]=d,i},{});return Object.entries(t).reduce(function(i,s){var l=s[0],u=s[1];return i[l]=Jo(u,o),i},n)}function Pd(a,o,n){return ne(a,Cd(o,n))}var wd="CMCD";function Md(a,o){if(o===void 0&&(o={}),!a)return"";var n=Jo(a,o);return wd+"="+encodeURIComponent(n)}var Zo=/CMCD=[^&#]+/;function Od(a,o,n){var r=Md(o,n);if(!r)return a;if(Zo.test(a))return a.replace(Zo,r);var e=a.includes("?")?"&":"?";return""+a+e+r}var Fd=function(){function a(n){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(i){try{r.apply(i,{ot:Nt.MANIFEST,su:!r.initialized})}catch(s){r.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=function(i){try{var s=i.frag,l=i.part,u=r.hls.levels[s.level],f=r.getObjectType(s),d={d:(l||s).duration*1e3,ot:f};(f===Nt.VIDEO||f===Nt.AUDIO||f==Nt.MUXED)&&(d.br=u.bitrate/1e3,d.tb=r.getTopBandwidth(f)/1e3,d.bl=r.getBufferLength(f));var h=l?r.getNextPart(l):r.getNextFrag(s);h!=null&&h.url&&h.url!==s.url&&(d.nor=h.url),r.apply(i,d)}catch(c){r.hls.logger.warn("Could not generate segment CMCD data.",c)}},this.hls=n;var e=this.config=n.config,t=e.cmcd;t!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=t.sessionId||n.sessionId,this.cid=t.contentId,this.useHeaders=t.useHeaders===!0,this.includeKeys=t.includeKeys,this.registerListeners())}var o=a.prototype;return o.registerListeners=function(){var r=this.hls;r.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(p.MEDIA_DETACHED,this.onMediaDetached,this),r.on(p.BUFFER_CREATED,this.onBufferCreated,this)},o.unregisterListeners=function(){var r=this.hls;r.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(p.MEDIA_DETACHED,this.onMediaDetached,this),r.off(p.BUFFER_CREATED,this.onBufferCreated,this)},o.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null},o.onMediaAttached=function(r,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},o.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},o.onBufferCreated=function(r,e){var t,i;this.audioBuffer=(t=e.tracks.audio)==null?void 0:t.buffer,this.videoBuffer=(i=e.tracks.video)==null?void 0:i.buffer},o.createData=function(){var r;return{v:1,sf:Zf.HLS,sid:this.sid,cid:this.cid,pr:(r=this.media)==null?void 0:r.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},o.apply=function(r,e){e===void 0&&(e={}),ne(e,this.createData());var t=e.ot===Nt.INIT||e.ot===Nt.VIDEO||e.ot===Nt.MUXED;this.starved&&t&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering);var i=this.includeKeys;i&&(e=Object.keys(e).reduce(function(l,u){return i.includes(u)&&(l[u]=e[u]),l},{}));var s={baseUrl:r.url};this.useHeaders?(r.headers||(r.headers={}),Pd(r.headers,e,s)):r.url=Od(r.url,e,s)},o.getNextFrag=function(r){var e,t=(e=this.hls.levels[r.level])==null?void 0:e.details;if(t){var i=r.sn-t.startSN;return t.fragments[i+1]}},o.getNextPart=function(r){var e,t,i=r.index,s=r.fragment,l=(e=this.hls.levels[s.level])==null||(t=e.details)==null?void 0:t.partList;if(l)for(var u=s.sn,f=l.length-1;f>=0;f--){var d=l[f];if(d.index===i&&d.fragment.sn===u)return l[f+1]}},o.getObjectType=function(r){var e=r.type;if(e==="subtitle")return Nt.TIMED_TEXT;if(r.sn==="initSegment")return Nt.INIT;if(e==="audio")return Nt.AUDIO;if(e==="main")return this.hls.audioTracks.length?Nt.VIDEO:Nt.MUXED},o.getTopBandwidth=function(r){var e=0,t,i=this.hls;if(r===Nt.AUDIO)t=i.audioTracks;else{var s=i.maxAutoLevel,l=s>-1?s+1:i.levels.length;t=i.levels.slice(0,l)}for(var u=Ct(t),f;!(f=u()).done;){var d=f.value;d.bitrate>e&&(e=d.bitrate)}return e>0?e:NaN},o.getBufferLength=function(r){var e=this.media,t=r===Nt.AUDIO?this.audioBuffer:this.videoBuffer;if(!t||!e)return NaN;var i=Ie.bufferInfo(t,e.currentTime,this.config.maxBufferHole);return i.len*1e3},o.createPlaylistLoader=function(){var r=this.config.pLoader,e=this.applyPlaylistData,t=r||this.config.loader;return function(){function i(l){this.loader=void 0,this.loader=new t(l)}var s=i.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(u,f,d){e(u),this.loader.load(u,f,d)},oe(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])}()},o.createFragmentLoader=function(){var r=this.config.fLoader,e=this.applyFragmentData,t=r||this.config.loader;return function(){function i(l){this.loader=void 0,this.loader=new t(l)}var s=i.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(u,f,d){e(u),this.loader.load(u,f,d)},oe(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])}()},a}(),Nd=3e5,Ud=function(a){function o(r){var e;return e=a.call(this,"content-steering",r.logger)||this,e.hls=void 0,e.loader=null,e.uri=null,e.pathwayId=".",e._pathwayPriority=null,e.timeToLoad=300,e.reloadTimer=-1,e.updated=0,e.started=!1,e.enabled=!0,e.levels=null,e.audioTracks=null,e.subtitleTracks=null,e.penalizedPathways={},e.hls=r,e.registerListeners(),e}j(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(p.MANIFEST_PARSED,this.onManifestParsed,this),e.on(p.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(p.MANIFEST_PARSED,this.onManifestParsed,this),e.off(p.ERROR,this.onError,this))},n.pathways=function(){return(this.levels||[]).reduce(function(e,t){return e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e},[])},n.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}},n.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},n.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},n.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},n.removeLevel=function(e){var t=this.levels;t&&(this.levels=t.filter(function(i){return i!==e}))},n.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},n.onManifestLoaded=function(e,t){var i=t.contentSteering;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())},n.onManifestParsed=function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks},n.onError=function(e,t){var i=t.errorAction;if((i==null?void 0:i.action)===kt.SendAlternateToPenaltyBox&&i.flags===tr.MoveAllAlternatesMatchingHost){var s=this.levels,l=this._pathwayPriority,u=this.pathwayId;if(t.context){var f=t.context,d=f.groupId,h=f.pathwayId,c=f.type;d&&s?u=this.getPathwayForGroupId(d,c,u):h&&(u=h)}u in this.penalizedPathways||(this.penalizedPathways[u]=performance.now()),!l&&s&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),i.resolved=this.pathwayId!==u),i.resolved||this.warn("Could not resolve "+t.details+' ("'+t.error.message+'") with content-steering for Pathway: '+u+" levels: "+(s&&s.length)+" priorities: "+Ge(l)+" penalized: "+Ge(this.penalizedPathways))}},n.filterParsedLevels=function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){var i=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+i+'"'),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log("Found "+t.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),t},n.getLevelsForPathway=function(e){return this.levels===null?[]:this.levels.filter(function(t){return e===t.pathwayId})},n.updatePathwayPriority=function(e){this._pathwayPriority=e;var t,i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(function(c){s-i[c]>Nd&&delete i[c]});for(var l=0;l<e.length;l++){var u=e[l];if(!(u in i)){if(u===this.pathwayId)return;var f=this.hls.nextLoadLevel,d=this.hls.levels[f];if(t=this.getLevelsForPathway(u),t.length>0){this.log('Setting Pathway to "'+u+'"'),this.pathwayId=u,oo(t),this.hls.trigger(p.LEVELS_UPDATED,{levels:t});var h=this.hls.levels[f];d&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==d.bitrate&&this.log("Unstable Pathways change from bitrate "+d.bitrate+" to "+h.bitrate),this.hls.nextLoadLevel=f);break}}}},n.getPathwayForGroupId=function(e,t,i){for(var s=this.getLevelsForPathway(i).concat(this.levels||[]),l=0;l<s.length;l++)if(t===re.AUDIO_TRACK&&s[l].hasAudioGroup(e)||t===re.SUBTITLE_TRACK&&s[l].hasSubtitleGroup(e))return s[l].pathwayId;return i},n.clonePathways=function(e){var t=this,i=this.levels;if(i){var s={},l={};e.forEach(function(u){var f=u.ID,d=u["BASE-ID"],h=u["URI-REPLACEMENT"];if(!i.some(function(v){return v.pathwayId===f})){var c=t.getLevelsForPathway(d).map(function(v){var g=new et(v.attrs);g["PATHWAY-ID"]=f;var m=g.AUDIO&&g.AUDIO+"_clone_"+f,y=g.SUBTITLES&&g.SUBTITLES+"_clone_"+f;m&&(s[g.AUDIO]=m,g.AUDIO=m),y&&(l[g.SUBTITLES]=y,g.SUBTITLES=y);var E=tl(v.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),T=new Ar({attrs:g,audioCodec:v.audioCodec,bitrate:v.bitrate,height:v.height,name:v.name,url:E,videoCodec:v.videoCodec,width:v.width});if(v.audioGroups)for(var S=1;S<v.audioGroups.length;S++)T.addGroupId("audio",v.audioGroups[S]+"_clone_"+f);if(v.subtitleGroups)for(var x=1;x<v.subtitleGroups.length;x++)T.addGroupId("text",v.subtitleGroups[x]+"_clone_"+f);return T});i.push.apply(i,c),el(t.audioTracks,s,h,f),el(t.subtitleTracks,l,h,f)}})}},n.loadSteeringManifest=function(e){var t=this,i=this.hls.config,s=i.loader;this.loader&&this.loader.destroy(),this.loader=new s(i);var l;try{l=new self.URL(e)}catch{this.enabled=!1,this.log("Failed to parse Steering Manifest URI: "+e);return}if(l.protocol!=="data:"){var u=(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate)|0;l.searchParams.set("_HLS_pathway",this.pathwayId),l.searchParams.set("_HLS_throughput",""+u)}var f={responseType:"json",url:l.href},d=i.steeringManifestLoadPolicy.default,h=d.errorRetry||d.timeoutRetry||{},c={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},v={onSuccess:function(m,y,E,T){t.log('Loaded steering manifest: "'+l+'"');var S=m.data;if((S==null?void 0:S.VERSION)!==1){t.log("Steering VERSION "+S.VERSION+" not supported!");return}t.updated=performance.now(),t.timeToLoad=S.TTL;var x=S["RELOAD-URI"],A=S["PATHWAY-CLONES"],L=S["PATHWAY-PRIORITY"];if(x)try{t.uri=new self.URL(x,l).href}catch{t.enabled=!1,t.log("Failed to parse Steering Manifest RELOAD-URI: "+x);return}t.scheduleRefresh(t.uri||E.url),A&&t.clonePathways(A);var _={steeringManifest:S,url:l.toString()};t.hls.trigger(p.STEERING_MANIFEST_LOADED,_),L&&t.updatePathwayPriority(L)},onError:function(m,y,E,T){if(t.log("Error loading steering manifest: "+m.code+" "+m.text+" ("+y.url+")"),t.stopLoad(),m.code===410){t.enabled=!1,t.log("Steering manifest "+y.url+" no longer available");return}var S=t.timeToLoad*1e3;if(m.code===429){var x=t.loader;if(typeof(x==null?void 0:x.getResponseHeader)=="function"){var A=x.getResponseHeader("Retry-After");A&&(S=parseFloat(A)*1e3)}t.log("Steering manifest "+y.url+" rate limited");return}t.scheduleRefresh(t.uri||y.url,S)},onTimeout:function(m,y,E){t.log("Timeout loading steering manifest ("+y.url+")"),t.scheduleRefresh(t.uri||y.url)}};this.log("Requesting steering manifest: "+l),this.loader.load(f,c,v)},n.scheduleRefresh=function(e,t){var i=this;t===void 0&&(t=this.timeToLoad*1e3),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var s,l=(s=i.hls)==null?void 0:s.media;if(l&&!l.ended){i.loadSteeringManifest(e);return}i.scheduleRefresh(e,i.timeToLoad*1e3)},t)},oe(o,[{key:"pathwayPriority",get:function(){return this._pathwayPriority},set:function(e){this.updatePathwayPriority(e)}}])}(he);function el(a,o,n,r){a&&Object.keys(o).forEach(function(e){var t=a.filter(function(i){return i.groupId===e}).map(function(i){var s=ne({},i);return s.details=void 0,s.attrs=new et(s.attrs),s.url=s.attrs.URI=tl(i.url,i.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),s.groupId=s.attrs["GROUP-ID"]=o[e],s.attrs["PATHWAY-ID"]=r,s});a.push.apply(a,t)})}function tl(a,o,n,r){var e=r.HOST,t=r.PARAMS,i=r[n],s;o&&(s=i==null?void 0:i[o],s&&(a=s));var l=new self.URL(a);return e&&!s&&(l.host=e),t&&Object.keys(t).sort().forEach(function(u){u&&l.searchParams.set(u,t[u])}),l.href}var rl=function(a){function o(r){var e;return e=a.call(this,"eme",r.logger)||this,e.hls=void 0,e.config=void 0,e.media=null,e.keyFormatPromise=null,e.keySystemAccessPromises={},e._requestLicenseFailureCount=0,e.mediaKeySessions=[],e.keyIdToKeySessionPromise={},e.setMediaKeysQueue=o.CDMCleanupPromise?[o.CDMCleanupPromise]:[],e.onMediaEncrypted=function(t){var i=t.initDataType,s=t.initData,l='"'+t.type+'" event: init data type: "'+i+'"';if(e.debug(l),s!==null){if(!e.keyFormatPromise){var u=Object.keys(e.keySystemAccessPromises);u.length||(u=gn(e.config));var f=u.map(ya).filter(function(d){return!!d});e.keyFormatPromise=e.getKeyFormatPromise(f)}e.keyFormatPromise.then(function(d){var h=ma(d),c,v;if(i==="sinf"){if(h!==Fe.FAIRPLAY){e.warn('Ignoring unexpected "'+t.type+'" event with init data type: "'+i+'" for selected key-system '+h);return}var g=De(new Uint8Array(s));try{var m=va(JSON.parse(g).sinf),y=zr(m);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");c=new Uint8Array(y.subarray(8,24)),v=Fe.FAIRPLAY}catch(N){e.warn(l+" Failed to parse sinf: "+N);return}}else{if(h!==Fe.WIDEVINE&&h!==Fe.PLAYREADY){e.warn('Ignoring unexpected "'+t.type+'" event with init data type: "'+i+'" for selected key-system '+h);return}var E=Ai(s),T=E.filter(function(N){return!!N.systemId&&pa(N.systemId)===h});T.length>1&&e.warn(l+" Using first of "+T.length+" pssh found for selected key-system "+h);var S=T[0];if(!S){E.length===0||E.some(function(N){return!N.systemId})?e.warn(l+" contains incomplete or invalid pssh data"):e.log("ignoring "+l+" for "+E.map(function(N){return pa(N.systemId)}).join(",")+" pssh data in favor of playlist keys");return}if(v=pa(S.systemId),S.version===0&&S.data)if(v===Fe.WIDEVINE){var x=S.data.length-22;c=new Uint8Array(S.data.subarray(x,x+16))}else v===Fe.PLAYREADY&&(c=Vs(S.data))}if(!(!v||!c)){for(var A=Me.hexDump(c),L=e,_=L.keyIdToKeySessionPromise,k=L.mediaKeySessions,R=_[A],b=function(){var O=k[C],M=O.decryptdata;if(!M.keyId)return 0;var G=Me.hexDump(M.keyId);if(A===G||M.uri.replace(/-/g,"").indexOf(A)!==-1)return R=_[G],M.pssh||(delete _[G],M.pssh=new Uint8Array(s),M.keyId=c,R=_[A]=R.then(function(){return e.generateRequestWithPreferredKeySession(O,i,s,"encrypted-event-key-match")}),R.catch(function(Y){return e.handleError(Y)})),1},D,C=0;C<k.length&&(D=b(),!(D!==0&&D===1));C++);if(!R){if(v!==h){e.log('Ignoring "'+t.type+'" event with '+v+" init data for selected key-system "+h);return}R=_[A]=e.getKeySystemSelectionPromise([v]).then(function(N){var O,M=N.keySystem,G=N.mediaKeys;e.throwIfDestroyed();var Y=new Ea("ISO-23001-7",A,(O=ya(M))!=null?O:"");return Y.pssh=new Uint8Array(s),Y.keyId=c,e.attemptSetMediaKeys(M,G).then(function(){e.throwIfDestroyed();var W=e.createMediaKeySessionContext({decryptdata:Y,keySystem:M,mediaKeys:G});return e.generateRequestWithPreferredKeySession(W,i,s,"encrypted-event-no-match")})}),R.catch(function(N){return e.handleError(N)})}}})}},e.onWaitingForKey=function(t){e.log('"'+t.type+'" event')},e.hls=r,e.config=r.config,e.registerListeners(),e}j(o,a);var n=o.prototype;return n.destroy=function(){var e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);var t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null},n.registerListeners=function(){this.hls.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(p.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(p.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(p.MANIFEST_LOADED,this.onManifestLoaded,this)},n.unregisterListeners=function(){this.hls.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(p.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(p.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(p.MANIFEST_LOADED,this.onManifestLoaded,this)},n.getLicenseServerUrl=function(e){var t=this.config,i=t.drmSystems,s=t.widevineLicenseUrl,l=i[e];if(l)return l.licenseUrl;if(e===Fe.WIDEVINE&&s)return s},n.getLicenseServerUrlOrThrow=function(e){var t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error('no license server URL configured for key-system "'+e+'"');return t},n.getServerCertificateUrl=function(e){var t=this.config.drmSystems,i=t[e];if(i)return i.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},n.attemptKeySystemAccess=function(e){var t=this,i=this.hls.levels,s=function(d,h,c){return!!d&&c.indexOf(d)===h},l=i.map(function(f){return f.audioCodec}).filter(s),u=i.map(function(f){return f.videoCodec}).filter(s);return l.length+u.length===0&&u.push("avc1.42e01e"),new Promise(function(f,d){var h=function(v){var g=v.shift();t.getMediaKeysPromise(g,l,u).then(function(m){return f({keySystem:g,mediaKeys:m})}).catch(function(m){v.length?h(v):m instanceof Xt?d(m):d(new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};h(e)})},n.requestMediaKeySystemAccess=function(e,t){var i=this.config.requestMediaKeySystemAccessFunc;if(typeof i!="function"){var s="Configured requestMediaKeySystemAccess is not a function "+i;return Hs===null&&self.location.protocol==="http:"&&(s="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(s))}return i(e,t)},n.getMediaKeysPromise=function(e,t,i){var s=this,l=Ru(e,t,i,this.config.drmSystemOptions),u=this.keySystemAccessPromises[e],f=u==null?void 0:u.keySystemAccess;if(!f){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+Ge(l)),f=this.requestMediaKeySystemAccess(e,l);var d=this.keySystemAccessPromises[e]={keySystemAccess:f};return f.catch(function(h){s.log('Failed to obtain access to key-system "'+e+'": '+h)}),f.then(function(h){s.log('Access for key-system "'+h.keySystem+'" obtained');var c=s.fetchServerCertificate(e);return s.log('Create media-keys for "'+e+'"'),d.mediaKeys=h.createMediaKeys().then(function(v){return s.log('Media-keys created for "'+e+'"'),c.then(function(g){return g?s.setMediaKeysServerCertificate(v,e,g):v})}),d.mediaKeys.catch(function(v){s.error('Failed to create media-keys for "'+e+'"}: '+v)}),d.mediaKeys})}return f.then(function(){return u.mediaKeys})},n.createMediaKeySessionContext=function(e){var t=e.decryptdata,i=e.keySystem,s=e.mediaKeys;this.log('Creating key-system session "'+i+'" keyId: '+Me.hexDump(t.keyId||[]));var l=s.createSession(),u={decryptdata:t,keySystem:i,mediaKeys:s,mediaKeysSession:l,keyStatus:"status-pending"};return this.mediaKeySessions.push(u),u},n.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var i=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),l="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,l,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},n.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Me.hexDump(e.keyId)},n.updateKeySession=function(e,t){var i,s=e.mediaKeysSession;return this.log('Updating key-session "'+s.sessionId+'" for keyID '+Me.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])+`
      } (data length: `+(t&&t.byteLength)+")"),s.update(t)},n.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},n.getKeyFormatPromise=function(e){var t=this;return new Promise(function(i,s){var l=gn(t.config),u=e.map(ma).filter(function(f){return!!f&&l.indexOf(f)!==-1});return t.getKeySystemSelectionPromise(u).then(function(f){var d=f.keySystem,h=ya(d);h?i(h):s(new Error('Unable to find format for key-system "'+d+'"'))}).catch(s)})},n.loadKey=function(e){var t=this,i=e.keyInfo.decryptdata,s=this.getKeyIdString(i),l="(keyId: "+s+' format: "'+i.keyFormat+'" method: '+i.method+" uri: "+i.uri+")";this.log("Starting session for key "+l);var u=this.keyIdToKeySessionPromise[s];if(!u){u=this.getKeySystemForKeyPromise(i).then(function(d){var h=d.keySystem,c=d.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+l),t.attemptSetMediaKeys(h,c).then(function(){return t.throwIfDestroyed(),t.createMediaKeySessionContext({keySystem:h,mediaKeys:c,decryptdata:i})})});var f=this.keyIdToKeySessionPromise[s]=u.then(function(d){var h="cenc",c=i.pssh?i.pssh.buffer:null;return t.generateRequestWithPreferredKeySession(d,h,c,"playlist-key")});f.catch(function(d){return t.handleError(d)})}return u},n.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},n.handleError=function(e){this.hls&&(this.error(e.message),e instanceof Xt?this.hls.trigger(p.ERROR,e.data):this.hls.trigger(p.ERROR,{type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},n.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){var s=ma(e.keyFormat),l=s?[s]:gn(this.config);return this.attemptKeySystemAccess(l)}return i},n.getKeySystemSelectionPromise=function(e){if(e.length||(e=gn(this.config)),e.length===0)throw new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+Ge({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},n.attemptSetMediaKeys=function(e,t){var i=this,s=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var l=Promise.all(s).then(function(){if(!i.media)throw new Error("Attempted to set mediaKeys without media element attached");return i.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(l),l.then(function(){i.log('Media-keys set for "'+e+'"'),s.push(l),i.setMediaKeysQueue=i.setMediaKeysQueue.filter(function(u){return s.indexOf(u)===-1})})},n.generateRequestWithPreferredKeySession=function(e,t,i,s){var l,u,f=this,d=(l=this.config.drmSystems)==null||(u=l[e.keySystem])==null?void 0:u.generateRequest;if(d)try{var h=d.call(this.hls,t,i,e);if(!h)throw new Error("Invalid response from configured generateRequest filter");t=h.initDataType,i=h.initData?h.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(T){var c;if(this.warn(T.message),(c=this.hls)!=null&&c.config.debug)throw T}if(i===null)return this.log('Skipping key-session request for "'+s+'" (no initData)'),Promise.resolve(e);var v=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+s+'": '+v+" (init data type: "+t+" length: "+(i?i.byteLength:null)+")");var g=new Kt,m=e._onmessage=function(T){var S=e.mediaKeysSession;if(!S){g.emit("error",new Error("invalid state"));return}var x=T.messageType,A=T.message;f.log('"'+x+'" message event for session "'+S.sessionId+'" message size: '+A.byteLength),x==="license-request"||x==="license-renewal"?f.renewLicense(e,A).catch(function(L){g.eventNames().length?g.emit("error",L):f.handleError(L)}):x==="license-release"?e.keySystem===Fe.FAIRPLAY&&(f.updateKeySession(e,ga("acknowledged")),f.removeSession(e)):f.warn('unhandled media key message type "'+x+'"')},y=e._onkeystatuseschange=function(T){var S=e.mediaKeysSession;if(!S){g.emit("error",new Error("invalid state"));return}f.onKeyStatusChange(e);var x=e.keyStatus;g.emit("keyStatus",x),x==="expired"&&(f.warn(e.keySystem+" expired for key "+v),f.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",m),e.mediaKeysSession.addEventListener("keystatuseschange",y);var E=new Promise(function(T,S){g.on("error",S),g.on("keyStatus",function(x){x.startsWith("usable")?T():x==="output-restricted"?S(new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):x==="internal-error"?S(new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+x+'"')):x==="expired"?S(new Error("key expired while generating request")):f.warn('unhandled key status change "'+x+'"')})});return e.mediaKeysSession.generateRequest(t,i).then(function(){var T;f.log('Request generated for key-session "'+((T=e.mediaKeysSession)==null?void 0:T.sessionId)+'" keyId: '+v)}).catch(function(T){throw new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_SESSION,error:T,fatal:!1},"Error generating key-session request: "+T)}).then(function(){return E}).catch(function(T){throw g.removeAllListeners(),f.removeSession(e),T}).then(function(){return g.removeAllListeners(),e})},n.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach(function(i,s){if(typeof s=="string"&&typeof i=="object"){var l=s;s=i,i=l}t.log('key status change "'+i+'" for keyStatuses keyId: '+Me.hexDump("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))+" session keyId: "+Me.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=i})},n.fetchServerCertificate=function(e){var t=this.config,i=t.loader,s=new i(t),l=this.getServerCertificateUrl(e);return l?(this.log('Fetching server certificate for "'+e+'"'),new Promise(function(u,f){var d={responseType:"arraybuffer",url:l},h=t.certLoadPolicy.default,c={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},v={onSuccess:function(m,y,E,T){u(m.data)},onError:function(m,y,E,T){f(new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:ae({url:d.url,data:void 0},m)},'"'+e+'" certificate request failed ('+l+"). Status: "+m.code+" ("+m.text+")"))},onTimeout:function(m,y,E){f(new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:d.url,data:void 0}},'"'+e+'" certificate request timed out ('+l+")"))},onAbort:function(m,y,E){f(new Error("aborted"))}};s.load(d,c,v)})):Promise.resolve()},n.setMediaKeysServerCertificate=function(e,t,i){var s=this;return new Promise(function(l,u){e.setServerCertificate(i).then(function(f){s.log("setServerCertificate "+(f?"success":"not supported by CDM")+" ("+(i==null?void 0:i.byteLength)+') on "'+t+'"'),l(e)}).catch(function(f){u(new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:f,fatal:!0},f.message))})})},n.renewLicense=function(e,t){var i=this;return this.requestLicense(e,new Uint8Array(t)).then(function(s){return i.updateKeySession(e,new Uint8Array(s)).catch(function(l){throw new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:l,fatal:!0},l.message)})})},n.unpackPlayReadyKeyMessage=function(e,t){var i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;var s=new DOMParser().parseFromString(i,"application/xml"),l=s.querySelectorAll("HttpHeader");if(l.length>0)for(var u,f=0,d=l.length;f<d;f++){var h,c;u=l[f];var v=(h=u.querySelector("name"))==null?void 0:h.textContent,g=(c=u.querySelector("value"))==null?void 0:c.textContent;v&&g&&e.setRequestHeader(v,g)}var m=s.querySelector("Challenge"),y=m==null?void 0:m.textContent;if(!y)throw new Error("Cannot find <Challenge> in key message");return ga(atob(y))},n.setupLicenseXHR=function(e,t,i,s){var l=this,u=this.config.licenseXhrSetup;return u?Promise.resolve().then(function(){if(!i.decryptdata)throw new Error("Key removed");return u.call(l.hls,e,t,i,s)}).catch(function(f){if(!i.decryptdata)throw f;return e.open("POST",t,!0),u.call(l.hls,e,t,i,s)}).then(function(f){e.readyState||e.open("POST",t,!0);var d=f||s;return{xhr:e,licenseChallenge:d}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))},n.requestLicense=function(e,t){var i=this,s=this.config.keyLoadPolicy.default;return new Promise(function(l,u){var f=i.getLicenseServerUrlOrThrow(e.keySystem);i.log("Sending license request to URL: "+f);var d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=function(){if(!i.hls||!e.mediaKeysSession)return u(new Error("invalid state"));if(d.readyState===4)if(d.status===200){i._requestLicenseFailureCount=0;var h=d.response;i.log("License received "+(h instanceof ArrayBuffer?h.byteLength:h));var c=i.config.licenseResponseCallback;if(c)try{h=c.call(i.hls,d,f,e)}catch(y){i.error(y)}l(h)}else{var v=s.errorRetry,g=v?v.maxNumRetry:0;if(i._requestLicenseFailureCount++,i._requestLicenseFailureCount>g||d.status>=400&&d.status<500)u(new Xt({type:B.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:d,response:{url:f,data:void 0,code:d.status,text:d.statusText}},"License Request XHR failed ("+f+"). Status: "+d.status+" ("+d.statusText+")"));else{var m=g-i._requestLicenseFailureCount+1;i.warn("Retrying license request, "+m+" attempts left"),i.requestLicense(e,t).then(l,u)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=d,i.setupLicenseXHR(d,f,e,t).then(function(h){var c=h.xhr,v=h.licenseChallenge;e.keySystem==Fe.PLAYREADY&&(v=i.unpackPlayReadyKeyMessage(c,v)),c.send(v)})})},n.onMediaAttached=function(e,t){if(this.config.emeEnabled){var i=t.media;this.media=i,i.removeEventListener("encrypted",this.onMediaEncrypted),i.removeEventListener("waitingforkey",this.onWaitingForKey),i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}},n.onMediaDetached=function(){var e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)},n._clear=function(e){var t=this,i,s=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Ea.clearKeyUriToKeyIdMap();var l=s.length;o.CDMCleanupPromise=Promise.all(s.map(function(u){return t.removeSession(u)}).concat(e==null||(i=e.setMediaKeys(null))==null?void 0:i.catch(function(u){var f;t.log("Could not clear media keys: "+u),(f=t.hls)==null||f.trigger(p.ERROR,{type:B.OTHER_ERROR,details:I.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: "+u)})}))).then(function(){l&&(t.log("finished closing key sessions and clearing media keys"),s.length=0)}).catch(function(u){var f;t.log("Could not close sessions and clear media keys: "+u),(f=t.hls)==null||f.trigger(p.ERROR,{type:B.OTHER_ERROR,details:I.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: "+u)})})},n.onManifestLoading=function(){this.keyFormatPromise=null},n.onManifestLoaded=function(e,t){var i=t.sessionKeys;if(!(!i||!this.config.emeEnabled)&&!this.keyFormatPromise){var s=i.reduce(function(l,u){return l.indexOf(u.keyFormat)===-1&&l.push(u.keyFormat),l},[]);this.log("Selecting key-system from session-keys "+s.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(s)}},n.removeSession=function(e){var t=this,i=e.mediaKeysSession,s=e.licenseXhr;if(i){this.log("Remove licenses and keys and close session "+i.sessionId),e._onmessage&&(i.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var l=this.mediaKeySessions.indexOf(e);l>-1&&this.mediaKeySessions.splice(l,1);var u=this.config.drmSystemOptions,f=_u(u)?new Promise(function(d,h){self.setTimeout(function(){return h(new Error("MediaKeySession.remove() timeout"))},8e3),i.remove().then(d)}):Promise.resolve();return f.catch(function(d){var h;t.log("Could not remove session: "+d),(h=t.hls)==null||h.trigger(p.ERROR,{type:B.OTHER_ERROR,details:I.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: "+d)})}).then(function(){return i.close()}).catch(function(d){var h;t.log("Could not close session: "+d),(h=t.hls)==null||h.trigger(p.ERROR,{type:B.OTHER_ERROR,details:I.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: "+d)})})}},o}(he);rl.CDMCleanupPromise=void 0;var Xt=function(a){function o(n,r){var e;return e=a.call(this,r)||this,e.data=void 0,n.error||(n.error=new Error(r)),e.data=n,n.err=n.error,e}return j(o,a),o}(at(Error)),Bd=function(){function a(n){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=n,this.registerListeners()}var o=a.prototype;return o.setStreamController=function(r){this.streamController=r},o.registerListeners=function(){this.hls.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(p.MEDIA_DETACHING,this.onMediaDetaching,this)},o.unregisterListeners=function(){this.hls.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(p.MEDIA_DETACHING,this.onMediaDetaching,this)},o.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},o.onMediaAttaching=function(r,e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var i=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},o.onMediaDetaching=function(){this.media=null},o.checkFPS=function(r,e,t){var i=performance.now();if(e){if(this.lastTime){var s=i-this.lastTime,l=t-this.lastDroppedFrames,u=e-this.lastDecodedFrames,f=1e3*l/s,d=this.hls;if(d.trigger(p.FPS_DROP,{currentDropped:l,currentDecoded:u,totalDroppedFrames:t}),f>0&&l>d.config.fpsDroppedMonitoringThreshold*u){var h=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=h)&&(h=h-1,d.trigger(p.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=t,this.lastDecodedFrames=e}},o.checkFPSInterval=function(){var r=this.media;if(r)if(this.isVideoPlaybackQualityAvailable){var e=r.getVideoPlaybackQuality();this.checkFPS(r,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(r,r.webkitDecodedFrameCount,r.webkitDroppedFrameCount)},a}();function Bi(a){for(var o=5381,n=a.length;n;)o=o*33^a.charCodeAt(--n);return(o>>>0).toString()}var oi=.025,Rn=function(a){return a[a.Point=0]="Point",a[a.Range=1]="Range",a}({});function Gd(a,o,n){return a.identifier+"-"+(n+1)+"-"+Bi(o)}var Kd=function(){function a(n,r){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=r,this.dateRange=n,this.setDateRange(n)}var o=a.prototype;return o.setDateRange=function(r){this.dateRange=r,this.resumeOffset=r.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=r.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=r.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=r.attr.enumeratedStringList("X-SNAP",this.snapOptions)},o.reset=function(){var r;this.appendInPlaceStarted=!1,(r=this.assetListLoader)==null||r.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)},o.isAssetPastPlayoutLimit=function(r){if(r>=this.assetList.length)return!0;var e=this.playoutLimit;if(r<=0||isNaN(e))return!1;var t=this.assetList[r].startOffset;return t>e},o.findAssetIndex=function(r){var e=this.assetList.indexOf(r);return e},o.toString=function(){return Hd(this)},oe(a,[{key:"identifier",get:function(){return this.dateRange.id}},{key:"startDate",get:function(){return this.dateRange.startDate}},{key:"startTime",get:function(){var r=this.dateRange.startTime;if(this.snapOptions.out){var e=this.dateRange.tagAnchor;if(e)return ja(r,e)}return r}},{key:"startOffset",get:function(){return this.cue.pre?0:this.startTime}},{key:"startIsAligned",get:function(){if(this.startTime===0||this.snapOptions.out)return!0;var r=this.dateRange.tagAnchor;if(r){var e=this.dateRange.startTime,t=ja(e,r);return e-t<.1}return!1}},{key:"resumptionOffset",get:function(){var r=this.resumeOffset,e=U(r)?r:this.duration;return this.cumulativeDuration+e}},{key:"resumeTime",get:function(){var r=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){var e=this.resumeAnchor;if(e)return ja(r,e)}return r}},{key:"appendInPlace",get:function(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<oi))},set:function(r){if(this.appendInPlaceStarted){this.resetOnResume=!r;return}this.appendInPlaceDisabled=!r}},{key:"timelineStart",get:function(){return this._timelineStart!==null?this._timelineStart:this.startTime},set:function(r){this._timelineStart=r}},{key:"duration",get:function(){var r=this.playoutLimit,e;return this._duration!==null?e=this._duration:this.dateRange.duration?e=this.dateRange.duration:e=this.dateRange.plannedDuration||0,!isNaN(r)&&r<e&&(e=r),e},set:function(r){this._duration=r}},{key:"cue",get:function(){return this.dateRange.cue}},{key:"timelineOccupancy",get:function(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Rn.Range:Rn.Point}},{key:"supplementsPrimary",get:function(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}},{key:"contentMayVary",get:function(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}},{key:"assetUrl",get:function(){return this.dateRange.attr["X-ASSET-URI"]}},{key:"assetListUrl",get:function(){return this.dateRange.attr["X-ASSET-LIST"]}},{key:"baseUrl",get:function(){return this.base.url}},{key:"assetListLoaded",get:function(){return this.assetList.length>0||this.assetListResponse!==null}}])}();function ja(a,o){return a-o.start<o.duration/2&&!(Math.abs(a-(o.start+o.duration))<oi)?o.start:o.start+o.duration}function il(a,o,n){var r=new self.URL(a,n);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",o),r}function Hd(a){return'["'+a.identifier+'" '+(a.cue.pre?"<pre>":a.cue.post?"<post>":"")+a.timelineStart.toFixed(2)+"-"+a.resumeTime.toFixed(2)+"]"}function Xa(a){var o=a.timelineStart,n=a.duration||0;return'["'+a.identifier+'" '+o.toFixed(2)+"-"+(o+n).toFixed(2)+"]"}var Vd=function(){function a(n,r,e,t){var i=this;this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=function(){var f=i.interstitial,d=f.playoutLimit,h=i.currentTime;i.startOffset+h>=d&&i.hls.trigger(p.PLAYOUT_LIMIT_REACHED,{})};var s=this.hls=new n(r);this.interstitial=e,this.assetItem=t;var l=t.uri;try{l=il(l,s.sessionId).href}catch{}s.loadSource(l);var u=function(){i.hasDetails=!0};s.once(p.LEVEL_LOADED,u),s.once(p.AUDIO_TRACK_LOADED,u),s.once(p.SUBTITLE_TRACK_LOADED,u),s.on(p.MEDIA_ATTACHING,function(f,d){var h=d.media;i.removeMediaListeners(),i.mediaAttached=h;var c=i.interstitial;c.playoutLimit&&h.addEventListener("timeupdate",i.checkPlayout)})}var o=a.prototype;return o.bufferedInPlaceToEnd=function(r){var e;if(!this.interstitial.appendInPlace)return!1;if((e=this.hls)!=null&&e.bufferedToEnd)return!0;if(!r||!this._bufferedEosTime)return!1;var t=this.timelineOffset,i=Ie.bufferInfo(r,t,0),s=this.getAssetTime(i.end);return s>=this._bufferedEosTime-.02},o.getAssetTime=function(r){var e=this.timelineOffset,t=this.duration;return Math.min(Math.max(0,r-e),t)},o.removeMediaListeners=function(){var r=this.mediaAttached;r&&(this._currentTime=r.currentTime,this.bufferSnapShot(),r.removeEventListener("timeupdate",this.checkPlayout))},o.bufferSnapShot=function(){if(this.mediaAttached){var r;(r=this.hls)!=null&&r.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}},o.destroy=function(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null},o.attachMedia=function(r){this.hls.attachMedia(r)},o.detachMedia=function(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()},o.resumeBuffering=function(){this.hls.resumeBuffering()},o.pauseBuffering=function(){this.hls.pauseBuffering()},o.transferMedia=function(){return this.bufferSnapShot(),this.hls.transferMedia()},o.on=function(r,e,t){this.hls.on(r,e)},o.once=function(r,e,t){this.hls.once(r,e)},o.off=function(r,e,t){this.hls.off(r,e)},o.toString=function(){var r,e;return"HlsAssetPlayer: "+Xa(this.assetItem)+" "+((r=this.hls)==null?void 0:r.sessionId)+" "+((e=this.interstitial)!=null&&e.appendInPlace?"append-in-place":"")},oe(a,[{key:"destroyed",get:function(){var r;return!((r=this.hls)!=null&&r.userConfig)}},{key:"assetId",get:function(){return this.assetItem.identifier}},{key:"interstitialId",get:function(){return this.assetItem.parentIdentifier}},{key:"media",get:function(){var r;return((r=this.hls)==null?void 0:r.media)||null}},{key:"bufferedEnd",get:function(){var r=this.media||this.mediaAttached;if(!r)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;var e=Ie.bufferInfo(r,r.currentTime,.001);return this.getAssetTime(e.end)}},{key:"currentTime",get:function(){var r=this.media||this.mediaAttached;return r?this.getAssetTime(r.currentTime):this._currentTime||0}},{key:"duration",get:function(){var r=this.assetItem.duration;return r||0}},{key:"remaining",get:function(){var r=this.duration;return r?Math.max(0,r-this.currentTime):0}},{key:"startOffset",get:function(){return this.assetItem.startOffset}},{key:"timelineOffset",get:function(){var r;return((r=this.hls)==null?void 0:r.config.timelineOffset)||0},set:function(r){var e=this.timelineOffset;if(r!==e){var t=r-e;if(Math.abs(t)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=r}}}}])}(),nl=.033,Wd=function(a){function o(r,e){var t;return t=a.call(this,"interstitials-sched",e)||this,t.onScheduleUpdate=void 0,t.eventMap={},t.events=null,t.items=null,t.durations={primary:0,playout:0,integrated:0},t.onScheduleUpdate=r,t}j(o,a);var n=o.prototype;return n.destroy=function(){this.reset(),this.onScheduleUpdate=null},n.reset=function(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(function(e){return e.reset()}),this.events=this.items=null},n.resetErrorsInRange=function(e,t){return this.events?this.events.reduce(function(i,s){return e<=s.startOffset&&t>s.startOffset?(delete s.error,i+1):i},0):0},n.getEvent=function(e){return e&&this.eventMap[e]||null},n.hasEvent=function(e){return e in this.eventMap},n.findItemIndex=function(e,t){if(e.event)return this.findEventIndex(e.event.identifier);var i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);var s=this.items;if(s)for(s[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(l=s[i])!=null&&l.event;){var l;i--}return i},n.findItemIndexAtTime=function(e,t){var i=this.items;if(i)for(var s=0;s<i.length;s++){var l=i[s];if(t&&t!=="primary"&&(l=l[t]),e===l.start||e>l.start&&e<l.end)return s}return-1},n.findJumpRestrictedIndex=function(e,t){var i=this.items;if(i)for(var s=e;s<=t&&i[s];s++){var l=i[s].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return s}return-1},n.findEventIndex=function(e){var t=this.items;if(t)for(var i=t.length;i--;){var s;if(((s=t[i].event)==null?void 0:s.identifier)===e)return i}return-1},n.findAssetIndex=function(e,t){var i=e.assetList,s=i.length;if(s>1)for(var l=0;l<s;l++){var u=i[l];if(!u.error){var f=u.timelineStart;if(t===f||t>f&&t<f+(u.duration||0))return l}}return 0},n.parseInterstitialDateRanges=function(e,t){var i=this,s=e.main.details,l=s.dateRanges,u=this.events,f=this.parseDateRanges(l,{url:s.url},t),d=Object.keys(l),h=u?u.filter(function(c){return!d.includes(c.identifier)}):[];f.length&&f.sort(function(c,v){var g=c.cue.pre,m=c.cue.post,y=v.cue.pre,E=v.cue.post;if(g&&!y)return-1;if(y&&!g||m&&!E)return 1;if(E&&!m)return-1;if(!g&&!y&&!m&&!E){var T=c.startTime,S=v.startTime;if(T!==S)return T-S}return c.dateRange.tagOrder-v.dateRange.tagOrder}),this.events=f,h.forEach(function(c){i.removeEvent(c)}),this.updateSchedule(e,h)},n.updateSchedule=function(e,t){t===void 0&&(t=[]);var i=this.events||[];if(i.length||t.length||this.length<2){var s=this.items,l=this.parseSchedule(i,e),u=t.length||(s==null?void 0:s.length)!==l.length||l.some(function(f,d){return Math.abs(f.playout.start-s[d].playout.start)>.005||Math.abs(f.playout.end-s[d].playout.end)>.005});u&&(this.items=l,this.onScheduleUpdate(t,s))}},n.parseDateRanges=function(e,t,i){for(var s=[],l=Object.keys(e),u=0;u<l.length;u++){var f=l[u],d=e[f];if(d.isInterstitial){var h=this.eventMap[f];h?h.setDateRange(d):(h=new Kd(d,t),this.eventMap[f]=h,i===!1&&(h.appendInPlace=i)),s.push(h)}}return s},n.parseSchedule=function(e,t){var i=[],s=t.main.details,l=s.live?1/0:s.edge,u=0;if(e=e.filter(function(E){return!E.error&&!(E.cue.once&&E.hasPlayed)}),e.length){this.resolveOffsets(e,t);var f=0,d=0;if(e.forEach(function(E,T){var S=E.cue.pre,x=E.cue.post,A=e[T-1]||null,L=E.appendInPlace,_=x?l:E.startOffset,k=E.duration,R=E.timelineOccupancy===Rn.Range?k:0,b=E.resumptionOffset,D=(A==null?void 0:A.startTime)===_,C=_+E.cumulativeDuration,N=L?C+k:_+b;if(S||!x&&_<=0){var O=d;d+=R,E.timelineStart=C;var M=u;u+=k,i.push({event:E,start:C,end:N,playout:{start:M,end:u},integrated:{start:O,end:d}})}else if(_<=l){if(!D){var G=_-f;if(G>nl){var Y=f,W=d;d+=G;var ie=u;u+=G;var xe={previousEvent:e[T-1]||null,nextEvent:E,start:Y,end:Y+G,playout:{start:ie,end:u},integrated:{start:W,end:d}};i.push(xe)}else G>0&&A&&(A.cumulativeDuration+=G,i[i.length-1].end=_)}x&&(N=C),E.timelineStart=C;var ue=d;d+=R;var _e=u;u+=k,i.push({event:E,start:C,end:N,playout:{start:_e,end:u},integrated:{start:ue,end:d}})}else return;var ge=E.resumeTime;x||ge>l?f=l:f=ge}),f<l){var h,c=f,v=d,g=l-f;d+=g;var m=u;u+=g,i.push({previousEvent:((h=i[i.length-1])==null?void 0:h.event)||null,nextEvent:null,start:f,end:c+g,playout:{start:m,end:u},integrated:{start:v,end:d}})}this.setDurations(l,u,d)}else{var y=0;i.push({previousEvent:null,nextEvent:null,start:y,end:l,playout:{start:y,end:l},integrated:{start:y,end:l}}),this.setDurations(l,l,l)}return i},n.setDurations=function(e,t,i){this.durations={primary:e,playout:t,integrated:i}},n.resolveOffsets=function(e,t){var i=this,s=t.main.details,l=s.live?1/0:s.edge,u=0,f=-1;e.forEach(function(d,h){var c=d.cue.pre,v=d.cue.post,g=c?0:v?l:d.startTime;i.updateAssetDurations(d);var m=f===g;if(m?d.cumulativeDuration=u:(u=0,f=g),!v&&d.snapOptions.in&&(d.resumeAnchor=Kr(null,s.fragments,d.startOffset+d.resumptionOffset,0,0)||void 0),d.appendInPlace&&!d.appendInPlaceStarted){var y=i.primaryCanResumeInPlaceAt(d,t);y||(d.appendInPlace=!1)}if(!d.appendInPlace&&h+1<e.length){var E=e[h+1].startTime-e[h].resumeTime;E<nl&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&i.warn("Could not change append strategy for abutting event "+d))}var T=U(d.resumeOffset)?d.resumeOffset:d.duration;u+=T})},n.primaryCanResumeInPlaceAt=function(e,t){var i=this,s=e.resumeTime,l=e.startTime+e.resumptionOffset;if(Math.abs(s-l)>oi)return this.log('"'+e.identifier+'" resumption '+s+" not aligned with estimated timeline end "+l),!1;if(!t)return this.log('"'+e.identifier+'" resumption '+s+" can not be aligned with media (none selected)"),!1;var u=Object.keys(t);return!u.some(function(f){var d=t[f].details,h=d.edge;if(s>=h)return i.log('"'+e.identifier+'" resumption '+s+" past "+f+" playlist end "+h),!1;var c=Kr(null,d.fragments,s);if(!c)return i.log('"'+e.identifier+'" resumption '+s+" does not align with any fragments in "+f+" playlist ("+d.fragStart+"-"+d.fragmentEnd+")"),!0;var v=f==="audio"?.175:0,g=Math.abs(c.start-s)<oi+v||Math.abs(c.end-s)<oi+v;return g?!1:(i.log('"'+e.identifier+'" resumption '+s+" not aligned with "+f+" fragment bounds ("+c.start+"-"+c.end+" sn: "+c.sn+" cc: "+c.cc+")"),!0)})},n.updateAssetDurations=function(e){if(e.assetListLoaded){var t=e.timelineStart,i=0,s=!1,l=!1;e.assetList.forEach(function(u,f){var d=t+i;u.startOffset=i,u.timelineStart=d,s||(s=u.duration===null),l||(l=!!u.error);var h=u.error?0:u.duration||0;i+=h}),s&&!l?e.duration=Math.max(i,e.duration):e.duration=i}},n.removeEvent=function(e){e.reset(),delete this.eventMap[e.identifier]},oe(o,[{key:"duration",get:function(){var e=this.items;return e?e[e.length-1].end:0}},{key:"length",get:function(){return this.items?this.items.length:0}},{key:"assetIdAtEnd",get:function(){var e,t,i=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(i){var s=i.assetList,l=s[s.length-1];if(l)return l.identifier}return null}}])}(he);function Rr(a){return"["+(a.event?'"'+a.event.identifier+'"':"primary")+": "+a.start.toFixed(2)+"-"+a.end.toFixed(2)+"]"}var Yd=function(){function a(n){this.hls=void 0,this.hls=n}var o=a.prototype;return o.destroy=function(){this.hls=null},o.loadAssetList=function(r,e){var t=this,i=r.assetListUrl,s;try{s=il(i,this.hls.sessionId,r.baseUrl)}catch(m){var l=this.assignAssetListError(r,I.ASSET_LIST_LOAD_ERROR,m,i);this.hls.trigger(p.ERROR,l);return}e&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+e);var u=this.hls.config,f=u.loader,d=new f(u),h={responseType:"json",url:s.href},c=u.interstitialAssetListLoadPolicy.default,v={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:function(y,E,T,S){var x=y.data,A=x==null?void 0:x.ASSETS;if(!Array.isArray(A)){var L=t.assignAssetListError(r,I.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),T.url,E,S);t.hls.trigger(p.ERROR,L);return}r.assetListResponse=x,t.hls.trigger(p.ASSET_LIST_LOADED,{event:r,assetListResponse:x,networkDetails:S})},onError:function(y,E,T,S){var x=t.assignAssetListError(r,I.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status "+y.code+" "+y.text+" ("+E.url+")"),E.url,S,T);t.hls.trigger(p.ERROR,x)},onTimeout:function(y,E,T){var S=t.assignAssetListError(r,I.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST ("+E.url+")"),E.url,y,T);t.hls.trigger(p.ERROR,S)}};return d.load(h,v,g),this.hls.trigger(p.ASSET_LIST_LOADING,{event:r}),d},o.assignAssetListError=function(r,e,t,i,s,l){return r.error=t,{type:B.NETWORK_ERROR,details:e,fatal:!1,interstitial:r,url:i,error:t,networkDetails:l,stats:s}},a}();function yr(a,o,n){fr(a,o,n),a.addEventListener(o,n)}function fr(a,o,n){a.removeEventListener(o,n)}function al(a){a==null||a.play().catch(function(){})}var qd=function(a){function o(r,e){var t;return t=a.call(this,"interstitials",r.logger)||this,t.HlsPlayerClass=void 0,t.hls=void 0,t.assetListLoader=void 0,t.mediaSelection=null,t.altSelection=null,t.media=null,t.detachedData=null,t.requiredTracks=null,t.manager=null,t.playerQueue=[],t.bufferedPos=-1,t.timelinePos=-1,t.schedule=void 0,t.playingItem=null,t.bufferingItem=null,t.waitingItem=null,t.endedItem=null,t.playingAsset=null,t.endedAsset=null,t.bufferingAsset=null,t.shouldPlay=!1,t.onPlay=function(){t.shouldPlay=!0},t.onPause=function(){t.shouldPlay=!1},t.onSeeking=function(){var i=t.currentTime;if(!(i===void 0||t.playbackDisabled)){var s=i-t.timelinePos,l=Math.abs(s)<1/7056e5;if(!l){var u=s<=-.01;t.timelinePos=i,t.bufferedPos=i;var f=t.playingItem;if(!f){t.checkBuffer();return}if(u){var d=t.schedule.resetErrorsInRange(i,i-s);d&&t.updateSchedule()}if(t.checkBuffer(),u&&i<f.start||i>=f.end){var h,c=t.schedule.findItemIndexAtTime(t.timelinePos);if(!t.isInterstitial(f)&&(h=t.media)!=null&&h.paused&&(t.shouldPlay=!1),!u){var v=t.findItemIndex(f);if(c>v){var g=t.schedule.findJumpRestrictedIndex(v+1,c);if(g>v){t.setSchedulePosition(g);return}}}t.setSchedulePosition(c);return}var m=t.playingAsset;if(!m){if(t.playingLastItem&&t.isInterstitial(f)){var y=f.event.assetList[0];y&&(t.endedItem=t.playingItem,t.playingItem=null,t.setScheduleToAssetAtTime(i,y))}return}var E=m.timelineStart,T=m.duration||0;(u&&i<E||i>=E+T)&&t.setScheduleToAssetAtTime(i,m)}}},t.onTimeupdate=function(){var i=t.currentTime;if(!(i===void 0||t.playbackDisabled)){if(i>t.timelinePos)t.timelinePos=i,i>t.bufferedPos&&t.checkBuffer();else return;var s=t.playingItem;if(!(!s||t.playingLastItem)){if(i>=s.end){t.timelinePos=s.end;var l=t.findItemIndex(s);t.setSchedulePosition(l+1)}var u=t.playingAsset;if(u){var f=u.timelineStart+(u.duration||0);i>=f&&t.setScheduleToAssetAtTime(i,u)}}}},t.onScheduleUpdate=function(i,s){var l=t.schedule,u=t.playingItem,f=l.events||[],d=l.items||[],h=l.durations,c=i.map(function(E){return E.identifier}),v=!!(f.length||c.length);if(v&&t.log("INTERSTITIALS_UPDATED ("+f.length+"): "+f+`
Schedule: `+d.map(function(E){return Rr(E)})),c.length&&t.log("Removed events "+c),t.playerQueue.forEach(function(E){if(E.interstitial.appendInPlace){var T=E.assetItem.timelineStart,S=E.timelineOffset-T;if(S)try{E.timelineOffset=T}catch(x){Math.abs(S)>oi&&t.warn(x+' ("'+E.assetId+'" '+E.timelineOffset+"->"+T+")")}}}),u){var g=t.updateItem(u,t.timelinePos);t.itemsMatch(u,g)&&(t.playingItem=g,t.waitingItem=t.endedItem=null)}else t.waitingItem=t.updateItem(t.waitingItem),t.endedItem=t.updateItem(t.endedItem);var m=t.bufferingItem;if(m){var y=t.updateItem(m,t.bufferedPos);t.itemsMatch(m,y)?t.bufferingItem=y:m.event&&(t.bufferingItem=t.playingItem,t.clearInterstitial(m.event,null))}if(i.forEach(function(E){E.assetList.forEach(function(T){t.clearAssetPlayer(T.identifier,null)})}),v||s){if(t.hls.trigger(p.INTERSTITIALS_UPDATED,{events:f.slice(0),schedule:d.slice(0),durations:h,removedIds:c}),t.isInterstitial(u)&&c.includes(u.event.identifier)){t.warn('Interstitial "'+u.event.identifier+'" removed while playing'),t.primaryFallback(u.event);return}t.checkBuffer()}},t.hls=r,t.HlsPlayerClass=e,t.assetListLoader=new Yd(r),t.schedule=new Wd(t.onScheduleUpdate,r.logger),t.registerListeners(),t}j(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(p.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(p.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(p.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(p.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(p.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(p.BUFFER_APPENDED,this.onBufferAppended,this),e.on(p.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(p.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(p.MEDIA_ENDED,this.onMediaEnded,this),e.on(p.ERROR,this.onError,this),e.on(p.DESTROYING,this.onDestroying,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(p.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(p.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(p.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(p.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(p.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(p.BUFFER_CODECS,this.onBufferCodecs,this),e.off(p.BUFFER_APPENDED,this.onBufferAppended,this),e.off(p.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(p.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(p.MEDIA_ENDED,this.onMediaEnded,this),e.off(p.ERROR,this.onError,this),e.off(p.DESTROYING,this.onDestroying,this))},n.startLoad=function(){this.resumeBuffering()},n.stopLoad=function(){this.pauseBuffering()},n.resumeBuffering=function(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()},n.pauseBuffering=function(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()},n.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null},n.onDestroying=function(){var e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)},n.removeMediaListeners=function(e){fr(e,"play",this.onPlay),fr(e,"pause",this.onPause),fr(e,"seeking",this.onSeeking),fr(e,"timeupdate",this.onTimeupdate)},n.onMediaAttaching=function(e,t){var i=this.media=t.media;yr(i,"seeking",this.onSeeking),yr(i,"timeupdate",this.onTimeupdate),yr(i,"play",this.onPlay),yr(i,"pause",this.onPause)},n.onMediaAttached=function(e,t){var i=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!s){this.clearScheduleState();var l=this.findItemIndex(i);this.setSchedulePosition(l)}},n.clearScheduleState=function(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null},n.onMediaDetaching=function(e,t){var i=!!t.transferMedia,s=this.media;if(this.media=null,!i&&(s&&this.removeMediaListeners(s),this.detachedData)){var l=this.getBufferingPlayer();l&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}},n.isInterstitial=function(e){return!!(e!=null&&e.event)},n.retreiveMediaSource=function(e,t){var i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)},n.transferMediaFromPlayer=function(e,t){var i=e.interstitial.appendInPlace,s=e.media;if(i&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}var l=e.transferMedia();this.log("transfer MediaSource from "+e+" "+Ge(l)),this.detachedData=l}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))},n.transferMediaTo=function(e,t){var i,s=this,l;if(e.media!==t){var u=null,f=this.hls,d=e!==f,h=d&&e.interstitial.appendInPlace,c=(i=this.detachedData)==null?void 0:i.mediaSource,v;if(f.media)h&&(u=f.transferMedia(),this.detachedData=u),v="Primary";else if(c){var g=this.getBufferingPlayer();g?(u=g.transferMedia(),v=""+g):v="detached MediaSource"}else v="detached media";if(!u){if(c)u=this.detachedData,this.log("using detachedData: MediaSource "+Ge(u));else if(!this.detachedData||f.media===t){var m=this.playerQueue;m.length>1&&m.forEach(function(S){if(d&&S.interstitial.appendInPlace!==h){var x=S.interstitial;s.clearInterstitial(S.interstitial,null),x.appendInPlace=!1,x.appendInPlace&&s.warn("Could not change append strategy for queued assets "+x)}}),this.hls.detachMedia(),this.detachedData={media:t}}}var y=u&&"mediaSource"in u&&((l=u.mediaSource)==null?void 0:l.readyState)!=="closed",E=y&&u?u:t;if(this.log((y?"transfering MediaSource":"attaching media")+" to "+(d?e:"Primary")+" from "+v),E===u){var T=d&&e.assetId===this.schedule.assetIdAtEnd;E.overrides={duration:this.schedule.duration,endOfStream:!d||T,cueRemoval:!d}}e.attachMedia(E)}},n.onInterstitialCueEnter=function(){this.onTimeupdate()},n.checkStart=function(){var e=this.schedule,t=e.events;if(!(!t||this.playbackDisabled||!this.media)){this.bufferedPos===-1&&(this.bufferedPos=0);var i=this.timelinePos,s=this.effectivePlayingItem;if(i===-1){var l=this.hls.startPosition;if(this.timelinePos=l,t.length&&t[0].cue.pre){var u=e.findEventIndex(t[0].identifier);this.setSchedulePosition(u)}else if(l>=0||!this.primaryLive){var f=this.timelinePos=l>0?l:0,d=e.findItemIndexAtTime(f);this.setSchedulePosition(d)}}else if(s&&!this.playingItem){var h=e.findItemIndex(s);this.setSchedulePosition(h)}}},n.advanceAfterAssetEnded=function(e,t,i){var s=i+1;if(!e.isAssetPastPlayoutLimit(s)&&!e.assetList[s].error)this.setSchedulePosition(t,s);else{var l=this.schedule.items;if(l){var u=t+1,f=l.length;if(u>=f){this.setSchedulePosition(-1);return}var d=e.resumeTime;this.timelinePos<d&&(this.timelinePos=d,this.checkBuffer()),this.setSchedulePosition(u)}}},n.setScheduleToAssetAtTime=function(e,t){var i=this.schedule,s=t.parentIdentifier,l=i.getEvent(s);if(l){var u=i.findEventIndex(s),f=i.findAssetIndex(l,e);this.setSchedulePosition(u,f)}},n.setSchedulePosition=function(e,t){var i=this.schedule.items;if(!(!i||this.playbackDisabled)){this.log("setSchedulePosition "+e+", "+t);var s=e>=0?i[e]:null,l=this.playingItem,u=this.playingLastItem;if(this.isInterstitial(l)){var f,d=l.event,h=this.playingAsset,c=h==null?void 0:h.identifier,v=c?this.getAssetPlayer(c):null;if(v&&c&&(!this.eventItemsMatch(l,s)||t!==void 0&&c!==((f=d.assetList)==null?void 0:f[t].identifier))){var g,m=d.findAssetIndex(h);this.log("INTERSTITIAL_ASSET_ENDED "+(m+1)+"/"+d.assetList.length+" "+Xa(h)),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(p.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:m,event:d,schedule:i.slice(0),scheduleIndex:e,player:v}),this.retreiveMediaSource(c,s),v.media&&!((g=this.detachedData)!=null&&g.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(l,s)&&(this.endedItem=l,this.playingItem=null,this.log("INTERSTITIAL_ENDED "+d+" "+Rr(l)),d.hasPlayed=!0,this.hls.trigger(p.INTERSTITIAL_ENDED,{event:d,schedule:i.slice(0),scheduleIndex:e}),d.cue.once)){this.updateSchedule();var y=this.schedule.items;if(s&&y){var E=this.schedule.findItemIndex(s);this.advanceSchedule(E,y,t,l,u)}return}}this.advanceSchedule(e,i,t,l,u)}},n.advanceSchedule=function(e,t,i,s,l){var u=this,f=e>=0?t[e]:null,d=this.primaryMedia,h=this.playerQueue;if(h.length&&h.forEach(function(S){var x=S.interstitial,A=u.schedule.findEventIndex(x.identifier);(A<e||A>e+1)&&u.clearInterstitial(x,f)}),this.isInterstitial(f)){this.timelinePos=Math.min(Math.max(this.timelinePos,f.start),f.end);var c=f.event;i===void 0&&(i=this.schedule.findAssetIndex(c,this.timelinePos));var v=this.waitingItem;this.assetsBuffered(f,d)||this.setBufferingItem(f);var g=this.preloadAssets(c,i);if(this.eventItemsMatch(f,v||s)||(this.waitingItem=f,this.log("INTERSTITIAL_STARTED "+Rr(f)+" "+(c.appendInPlace?"append in place":"")),this.hls.trigger(p.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log("Waiting for ASSET-LIST to complete loading "+c);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!d){this.log("Waiting for attachMedia to start Interstitial "+c);return}this.waitingItem=this.endedItem=null,this.playingItem=f;var m=c.assetList[i];if(!m){var y=t[e+1],E=this.media;y&&E&&!this.isInterstitial(y)&&E.currentTime<y.start&&(E.currentTime=this.timelinePos=y.start),this.advanceAfterAssetEnded(c,e,i||0);return}if(g||(g=this.getAssetPlayer(m.identifier)),g===null||g.destroyed){var T=c.assetList.length;this.warn("asset "+(i+1)+"/"+T+" player destroyed "+c),g=this.createAssetPlayer(c,m,i)}if(!this.eventItemsMatch(f,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(m))return;this.startAssetPlayer(g,i,t,e,d),this.shouldPlay&&al(g.media)}else f!==null?(this.resumePrimary(f,e,s),this.shouldPlay&&al(this.hls.media)):l&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))},n.resumePrimary=function(e,t,i){var s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming "+Rr(e)),!((s=this.detachedData)!=null&&s.mediaSource)){var l=this.timelinePos;(l<e.start||l>=e.end)&&(l=this.getPrimaryResumption(e,t),this.timelinePos=l),this.attachPrimary(l,e)}if(i){var u=this.schedule.items;u&&(this.log("resumed "+Rr(e)),this.hls.trigger(p.INTERSTITIALS_PRIMARY_RESUMED,{schedule:u.slice(0),scheduleIndex:t}),this.checkBuffer())}},n.getPrimaryResumption=function(e,t){var i=e.start;if(this.primaryLive){var s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(i<s.fragmentStart||i>s.edge))return this.hls.liveSyncPosition||-1}return i},n.isAssetBuffered=function(e){var t=this.getAssetPlayer(e.identifier);if(t!=null&&t.hls)return t.hls.bufferedToEnd;var i=Ie.bufferInfo(this.primaryMedia,this.timelinePos,0);return i.end+1>=e.timelineStart+(e.duration||0)},n.attachPrimary=function(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;var s=this.primaryMedia;if(s){var l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,s),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}},n.startLoadingPrimaryAt=function(e,t){var i,s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((i=s.mainForwardBufferInfo)==null?void 0:i.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()},n.onManifestLoading=function(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(p.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(p.BUFFER_CODECS,this.onBufferCodecs,this)},n.onLevelUpdated=function(e,t){if(t.level!==-1){var i=this.hls.levels[t.level],s=ae(ae({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}},n.onAudioTrackUpdated=function(e,t){var i=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=ae(ae({},this.altSelection),{},{audio:i});return}var l=ae(ae({},s),{},{audio:i});this.mediaSelection=l},n.onSubtitleTrackUpdated=function(e,t){var i=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=ae(ae({},this.altSelection),{},{subtitles:i});return}var l=ae(ae({},s),{},{subtitles:i});this.mediaSelection=l},n.onAudioTrackSwitching=function(e,t){var i=bs(t);this.playerQueue.forEach(function(s){return s.hls.setAudioOption(t)||s.hls.setAudioOption(i)})},n.onSubtitleTrackSwitch=function(e,t){var i=bs(t);this.playerQueue.forEach(function(s){return s.hls.setSubtitleOption(t)||t.id!==-1&&s.hls.setSubtitleOption(i)})},n.onBufferCodecs=function(e,t){var i=t.tracks;i&&(this.requiredTracks=i)},n.onBufferAppended=function(e,t){this.checkBuffer()},n.onBufferFlushed=function(e,t){var i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){var s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}},n.onBufferedToEnd=function(e){var t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(var i=0;i<t.length;i++){var s=t[i];if(s.cue.post){var l,u=this.schedule.findEventIndex(s.identifier),f=(l=this.schedule.items)==null?void 0:l[u];this.isInterstitial(f)&&this.eventItemsMatch(f,this.bufferingItem)&&this.bufferedToItem(f,0);break}}this.bufferedPos=Number.MAX_VALUE}},n.onMediaEnded=function(e){var t=this.playingItem;if(!this.playingLastItem&&t){var i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1},n.updateItem=function(e,t){var i=this.schedule.items;if(e&&i){var s=this.findItemIndex(e,t);return i[s]||null}return null},n.itemsMatch=function(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))},n.eventItemsMatch=function(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))},n.findItemIndex=function(e,t){return e?this.schedule.findItemIndex(e,t):-1},n.updateSchedule=function(){var e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])},n.checkBuffer=function(e){var t=this.schedule.items;if(t){var i=Ie.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,t,e)}},n.updateBufferedPos=function(e,t,i){var s=this.schedule,l=this.bufferingItem;if(!(this.bufferedPos>e)){if(t.length===1&&this.itemsMatch(t[0],l)){this.bufferedPos=e;return}var u=this.playingItem,f=this.findItemIndex(u),d=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var h,c,v=this.findItemIndex(l),g=Math.min(v+1,t.length-1),m=t[g];if((d===-1&&l&&e>=l.end||(h=m.event)!=null&&h.appendInPlace&&e+.01>=m.start)&&(d=g),g-f>1&&(l==null||(c=l.event)==null?void 0:c.appendInPlace)===!1)return;if(this.bufferedPos=e,d>v&&d>f)this.bufferedToItem(m);else{var y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&m.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(m)&&this.preloadAssets(m.event,0)}}else i&&u&&!this.itemsMatch(u,l)&&(d===f?this.bufferedToItem(u):d===f+1&&this.bufferedToItem(t[d]))}},n.assetsBuffered=function(e,t){var i=this,s=e.event.assetList;return s.length===0?!1:!e.event.assetList.some(function(l){var u=i.getAssetPlayer(l.identifier);return!(u!=null&&u.bufferedInPlaceToEnd(t))})},n.setBufferingItem=function(e){var t=this,i=this.bufferingItem,s=this.schedule;if(this.itemsMatch(e,i))this.bufferingItem!==e&&(this.bufferingItem=e);else{var l=s.items,u=s.events;if(!l||!u)return i;var f=this.isInterstitial(e),d=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){var h=d?d.remaining:i?i.end-this.timelinePos:0;this.log("buffered to boundary "+Rr(e)+(i?" ("+h.toFixed(2)+" remaining)":"")),f?e.event.assetList.forEach(function(c){var v=t.getAssetPlayer(c.identifier);v&&v.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(function(c){return c.pauseBuffering()}))}this.hls.trigger(p.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:u.slice(0),schedule:l.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return i},n.bufferedToItem=function(e,t){t===void 0&&(t=0);var i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;var s=this.detachedData;if(s)if(s.mediaSource){var l=!0;this.attachPrimary(e.start,e,l)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}},n.preloadPrimary=function(e){var t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)},n.bufferedToEvent=function(e,t){var i=e.event,s=i.assetList.length===0&&!i.assetListLoader,l=i.cue.once;if(s||!l){var u=this.preloadAssets(i,t);if(u!=null&&u.interstitial.appendInPlace){var f=i.assetList[t],d=this.primaryMedia;f&&d&&this.bufferAssetPlayer(u,d)}}},n.preloadAssets=function(e,t){var i=e.assetUrl,s=e.assetList.length,l=s===0&&!e.assetListLoader,u=e.cue.once;if(l){var f=e.timelineStart;if(e.appendInPlace){var d,h=this.playingItem;!this.isInterstitial(h)&&(h==null||(d=h.nextEvent)==null?void 0:d.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}var c,v=0;if(!this.playingItem&&this.primaryLive&&(v=this.hls.startPosition,v===-1&&(v=this.hls.liveSyncPosition||0)),v&&!(e.cue.pre||e.cue.post)){var g=v-f;g>0&&(c=Math.round(g*1e3)/1e3)}if(this.log("Load interstitial asset "+(t+1)+"/"+(i?1:s)+" "+e+(c?" live-start: "+v+" start-offset: "+c:"")),i)return this.createAsset(e,0,0,f,e.duration,i);var m=this.assetListLoader.loadAssetList(e,c);m&&(e.assetListLoader=m)}else if(!u&&s){for(var y=t;y<s;y++){var E=e.assetList[y],T=this.getAssetPlayerQueueIndex(E.identifier);(T===-1||this.playerQueue[T].destroyed)&&!E.error&&this.createAssetPlayer(e,E,y)}return this.getAssetPlayer(e.assetList[t].identifier)}return null},n.flushFrontBuffer=function(e){var t=this,i=this.requiredTracks;if(i){this.log("Removing front buffer starting at "+e);var s=Object.keys(i);s.forEach(function(l){t.hls.trigger(p.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:l})})}},n.getAssetPlayerQueueIndex=function(e){for(var t=this.playerQueue,i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1},n.getAssetPlayer=function(e){var t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null},n.getBufferingPlayer=function(){var e=this.playerQueue,t=this.primaryMedia;if(t){for(var i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null},n.createAsset=function(e,t,i,s,l,u){var f={parentIdentifier:e.identifier,identifier:Gd(e,u,t),duration:l,startOffset:i,timelineStart:s,uri:u};return this.createAssetPlayer(e,f,t)},n.createAssetPlayer=function(e,t,i){var s=this;this.log("create HLSAssetPlayer for "+Xa(t));var l=this.hls,u=l.userConfig,f=u.videoPreference,d=l.loadLevelObj||l.levels[l.currentLevel];(f||d)&&(f=ne({},f),d.videoCodec&&(f.videoCodec=d.videoCodec),d.videoRange&&(f.allowedVideoRanges=[d.videoRange]));var h=l.audioTracks[l.audioTrack],c=l.subtitleTracks[l.subtitleTrack],v=0;if(this.primaryLive||e.appendInPlace){var g=this.timelinePos-t.timelineStart;if(g>1){var m=t.duration;m&&g<m&&(v=g)}}var y=t.identifier,E=ae(ae({},u),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:l.sessionId,assetPlayerId:y,abrEwmaDefaultEstimate:l.bandwidthEstimate,interstitialsController:void 0,startPosition:v,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:f,audioPreference:h||u.audioPreference,subtitlePreference:c||u.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(E.timelineOffset=t.timelineStart));var T=E.cmcd;T!=null&&T.sessionId&&T.contentId&&(E.cmcd=ne({},T,{contentId:Bi(t.uri)})),this.getAssetPlayer(y)&&this.warn("Duplicate date range identifier "+e+" and asset "+y);var S=new Vd(this.HlsPlayerClass,E,e,t);this.playerQueue.push(S),e.assetList[i]=t;var x=function(R){if(R.live){var b=new Error("Interstitials MUST be VOD assets "+e),D={fatal:!0,type:B.OTHER_ERROR,details:I.INTERSTITIAL_ASSET_ITEM_ERROR,error:b};s.handleAssetItemError(D,e,s.schedule.findEventIndex(e.identifier),i,b.message);return}var C=R.edge-R.fragmentStart,N=t.duration;(N===null||C>N)&&(s.log('Interstitial asset "'+y+'" duration change '+N+" > "+C),t.duration=C,s.updateSchedule())};S.on(p.LEVEL_UPDATED,function(k,R){var b=R.details;return x(b)}),S.on(p.LEVEL_PTS_UPDATED,function(k,R){var b=R.details;return x(b)});var A=function(R,b){var D=s.getAssetPlayer(y);if(D&&b.tracks){D.off(p.BUFFER_CODECS,A),D.tracks=b.tracks;var C=s.primaryMedia;s.bufferingAsset===D.assetItem&&C&&!D.media&&s.bufferAssetPlayer(D,C)}};S.on(p.BUFFER_CODECS,A);var L=function(){var R,b=s.getAssetPlayer(y);if(s.log("buffered to end of asset "+b),!!b){var D=s.schedule.findEventIndex(e.identifier),C=e.findAssetIndex(t),N=C+1,O=(R=s.schedule.items)==null?void 0:R[D];if(s.isInterstitial(O))if(C!==-1&&!e.isAssetPastPlayoutLimit(N)&&!e.assetList[N].error)s.bufferedToItem(O,N);else{var M,G=(M=s.schedule.items)==null?void 0:M[D+1];G&&s.bufferedToItem(G)}}};S.on(p.BUFFERED_TO_END,L);var _=function(R){return function(){var b=s.getAssetPlayer(y);if(b){s.shouldPlay=!0;var D=s.schedule.findEventIndex(e.identifier);s.advanceAfterAssetEnded(e,D,R)}}};return S.once(p.MEDIA_ENDED,_(i)),S.once(p.PLAYOUT_LIMIT_REACHED,_(1/0)),S.on(p.ERROR,function(k,R){var b=s.getAssetPlayer(y);if(R.details===I.BUFFER_STALLED_ERROR){if(b!=null&&b.media){var D=b.currentTime,C=b.duration-D;D&&e.appendInPlace&&C/b.media.playbackRate<.5?(s.log("Advancing buffer past end of asset "+y+" "+e+" at "+b.media.currentTime),L()):(s.warn("Stalled at "+D+" of "+(D+C)+" in asset "+y+" "+e),s.onTimeupdate(),s.checkBuffer(!0))}return}s.handleAssetItemError(R,e,s.schedule.findEventIndex(e.identifier),i,"Asset player error "+R.error+" "+e)}),S.on(p.DESTROYING,function(){var k=s.getAssetPlayer(y);if(k){var R=new Error("Asset player destroyed unexpectedly "+y),b={fatal:!0,type:B.OTHER_ERROR,details:I.INTERSTITIAL_ASSET_ITEM_ERROR,error:R};s.handleAssetItemError(b,e,s.schedule.findEventIndex(e.identifier),i,R.message)}}),this.hls.trigger(p.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:S}),S},n.clearInterstitial=function(e,t){var i=this;e.assetList.forEach(function(s){i.clearAssetPlayer(s.identifier,t)}),e.reset()},n.clearAssetPlayer=function(e,t){var i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log('clearAssetPlayer "'+e+'" toSegment: '+(t&&Rr(t)));var s=this.playerQueue[i];this.transferMediaFromPlayer(s,t),this.playerQueue.splice(i,1),s.destroy()}},n.emptyPlayerQueue=function(){for(var e;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]},n.startAssetPlayer=function(e,t,i,s,l){var u=e.interstitial,f=e.assetItem,d=e.assetId,h=u.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=f,(!c||c.identifier!==d)&&(c&&(this.clearAssetPlayer(c.identifier,i[s]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED "+(t+1)+"/"+h+" "+e),this.hls.trigger(p.INTERSTITIAL_ASSET_STARTED,{asset:f,assetListIndex:t,event:u,schedule:i.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,l)},n.bufferAssetPlayer=function(e,t){var i,s,l=e.interstitial,u=e.assetItem,f=e.assetId,d=this.schedule.findEventIndex(l.identifier),h=(i=this.schedule.items)==null?void 0:i[d];if(h){this.setBufferingItem(h),this.bufferingAsset=u;var c=this.getBufferingPlayer();if(c!==e){var v=l.appendInPlace;if(!(v&&(c==null?void 0:c.interstitial.appendInPlace)===!1)){var g=(c==null?void 0:c.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(v&&u!==this.playingAsset){if(!e.tracks)return;if(g&&!Te(g,e.tracks)){var m=new Error('Asset "'+f+`" SourceBuffer tracks ('`+Object.keys(e.tracks)+"') are not compatible with primary content tracks ('"+Object.keys(g)+"')"),y={fatal:!0,type:B.OTHER_ERROR,details:I.INTERSTITIAL_ASSET_ITEM_ERROR,error:m},E=l.findAssetIndex(u);this.handleAssetItemError(y,l,d,E,m.message);return}}this.transferMediaTo(e,t)}}}},n.handleAssetItemError=function(e,t,i,s,l){if(e.details!==I.BUFFER_STALLED_ERROR){var u=t.assetList[s]||null,f=null;if(u){var d=this.getAssetPlayerQueueIndex(u.identifier);f=this.playerQueue[d]||null}var h=this.schedule.items,c=ne({},e,{fatal:!1,errorAction:ki(!0),asset:u,assetListIndex:s,event:t,schedule:h,scheduleIndex:i,player:f});if(this.warn("Asset item error: "+e.error),this.hls.trigger(p.INTERSTITIAL_ASSET_ERROR,c),!!e.fatal){var v=new Error(l);u&&(this.playingAsset!==u&&this.clearAssetPlayer(u.identifier,null),u.error=v),t.assetList.some(function(g){return!g.error})?t.appendInPlace&&(t.error=v):t.error=v,this.primaryFallback(t)}}},n.primaryFallback=function(e){var t=e.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log('Fallback to primary from event "'+e.identifier+'" start: '+t+" pos: "+this.timelinePos+" playing: "+(i?Rr(i):"<none>")+" error: "+e.error),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));var s=this.timelinePos;s===-1&&(s=this.hls.startPosition);var l=this.updateItem(i,s);if(this.itemsMatch(i,l))this.clearInterstitial(e,null);else{var u=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(u)}}else this.checkStart()},n.onAssetListLoaded=function(e,t){var i=this,s,l=t.event,u=l.identifier,f=t.assetListResponse.ASSETS;if(this.schedule.hasEvent(u)){var d=l.timelineStart,h=l.duration,c=0;f.forEach(function(_,k){var R=parseFloat(_.DURATION);i.createAsset(l,k,c,d+c,R,_.URI),c+=R}),l.duration=c,this.log("Loaded asset-list with duration: "+c+" (was: "+h+") "+l);var v=this.waitingItem,g=(v==null?void 0:v.event.identifier)===u;this.updateSchedule();var m=(s=this.bufferingItem)==null?void 0:s.event;if(g){var y,E=this.schedule.findEventIndex(u),T=(y=this.schedule.items)==null?void 0:y[E];if(T){if(!this.playingItem&&this.timelinePos>T.end){var S=this.schedule.findItemIndexAtTime(this.timelinePos);if(S!==E){l.error=new Error("Interstitial no longer within playback range "+this.timelinePos+" "+l),this.primaryFallback(l);return}}this.setBufferingItem(T)}this.setSchedulePosition(E)}else if((m==null?void 0:m.identifier)===u&&m.appendInPlace){var x=l.assetList[0],A=this.getAssetPlayer(x.identifier),L=this.primaryMedia;x&&A&&L&&this.bufferAssetPlayer(A,L)}}},n.onError=function(e,t){switch(t.details){case I.ASSET_LIST_PARSING_ERROR:case I.ASSET_LIST_LOAD_ERROR:case I.ASSET_LIST_LOAD_TIMEOUT:{var i=t.interstitial;i&&this.primaryFallback(i);break}case I.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}},oe(o,[{key:"interstitialsManager",get:function(){if(!this.manager){if(!this.hls)return null;var e=this,t=function(){return e.bufferingItem||e.waitingItem},i=function(g){return g&&e.getAssetPlayer(g.identifier)},s=function(g,m,y,E,T){if(g){var S=g[m].start,x=g.event;if(x){if(m==="playout"||x.timelineOccupancy!==Rn.Point){var A=i(y);(A==null?void 0:A.interstitial)===x&&(S+=A.assetItem.startOffset+A[T])}}else{var L=E==="bufferedPos"?u():e[E];S+=L-g.start}return S}return 0},l=function(g,m){if(g!==0&&m!=="primary"&&e.schedule.length){var y,E=e.schedule.findItemIndexAtTime(g),T=(y=e.schedule.items)==null?void 0:y[E];if(T){var S=T[m].start-T.start;return g+S}}return g},u=function(){var g=e.bufferedPos;return g===Number.MAX_VALUE?f("primary"):Math.max(g,0)},f=function(g){var m;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:e.schedule.durations[g]},d=function(g,m){var y,E,T=e.effectivePlayingItem;if(!(T!=null&&(y=T.event)!=null&&y.restrictions.skip)){e.log("seek to "+g+' "'+m+'"');var S=e.effectivePlayingItem,x=e.schedule.findItemIndexAtTime(g,m),A=(E=e.schedule.items)==null?void 0:E[x],L=e.getBufferingPlayer(),_=L==null?void 0:L.interstitial,k=_==null?void 0:_.appendInPlace,R=S&&e.itemsMatch(S,A);if(S&&(k||R)){var b=i(e.playingAsset),D=(b==null?void 0:b.media)||e.primaryMedia;if(D){var C=m==="primary"?D.currentTime:s(S,m,e.playingAsset,"timelinePos","currentTime"),N=g-C,O=(k?C:D.currentTime)+N;if(O>=0&&(!b||k||O<=b.duration)){D.currentTime=O;return}}}if(A){var M=g;if(m!=="primary"){var G=A[m].start,Y=g-G;M=A.start+Y}var W=!e.isInterstitial(A);if((!e.isInterstitial(S)||S.event.appendInPlace)&&(W||A.event.appendInPlace)){var ie=e.media||(k?L==null?void 0:L.media:null);ie&&(ie.currentTime=M)}else if(S){var xe=e.findItemIndex(S);if(x>xe){var ue=e.schedule.findJumpRestrictedIndex(xe+1,x);if(ue>xe){e.setSchedulePosition(ue);return}}var _e=0;if(W)e.timelinePos=M,e.checkBuffer();else{var ge,ke=A==null||(ge=A.event)==null?void 0:ge.assetList;if(ke)for(var Ce=g-(A[m]||A).start,Be=ke.length;Be--;){var tt=ke[Be];if(tt.duration&&Ce>=tt.startOffset&&Ce<tt.startOffset+tt.duration){_e=Be;break}}}e.setSchedulePosition(x,_e)}}}},h=function(){var g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;var m=t();return e.isInterstitial(m)?m:null},c={get currentTime(){var v=h(),g=e.effectivePlayingItem;return g&&g===v?s(g,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-g.playout.start:0},set currentTime(v){var g=h(),m=e.effectivePlayingItem;m&&m===g&&d(v+m.playout.start,"playout")},get duration(){var v=h();return v?v.playout.end-v.playout.start:0},get assetPlayers(){var v,g=(v=h())==null?void 0:v.event.assetList;return g?g.map(function(m){return e.getAssetPlayer(m.identifier)}):[]},get playingIndex(){var v,g=(v=h())==null?void 0:v.event;return g&&e.effectivePlayingAsset?g.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return h()}};this.manager={get events(){var v,g;return((v=e.schedule)==null||(g=v.events)==null?void 0:g.slice(0))||[]},get schedule(){var v,g;return((v=e.schedule)==null||(g=v.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return h()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){var v=t();return e.findItemIndex(v)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){var v=e.effectivePlayingItem;return e.findItemIndex(v)},primary:{get bufferedEnd(){return u()},get currentTime(){var v=e.timelinePos;return v>0?v:0},set currentTime(v){d(v,"primary")},get duration(){return f("primary")},get seekableStart(){var v;return((v=e.primaryDetails)==null?void 0:v.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(v){d(v,"integrated")},get duration(){return f("integrated")},get seekableStart(){var v;return l(((v=e.primaryDetails)==null?void 0:v.fragmentStart)||0,"integrated")}},skip:function(){var g=e.effectivePlayingItem,m=g==null?void 0:g.event;if(m&&!m.restrictions.skip){var y=e.findItemIndex(g);if(m.appendInPlace){var E=g.playout.start+g.event.duration;d(E+.001,"playout")}else e.advanceAfterAssetEnded(m,y,1/0)}}}}return this.manager}},{key:"effectivePlayingItem",get:function(){return this.waitingItem||this.playingItem||this.endedItem}},{key:"effectivePlayingAsset",get:function(){return this.playingAsset||this.endedAsset}},{key:"playingLastItem",get:function(){var e,t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}},{key:"playbackStarted",get:function(){return this.effectivePlayingItem!==null}},{key:"currentTime",get:function(){var e,t,i;if(this.mediaSelection!==null){var s=this.waitingItem||this.playingItem;if(!(this.isInterstitial(s)&&!s.event.appendInPlace)){var l=this.media;!l&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(l=this.primaryMedia);var u=(i=l)==null?void 0:i.currentTime;if(!(u===void 0||!U(u)))return u}}}},{key:"primaryMedia",get:function(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}},{key:"playbackDisabled",get:function(){return this.hls.config.enableInterstitialPlayback===!1}},{key:"primaryDetails",get:function(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}},{key:"primaryLive",get:function(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}}])}(he),sl=500,jd=function(a){function o(r,e,t){var i;return i=a.call(this,r,e,t,"subtitle-stream-controller",K.SUBTITLE)||this,i.currentTrackId=-1,i.tracksBuffered=[],i.mainDetails=null,i.registerListeners(),i}j(o,a);var n=o.prototype;return n.onHandlerDestroying=function(){this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this),this.mainDetails=null},n.registerListeners=function(){a.prototype.registerListeners.call(this);var e=this.hls;e.on(p.LEVEL_LOADED,this.onLevelLoaded,this),e.on(p.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(p.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(p.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(p.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this)},n.unregisterListeners=function(){a.prototype.unregisterListeners.call(this);var e=this.hls;e.off(p.LEVEL_LOADED,this.onLevelLoaded,this),e.off(p.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(p.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(p.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(p.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this)},n.startLoad=function(e,t){this.stopLoad(),this.state=w.IDLE,this.setInterval(sl),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()},n.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.mainDetails=null},n.onMediaDetaching=function(e,t){this.tracksBuffered=[],a.prototype.onMediaDetaching.call(this,e,t)},n.onLevelLoaded=function(e,t){this.mainDetails=t.details},n.onSubtitleFragProcessed=function(e,t){var i=t.frag,s=t.success;if(Se(i)&&(this.fragPrevious=i),this.state=w.IDLE,!!s){var l=this.tracksBuffered[this.currentTrackId];if(l){for(var u,f=i.start,d=0;d<l.length;d++)if(f>=l[d].start&&f<=l[d].end){u=l[d];break}var h=i.start+i.duration;u?u.end=h:(u={start:f,end:h},l.push(u)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}}},n.onBufferFlushing=function(e,t){var i=t.startOffset,s=t.endOffset;if(i===0&&s!==Number.POSITIVE_INFINITY){var l=s-1;if(l<=0)return;t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(function(u){for(var f=0;f<u.length;){if(u[f].end<=l){u.shift();continue}else if(u[f].start<l)u[f].start=l;else break;f++}}),this.fragmentTracker.removeFragmentsInRange(i,l,K.SUBTITLE)}},n.onError=function(e,t){var i=t.frag;(i==null?void 0:i.type)===K.SUBTITLE&&(t.details===I.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==w.STOPPED&&(this.state=w.IDLE))},n.onSubtitleTracksUpdated=function(e,t){var i=this,s=t.subtitleTracks;if(this.levels&&Vo(this.levels,s)){this.levels=s.map(function(l){return new Ar(l)});return}this.tracksBuffered=[],this.levels=s.map(function(l){var u=new Ar(l);return i.tracksBuffered[u.id]=[],u}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,K.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null},n.onSubtitleTrackSwitch=function(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}var s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==w.STOPPED&&this.setInterval(sl)},n.onSubtitleTrackLoaded=function(e,t){var i,s=this.currentTrackId,l=this.levels,u=t.details,f=t.id;if(!l){this.warn("Subtitle tracks were reset while loading level "+f);return}var d=l[f];if(!(f>=l.length||!d)){this.log("Subtitle track "+f+" loaded ["+u.startSN+","+u.endSN+"]"+(u.lastPartSn?"[part-"+u.lastPartSn+"-"+u.lastPartIndex+"]":"")+",duration:"+u.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges;var h=0;if(u.live||(i=d.details)!=null&&i.live){var c=this.mainDetails;if(u.deltaUpdateFailed||!c)return;var v=c.fragments[0];if(!d.details)u.hasProgramDateTime&&c.hasProgramDateTime?(pn(u,c),h=u.fragmentStart):v&&(h=v.start,Aa(u,h));else{var g;h=this.alignPlaylists(u,d.details,(g=this.levelLastLoaded)==null?void 0:g.details),h===0&&v&&(h=v.start,Aa(u,h))}}if(d.details=u,this.levelLastLoaded=d,f===s&&(this.hls.trigger(p.SUBTITLE_TRACK_UPDATED,{details:u,id:f,groupId:t.groupId}),this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===w.IDLE)){var m=Kr(null,u.fragments,this.media.currentTime,0);m||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)}}},n._handleFragmentLoadComplete=function(e){var t=this,i=e.frag,s=e.payload,l=i.decryptdata,u=this.hls;if(!this.fragContextChanged(i)&&s&&s.byteLength>0&&l!=null&&l.key&&l.iv&&ti(l.method)){var f=performance.now();this.decrypter.decrypt(new Uint8Array(s),l.key.buffer,l.iv.buffer,ca(l.method)).catch(function(d){throw u.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:i}),d}).then(function(d){var h=performance.now();u.trigger(p.FRAG_DECRYPTED,{frag:i,payload:d,stats:{tstart:f,tdecrypt:h}})}).catch(function(d){t.warn(d.name+": "+d.message),t.state=w.IDLE})}},n.doTick=function(){if(!this.media){this.state=w.IDLE;return}if(this.state===w.IDLE){var e=this.currentTrackId,t=this.levels,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;var s=this.config,l=this.getLoadPosition(),u=Ie.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,s.maxBufferHole),f=u.end,d=u.len,h=i.details,c=this.hls.maxBufferLength+h.levelTargetDuration;if(d>c)return;var v=h.fragments,g=v.length,m=h.edge,y=null,E=this.fragPrevious;if(f<m){var T=s.maxFragLookUpTolerance,S=f>m-T?0:T;y=Kr(E,v,Math.max(v[0].start,f),S),!y&&E&&E.start<v[0].start&&(y=v[0])}else y=v[g-1];if(y=this.filterReplacedPrimary(y,i.details),!y)return;var x=y.sn-h.startSN,A=v[x-1];if(A&&A.cc===y.cc&&this.fragmentTracker.getState(A)===ut.NOT_LOADED&&(y=A),this.fragmentTracker.getState(y)===ut.NOT_LOADED){var L=this.mapToInitFragWhenRequired(y);L&&this.loadFragment(L,i,f)}}},n.loadFragment=function(e,t,i){Se(e)?a.prototype.loadFragment.call(this,e,t,i):this._loadInitSegment(e,t)},oe(o,[{key:"mediaBufferTimeRanges",get:function(){return new Xd(this.tracksBuffered[this.currentTrackId]||[])}}])}(La),Xd=function(o){this.buffered=void 0;var n=function(e,t,i){if(t=t>>>0,t>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+i+")");return o[t][e]};this.buffered={get length(){return o.length},end:function(e){return n("end",e,o.length)},start:function(e){return n("start",e,o.length)}}};function ol(a,o){var n;try{n=new Event("addtrack")}catch{n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=a,o.dispatchEvent(n)}function ll(a,o){var n=a.mode;if(n==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(o.id))try{if(a.addCue(o),!a.cues.getCueById(o.id))throw new Error("addCue is failed for: "+o)}catch(e){le.debug("[texttrack-utils]: "+e);try{var r=new self.TextTrackCue(o.startTime,o.endTime,o.text);r.id=o.id,a.addCue(r)}catch(t){le.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+t)}}n==="disabled"&&(a.mode=n)}function li(a,o){var n=a.mode;if(n==="disabled"&&(a.mode="hidden"),a.cues)for(var r=a.cues.length;r--;)o&&a.cues[r].removeEventListener("enter",o),a.removeCue(a.cues[r]);n==="disabled"&&(a.mode=n)}function za(a,o,n,r){var e=a.mode;if(e==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0)for(var t=Qd(a.cues,o,n),i=0;i<t.length;i++)(!r||r(t[i]))&&a.removeCue(t[i]);e==="disabled"&&(a.mode=e)}function zd(a,o){if(o<=a[0].startTime)return 0;var n=a.length-1;if(o>a[n].endTime)return-1;for(var r=0,e=n,t;r<=e;)if(t=Math.floor((e+r)/2),o<a[t].startTime)e=t-1;else if(o>a[t].startTime&&r<n)r=t+1;else return t;return a[r].startTime-o<o-a[e].startTime?r:e}function Qd(a,o,n){var r=[],e=zd(a,o);if(e>-1)for(var t=e,i=a.length;t<i;t++){var s=a[t];if(s.startTime>=o&&s.endTime<=n)r.push(s);else if(s.startTime>n)return r}return r}function In(a){for(var o=[],n=0;n<a.length;n++){var r=a[n];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&o.push(a[n])}return o}var $d=function(a){function o(r){var e;return e=a.call(this,r,"subtitle-track-controller")||this,e.media=null,e.tracks=[],e.groupIds=null,e.tracksInGroup=[],e.trackId=-1,e.currentTrack=null,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.onTextTracksChanged=function(){if(e.useTextTrackPolling||self.clearInterval(e.subtitlePollingInterval),!(!e.media||!e.hls.config.renderTextTracksNatively)){for(var t=null,i=In(e.media.textTracks),s=0;s<i.length;s++)if(i[s].mode==="hidden")t=i[s];else if(i[s].mode==="showing"){t=i[s];break}var l=e.findTrackForTextTrack(t);e.subtitleTrack!==l&&e.setSubtitleTrack(l)}},e.registerListeners(),e}j(o,a);var n=o.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,a.prototype.destroy.call(this)},n.registerListeners=function(){var e=this.hls;e.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.MANIFEST_PARSED,this.onManifestParsed,this),e.on(p.LEVEL_LOADING,this.onLevelLoading,this),e.on(p.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(p.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(p.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.MANIFEST_PARSED,this.onManifestParsed,this),e.off(p.LEVEL_LOADING,this.onLevelLoading,this),e.off(p.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(p.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(p.ERROR,this.onError,this)},n.onMediaAttached=function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)},n.onMediaDetaching=function(e,t){var i=this.media;if(i){var s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,!s){var l=In(i.textTracks);l.forEach(function(u){li(u)})}}},n.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},n.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},n.onSubtitleTrackLoaded=function(e,t){var i=t.id,s=t.groupId,l=t.details,u=this.tracksInGroup[i];if(!u||u.groupId!==s){this.warn("Subtitle track with id:"+i+" and group:"+s+" not found in active group "+(u==null?void 0:u.groupId));return}var f=u.details;u.details=t.details,this.log("Subtitle track "+i+' "'+u.name+'" lang:'+u.lang+" group:"+s+" loaded ["+l.startSN+"-"+l.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,t,f)},n.onLevelLoading=function(e,t){this.switchLevel(t.level)},n.onLevelSwitching=function(e,t){this.switchLevel(t.level)},n.switchLevel=function(e){var t=this.hls.levels[e];if(t){var i=t.subtitleGroups||null,s=this.groupIds,l=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(function(g){return(s==null?void 0:s.indexOf(g))===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var u=this.tracks.filter(function(g){return!i||i.indexOf(g.groupId)!==-1});if(u.length)this.selectDefaultTrack&&!u.some(function(g){return g.default})&&(this.selectDefaultTrack=!1),u.forEach(function(g,m){g.id=m});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=u;var f=this.hls.config.subtitlePreference;if(!l&&f){this.selectDefaultTrack=!1;var d=or(f,u);if(d>-1)l=u[d];else{var h=or(f,this.tracks);l=this.tracks[h]}}var c=this.findTrackId(l);c===-1&&l&&(c=this.findTrackId(null));var v={subtitleTracks:u};this.log("Updating subtitle tracks, "+u.length+' track(s) found in "'+(i==null?void 0:i.join(","))+'" group-id'),this.hls.trigger(p.SUBTITLE_TRACKS_UPDATED,v),c!==-1&&this.trackId===-1&&this.setSubtitleTrack(c)}}},n.findTrackId=function(e){for(var t=this.tracksInGroup,i=this.selectDefaultTrack,s=0;s<t.length;s++){var l=t[s];if(!(i&&!l.default||!i&&!e)&&(!e||Br(l,e)))return s}if(e){for(var u=0;u<t.length;u++){var f=t[u];if(Ni(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(var d=0;d<t.length;d++){var h=t[d];if(Ni(e.attrs,h.attrs,["LANGUAGE"]))return d}}return-1},n.findTrackForTextTrack=function(e){if(e)for(var t=this.tracksInGroup,i=0;i<t.length;i++){var s=t[i];if(Ka(s,e))return i}return-1},n.onError=function(e,t){t.fatal||!t.context||t.context.type===re.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)},n.setSubtitleOption=function(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;var t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){var i=this.currentTrack;if(i&&Br(e,i))return i;var s=or(e,this.tracksInGroup);if(s>-1){var l=this.tracksInGroup[s];return this.setSubtitleTrack(s),l}else{if(i)return null;var u=or(e,t);if(u>-1)return t[u]}}}return null},n.loadPlaylist=function(e){a.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)},n.loadingPlaylist=function(e,t){a.prototype.loadingPlaylist.call(this,e,t);var i=e.id,s=e.groupId,l=this.getUrlWithDirectives(e.url,t),u=e.details,f=u==null?void 0:u.age;this.log("Loading subtitle "+i+' "'+e.name+'" lang:'+e.lang+" group:"+s+((t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+l),this.hls.trigger(p.SUBTITLE_TRACK_LOADING,{url:l,id:i,groupId:s,deliveryDirectives:t||null,track:e})},n.toggleTrackModes=function(){var e=this.media;if(e){var t=In(e.textTracks),i=this.currentTrack,s;if(i&&(s=t.filter(function(u){return Ka(i,u)})[0],s||this.warn('Unable to find subtitle TextTrack with name "'+i.name+'" and language "'+i.lang+'"')),[].slice.call(t).forEach(function(u){u.mode!=="disabled"&&u!==s&&(u.mode="disabled")}),s){var l=this.subtitleDisplay?"showing":"hidden";s.mode!==l&&(s.mode=l)}}},n.setSubtitleTrack=function(e){var t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!U(e)){this.warn("Invalid subtitle track id: "+e);return}this.selectDefaultTrack=!1;var i=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(p.SUBTITLE_TRACK_SWITCH,{id:e});return}var l=!!s.details&&!s.details.live;if(!(e===this.trackId&&s===i&&l)){this.log("Switching to subtitle-track "+e+(s?' "'+s.name+'" lang:'+s.lang+" group:"+s.groupId:""));var u=s.id,f=s.groupId,d=f===void 0?"":f,h=s.name,c=s.type,v=s.url;this.hls.trigger(p.SUBTITLE_TRACK_SWITCH,{id:u,groupId:d,name:h,type:c,url:v});var g=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(g)}},oe(o,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}}])}(Ga),Jd={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ul=function(o){return String.fromCharCode(Jd[o]||o)},rr=15,Er=100,Zd={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},eh={17:2,18:4,21:6,22:8,23:10,19:13,20:15},th={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rh={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ih=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],nh=function(){function a(){this.time=null,this.verboseLevel=0}var o=a.prototype;return o.log=function(r,e){if(this.verboseLevel>=r){var t=typeof e=="function"?e():e;le.log(this.time+" ["+r+"] "+t)}},a}(),Vr=function(o){for(var n=[],r=0;r<o.length;r++)n.push(o[r].toString(16));return n},fl=function(){function a(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var o=a.prototype;return o.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},o.setStyles=function(r){for(var e=["foreground","underline","italics","background","flash"],t=0;t<e.length;t++){var i=e[t];r.hasOwnProperty(i)&&(this[i]=r[i])}},o.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},o.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},o.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},o.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),ah=function(){function a(){this.uchar=" ",this.penState=new fl}var o=a.prototype;return o.reset=function(){this.uchar=" ",this.penState.reset()},o.setChar=function(r,e){this.uchar=r,this.penState.copy(e)},o.setPenState=function(r){this.penState.copy(r)},o.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},o.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},o.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},a}(),sh=function(){function a(n){this.chars=[],this.pos=0,this.currPenState=new fl,this.cueStartTime=null,this.logger=void 0;for(var r=0;r<Er;r++)this.chars.push(new ah);this.logger=n}var o=a.prototype;return o.equals=function(r){for(var e=0;e<Er;e++)if(!this.chars[e].equals(r.chars[e]))return!1;return!0},o.copy=function(r){for(var e=0;e<Er;e++)this.chars[e].copy(r.chars[e])},o.isEmpty=function(){for(var r=!0,e=0;e<Er;e++)if(!this.chars[e].isEmpty()){r=!1;break}return r},o.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Er&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Er)},o.moveCursor=function(r){var e=this.pos+r;if(r>1)for(var t=this.pos+1;t<e+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(e)},o.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},o.insertChar=function(r){var e=this;r>=144&&this.backSpace();var t=ul(r);if(this.pos>=Er){this.logger.log(0,function(){return"Cannot insert "+r.toString(16)+" ("+t+") at position "+e.pos+". Skipping it!"});return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)},o.clearFromPos=function(r){var e;for(e=r;e<Er;e++)this.chars[e].reset()},o.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},o.clearToEndOfRow=function(){this.clearFromPos(this.pos)},o.getTextString=function(){for(var r=[],e=!0,t=0;t<Er;t++){var i=this.chars[t].uchar;i!==" "&&(e=!1),r.push(i)}return e?"":r.join("")},o.setPenStyles=function(r){this.currPenState.setStyles(r);var e=this.chars[this.pos];e.setPenState(this.currPenState)},a}(),Qa=function(){function a(n){this.rows=[],this.currRow=rr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var r=0;r<rr;r++)this.rows.push(new sh(n));this.logger=n}var o=a.prototype;return o.reset=function(){for(var r=0;r<rr;r++)this.rows[r].clear();this.currRow=rr-1},o.equals=function(r){for(var e=!0,t=0;t<rr;t++)if(!this.rows[t].equals(r.rows[t])){e=!1;break}return e},o.copy=function(r){for(var e=0;e<rr;e++)this.rows[e].copy(r.rows[e])},o.isEmpty=function(){for(var r=!0,e=0;e<rr;e++)if(!this.rows[e].isEmpty()){r=!1;break}return r},o.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},o.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},o.insertChar=function(r){var e=this.rows[this.currRow];e.insertChar(r)},o.setPen=function(r){var e=this.rows[this.currRow];e.setPenStyles(r)},o.moveCursor=function(r){var e=this.rows[this.currRow];e.moveCursor(r)},o.setCursor=function(r){this.logger.log(2,"setCursor: "+r);var e=this.rows[this.currRow];e.setCursor(r)},o.setPAC=function(r){this.logger.log(2,function(){return"pacData = "+Ge(r)});var e=r.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var t=0;t<rr;t++)this.rows[t].clear();var i=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var l=s.rows[i].cueStartTime,u=this.logger.time;if(l!==null&&u!==null&&l<u)for(var f=0;f<this.nrRollUpRows;f++)this.rows[e-this.nrRollUpRows+f+1].copy(s.rows[i+f])}}this.currRow=e;var d=this.rows[this.currRow];if(r.indent!==null){var h=r.indent,c=Math.max(h-1,0);d.setCursor(r.indent),r.color=d.chars[c].penState.foreground}var v={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(v)},o.setBkgData=function(r){this.logger.log(2,function(){return"bkgData = "+Ge(r)}),this.backSpace(),this.setPen(r),this.insertChar(32)},o.setRollUpRows=function(r){this.nrRollUpRows=r},o.rollUp=function(){var r=this;if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,function(){return r.getDisplayText()});var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")},o.getDisplayText=function(r){r=r||!1;for(var e=[],t="",i=-1,s=0;s<rr;s++){var l=this.rows[s].getTextString();l&&(i=s+1,r?e.push("Row "+i+": '"+l+"'"):e.push(l.trim()))}return e.length>0&&(r?t="["+e.join(" | ")+"]":t=e.join(`
`)),t},o.getTextAndFormat=function(){return this.rows},a}(),dl=function(){function a(n,r,e){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new Qa(e),this.nonDisplayedMemory=new Qa(e),this.lastOutputScreen=new Qa(e),this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=e}var o=a.prototype;return o.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},o.getHandler=function(){return this.outputFilter},o.setHandler=function(r){this.outputFilter=r},o.setPAC=function(r){this.writeScreen.setPAC(r)},o.setBkgData=function(r){this.writeScreen.setBkgData(r)},o.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(2,function(){return"MODE="+r}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},o.insertChars=function(r){for(var e=this,t=0;t<r.length;t++)this.writeScreen.insertChar(r[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+e.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,function(){return"DISPLAYED: "+e.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},o.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},o.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},o.ccAOF=function(){},o.ccAON=function(){},o.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},o.ccRU=function(r){this.logger.log(2,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},o.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},o.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},o.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},o.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},o.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},o.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},o.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},o.ccEOC=function(){var r=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+r.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},o.ccTO=function(r){this.logger.log(2,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},o.ccMIDROW=function(r){var e={flash:!1};if(e.underline=r%2===1,e.italics=r>=46,e.italics)e.foreground="white";else{var t=Math.floor(r/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=i[t]}this.logger.log(2,"MIDROW: "+Ge(e)),this.writeScreen.setPen(e)},o.outputDataUpdate=function(r){r===void 0&&(r=!1);var e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))},o.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},a}(),hl=function(){function a(n,r,e){this.channels=void 0,this.currentChannel=0,this.cmdHistory=lh(),this.logger=void 0;var t=this.logger=new nh;this.channels=[null,new dl(n,r,t),new dl(n+1,e,t)]}var o=a.prototype;return o.getHandler=function(r){return this.channels[r].getHandler()},o.setHandler=function(r,e){this.channels[r].setHandler(e)},o.addData=function(r,e){var t=this;this.logger.time=r;for(var i=function(f){var d=e[f]&127,h=e[f+1]&127,c=!1,v=null;if(d===0&&h===0)return 0;t.logger.log(3,function(){return"["+Vr([e[f],e[f+1]])+"] -> ("+Vr([d,h])+")"});var g=t.cmdHistory,m=d>=16&&d<=31;if(m){if(oh(d,h,g))return _n(null,null,g),t.logger.log(3,function(){return"Repeated command ("+Vr([d,h])+") is dropped"}),0;_n(d,h,t.cmdHistory),c=t.parseCmd(d,h),c||(c=t.parseMidrow(d,h)),c||(c=t.parsePAC(d,h)),c||(c=t.parseBackgroundAttributes(d,h))}else _n(null,null,g);if(!c&&(v=t.parseChars(d,h),v)){var y=t.currentChannel;if(y&&y>0){var E=t.channels[y];E.insertChars(v)}else t.logger.log(2,"No channel found yet. TEXT-MODE?")}!c&&!v&&t.logger.log(2,function(){return"Couldn't parse cleaned data "+Vr([d,h])+" orig: "+Vr([e[f],e[f+1]])})},s,l=0;l<e.length;l+=2)s=i(l)},o.parseCmd=function(r,e){var t=(r===20||r===28||r===21||r===29)&&e>=32&&e<=47,i=(r===23||r===31)&&e>=33&&e<=35;if(!(t||i))return!1;var s=r===20||r===21||r===23?1:2,l=this.channels[s];return r===20||r===21||r===28||r===29?e===32?l.ccRCL():e===33?l.ccBS():e===34?l.ccAOF():e===35?l.ccAON():e===36?l.ccDER():e===37?l.ccRU(2):e===38?l.ccRU(3):e===39?l.ccRU(4):e===40?l.ccFON():e===41?l.ccRDC():e===42?l.ccTR():e===43?l.ccRTD():e===44?l.ccEDM():e===45?l.ccCR():e===46?l.ccENM():e===47&&l.ccEOC():l.ccTO(e-32),this.currentChannel=s,!0},o.parseMidrow=function(r,e){var t=0;if((r===17||r===25)&&e>=32&&e<=47){if(r===17?t=1:t=2,t!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[t];return i?(i.ccMIDROW(e),this.logger.log(3,function(){return"MIDROW ("+Vr([r,e])+")"}),!0):!1}return!1},o.parsePAC=function(r,e){var t,i=(r>=17&&r<=23||r>=25&&r<=31)&&e>=64&&e<=127,s=(r===16||r===24)&&e>=64&&e<=95;if(!(i||s))return!1;var l=r<=23?1:2;e>=64&&e<=95?t=l===1?Zd[r]:th[r]:t=l===1?eh[r]:rh[r];var u=this.channels[l];return u?(u.setPAC(this.interpretPAC(t,e)),this.currentChannel=l,!0):!1},o.interpretPAC=function(r,e){var t,i={color:null,italics:!1,indent:null,underline:!1,row:r};return e>95?t=e-96:t=e-64,i.underline=(t&1)===1,t<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(t/2)]:t<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((t-16)/2)*4,i},o.parseChars=function(r,e){var t,i=null,s=null;if(r>=25?(t=2,s=r-8):(t=1,s=r),s>=17&&s<=19){var l;s===17?l=e+80:s===18?l=e+112:l=e+144,this.logger.log(2,function(){return"Special char '"+ul(l)+"' in channel "+t}),i=[l]}else r>=32&&r<=127&&(i=e===0?[r]:[r,e]);return i&&this.logger.log(3,function(){return"Char codes =  "+Vr(i).join(",")}),i},o.parseBackgroundAttributes=function(r,e){var t=(r===16||r===24)&&e>=32&&e<=47,i=(r===23||r===31)&&e>=45&&e<=47;if(!(t||i))return!1;var s,l={};r===16||r===24?(s=Math.floor((e-32)/2),l.background=ih[s],e%2===1&&(l.background=l.background+"_semi")):e===45?l.background="transparent":(l.foreground="black",e===47&&(l.underline=!0));var u=r<=23?1:2,f=this.channels[u];return f.setBkgData(l),!0},o.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var e=this.channels[r];e&&e.reset()}_n(null,null,this.cmdHistory)},o.cueSplitAtTime=function(r){for(var e=0;e<this.channels.length;e++){var t=this.channels[e];t&&t.cueSplitAtTime(r)}},a}();function _n(a,o,n){n.a=a,n.b=o}function oh(a,o,n){return n.a===a&&n.b===o}function lh(){return{a:null,b:null}}var $a=function(){if(cn!=null&&cn.VTTCue)return self.VTTCue;var a=["","lr","rl"],o=["start","middle","end","left","right"];function n(s,l){if(typeof l!="string"||!Array.isArray(s))return!1;var u=l.toLowerCase();return~s.indexOf(u)?u:!1}function r(s){return n(a,s)}function e(s){return n(o,s)}function t(s){for(var l=arguments.length,u=new Array(l>1?l-1:0),f=1;f<l;f++)u[f-1]=arguments[f];for(var d=1;d<arguments.length;d++){var h=arguments[d];for(var c in h)s[c]=h[c]}return s}function i(s,l,u){var f=this,d={enumerable:!0};f.hasBeenReset=!1;var h="",c=!1,v=s,g=l,m=u,y=null,E="",T=!0,S="auto",x="start",A=50,L="middle",_=50,k="middle";Object.defineProperty(f,"id",t({},d,{get:function(){return h},set:function(b){h=""+b}})),Object.defineProperty(f,"pauseOnExit",t({},d,{get:function(){return c},set:function(b){c=!!b}})),Object.defineProperty(f,"startTime",t({},d,{get:function(){return v},set:function(b){if(typeof b!="number")throw new TypeError("Start time must be set to a number.");v=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",t({},d,{get:function(){return g},set:function(b){if(typeof b!="number")throw new TypeError("End time must be set to a number.");g=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",t({},d,{get:function(){return m},set:function(b){m=""+b,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",t({},d,{get:function(){return y},set:function(b){y=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",t({},d,{get:function(){return E},set:function(b){var D=r(b);if(D===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=D,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",t({},d,{get:function(){return T},set:function(b){T=!!b,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",t({},d,{get:function(){return S},set:function(b){if(typeof b!="number"&&b!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");S=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",t({},d,{get:function(){return x},set:function(b){var D=e(b);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");x=D,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",t({},d,{get:function(){return A},set:function(b){if(b<0||b>100)throw new Error("Position must be between 0 and 100.");A=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",t({},d,{get:function(){return L},set:function(b){var D=e(b);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");L=D,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",t({},d,{get:function(){return _},set:function(b){if(b<0||b>100)throw new Error("Size must be between 0 and 100.");_=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",t({},d,{get:function(){return k},set:function(b){var D=e(b);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");k=D,this.hasBeenReset=!0}})),f.displayState=void 0}return i.prototype.getCueAsHTML=function(){var s=self.WebVTT;return s.convertCueToDOMTree(self,this.text)},i}(),uh=function(){function a(){}var o=a.prototype;return o.decode=function(r,e){if(!r)return"";if(typeof r!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(r))},a}();function cl(a){function o(r,e,t,i){return(r|0)*3600+(e|0)*60+(t|0)+parseFloat(i||0)}var n=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?o(n[2],n[3],0,n[4]):o(n[1],n[2],n[3],n[4]):null}var fh=function(){function a(){this.values=Object.create(null)}var o=a.prototype;return o.set=function(r,e){!this.get(r)&&e!==""&&(this.values[r]=e)},o.get=function(r,e,t){return t?this.has(r)?this.values[r]:e[t]:this.has(r)?this.values[r]:e},o.has=function(r){return r in this.values},o.alt=function(r,e,t){for(var i=0;i<t.length;++i)if(e===t[i]){this.set(r,e);break}},o.integer=function(r,e){/^-?\d+$/.test(e)&&this.set(r,parseInt(e,10))},o.percent=function(r,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var t=parseFloat(e);if(t>=0&&t<=100)return this.set(r,t),!0}return!1},a}();function vl(a,o,n,r){var e=r?a.split(r):[a];for(var t in e)if(typeof e[t]=="string"){var i=e[t].split(n);if(i.length===2){var s=i[0],l=i[1];o(s,l)}}}var Ja=new $a(0,0,""),Dn=Ja.align==="middle"?"middle":"center";function dh(a,o,n){var r=a;function e(){var s=cl(a);if(s===null)throw new Error("Malformed timestamp: "+r);return a=a.replace(/^[^\sa-zA-Z-]+/,""),s}function t(s,l){var u=new fh;vl(s,function(h,c){var v;switch(h){case"region":for(var g=n.length-1;g>=0;g--)if(n[g].id===c){u.set(h,n[g].region);break}break;case"vertical":u.alt(h,c,["rl","lr"]);break;case"line":v=c.split(","),u.integer(h,v[0]),u.percent(h,v[0])&&u.set("snapToLines",!1),u.alt(h,v[0],["auto"]),v.length===2&&u.alt("lineAlign",v[1],["start",Dn,"end"]);break;case"position":v=c.split(","),u.percent(h,v[0]),v.length===2&&u.alt("positionAlign",v[1],["start",Dn,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,c);break;case"align":u.alt(h,c,["start",Dn,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");var f=u.get("line","auto");f==="auto"&&Ja.line===-1&&(f=-1),l.line=f,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Dn);var d=u.get("position","auto");d==="auto"&&Ja.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function i(){a=a.replace(/^\s+/,"")}if(i(),o.startTime=e(),i(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);a=a.slice(3),i(),o.endTime=e(),i(),t(a,o)}function gl(a){return a.replace(/<br(?: \/)?>/gi,`
`)}var hh=function(){function a(){this.state="INITIAL",this.buffer="",this.decoder=new uh,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var o=a.prototype;return o.parse=function(r){var e=this;r&&(e.buffer+=e.decoder.decode(r,{stream:!0}));function t(){var d=e.buffer,h=0;for(d=gl(d);h<d.length&&d[h]!=="\r"&&d[h]!==`
`;)++h;var c=d.slice(0,h);return d[h]==="\r"&&++h,d[h]===`
`&&++h,e.buffer=d.slice(h),c}function i(d){vl(d,function(h,c){},/:/)}try{var s="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;s=t();var l=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(l!=null&&l[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var u=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(u?u=!1:s=t(),e.state){case"HEADER":/:/.test(s)?i(s):s||(e.state="ID");continue;case"NOTE":s||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){e.state="NOTE";break}if(!s)continue;if(e.cue=new $a(0,0,""),e.state="CUE",s.indexOf("-->")===-1){e.cue.id=s;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{dh(s,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var f=s.indexOf("-->")!==-1;if(!s||f&&(u=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=s}continue;case"BADCUE":s||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},o.flush=function(){var r=this;try{if((r.cue||r.state==="HEADER")&&(r.buffer+=`

`,r.parse()),r.state==="INITIAL"||r.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){r.onparsingerror&&r.onparsingerror(e)}return r.onflush&&r.onflush(),this},a}(),ch=/\r\n|\n\r|\n|\r/g,Za=function(o,n,r){return r===void 0&&(r=0),o.slice(r,r+n.length)===n},vh=function(o){var n=parseInt(o.slice(-3)),r=parseInt(o.slice(-6,-4)),e=parseInt(o.slice(-9,-7)),t=o.length>9?parseInt(o.substring(0,o.indexOf(":"))):0;if(!U(n)||!U(r)||!U(e)||!U(t))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+o);return n+=1e3*r,n+=60*1e3*e,n+=60*60*1e3*t,n};function es(a,o,n){return Bi(a.toString())+Bi(o.toString())+Bi(n)}var gh=function(o,n,r){var e=o[n],t=o[e.prevCC];if(!t||!t.new&&e.new){o.ccOffset=o.presentationOffset=e.start,e.new=!1;return}for(;(i=t)!=null&&i.new;){var i;o.ccOffset+=e.start-t.start,e.new=!1,e=t,t=o[e.prevCC]}o.presentationOffset=r};function mh(a,o,n,r,e,t,i){var s=new hh,l=ee(new Uint8Array(a)).trim().replace(ch,`
`).split(`
`),u=[],f=o?Rf(o.baseTime,o.timescale):0,d="00:00.000",h=0,c=0,v,g=!0;s.oncue=function(m){var y=n[r],E=n.ccOffset,T=(h-f)/9e4;if(y!=null&&y.new&&(c!==void 0?E=n.ccOffset=y.start:gh(n,r,T)),T){if(!o){v=new Error("Missing initPTS for VTT MPEGTS");return}E=T-n.presentationOffset}var S=m.endTime-m.startTime,x=jt((m.startTime+E-c)*9e4,e*9e4)/9e4;m.startTime=Math.max(x,0),m.endTime=Math.max(x+S,0);var A=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(A)),m.id||(m.id=es(m.startTime,m.endTime,A)),m.endTime>0&&u.push(m)},s.onparsingerror=function(m){v=m},s.onflush=function(){if(v){i(v);return}t(u)},l.forEach(function(m){if(g)if(Za(m,"X-TIMESTAMP-MAP=")){g=!1,m.slice(16).split(",").forEach(function(y){Za(y,"LOCAL:")?d=y.slice(6):Za(y,"MPEGTS:")&&(h=parseInt(y.slice(7)))});try{c=vh(d)/1e3}catch(y){v=y}return}else m===""&&(g=!1);s.parse(m+`
`)}),s.flush()}var ts="stpp.ttml.im1t",ml=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,pl=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,ph={left:"start",center:"center",right:"end",start:"start",end:"end"};function yl(a,o,n,r){var e=de(new Uint8Array(a),["mdat"]);if(e.length===0){r(new Error("Could not parse IMSC1 mdat"));return}var t=e.map(function(s){return ee(s)}),i=bf(o.baseTime,1,o.timescale);try{t.forEach(function(s){return n(yh(s,i))})}catch(s){r(s)}}function yh(a,o){var n=new DOMParser,r=n.parseFromString(a,"text/xml"),e=r.getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");var t={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(t).reduce(function(d,h){return d[h]=e.getAttribute("ttp:"+h)||t[h],d},{}),s=e.getAttribute("xml:space")!=="preserve",l=El(rs(e,"styling","style")),u=El(rs(e,"layout","region")),f=rs(e,"body","[begin]");return[].map.call(f,function(d){var h=Tl(d,s);if(!h||!d.hasAttribute("begin"))return null;var c=ns(d.getAttribute("begin"),i),v=ns(d.getAttribute("dur"),i),g=ns(d.getAttribute("end"),i);if(c===null)throw Sl(d);if(g===null){if(v===null)throw Sl(d);g=c+v}var m=new $a(c-o,g-o,h);m.id=es(m.startTime,m.endTime,m.text);var y=u[d.getAttribute("region")],E=l[d.getAttribute("style")],T=Eh(y,E,l),S=T.textAlign;if(S){var x=ph[S];x&&(m.lineAlign=x),m.align=S}return ne(m,T),m}).filter(function(d){return d!==null})}function rs(a,o,n){var r=a.getElementsByTagName(o)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function El(a){return a.reduce(function(o,n){var r=n.getAttribute("xml:id");return r&&(o[r]=n),o},{})}function Tl(a,o){return[].slice.call(a.childNodes).reduce(function(n,r,e){var t;return r.nodeName==="br"&&e?n+`
`:(t=r.childNodes)!=null&&t.length?Tl(r,o):o?n+r.textContent.trim().replace(/\s+/g," "):n+r.textContent},"")}function Eh(a,o,n){var r="http://www.w3.org/ns/ttml#styling",e=null,t=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],i=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return i&&n.hasOwnProperty(i)&&(e=n[i]),t.reduce(function(s,l){var u=is(o,r,l)||is(a,r,l)||is(e,r,l);return u&&(s[l]=u),s},{})}function is(a,o,n){return a&&a.hasAttributeNS(o,n)?a.getAttributeNS(o,n):null}function Sl(a){return new Error("Could not parse ttml timestamp "+a)}function ns(a,o){if(!a)return null;var n=cl(a);return n===null&&(ml.test(a)?n=Th(a,o):pl.test(a)&&(n=Sh(a,o))),n}function Th(a,o){var n=ml.exec(a),r=(n[4]|0)+(n[5]|0)/o.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+r/o.frameRate}function Sh(a,o){var n=pl.exec(a),r=Number(n[1]),e=n[2];switch(e){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/o.frameRate;case"t":return r/o.tickRate}return r}var kn=function(){function a(n,r){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=n,this.trackName=r}var o=a.prototype;return o.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},o.newCue=function(r,e,t){(this.startTime===null||this.startTime>r)&&(this.startTime=r),this.endTime=e,this.screen=t,this.timelineController.createCaptionsTrack(this.trackName)},o.reset=function(){this.cueRanges=[],this.startTime=null},a}(),xh=function(){function a(n){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ll(),this.captionsProperties=void 0,this.hls=n,this.config=n.config,this.Cues=n.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},n.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(p.MANIFEST_LOADING,this.onManifestLoading,this),n.on(p.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(p.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),n.on(p.FRAG_LOADING,this.onFragLoading,this),n.on(p.FRAG_LOADED,this.onFragLoaded,this),n.on(p.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),n.on(p.FRAG_DECRYPTED,this.onFragDecrypted,this),n.on(p.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(p.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),n.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this)}var o=a.prototype;return o.destroy=function(){var r=this.hls;r.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(p.MANIFEST_LOADING,this.onManifestLoading,this),r.off(p.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(p.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(p.FRAG_LOADING,this.onFragLoading,this),r.off(p.FRAG_LOADED,this.onFragLoaded,this),r.off(p.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.off(p.FRAG_DECRYPTED,this.onFragDecrypted,this),r.off(p.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(p.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0},o.initCea608Parsers=function(){var r=new kn(this,"textTrack1"),e=new kn(this,"textTrack2"),t=new kn(this,"textTrack3"),i=new kn(this,"textTrack4");this.cea608Parser1=new hl(1,r,e),this.cea608Parser2=new hl(3,t,i)},o.addCues=function(r,e,t,i,s){for(var l=!1,u=s.length;u--;){var f=s[u],d=Ah(f[0],f[1],e,t);if(d>=0&&(f[0]=Math.min(f[0],e),f[1]=Math.max(f[1],t),l=!0,d/(t-e)>.5))return}if(l||s.push([e,t]),this.config.renderTextTracksNatively){var h=this.captionsTracks[r];this.Cues.newCue(h,e,t,i)}else{var c=this.Cues.newCue(null,e,t,i);this.hls.trigger(p.CUES_PARSED,{type:"captions",cues:c,track:r})}},o.onInitPtsFound=function(r,e){var t=this,i=e.frag,s=e.id,l=e.initPTS,u=e.timescale,f=this.unparsedVttFrags;s===K.MAIN&&(this.initPTS[i.cc]={baseTime:l,timescale:u}),f.length&&(this.unparsedVttFrags=[],f.forEach(function(d){t.onFragLoaded(p.FRAG_LOADED,d)}))},o.getExistingTrack=function(r,e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var s=t.textTracks[i];if(Al(s,{name:r,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null},o.createCaptionsTrack=function(r){this.config.renderTextTracksNatively?this.createNativeTrack(r):this.createNonNativeTrack(r)},o.createNativeTrack=function(r){if(!this.captionsTracks[r]){var e=this.captionsProperties,t=this.captionsTracks,i=this.media,s=e[r],l=s.label,u=s.languageCode,f=this.getExistingTrack(l,u);if(f)t[r]=f,li(t[r]),ol(t[r],i);else{var d=this.createTextTrack("captions",l,u);d&&(d[r]=!0,t[r]=d)}}},o.createNonNativeTrack=function(r){if(!this.nonNativeCaptionsTracks[r]){var e=this.captionsProperties[r];if(e){var t=e.label,i={_id:r,label:t,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[r]=i,this.hls.trigger(p.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},o.createTextTrack=function(r,e,t){var i=this.media;if(i)return i.addTextTrack(r,e,t)},o.onMediaAttaching=function(r,e){this.media=e.media,e.mediaSource||this._cleanTracks()},o.onMediaDetaching=function(r,e){var t=!!e.transferMedia;if(this.media=null,!t){var i=this.captionsTracks;Object.keys(i).forEach(function(s){li(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}},o.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ll(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},o._cleanTracks=function(){var r=this.media;if(r){var e=r.textTracks;if(e)for(var t=0;t<e.length;t++)li(e[t])}},o.onSubtitleTracksUpdated=function(r,e){var t=this,i=e.subtitleTracks||[],s=i.some(function(c){return c.textCodec===ts});if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var l=Vo(this.tracks,i);if(l){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var u=this.media,f=u?In(u.textTracks):null;if(this.tracks.forEach(function(c,v){var g;if(f){for(var m=null,y=0;y<f.length;y++)if(f[y]&&Al(f[y],c)){m=f[y],f[y]=null;break}m&&(g=m)}if(g)li(g);else{var E=xl(c);g=t.createTextTrack(E,c.name,c.lang),g&&(g.mode="disabled")}g&&t.textTracks.push(g)}),f!=null&&f.length){var d=f.filter(function(c){return c!==null}).map(function(c){return c.label});d.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: "+d.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var h=this.tracks.map(function(c){return{label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}});this.hls.trigger(p.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:h})}}},o.onManifestLoaded=function(r,e){var t=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(i){var s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(s){var l="textTrack"+s[1],u=t.captionsProperties[l];u&&(u.label=i.name,i.lang&&(u.languageCode=i.lang),u.media=i)}})},o.closedCaptionsForLevel=function(r){var e=this.hls.levels[r.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]},o.onFragLoading=function(r,e){if(this.enabled&&e.frag.type===K.MAIN){var t,i,s=this.cea608Parser1,l=this.cea608Parser2,u=this.lastSn,f=e.frag,d=f.cc,h=f.sn,c=(t=(i=e.part)==null?void 0:i.index)!=null?t:-1;s&&l&&(h!==u+1||h===u&&c!==this.lastPartIndex+1||d!==this.lastCc)&&(s.reset(),l.reset()),this.lastCc=d,this.lastSn=h,this.lastPartIndex=c}},o.onFragLoaded=function(r,e){var t=e.frag,i=e.payload;if(t.type===K.SUBTITLE)if(i.byteLength){var s=t.decryptdata,l="stats"in e;if(s==null||!s.encrypted||l){var u=this.tracks[t.level],f=this.vttCCs;f[t.cc]||(f[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),u&&u.textCodec===ts?this._parseIMSC1(t,i):this._parseVTTs(e)}}else this.hls.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},o._parseIMSC1=function(r,e){var t=this,i=this.hls;yl(e,this.initPTS[r.cc],function(s){t._appendCues(s,r.level),i.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},function(s){i.logger.log("Failed to parse IMSC1: "+s),i.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:s})})},o._parseVTTs=function(r){var e,t=this,i=r.frag,s=r.payload,l=this.initPTS,u=this.unparsedVttFrags,f=l.length-1;if(!l[i.cc]&&f===-1){u.push(r);return}var d=this.hls,h=(e=i.initSegment)!=null&&e.data?_t(i.initSegment.data,new Uint8Array(s)).buffer:s;mh(h,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,function(c){t._appendCues(c,i.level),d.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},function(c){var v=c.message==="Missing initPTS for VTT MPEGTS";v?u.push(r):t._fallbackToIMSC1(i,s),d.logger.log("Failed to parse VTT cue: "+c),!(v&&f>i.cc)&&d.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:c})})},o._fallbackToIMSC1=function(r,e){var t=this,i=this.tracks[r.level];i.textCodec||yl(e,this.initPTS[r.cc],function(){i.textCodec=ts,t._parseIMSC1(r,e)},function(){i.textCodec="wvtt"})},o._appendCues=function(r,e){var t=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[e];if(!i||i.mode==="disabled")return;r.forEach(function(u){return ll(i,u)})}else{var s=this.tracks[e];if(!s)return;var l=s.default?"default":"subtitles"+e;t.trigger(p.CUES_PARSED,{type:"subtitles",cues:r,track:l})}},o.onFragDecrypted=function(r,e){var t=e.frag;t.type===K.SUBTITLE&&this.onFragLoaded(p.FRAG_LOADED,e)},o.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},o.onFragParsingUserdata=function(r,e){if(!(!this.enabled||!this.config.enableCEA708Captions)){var t=e.frag,i=e.samples;if(!(t.type===K.MAIN&&this.closedCaptionsForLevel(t)==="NONE"))for(var s=0;s<i.length;s++){var l=i[s].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();var u=this.extractCea608Data(l);this.cea608Parser1.addData(i[s].pts,u[0]),this.cea608Parser2.addData(i[s].pts,u[1])}}}},o.onBufferFlushing=function(r,e){var t=e.startOffset,i=e.endOffset,s=e.endOffsetSubtitles,l=e.type,u=this.media;if(!(!u||u.currentTime<i)){if(!l||l==="video"){var f=this.captionsTracks;Object.keys(f).forEach(function(h){return za(f[h],t,i)})}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){var d=this.textTracks;Object.keys(d).forEach(function(h){return za(d[h],t,s)})}}},o.extractCea608Data=function(r){for(var e=[[],[]],t=r[0]&31,i=2,s=0;s<t;s++){var l=r[i++],u=127&r[i++],f=127&r[i++];if(!(u===0&&f===0)){var d=(4&l)!==0;if(d){var h=3&l;(h===0||h===1)&&(e[h].push(u),e[h].push(f))}}}return e},a}();function xl(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function Al(a,o){return!!a&&a.kind===xl(o)&&Ka(o,a)}function Ah(a,o,n,r){return Math.min(o,r)-Math.max(a,n)}function Ll(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var Lh=/\s/,bh={newCue:function(o,n,r,e){for(var t=[],i,s,l,u,f,d=self.VTTCue||self.TextTrackCue,h=0;h<e.rows.length;h++)if(i=e.rows[h],l=!0,u=0,f="",!i.isEmpty()){for(var c,v=0;v<i.chars.length;v++)Lh.test(i.chars[v].uchar)&&l?u++:(f+=i.chars[v].uchar,l=!1);i.cueStartTime=n,n===r&&(r+=1e-4),u>=16?u--:u++;var g=gl(f.trim()),m=es(n,r,g);o!=null&&(c=o.cues)!=null&&c.getCueById(m)||(s=new d(n,r,g),s.id=m,s.line=h+1,s.align="left",s.position=10+Math.min(80,Math.floor(u*8/32)*10),t.push(s))}return o&&t.length&&(t.sort(function(y,E){return y.line==="auto"||E.line==="auto"?0:y.line>8&&E.line>8?E.line-y.line:y.line-E.line}),t.forEach(function(y){return ll(o,y)})),t}};function Rh(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var Ih=/(\d+)-(\d+)\/(\d+)/,bl=function(){function a(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||Ch,this.controller=new self.AbortController,this.stats=new Jt}var o=a.prototype;return o.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},o.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},o.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},o.load=function(r,e,t){var i=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var l=_h(r,this.controller.signal),u=r.responseType==="arraybuffer",f=u?"byteLength":"length",d=e.loadPolicy,h=d.maxTimeToFirstByteMs,c=d.maxLoadTimeMs;this.context=r,this.config=e,this.callbacks=t,this.request=this.fetchSetup(r,l),self.clearTimeout(this.requestTimeout),e.timeout=h&&U(h)?h:c,this.requestTimeout=self.setTimeout(function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(s,r,i.response))},e.timeout);var v=Hr(this.request)?this.request.then(self.fetch):self.fetch(this.request);v.then(function(g){var m;i.response=i.loader=g;var y=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(i.requestTimeout),e.timeout=c,i.requestTimeout=self.setTimeout(function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(s,r,i.response))},c-(y-s.loading.start)),!g.ok){var E=g.status,T=g.statusText;throw new Ph(T||"fetch, bad network response",E,g)}s.loading.first=y,s.total=kh(g.headers)||s.total;var S=(m=i.callbacks)==null?void 0:m.onProgress;return S&&U(e.highWaterMark)?i.loadProgressively(g,s,r,e.highWaterMark,S):u?g.arrayBuffer():r.responseType==="json"?g.json():g.text()}).then(function(g){var m,y,E=i.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(i.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var T=g[f];T&&(s.loaded=s.total=T);var S={url:E.url,data:g,code:E.status},x=(m=i.callbacks)==null?void 0:m.onProgress;x&&!U(e.highWaterMark)&&x(s,r,g,E),(y=i.callbacks)==null||y.onSuccess(S,s,r,E)}).catch(function(g){var m;if(self.clearTimeout(i.requestTimeout),!s.aborted){var y=g&&g.code||0,E=g?g.message:null;(m=i.callbacks)==null||m.onError({code:y,text:E},r,g?g.details:null,s)}})},o.getCacheAge=function(){var r=null;if(this.response){var e=this.response.headers.get("age");r=e?parseFloat(e):null}return r},o.getResponseHeader=function(r){return this.response?this.response.headers.get(r):null},o.loadProgressively=function(r,e,t,i,s){i===void 0&&(i=0);var l=new co,u=r.body.getReader(),f=function(){return u.read().then(function(h){if(h.done)return l.dataLength&&s(e,t,l.flush().buffer,r),Promise.resolve(new ArrayBuffer(0));var c=h.value,v=c.length;return e.loaded+=v,v<i||l.dataLength?(l.push(c),l.dataLength>=i&&s(e,t,l.flush().buffer,r)):s(e,t,c.buffer,r),f()}).catch(function(){return Promise.reject()})};return f()},a}();function _h(a,o){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:o,headers:new self.Headers(ne({},a.headers))};return a.rangeEnd&&n.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),n}function Dh(a){var o=Ih.exec(a);if(o)return parseInt(o[2])-parseInt(o[1])+1}function kh(a){var o=a.get("Content-Range");if(o){var n=Dh(o);if(U(n))return n}var r=a.get("Content-Length");if(r)return parseInt(r)}function Ch(a,o){return new self.Request(a.url,o)}var Ph=function(a){function o(n,r,e){var t;return t=a.call(this,n)||this,t.code=void 0,t.details=void 0,t.code=r,t.details=e,t}return j(o,a),o}(at(Error)),wh=/^age:\s*[\d.]+\s*$/im,Rl=function(){function a(n){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=n&&n.xhrSetup||null,this.stats=new Jt,this.retryDelay=0}var o=a.prototype;return o.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},o.abortInternal=function(){var r=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),r&&(r.onreadystatechange=null,r.onprogress=null,r.readyState!==4&&(this.stats.aborted=!0,r.abort()))},o.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},o.load=function(r,e,t){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=r,this.config=e,this.callbacks=t,this.loadInternal()},o.loadInternal=function(){var r=this,e=this.config,t=this.context;if(!(!e||!t)){var i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;var l=this.xhrSetup;l?Promise.resolve().then(function(){if(!(r.loader!==i||r.stats.aborted))return l(i,t.url)}).catch(function(u){if(!(r.loader!==i||r.stats.aborted))return i.open("GET",t.url,!0),l(i,t.url)}).then(function(){r.loader!==i||r.stats.aborted||r.openAndSendXhr(i,t,e)}).catch(function(u){var f;(f=r.callbacks)==null||f.onError({code:i.status,text:u.message},t,i,s)}):this.openAndSendXhr(i,t,e)}},o.openAndSendXhr=function(r,e,t){r.readyState||r.open("GET",e.url,!0);var i=e.headers,s=t.loadPolicy,l=s.maxTimeToFirstByteMs,u=s.maxLoadTimeMs;if(i)for(var f in i)r.setRequestHeader(f,i[f]);e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,self.clearTimeout(this.requestTimeout),t.timeout=l&&U(l)?l:u,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),r.send()},o.readystatechange=function(){var r=this.context,e=this.loader,t=this.stats;if(!(!r||!e)){var i=e.readyState,s=this.config;if(!t.aborted&&i>=2&&(t.loading.first===0&&(t.loading.first=Math.max(self.performance.now(),t.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(t.loading.first-t.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;var l=e.status,u=e.responseType==="text"?e.responseText:null;if(l>=200&&l<300){var f=u??e.response;if(f!=null){var d,h;t.loading.end=Math.max(self.performance.now(),t.loading.first);var c=e.responseType==="arraybuffer"?f.byteLength:f.length;t.loaded=t.total=c,t.bwEstimate=t.total*8e3/(t.loading.end-t.loading.first);var v=(d=this.callbacks)==null?void 0:d.onProgress;v&&v(t,r,f,e);var g={url:e.responseURL,data:f,code:l};(h=this.callbacks)==null||h.onSuccess(g,t,r,e);return}}var m=s.loadPolicy.errorRetry,y=t.retry,E={url:r.url,data:void 0,code:l};if(fn(m,y,!1,E))this.retry(m);else{var T;le.error(l+" while loading "+r.url),(T=this.callbacks)==null||T.onError({code:l,text:e.statusText},r,e,t)}}}},o.loadtimeout=function(){if(this.config){var r=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(fn(r,e,!0))this.retry(r);else{var t;le.warn("timeout while loading "+((t=this.context)==null?void 0:t.url));var i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}},o.retry=function(r){var e=this.context,t=this.stats;this.retryDelay=ua(r,t.retry),t.retry++,le.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+(e==null?void 0:e.url)+", retrying "+t.retry+"/"+r.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},o.loadprogress=function(r){var e=this.stats;e.loaded=r.loaded,r.lengthComputable&&(e.total=r.total)},o.getCacheAge=function(){var r=null;if(this.loader&&wh.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");r=e?parseFloat(e):null}return r},o.getResponseHeader=function(r){return this.loader&&new RegExp("^"+r+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(r):null},a}(),Mh={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Oh=ae(ae({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Rl,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:eu,bufferController:Xf,capLevelController:Qf,errorController:su,fpsController:Bd,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Hs,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:Mh},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Fh()),{},{subtitleStreamController:jd,subtitleTrackController:$d,timelineController:xh,audioStreamController:Wf,audioTrackController:Yf,emeController:rl,cmcdController:Fd,contentSteeringController:Ud,interstitialsController:qd});function Fh(){return{cueHandler:bh,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Nh(a,o,n){if((o.liveSyncDurationCount||o.liveMaxLatencyDurationCount)&&(o.liveSyncDuration||o.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(o.liveMaxLatencyDurationCount!==void 0&&(o.liveSyncDurationCount===void 0||o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(o.liveMaxLatencyDuration!==void 0&&(o.liveSyncDuration===void 0||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var r=as(a),e=["manifest","level","frag"],t=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return e.forEach(function(i){var s=(i==="level"?"playlist":i)+"LoadPolicy",l=o[s]===void 0,u=[];t.forEach(function(f){var d=i+"Loading"+f,h=o[d];if(h!==void 0&&l){u.push(d);var c=r[s].default;switch(o[s]={default:c},f){case"TimeOut":c.maxLoadTimeMs=h,c.maxTimeToFirstByteMs=h;break;case"MaxRetry":c.errorRetry.maxNumRetry=h,c.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":c.errorRetry.retryDelayMs=h,c.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":c.errorRetry.maxRetryDelayMs=h,c.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&n.warn('hls.js config: "'+u.join('", "')+'" setting(s) are deprecated, use "'+s+'": '+Ge(o[s]))}),ae(ae({},r),o)}function as(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(as):Object.keys(a).reduce(function(o,n){return o[n]=as(a[n]),o},{}):a}function Uh(a,o){var n=a.loader;if(n!==bl&&n!==Rl)o.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1;else{var r=Rh();r&&(a.loader=bl,a.progressive=!0,a.enableSoftwareAES=!0,o.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var Cn=2,Bh=.1,Gh=.05,Kh=100,Hh=function(a){function o(r,e){var t;return t=a.call(this,"gap-controller",r.logger)||this,t.hls=null,t.fragmentTracker=null,t.media=null,t.mediaSource=void 0,t.nudgeRetry=0,t.stallReported=!1,t.stalled=null,t.moved=!1,t.seeking=!1,t.buffered={},t.lastCurrentTime=0,t.ended=0,t.waiting=0,t.onMediaPlaying=function(){t.ended=0,t.waiting=0},t.onMediaWaiting=function(){var i;(i=t.media)!=null&&i.seeking||(t.waiting=self.performance.now(),t.tick())},t.onMediaEnded=function(){if(t.hls){var i;t.ended=((i=t.media)==null?void 0:i.currentTime)||1,t.hls.trigger(p.MEDIA_ENDED,{stalled:!1})}},t.hls=r,t.fragmentTracker=e,t.registerListeners(),t}j(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e&&(e.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.BUFFER_APPENDED,this.onBufferAppended,this))},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.BUFFER_APPENDED,this.onBufferAppended,this))},n.destroy=function(){a.prototype.destroy.call(this),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0},n.onMediaAttached=function(e,t){this.setInterval(Kh),this.mediaSource=t.mediaSource;var i=this.media=t.media;yr(i,"playing",this.onMediaPlaying),yr(i,"waiting",this.onMediaWaiting),yr(i,"ended",this.onMediaEnded)},n.onMediaDetaching=function(e,t){this.clearInterval();var i=this.media;i&&(fr(i,"playing",this.onMediaPlaying),fr(i,"waiting",this.onMediaWaiting),fr(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0},n.onBufferAppended=function(e,t){this.buffered=t.timeRanges},n.tick=function(){var e;if(!(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)){var t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}},n.poll=function(e,t){var i,s,l=(i=this.hls)==null?void 0:i.config;if(l){var u=this.media,f=this.stalled;if(u){var d=u.seeking,h=this.seeking&&!d,c=!this.seeking&&d,v=u.paused&&!d||u.ended||u.playbackRate===0;if(this.seeking=d,e!==t){t&&(this.ended=0),this.moved=!0,d||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!v&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||h){h&&this.stallResolved(e);return}if(v){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&u.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(p.MEDIA_ENDED,{stalled:!1}));return}if(!Ie.getBuffered(u).length){this.nudgeRetry=0;return}var g=Ie.bufferInfo(u,e,0),m=g.nextStart||0,y=this.fragmentTracker;if(d&&y&&this.hls){var E=Il(this.hls.inFlightFragments,e),T=g.len>Cn,S=!m||E||m-e>Cn&&!y.getPartialFragment(e);if(T||S)return;this.moved=!1}var x=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){var A=g.len>0;if(!A&&!m)return;var L=Math.max(m,g.start||0)-e,_=!!(x!=null&&x.live),k=_?x.targetduration*2:Cn,R=y.getPartialFragment(e);if(L>0&&(L<=k||R)){u.paused||this._trySkipBufferHole(R);return}}var b=l.detectStallWithCurrentTimeMs,D=self.performance.now(),C=this.waiting;if(f===null){C>0&&D-C<b?this.stalled=C:this.stalled=D;return}var N=D-f;if(!d&&(N>=b||C)&&this.hls){var O;if(((O=this.mediaSource)==null?void 0:O.readyState)==="ended"&&!(x!=null&&x.live)&&Math.abs(e-((x==null?void 0:x.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(p.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}var M=Ie.bufferInfo(u,e,l.maxBufferHole);this._tryFixBufferStall(M,N)}}},n.stallResolved=function(e){var t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){var i=self.performance.now()-t;this.log("playback not stuck anymore @"+e+", after "+Math.round(i)+"ms"),this.stallReported=!1,this.waiting=0,this.hls.trigger(p.STALL_RESOLVED,{})}},n.nudgeOnVideoHole=function(e,t){var i,s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&s&&s.length>1&&e>s.end(0)){var l=Ie.bufferedInfo(Ie.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&t>=l.start){var u=Ie.timeRangesToArray(s),f=Ie.bufferedInfo(u,t,0).bufferedIndex;if(f>-1&&f<u.length-1){var d=Ie.bufferedInfo(u,e,0).bufferedIndex,h=u[f].end,c=u[f+1].start;if((d===-1||d>f)&&c-h<1&&e-h<2){var v=new Error("nudging playhead to flush pipeline after video hole. currentTime: "+e+" hole: "+h+" -> "+c+" buffered index: "+d);this.warn(v.message),this.media.currentTime+=1e-6;var g=this.fragmentTracker.getPartialFragment(e)||void 0,m=Ie.bufferInfo(this.media,e,0);this.hls.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,frag:g,buffer:m.len,bufferInfo:m})}}}}},n._tryFixBufferStall=function(e,t){var i,s,l=this.fragmentTracker,u=this.media,f=(i=this.hls)==null?void 0:i.config;if(!(!u||!l||!f)){var d=u.currentTime,h=(s=this.hls)==null?void 0:s.latestLevelDetails,c=l.getPartialFragment(d);if(c||h!=null&&h.live&&d<h.fragmentStart){var v=this._trySkipBufferHole(c);if(v||!this.media)return}var g=e.buffered;(g&&g.length>1&&e.len>f.maxBufferHole||e.nextStart&&e.nextStart-d<f.maxBufferHole)&&(t>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}},n._reportStall=function(e){var t=this.hls,i=this.media,s=this.stallReported,l=this.stalled;if(!s&&l!==null&&i&&t){this.stallReported=!0;var u=new Error("Playback stalling at @"+i.currentTime+" due to low buffer ("+Ge(e)+")");this.warn(u.message),t.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.BUFFER_STALLED_ERROR,fatal:!1,error:u,buffer:e.len,bufferInfo:e,stalled:{start:l}})}},n._trySkipBufferHole=function(e){var t,i=this.fragmentTracker,s=this.media,l=(t=this.hls)==null?void 0:t.config;if(!s||!i||!l)return 0;var u=s.currentTime,f=Ie.bufferInfo(s,u,0),d=u<f.start?f.start:f.nextStart;if(d&&this.hls){var h=f.len<=l.maxBufferHole,c=f.len>0&&f.len<1&&s.readyState<3,v=d-u;if(v>0&&(h||c)){if(v>l.maxBufferHole){var g=!1;if(u===0){var m=i.getAppendedFrag(0,K.MAIN);m&&d<m.end&&(g=!0)}if(!g){var y=e||i.getAppendedFrag(u,K.MAIN);if(y){var E;if(!((E=this.hls.loadLevelObj)!=null&&E.details))return 0;var T=Il(this.hls.inFlightFragments,d);if(T)return 0;for(var S=!1,x=y.end;x<d;){var A=i.getPartialFragment(x);if(A)x+=A.duration;else{S=!0;break}}if(S)return 0}}}var L=Math.max(d+Gh,u+Bh);if(this.warn("skipping hole, adjusting currentTime from "+u+" to "+L),this.moved=!0,s.currentTime=L,!(e!=null&&e.gap)){var _=new Error("fragment loaded with buffer holes, seeking from "+u+" to "+L);this.hls.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:_,reason:_.message,frag:e||void 0,buffer:f.len,bufferInfo:f})}return L}}return 0},n._tryNudgeBuffer=function(e){var t=this.hls,i=this.media,s=this.nudgeRetry,l=t==null?void 0:t.config;if(!i||!l)return 0;var u=i.currentTime;if(this.nudgeRetry++,s<l.nudgeMaxRetry){var f=u+(s+1)*l.nudgeOffset,d=new Error("Nudging 'currentTime' from "+u+" to "+f);this.warn(d.message),i.currentTime=f,t.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{var h=new Error("Playhead still not moving while enough data buffered @"+u+" after "+l.nudgeMaxRetry+" nudges");this.error(h.message),t.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.BUFFER_STALLED_ERROR,error:h,fatal:!0,buffer:e.len,bufferInfo:e})}},oe(o,[{key:"hasBuffered",get:function(){return Object.keys(this.buffered).length>0}}])}(Os);function Il(a,o){var n=_l(a.main);if(n&&n.start<=o)return n;var r=_l(a.audio);return r&&r.start<=o?r:null}function _l(a){if(!a)return null;switch(a.state){case w.IDLE:case w.STOPPED:case w.ENDED:case w.ERROR:return null}return a.frag}var Vh=.25;function ss(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Dl(a,o,n,r,e){var t=new a(o,n,"");try{t.value=r,e&&(t.type=e)}catch{t=new a(o,n,Ge(e?ae({type:e},r):r))}return t}var Pn=function(){var a=ss();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Wh(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var Yh=function(){function a(n){var r=this;this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=function(){r.hls&&r.hls.trigger(p.EVENT_CUE_ENTER,{})},this.hls=n,this._registerListeners()}var o=a.prototype;return o.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null},o._registerListeners=function(){var r=this.hls;r.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(p.MANIFEST_LOADING,this.onManifestLoading,this),r.on(p.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(p.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(p.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},o._unregisterListeners=function(){var r=this.hls;r.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(p.MANIFEST_LOADING,this.onManifestLoading,this),r.off(p.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(p.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(p.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},o.onMediaAttaching=function(r,e){var t;this.media=e.media,((t=e.overrides)==null?void 0:t.cueRemoval)===!1&&(this.removeCues=!1)},o.onMediaAttached=function(){var r=this.hls.latestLevelDetails;r&&this.updateDateRangeCues(r)},o.onMediaDetaching=function(r,e){this.media=null;var t=!!e.transferMedia;t||(this.id3Track&&(this.removeCues&&li(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})},o.onManifestLoading=function(){this.dateRangeCuesAppended={}},o.createTrack=function(r){var e=this.getID3Track(r.textTracks);return e.mode="hidden",e},o.getID3Track=function(r){if(this.media){for(var e=0;e<r.length;e++){var t=r[e];if(t.kind==="metadata"&&t.label==="id3")return ol(t,this.media),t}return this.media.addTextTrack("metadata","id3")}},o.onFragParsingMetadata=function(r,e){if(this.media){var t=this.hls.config,i=t.enableEmsgMetadataCues,s=t.enableID3MetadataCues;if(!(!i&&!s)){var l=e.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var u=ss();if(u)for(var f=0;f<l.length;f++){var d=l[f].type;if(!(d===Ht.emsg&&!i||!s)){var h=So(l[f].data);if(h){var c=l[f].pts,v=c+l[f].duration;v>Pn&&(v=Pn);var g=v-c;g<=0&&(v=c+Vh);for(var m=0;m<h.length;m++){var y=h[m];if(!xo(y)){this.updateId3CueEnds(c,d);var E=Dl(u,c,v,y,d);E&&this.id3Track.addCue(E)}}}}}}}},o.updateId3CueEnds=function(r,e){var t,i=(t=this.id3Track)==null?void 0:t.cues;if(i)for(var s=i.length;s--;){var l=i[s];l.type===e&&l.startTime<r&&l.endTime===Pn&&(l.endTime=r)}},o.onBufferFlushing=function(r,e){var t=e.startOffset,i=e.endOffset,s=e.type,l=this.id3Track,u=this.hls;if(u){var f=u.config,d=f.enableEmsgMetadataCues,h=f.enableID3MetadataCues;if(l&&(d||h)){var c;s==="audio"?c=function(g){return g.type===Ht.audioId3&&h}:s==="video"?c=function(g){return g.type===Ht.emsg&&d}:c=function(g){return g.type===Ht.audioId3&&h||g.type===Ht.emsg&&d},za(l,t,i,c)}}},o.onLevelUpdated=function(r,e){var t=e.details;this.updateDateRangeCues(t,!0)},o.onLevelPtsUpdated=function(r,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)},o.updateDateRangeCues=function(r,e){var t=this;if(!(!this.media||!r.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var i=this.id3Track,s=r.dateRanges,l=Object.keys(s),u=this.dateRangeCuesAppended;if(i&&e){var f;if((f=i.cues)!=null&&f.length)for(var d=Object.keys(u).filter(function(E){return!l.includes(E)}),h=function(){var T=d[c],S=u[T].cues;delete u[T],Object.keys(S).forEach(function(x){try{var A=S[x];A.removeEventListener("enter",t.onEventCueEnter),i.removeCue(A)}catch{}})},c=d.length;c--;)h();else u=this.dateRangeCuesAppended={}}var v=r.fragments[r.fragments.length-1];if(!(l.length===0||!U(v==null?void 0:v.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=ss(),m=function(){var T=l[y],S=s[T],x=S.startTime,A=u[T],L=(A==null?void 0:A.cues)||{},_=(A==null?void 0:A.durationKnown)||!1,k=Pn,R=S.duration,b=S.endDate;if(b&&R!==null)k=x+R,_=!0;else if(S.endOnNext&&!_){var D=l.reduce(function(ie,xe){if(xe!==S.id){var ue=s[xe];if(ue.class===S.class&&ue.startDate>S.startDate&&(!ie||S.startDate<ie.startDate))return ue}return ie},null);D&&(k=D.startTime,_=!0)}for(var C=Object.keys(S.attr),N=0;N<C.length;N++){var O=C[N];if(Eu(O)){var M=L[O];if(M)_&&!A.durationKnown?M.endTime=k:Math.abs(M.startTime-x)>.01&&(M.startTime=x,M.endTime=k);else if(g){var G=S.attr[O];Tu(O)&&(G=Wh(G));var Y={key:O,data:G},W=Dl(g,x,k,Y,Ht.dateRange);W&&(W.id=T,t.id3Track.addCue(W),L[O]=W,t.hls.config.interstitialsController&&(O==="X-ASSET-LIST"||O==="X-ASSET-URL")&&W.addEventListener("enter",t.onEventCueEnter))}}}u[T]={cues:L,dateRange:S,durationKnown:_}},y=0;y<l.length;y++)m()}}},a}(),qh=function(){function a(n){var r=this;this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=function(){var e=r.media,t=r.levelDetails;if(!(!e||!t)){r.currentTime=e.currentTime;var i=r.computeLatency();if(i!==null){r._latency=i;var s=r.config,l=s.lowLatencyMode,u=s.maxLiveSyncPlaybackRate;if(!(!l||u===1||!t.live)){var f=r.targetLatency;if(f!==null){var d=i-f,h=Math.min(r.maxLatency,f+t.targetduration),c=d<h;if(c&&d>.05&&r.forwardBufferLength>1){var v=Math.min(2,Math.max(1,u)),g=Math.round(2/(1+Math.exp(-.75*d-r.edgeStalled))*20)/20,m=Math.min(v,Math.max(1,g));r.changeMediaPlaybackRate(e,m)}else e.playbackRate!==1&&e.playbackRate!==0&&r.changeMediaPlaybackRate(e,1)}}}}},this.hls=n,this.config=n.config,this.registerListeners()}var o=a.prototype;return o.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null},o.registerListeners=function(){var r=this.hls;r&&(r.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(p.MANIFEST_LOADING,this.onManifestLoading,this),r.on(p.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(p.ERROR,this.onError,this))},o.unregisterListeners=function(){var r=this.hls;r&&(r.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(p.MANIFEST_LOADING,this.onManifestLoading,this),r.off(p.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(p.ERROR,this.onError,this))},o.onMediaAttached=function(r,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)},o.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)},o.onManifestLoading=function(){this._latency=null,this.stallCount=0},o.onLevelUpdated=function(r,e){var t=e.details;t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)},o.onError=function(r,e){var t;e.details===I.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(t=this.levelDetails)!=null&&t.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))},o.changeMediaPlaybackRate=function(r,e){var t,i;r.playbackRate!==e&&((t=this.hls)==null||t.logger.debug("[latency-controller]: latency="+this.latency.toFixed(3)+", targetLatency="+((i=this.targetLatency)==null?void 0:i.toFixed(3))+", forwardBufferLength="+this.forwardBufferLength.toFixed(3)+": adjusting playback rate from "+r.playbackRate+" to "+e),r.playbackRate=e)},o.estimateLiveEdge=function(){var r=this.levelDetails;return r===null?null:r.edge+r.age},o.computeLatency=function(){var r=this.estimateLiveEdge();return r===null?null:r-this.currentTime},oe(a,[{key:"levelDetails",get:function(){var r;return((r=this.hls)==null?void 0:r.latestLevelDetails)||null}},{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var r=this.config;if(r.liveMaxLatencyDuration!==void 0)return r.liveMaxLatencyDuration;var e=this.levelDetails;return e?r.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var r=this.levelDetails;if(r===null||this.hls===null)return null;var e=r.holdBack,t=r.partHoldBack,i=r.targetduration,s=this.config,l=s.liveSyncDuration,u=s.liveSyncDurationCount,f=s.lowLatencyMode,d=this.hls.userConfig,h=f&&t||e;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=l!==void 0?l:u*i);var c=i;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)},set:function(r){this.stallCount=0,this.config.liveSyncDuration=r,this._targetLatencyUpdated=!0}},{key:"liveSyncPosition",get:function(){var r=this.estimateLiveEdge(),e=this.targetLatency;if(r===null||e===null)return null;var t=this.levelDetails;if(t===null)return null;var i=t.edge,s=r-e-this.edgeStalled,l=i-t.totalduration,u=i-(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.min(Math.max(l,s),u)}},{key:"drift",get:function(){var r=this.levelDetails;return r===null?1:r.drift}},{key:"edgeStalled",get:function(){var r=this.levelDetails;if(r===null)return 0;var e=(this.config.lowLatencyMode&&r.partTarget||r.targetduration)*3;return Math.max(r.age-e,0)}},{key:"forwardBufferLength",get:function(){var r=this.media,e=this.levelDetails;if(!r||!e)return 0;var t=r.buffered.length;return(t?r.buffered.end(t-1):e.edge)-this.currentTime}}])}(),jh=function(a){function o(r,e){var t;return t=a.call(this,r,"level-controller")||this,t._levels=[],t._firstLevel=-1,t._maxAutoLevel=-1,t._startLevel=void 0,t.currentLevel=null,t.currentLevelIndex=-1,t.manualLevelIndex=-1,t.steering=void 0,t.onParsedComplete=void 0,t.steering=e,t._registerListeners(),t}j(o,a);var n=o.prototype;return n._registerListeners=function(){var e=this.hls;e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(p.LEVEL_LOADED,this.onLevelLoaded,this),e.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(p.FRAG_BUFFERED,this.onFragBuffered,this),e.on(p.ERROR,this.onError,this)},n._unregisterListeners=function(){var e=this.hls;e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(p.LEVEL_LOADED,this.onLevelLoaded,this),e.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(p.FRAG_BUFFERED,this.onFragBuffered,this),e.off(p.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),a.prototype.destroy.call(this)},n.stopLoad=function(){var e=this._levels;e.forEach(function(t){t.loadError=0,t.fragmentError=0}),a.prototype.stopLoad.call(this)},n.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},n.onManifestLoading=function(e,t){this.resetLevels()},n.onManifestLoaded=function(e,t){var i=this,s=this.hls.config.preferManagedMediaSource,l=[],u={},f={},d=!1,h=!1,c=!1;t.levels.forEach(function(v){var g,m=v.attrs,y=v.audioCodec,E=v.videoCodec;y&&(v.audioCodec=y=Jr(y,s)||void 0),((g=E)==null?void 0:g.indexOf("avc1"))===0&&(E=v.videoCodec=ia(E));var T=v.width,S=v.height,x=v.unknownCodecs,A=x?x.length:0;if(x)for(var L=A;L--;){var _=x[L];i.isAudioSupported(_)?(v.audioCodec=y=y?y+","+_:_,A--,qe.audio[y.substring(0,4)]=2):i.isVideoSupported(_)&&(v.videoCodec=E=E?E+","+_:_,A--,qe.video[E.substring(0,4)]=2)}if(d||(d=!!(T&&S)),h||(h=!!E),c||(c=!!y),A||y&&!i.isAudioSupported(y)||E&&!i.isVideoSupported(E)){i.log('Some or all CODECS not supported "'+m.CODECS+'"');return}var k=m.CODECS,R=m["FRAME-RATE"],b=m["HDCP-LEVEL"],D=m["PATHWAY-ID"],C=m.RESOLUTION,N=m["VIDEO-RANGE"],O=(D||".")+"-",M=""+O+v.bitrate+"-"+C+"-"+R+"-"+k+"-"+N+"-"+b;if(u[M])if(u[M].uri!==v.url&&!v.attrs["PATHWAY-ID"]){var Y=f[M]+=1;v.attrs["PATHWAY-ID"]=new Array(Y+1).join(".");var W=i.createLevel(v);u[M]=W,l.push(W)}else u[M].addGroupId("audio",m.AUDIO),u[M].addGroupId("text",m.SUBTITLES);else{var G=i.createLevel(v);u[M]=G,f[M]=1,l.push(G)}}),this.filterAndSortMediaOptions(l,t,d,h,c)},n.createLevel=function(e){var t=new Ar(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){var s=new Error('SUPPLEMENTAL-CODECS not supported "'+i.videoCodec+'"');this.log(s.message),t.supportedResult=Zi(s,[])}return t},n.isAudioSupported=function(e){return ar(e,"audio",this.hls.config.preferManagedMediaSource)},n.isVideoSupported=function(e){return ar(e,"video",this.hls.config.preferManagedMediaSource)},n.filterAndSortMediaOptions=function(e,t,i,s,l){var u=this,f=[],d=[],h=e;if((i||s)&&l&&(h=h.filter(function(k){var R=k.videoCodec,b=k.videoRange,D=k.width,C=k.height;return(!!R||!!(D&&C))&&rn(b)})),h.length===0){Promise.resolve().then(function(){if(u.hls){var k="no level with compatible codecs found in manifest",R=k;t.levels.length&&(R="one or more CODECS in variant not supported: "+Ge(t.levels.map(function(D){return D.attrs.CODECS}).filter(function(D,C,N){return N.indexOf(D)===C})),u.warn(R),k+=" ("+R+")");var b=new Error(k);u.hls.trigger(p.ERROR,{type:B.MEDIA_ERROR,details:I.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:b,reason:R})}});return}t.audioTracks&&(f=t.audioTracks.filter(function(k){return!k.audioCodec||u.isAudioSupported(k.audioCodec)}),kl(f)),t.subtitles&&(d=t.subtitles,kl(d));var c=h.slice(0);h.sort(function(k,R){if(k.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(k.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&k.height!==R.height)return k.height-R.height;if(k.frameRate!==R.frameRate)return k.frameRate-R.frameRate;if(k.videoRange!==R.videoRange)return Nr.indexOf(k.videoRange)-Nr.indexOf(R.videoRange);if(k.videoCodec!==R.videoCodec){var b=qt(k.videoCodec),D=qt(R.videoCodec);if(b!==D)return D-b}if(k.uri===R.uri&&k.codecSet!==R.codecSet){var C=vr(k.codecSet),N=vr(R.codecSet);if(C!==N)return N-C}return k.averageBitrate!==R.averageBitrate?k.averageBitrate-R.averageBitrate:0});var v=c[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==c.length)){for(var g=0;g<c.length;g++)if(c[g].pathwayId===h[0].pathwayId){v=c[g];break}}this._levels=h;for(var m=0;m<h.length;m++)if(h[m]===v){var y;this._firstLevel=m;var E=v.bitrate,T=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+h.length+" level(s) found, first bitrate: "+E),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){var S=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);S>T&&T===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=S)}break}var x=l&&!s,A=this.hls.config,L=!!(A.audioStreamController&&A.audioTrackController),_={levels:h,audioTracks:f,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:s,altAudio:L&&!x&&f.some(function(k){return!!k.url})};this.hls.trigger(p.MANIFEST_PARSED,_)},n.onError=function(e,t){t.fatal||!t.context||t.context.type===re.LEVEL&&t.context.level===this.level&&this.checkRetry(t)},n.onFragBuffered=function(e,t){var i=t.frag;if(i!==void 0&&i.type===K.MAIN){var s=i.elementaryStreams;if(!Object.keys(s).some(function(u){return!!s[u]}))return;var l=this._levels[i.level];l!=null&&l.loadError&&(this.log("Resetting level error count of "+l.loadError+" on frag buffered"),l.loadError=0)}},n.onLevelLoaded=function(e,t){var i,s=t.level,l=t.details,u=t.levelInfo;if(!u){var f;this.warn("Invalid level index "+s),(f=t.deliveryDirectives)!=null&&f.skip&&(l.deltaUpdateFailed=!0);return}if(u===this.currentLevel||t.withoutMultiVariant){u.fragmentError===0&&(u.loadError=0);var d=u.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(s,t,d)}else(i=t.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)},n.loadPlaylist=function(e){a.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)},n.loadingPlaylist=function(e,t){a.prototype.loadingPlaylist.call(this,e,t);var i=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],u=e.details,f=u==null?void 0:u.age;this.log("Loading level index "+s+((t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:"")+(l?" Pathway "+l:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+i),this.hls.trigger(p.LEVEL_LOADING,{url:i,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})},n.removeLevel=function(e){var t=this,i;if(this._levels.length!==1){var s=this._levels.filter(function(u,f){return f!==e?!0:(t.steering&&t.steering.removeLevel(u),u===t.currentLevel&&(t.currentLevel=null,t.currentLevelIndex=-1,u.details&&u.details.fragments.forEach(function(d){return d.level=-1})),!1)});oo(s),this._levels=s,this.currentLevelIndex>-1&&(i=this.currentLevel)!=null&&i.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);var l=s.length-1;this._firstLevel=Math.min(this._firstLevel,l),this._startLevel&&(this._startLevel=Math.min(this._startLevel,l)),this.hls.trigger(p.LEVELS_UPDATED,{levels:s})}},n.onLevelsUpdated=function(e,t){var i=t.levels;this._levels=i},n.checkMaxAutoUpdated=function(){var e=this.hls,t=e.autoLevelCapping,i=e.maxAutoLevel,s=e.maxHdcpLevel;this._maxAutoLevel!==i&&(this._maxAutoLevel=i,this.hls.trigger(p.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:i,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))},oe(o,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"loadLevelObj",get:function(){return this.currentLevel}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(t.length!==0){if(e<0||e>=t.length){var i=new Error("invalid level idx"),s=e<0;if(this.hls.trigger(p.ERROR,{type:B.OTHER_ERROR,details:I.LEVEL_SWITCH_ERROR,level:e,fatal:s,error:i,reason:i.message}),s)return;e=Math.min(e,t.length-1)}var l=this.currentLevelIndex,u=this.currentLevel,f=u?u.attrs["PATHWAY-ID"]:void 0,d=t[e],h=d.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=d,!(l===e&&u&&f===h)){this.log("Switching to level "+e+" ("+(d.height?d.height+"p ":"")+(d.videoRange?d.videoRange+" ":"")+(d.codecSet?d.codecSet+" ":"")+"@"+d.bitrate+")"+(h?" with Pathway "+h:"")+" from level "+l+(f?" with Pathway "+f:""));var c={level:e,attrs:d.attrs,details:d.details,bitrate:d.bitrate,averageBitrate:d.averageBitrate,maxBitrate:d.maxBitrate,realBitrate:d.realBitrate,width:d.width,height:d.height,codecSet:d.codecSet,audioCodec:d.audioCodec,videoCodec:d.videoCodec,audioGroups:d.audioGroups,subtitleGroups:d.subtitleGroups,loaded:d.loaded,loadError:d.loadError,fragmentError:d.fragmentError,name:d.name,id:d.id,uri:d.uri,url:d.url,urlId:0,audioGroupIds:d.audioGroupIds,textGroupIds:d.textGroupIds};this.hls.trigger(p.LEVEL_SWITCHING,c);var v=d.details;if(!v||v.live){var g=this.switchParams(d.uri,u==null?void 0:u.details,v);this.loadPlaylist(g)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"pathways",get:function(){return this.steering?this.steering.pathways():[]}},{key:"pathwayPriority",get:function(){return this.steering?this.steering.pathwayPriority:null},set:function(e){if(this.steering){var t=this.steering.pathways(),i=e.filter(function(s){return t.indexOf(s)!==-1});if(e.length<1){this.warn("pathwayPriority "+e+" should contain at least one pathway from list: "+t);return}this.steering.pathwayPriority=i}}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}])}(Ga);function kl(a){var o={};a.forEach(function(n){var r=n.groupId||"";n.id=o[r]=o[r]||0,o[r]++})}function Cl(){return self.SourceBuffer||self.WebKitSourceBuffer}function Pl(){var a=ot();if(!a)return!1;var o=Cl();return!o||o.prototype&&typeof o.prototype.appendBuffer=="function"&&typeof o.prototype.remove=="function"}function Xh(){if(!Pl())return!1;var a=ot();return typeof(a==null?void 0:a.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(o){return a.isTypeSupported(Dt(o,"video"))})||["mp4a.40.2","fLaC"].some(function(o){return a.isTypeSupported(Dt(o,"audio"))}))}function zh(){var a,o=Cl();return typeof(o==null||(a=o.prototype)==null?void 0:a.changeType)=="function"}var Qh=100,$h=function(a){function o(r,e,t){var i;return i=a.call(this,r,e,t,"stream-controller",K.MAIN)||this,i.audioCodecSwap=!1,i.level=-1,i._forceStartLoad=!1,i._hasEnoughToStart=!1,i.altAudio=0,i.audioOnly=!1,i.fragPlaying=null,i.fragLastKbps=0,i.couldBacktrack=!1,i.backtrackFragment=null,i.audioCodecSwitch=!1,i.videoBuffer=null,i.onMediaPlaying=function(){i.tick()},i.onMediaSeeked=function(){var s=i.media,l=s?s.currentTime:null;if(!(l===null||!U(l))&&(i.log("Media seeked to "+l.toFixed(3)),!!i.getBufferedFrag(l))){var u=i.getFwdBufferInfoAtPos(s,l,K.MAIN,0);if(u===null||u.len===0){i.warn("Main forward buffer length at "+l+' on "seeked" event '+(u?u.len:"empty")+")");return}i.tick()}},i.registerListeners(),i}j(o,a);var n=o.prototype;return n.registerListeners=function(){a.prototype.registerListeners.call(this);var e=this.hls;e.on(p.MANIFEST_PARSED,this.onManifestParsed,this),e.on(p.LEVEL_LOADING,this.onLevelLoading,this),e.on(p.LEVEL_LOADED,this.onLevelLoaded,this),e.on(p.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(p.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(p.BUFFER_CREATED,this.onBufferCreated,this),e.on(p.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(p.FRAG_BUFFERED,this.onFragBuffered,this)},n.unregisterListeners=function(){a.prototype.unregisterListeners.call(this);var e=this.hls;e.off(p.MANIFEST_PARSED,this.onManifestParsed,this),e.off(p.LEVEL_LOADED,this.onLevelLoaded,this),e.off(p.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(p.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(p.BUFFER_CREATED,this.onBufferCreated,this),e.off(p.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(p.FRAG_BUFFERED,this.onFragBuffered,this)},n.onHandlerDestroying=function(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this)},n.startLoad=function(e,t){if(this.levels){var i=this.lastCurrentTime,s=this.hls;if(this.stopLoad(),this.setInterval(Qh),this.level=-1,!this.startFragRequested){var l=s.startLevel;l===-1&&(s.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=s.firstAutoLevel),s.nextLoadLevel=l,this.level=s.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),e=i),this.state=w.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=w.STOPPED},n.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},n.doTick=function(){switch(this.state){case w.WAITING_LEVEL:{var e=this.levels,t=this.level,i=e==null?void 0:e[t],s=i==null?void 0:i.details;if(s&&(!s.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(s))break;this.state=w.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=w.IDLE;break}break}case w.FRAG_LOADING_WAITING_RETRY:{var l,u=self.performance.now(),f=this.retryDate;if(!f||u>=f||(l=this.media)!=null&&l.seeking){var d=this.levels,h=this.level,c=d==null?void 0:d[h];this.resetStartWhenNotLoaded(c||null),this.state=w.IDLE}}break}this.state===w.IDLE&&this.doTickIdle(),this.onTickEnd()},n.onTickEnd=function(){var e;a.prototype.onTickEnd.call(this),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()},n.doTickIdle=function(){var e=this.hls,t=this.levelLastLoaded,i=this.levels,s=this.media;if(!(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)){var l=this.buffering?e.nextLoadLevel:e.loadLevel;if(i!=null&&i[l]){var u=i[l],f=this.getMainFwdBufferInfo();if(f!==null){var d=this.getLevelDetails();if(d&&this._streamEnded(f,d)){var h={};this.altAudio===2&&(h.type="video"),this.hls.trigger(p.BUFFER_EOS,h),this.state=w.ENDED;return}if(this.buffering){e.loadLevel!==l&&e.manualLevel===-1&&this.log("Adapting to level "+l+" from level "+this.level),this.level=e.nextLoadLevel=l;var c=u.details;if(!c||this.state===w.WAITING_LEVEL||this.waitForLive(u)){this.level=l,this.state=w.WAITING_LEVEL,this.startFragRequested=!1;return}var v=f.len,g=this.getMaxBufferLength(u.maxBitrate);if(!(v>=g)){this.backtrackFragment&&this.backtrackFragment.start>f.end&&(this.backtrackFragment=null);var m=this.backtrackFragment?this.backtrackFragment.start:f.end,y=this.getNextFragment(m,c);if(this.couldBacktrack&&!this.fragPrevious&&y&&Se(y)&&this.fragmentTracker.getState(y)!==ut.OK){var E,T=((E=this.backtrackFragment)!=null?E:y).sn,S=T-c.startSN,x=c.fragments[S-1];x&&y.cc===x.cc&&(y=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&f.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,m)){var A=y.gap;if(!A){var L=this.audioOnly&&!this.altAudio?be.AUDIO:be.VIDEO,_=(L===be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;_&&this.afterBufferFlushed(_,L,K.MAIN)}y=this.getNextFragmentLoopLoading(y,c,f,K.MAIN,g)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,u,m))}}}}}},n.loadFragment=function(e,t,i){var s=this.fragmentTracker.getState(e);s===ut.NOT_LOADED||s===ut.PARTIAL?Se(e)?this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e,t)):a.prototype.loadFragment.call(this,e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)},n.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,K.MAIN)},n.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},n.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},n.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(t!=null&&t.readyState){var i,s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);var l=this.getLevelDetails();if(l!=null&&l.live){var u=this.getMainFwdBufferInfo();if(!u||u.len<l.targetduration*2)return}if(!t.paused&&e){var f=this.hls.nextLoadLevel,d=e[f],h=this.fragLastKbps;h&&this.fragCurrent?i=this.fragCurrent.duration*d.maxBitrate/(1e3*h)+1:i=0}else i=0;var c=this.getBufferedFrag(t.currentTime+i);if(c){var v=this.followingBufferedFrag(c);if(v){this.abortCurrentFrag();var g=v.maxStartPTS?v.maxStartPTS:v.start,m=v.duration,y=Math.max(c.end,g+Math.min(Math.max(m-this.config.maxFragLookUpTolerance,m*(this.couldBacktrack?.5:.125)),m*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(y,Number.POSITIVE_INFINITY)}}}},n.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case w.KEY_LOADING:case w.FRAG_LOADING:case w.FRAG_LOADING_WAITING_RETRY:case w.PARSING:case w.PARSED:this.state=w.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},n.flushMainBuffer=function(e,t){a.prototype.flushMainBuffer.call(this,e,t,this.altAudio===2?"video":null)},n.onMediaAttached=function(e,t){a.prototype.onMediaAttached.call(this,e,t);var i=t.media;yr(i,"playing",this.onMediaPlaying),yr(i,"seeked",this.onMediaSeeked)},n.onMediaDetaching=function(e,t){var i=this.media;i&&(fr(i,"playing",this.onMediaPlaying),fr(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,a.prototype.onMediaDetaching.call(this,e,t);var s=!!t.transferMedia;s||(this._hasEnoughToStart=!1)},n.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.log("Trigger BUFFER_RESET"),this.hls.trigger(p.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1},n.onManifestParsed=function(e,t){var i=!1,s=!1;t.levels.forEach(function(l){var u=l.audioCodec;u&&(i=i||u.indexOf("mp4a.40.2")!==-1,s=s||u.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&s&&!zh(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},n.onLevelLoading=function(e,t){var i=this.levels;if(!(!i||this.state!==w.IDLE)){var s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=w.WAITING_LEVEL)}},n.onLevelLoaded=function(e,t){var i,s=this.levels,l=this.startFragRequested,u=t.level,f=t.details,d=f.totalduration;if(!s){this.warn("Levels were reset while loading level "+u);return}this.log("Level "+u+" loaded ["+f.startSN+","+f.endSN+"]"+(f.lastPartSn?"[part-"+f.lastPartSn+"-"+f.lastPartIndex+"]":"")+", cc ["+f.startCC+", "+f.endCC+"] duration:"+d);var h=t.levelInfo,c=this.fragCurrent;c&&(this.state===w.FRAG_LOADING||this.state===w.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();var v=0;if(f.live||(i=h.details)!=null&&i.live){var g;if(this.checkLiveUpdate(f),f.deltaUpdateFailed)return;v=this.alignPlaylists(f,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(h.details=f,this.levelLastLoaded=h,l||this.setStartPosition(f,v),this.hls.trigger(p.LEVEL_UPDATED,{details:f,level:u}),this.state===w.WAITING_LEVEL){if(this.waitForCdnTuneIn(f))return;this.state=w.IDLE}l&&f.live&&this.synchronizeToLiveEdge(f),this.tick()},n.synchronizeToLiveEdge=function(e){var t=this.config,i=this.media;if(i){var s=this.hls.liveSyncPosition,l=this.getLoadPosition(),u=e.fragmentStart,f=e.edge,d=l>=u-t.maxFragLookUpTolerance&&l<=f;if(s!==null&&i.duration>s&&(l<s||!d)){var h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!d&&i.readyState<4||l<f-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),i.readyState&&(this.warn("Playback: "+l.toFixed(3)+" is located too far from the end of live sliding playlist: "+f+", reset currentTime to : "+s.toFixed(3)),i.currentTime=s))}}},n._handleFragmentLoadProgress=function(e){var t,i=e.frag,s=e.part,l=e.payload,u=this.levels;if(!u){this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var f=u[i.level];if(!f){this.warn("Level "+i.level+" not found on progress");return}var d=f.details;if(!d){this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),this.fragmentTracker.removeFragment(i);return}var h=f.videoCodec,c=d.PTSKnown||!d.live,v=(t=i.initSegment)==null?void 0:t.data,g=this._getAudioCodec(f),m=this.transmuxer=this.transmuxer||new Ko(this.hls,K.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=s?s.index:-1,E=y!==-1,T=new da(i.level,i.sn,i.stats.chunkCount,l.byteLength,y,E),S=this.initPTS[i.cc];m.push(l,v,g,h,i,s,d.totalduration,c,T,S)},n.onAudioTrackSwitching=function(e,t){var i=this,s=this.hls,l=this.altAudio===2,u=ln(t.url,s);if(u)this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var f=this.fragCurrent;f&&(this.log("Switching to main audio track, cancel main fragment load"),f.abortRequests(),this.fragmentTracker.removeFragment(f)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(l){this.fragmentTracker.removeAllFragments(),s.once(p.BUFFER_FLUSHED,function(){var d;(d=i.hls)==null||d.trigger(p.AUDIO_TRACK_SWITCHED,t)}),s.trigger(p.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(p.AUDIO_TRACK_SWITCHED,t)}},n.onAudioTrackSwitched=function(e,t){var i=ln(t.url,this.hls);if(i){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i?2:0,this.tick()},n.onBufferCreated=function(e,t){var i=t.tracks,s,l,u=!1;for(var f in i){var d=i[f];if(d.id==="main"){if(l=f,s=d,f==="video"){var h=i[f];h&&(this.videoBuffer=h.buffer)}}else u=!0}u&&s?(this.log("Alternate track found, use "+l+".buffered to schedule main fragment loading"),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media},n.onFragBuffered=function(e,t){var i=t.frag,s=t.part,l=i.type===K.MAIN;if(l){if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(s?" p: "+s.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),this.state===w.PARSED&&(this.state=w.IDLE);return}var u=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),Se(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}var f=this.media;f&&(!this._hasEnoughToStart&&Ie.getBuffered(f).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())},n.onError=function(e,t){var i;if(t.fatal){this.state=w.ERROR;return}switch(t.details){case I.FRAG_GAP:case I.FRAG_PARSING_ERROR:case I.FRAG_DECRYPT_ERROR:case I.FRAG_LOAD_ERROR:case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_ERROR:case I.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(K.MAIN,t);break;case I.LEVEL_LOAD_ERROR:case I.LEVEL_LOAD_TIMEOUT:case I.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===w.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===re.LEVEL&&(this.state=w.IDLE);break;case I.BUFFER_ADD_CODEC_ERROR:case I.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case I.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case I.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}},n.onFragLoadEmergencyAborted=function(){this.state=w.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()},n.onBufferFlushed=function(e,t){var i=t.type;if(i!==be.AUDIO||!this.altAudio){var s=(i===be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,i,K.MAIN),this.tick())}},n.onLevelsUpdated=function(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels},n.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},n.seekToStartPos=function(){var e=this.media;if(e){var t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log("could not seek to "+i+", already seeking at "+t);return}var s=this.timelineOffset;s&&i&&(i+=s);var l=this.getLevelDetails(),u=Ie.getBuffered(e),f=u.length?u.start(0):0,d=f-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);d>0&&(d<h||this.loadingParts&&d<2*((l==null?void 0:l.partTarget)||0))&&(this.log("adjusting start position by "+d+" to match buffer start"),i+=d,this.startPosition=i),t<i&&(this.log("seek to target start position "+i+" from current time "+t+" buffer start "+f),e.currentTime=i)}}},n._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t},n._loadBitrateTestFrag=function(e,t){var i=this;e.bitrateTest=!0,this._doFragLoad(e,t).then(function(s){var l=i.hls,u=s==null?void 0:s.frag;if(!(!u||i.fragContextChanged(u))){t.fragmentError=0,i.state=w.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var f=u.stats;f.parsing.start=f.parsing.end=f.buffering.start=f.buffering.end=self.performance.now(),l.trigger(p.FRAG_LOADED,s),u.bitrateTest=!1}})},n._handleTransmuxComplete=function(e){var t,i=this.playlistType,s=this.hls,l=e.remuxResult,u=e.chunkMeta,f=this.getCurrentContext(u);if(!f){this.resetWhenMissingContext(u);return}var d=f.frag,h=f.part,c=f.level,v=l.video,g=l.text,m=l.id3,y=l.initSegment,E=c.details,T=this.altAudio?void 0:l.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=w.PARSING,y){if(y!=null&&y.tracks){var S=d.initSegment||d;this._bufferInitSegment(c,y.tracks,S,u),s.trigger(p.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:i,tracks:y.tracks})}var x=y.initPTS,A=y.timescale;U(x)&&(this.initPTS[d.cc]={baseTime:x,timescale:A},s.trigger(p.INIT_PTS_FOUND,{frag:d,id:i,initPTS:x,timescale:A}))}if(v&&E){T&&v.type==="audiovideo"&&this.logMuxedErr(d);var L=E.fragments[d.sn-1-E.startSN],_=d.sn===E.startSN,k=!L||d.cc>L.cc;if(l.independent!==!1){var R=v.startPTS,b=v.endPTS,D=v.startDTS,C=v.endDTS;if(h)h.elementaryStreams[v.type]={startPTS:R,endPTS:b,startDTS:D,endDTS:C};else if(v.firstKeyFrame&&v.independent&&u.id===1&&!k&&(this.couldBacktrack=!0),v.dropped&&v.independent){var N=this.getMainFwdBufferInfo(),O=(N?N.end:this.getLoadPosition())+this.config.maxBufferHole,M=v.firstKeyFramePTS?v.firstKeyFramePTS:R;if(!_&&O<M-this.config.maxBufferHole&&!k){this.backtrack(d);return}else k&&(d.gap=!0);d.setElementaryStreamInfo(v.type,d.start,b,d.start,C,!0)}else _&&R-(E.appliedTimelineOffset||0)>Cn&&(d.gap=!0);d.setElementaryStreamInfo(v.type,R,b,D,C),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(v,d,h,u,_||k)}else if(_||k)d.gap=!0;else{this.backtrack(d);return}}if(T){var G=T.startPTS,Y=T.endPTS,W=T.startDTS,ie=T.endDTS;h&&(h.elementaryStreams[be.AUDIO]={startPTS:G,endPTS:Y,startDTS:W,endDTS:ie}),d.setElementaryStreamInfo(be.AUDIO,G,Y,W,ie),this.bufferFragmentData(T,d,h,u)}if(E&&m!=null&&(t=m.samples)!=null&&t.length){var xe={id:i,frag:d,details:E,samples:m.samples};s.trigger(p.FRAG_PARSING_METADATA,xe)}if(E&&g){var ue={id:i,frag:d,details:E,samples:g.samples};s.trigger(p.FRAG_PARSING_USERDATA,ue)}},n.logMuxedErr=function(e){this.warn((Se(e)?"Media":"Init")+" segment with muxed audiovideo where only video expected: "+e.url)},n._bufferInitSegment=function(e,t,i,s){var l=this;if(this.state===w.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));var u=t.audio,f=t.video,d=t.audiovideo;if(u){var h=Zr(u.codec,e.audioCodec);h==="mp4a"&&(h="mp4a.40.5");var c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");var v=u.metadata;v&&"channelCount"in v&&(v.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&u.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log("Android: force audio codec to "+h)),e.audioCodec&&e.audioCodec!==h&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+h+'"'),u.levelCodec=h,u.id=K.MAIN,this.log("Init audio buffer, container:"+u.container+", codecs[selected/level/parsed]=["+(h||"")+"/"+(e.audioCodec||"")+"/"+u.codec+"]"),delete t.audiovideo}if(f){f.levelCodec=e.videoCodec,f.id=K.MAIN;var g=f.codec;if((g==null?void 0:g.length)===4)switch(g){case"hvc1":case"hev1":f.codec="hvc1.1.6.L120.90";break;case"av01":f.codec="av01.0.04M.08";break;case"avc1":f.codec="avc1.42e01e";break}this.log("Init video buffer, container:"+f.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+g+"]"+(f.codec!==g?" parsed-corrected="+f.codec:"")+(f.supplemental?" supplemental="+f.supplemental:"")),delete t.audiovideo}d&&(this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+e.codecs+"/"+d.codec+"]"),delete t.video,delete t.audio);var m=Object.keys(t);if(m.length){if(this.hls.trigger(p.BUFFER_CODECS,t),!this.hls)return;m.forEach(function(y){var E=t[y],T=E.initSegment;T!=null&&T.byteLength&&l.hls.trigger(p.BUFFER_APPENDING,{type:y,data:T,frag:i,part:null,chunkMeta:s,parent:i.type})})}this.tickImmediate()}},n.getMainFwdBufferInfo=function(){var e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,K.MAIN)},n.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=w.IDLE},n.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&e.seeking===!1){var i=e.currentTime;if(Ie.isBuffered(e,i)?t=this.getAppendedFrag(i):Ie.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;var s=this.fragPlaying,l=t.level;(!s||t.sn!==s.sn||s.level!==l)&&(this.fragPlaying=t,this.hls.trigger(p.FRAG_CHANGED,{frag:t}),(!s||s.level!==l)&&this.hls.trigger(p.LEVEL_SWITCHED,{level:l}))}}},oe(o,[{key:"hasEnoughToStart",get:function(){return this._hasEnoughToStart}},{key:"maxBufferLength",get:function(){var e=this.levels,t=this.level,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e;if(this.fragPlaying)return this.fragPlaying;var t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return U(t)?this.getAppendedFrag(t):null}},{key:"currentProgramDateTime",get:function(){var e,t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(U(t)){var i=this.getLevelDetails(),s=this.currentFrag||(i?Kr(null,i.fragments,t):null);if(s){var l=s.programDateTime;if(l!==null){var u=l+(t-s.start)*1e3;return new Date(u)}}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])}(La),Jh=function(){function a(n){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=n}var o=a.prototype;return o.abort=function(r){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;if(t){var i;if(r&&r!==((i=t.context)==null?void 0:i.frag.type))return;t.abort()}}},o.detach=function(){for(var r in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[r];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[r]}},o.destroy=function(){this.detach();for(var r in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[r].loader;e&&e.destroy()}this.keyUriToKeyInfo={}},o.createKeyLoadError=function(r,e,t,i,s){return e===void 0&&(e=I.KEY_LOAD_ERROR),new gr({type:B.NETWORK_ERROR,details:e,fatal:!1,frag:r,response:s,error:t,networkDetails:i})},o.loadClear=function(r,e){var t=this;if(this.emeController&&this.config.emeEnabled)for(var i=r.sn,s=r.cc,l=function(){var d=e[u];if(s<=d.cc&&(i==="initSegment"||d.sn==="initSegment"||i<d.sn))return t.emeController.selectKeySystemFormat(d).then(function(h){d.setKeyFormat(h)}),1},u=0;u<e.length&&!l();u++);},o.load=function(r){var e=this;return!r.decryptdata&&r.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(r).then(function(t){return e.loadInternal(r,t)}):this.loadInternal(r)},o.loadInternal=function(r,e){var t,i;e&&r.setKeyFormat(e);var s=r.decryptdata;if(!s){var l=new Error(e?"Expected frag.decryptdata to be defined after setting format "+e:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(r,I.KEY_LOAD_ERROR,l))}var u=s.uri;if(!u)return Promise.reject(this.createKeyLoadError(r,I.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+u+'"')));var f=this.keyUriToKeyInfo[u];if((t=f)!=null&&t.decryptdata.key)return s.key=f.decryptdata.key,Promise.resolve({frag:r,keyInfo:f});if((i=f)!=null&&i.keyLoadPromise){var d;switch((d=f.mediaKeySessionContext)==null?void 0:d.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return f.keyLoadPromise.then(function(h){return s.key=h.keyInfo.decryptdata.key,{frag:r,keyInfo:f}})}}switch(f=this.keyUriToKeyInfo[u]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(f,r):this.loadKeyEME(f,r);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(f,r);default:return Promise.reject(this.createKeyLoadError(r,I.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+s.method+'"')))}},o.loadKeyEME=function(r,e){var t={frag:e,keyInfo:r};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(t);if(i)return(r.keyLoadPromise=i.then(function(s){return r.mediaKeySessionContext=s,t})).catch(function(s){throw r.keyLoadPromise=null,s})}return Promise.resolve(t)},o.loadKeyHTTP=function(r,e){var t=this,i=this.config,s=i.loader,l=new s(i);return e.keyLoader=r.loader=l,r.keyLoadPromise=new Promise(function(u,f){var d={keyInfo:r,frag:e,responseType:"arraybuffer",url:r.decryptdata.uri},h=i.keyLoadPolicy.default,c={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},v={onSuccess:function(m,y,E,T){var S=E.frag,x=E.keyInfo,A=E.url;if(!S.decryptdata||x!==t.keyUriToKeyInfo[A])return f(t.createKeyLoadError(S,I.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));x.decryptdata.key=S.decryptdata.key=new Uint8Array(m.data),S.keyLoader=null,x.loader=null,u({frag:S,keyInfo:x})},onError:function(m,y,E,T){t.resetLoader(y),f(t.createKeyLoadError(e,I.KEY_LOAD_ERROR,new Error("HTTP Error "+m.code+" loading key "+m.text),E,ae({url:d.url,data:void 0},m)))},onTimeout:function(m,y,E){t.resetLoader(y),f(t.createKeyLoadError(e,I.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:function(m,y,E){t.resetLoader(y),f(t.createKeyLoadError(e,I.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};l.load(d,c,v)})},o.resetLoader=function(r){var e=r.frag,t=r.keyInfo,i=r.url,s=t.loader;e.keyLoader===s&&(e.keyLoader=null,t.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()},a}();function wl(a){var o=a.type;switch(o){case re.AUDIO_TRACK:return K.AUDIO;case re.SUBTITLE_TRACK:return K.SUBTITLE;default:return K.MAIN}}function os(a,o){var n=a.url;return(n===void 0||n.indexOf("data:")===0)&&(n=o.url),n}var Zh=function(){function a(n){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=n,this.registerListeners()}var o=a.prototype;return o.startLoad=function(r){},o.stopLoad=function(){this.destroyInternalLoaders()},o.registerListeners=function(){var r=this.hls;r.on(p.MANIFEST_LOADING,this.onManifestLoading,this),r.on(p.LEVEL_LOADING,this.onLevelLoading,this),r.on(p.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(p.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this)},o.unregisterListeners=function(){var r=this.hls;r.off(p.MANIFEST_LOADING,this.onManifestLoading,this),r.off(p.LEVEL_LOADING,this.onLevelLoading,this),r.off(p.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(p.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this)},o.createInternalLoader=function(r){var e=this.hls.config,t=e.pLoader,i=e.loader,s=t||i,l=new s(e);return this.loaders[r.type]=l,l},o.getInternalLoader=function(r){return this.loaders[r.type]},o.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},o.destroyInternalLoaders=function(){for(var r in this.loaders){var e=this.loaders[r];e&&e.destroy(),this.resetInternalLoader(r)}},o.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},o.onManifestLoading=function(r,e){var t=e.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:re.MANIFEST,url:t,deliveryDirectives:null,levelOrTrack:null})},o.onLevelLoading=function(r,e){var t=e.id,i=e.level,s=e.pathwayId,l=e.url,u=e.deliveryDirectives,f=e.levelInfo;this.load({id:t,level:i,pathwayId:s,responseType:"text",type:re.LEVEL,url:l,deliveryDirectives:u,levelOrTrack:f})},o.onAudioTrackLoading=function(r,e){var t=e.id,i=e.groupId,s=e.url,l=e.deliveryDirectives,u=e.track;this.load({id:t,groupId:i,level:null,responseType:"text",type:re.AUDIO_TRACK,url:s,deliveryDirectives:l,levelOrTrack:u})},o.onSubtitleTrackLoading=function(r,e){var t=e.id,i=e.groupId,s=e.url,l=e.deliveryDirectives,u=e.track;this.load({id:t,groupId:i,level:null,responseType:"text",type:re.SUBTITLE_TRACK,url:s,deliveryDirectives:l,levelOrTrack:u})},o.onLevelsUpdated=function(r,e){var t=this.loaders[re.LEVEL];if(t){var i=t.context;i&&!e.levels.some(function(s){return s===i.levelOrTrack})&&(t.abort(),delete this.loaders[re.LEVEL])}},o.load=function(r){var e,t=this,i=this.hls.config,s=this.getInternalLoader(r);if(s){var l=this.hls.logger,u=s.context;if(u&&u.levelOrTrack===r.levelOrTrack&&(u.url===r.url||u.deliveryDirectives&&!r.deliveryDirectives)){u.url===r.url?l.log("[playlist-loader]: ignore "+r.url+" ongoing request"):l.log("[playlist-loader]: ignore "+r.url+" in favor of "+u.url);return}l.log("[playlist-loader]: aborting previous loader for type: "+r.type),s.abort()}var f;if(r.type===re.MANIFEST?f=i.manifestLoadPolicy.default:f=ne({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(r),U((e=r.deliveryDirectives)==null?void 0:e.part)){var d;if(r.type===re.LEVEL&&r.level!==null?d=this.hls.levels[r.level].details:r.type===re.AUDIO_TRACK&&r.id!==null?d=this.hls.audioTracks[r.id].details:r.type===re.SUBTITLE_TRACK&&r.id!==null&&(d=this.hls.subtitleTracks[r.id].details),d){var h=d.partTarget,c=d.targetduration;if(h&&c){var v=Math.max(h*3,c*.8)*1e3;f=ne({},f,{maxTimeToFirstByteMs:Math.min(v,f.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,f.maxTimeToFirstByteMs)})}}}var g=f.errorRetry||f.timeoutRetry||{},m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:g.maxNumRetry||0,retryDelay:g.retryDelayMs||0,maxRetryDelay:g.maxRetryDelayMs||0},y={onSuccess:function(T,S,x,A){var L=t.getInternalLoader(x);t.resetInternalLoader(x.type);var _=T.data;if(_.indexOf("#EXTM3U")!==0){t.handleManifestParsingError(T,x,new Error("no EXTM3U delimiter"),A||null,S);return}S.parsing.start=performance.now(),Ci.isMediaPlaylist(_)||x.type!==re.MANIFEST?t.handleTrackOrLevelPlaylist(T,S,x,A||null,L):t.handleMasterPlaylist(T,S,x,A)},onError:function(T,S,x,A){t.handleNetworkError(S,x,!1,T,A)},onTimeout:function(T,S,x){t.handleNetworkError(S,x,!0,void 0,T)}};s.load(r,m,y)},o.checkAutostartLoad=function(){if(this.hls){var r=this.hls,e=r.config,t=e.autoStartLoad,i=e.startPosition,s=r.forceStartLoad;(t||s)&&(this.hls.logger.log((t?"auto":"force")+" startLoad with configured startPosition "+i),this.hls.startLoad(i))}},o.handleMasterPlaylist=function(r,e,t,i){var s=this.hls,l=r.data,u=os(r,t),f=Ci.parseMasterPlaylist(l,u);if(f.playlistParsingError){this.handleManifestParsingError(r,t,f.playlistParsingError,i,e);return}var d=f.contentSteering,h=f.levels,c=f.sessionData,v=f.sessionKeys,g=f.startTimeOffset,m=f.variableList;this.variableList=m;var y=Ci.parseMasterPlaylistMedia(l,u,f),E=y.AUDIO,T=E===void 0?[]:E,S=y.SUBTITLES,x=y["CLOSED-CAPTIONS"];if(T.length){var A=T.some(function(L){return!L.url});!A&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new et({}),bitrate:0,url:""}))}s.trigger(p.MANIFEST_LOADED,{levels:h,audioTracks:T,subtitles:S,captions:x,contentSteering:d,url:u,stats:e,networkDetails:i,sessionData:c,sessionKeys:v,startTimeOffset:g,variableList:m})},o.handleTrackOrLevelPlaylist=function(r,e,t,i,s){var l=this.hls,u=t.id,f=t.level,d=t.type,h=os(r,t),c=U(f)?f:U(u)?u:0,v=wl(t),g=Ci.parseLevelPlaylist(r.data,h,c,v,0,this.variableList);if(d===re.MANIFEST){var m={attrs:new et({}),bitrate:0,details:g,name:"",url:h};g.requestScheduled=e.loading.start+io(g,0),l.trigger(p.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:h,stats:e,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),t.levelDetails=g,this.handlePlaylistLoaded(g,r,e,t,i,s)},o.handleManifestParsingError=function(r,e,t,i,s){this.hls.trigger(p.ERROR,{type:B.NETWORK_ERROR,details:I.MANIFEST_PARSING_ERROR,fatal:e.type===re.MANIFEST,url:r.url,err:t,error:t,reason:t.message,response:r,context:e,networkDetails:i,stats:s})},o.handleNetworkError=function(r,e,t,i,s){t===void 0&&(t=!1);var l="A network "+(t?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+r.type;r.type===re.LEVEL?l+=": "+r.level+" id: "+r.id:(r.type===re.AUDIO_TRACK||r.type===re.SUBTITLE_TRACK)&&(l+=" id: "+r.id+' group-id: "'+r.groupId+'"');var u=new Error(l);this.hls.logger.warn("[playlist-loader]: "+l);var f=I.UNKNOWN,d=!1,h=this.getInternalLoader(r);switch(r.type){case re.MANIFEST:f=t?I.MANIFEST_LOAD_TIMEOUT:I.MANIFEST_LOAD_ERROR,d=!0;break;case re.LEVEL:f=t?I.LEVEL_LOAD_TIMEOUT:I.LEVEL_LOAD_ERROR,d=!1;break;case re.AUDIO_TRACK:f=t?I.AUDIO_TRACK_LOAD_TIMEOUT:I.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case re.SUBTITLE_TRACK:f=t?I.SUBTITLE_TRACK_LOAD_TIMEOUT:I.SUBTITLE_LOAD_ERROR,d=!1;break}h&&this.resetInternalLoader(r.type);var c={type:B.NETWORK_ERROR,details:f,fatal:d,url:r.url,loader:h,context:r,error:u,networkDetails:e,stats:s};if(i){var v=(e==null?void 0:e.url)||r.url;c.response=ae({url:v,data:void 0},i)}this.hls.trigger(p.ERROR,c)},o.handlePlaylistLoaded=function(r,e,t,i,s,l){var u=this.hls,f=i.type,d=i.level,h=i.id,c=i.groupId,v=i.deliveryDirectives,g=os(e,i),m=wl(i),y=typeof i.level=="number"&&m===K.MAIN?d:void 0;if(!r.fragments.length){var E=r.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(p.ERROR,{type:B.NETWORK_ERROR,details:I.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:E,reason:E.message,response:e,context:i,level:y,parent:m,networkDetails:s,stats:t});return}r.targetduration||(r.playlistParsingError=new Error("Missing Target Duration"));var T=r.playlistParsingError;if(T){if(this.hls.logger.warn(T),!u.config.ignorePlaylistParsingErrors){u.trigger(p.ERROR,{type:B.NETWORK_ERROR,details:I.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:T,reason:T.message,response:e,context:i,level:y,parent:m,networkDetails:s,stats:t});return}r.playlistParsingError=null}switch(r.live&&l&&(l.getCacheAge&&(r.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(r.ageHeader))&&(r.ageHeader=0)),f){case re.MANIFEST:case re.LEVEL:u.trigger(p.LEVEL_LOADED,{details:r,levelInfo:i.levelOrTrack||u.levels[0],level:y||0,id:h||0,stats:t,networkDetails:s,deliveryDirectives:v,withoutMultiVariant:f===re.MANIFEST});break;case re.AUDIO_TRACK:u.trigger(p.AUDIO_TRACK_LOADED,{details:r,track:i.levelOrTrack,id:h||0,groupId:c||"",stats:t,networkDetails:s,deliveryDirectives:v});break;case re.SUBTITLE_TRACK:u.trigger(p.SUBTITLE_TRACK_LOADED,{details:r,track:i.levelOrTrack,id:h||0,groupId:c||"",stats:t,networkDetails:s,deliveryDirectives:v});break}},a}(),Ml=function(){function a(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Kt,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;var r=this.logger=we(n.debug||!1,"Hls instance",n.assetPlayerId),e=this.config=Nh(a.DefaultConfig,n,r);this.userConfig=n,e.progressive&&Uh(e,r);var t=e.abrController,i=e.bufferController,s=e.capLevelController,l=e.errorController,u=e.fpsController,f=new l(this),d=this.abrController=new t(this),h=new ou(this),c=e.interstitialsController,v=c?this.interstitialsController=new c(this,a):null,g=this.bufferController=new i(this,h),m=this.capLevelController=new s(this),y=new u(this),E=new Zh(this),T=e.contentSteeringController,S=T?new T(this):null,x=this.levelController=new jh(this,S),A=new Yh(this),L=new Jh(this.config),_=this.streamController=new $h(this,h,L),k=this.gapController=new Hh(this,h);m.setStreamController(_),y.setStreamController(_);var R=[E,x,_];v&&R.splice(1,0,v),S&&R.splice(1,0,S),this.networkControllers=R;var b=[d,g,k,m,y,A,h];this.audioTrackController=this.createController(e.audioTrackController,R);var D=e.audioStreamController;D&&R.push(this.audioStreamController=new D(this,h,L)),this.subtitleTrackController=this.createController(e.subtitleTrackController,R);var C=e.subtitleStreamController;C&&R.push(this.subtititleStreamController=new C(this,h,L)),this.createController(e.timelineController,b),L.emeController=this.emeController=this.createController(e.emeController,b),this.cmcdController=this.createController(e.cmcdController,b),this.latencyController=this.createController(qh,b),this.coreComponents=b,R.push(f);var N=f.onErrorOut;typeof N=="function"&&this.on(p.ERROR,N,f),this.on(p.MANIFEST_LOADED,E.onManifestLoaded,E)}a.isMSESupported=function(){return Pl()},a.isSupported=function(){return Xh()},a.getMediaSource=function(){return ot()};var o=a.prototype;return o.createController=function(r,e){if(r){var t=new r(this);return e&&e.push(t),t}return null},o.on=function(r,e,t){t===void 0&&(t=this),this._emitter.on(r,e,t)},o.once=function(r,e,t){t===void 0&&(t=this),this._emitter.once(r,e,t)},o.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},o.off=function(r,e,t,i){t===void 0&&(t=this),this._emitter.off(r,e,t,i)},o.listeners=function(r){return this._emitter.listeners(r)},o.emit=function(r,e,t){return this._emitter.emit(r,e,t)},o.trigger=function(r,e){if(this.config.debug)return this.emit(r,r,e);try{return this.emit(r,r,e)}catch(i){if(this.logger.error("An internal error happened while handling event "+r+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;var t=r===p.ERROR;this.trigger(p.ERROR,{type:B.OTHER_ERROR,details:I.INTERNAL_EXCEPTION,fatal:t,event:r,error:i}),this.triggeringException=!1}}return!1},o.listenerCount=function(r){return this._emitter.listenerCount(r)},o.destroy=function(){this.logger.log("destroy"),this.trigger(p.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0;var r=this.config;r.xhrSetup=r.fetchSetup=void 0,this.userConfig=null},o.attachMedia=function(r){if(!r||"media"in r&&!r.media){var e=new Error("attachMedia failed: invalid argument ("+r+")");this.trigger(p.ERROR,{type:B.OTHER_ERROR,details:I.ATTACH_MEDIA_ERROR,fatal:!0,error:e});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());var t="media"in r,i=t?r.media:r,s=t?r:{media:i};this._media=i,this.trigger(p.MEDIA_ATTACHING,s)},o.detachMedia=function(){this.logger.log("detachMedia"),this.trigger(p.MEDIA_DETACHING,{}),this._media=null},o.transferMedia=function(){this._media=null;var r=this.bufferController.transferMedia();return this.trigger(p.MEDIA_DETACHING,{transferMedia:r}),r},o.loadSource=function(r){this.stopLoad();var e=this.media,t=this._url,i=this._url=Ee.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:"+i),e&&t&&(t!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(p.MANIFEST_LOADING,{url:r})},o.startLoad=function(r,e){r===void 0&&(r=-1),this.logger.log("startLoad("+(r+(e?", <skip seek to start>":""))+")"),this.started=!0,this.resumeBuffering();for(var t=0;t<this.networkControllers.length&&(this.networkControllers[t].startLoad(r,e),!(!this.started||!this.networkControllers));t++);},o.stopLoad=function(){this.logger.log("stopLoad"),this.started=!1;for(var r=0;r<this.networkControllers.length&&(this.networkControllers[r].stopLoad(),!(this.started||!this.networkControllers));r++);},o.resumeBuffering=function(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(function(r){r.resumeBuffering&&r.resumeBuffering()}))},o.pauseBuffering=function(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(function(r){r.pauseBuffering&&r.pauseBuffering()}))},o.swapAudioCodec=function(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},o.recoverMediaError=function(){this.logger.log("recoverMediaError");var r=this._media,e=r==null?void 0:r.currentTime;this.detachMedia(),r&&(this.attachMedia(r),e&&this.startLoad(e))},o.removeLevel=function(r){this.levelController.removeLevel(r)},o.setAudioOption=function(r){var e;return((e=this.audioTrackController)==null?void 0:e.setAudioOption(r))||null},o.setSubtitleOption=function(r){var e;return((e=this.subtitleTrackController)==null?void 0:e.setSubtitleOption(r))||null},o.getMediaDecodingInfo=function(r,e){e===void 0&&(e=this.allAudioTracks);var t=Ls(e);return tn(r,t,navigator.mediaCapabilities)},oe(a,[{key:"url",get:function(){return this._url}},{key:"hasEnoughToStart",get:function(){return this.streamController.hasEnoughToStart}},{key:"startPosition",get:function(){return this.streamController.startPositionValue}},{key:"loadingEnabled",get:function(){return this.started}},{key:"bufferingEnabled",get:function(){return this.streamController.bufferingEnabled}},{key:"inFlightFragments",get:function(){var r,e=(r={},r[K.MAIN]=this.streamController.inFlightFrag,r);return this.audioStreamController&&(e[K.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[K.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}},{key:"sessionId",get:function(){var r=this._sessionId;return r||(r=this._sessionId=Gt()),r}},{key:"levels",get:function(){var r=this.levelController.levels;return r||[]}},{key:"latestLevelDetails",get:function(){return this.streamController.getLevelDetails()||null}},{key:"loadLevelObj",get:function(){return this.levelController.loadLevelObj}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){this.logger.log("set currentLevel:"+r),this.levelController.manualLevel=r,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){this.logger.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){this.logger.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){this.logger.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){var r=this.levelController.startLevel;return r===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:r},set:function(r){this.logger.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var e=!!r;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(this.logger.log("set autoLevelCapping:"+r),this._autoLevelCapping=r,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN},set:function(r){this.abrController.resetEstimator(r)}},{key:"abrEwmaDefaultEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.defaultEstimate:NaN}},{key:"ttfbEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(r){oa(r)&&this._maxHdcpLevel!==r&&(this._maxHdcpLevel=r,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,e=this.config.minAutoBitrate;if(!r)return 0;for(var t=r.length,i=0;i<t;i++)if(r[i].maxBitrate>=e)return i;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,e=this.autoLevelCapping,t=this.maxHdcpLevel,i;if(e===-1&&r!=null&&r.length?i=r.length-1:i=e,t)for(var s=i;s--;){var l=r[s].attrs["HDCP-LEVEL"];if(l&&l<=t)return s}return i}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(r){this.abrController.nextAutoLevel=r}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"maxBufferLength",get:function(){return this.streamController.maxBufferLength}},{key:"allAudioTracks",get:function(){var r=this.audioTrackController;return r?r.allAudioTracks:[]}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var e=this.audioTrackController;e&&(e.audioTrack=r)}},{key:"allSubtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var e=this.subtitleTrackController;e&&(e.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return r?r.subtitleDisplay:!1},set:function(r){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency},set:function(r){this.latencyController.targetLatency=r}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}},{key:"pathways",get:function(){return this.levelController.pathways}},{key:"pathwayPriority",get:function(){return this.levelController.pathwayPriority},set:function(r){this.levelController.pathwayPriority=r}},{key:"bufferedToEnd",get:function(){var r;return!!((r=this.bufferController)!=null&&r.bufferedToEnd)}},{key:"interstitialsManager",get:function(){var r;return((r=this.interstitialsController)==null?void 0:r.interstitialsManager)||null}}],[{key:"version",get:function(){return Fi}},{key:"Events",get:function(){return p}},{key:"MetadataSchema",get:function(){return Ht}},{key:"ErrorTypes",get:function(){return B}},{key:"ErrorDetails",get:function(){return I}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:Oh},set:function(r){a.defaultConfig=r}}])}();return Ml.defaultConfig=void 0,Ml})})(!1)}(ps)),ps.exports}var Oc=Mc();const vi=gc(Oc);var Fc=$e('<div class="flex w-full items-center gap-4 py-2"><audio preload="none" class="hidden"></audio> <button> </button> <iconify-icon></iconify-icon> <input type="range" min="0" max="1" step="0.01" class="range range-xs w-full"></div>',2);function Nc(Z,P){Vn(P,!0);const[Ae,Je]=qn(),q=()=>Tr(Xn,"$_",Ae);let J,te=null,oe=Pr(!1),Ct=Pr(.7);As(()=>{P.gameId&&Ke(P.gameId)});async function Ke(He){if(!J)return;te&&(te.destroy(),te=null);const Mt=`${P.url.replace("wss://","https://").replace("ws://","http://").replace("realtime","tts")}/${He}/playlist.m3u8`;vi.isSupported()?(te=new vi({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,xhrSetup(mt){mt.setRequestHeader("ngrok-skip-browser-warning","true")}}),te.loadSource(Mt),te.attachMedia(J),te.on(vi.Events.MANIFEST_PARSED,()=>{console.log("Received HLS manifest"),ne()}),te.on(vi.Events.ERROR,(mt,dt)=>{if(console.error("HLS error:",dt),dt.fatal)switch(dt.type){case vi.ErrorTypes.NETWORK_ERROR:console.log("Network error, trying to recover..."),te==null||te.startLoad();break;case vi.ErrorTypes.MEDIA_ERROR:console.log("Media error, trying to recover..."),te==null||te.recoverMediaError();break;default:console.log("Fatal error, destroying HLS instance"),te==null||te.destroy(),te=null;break}})):J.canPlayType("application/vnd.apple.mpegurl")?(J.src=Mt,ne()):console.error("HLS is not supported in this browser")}function ne(){J&&J.play().then(()=>{Ut(oe,!0),console.log("Audio playback started")}).catch(He=>{console.error("Failed to play audio:",He),Ut(oe,!1)})}function Ve(){J&&(J.pause(),Ut(oe,!1),console.log("Audio playback paused"))}function j(){F(oe)?Ve():ne()}function fe(He){J&&(Ut(Ct,Math.max(0,Math.min(1,He)),!0),J.volume=F(Ct))}function me(){Ut(oe,!0)}function Pe(){Ut(oe,!1)}function ae(){Ut(oe,!1)}jn(()=>{te&&(te.destroy(),te=null)});var Ue=Fc(),Pt=V(Ue);Sr(Pt,He=>J=He,()=>J);var Ze=$(Pt,2);Ze.__click=j;var gt=V(Ze,!0);H(Ze);var at=$(Ze,2);Bt(at,"inline",!0),Bt(at,"icon","mdi:volume");var Gt=$(at,2);Vt(Gt),H(Ue),nt(He=>{Yr(Ze,1,`btn btn-sm ${F(oe)?"btn-error":"btn-success"}`),Ze.disabled=!P.gameId,ve(gt,He)},[()=>F(oe)?q()("audio.stop"):q()("audio.play")]),Yi("play",Pt,me),Yi("pause",Pt,Pe),Yi("ended",Pt,ae),yc(Gt,()=>F(Ct),He=>Ut(Ct,He)),Ne(Z,Ue);var Wt=Wn({toggleAudio:j,updateVolume:fe});return Je(),Wt}Yn(["click"]);function Uc(){Cr.connect()}function Bc(){Cr.disconnect()}async function Gc(){await Cr.loadFromClipboard()}var Kc=$e('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Hc=$e('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Vc=$e('<div class="status status-error"></div>'),Wc=(Z,P)=>P("connection.url",Z.currentTarget.value),Yc=(Z,P)=>P("connection.token",Z.currentTarget.value),qc=(Z,P)=>P("display.canvas.name",Z.currentTarget.checked),jc=(Z,P)=>P("display.canvas.team",Z.currentTarget.checked),Xc=(Z,P)=>P("display.canvas.role",Z.currentTarget.checked),zc=(Z,P)=>P("display.bubble.name",Z.currentTarget.checked),Qc=(Z,P)=>P("display.bubble.team",Z.currentTarget.checked),$c=(Z,P)=>P("display.bubble.role",Z.currentTarget.checked),Jc=(Z,P)=>P("display.text.name",Z.currentTarget.checked),Zc=(Z,P)=>P("display.text.team",Z.currentTarget.checked),ev=(Z,P)=>P("display.text.role",Z.currentTarget.checked),tv=(Z,P)=>P("display.largeScale",Z.currentTarget.checked),rv=$e('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><a class="text-3xl font-bold text-nowrap ml-2" href="./"> </a> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow"> <span class="badge badge-neutral badge-xs"> </span></label> <button class="btn btn-info"> </button> <button class="btn btn-error"> </button> <button class="btn"> </button> <button class="btn"> </button> <dialog class="modal"><div class="modal-box"><div class="form-control my-2"><h3 class="text-lg font-bold"> </h3> <h4 class="text-base font-bold mt-2"> </h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2"> </h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2"> </h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2"> </h4> <label class="label cursor-pointer my-2"><span class="label-text"> </span> <input type="checkbox" class="checkbox"></label> <h4 class="text-base font-bold mt-2"> </h4> <div class="my-2"><!></div></div></div> <form method="dialog" class="modal-backdrop"><button> </button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function iv(Z,P){Vn(P,!0);const[Ae,Je]=qn(),q=()=>Tr(Xn,"$_",Ae);let J=Pr(void 0),te=Pr(void 0);const oe=qr.subscribe(qe=>{Ut(J,qe,!0)}),Ct=Cr.subscribe(qe=>{Ut(te,qe.status,!0)});jn(()=>{oe(),Ct()});function Ke(qe,nr){qr.update(ar=>{const cr=qe.split("."),Dt=cr.pop();let qt=ar;for(const vr of cr)vr&&(qt=qt[vr]);return qt[Dt]=nr,{...ar}})}let ne;var Ve=rv(),j=V(Ve),fe=V(j,!0);H(j);var me=$(j,2),Pe=V(me),ae=V(Pe);{var Ue=qe=>{var nr=Kc();Es(2),Ne(qe,nr)},Pt=(qe,nr)=>{{var ar=Dt=>{var qt=Hc();Es(2),Ne(Dt,qt)},cr=Dt=>{var qt=Vc();Ne(Dt,qt)};Lt(qe,Dt=>{F(te)==="connecting"?Dt(ar):Dt(cr,!1)},nr)}};Lt(ae,qe=>{F(te)==="connected"?qe(Ue):qe(Pt,!1)})}H(Pe),H(me);var Ze=$(me,2),gt=V(Ze);Yr(gt,1,"h-[1em] opacity-50"),Bt(gt,"inline",!0),Bt(gt,"icon","mdi:link");var at=$(gt,2);Vt(at),at.__input=[Wc,Ke],H(Ze);var Gt=$(Ze,2),Wt=V(Gt);Yr(Wt,1,"h-[1em] opacity-50"),Bt(Wt,"inline",!0),Bt(Wt,"icon","mdi:key");var He=$(Wt,2);Vt(He),He.__input=[Yc,Ke];var Mt=$(He,2),mt=V(Mt,!0);H(Mt),H(Gt);var dt=$(Gt,2);dt.__click=[Uc];var Kt=V(dt,!0);H(dt);var pt=$(dt,2);pt.__click=[Bc];var Qt=V(pt,!0);H(pt);var Le=$(pt,2);Le.__click=[Gc];var Ee=V(Le,!0);H(Le);var U=$(Le,2);U.__click=()=>ne.showModal();var Oe=V(U,!0);H(U);var st=$(U,2),B=V(st),I=V(B),p=V(I),re=V(p,!0);H(p);var K=$(p,2),X=V(K,!0);H(K);var pe=$(K,2),he=V(pe),ce=V(he),z=V(ce,!0);H(ce);var se=$(ce,2);Vt(se),se.__change=[qc,Ke],H(he);var Re=$(he,2),bt=V(Re),We=V(bt,!0);H(bt);var we=$(bt,2);Vt(we),we.__change=[jc,Ke],H(Re);var le=$(Re,2),ot=V(le),$t=V(ot,!0);H(ot);var Te=$(ot,2);Vt(Te),Te.__change=[Xc,Ke],H(le),H(pe);var ee=$(pe,2),Me=V(ee,!0);H(ee);var Jt=$(ee,2),be=V(Jt),wt=V(be),Se=V(wt,!0);H(wt);var ht=$(wt,2);Vt(ht),ht.__change=[zc,Ke],H(be);var Rt=$(be,2),yt=V(Rt),Zt=V(yt,!0);H(yt);var lt=$(yt,2);Vt(lt),lt.__change=[Qc,Ke],H(Rt);var xr=$(Rt,2),It=V(xr),De=V(It,!0);H(It);var Yt=$(It,2);Vt(Yt),Yt.__change=[$c,Ke],H(xr),H(Jt);var Q=$(Jt,2),wr=V(Q,!0);H(Q);var er=$(Q,2),Mr=V(er),gi=V(Mr),de=V(gi,!0);H(gi);var mi=$(gi,2);Vt(mi),mi.__change=[Jc,Ke],H(Mr);var jr=$(Mr,2),pi=V(jr),Xr=V(pi,!0);H(pi);var Or=$(pi,2);Vt(Or),Or.__change=[Zc,Ke],H(jr);var Fr=$(jr,2),Ot=V(Fr),zn=V(Ot,!0);H(Ot);var zr=$(Ot,2);Vt(zr),zr.__change=[ev,Ke],H(Fr),H(er);var yi=$(er,2),Qn=V(yi,!0);H(yi);var Ei=$(yi,2),Ti=V(Ei),$n=V(Ti,!0);H(Ti);var _t=$(Ti,2);Vt(_t),_t.__change=[tv,Ke],H(Ei);var Qr=$(Ei,2),$r=V(Qr,!0);H(Qr);var ji=$(Qr,2),Si=V(ji);lc(Si,{}),H(ji),H(I),H(B);var xi=$(B,2),Xi=V(xi),Jn=V(Xi,!0);H(Xi),H(xi),H(st),Sr(st,qe=>ne=qe,()=>ne);var zi=$(st,2),Ai=V(zi);Bt(Ai,"inline",!0),Bt(Ai,"icon","mdi:white-balance-sunny");var Zn=$(Ai,2),Li=$(Zn,2);Bt(Li,"inline",!0),Bt(Li,"icon","mdi:moon-and-stars"),H(zi),H(Ve),nt((qe,nr,ar,cr,Dt,qt,vr,bi,ea,ta,Jr,ra,Zr,ia,na,Qi,$i,Ji,Zi,en,aa,tn,sa,Ri,oa)=>{var Nr,rn,Ur,Ii,_i,Ar,Di,nn,an,sn,Ge,on;ve(fe,qe),qi(at,"placeholder",nr),Vl(at,(Nr=F(J))==null?void 0:Nr.connection.url),qi(He,"placeholder",ar),Vl(He,(rn=F(J))==null?void 0:rn.connection.token),ve(mt,cr),dt.disabled=F(te)!=="disconnected"&&F(te)!=="loaded",ve(Kt,Dt),pt.disabled=F(te)==="disconnected"||F(te)==="loaded",ve(Qt,qt),ve(Ee,vr),ve(Oe,bi),ve(re,ea),ve(X,ta),ve(z,Jr),hr(se,(Ur=F(J))==null?void 0:Ur.display.canvas.name),ve(We,ra),hr(we,(Ii=F(J))==null?void 0:Ii.display.canvas.team),ve($t,Zr),hr(Te,(_i=F(J))==null?void 0:_i.display.canvas.role),ve(Me,ia),ve(Se,na),hr(ht,(Ar=F(J))==null?void 0:Ar.display.bubble.name),ve(Zt,Qi),hr(lt,(Di=F(J))==null?void 0:Di.display.bubble.team),ve(De,$i),hr(Yt,(nn=F(J))==null?void 0:nn.display.bubble.role),ve(wr,Ji),ve(de,Zi),hr(mi,(an=F(J))==null?void 0:an.display.text.name),ve(Xr,en),hr(Or,(sn=F(J))==null?void 0:sn.display.text.team),ve(zn,aa),hr(zr,(Ge=F(J))==null?void 0:Ge.display.text.role),ve(Qn,tn),ve($n,sa),hr(_t,(on=F(J))==null?void 0:on.display.largeScale),ve($r,Ri),ve(Jn,oa)},[()=>q()("appName"),()=>q()("realtime.websocketUrl"),()=>q()("realtime.authKey"),()=>q()("realtime.optional"),()=>q()("realtime.connect"),()=>q()("realtime.disconnect"),()=>q()("realtime.pasteFromClipboard"),()=>q()("realtime.settings"),()=>q()("realtime.displaySettings"),()=>q()("realtime.canvasAgentInfo"),()=>q()("realtime.name"),()=>q()("realtime.teamName"),()=>q()("realtime.role"),()=>q()("realtime.messageBoxAgentInfo"),()=>q()("realtime.name"),()=>q()("realtime.teamName"),()=>q()("realtime.role"),()=>q()("realtime.listAgentInfo"),()=>q()("realtime.name"),()=>q()("realtime.teamName"),()=>q()("realtime.role"),()=>q()("realtime.largeScreen"),()=>q()("realtime.enable"),()=>q()("common.language"),()=>q()("common.close")]),Ne(Z,Ve),Wn(),Je()}Yn(["input","click","change"]);var nv=$e("<option> </option>"),av=$e('<div class="divider"> </div>'),sv=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),ov=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),lv=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),uv=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),fv=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),dv=$e("<!> <button><!></button>",1),hv=$e('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full" role="region"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="flex-1 overflow-y-auto h-full pr-2"><div class="flex flex-col p-2"><!> <select class="w-full select"></select> <div class="list overflow-y-auto flex-1 my-2"><!></div></div></div></div></main>');function kv(Z,P){Vn(P,!0);const[Ae,Je]=qn(),q=()=>Tr(ne,"$selectedId",Ae),J=()=>Tr(Pe,"$entries",Ae),te=()=>Tr(ae,"$status",Ae),oe=()=>Tr(Ve,"$selectedIdx",Ae),Ct=()=>Tr(me,"$currentPacket",Ae),Ke=()=>Tr(Xn,"$_",Ae),ne=Wr(null),Ve=Wr(null);let j=Pr(void 0);const fe={id:"",idx:-1,day:0,is_day:!0,agents:Tc(13),event:"未接続",message:void 0,from_idx:void 0,to_idx:void 0,bubble_idx:void 0},me=Wr(fe),Pe=Wr({}),ae=Wr("");let Ue=Pr(void 0),Pt=Pr(80),Ze=!1,gt=null;function at(){{const X=vc.url.searchParams,pe=X.get("url"),he=X.get("token");pe&&(qr.update(ce=>({...ce,connection:{url:pe??"",token:he??""}})),Cr.connect())}}function Gt(X){X.preventDefault(),X.stopPropagation(),X.dataTransfer&&(X.dataTransfer.dropEffect="copy")}function Wt(X){var he;X.preventDefault(),X.stopPropagation();const pe=(he=X.dataTransfer)==null?void 0:he.files;!pe||pe.length===0||Cr.loadFromFiles(pe)}function He(X){if(!Ze||!gt)return;const pe=gt.getBoundingClientRect(),he=X-pe.left,ce=pe.width;Ut(Pt,Math.min(90,Math.max(10,he/ce*100)),!0)}function Mt(){Ze=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const X=he=>{const ce=he instanceof MouseEvent?he.clientX:he.touches[0].clientX;He(ce)},pe=()=>{Ze=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",X),window.removeEventListener("touchmove",X),window.removeEventListener("mouseup",pe),window.removeEventListener("touchend",pe)};window.addEventListener("mousemove",X),window.addEventListener("touchmove",X),window.addEventListener("mouseup",pe),window.addEventListener("touchend",pe)}ql(()=>{at();const X=Cr.entries.subscribe(se=>{Pe.set(se),ne.update(Re=>{if(Re&&se[Re])return Re;const bt=Object.keys(se);return bt.length>0?bt[0]:null}),Ve.update(()=>{if(!q())return null;const Re=se[q()];return Re&&Re.length>0?Re.length-1:null})}),pe=Cr.subscribe(se=>{ae.set(se.status)}),he=ne.subscribe(se=>{var Re;se&&((Re=J()[se])==null?void 0:Re.length)>0?Ve.set(J()[se].length-1):Ve.set(null)}),ce=qr.subscribe(se=>{Ut(Ue,se,!0)}),z=sc([ne,Ve,Pe],([se,Re,bt])=>{if(!se||Re===null)return fe;const We=bt[se];return!We||Re<0||Re>=We.length?fe:We[Re]}).subscribe(se=>{me.set(se)});jn(()=>{X(),pe(),ce(),he(),z()}),window.addEventListener("beforeunload",se=>{te()==="connected"&&se.preventDefault()}),window.addEventListener("popstate",se=>{te()==="connected"&&se.preventDefault()})});let mt=null;As(()=>{if(mt&&oe()!==null){const X=mt.querySelectorAll("button");oe()>=0&&oe()<X.length&&X[oe()].scrollIntoView({behavior:"smooth",block:"center"})}});var dt=hv();oc(X=>{ac.title="aiwolf-nlp-viewer"});var Kt=V(dt);iv(Kt,{});var pt=$(Kt,2),Qt=V(pt),Le=V(Qt);wc(Le,{get packet(){return Ct()},get focusIdx(){return F(j)},set focusIdx(X){Ut(j,X,!0)}}),H(Qt);var Ee=$(Qt,2);Ee.__mousedown=Mt,Ee.__touchstart=Mt;var U=$(Ee,2),Oe=V(U),st=V(Oe);{var B=X=>{const pe=ys(()=>{var ce;return((ce=F(Ue))==null?void 0:ce.connection.url)??"http://localhost:8080/tts"}),he=ys(()=>q()??"");Nc(X,{get url(){return F(pe)},get gameId(){return F(he)}})};Lt(st,X=>{X(B)})}var I=$(st,2);Ts(I,5,()=>Object.keys(J()),Ss,(X,pe)=>{var he=nv(),ce={},z=V(he,!0);H(he),nt(()=>{ce!==(ce=F(pe))&&(he.value=(he.__value=F(pe))??""),ve(z,F(pe))}),Ne(X,he)}),H(I);var p=$(I,2),re=V(p);{var K=X=>{var pe=Wi(),he=kr(pe);Ts(he,1,()=>J()[q()]||[],Ss,(ce,z,se)=>{var Re=dv(),bt=kr(Re);{var We=Te=>{var ee=av(),Me=V(ee);H(ee),nt(()=>ve(Me,`${F(z).day??""}日目 ${F(z).is_day?"昼":"夜"}`)),Ne(Te,ee)};Lt(bt,Te=>{(se>0&&(F(z).day!==J()[q()][se-1].day||F(z).is_day!==J()[q()][se-1].is_day)||se===0)&&Te(We)})}var we=$(bt,2);we.__click=()=>Ve.set(se);var le=V(we);{var ot=Te=>{var ee=Wi(),Me=kr(ee);{var Jt=wt=>{var Se=sv(),ht=V(Se,!0);H(Se),nt(Rt=>ve(ht,Rt),[()=>Ke()(`realtime.eventTypes.${F(z).event}`,{default:F(z).event})]),Ne(wt,Se)},be=(wt,Se)=>{{var ht=yt=>{var Zt=ov(),lt=kr(Zt),xr=V(lt,!0);H(lt);var It=$(lt,2);Bt(It,"inline",!0),Bt(It,"icon","mdi:skip-forward"),nt(De=>ve(xr,De),[()=>{var De;return At((De=F(Ue))==null?void 0:De.display.text,F(z),F(z).bubble_idx)}]),Ne(yt,Zt)},Rt=(yt,Zt)=>{{var lt=It=>{var De=lv(),Yt=kr(De),Q=V(Yt,!0);H(Yt);var wr=$(Yt,2);Bt(wr,"inline",!0),Bt(wr,"icon","mdi:arrow-u-down-right-bold"),nt(er=>ve(Q,er),[()=>{var er;return At((er=F(Ue))==null?void 0:er.display.text,F(z),F(z).bubble_idx)}]),Ne(It,De)},xr=It=>{var De=uv(),Yt=V(De,!0);H(De),nt(Q=>ve(Yt,Q),[()=>{var Q;return At((Q=F(Ue))==null?void 0:Q.display.text,F(z),F(z).bubble_idx)+"<"+F(z).message}]),Ne(It,De)};Lt(yt,It=>{F(z).message==="Skip"?It(lt):It(xr,!1)},Zt)}};Lt(wt,yt=>{F(z).message==="Over"?yt(ht):yt(Rt,!1)},Se)}};Lt(Me,wt=>{var Se;F(z).event==="囁き"&&F(j)!==void 0&&((Se=F(z).agents.find(ht=>ht.idx===F(j)))==null?void 0:Se.role)!=="WEREWOLF"?wt(Jt):wt(be,!1)})}Ne(Te,ee)},$t=Te=>{var ee=fv(),Me=V(ee);{var Jt=Se=>{var ht=Hl();nt(Rt=>ve(ht,Rt),[()=>{var Rt;return At((Rt=F(Ue))==null?void 0:Rt.display.text,F(z),F(z).from_idx)}]),Ne(Se,ht)},be=(Se,ht)=>{{var Rt=yt=>{var Zt=Hl();nt(lt=>ve(Zt,lt),[()=>{var lt;return At((lt=F(Ue))==null?void 0:lt.display.text,F(z),F(z).to_idx)}]),Ne(yt,Zt)};Lt(Se,yt=>{(F(z).event==="追放"||F(z).event==="襲撃")&&yt(Rt)},ht)}};Lt(Me,Se=>{F(z).event==="投票"||F(z).event==="占い"?Se(Jt):Se(be,!1)})}var wt=$(Me);H(ee),nt(Se=>ve(wt,` ${Se??""}`),[()=>Ke()(`realtime.eventTypes.${F(z).event}`,{default:F(z).event})]),Ne(Te,ee)};Lt(le,Te=>{F(z).event==="トーク"||F(z).event==="囁き"?Te(ot):Te($t,!1)})}H(we),nt(()=>Yr(we,1,`btn ${se===oe()?"btn-primary":""}`)),Ne(ce,Re)}),Ne(X,pe)};Lt(re,X=>{q()&&J()[q()]&&X(K)})}H(p),Sr(p,X=>mt=X,()=>mt),H(Oe),H(U),H(pt),Sr(pt,X=>gt=X,()=>gt),H(dt),nt(()=>xs(Qt,`width: ${F(Pt)??""}%`)),Yi("dragover",pt,Gt),Yi("drop",pt,Wt),hc(I,q,X=>cc(ne,X)),Ne(Z,dt),Wn(),Je()}Yn(["mousedown","touchstart","click"]);export{kv as component};
