import{t as M,a as h,c as je,d as Ze}from"../chunks/CQIKem6B.js";import{p as Ke,h as Te,o as at,t as H,a as Ye,aG as Re,c as s,s as o,g as t,r,aI as Le,y as rt,f as fe,$ as st}from"../chunks/DJzILnW5.js";import{d as qe,s as F}from"../chunks/bj5TrsLi.js";import{i as ee}from"../chunks/bGcRSTrU.js";import{e as Ue,i as Xe}from"../chunks/n8ULSs76.js";import{h as ot}from"../chunks/74kPUpG4.js";import{a as Oe,s as se,r as ce,c as $e,d as de}from"../chunks/GM4Wqstv.js";import{I as Fe,s as He,c as et,d as lt,t as ze}from"../chunks/WWpWeALV.js";import{p as Pe}from"../chunks/BaREKndI.js";import{b as it}from"../chunks/2yTnr3zu.js";import{b as ke}from"../chunks/D1AgY69q.js";import{s as Je,a as ct,b as ut}from"../chunks/CmdMf11p.js";import{p as dt}from"../chunks/DgrBRmGB.js";import{w as Se,d as ft}from"../chunks/B7xs7M_3.js";import{a as Ge,o as nt}from"../chunks/CSRI-F4q.js";/* empty css                */import{b as vt}from"../chunks/BpP5XzSZ.js";function bt(n,e,a,m){var l=n.__styles??(n.__styles={});l[e]!==a&&(l[e]=a,a==null?n.style.removeProperty(e):n.style.setProperty(e,a,""))}class We{static fromJson(e){return _t(JSON.parse(e),Ie("RealtimeSettings"))}static toJson(e){return JSON.stringify(gt(e,Ie("RealtimeSettings")),null,2)}}function ge(n,e,a,m=""){const l=Ve(n),W=m?` on ${m}`:"",b=a?` for key "${a}"`:"";throw Error(`Invalid value${b}${W}. Expected ${l} but got ${JSON.stringify(e)}`)}function Ve(n){return Array.isArray(n)?n.length===2&&n[0]===void 0?`an optional ${Ve(n[1])}`:`one of [${n.map(e=>Ve(e)).join(", ")}]`:typeof n=="object"&&n.literal!==void 0?n.literal:typeof n}function mt(n){if(n.jsonToJS===void 0){const e={};n.props.forEach(a=>e[a.json]={key:a.js,typ:a.typ}),n.jsonToJS=e}return n.jsonToJS}function pt(n){if(n.jsToJSON===void 0){const e={};n.props.forEach(a=>e[a.js]={key:a.json,typ:a.typ}),n.jsToJSON=e}return n.jsToJSON}function Ae(n,e,a,m="",l=""){function W(E,k){return typeof E==typeof k?k:ge(E,k,m,l)}function b(E,k){const P=E.length;for(let L=0;L<P;L++){const z=E[L];try{return Ae(k,z,a)}catch{}}return ge(E,k,m,l)}function A(E,k){return E.indexOf(k)!==-1?k:ge(E.map(P=>Ne(P)),k,m,l)}function B(E,k){return Array.isArray(k)?k.map(P=>Ae(P,E,a)):ge(Ne("array"),k,m,l)}function G(E){if(E===null)return null;const k=new Date(E);return isNaN(k.valueOf())?ge(Ne("Date"),E,m,l):k}function V(E,k,P){if(P===null||typeof P!="object"||Array.isArray(P))return ge(Ne(ne||"object"),P,m,l);const L={};return Object.getOwnPropertyNames(E).forEach(z=>{const ae=E[z],te=Object.prototype.hasOwnProperty.call(P,z)?P[z]:void 0;L[ae.key]=Ae(te,ae.typ,a,z,ne)}),Object.getOwnPropertyNames(P).forEach(z=>{Object.prototype.hasOwnProperty.call(E,z)||(L[z]=Ae(P[z],k,a,z,ne))}),L}if(e==="any")return n;if(e===null)return n===null?n:ge(e,n,m,l);if(e===!1)return ge(e,n,m,l);let ne;for(;typeof e=="object"&&e.ref!==void 0;)ne=e.ref,e=xt[e.ref];return Array.isArray(e)?A(e,n):typeof e=="object"?e.hasOwnProperty("unionMembers")?b(e.unionMembers,n):e.hasOwnProperty("arrayItems")?B(e.arrayItems,n):e.hasOwnProperty("props")?V(a(e),e.additional,n):ge(e,n,m,l):e===Date&&typeof n!="number"?G(n):W(e,n)}function _t(n,e){return Ae(n,e,mt)}function gt(n,e){return Ae(n,e,pt)}function Ne(n){return{literal:n}}function Me(n,e){return{props:n,additional:e}}function Ie(n){return{ref:n}}const xt={RealtimeSettings:Me([{json:"connection",js:"connection",typ:Ie("Connection")},{json:"display",js:"display",typ:Ie("Display")}],!1),Connection:Me([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:Me([{json:"canvas",js:"canvas",typ:Ie("Agent")},{json:"bubble",js:"bubble",typ:Ie("Agent")},{json:"text",js:"text",typ:Ie("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:Me([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},tt={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function ht(){const n=localStorage.getItem("realtime-settings");if(n)try{return We.fromJson(n)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",We.toJson(tt)),tt}const Ee=Se(ht());Ee.subscribe(n=>{localStorage.setItem("realtime-settings",We.toJson(n))});function yt(n){return Array.from({length:n},(e,a)=>({idx:a+1,team:"Undefined",name:Fe(a+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}function $(n,e,a){var l,W;if(a===void 0)return"該当なし";let m=[];return n!=null&&n.name&&m.push(Fe(a)),n!=null&&n.team&&m.push((l=e.agents.find(b=>b.idx===a))==null?void 0:l.team),n!=null&&n.role&&m.push((W=e.agents.find(b=>b.idx===a))==null?void 0:W.role),m.join(" ")}function Be(n,e){return(n||e)&&!(n&&e)}function wt(){const{subscribe:n,update:e}=Se({status:"disconnected",entries:{}});let a=null,m=null;Ee.subscribe(b=>{m=b});function l(){if(!m)return;e(A=>({...A,status:"connecting"}));const b=new URL(m.connection.url);m.connection.token&&b.searchParams.set("token",m.connection.token),a=new WebSocket(b),a.onopen=()=>{e(A=>({...A,status:"connected"}))},a.onclose=()=>{e(A=>({...A,status:"disconnected"})),a=null},a.onerror=()=>{e(A=>({...A,status:"disconnected"})),a=null},a.onmessage=A=>{try{const B=JSON.parse(A.data);e(G=>{const V={...G.entries};return V[B.id]||(V[B.id]=[]),V[B.id].push(B),{...G,entries:V}})}catch(B){console.error("Failed to parse message:",B)}}}function W(){a&&(e(b=>({...b,status:"disconnected"})),a.close(),a=null)}return{subscribe:n,connect:l,disconnect:W,entries:{subscribe:b=>n(A=>b(A.entries))}}}const Ce=wt();var kt=M('<div role="alert" class="alert m-4"><span class="text-lg font-bold"> </span></div>'),St=M('<pre class="base-content w-2/5 text-5xl font-bold opacity-70 absolute top-0 left-0 -mt-4 ml-8 select-none"> <br> <br> </pre>'),It=(n,e,a)=>{t(e)===t(a).idx?Te(e,void 0):Te(e,Pe(t(a).idx))},jt=M('<div class="absolute inset-0 flex items-center justify-center"><pre class="text-9xl font-bold opacity-75 select-none"> </pre></div>'),Tt=M('<pre class="base-content select-none"> </pre>'),Et=M('<pre class="base-content text-2xl mt-2 select-none"> </pre>'),Ot=M('<pre class="base-content select-none"> </pre>'),At=M('<pre class="base-content text-2xl mt-2 select-none"> </pre>'),Ct=M('<pre class="base-content select-none"> </pre>'),Rt=M('<div class="absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-x72s6v"><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"> <!></button></div></div> <!> <!> <!></div>'),Pt=M('<div class="h-full flex flex-col"><div class="bg-secondary"></div> <!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><span>イラスト : 石黒正数氏</span></aside></footer></div>');function Dt(n,e){Ke(e,!0);let a=Re(void 0);const m=Ee.subscribe(i=>{Te(a,Pe(i))});Ge(m);let l=Re(void 0),W=rt(()=>{var i,c,R,x,S,g,f,d,p,y,u,v,O;switch(e.packet.event){case"未接続":return"未接続";case"トーク":case"囁き":return e.packet.message;case"襲撃投票":return Be(t(l)===void 0,e.packet.fromIdx===t(l))?`${$((i=t(a))==null?void 0:i.display.bubble,e.packet,e.packet.fromIdx)} が ${$((c=t(a))==null?void 0:c.display.bubble,e.packet,e.packet.toIdx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return Be(t(l)===void 0,e.packet.fromIdx===t(l))?`${$((R=t(a))==null?void 0:R.display.bubble,e.packet,e.packet.fromIdx)} が ${$((x=t(a))==null?void 0:x.display.bubble,e.packet,e.packet.toIdx)} に投票しました`:`${$((S=t(a))==null?void 0:S.display.bubble,e.packet,e.packet.fromIdx)} が投票しました`;case"追放":return e.packet.toIdx===void 0?"誰も追放されませんでした":`${$((g=t(a))==null?void 0:g.display.bubble,e.packet,e.packet.toIdx)} を追放しました`;case"襲撃":return e.packet.toIdx===void 0?"誰も襲撃されませんでした":e.packet.fromIdx===-1?`${$((f=t(a))==null?void 0:f.display.bubble,e.packet,e.packet.toIdx)} が襲撃されましたが、護衛されました`:`${$((d=t(a))==null?void 0:d.display.bubble,e.packet,e.packet.toIdx)} が襲撃されました`;case"占い":return Be(t(l)===void 0,e.packet.fromIdx===t(l))?`${$((p=t(a))==null?void 0:p.display.bubble,e.packet,e.packet.fromIdx)} が ${$((y=t(a))==null?void 0:y.display.bubble,e.packet,e.packet.toIdx)} を占った結果、${lt((u=e.packet.agents.find(D=>D.idx===e.packet.toIdx))==null?void 0:u.role)} でした`:"占いました";case"護衛":return Be(t(l)===void 0,e.packet.fromIdx===t(l))?`${$((v=t(a))==null?void 0:v.display.bubble,e.packet,e.packet.fromIdx)} が ${$((O=t(a))==null?void 0:O.display.bubble,e.packet,e.packet.toIdx)} を護衛対象にしました`:"護衛しました";case"終了":return e.packet.message+" が勝利しました";default:return}}),b,A,B,G,V;nt(()=>(window.addEventListener("resize",ne),()=>{window.removeEventListener("resize",ne)})),at(()=>{ne()});function ne(){if(!A||!B||!b)return;const i=b.getBoundingClientRect();if([A,B].forEach(S=>{S.width=i.width,S.height=i.height;const g=S.getContext("2d");g&&(g.clearRect(0,0,S.width,S.height),g.globalAlpha=1,g.lineWidth=2)}),t(l)!==void 0&&(e.packet.event==="占い"&&e.packet.fromIdx!==t(l)||e.packet.event==="投票"&&e.packet.fromIdx!==t(l)||e.packet.event==="襲撃投票"&&e.packet.fromIdx!==t(l)))return;const c=A.getContext("2d"),R=B.getContext("2d");if(!c||!R)return;const x=B.getBoundingClientRect();if(e.packet.fromIdx!==void 0&&e.packet.toIdx!==void 0){const S=document.getElementById(`agent-${e.packet.fromIdx}`);if(!(S instanceof HTMLElement))return;const g=S.getBoundingClientRect(),f=g.left+g.width/2-x.left,d=g.top+g.height/2-x.top,p=document.getElementById(`agent-${e.packet.toIdx}`);if(!(p instanceof HTMLElement))return;const y=p.getBoundingClientRect();E(R,f,d,y.left+y.width/2-x.left,y.top+y.height/2-x.top,!1,getComputedStyle(V).getPropertyValue("background-color"))}if(e.packet.bubbleIdx!==void 0){const S=document.getElementById(`agent-${e.packet.bubbleIdx}`);if(!(S instanceof HTMLElement))return;const g=S.getBoundingClientRect(),f=g.left+g.width/2-x.left,d=g.top+g.height/2-x.top;E(c,x.width/2,x.height/2,f,d,!0,getComputedStyle(G).getPropertyValue("background-color"))}}function E(i,c,R,x,S,g,f){const d=g?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];i.strokeStyle=i.fillStyle=f,i.beginPath();let p=x-c,y=S-R,u=Math.sqrt(p*p+y*y),v=y/u,O=p/u,D=[];D.push(0,0);for(let I=0;I<d.length;I+=2){let U=d[I],w=d[I+1];D.push(U<0?u+U:U,w)}D.push(u,0);for(let I=d.length;I>0;I-=2){let U=d[I-2],w=d[I-1];D.push(U<0?u+U:U,-w)}D.push(0,0);for(let I=0;I<D.length;I+=2){let U=D[I]*O-D[I+1]*v+c,w=D[I]*v+D[I+1]*O+R;I===0?i.moveTo(U,w):i.lineTo(U,w)}i.fill()}var k=Pt(),P=s(k);ke(P,i=>V=i,()=>V);var L=o(P,2);{var z=i=>{var c=kt(),R=s(c),x=s(R);r(R),r(c),H(()=>F(x,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}
        ${e.packet.event??""}フェーズ`)),h(i,c)};ee(L,i=>{var c;(c=t(a))!=null&&c.display.largeScale||i(z)})}var ae=o(L,2),te=s(ae),xe=s(te);{var he=i=>{var c=St(),R=s(c),x=o(R,2,!0),S=o(x,2,!0);r(c),H(()=>{F(R,`${e.packet.day??""}日目`),F(x,e.packet.isDay?"昼":"夜"),F(S,e.packet.event)}),h(i,c)};ee(xe,i=>{var c;(c=t(a))!=null&&c.display.largeScale&&i(he)})}var ve=o(xe,2);ke(ve,i=>A=i,()=>A);var be=o(ve,2);ke(be,i=>B=i,()=>B);var oe=o(be,2),me=s(oe),ue=s(me),ye=s(ue,!0);r(ue),r(me),r(oe),ke(oe,i=>G=i,()=>G);var pe=o(oe,2);Ue(pe,17,()=>e.packet.agents,Xe,(i,c,R)=>{var x=Rt(),S=s(x),g=s(S),f=s(g);f.__click=[It,l,c];var d=s(f),p=o(d,2);{var y=w=>{var _=jt(),K=s(_),X=s(K,!0);r(K),r(_),H(()=>F(X,t(c).idx)),h(w,_)};ee(p,w=>{var _,K;(_=t(a))!=null&&_.display.largeScale&&((K=t(a))!=null&&K.display.canvas.name)&&w(y)})}r(f),r(g),r(S);var u=o(S,2);{var v=w=>{var _=Tt(),K=s(_,!0);r(_),H(X=>F(K,X),[()=>Fe(t(c).idx)]),h(w,_)};ee(u,w=>{var _,K;!((_=t(a))!=null&&_.display.largeScale)&&((K=t(a))!=null&&K.display.canvas.name)&&w(v)})}var O=o(u,2);{var D=w=>{var _=je(),K=fe(_);{var X=J=>{var j=Et(),re=s(j,!0);r(j),H(()=>F(re,t(c).team)),h(J,j)},Q=J=>{var j=Ot(),re=s(j,!0);r(j),H(()=>F(re,t(c).team)),h(J,j)};ee(K,J=>{var j;(j=t(a))!=null&&j.display.largeScale?J(X):J(Q,!1)})}h(w,_)};ee(O,w=>{var _;(_=t(a))!=null&&_.display.canvas.team&&w(D)})}var I=o(O,2);{var U=w=>{var _=je(),K=fe(_);{var X=J=>{var j=At(),re=s(j,!0);r(j),H(()=>F(re,t(c).role)),h(J,j)},Q=J=>{var j=Ct(),re=s(j,!0);r(j),H(()=>F(re,t(c).role)),h(J,j)};ee(K,J=>{var j;(j=t(a))!=null&&j.display.largeScale?J(X):J(Q,!1)})}h(w,_)};ee(I,w=>{var _;(_=t(a))!=null&&_.display.canvas.role&&(t(c).idx===t(l)||t(l)===void 0)&&w(U)})}r(x),H(w=>{var _;Oe(x,"style",`--angle: ${R*(360/e.packet.agents.length)}`),Oe(x,"id",`agent-${t(c).idx??""}`),ze(x,"bg-focus",t(c).idx===t(l)),He(g,et((_=t(a))!=null&&_.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-x72s6v"),ze(g,"ring-success",t(c).isAlive),ze(g,"ring-error",!t(c).isAlive),bt(g,"opacity",t(c).isAlive?1:.25),Oe(d,"src",`${vt??""}/images/male/${w??""}.png`),Oe(d,"alt",t(c).name)},[()=>t(c).idx.toString().padStart(2,"0")]),h(i,x)}),r(te),ke(te,i=>b=i,()=>b),r(ae),Le(2),r(k),H(()=>{var i;oe.hidden=!t(W),He(ue,et((i=t(a))!=null&&i.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center"),"svelte-x72s6v"),F(ye,t(W))}),h(n,k),Ye()}qe(["click"]);function Jt(){Ce.connect()}function Lt(){Ce.disconnect()}var Nt=M('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Mt=M('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Bt=M('<div class="status status-error"></div>'),zt=(n,e)=>e("connection.url",n.currentTarget.value),Ut=(n,e)=>e("connection.token",n.currentTarget.value),Xt=(n,e)=>e("display.canvas.name",n.currentTarget.checked),Ht=(n,e)=>e("display.canvas.team",n.currentTarget.checked),Wt=(n,e)=>e("display.canvas.role",n.currentTarget.checked),Vt=(n,e)=>e("display.bubble.name",n.currentTarget.checked),Kt=(n,e)=>e("display.bubble.team",n.currentTarget.checked),Yt=(n,e)=>e("display.bubble.role",n.currentTarget.checked),qt=(n,e)=>e("display.text.name",n.currentTarget.checked),Ft=(n,e)=>e("display.text.team",n.currentTarget.checked),Gt=(n,e)=>e("display.text.role",n.currentTarget.checked),Qt=(n,e)=>e("display.largeScale",n.currentTarget.checked),Zt=M('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">表示設定</h3> <h4 class="text-base font-bold mt-4">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function $t(n,e){Ke(e,!0);let a=Re(void 0),m=Re(void 0);const l=Ee.subscribe(C=>{Te(a,Pe(C))}),W=Ce.subscribe(C=>{Te(m,Pe(C.status))});Ge(()=>{l(),W()});function b(C,N){Ee.update(Y=>{const Z=C.split("."),le=Z.pop();let T=Y;for(const q of Z)q&&(T=T[q]);return T[le]=N,{...Y}})}let A;var B=Zt(),G=o(s(B),2),V=s(G),ne=s(V);{var E=C=>{var N=Nt();Le(2),h(C,N)},k=C=>{var N=je(),Y=fe(N);{var Z=T=>{var q=Mt();Le(2),h(T,q)},le=T=>{var q=Bt();h(T,q)};ee(Y,T=>{t(m)==="connecting"?T(Z):T(le,!1)},!0)}h(C,N)};ee(ne,C=>{t(m)==="connected"?C(E):C(k,!1)})}r(V),r(G);var P=o(G,2),L=s(P);se(L,"class","h-[1em] opacity-50"),se(L,"inline",!0),se(L,"icon","mdi:link");var z=o(L,2);ce(z),z.__input=[zt,b],r(P);var ae=o(P,2),te=s(ae);se(te,"class","h-[1em] opacity-50"),se(te,"inline",!0),se(te,"icon","mdi:key");var xe=o(te,2);ce(xe),xe.__input=[Ut,b],Le(2),r(ae);var he=o(ae,2);he.__click=[Jt];var ve=o(he,2);ve.__click=[Lt];var be=o(ve,2);be.__click=()=>A.showModal();var oe=o(be,2),me=s(oe),ue=s(me),ye=o(s(ue),4),pe=s(ye),i=o(s(pe),2);ce(i),i.__change=[Xt,b],r(pe);var c=o(pe,2),R=o(s(c),2);ce(R),R.__change=[Ht,b],r(c);var x=o(c,2),S=o(s(x),2);ce(S),S.__change=[Wt,b],r(x),r(ye);var g=o(ye,4),f=s(g),d=o(s(f),2);ce(d),d.__change=[Vt,b],r(f);var p=o(f,2),y=o(s(p),2);ce(y),y.__change=[Kt,b],r(p);var u=o(p,2),v=o(s(u),2);ce(v),v.__change=[Yt,b],r(u),r(g);var O=o(g,4),D=s(O),I=o(s(D),2);ce(I),I.__change=[qt,b],r(D);var U=o(D,2),w=o(s(U),2);ce(w),w.__change=[Ft,b],r(U);var _=o(U,2),K=o(s(_),2);ce(K),K.__change=[Gt,b],r(_),r(O);var X=o(O,4),Q=o(s(X),2);ce(Q),Q.__change=[Qt,b],r(X),r(ue),r(me),Le(2),r(oe),ke(oe,C=>A=C,()=>A);var J=o(oe,2),j=s(J);se(j,"inline",!0),se(j,"icon","mdi:white-balance-sunny");var re=o(j,4);se(re,"inline",!0),se(re,"icon","mdi:moon-and-stars"),r(J),r(B),H(()=>{var C,N,Y,Z,le,T,q,ie,_e,De,we,Qe;$e(z,(C=t(a))==null?void 0:C.connection.url),$e(xe,(N=t(a))==null?void 0:N.connection.token),he.disabled=t(m)!=="disconnected",ve.disabled=t(m)==="disconnected",de(i,(Y=t(a))==null?void 0:Y.display.canvas.name),de(R,(Z=t(a))==null?void 0:Z.display.canvas.team),de(S,(le=t(a))==null?void 0:le.display.canvas.role),de(d,(T=t(a))==null?void 0:T.display.bubble.name),de(y,(q=t(a))==null?void 0:q.display.bubble.team),de(v,(ie=t(a))==null?void 0:ie.display.bubble.role),de(I,(_e=t(a))==null?void 0:_e.display.text.name),de(w,(De=t(a))==null?void 0:De.display.text.team),de(K,(we=t(a))==null?void 0:we.display.text.role),de(Q,(Qe=t(a))==null?void 0:Qe.display.largeScale)}),h(n,B),Ye()}qe(["input","click","change"]);var en=M("<option> </option>"),tn=M('<div class="divider"> </div>'),nn=M('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),an=M('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),rn=M('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),sn=M('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),on=M("<!> <button><!></button>",1),ln=M('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="overflow-y-auto pl-2 h-full"><div class="flex flex-col p-2"><select class="w-full select"></select> <ul class="list overflow-y-auto flex-1 my-2"><!></ul></div></div></div></main>');function jn(n,e){Ke(e,!0);const[a,m]=ct(),l=()=>Je(G,"$selectedId",a),W=()=>Je(k,"$entries",a),b=()=>Je(P,"$status",a),A=()=>Je(E,"$currentPacket",a),B=()=>Je(V,"$selectedIdx",a),G=Se(null),V=Se(null),ne={id:"",idx:-1,day:0,isDay:!0,agents:yt(5),event:"未接続",message:void 0,fromIdx:void 0,toIdx:void 0,bubbleIdx:void 0},E=Se(ne),k=Se({}),P=Se("");let L=Re(void 0),z=Re(80),ae=!1,te=null;function xe(){{const f=dt.url.searchParams,d=f.get("url"),p=f.get("token");d&&(Ee.update(y=>({...y,connection:{url:d??"",token:p??""}})),Ce.connect())}}function he(f){if(!ae||!te)return;const d=te.getBoundingClientRect(),p=f-d.left,y=d.width;Te(z,Pe(Math.min(90,Math.max(10,p/y*100))))}function ve(){ae=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const f=p=>{const y=p instanceof MouseEvent?p.clientX:p.touches[0].clientX;he(y)},d=()=>{ae=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",f),window.removeEventListener("touchmove",f),window.removeEventListener("mouseup",d),window.removeEventListener("touchend",d)};window.addEventListener("mousemove",f),window.addEventListener("touchmove",f),window.addEventListener("mouseup",d),window.addEventListener("touchend",d)}nt(()=>{xe();const f=Ce.entries.subscribe(v=>{k.set(v),G.update(O=>O||Object.keys(v)[0]),V.update(()=>l()?v[l()].length-1:null)}),d=Ce.subscribe(v=>{P.set(v.status)}),p=G.subscribe(v=>{var O;v&&((O=W()[v])==null?void 0:O.length)>0?V.set(W()[v].length-1):V.set(null)}),y=Ee.subscribe(v=>{Te(L,Pe(v))}),u=ft([G,V,k],([v,O,D])=>{if(!v||O===null)return ne;const I=D[v];return!I||O<0||O>=I.length?ne:I[O]}).subscribe(v=>{E.set(v)});Ge(()=>{f(),d(),y(),p(),u()}),window.addEventListener("beforeunload",v=>{b()==="connected"&&v.preventDefault()}),window.addEventListener("popstate",v=>{b()==="connected"&&v.preventDefault()})});var be=ln();ot(f=>{st.title="aiwolf-nlp-viewer"});var oe=s(be);$t(oe,{});var me=o(oe,2),ue=s(me),ye=s(ue);Dt(ye,{get packet(){return A()}}),r(ue);var pe=o(ue,2);pe.__mousedown=ve,pe.__touchstart=ve;var i=o(pe,2),c=s(i),R=s(c);Ue(R,5,()=>Object.keys(W()),Xe,(f,d)=>{var p=en(),y={},u=s(p,!0);r(p),H(()=>{y!==(y=t(d))&&(p.value=(p.__value=t(d))==null?"":t(d)),F(u,t(d))}),h(f,p)}),r(R);var x=o(R,2),S=s(x);{var g=f=>{var d=je(),p=fe(d);Ue(p,1,()=>W()[l()]||[],Xe,(y,u,v)=>{var O=on(),D=fe(O);{var I=X=>{var Q=tn(),J=s(Q);r(Q),H(()=>F(J,`${t(u).day??""}日目 ${(t(u).isDay?"昼":"夜")??""}`)),h(X,Q)};ee(D,X=>{(v>0&&(t(u).day!==W()[l()][v-1].day||t(u).isDay!==W()[l()][v-1].isDay)||v===0)&&X(I)})}var U=o(D,2);U.__click=()=>V.set(v);var w=s(U);{var _=X=>{var Q=je(),J=fe(Q);{var j=C=>{var N=nn(),Y=fe(N),Z=s(Y,!0);r(Y);var le=o(Y,2);se(le,"inline",!0),se(le,"icon","mdi:skip-forward"),H(T=>F(Z,T),[()=>{var T;return $((T=t(L))==null?void 0:T.display.text,t(u),t(u).bubbleIdx)}]),h(C,N)},re=C=>{var N=je(),Y=fe(N);{var Z=T=>{var q=an(),ie=fe(q),_e=s(ie,!0);r(ie);var De=o(ie,2);se(De,"inline",!0),se(De,"icon","mdi:arrow-u-down-right-bold"),H(we=>F(_e,we),[()=>{var we;return $((we=t(L))==null?void 0:we.display.text,t(u),t(u).bubbleIdx)}]),h(T,q)},le=T=>{var q=rn(),ie=s(q,!0);r(q),H(_e=>F(ie,_e),[()=>{var _e;return $((_e=t(L))==null?void 0:_e.display.text,t(u),t(u).bubbleIdx)+"<"+t(u).message}]),h(T,q)};ee(Y,T=>{t(u).message==="Skip"?T(Z):T(le,!1)},!0)}h(C,N)};ee(J,C=>{t(u).message==="Over"?C(j):C(re,!1)})}h(X,Q)},K=X=>{var Q=sn(),J=s(Q);{var j=N=>{var Y=Ze();H(Z=>F(Y,Z),[()=>{var Z;return $((Z=t(L))==null?void 0:Z.display.text,t(u),t(u).fromIdx)}]),h(N,Y)},re=N=>{var Y=je(),Z=fe(Y);{var le=T=>{var q=Ze();H(ie=>F(q,ie),[()=>{var ie;return $((ie=t(L))==null?void 0:ie.display.text,t(u),t(u).toIdx)}]),h(T,q)};ee(Z,T=>{(t(u).event==="追放"||t(u).event==="襲撃")&&T(le)},!0)}h(N,Y)};ee(J,N=>{t(u).event==="投票"||t(u).event==="占い"?N(j):N(re,!1)})}var C=o(J);r(Q),H(()=>F(C,` ${t(u).event??""}`)),h(X,Q)};ee(w,X=>{t(u).event==="トーク"||t(u).event==="囁き"?X(_):X(K,!1)})}r(U),H(()=>He(U,`btn ${(v===B()?"btn-primary":"")??""}`)),h(y,O)}),h(f,d)};ee(S,f=>{l()&&f(g)})}r(x),r(c),r(i),r(me),ke(me,f=>te=f,()=>te),r(be),H(()=>{Oe(ue,"style",`width: ${t(z)??""}%`),Oe(i,"style",`width: ${100-t(z)-.5}%;`)}),it(R,l,f=>ut(G,f)),h(n,be),Ye(),m()}qe(["mousedown","touchstart","click"]);export{jn as component};
