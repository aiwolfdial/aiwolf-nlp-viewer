import{t as j,a as z,d as ve}from"../chunks/INsZfON2.js";import"../chunks/CWgvtMZ3.js";import{aI as ue,q as fe,ap as me,h as ge,z as ee,ah as oe,D as N,A as te,c as u,s as x,v as e,C as L,r as v,B as P,L as pe,aJ as be,$ as he}from"../chunks/BLOI8AtL.js";import{s as X}from"../chunks/C8CAJf1e.js";import{e as le,i as ce,s as U,a as I,r as se}from"../chunks/Bvh40Bt5.js";import{l as _e,e as Q,h as ye}from"../chunks/B2hL6-jM.js";import{i as ae}from"../chunks/Dss2tMcf.js";import{o as xe,a as we,b as de}from"../chunks/C-8kF91x.js";import{i as Z}from"../chunks/DpaHipqp.js";import{t as ne,I as ke}from"../chunks/C9BACT8Z.js";import{p as Ce,b as K}from"../chunks/D6mpIuce.js";import{b as Se}from"../chunks/CKWB6iru.js";import{w as ie}from"../chunks/DKjsTKSq.js";/* empty css                */function $e(t,r,a,h){var s=t.__styles??(t.__styles={});s[r]!==a&&(s[r]=a,a==null?t.style.removeProperty(r):t.style.setProperty(r,a,""))}function re(t,r,a=r){var h=ue();_e(t,"input",s=>{var f=s?t.defaultValue:t.value;if(f=F(t)?G(f):f,a(f),h&&f!==(f=r())){var E=t.selectionStart,C=t.selectionEnd;t.value=f??"",C!==null&&(t.selectionStart=E,t.selectionEnd=Math.min(C,t.value.length))}}),(ge&&t.defaultValue!==t.value||fe(r)==null&&t.value)&&a(F(t)?G(t.value):t.value),me(()=>{var s=r();F(t)&&s===G(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function F(t){var r=t.type;return r==="number"||r==="range"}function G(t){return t===""?null:+t}var Ae=j('<div class="card bg-base-100 card-xs shadow-sm overflow-auto p-4 z-1" style="width: 50%;  max-height: 30%;"><div class="card-body"><p class="text-lg text-pretty"> </p></div></div>'),Ee=j('<div class="agent svelte-t9pq5i"><div class="avatar"><div class="w-24 rounded-full"><img></div></div> <span class="badge mt-2"> </span></div>'),Te=j('<div role="alert" class="alert"><span> </span></div> <div class="circle svelte-t9pq5i"><canvas class="message-canvas svelte-t9pq5i"></canvas> <canvas class="arrow-canvas svelte-t9pq5i"></canvas> <!> <!></div>',1);function Be(t,r){ee(r,!1);let a=Ce(r,"packet",24,()=>({id:"",idx:0,day:0,isDay:!0,agents:[],message:"",summary:"",isDivider:!1})),h=L(),s=L(),f=L(),E=L();xe(()=>(window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C)})),we(()=>{C()});function C(){if(!e(h)||!e(s)||!e(f))return;const n=e(h).getContext("2d"),o=e(s).getContext("2d");if(!n||!o)return;const S=e(f).getBoundingClientRect();[e(h),e(s)].forEach(l=>{l.width=S.width,l.height=S.height;const p=l.getContext("2d");p&&(p.clearRect(0,0,l.width,l.height),p.globalAlpha=(l===e(h),1),p.lineWidth=2)}),a().agents.forEach(l=>{const{idx:p,targetIdxs:d=[],isAlive:B,isBubble:$}=l;if(!B)return;const q=document.getElementById(`agent-${p}`);if(!(q instanceof HTMLElement))return;const T=q.getBoundingClientRect(),b=e(s).getBoundingClientRect(),V=T.left+T.width/2-b.left,J=T.top+T.height/2-b.top;d.forEach(A=>{if(A===-1)return;const m=document.getElementById(`agent-${A}`);if(!(m instanceof HTMLElement))return;const k=m.getBoundingClientRect();i(o,V,J,k.left+k.width/2-b.left,k.top+k.height/2-b.top,!1,getComputedStyle(e(E)).getPropertyValue("background-color"))}),$&&i(n,b.width/2,b.height/2,V,J,!0,getComputedStyle(e(E)).getPropertyValue("background-color"))})}function i(n,o,S,l,p,d=!1,B="#001fcc"){const $=d?[0,0,0,0,0,15]:[0,5,-20,5,-20,15];n.strokeStyle=n.fillStyle=B,n.beginPath();let q=l-o,T=p-S,b=Math.sqrt(q*q+T*T),V=T/b,J=q/b,A=[];A.push(0,0);for(let m=0;m<$.length;m+=2){let k=$[m],H=$[m+1];A.push(k<0?b+k:k,H)}A.push(b,0);for(let m=$.length;m>0;m-=2){let k=$[m-2],H=$[m-1];A.push(k<0?b+k:k,-H)}A.push(0,0);for(let m=0;m<A.length;m+=2){let k=A[m]*J-A[m+1]*V+o,H=A[m]*V+A[m+1]*J+S;m===0?n.moveTo(k,H):n.lineTo(k,H)}n.fill()}ae();var c=Te(),_=oe(c),g=u(_),M=u(g);v(g),v(_);var R=x(_,2),D=u(R);K(D,n=>P(h,n),()=>e(h));var y=x(D,2);K(y,n=>P(s,n),()=>e(s));var w=x(y,2);{var O=n=>{var o=Ae(),S=u(o),l=u(S),p=u(l,!0);v(l),v(S),v(o),K(o,d=>P(E,d),()=>e(E)),N(()=>X(p,a().message)),z(n,o)};Z(w,n=>{a().message!==""&&n(O)})}var W=x(w,2);le(W,1,()=>a().agents,ce,(n,o,S)=>{var l=Ee(),p=u(l),d=u(p),B=u(d);v(d),v(p);var $=x(p,2),q=u($,!0);v($),v(l),N(T=>{U(l,"style",`--angle: ${S*(360/a().agents.length)}`),U(l,"id",`agent-${e(o).idx??""}`),ne(p,"avatar-online",e(o).isAlive),ne(p,"avatar-offline",!e(o).isAlive),$e(d,"opacity",e(o).isAlive?1:.25),U(B,"src",`${Se??""}/images/male/${T??""}.png`),U(B,"alt",e(o).name),X(q,e(o).name)},[()=>e(o).idx.toString().padStart(2,"0")],pe),z(n,l)}),v(R),K(R,n=>P(f,n),()=>e(f)),N(()=>X(M,`${a().id??""}
    ${a().idx??""}
    ${a().day??""}日目 ${(a().isDay?"昼":"夜")??""}
    ${a().summary??""}`)),z(t,c),te()}function Re(){const{subscribe:t,update:r}=ie({status:"disconnected",url:"",token:"",socket:null,reconnectTimer:null}),a=ie({});function h(){r(i=>{if(i.reconnectTimer)return i;const c=setInterval(()=>{f(i.url,i.token)},3e3);return{...i,status:"attempting",reconnectTimer:c}})}function s(i){try{const c=JSON.parse(i.data);a.update(_=>{const g={..._};return g[c.id]||(g[c.id]=[]),g[c.id].push(c),g})}catch{}}function f(i,c){r(_=>{_.socket&&_.socket.close();const g=new WebSocket(i+(c!==""?"?token="+c:""));return g.onopen=()=>{r(M=>({...M,status:"connected",reconnectTimer:null}))},g.onclose=h,g.onerror=()=>{r(M=>({...M,status:"attempting"}))},g.onmessage=s,{..._,status:"connecting",socket:g}})}function E(){r(i=>(i.socket&&i.socket.close(),i.reconnectTimer&&clearInterval(i.reconnectTimer),{...i,status:"disconnected",socket:null,reconnectTimer:null}))}function C(i,c){r(_=>({..._,url:i,token:c}))}return{subscribe:t,connect:f,disconnect:E,set:C,entries:{subscribe:a.subscribe}}}const Y=Re();var De=j('<div class="inline-grid *:[grid-area:1/1]"><div class="status status-success animate-ping"></div> <div class="status status-success"></div></div>'),qe=j('<div class="inline-grid *:[grid-area:1/1]"><div class="status status-warning animate-ping"></div> <div class="status status-warning"></div></div>'),Ie=j('<div class="inline-grid *:[grid-area:1/1]"><div class="status status-error"></div></div>'),ze=j('<div class="navbar bg-base-100 flex justify-start"><h1 class="text-3xl font-bold truncate ml-4">aiwolf-nlp-viewer</h1> <div class="ml-auto"><!></div> <label class="input ml-4 mr-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info mx-2">接続</button> <button class="btn btn-error mx-2">切断</button> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Le(t,r){ee(r,!1);let a=L("ws://localhost:8080/realtime"),h=L(""),s=L("disconnected");const f=Y.subscribe(d=>{P(s,d.status)});de(f);function E(){Y.connect(e(a),e(h))}function C(){Y.disconnect()}ae();var i=ze(),c=x(u(i),2),_=u(c);{var g=d=>{var B=De();z(d,B)},M=d=>{var B=ve(),$=oe(B);{var q=b=>{var V=qe();z(b,V)},T=b=>{var V=Ie();z(b,V)};Z($,b=>{e(s)==="connecting"?b(q):b(T,!1)},!0)}z(d,B)};Z(_,d=>{e(s)==="connected"?d(g):d(M,!1)})}v(c);var R=x(c,2),D=u(R);I(D,"class","h-[1em] opacity-50"),I(D,"inline",!0),I(D,"icon","mdi:link");var y=x(D,2);se(y),v(R);var w=x(R,2),O=u(w);I(O,"class","h-[1em] opacity-50"),I(O,"inline",!0),I(O,"icon","mdi:key");var W=x(O,2);se(W),be(2),v(w);var n=x(w,2),o=x(n,2),S=x(o,2),l=u(S);I(l,"inline",!0),I(l,"icon","mdi:white-balance-sunny");var p=x(l,4);I(p,"inline",!0),I(p,"icon","mdi:moon-and-stars"),v(S),v(i),N(()=>{n.disabled=e(s)!=="disconnected",o.disabled=e(s)==="disconnected"}),re(y,()=>e(a),d=>P(a,d)),re(W,()=>e(h),d=>P(h,d)),Q("click",n,E),Q("click",o,C),z(t,i),te()}function Pe(t){return Array.from({length:t},(r,a)=>({idx:a+1,name:ke(a+1),role:"",isAlive:!0,targetIdxs:[],isBubble:!1}))}var Me=j('<li class="list-row"><button class="btn btn-wide"> </button></li>'),Oe=j('<main class="h-screen flex flex-col"><!> <div class="flex flex-1 overflow-hidden w-full flex-col md:flex-row"><div class="flex-auto p-8 bg-base-300"><!></div> <div class="w-full md:w-64 max-md:h-64 flex flex-col bg-base-200"><ul class="list overflow-y-auto flex-1"></ul></div></div></main>');function et(t,r){ee(r,!1);let a=L(""),h=-1,s=L({}),f=L({id:"",idx:0,day:0,isDay:!0,agents:Pe(5),message:"",summary:"",isDivider:!1});const E=Y.entries.subscribe(y=>{var w;P(s,y),console.log(e(s)),e(a)===""&&Object.keys(y).length>0&&P(a,Object.keys(y)[0]),h=((w=e(s)[e(a)])==null?void 0:w.length)-1,C(e(a),h)});de(()=>{E()});function C(y,w){e(s)[y]&&(w<0||w>=e(s)[y].length||P(f,e(s)[y][w]))}ae();var i=Oe();ye(y=>{he.title="aiwolf-nlp-viewer"});var c=u(i);Le(c,{});var _=x(c,2),g=u(_),M=u(g);Be(M,{get packet(){return e(f)}}),v(g);var R=x(g,2),D=u(R);le(D,5,()=>e(s)[e(a)]||[],ce,(y,w,O)=>{var W=Me(),n=u(W),o=u(n);v(n),v(W),N(()=>X(o,`${O+1}. ${e(w).summary??""}`)),Q("click",n,()=>C(e(a),O)),z(y,W)}),v(D),v(R),v(_),v(i),z(t,i),te()}export{et as component};
