import"../chunks/DsnmJJEf.js";import{d as Hn,o as Yn,a as nu,s as Ee,e as Qi}from"../chunks/BDXqH1NL.js";import{a$ as au,p as Wn,j as er,ax as bs,f as Ze,t as rt,b as Ce,c as qn,d as j,s as Z,e as B,b2 as Ss,b0 as ei,r as q,b1 as As,au as xr,a as rr,b3 as eu}from"../chunks/C_pIWTxR.js";import{i as At}from"../chunks/BncJs1YA.js";import{e as xs,i as Ls}from"../chunks/Cw3zlzy0.js";import{c as _c,s as $i,a as qt,r as Zt,L as Dc,b as tu,d as mr}from"../chunks/CJIgwCpJ.js";import{s as ti,c as kc}from"../chunks/7fu37Iyk.js";import{I as Pc,b as Cc,s as Is}from"../chunks/CWhXLAHA.js";import{i as wc,s as Mc}from"../chunks/CneIQyXX.js";import{b as Lr}from"../chunks/EjTXjlS-.js";import{s as jn,a as ri}from"../chunks/Crytf8dL.js";import{p as Oc}from"../chunks/BaegVUAO.js";import{$ as Xn,b as Fc}from"../chunks/DCOaxCy4.js";import{p as Nc}from"../chunks/BTXms5xa.js";import{b as Uc}from"../chunks/DyEBYryk.js";import{b as Bc}from"../chunks/W96oxdJN.js";class ru{static fromJson(M){return JSON.parse(M)}static toJson(M){return JSON.stringify(M,null,2)}}const Es={name:!0,team:!1,role:!1},Gc={connection:{url:"http://localhost:8080",token:""},display:{canvas:Es,bubble:Es,text:Es,largeScale:!1}},Ai=_c({storageKey:"realtime-settings",defaultValue:Gc,serialize:ru.toJson,deserialize:ru.fromJson});function Kc(ne){return Array.from({length:ne},(M,Ge)=>Vc(Ge+1))}function Vc(ne){return{idx:ne,team:"Undefined",name:Pc(ne),profile:void 0,avatar:void 0,role:"Undefined",is_alive:!0}}function St(ne,M,Ge){if(Ge===void 0)return"該当なし";const je=M.agents.find(oe=>oe.idx===Ge);if(!je)return"該当なし";const V=[];return ne?.name&&V.push(je.name),ne?.team&&V.push(je.team),ne?.role&&V.push(je.role),V.filter(Boolean).join(" ")}function zi(ne,M){return(ne||M)&&!(ne&&M)}const lr={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected"},Hc=()=>({status:lr.DISCONNECTED,entries:{},gameItems:[],currentGameId:null,selectedPacketIdx:null,isManualGameSelection:!1,isManualPacketSelection:!1,previousEntriesLengths:{}});function Yc(){const{subscribe:ne,update:M}=au(Hc());let Ge=null,je={},V={},oe=null;Ai.subscribe(G=>{oe=G});async function Y(){if(!oe)return null;try{const G=await fetch(`${oe.connection.url}/realtime/games.json`);if(!G.ok)throw new Error("Failed to fetch game list");return await G.json()}catch(G){return console.error("Error fetching game list:",G),null}}async function Xe(G){if(!oe)return[];try{const ee=await fetch(`${oe.connection.url}/realtime/${G}.jsonl`);if(!ee.ok)throw new Error(`Failed to fetch game packets for ${G}`);const ie=await ee.text();return pt(ie)}catch(ee){return console.error(`Error fetching game packets for ${G}:`,ee),[]}}function ae(G,ee,ie){if(je[G])return;const ce=async()=>{const me=await Y();if(me===null)return;const be=me.find(pe=>pe.id===G);if(be&&be.updated_at!==V[G]){const pe=await Xe(ee);pe.length>0&&M(Pe=>{const xt={...Pe.entries},_t=Pe.previousEntriesLengths[G]||0,H=pe.length;xt[G]=pe;let he=Pe.selectedPacketIdx;return G===Pe.currentGameId&&H>_t&&(he=H-1),{...Pe,entries:xt,selectedPacketIdx:he,previousEntriesLengths:{...Pe.previousEntriesLengths,[G]:H},isManualPacketSelection:!1}}),V[G]=be.updated_at}};(async()=>{const me=await Xe(ee);me.length>0&&M(be=>{const pe={...be.entries};pe[G]=me;let Pe=be.selectedPacketIdx;return G===be.currentGameId&&(Pe=me.length-1),{...be,entries:pe,selectedPacketIdx:Pe,previousEntriesLengths:{...be.previousEntriesLengths,[G]:me.length}}}),V[G]=ie})(),je[G]=setInterval(ce,1e3)}function dt(G){je[G]&&(clearInterval(je[G]),delete je[G],delete V[G])}function se(){if(!oe)return;M(ee=>({...ee,status:lr.CONNECTING}));const G=async()=>{const ee=await Y();if(ee===null){M(ie=>({...ie,status:lr.CONNECTING}));return}M(ie=>{const ce=new Set(Object.keys(je)),xe=new Set(ee.map(pe=>pe.id));ce.forEach(pe=>{xe.has(pe)||dt(pe)}),ee.forEach(pe=>{ce.has(pe.id)||ae(pe.id,pe.filename,pe.updated_at)});let me=ie.currentGameId;if(ee.length>0){const pe=ee.reduce((Pe,xt)=>new Date(xt.updated_at)>new Date(Pe.updated_at)?xt:Pe);(!ie.currentGameId||!ie.isManualGameSelection&&ee.length>ie.gameItems.length)&&(me=pe.id)}const be=me!==ie.currentGameId;return{...ie,status:lr.CONNECTED,gameItems:ee,currentGameId:me,selectedPacketIdx:be?null:ie.selectedPacketIdx,isManualGameSelection:be?!1:ie.isManualGameSelection,isManualPacketSelection:be?!1:ie.isManualPacketSelection}})};G(),Ge=setInterval(G,1e3)}function gt(){Ge&&(clearInterval(Ge),Ge=null),Object.keys(je).forEach(G=>{dt(G)}),M(G=>({...G,status:lr.DISCONNECTED}))}function at(G,ee=!1){M(ie=>{const ce=ie.entries[G],xe=ce&&ce.length>0?ce.length-1:null;return{...ie,currentGameId:G,selectedPacketIdx:xe,isManualGameSelection:ee,isManualPacketSelection:!1}})}function st(G,ee=!1){M(ie=>({...ie,selectedPacketIdx:G,isManualPacketSelection:ee}))}async function Te(){try{const G=await navigator.clipboard.readText();if(!G.trim()){console.warn("Clipboard is empty");return}await mt(G)}catch(G){console.error("Failed to load JSONL from clipboard:",G)}}async function mt(G){if(!G.trim())return;const ee=pt(G);if(ee.length===0){console.error("No valid packets found");return}const ie=ze(ee);M(ce=>{const xe=Object.keys(ie),me=xe.length>0?xe[0]:null,be=me?ie[me]:null,pe=be?be.length-1:null;return{...ce,entries:ie,currentGameId:me,selectedPacketIdx:pe,gameItems:xe.map(Pe=>({id:Pe,filename:Pe,updated_at:new Date().toISOString()})),isManualGameSelection:!1,isManualPacketSelection:!1,previousEntriesLengths:Object.fromEntries(xe.map(Pe=>[Pe,ie[Pe].length]))}}),console.log(`JSONL data loaded: ${ee.length} packets across ${Object.keys(ie).length} games`)}async function Rt(G){for(const ee of Array.from(G)){const ie=new FileReader;ie.onload=async ce=>{const xe=ce.target?.result;await mt(xe)},ie.readAsText(ee)}}function pt(G){const ee=G.trim().split(`
`),ie=[];for(let ce=0;ce<ee.length;ce++){const xe=ee[ce].trim();if(xe)try{const me=JSON.parse(xe);ie.push(me)}catch{return console.error(`Line ${ce+1} is not valid JSON:`,xe),[]}}return ie}function ze(G){const ee={};return G.forEach(ie=>{ee[ie.id]||(ee[ie.id]=[]),ee[ie.id].push(ie)}),Object.keys(ee).forEach(ie=>{ee[ie].sort((ce,xe)=>ce.day!==xe.day?ce.day-xe.day:ce.is_day!==xe.is_day?ce.is_day?-1:1:ce.idx-xe.idx)}),ee}return{subscribe:ne,connect:se,disconnect:gt,switchToGame:at,selectPacket:st,loadFromClipboard:Te,loadFromFiles:Rt,entries:{subscribe:G=>ne(ee=>G(ee.entries))},gameList:{subscribe:G=>ne(ee=>G(ee.gameItems))},currentGameId:{subscribe:G=>ne(ee=>G(ee.currentGameId))},selectedPacketIdx:{subscribe:G=>ne(ee=>G(ee.selectedPacketIdx))},currentPacket:{subscribe:G=>ne(ee=>{const{currentGameId:ie,selectedPacketIdx:ce,entries:xe}=ee;if(!ie||ce===null){G(null);return}const me=xe[ie];if(!me||ce<0||ce>=me.length){G(null);return}G(me[ce])})}}}const pr=Yc();var Wc=(ne,M,Ge)=>{M()===B(Ge).idx?M(void 0):M(B(Ge).idx)},qc=Ze('<pre class="base-content text-2xl select-none"> </pre>'),jc=Ze('<pre class="base-content select-none"> </pre>'),Xc=Ze('<pre class="base-content text-2xl select-none"> </pre>'),zc=Ze('<pre class="base-content select-none"> </pre>'),Qc=Ze('<pre class="base-content text-2xl select-none"> </pre>'),$c=Ze('<pre class="base-content select-none"> </pre>'),Jc=Ze('<div><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"/></button></div></div> <div class="mt-2"><!> <!> <!></div></div>'),Zc=Ze(`<div class="h-full flex flex-col"><div class="bg-secondary"></div> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><pre class="base-content w-2/5 text-5xl font-bold opacity-70 absolute top-0 left-0 -mt-4 ml-8 select-none"> <br/> <br/> </pre> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><span class="text-xs">イラスト:石黒正数氏, VOICEVOX:四国めたん,ずんだもん,春日部つむぎ,
        波音リツ,玄野武宏,白上虎太郎,青山龍星,冥鳴ひまり,九州そら,もち子(cv
        明日葉よもぎ),剣崎雌雄,WhiteCUL,後鬼,No.7,ちび式じい,
        櫻歌ミコ,小夜/SAYO,ナースロボ＿タイプＴ,†聖騎士 紅桜†,雀松朱司,
        麒ヶ島宗麟,春歌ナナ,猫使アル,猫使ビィ,中国うさぎ,栗田まろん,
        あいえるたん,満別花丸,琴詠ニア,Voidoll(CV:丹下桜),ぞん子,中部つるぎ</span></aside></footer></div>`);function ev(ne,M){Wn(M,!0);const[Ge,je]=jn(),V=()=>ri(Xn,"$_",Ge);let oe=Nc(M,"focusIdx",15),Y=ei(void 0);const Xe=Ai.subscribe(he=>{er(Y,he,!0)});Yn(Xe);let ae=Ss(()=>{switch(M.packet.event){case"未接続":return V()("realtime.events.disconnected");case"トーク":return M.packet.message;case"囁き":return zi(oe()===void 0,M.packet.agents.find(he=>he.idx===oe())?.role==="WEREWOLF")?M.packet.message:V()("realtime.events.whispered");case"襲撃投票":return zi(oe()===void 0,M.packet.from_idx===oe())?V()("realtime.events.attack_voted_with_target",{values:{from:St(B(Y)?.display.bubble,M.packet,M.packet.from_idx),to:St(B(Y)?.display.bubble,M.packet,M.packet.to_idx)}}):V()("realtime.events.attack_voted");case"投票":return zi(oe()===void 0,M.packet.from_idx===oe())?V()("realtime.events.voted_with_target",{values:{from:St(B(Y)?.display.bubble,M.packet,M.packet.from_idx),to:St(B(Y)?.display.bubble,M.packet,M.packet.to_idx)}}):V()("realtime.events.voted",{values:{from:St(B(Y)?.display.bubble,M.packet,M.packet.from_idx)}});case"追放":return M.packet.to_idx===void 0?V()("realtime.events.no_execute"):V()("realtime.events.executed",{values:{target:St(B(Y)?.display.bubble,M.packet,M.packet.to_idx)}});case"襲撃":return M.packet.to_idx===void 0?V()("realtime.events.no_attack"):M.packet.from_idx===-1?V()("realtime.events.attacked_but_guarded",{values:{target:St(B(Y)?.display.bubble,M.packet,M.packet.to_idx)}}):V()("realtime.events.attacked",{values:{target:St(B(Y)?.display.bubble,M.packet,M.packet.to_idx)}});case"占い":if(zi(oe()===void 0,M.packet.from_idx===oe())){const he=M.packet.agents.find(W=>W.idx===M.packet.to_idx)?.role,ke=he?Cc[he]:void 0;return V()("realtime.events.divined_with_result",{values:{from:St(B(Y)?.display.bubble,M.packet,M.packet.from_idx),to:St(B(Y)?.display.bubble,M.packet,M.packet.to_idx),result:ke?V()(`game.species.${ke}`):""}})}return V()("realtime.events.divined");case"護衛":return zi(oe()===void 0,M.packet.from_idx===oe())?V()("realtime.events.guarded_with_target",{values:{from:St(B(Y)?.display.bubble,M.packet,M.packet.from_idx),to:St(B(Y)?.display.bubble,M.packet,M.packet.to_idx)}}):V()("realtime.events.guarded");case"終了":return V()("realtime.events.game_ended",{values:{winner:M.packet.message}});default:return M.packet.message??V()("realtime.events.unknown")}}),dt,se,gt,at,st;nu(()=>(window.addEventListener("resize",Te),()=>{window.removeEventListener("resize",Te)})),bs(()=>{Te()});function Te(){if(!se||!gt||!dt)return;const he=dt.getBoundingClientRect();if([se,gt].forEach(y=>{y.width=he.width,y.height=he.height;const N=y.getContext("2d");N&&(N.clearRect(0,0,y.width,y.height),N.globalAlpha=1,N.lineWidth=2)}),oe()!==void 0&&(M.packet.event==="囁き"&&M.packet.agents.find(y=>y.idx===oe())?.role!=="WEREWOLF"||M.packet.event==="占い"&&M.packet.from_idx!==oe()||M.packet.event==="投票"&&M.packet.from_idx!==oe()||M.packet.event==="襲撃投票"&&M.packet.from_idx!==oe()))return;const ke=se.getContext("2d"),W=gt.getContext("2d");if(!ke||!W)return;const _=gt.getBoundingClientRect();if(M.packet.from_idx!==void 0&&M.packet.to_idx!==void 0){const y=document.getElementById(`agent-${M.packet.from_idx}`);if(!(y instanceof HTMLElement))return;const N=y.getBoundingClientRect(),F=N.left+N.width/2-_.left,de=N.top+N.height/2-_.top,We=document.getElementById(`agent-${M.packet.to_idx}`);if(!(We instanceof HTMLElement))return;const te=We.getBoundingClientRect();mt(W,F,de,te.left+te.width/2-_.left,te.top+te.height/2-_.top,!1,getComputedStyle(st).getPropertyValue("background-color"))}if(M.packet.bubble_idx!==void 0){const y=document.getElementById(`agent-${M.packet.bubble_idx}`);if(!(y instanceof HTMLElement))return;const N=y.getBoundingClientRect(),F=N.left+N.width/2-_.left,de=N.top+N.height/2-_.top;mt(ke,_.width/2,_.height/2,F,de,!0,getComputedStyle(at).getPropertyValue("background-color"))}}function mt(he,ke,W,_,y,N,F){const de=N?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];he.strokeStyle=he.fillStyle=F,he.beginPath();let We=_-ke,te=y-W,Fe=Math.sqrt(We*We+te*te),Mt=te/Fe,Ot=We/Fe,it=[];it.push(0,0);for(let we=0;we<de.length;we+=2){let Qe=de[we],Dt=de[we+1];it.push(Qe<0?Fe+Qe:Qe,Dt)}it.push(Fe,0);for(let we=de.length;we>0;we-=2){let Qe=de[we-2],Dt=de[we-1];it.push(Qe<0?Fe+Qe:Qe,-Dt)}it.push(0,0);for(let we=0;we<it.length;we+=2){let Qe=it[we]*Ot-it[we+1]*Mt+ke,Dt=it[we]*Mt+it[we+1]*Ot+W;we===0?he.moveTo(Qe,Dt):he.lineTo(Qe,Dt)}he.fill()}var Rt=Zc(),pt=j(Rt);Lr(pt,he=>st=he,()=>st);var ze=Z(pt,2),G=j(ze),ee=j(G),ie=j(ee,!0),ce=Z(ie,2,!0),xe=Z(ce,2,!0);q(ee);var me=Z(ee,2);Lr(me,he=>se=he,()=>se);var be=Z(me,2);Lr(be,he=>gt=he,()=>gt);var pe=Z(be,2),Pe=j(pe),xt=j(Pe),_t=j(xt,!0);q(xt),q(Pe),q(pe),Lr(pe,he=>at=he,()=>at);var H=Z(pe,2);xs(H,17,()=>M.packet.agents,Ls,(he,ke,W)=>{var _=Jc();let y;var N=j(_),F=j(N);let de,We;var te=j(F);te.__click=[Wc,oe,ke];var Fe=j(te);q(te),q(F),q(N);var Mt=Z(N,2),Ot=j(Mt);{var it=Ie=>{var Ne=xr(),ot=rr(Ne);{var Me=Re=>{var ve=qc(),le=j(ve,!0);q(ve),rt(()=>Ee(le,B(ke).name)),Ce(Re,ve)},Ke=Re=>{var ve=jc(),le=j(ve,!0);q(ve),rt(()=>Ee(le,B(ke).name)),Ce(Re,ve)};At(ot,Re=>{B(Y)?.display.largeScale?Re(Me):Re(Ke,!1)})}Ce(Ie,Ne)};At(Ot,Ie=>{B(Y)?.display.canvas.name&&Ie(it)})}var we=Z(Ot,2);{var Qe=Ie=>{var Ne=xr(),ot=rr(Ne);{var Me=Re=>{var ve=Xc(),le=j(ve,!0);q(ve),rt(()=>Ee(le,B(ke).team)),Ce(Re,ve)},Ke=Re=>{var ve=zc(),le=j(ve,!0);q(ve),rt(()=>Ee(le,B(ke).team)),Ce(Re,ve)};At(ot,Re=>{B(Y)?.display.largeScale?Re(Me):Re(Ke,!1)})}Ce(Ie,Ne)};At(we,Ie=>{B(Y)?.display.canvas.team&&Ie(Qe)})}var Dt=Z(we,2);{var Le=Ie=>{var Ne=xr(),ot=rr(Ne);{var Me=Re=>{var ve=Qc(),le=j(ve,!0);q(ve),rt(()=>Ee(le,B(ke).role)),Ce(Re,ve)},Ke=Re=>{var ve=$c(),le=j(ve,!0);q(ve),rt(()=>Ee(le,B(ke).role)),Ce(Re,ve)};At(ot,Re=>{B(Y)?.display.largeScale?Re(Me):Re(Ke,!1)})}Ce(Ie,Ne)};At(Dt,Ie=>{B(Y)?.display.canvas.role&&(B(ke).idx===oe()||oe()===void 0)&&Ie(Le)})}q(Mt),q(_),rt((Ie,Ne,ot,Me)=>{y=ti(_,1,"absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-104i6df",null,y,Ie),Is(_,`--angle: ${W*(360/M.packet.agents.length)}`),$i(_,"id",`agent-${B(ke).idx??""}`),de=ti(F,1,"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2 svelte-104i6df",null,de,Ne),We=Is(F,"",We,ot),$i(Fe,"src",Me),$i(Fe,"alt",B(ke).name)},[()=>({"bg-focus":B(ke).idx===oe()}),()=>({"ring-info":B(ke).is_alive,"ring-error":!B(ke).is_alive}),()=>({opacity:B(ke).is_alive?1:.25}),()=>B(ke).avatar===void 0?`${Uc}/images/male/${B(ke).idx.toString().padStart(2,"0")}.png`:B(ke).avatar]),Ce(he,_)}),q(G),Lr(G,he=>dt=he,()=>dt),q(ze),As(2),q(Rt),rt((he,ke,W)=>{Ee(ie,he),Ee(ce,ke),Ee(xe,W),pe.hidden=!B(ae),ti(xt,1,kc(B(Y)?.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center")),Ee(_t,B(ae))},[()=>V()("realtime.day",{values:{day:M.packet.day}}),()=>M.packet.is_day?V()("realtime.daytime"):V()("realtime.nighttime"),()=>V()(`realtime.eventTypes.${M.packet.event}`,{default:M.packet.event})]),Ce(ne,Rt),qn(),je()}Hn(["click"]);var Ts={exports:{}},iu;function tv(){return iu||(iu=1,(function(ne,M){(function Ge(je){(function(V,oe){ne.exports=oe()})(this,(function(){function V(a,o,n){if(at())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,o);var e=new(a.bind.apply(a,r));return n&&mt(e,n.prototype),e}function oe(a,o){for(var n=0;n<o.length;n++){var r=o[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,pt(r.key),r)}}function Y(a,o,n){return o&&oe(a.prototype,o),n&&oe(a,n),Object.defineProperty(a,"prototype",{writable:!1}),a}function Xe(a,o,n){return(o=pt(o))in a?Object.defineProperty(a,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[o]=n,a}function ae(){return ae=Object.assign?Object.assign.bind():function(a){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var r in n)({}).hasOwnProperty.call(n,r)&&(a[r]=n[r])}return a},ae.apply(null,arguments)}function dt(a){return dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},dt(a)}function se(a,o){a.prototype=Object.create(o.prototype),a.prototype.constructor=a,mt(a,o)}function gt(a){try{return Function.toString.call(a).indexOf("[native code]")!==-1}catch{return typeof a=="function"}}function at(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(at=function(){return!!a})()}function st(a,o){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);o&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),n.push.apply(n,r)}return n}function Te(a){for(var o=1;o<arguments.length;o++){var n=arguments[o]!=null?arguments[o]:{};o%2?st(Object(n),!0).forEach(function(r){Xe(a,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(n,r))})}return a}function mt(a,o){return mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},mt(a,o)}function Rt(a,o){if(typeof a!="object"||!a)return a;var n=a[Symbol.toPrimitive];if(n!==void 0){var r=n.call(a,o);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(a)}function pt(a){var o=Rt(a,"string");return typeof o=="symbol"?o:o+""}function ze(a){var o=typeof Map=="function"?new Map:void 0;return ze=function(n){if(n===null||!gt(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(n))return o.get(n);o.set(n,r)}function r(){return V(n,arguments,dt(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),mt(r,n)},ze(a)}function G(){try{return crypto.randomUUID()}catch{try{var a=URL.createObjectURL(new Blob),o=a.toString();return URL.revokeObjectURL(a),o.slice(o.lastIndexOf("/")+1)}catch{var n=new Date().getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var s=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(i=="x"?s:s&3|8).toString(16)});return r}}}function ee(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var ie={exports:{}},ce;function xe(){return ce||(ce=1,(function(a){var o=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function e(l,u,f){this.fn=l,this.context=u,this.once=f||!1}function t(l,u,f,d,h){if(typeof f!="function")throw new TypeError("The listener must be a function");var c=new e(f,d||l,h),v=n?n+u:u;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],c]:l._events[v].push(c):(l._events[v]=c,l._eventsCount++),l}function i(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function s(){this._events=new r,this._eventsCount=0}s.prototype.eventNames=function(){var u=[],f,d;if(this._eventsCount===0)return u;for(d in f=this._events)o.call(f,d)&&u.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},s.prototype.listeners=function(u){var f=n?n+u:u,d=this._events[f];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,c=d.length,v=new Array(c);h<c;h++)v[h]=d[h].fn;return v},s.prototype.listenerCount=function(u){var f=n?n+u:u,d=this._events[f];return d?d.fn?1:d.length:0},s.prototype.emit=function(u,f,d,h,c,v){var g=n?n+u:u;if(!this._events[g])return!1;var m=this._events[g],p=arguments.length,E,S;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),p){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,f),!0;case 3:return m.fn.call(m.context,f,d),!0;case 4:return m.fn.call(m.context,f,d,h),!0;case 5:return m.fn.call(m.context,f,d,h,c),!0;case 6:return m.fn.call(m.context,f,d,h,c,v),!0}for(S=1,E=new Array(p-1);S<p;S++)E[S-1]=arguments[S];m.fn.apply(m.context,E)}else{var T=m.length,A;for(S=0;S<T;S++)switch(m[S].once&&this.removeListener(u,m[S].fn,void 0,!0),p){case 1:m[S].fn.call(m[S].context);break;case 2:m[S].fn.call(m[S].context,f);break;case 3:m[S].fn.call(m[S].context,f,d);break;case 4:m[S].fn.call(m[S].context,f,d,h);break;default:if(!E)for(A=1,E=new Array(p-1);A<p;A++)E[A-1]=arguments[A];m[S].fn.apply(m[S].context,E)}}return!0},s.prototype.on=function(u,f,d){return t(this,u,f,d,!1)},s.prototype.once=function(u,f,d){return t(this,u,f,d,!0)},s.prototype.removeListener=function(u,f,d,h){var c=n?n+u:u;if(!this._events[c])return this;if(!f)return i(this,c),this;var v=this._events[c];if(v.fn)v.fn===f&&(!h||v.once)&&(!d||v.context===d)&&i(this,c);else{for(var g=0,m=[],p=v.length;g<p;g++)(v[g].fn!==f||h&&!v[g].once||d&&v[g].context!==d)&&m.push(v[g]);m.length?this._events[c]=m.length===1?m[0]:m:i(this,c)}return this},s.prototype.removeAllListeners=function(u){var f;return u?(f=n?n+u:u,this._events[f]&&i(this,f)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,a.exports=s})(ie)),ie.exports}var me=xe(),be=ee(me),pe={exports:{}},Pe;function xt(){return Pe||(Pe=1,(function(a,o){(function(n){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,e=/^(?=([^\/?#]*))\1([^]*)$/,t=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(l,u,f){if(f=f||{},l=l.trim(),u=u.trim(),!u){if(!f.alwaysNormalize)return l;var d=s.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=s.normalizePath(d.path),s.buildURLFromParts(d)}var h=s.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return f.alwaysNormalize?(h.path=s.normalizePath(h.path),s.buildURLFromParts(h)):u;var c=s.parseURL(l);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&c.path[0]!=="/"){var v=e.exec(c.path);c.netLoc=v[1],c.path=v[2]}c.netLoc&&!c.path&&(c.path="/");var g={scheme:c.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(g.netLoc=c.netLoc,h.path[0]!=="/"))if(!h.path)g.path=c.path,h.params||(g.params=c.params,h.query||(g.query=c.query));else{var m=c.path,p=m.substring(0,m.lastIndexOf("/")+1)+h.path;g.path=s.normalizePath(p)}return g.path===null&&(g.path=f.alwaysNormalize?s.normalizePath(h.path):h.path),s.buildURLFromParts(g)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(t,"");l.length!==(l=l.replace(i,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};a.exports=s})()})(pe)),pe.exports}var _t=xt(),H=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},he=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=ke},ke=Number.MAX_SAFE_INTEGER||9007199254740991,W=(function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a})({}),_=(function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a})({}),y=(function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a})({}),N={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},F={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},de=(function(){function a(n,r,e){r===void 0&&(r=0),e===void 0&&(e=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=n,this.alpha_=n?Math.exp(Math.log(.5)/n):0,this.estimate_=r,this.totalWeight_=e}var o=a.prototype;return o.sample=function(r,e){var t=Math.pow(this.alpha_,r);this.estimate_=e*(1-t)+t*this.estimate_,this.totalWeight_+=r},o.getTotalWeight=function(){return this.totalWeight_},o.getEstimate=function(){if(this.alpha_){var r=1-Math.pow(this.alpha_,this.totalWeight_);if(r)return this.estimate_/r}return this.estimate_},a})(),We=(function(){function a(n,r,e,t){t===void 0&&(t=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new de(n),this.fast_=new de(r),this.defaultTTFB_=t,this.ttfb_=new de(n)}var o=a.prototype;return o.update=function(r,e){var t=this.slow_,i=this.fast_,s=this.ttfb_;t.halfLife!==r&&(this.slow_=new de(r,t.getEstimate(),t.getTotalWeight())),i.halfLife!==e&&(this.fast_=new de(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==r&&(this.ttfb_=new de(r,s.getEstimate(),s.getTotalWeight()))},o.sample=function(r,e){r=Math.max(r,this.minDelayMs_);var t=8*e,i=r/1e3,s=t/i;this.fast_.sample(i,s),this.slow_.sample(i,s)},o.sampleTTFB=function(r){var e=r/1e3,t=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(t,Math.max(r,5))},o.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},o.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},o.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},o.destroy=function(){},Y(a,[{key:"defaultEstimate",get:function(){return this.defaultEstimate_}}])})(),te=function(o,n){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;var r="["+o+"]:";this.trace=Fe,this.debug=n.debug.bind(null,r),this.log=n.log.bind(null,r),this.warn=n.warn.bind(null,r),this.info=n.info.bind(null,r),this.error=n.error.bind(null,r)},Fe=function(){},Mt={trace:Fe,debug:Fe,log:Fe,warn:Fe,info:Fe,error:Fe};function Ot(){return ae({},Mt)}function it(a,o){var n=self.console[a];return n?n.bind(self.console,(o?"["+o+"] ":"")+"["+a+"] >"):Fe}function we(a,o,n){return o[a]?o[a].bind(o):it(a,n)}var Qe=Ot();function Dt(a,o,n){var r=Ot();if(typeof console=="object"&&a===!0||typeof a=="object"){var e=["debug","log","info","warn","error"];e.forEach(function(t){r[t]=we(t,a,n)});try{r.log('Debug logs enabled for "'+o+'" in hls.js version 1.6.11')}catch{return Ot()}e.forEach(function(t){Qe[t]=we(t,a)})}else ae(Qe,r);return r}var Le=Qe;function Ie(a){if(a===void 0&&(a=!0),!(typeof self>"u")){var o=(a||!self.MediaSource)&&self.ManagedMediaSource;return o||self.MediaSource||self.WebKitMediaSource}}function Ne(a){return typeof self<"u"&&a===self.ManagedMediaSource}function ot(a,o){var n=Object.keys(a),r=Object.keys(o),e=n.length,t=r.length;return!e||!t||e===t&&!n.some(function(i){return r.indexOf(i)===-1})}function Me(a,o){if(o===void 0&&(o=!1),typeof TextDecoder<"u"){var n=new TextDecoder("utf-8"),r=n.decode(a);if(o){var e=r.indexOf("\0");return e!==-1?r.substring(0,e):r}return r.replace(/\0/g,"")}for(var t=a.length,i,s,l,u="",f=0;f<t;){if(i=a[f++],i===0&&o)return u;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(i);break;case 12:case 13:s=a[f++],u+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=a[f++],l=a[f++],u+=String.fromCharCode((i&15)<<12|(s&63)<<6|(l&63)<<0);break}}return u}function Ke(a){for(var o="",n=0;n<a.length;n++){var r=a[n].toString(16);r.length<2&&(r="0"+r),o+=r}return o}function Re(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var ve=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},le={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},Ft=(function(){function a(n){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof n=="string"&&(n={url:n}),this.base=n,Ur(this,"stats")}var o=a.prototype;return o.setByteRange=function(r,e){var t=r.split("@",2),i;t.length===1?i=e?.byteRangeEndOffset||0:i=parseInt(t[1]),this._byteRange=[i,parseInt(t[0])+i]},o.clearElementaryStreamInfo=function(){var r=this.elementaryStreams;r[le.AUDIO]=null,r[le.VIDEO]=null,r[le.AUDIOVIDEO]=null},Y(a,[{key:"baseurl",get:function(){return this.base.url}},{key:"byteRange",get:function(){return this._byteRange===null?[]:this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"elementaryStreams",get:function(){if(this._streams===null){var r;this._streams=(r={},r[le.AUDIO]=null,r[le.VIDEO]=null,r[le.AUDIOVIDEO]=null,r)}return this._streams},set:function(r){this._streams=r}},{key:"hasStats",get:function(){return this._stats!==null}},{key:"hasStreams",get:function(){return this._streams!==null}},{key:"stats",get:function(){return this._stats===null&&(this._stats=new ve),this._stats},set:function(r){this._stats=r}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=_t.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(r){this._url=r}}])})();function Ve(a){return a.sn!=="initSegment"}var ht=(function(a){function o(r,e){var t;return t=a.call(this,e)||this,t._decryptdata=null,t._programDateTime=null,t._ref=null,t._bitrate=void 0,t.rawProgramDateTime=null,t.tagList=[],t.duration=0,t.sn=0,t.levelkeys=void 0,t.type=void 0,t.loader=null,t.keyLoader=null,t.level=-1,t.cc=0,t.startPTS=void 0,t.endPTS=void 0,t.startDTS=void 0,t.endDTS=void 0,t.start=0,t.playlistOffset=0,t.deltaPTS=void 0,t.maxStartPTS=void 0,t.minEndPTS=void 0,t.data=void 0,t.bitrateTest=!1,t.title=null,t.initSegment=null,t.endList=void 0,t.gap=void 0,t.urlId=0,t.type=r,t}se(o,a);var n=o.prototype;return n.addStart=function(e){this.setStart(this.start+e)},n.setStart=function(e){this.start=e,this._ref&&(this._ref.start=e)},n.setDuration=function(e){this.duration=e,this._ref&&(this._ref.duration=e)},n.setKeyFormat=function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}},n.abortRequests=function(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()},n.setElementaryStreamInfo=function(e,t,i,s,l,u){u===void 0&&(u=!1);var f=this.elementaryStreams,d=f[e];if(!d){f[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:l,partial:u};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,i),d.startDTS=Math.min(d.startDTS,s),d.endDTS=Math.max(d.endDTS,l)},Y(o,[{key:"byteLength",get:function(){if(this.hasStats){var e=this.stats.total;if(e)return e}if(this.byteRange.length){var t=this.byteRange[0],i=this.byteRange[1];if(H(t)&&H(i))return i-t}return null}},{key:"bitrate",get:function(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null},set:function(e){this._bitrate=e}},{key:"decryptdata",get:function(){var e=this.levelkeys;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var i=Object.keys(this.levelkeys);if(i.length===1){var s=this._decryptdata=this.levelkeys[i[0]]||null;if(s)return s.getDecryptData(this.sn)}}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null)return null;var e=H(this.duration)?this.duration:0;return this.programDateTime+e*1e3}},{key:"encrypted",get:function(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t,i=Object.keys(this.levelkeys),s=i.length;if(s>1||s===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}},{key:"programDateTime",get:function(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime},set:function(e){if(!H(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}},{key:"ref",get:function(){return Ve(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}}])})(Ft),Nt=(function(a){function o(n,r,e,t,i){var s;s=a.call(this,e)||this,s.fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.duration=n.decimalFloatingPoint("DURATION"),s.gap=n.bool("GAP"),s.independent=n.bool("INDEPENDENT"),s.relurl=n.enumeratedString("URI"),s.fragment=r,s.index=t;var l=n.enumeratedString("BYTERANGE");return l&&s.setByteRange(l,i),i&&(s.fragOffset=i.fragOffset+i.duration),s}return se(o,a),Y(o,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var r=this.elementaryStreams;return!!(r.audio||r.video||r.audiovideo)}}])})(Ft);function Ut(a,o){var n=Object.getPrototypeOf(a);if(n){var r=Object.getOwnPropertyDescriptor(n,o);return r||Ut(n,o)}}function Ur(a,o){var n=Ut(a,o);n&&(n.enumerable=!0,Object.defineProperty(a,o,n))}var ir=Math.pow(2,32)-1,Bt=[].push,jt={video:1,audio:2,id3:3,text:4};function Ue(a){return String.fromCharCode.apply(null,a)}function ur(a,o){var n=a[o]<<8|a[o+1];return n<0?65536+n:n}function ue(a,o){var n=Ji(a,o);return n<0?4294967296+n:n}function Ir(a,o){var n=ue(a,o);return n*=Math.pow(2,32),n+=ue(a,o+4),n}function Ji(a,o){return a[o]<<24|a[o+1]<<16|a[o+2]<<8|a[o+3]}function xi(a){for(var o=a.byteLength,n=0;n<o;){var r=ue(a,n);if(r>8&&a[n+4]===109&&a[n+5]===111&&a[n+6]===111&&a[n+7]===102)return!0;n=r>1?n+r:o}return!1}function ye(a,o){var n=[];if(!o.length)return n;for(var r=a.byteLength,e=0;e<r;){var t=ue(a,e),i=Ue(a.subarray(e+4,e+8)),s=t>1?e+t:r;if(i===o[0])if(o.length===1)n.push(a.subarray(e+8,s));else{var l=ye(a.subarray(e+8,s),o.slice(1));l.length&&Bt.apply(n,l)}e=s}return n}function zn(a){var o=[],n=a[0],r=8,e=ue(a,r);r+=4;var t=0,i=0;n===0?(t=ue(a,r),i=ue(a,r+4),r+=8):(t=Ir(a,r),i=Ir(a,r+8),r+=16),r+=2;var s=a.length+i,l=ur(a,r);r+=2;for(var u=0;u<l;u++){var f=r,d=ue(a,f);f+=4;var h=d&2147483647,c=(d&2147483648)>>>31;if(c===1)return Le.warn("SIDX has hierarchical references (not supported)"),null;var v=ue(a,f);f+=4,o.push({referenceSize:h,subsegmentDuration:v,info:{duration:v/e,start:s,end:s+h-1}}),s+=h,f+=4,r=f}return{earliestPresentationTime:t,timescale:e,version:n,referencesCount:l,references:o}}function ii(a){for(var o=[],n=ye(a,["moov","trak"]),r=0;r<n.length;r++){var e=n[r],t=ye(e,["tkhd"])[0];if(t){var i=t[0],s=ue(t,i===0?12:20),l=ye(e,["mdia","mdhd"])[0];if(l){i=l[0];var u=ue(l,i===0?12:20),f=ye(e,["mdia","hdlr"])[0];if(f){var d=Ue(f.subarray(8,12)),h={soun:le.AUDIO,vide:le.VIDEO}[d],c=ye(e,["mdia","minf","stbl","stsd"])[0],v=Li(c);h?(o[s]={timescale:u,type:h,stsd:v},o[h]=Te({timescale:u,id:s},v)):o[s]={timescale:u,type:d,stsd:v}}}}}var g=ye(a,["moov","mvex","trex"]);return g.forEach(function(m){var p=ue(m,4),E=o[p];E&&(E.default={duration:ue(m,12),flags:ue(m,20)})}),o}function Li(a){var o=a.subarray(8),n=o.subarray(86),r=Ue(o.subarray(4,8)),e=r,t,i=r==="enca"||r==="encv";if(i){var s=ye(o,[r])[0],l=s.subarray(r==="enca"?28:78),u=ye(l,["sinf"]);u.forEach(function(nt){var bt=ye(nt,["schm"])[0];if(bt){var ut=Ue(bt.subarray(4,8));if(ut==="cbcs"||ut==="cenc"){var tt=ye(nt,["frma"])[0];tt&&(e=Ue(tt))}}})}var f=e;switch(e){case"avc1":case"avc2":case"avc3":case"avc4":{var d=ye(n,["avcC"])[0];d&&d.length>3&&(e+="."+Rr(d[1])+Rr(d[2])+Rr(d[3]),t=br(f==="avc1"?"dva1":"dvav",n));break}case"mp4a":{var h=ye(o,[r])[0],c=ye(h.subarray(28),["esds"])[0];if(c&&c.length>7){var v=4;if(c[v++]!==3)break;v=Br(c,v),v+=2;var g=c[v++];if(g&128&&(v+=2),g&64&&(v+=c[v++]),c[v++]!==4)break;v=Br(c,v);var m=c[v++];if(m===64)e+="."+Rr(m);else break;if(v+=12,c[v++]!==5)break;v=Br(c,v);var p=c[v++],E=(p&248)>>3;E===31&&(E+=1+((p&7)<<3)+((c[v]&224)>>5)),e+="."+E}break}case"hvc1":case"hev1":{var S=ye(n,["hvcC"])[0];if(S&&S.length>12){var T=S[1],A=["","A","B","C"][T>>6],x=T&31,b=ue(S,2),D=(T&32)>>5?"H":"L",k=S[12],R=S.subarray(6,12);e+="."+A+x,e+="."+Qn(b).toString(16).toUpperCase(),e+="."+D+k;for(var L="",I=R.length;I--;){var P=R[I];if(P||L){var U=P.toString(16).toUpperCase();L="."+U+L}}e+=L}t=br(f=="hev1"?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{e=br(e,n)||e;break}case"vp09":{var w=ye(n,["vpcC"])[0];if(w&&w.length>6){var O=w[4],K=w[5],z=w[6]>>4&15;e+="."+Gt(O)+"."+Gt(K)+"."+Gt(z)}break}case"av01":{var X=ye(n,["av1C"])[0];if(X&&X.length>2){var Q=X[1]>>>5,ge=X[1]&31,$=X[2]>>>7?"H":"M",J=(X[2]&64)>>6,re=(X[2]&32)>>5,fe=Q===2&&J?re?12:10:J?10:8,_e=(X[2]&16)>>4,De=(X[2]&8)>>3,Ye=(X[2]&4)>>2,qe=X[2]&3,Oe=1,It=1,Be=1,Ae=0;e+="."+Q+"."+Gt(ge)+$+"."+Gt(fe)+"."+_e+"."+De+Ye+qe+"."+Gt(Oe)+"."+Gt(It)+"."+Gt(Be)+"."+Ae,t=br("dav1",n)}break}}return{codec:e,encrypted:i,supplemental:t}}function br(a,o){var n=ye(o,["dvvC"]),r=n.length?n[0]:ye(o,["dvcC"])[0];if(r){var e=r[2]>>1&127,t=r[2]<<5&32|r[3]>>3&31;return a+"."+Gt(e)+"."+Gt(t)}}function Qn(a){for(var o=0,n=0;n<32;n++)o|=(a>>n&1)<<31-n;return o>>>0}function Br(a,o){for(var n=o+5;a[o++]&128&&o<n;);return o}function Rr(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function Gt(a){return(a<10?"0":"")+a}function $n(a,o){if(!(!a||!o)){var n=o.keyId;if(n&&o.isCommonEncryption){var r=ye(a,["moov","trak"]);r.forEach(function(e){var t=ye(e,["mdia","minf","stbl","stsd"])[0],i=t.subarray(8),s=ye(i,["enca"]),l=s.length>0;l||(s=ye(i,["encv"])),s.forEach(function(u){var f=l?u.subarray(28):u.subarray(78),d=ye(f,["sinf"]);d.forEach(function(h){var c=ni(h);if(c){var v=c.subarray(8,24);v.some(function(g){return g!==0})||(Le.log("[eme] Patching keyId in 'enc"+(l?"a":"v")+">sinf>>tenc' box: "+Ke(v)+" -> "+Ke(n)),c.set(n,8))}})})})}}}function ni(a){var o=ye(a,["schm"])[0];if(o){var n=Ue(o.subarray(4,8));if(n==="cbcs"||n==="cenc")return ye(a,["schi","tenc"])[0]}return null}function Zi(a,o,n){for(var r={},e=ye(a,["moof","traf"]),t=0;t<e.length;t++){var i=e[t],s=ye(i,["tfhd"])[0],l=ue(s,4),u=o[l];if(u){r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});var f=r[l],d=ye(i,["tfdt"])[0];if(d){var h=d[0],c=ue(d,4);h===1&&(c===ir?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(c*=ir+1,c+=ue(d,8))),H(c)&&(!H(f.start)||c<f.start)&&(f.start=c)}var v=u.default,g=ue(s,0)|v?.flags,m=v?.duration||0;g&8&&(g&2?m=ue(s,12):m=ue(s,8));for(var p=ye(i,["trun"]),E=f.start||0,S=0,T=m,A=0;A<p.length;A++){var x=p[A],b=ue(x,4),D=f.sampleCount;f.sampleCount+=b;var k=x[3]&1,R=x[3]&4,L=x[2]&1,I=x[2]&2,P=x[2]&4,U=x[2]&8,w=8,O=b;if(k&&(w+=4),R&&b){var K=x[w+1]&1;!K&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=D),w+=4,L?(T=ue(x,w),w+=4):T=m,I&&(w+=4),U&&(w+=4),E+=T,S+=T,O--}for(;O--;){if(L?(T=ue(x,w),w+=4):T=m,I&&(w+=4),P){var z=x[w+1]&1;z||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(O+1),f.keyFrameStart=E),w+=4}U&&(w+=4),E+=T,S+=T}!S&&m&&(S+=m*b)}f.duration+=S}}if(!Object.keys(r).some(function(fe){return r[fe].duration})){for(var X=1/0,Q=0,ge=ye(a,["sidx"]),$=0;$<ge.length;$++){var J=zn(ge[$]);if(J!=null&&J.references){X=Math.min(X,J.earliestPresentationTime/J.timescale);var re=J.references.reduce(function(fe,_e){return fe+_e.info.duration||0},0);Q=Math.max(Q,re+J.earliestPresentationTime/J.timescale)}}Q&&H(Q)&&Object.keys(r).forEach(function(fe){r[fe].duration||(r[fe].duration=Q*r[fe].timescale-r[fe].start)})}return r}function Ii(a){var o={valid:null,remainder:null},n=ye(a,["moof"]);if(n.length<2)return o.remainder=a,o;var r=n[n.length-1];return o.valid=a.slice(0,r.byteOffset-8),o.remainder=a.slice(r.byteOffset-8),o}function Kt(a,o){var n=new Uint8Array(a.length+o.length);return n.set(a),n.set(o,a.length),n}function ai(a,o){var n=[],r=o.samples,e=o.timescale,t=o.id,i=!1,s=ye(r,["moof"]);return s.map(function(l){var u=l.byteOffset-8,f=ye(l,["traf"]);f.map(function(d){var h=ye(d,["tfdt"]).map(function(c){var v=c[0],g=ue(c,4);return v===1&&(g*=Math.pow(2,32),g+=ue(c,8)),g/e})[0];return h!==void 0&&(a=h),ye(d,["tfhd"]).map(function(c){var v=ue(c,4),g=ue(c,0)&16777215,m=(g&1)!==0,p=(g&2)!==0,E=(g&8)!==0,S=0,T=(g&16)!==0,A=0,x=(g&32)!==0,b=8;v===t&&(m&&(b+=8),p&&(b+=4),E&&(S=ue(c,b),b+=4),T&&(A=ue(c,b),b+=4),x&&(b+=4),o.type==="video"&&(i=_r(o.codec)),ye(d,["trun"]).map(function(D){var k=D[0],R=ue(D,0)&16777215,L=(R&1)!==0,I=0,P=(R&4)!==0,U=(R&256)!==0,w=0,O=(R&512)!==0,K=0,z=(R&1024)!==0,X=(R&2048)!==0,Q=0,ge=ue(D,4),$=8;L&&(I=ue(D,$),$+=4),P&&($+=4);for(var J=I+u,re=0;re<ge;re++){if(U?(w=ue(D,$),$+=4):w=S,O?(K=ue(D,$),$+=4):K=A,z&&($+=4),X&&(k===0?Q=ue(D,$):Q=Ji(D,$),$+=4),o.type===le.VIDEO)for(var fe=0;fe<K;){var _e=ue(r,J);if(J+=4,Jn(i,r[J])){var De=r.subarray(J,J+_e);Gr(De,i?2:1,a+Q/e,n)}J+=_e,fe+=_e+4}a+=w/e}}))})})}),n}function _r(a){if(!a)return!1;var o=a.substring(0,4);return o==="hvc1"||o==="hev1"||o==="dvh1"||o==="dvhe"}function Jn(a,o){if(a){var n=o>>1&63;return n===39||n===40}else{var r=o&31;return r===6}}function Gr(a,o,n,r){var e=si(a),t=0;t+=o;for(var i=0,s=0,l=0;t<e.length;){i=0;do{if(t>=e.length)break;l=e[t++],i+=l}while(l===255);s=0;do{if(t>=e.length)break;l=e[t++],s+=l}while(l===255);var u=e.length-t,f=t;if(s<u)t+=s;else if(s>u){Le.error("Malformed SEI payload. "+s+" is too small, only "+u+" bytes left to parse.");break}if(i===4){var d=e[f++];if(d===181){var h=ur(e,f);if(f+=2,h===49){var c=ue(e,f);if(f+=4,c===1195456820){var v=e[f++];if(v===3){var g=e[f++],m=31&g,p=64&g,E=p?2+m*3:0,S=new Uint8Array(E);if(p){S[0]=g;for(var T=1;T<E;T++)S[T]=e[f++]}r.push({type:v,payloadType:i,pts:n,bytes:S})}}}}}else if(i===5&&s>16){for(var A=[],x=0;x<16;x++){var b=e[f++].toString(16);A.push(b.length==1?"0"+b:b),(x===3||x===5||x===7||x===9)&&A.push("-")}for(var D=s-16,k=new Uint8Array(D),R=0;R<D;R++)k[R]=e[f++];r.push({payloadType:i,pts:n,uuid:A.join(""),userData:Me(k),userDataBytes:k})}}}function si(a){for(var o=a.byteLength,n=[],r=1;r<o-2;)a[r]===0&&a[r+1]===0&&a[r+2]===3?(n.push(r+2),r+=2):r++;if(n.length===0)return a;var e=o-n.length,t=new Uint8Array(e),i=0;for(r=0;r<e;i++,r++)i===n[0]&&(i++,n.shift()),t[r]=a[i];return t}function Zn(a){var o=a[0],n="",r="",e=0,t=0,i=0,s=0,l=0,u=0;if(o===0){for(;Ue(a.subarray(u,u+1))!=="\0";)n+=Ue(a.subarray(u,u+1)),u+=1;for(n+=Ue(a.subarray(u,u+1)),u+=1;Ue(a.subarray(u,u+1))!=="\0";)r+=Ue(a.subarray(u,u+1)),u+=1;r+=Ue(a.subarray(u,u+1)),u+=1,e=ue(a,12),t=ue(a,16),s=ue(a,20),l=ue(a,24),u=28}else if(o===1){u+=4,e=ue(a,u),u+=4;var f=ue(a,u);u+=4;var d=ue(a,u);for(u+=4,i=Math.pow(2,32)*f+d,he(i)||(i=Number.MAX_SAFE_INTEGER,Le.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),s=ue(a,u),u+=4,l=ue(a,u),u+=4;Ue(a.subarray(u,u+1))!=="\0";)n+=Ue(a.subarray(u,u+1)),u+=1;for(n+=Ue(a.subarray(u,u+1)),u+=1;Ue(a.subarray(u,u+1))!=="\0";)r+=Ue(a.subarray(u,u+1)),u+=1;r+=Ue(a.subarray(u,u+1)),u+=1}var h=a.subarray(u,a.byteLength);return{schemeIdUri:n,value:r,timeScale:e,presentationTime:i,presentationTimeDelta:t,eventDuration:s,id:l,payload:h}}function bi(a){for(var o=arguments.length,n=new Array(o>1?o-1:0),r=1;r<o;r++)n[r-1]=arguments[r];for(var e=n.length,t=8,i=e;i--;)t+=n[i].byteLength;var s=new Uint8Array(t);for(s[0]=t>>24&255,s[1]=t>>16&255,s[2]=t>>8&255,s[3]=t&255,s.set(a,4),i=0,t=8;i<e;i++)s.set(n[i],t),t+=n[i].byteLength;return s}function Ri(a,o,n){if(a.byteLength!==16)throw new RangeError("Invalid system id");var r,e;r=0,e=new Uint8Array;var t;r>0?(t=new Uint8Array(4),o.length>0&&new DataView(t.buffer).setUint32(0,o.length,!1)):t=new Uint8Array;var i=new Uint8Array(4);return n.byteLength>0&&new DataView(i.buffer).setUint32(0,n.byteLength,!1),bi([112,115,115,104],new Uint8Array([r,0,0,0]),a,t,e,i,n)}var en=function(){return/\(Windows.+Firefox\//i.test(navigator.userAgent)},yr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function _i(a,o){var n=yr[o];return!!n&&!!n[a.slice(0,4)]}function oi(a,o,n){return n===void 0&&(n=!0),!a.split(",").some(function(r){return!li(r,o,n)})}function li(a,o,n){var r;n===void 0&&(n=!0);var e=Ie(n);return(r=e?.isTypeSupported(Kr(a,o)))!=null?r:!1}function Kr(a,o){return o+"/mp4;codecs="+a}function Di(a){if(a){var o=a.substring(0,4);return yr.video[o]}return 2}function Dr(a){var o=en();return a.split(",").reduce(function(n,r){var e=o&&_r(r),t=e?9:yr.video[r];return t?(t*2+n)/(n?3:2):(yr.audio[r]+n)/(n?2:1)},0)}var ki={};function tn(a,o){if(o===void 0&&(o=!0),ki[a])return ki[a];for(var n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[a],r=0;r<n.length;r++){var e;if(li(n[r],"audio",o))return ki[a]=n[r],n[r];if(n[r]==="mp3"&&(e=Ie(o))!=null&&e.isTypeSupported("audio/mpeg"))return""}return a}var Lt=/flac|opus|mp4a\.40\.34/i;function Xt(a,o){return o===void 0&&(o=!0),a.replace(Lt,function(n){return tn(n.toLowerCase(),o)})}function kr(a,o){var n=[];if(a)for(var r=a.split(","),e=0;e<r.length;e++)_i(r[e],"video")||n.push(r[e]);return o&&n.push(o),n.join(",")}function nr(a,o){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1)&&(Pr(a,"audio")||Pr(a,"video")))return a;if(o){var n=o.split(",");if(n.length>1){if(a){for(var r=n.length;r--;)if(n[r].substring(0,4)===a.substring(0,4))return n[r]}return n[0]}}return o||a}function Pr(a,o){return _i(a,o)&&li(a,o)}function Vt(a){for(var o=a.split(","),n=0;n<o.length;n++){var r=o[n].split(".");r.length>2&&r[0]==="avc1"&&(o[n]="avc1."+parseInt(r[1]).toString(16)+("000"+parseInt(r[2]).toString(16)).slice(-4))}return o.join(",")}function fr(a){if(a.startsWith("av01.")){for(var o=a.split("."),n=["0","111","01","01","01","0"],r=o.length;r>4&&r<10;r++)o[r]=n[r-4];return o.join(".")}return a}function rn(a){var o=Ie(a)||{isTypeSupported:function(){return!1}};return{mpeg:o.isTypeSupported("audio/mpeg"),mp3:o.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:o.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Pi(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var ea={supported:!0,powerEfficient:!0,smooth:!0},ta={supported:!1,smooth:!1,powerEfficient:!1},nn={supported:!0,configurations:[],decodingInfoResults:[ea]};function an(a,o){return{supported:!1,configurations:o,decodingInfoResults:[ta],error:a}}function ra(a,o,n,r,e,t){var i=a.videoCodec,s=a.audioCodec?a.audioGroups:null,l=t?.audioCodec,u=t?.channels,f=u?parseInt(u):l?1/0:2,d=null;if(s!=null&&s.length)try{s.length===1&&s[0]?d=o.groups[s[0]].channels:d=s.reduce(function(h,c){if(c){var v=o.groups[c];if(!v)throw new Error("Audio track group "+c+" not found");Object.keys(v.channels).forEach(function(g){h[g]=(h[g]||0)+v.channels[g]})}return h},{2:0})}catch{return!0}return i!==void 0&&(i.split(",").some(function(h){return _r(h)})||a.width>1920&&a.height>1088||a.height>1920&&a.width>1088||a.frameRate>Math.max(r,30)||a.videoRange!=="SDR"&&a.videoRange!==n||a.bitrate>Math.max(e,8e6))||!!d&&H(f)&&Object.keys(d).some(function(h){return parseInt(h)>f})}function sn(a,o,n,r){r===void 0&&(r={});var e=a.videoCodec;if(!e&&!a.audioCodec||!n)return Promise.resolve(nn);for(var t=[],i=ia(a),s=i.length,l=na(a,o,s>0),u=l.length,f=s||1*u||1;f--;){var d={type:"media-source"};if(s&&(d.video=i[f%s]),u){d.audio=l[f%u];var h=d.audio.bitrate;d.video&&h&&(d.video.bitrate-=h)}t.push(d)}if(e){var c=navigator.userAgent;if(e.split(",").some(function(v){return _r(v)})&&en())return Promise.resolve(an(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: ("+c+")"),t))}return Promise.all(t.map(function(v){var g=sa(v);return r[g]||(r[g]=n.decodingInfo(v))})).then(function(v){return{supported:!v.some(function(g){return!g.supported}),configurations:t,decodingInfoResults:v}}).catch(function(v){return{supported:!1,configurations:t,decodingInfoResults:[],error:v}})}function ia(a){var o,n=(o=a.videoCodec)==null?void 0:o.split(","),r=on(a),e=a.width||640,t=a.height||480,i=a.frameRate||30,s=a.videoRange.toLowerCase();return n?n.map(function(l){var u={contentType:Kr(fr(l),"video"),width:e,height:t,bitrate:r,framerate:i};return s!=="sdr"&&(u.transferFunction=s),u}):[]}function na(a,o,n){var r,e=(r=a.audioCodec)==null?void 0:r.split(","),t=on(a);return e&&a.audioGroups?a.audioGroups.reduce(function(i,s){var l,u=s?(l=o.groups[s])==null?void 0:l.tracks:null;return u?u.reduce(function(f,d){if(d.groupId===s){var h=parseFloat(d.channels||"");e.forEach(function(c){var v={contentType:Kr(c,"audio"),bitrate:n?aa(c,t):t};h&&(v.channels=""+h),f.push(v)})}return f},i):i},[]):[]}function aa(a,o){if(o<=1)return 1;var n=128e3;return a==="ec-3"?n=768e3:a==="ac-3"&&(n=64e4),Math.min(o/2,n)}function on(a){return Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)/1e3)*1e3||1}function sa(a){var o="",n=a.audio,r=a.video;if(r){var e=Pi(r.contentType);o+=e+"_r"+r.height+"x"+r.width+"f"+Math.ceil(r.framerate)+(r.transferFunction||"sd")+"_"+Math.ceil(r.bitrate/1e5)}if(n){var t=Pi(n.contentType);o+=(r?"_":"")+t+"_c"+n.channels}return o}var Ci=["NONE","TYPE-0","TYPE-1",null];function oa(a){return Ci.indexOf(a)>-1}var ui=["SDR","PQ","HLG"];function la(a){return!!a&&ui.indexOf(a)>-1}var fi={No:"",Yes:"YES",v2:"v2"};function Rs(a){var o=a.canSkipUntil,n=a.canSkipDateRanges,r=a.age,e=r<o/2;return o&&e?n?fi.v2:fi.Yes:fi.No}var _s=(function(){function a(n,r,e){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=n,this.part=r,this.skip=e}var o=a.prototype;return o.addDirectives=function(r){var e=new self.URL(r);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},a})(),wi=(function(){function a(n){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[n.url],this._attrs=[n.attrs],this.bitrate=n.bitrate,n.details&&(this.details=n.details),this.id=n.id||0,this.name=n.name,this.width=n.width||0,this.height=n.height||0,this.frameRate=n.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=n.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=n.audioCodec,this.videoCodec=n.videoCodec,this.codecSet=[n.videoCodec,n.audioCodec].filter(function(t){return!!t}).map(function(t){return t.substring(0,4)}).join(","),"supplemental"in n){var r;this.supplemental=n.supplemental;var e=(r=n.supplemental)==null?void 0:r.videoCodec;e&&e!==n.videoCodec&&(this.codecSet+=","+e.substring(0,4))}this.addGroupId("audio",n.attrs.AUDIO),this.addGroupId("text",n.attrs.SUBTITLES)}var o=a.prototype;return o.hasAudioGroup=function(r){return Ds(this._audioGroups,r)},o.hasSubtitleGroup=function(r){return Ds(this._subtitleGroups,r)},o.addGroupId=function(r,e){if(e){if(r==="audio"){var t=this._audioGroups;t||(t=this._audioGroups=[]),t.indexOf(e)===-1&&t.push(e)}else if(r==="text"){var i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(e)===-1&&i.push(e)}}},o.addFallback=function(){},Y(a,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(r){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var r;return(r=this.audioGroups)==null?void 0:r[0]}},{key:"textGroupId",get:function(){var r;return(r=this.subtitleGroups)==null?void 0:r[0]}}])})();function Ds(a,o){return!o||!a?!1:a.indexOf(o)!==-1}function su(){if(typeof matchMedia=="function"){var a=matchMedia("(dynamic-range: high)"),o=matchMedia("bad query");if(a.media!==o.media)return a.matches===!0}return!1}function ou(a,o){var n=!1,r=[];if(a&&(n=a!=="SDR",r=[a]),o){r=o.allowedVideoRanges||ui.slice(0);var e=r.join("")!=="SDR"&&!o.videoCodec;n=o.preferHDR!==void 0?o.preferHDR:e&&su(),n||(r=["SDR"])}return{preferHDR:n,allowedVideoRanges:r}}var lu=function(o){var n=new WeakSet;return function(r,e){if(o&&(e=o(r,e)),typeof e=="object"&&e!==null){if(n.has(e))return;n.add(e)}return e}},He=function(o,n){return JSON.stringify(o,lu(n))};function uu(a,o,n,r,e){for(var t=Object.keys(a),i=r?.channels,s=r?.audioCodec,l=e?.videoCodec,u=i&&parseInt(i)===2,f=!1,d=!1,h=1/0,c=1/0,v=1/0,g=1/0,m=0,p=[],E=ou(o,e),S=E.preferHDR,T=E.allowedVideoRanges,A=function(){var I=a[t[x]];f||(f=I.channels[2]>0),h=Math.min(h,I.minHeight),c=Math.min(c,I.minFramerate),v=Math.min(v,I.minBitrate);var P=T.filter(function(U){return I.videoRanges[U]>0});P.length>0&&(d=!0)},x=t.length;x--;)A();h=H(h)?h:0,c=H(c)?c:0;var b=Math.max(1080,h),D=Math.max(30,c);v=H(v)?v:n,n=Math.max(v,n),d||(o=void 0);var k=t.length>1,R=t.reduce(function(L,I){var P=a[I];if(I===L)return L;if(p=d?T.filter(function(U){return P.videoRanges[U]>0}):[],k){if(P.minBitrate>n)return dr(I,"min bitrate of "+P.minBitrate+" > current estimate of "+n),L;if(!P.hasDefaultAudio)return dr(I,"no renditions with default or auto-select sound found"),L;if(s&&I.indexOf(s.substring(0,4))%5!==0)return dr(I,'audio codec preference "'+s+'" not found'),L;if(i&&!u){if(!P.channels[i])return dr(I,"no renditions with "+i+" channel sound found (channels options: "+Object.keys(P.channels)+")"),L}else if((!s||u)&&f&&P.channels[2]===0)return dr(I,"no renditions with stereo sound found"),L;if(P.minHeight>b)return dr(I,"min resolution of "+P.minHeight+" > maximum of "+b),L;if(P.minFramerate>D)return dr(I,"min framerate of "+P.minFramerate+" > maximum of "+D),L;if(!p.some(function(U){return P.videoRanges[U]>0}))return dr(I,"no variants with VIDEO-RANGE of "+He(p)+" found"),L;if(l&&I.indexOf(l.substring(0,4))%5!==0)return dr(I,'video codec preference "'+l+'" not found'),L;if(P.maxScore<m)return dr(I,"max score of "+P.maxScore+" < selected max of "+m),L}return L&&(Dr(I)>=Dr(L)||P.fragmentError>a[L].fragmentError)?L:(g=P.minIndex,m=P.maxScore,I)},void 0);return{codecSet:R,videoRanges:p,preferHDR:S,minFramerate:c,minBitrate:v,minIndex:g}}function dr(a,o){Le.log('[abr] start candidates with "'+a+'" ignored because '+o)}function ks(a){return a.reduce(function(o,n){var r=o.groups[n.groupId];r||(r=o.groups[n.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(n);var e=n.channels||"2";return r.channels[e]=(r.channels[e]||0)+1,r.hasDefault=r.hasDefault||n.default,r.hasAutoSelect=r.hasAutoSelect||n.autoselect,r.hasDefault&&(o.hasDefaultAudio=!0),r.hasAutoSelect&&(o.hasAutoSelectAudio=!0),o},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function fu(a,o,n,r){return a.slice(n,r+1).reduce(function(e,t,i){if(!t.codecSet)return e;var s=t.audioGroups,l=e[t.codecSet];l||(e[t.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!s,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,t.bitrate);var u=Math.min(t.height,t.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,t.frameRate),l.minIndex=Math.min(l.minIndex,i),l.maxScore=Math.max(l.maxScore,t.score),l.fragmentError+=t.fragmentError,l.videoRanges[t.videoRange]=(l.videoRanges[t.videoRange]||0)+1,s&&s.forEach(function(f){if(f){var d=o.groups[f];d&&(l.hasDefaultAudio=l.hasDefaultAudio||o.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!o.hasDefaultAudio&&!o.hasAutoSelectAudio,Object.keys(d.channels).forEach(function(h){l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}}),e},{})}function Ps(a){if(!a)return a;var o=a,n=o.lang,r=o.assocLang,e=o.characteristics,t=o.channels,i=o.audioCodec;return{lang:n,assocLang:r,characteristics:e,channels:t,audioCodec:i}}function hr(a,o,n){if("attrs"in a){var r=o.indexOf(a);if(r!==-1)return r}for(var e=0;e<o.length;e++){var t=o[e];if(Vr(a,t,n))return e}return-1}function Vr(a,o,n){var r=a.groupId,e=a.name,t=a.lang,i=a.assocLang,s=a.default,l=a.forced;return(r===void 0||o.groupId===r)&&(e===void 0||o.name===e)&&(t===void 0||du(t,o.lang))&&(t===void 0||o.assocLang===i)&&(s===void 0||o.default===s)&&(l===void 0||o.forced===l)&&(!("characteristics"in a)||hu(a.characteristics||"",o.characteristics))&&(n===void 0||n(a,o))}function du(a,o){return o===void 0&&(o="--"),a.length===o.length?a===o:a.startsWith(o)||o.startsWith(a)}function hu(a,o){o===void 0&&(o="");var n=a.split(","),r=o.split(",");return n.length===r.length&&!n.some(function(e){return r.indexOf(e)===-1})}function Hr(a,o){var n=a.audioCodec,r=a.channels;return(n===void 0||(o.audioCodec||"").substring(0,4)===n.substring(0,4))&&(r===void 0||r===(o.channels||"2"))}function cu(a,o,n,r,e){var t=o[r],i=o.reduce(function(h,c,v){var g=c.uri,m=h[g]||(h[g]=[]);return m.push(v),h},{}),s=i[t.uri];s.length>1&&(r=Math.max.apply(Math,s));var l=t.videoRange,u=t.frameRate,f=t.codecSet.substring(0,4),d=Cs(o,r,function(h){if(h.videoRange!==l||h.frameRate!==u||h.codecSet.substring(0,4)!==f)return!1;var c=h.audioGroups,v=n.filter(function(g){return!c||c.indexOf(g.groupId)!==-1});return hr(a,v,e)>-1});return d>-1?d:Cs(o,r,function(h){var c=h.audioGroups,v=n.filter(function(g){return!c||c.indexOf(g.groupId)!==-1});return hr(a,v,e)>-1})}function Cs(a,o,n){for(var r=o;r>-1;r--)if(n(a[r]))return r;for(var e=o+1;e<a.length;e++)if(n(a[e]))return e;return-1}function ln(a,o){var n;return!!a&&a!==((n=o.loadLevelObj)==null?void 0:n.uri)}var vu=(function(a){function o(r){var e;return e=a.call(this,"abr",r.logger)||this,e.hls=void 0,e.lastLevelLoadSec=0,e.lastLoadedFragLevel=-1,e.firstSelection=-1,e._nextAutoLevel=-1,e.nextAutoLevelKey="",e.audioTracksByGroup=null,e.codecTiers=null,e.timer=-1,e.fragCurrent=null,e.partCurrent=null,e.bitrateTestDelay=0,e.rebufferNotice=-1,e.supportedCache={},e.bwEstimator=void 0,e._abandonRulesCheck=function(t){var i,s=e,l=s.fragCurrent,u=s.partCurrent,f=s.hls,d=f.autoLevelEnabled,h=f.media;if(!(!l||!h)){var c=performance.now(),v=u?u.stats:l.stats,g=u?u.duration:l.duration,m=c-v.loading.start,p=f.minAutoLevel,E=l.level,S=e._nextAutoLevel;if(v.aborted||v.loaded&&v.loaded===v.total||E<=p){e.clearTimer(),e._nextAutoLevel=-1;return}if(d){var T=S>-1&&S!==E,A=!!t||T;if(!(!A&&(h.paused||!h.playbackRate||!h.readyState))){var x=f.mainForwardBufferInfo;if(!(!A&&x===null)){var b=e.bwEstimator.getEstimateTTFB(),D=Math.abs(h.playbackRate);if(!(m<=Math.max(b,1e3*(g/(D*2))))){var k=x?x.len/D:0,R=v.loading.first?v.loading.first-v.loading.start:-1,L=v.loaded&&R>-1,I=e.getBwEstimate(),P=f.levels,U=P[E],w=Math.max(v.loaded,Math.round(g*(l.bitrate||U.averageBitrate)/8)),O=L?m-R:m;O<1&&L&&(O=Math.min(m,v.loaded*8/I));var K=L?v.loaded*1e3/O:0,z=b/1e3,X=K?(w-v.loaded)/K:w*8/I+z;if(!(X<=k)){var Q=K?K*8:I,ge=((i=t?.details||e.hls.latestLevelDetails)==null?void 0:i.live)===!0,$=e.hls.config.abrBandWidthUpFactor,J=Number.POSITIVE_INFINITY,re;for(re=E-1;re>p;re--){var fe=P[re].maxBitrate,_e=!P[re].details||ge;if(J=e.getTimeToLoadFrag(z,Q,g*fe,_e),J<Math.min(k,g+z))break}if(!(J>=X)&&!(J>g*10)){L?e.bwEstimator.sample(m-Math.min(b,R),v.loaded):e.bwEstimator.sampleTTFB(m);var De=P[re].maxBitrate;e.getBwEstimate()*$>De&&e.resetEstimator(De);var Ye=e.findBestLevel(De,p,re,0,k,1,1);Ye>-1&&(re=Ye),e.warn("Fragment "+l.sn+(u?" part "+u.index:"")+" of level "+E+` is loading too slowly;
      Fragment duration: `+l.duration.toFixed(3)+`
      Time to underbuffer: `+k.toFixed(3)+` s
      Estimated load time for current fragment: `+X.toFixed(3)+` s
      Estimated load time for down switch fragment: `+J.toFixed(3)+` s
      TTFB estimate: `+(R|0)+` ms
      Current BW estimate: `+(H(I)?I|0:"Unknown")+` bps
      New BW estimate: `+(e.getBwEstimate()|0)+` bps
      Switching to level `+re+" @ "+(De|0)+" bps"),f.nextLoadLevel=f.nextAutoLevel=re,e.clearTimer();var qe=function(){if(e.clearTimer(),e.fragCurrent===l&&e.hls.loadLevel===re&&re>0){var It=e.getStarvationDelay();if(e.warn("Aborting inflight request "+(re>0?"and switching down":"")+`
      Fragment duration: `+l.duration.toFixed(3)+` s
      Time to underbuffer: `+It.toFixed(3)+" s"),l.abortRequests(),e.fragCurrent=e.partCurrent=null,re>p){var Be=e.findBestLevel(e.hls.levels[p].bitrate,p,re,0,It,1,1);Be===-1&&(Be=p),e.hls.nextLoadLevel=e.hls.nextAutoLevel=Be,e.resetEstimator(e.hls.levels[Be].bitrate)}}};T||X>J*2?qe():e.timer=self.setInterval(qe,J*1e3),f.trigger(y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:u,stats:v})}}}}}}}},e.hls=r,e.bwEstimator=e.initEstimator(),e.registerListeners(),e}se(o,a);var n=o.prototype;return n.resetEstimator=function(e){e&&(this.log("setting initial bwe to "+e),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},n.initEstimator=function(){var e=this.hls.config;return new We(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)},n.registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(y.ERROR,this.onError,this))},n.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null},n.onManifestLoading=function(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},n.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},n.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},n.onFragLoading=function(e,t){var i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}},n.onLevelSwitching=function(e,t){this.clearTimer()},n.onError=function(e,t){if(!t.fatal)switch(t.details){case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case _.FRAG_LOAD_TIMEOUT:{var i=t.frag,s=this.fragCurrent,l=this.partCurrent;if(i&&s&&i.sn===s.sn&&i.level===s.level){var u=performance.now(),f=l?l.stats:i.stats,d=u-f.loading.start,h=f.loading.first?f.loading.first-f.loading.start:-1,c=f.loaded&&h>-1;if(c){var v=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(v,h),f.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}},n.getTimeToLoadFrag=function(e,t,i,s){var l=e+i/t,u=s?e+this.lastLevelLoadSec:0;return l+u},n.onLevelLoaded=function(e,t){var i=this.hls.config,s=t.stats.loading,l=s.end-s.first;H(l)&&(this.lastLevelLoadSec=l/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)},n.onFragLoaded=function(e,t){var i=t.frag,s=t.part,l=s?s.stats:i.stats;if(i.type===F.MAIN&&this.bwEstimator.sampleTTFB(l.loading.first-l.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),i.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var u=s?s.duration:i.duration,f=this.hls.levels[i.level],d=(f.loaded?f.loaded.bytes:0)+l.loaded,h=(f.loaded?f.loaded.duration:0)+u;f.loaded={bytes:d,duration:h},f.realBitrate=Math.round(8*d/h)}if(i.bitrateTest){var c={stats:l,frag:i,part:s,id:i.type};this.onFragBuffered(y.FRAG_BUFFERED,c),i.bitrateTest=!1}else this.lastLoadedFragLevel=i.level}},n.onFragBuffered=function(e,t){var i=t.frag,s=t.part,l=s!=null&&s.stats.loaded?s.stats:i.stats;if(!l.aborted&&!this.ignoreFragment(i)){var u=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(u,l.loaded),l.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}},n.ignoreFragment=function(e){return e.type!==F.MAIN||e.sn==="initSegment"},n.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},n.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},n.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,i=this.hls;if(i.levels.length<=1)return i.loadLevel;var s=i.maxAutoLevel,l=i.config,u=i.minAutoLevel,f=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),h=this.getStarvationDelay(),c=l.abrBandWidthFactor,v=l.abrBandWidthUpFactor;if(h){var g=this.findBestLevel(d,u,s,h,0,c,v);if(g>=0)return this.rebufferNotice=-1,g}var m=f?Math.min(f,l.maxStarvationDelay):l.maxStarvationDelay;if(!h){var p=this.bitrateTestDelay;if(p){var E=f?Math.min(f,l.maxLoadingDelay):l.maxLoadingDelay;m=E-p,this.info("bitrate test took "+Math.round(1e3*p)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),c=v=1}}var S=this.findBestLevel(d,u,s,h,m,c,v);if(this.rebufferNotice!==S&&(this.rebufferNotice=S,this.info((h?"rebuffering expected":"buffer is empty")+", optimal quality level "+S)),S>-1)return S;var T=i.levels[u],A=i.loadLevelObj;return A&&T?.bitrate<A.bitrate?u:i.loadLevel},n.getStarvationDelay=function(){var e=this.hls,t=e.media;if(!t)return 1/0;var i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i},n.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},n.findBestLevel=function(e,t,i,s,l,u,f){var d,h=this,c=s+l,v=this.lastLoadedFragLevel,g=v===-1?this.hls.firstLevel:v,m=this.fragCurrent,p=this.partCurrent,E=this.hls,S=E.levels,T=E.allAudioTracks,A=E.loadLevel,x=E.config;if(S.length===1)return 0;var b=S[g],D=!!((d=this.hls.latestLevelDetails)!=null&&d.live),k=A===-1||v===-1,R,L="SDR",I=b?.frameRate||0,P=x.audioPreference,U=x.videoPreference,w=this.audioTracksByGroup||(this.audioTracksByGroup=ks(T)),O=-1;if(k){if(this.firstSelection!==-1)return this.firstSelection;var K=this.codecTiers||(this.codecTiers=fu(S,w,t,i)),z=uu(K,L,e,P,U),X=z.codecSet,Q=z.videoRanges,ge=z.minFramerate,$=z.minBitrate,J=z.minIndex,re=z.preferHDR;O=J,R=X,L=re?Q[Q.length-1]:Q[0],I=ge,e=Math.max(e,$),this.log("picked start tier "+He(z))}else R=b?.codecSet,L=b?.videoRange;for(var fe=p?p.duration:m?m.duration:0,_e=this.bwEstimator.getEstimateTTFB()/1e3,De=[],Ye=function(){var Be,Ae=S[Oe],nt=Oe>g;if(!Ae)return 0;if(x.useMediaCapabilities&&!Ae.supportedResult&&!Ae.supportedPromise){var bt=navigator.mediaCapabilities;typeof bt?.decodingInfo=="function"&&ra(Ae,w,L,I,e,P)?(Ae.supportedPromise=sn(Ae,w,bt,h.supportedCache),Ae.supportedPromise.then(function(Tt){if(h.hls){Ae.supportedResult=Tt;var zr=h.hls.levels,$t=zr.indexOf(Ae);Tt.error?h.warn('MediaCapabilities decodingInfo error: "'+Tt.error+'" for level '+$t+" "+He(Tt)):Tt.supported?Tt.decodingInfoResults.some(function(Qr){return Qr.smooth===!1||Qr.powerEfficient===!1})&&h.log("MediaCapabilities decodingInfo for level "+$t+" not smooth or powerEfficient: "+He(Tt)):(h.warn("Unsupported MediaCapabilities decodingInfo result for level "+$t+" "+He(Tt)),$t>-1&&zr.length>1&&(h.log("Removing unsupported level "+$t),h.hls.removeLevel($t),h.hls.loadLevel===-1&&(h.hls.nextLoadLevel=0)))}}).catch(function(Tt){h.warn("Error handling MediaCapabilities decodingInfo: "+Tt)})):Ae.supportedResult=nn}if((R&&Ae.codecSet!==R||L&&Ae.videoRange!==L||nt&&I>Ae.frameRate||!nt&&I>0&&I<Ae.frameRate||(Be=Ae.supportedResult)!=null&&(Be=Be.decodingInfoResults)!=null&&Be.some(function(Tt){return Tt.smooth===!1}))&&(!k||Oe!==O))return De.push(Oe),0;var ut=Ae.details,tt=(p?ut?.partTarget:ut?.averagetargetduration)||fe,Pt;nt?Pt=f*e:Pt=u*e;var Ct=fe&&s>=fe*2&&l===0?Ae.averageBitrate:Ae.maxBitrate,wt=h.getTimeToLoadFrag(_e,Pt,Ct*tt,ut===void 0),ft=Pt>=Ct&&(Oe===v||Ae.loadError===0&&Ae.fragmentError===0)&&(wt<=_e||!H(wt)||D&&!h.bitrateTestDelay||wt<c);if(ft){var vt=h.forcedAutoLevel;return Oe!==A&&(vt===-1||vt!==A)&&(De.length&&h.trace("Skipped level(s) "+De.join(",")+" of "+i+' max with CODECS and VIDEO-RANGE:"'+S[De[0]].codecs+'" '+S[De[0]].videoRange+'; not compatible with "'+R+'" '+L),h.info("switch candidate:"+g+"->"+Oe+" adjustedbw("+Math.round(Pt)+")-bitrate="+Math.round(Pt-Ct)+" ttfb:"+_e.toFixed(1)+" avgDuration:"+tt.toFixed(1)+" maxFetchDuration:"+c.toFixed(1)+" fetchDuration:"+wt.toFixed(1)+" firstSelection:"+k+" codecSet:"+Ae.codecSet+" videoRange:"+Ae.videoRange+" hls.loadLevel:"+A)),k&&(h.firstSelection=Oe),{v:Oe}}},qe,Oe=i;Oe>=t;Oe--)if(qe=Ye(),qe!==0&&qe)return qe.v;return-1},n.deriveNextAutoLevel=function(e){var t=this.hls,i=t.maxAutoLevel,s=t.minAutoLevel;return Math.min(Math.max(e,s),i)},Y(o,[{key:"firstAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.minAutoLevel,s=this.getBwEstimate(),l=this.hls.config.maxStarvationDelay,u=this.findBestLevel(s,i,t,0,l,1,1);if(u>-1)return u;var f=this.hls.firstLevel,d=Math.min(Math.max(f,i),t);return this.warn("Could not find best starting auto level. Defaulting to first in playlist "+f+" clamped to "+d),d}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var e=this.forcedAutoLevel,t=this.bwEstimator,i=t.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;var l=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){var u=this.hls.levels;if(u.length>Math.max(e,l)&&u[e].loadError<=u[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l},set:function(e){var t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}}])})(te),ws={search:function(o,n){for(var r=0,e=o.length-1,t=null,i=null;r<=e;){t=(r+e)/2|0,i=o[t];var s=n(i);if(s>0)r=t+1;else if(s<0)e=t-1;else return i}return null}};function gu(a,o,n){if(o===null||!Array.isArray(a)||!a.length||!H(o))return null;var r=a[0].programDateTime;if(o<(r||0))return null;var e=a[a.length-1].endProgramDateTime;if(o>=(e||0))return null;for(var t=0;t<a.length;++t){var i=a[t];if(pu(o,n,i))return i}return null}function Yr(a,o,n,r,e){n===void 0&&(n=0),r===void 0&&(r=0),e===void 0&&(e=.005);var t=null;if(a){t=o[1+a.sn-o[0].sn]||null;var i=a.endDTS-n;i>0&&i<15e-7&&(n+=15e-7),t&&a.level!==t.level&&t.end<=a.end&&(t=o[2+a.sn-o[0].sn]||null)}else n===0&&o[0].start===0&&(t=o[0]);if(t&&((!a||a.level===t.level)&&Ms(n,r,t)===0||mu(t,a,Math.min(e,r))))return t;var s=ws.search(o,Ms.bind(null,n,r));return s&&(s!==a||!t)?s:t}function mu(a,o,n){if(o&&o.start===0&&o.level<a.level&&(o.endPTS||0)>0){var r=o.tagList.reduce(function(e,t){return t[0]==="INF"&&(e+=parseFloat(t[1])),e},n);return a.start<=r}return!1}function Ms(a,o,n){if(a===void 0&&(a=0),o===void 0&&(o=0),n.start<=a&&n.start+n.duration>a)return 0;var r=Math.min(o,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=a?1:n.start-r>a&&n.start?-1:0}function pu(a,o,n){var r=Math.min(o,n.duration+(n.deltaPTS?n.deltaPTS:0))*1e3,e=n.endProgramDateTime||0;return e-r>a}function Os(a,o,n){if(a&&a.startCC<=o&&a.endCC>=o){var r=a.fragments,e=a.fragmentHint;e&&(r=r.concat(e));var t;return ws.search(r,function(i){return i.cc<o?1:i.cc>o?-1:(t=i,i.end<=n?1:i.start>n?-1:0)}),t||null}return null}function un(a){switch(a.details){case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_TIMEOUT:case _.LEVEL_LOAD_TIMEOUT:case _.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Fs(a,o){var n=un(o);return a.default[(n?"timeout":"error")+"Retry"]}function ua(a,o){var n=a.backoff==="linear"?1:Math.pow(2,o);return Math.min(n*a.retryDelayMs,a.maxRetryDelayMs)}function Ns(a){return Te(Te({},a),{errorRetry:null,timeoutRetry:null})}function fn(a,o,n,r){if(!a)return!1;var e=r?.code,t=o<a.maxNumRetry&&(yu(e)||!!n);return a.shouldRetry?a.shouldRetry(a,o,n,r,t):t}function yu(a){return fa(a)||!!a&&(a<400||a>499)}function fa(a){return a===0&&navigator.onLine===!1}var yt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},zt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4},Eu=(function(a){function o(r){var e;return e=a.call(this,"error-controller",r.logger)||this,e.hls=void 0,e.playlistError=0,e.hls=r,e.registerListeners(),e}se(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.ERROR,this.onError,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.ERROR,this.onError,this),e.off(y.ERROR,this.onErrorOut,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this))},n.destroy=function(){this.unregisterListeners(),this.hls=null},n.startLoad=function(e){},n.stopLoad=function(){this.playlistError=0},n.getVariantLevelIndex=function(e){return e?.type===F.MAIN?e.level:this.getVariantIndex()},n.getVariantIndex=function(){var e,t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i},n.variantHasKey=function(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;var s=e.audioGroups;if(s){var l=this.hls.allAudioTracks.filter(function(u){return s.indexOf(u.groupId)>=0});return l.some(function(u){var f;return(f=u.details)==null?void 0:f.hasKey(t)})}}return!1},n.onManifestLoading=function(){this.playlistError=0},n.onLevelUpdated=function(){this.playlistError=0},n.onError=function(e,t){var i;if(!t.fatal){var s=this.hls,l=t.context;switch(t.details){case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case _.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=di();return}case _.FRAG_GAP:case _.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=yt.SendAlternateToPenaltyBox;return}case _.LEVEL_EMPTY_ERROR:case _.LEVEL_PARSING_ERROR:{var u,f=t.parent===F.MAIN?t.level:s.loadLevel;t.details===_.LEVEL_EMPTY_ERROR&&((u=t.context)!=null&&(u=u.levelDetails)!=null&&u.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:typeof l?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l.level));return;case _.AUDIO_TRACK_LOAD_ERROR:case _.AUDIO_TRACK_LOAD_TIMEOUT:case _.SUBTITLE_LOAD_ERROR:case _.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){var d=s.loadLevelObj;if(d&&(l.type===N.AUDIO_TRACK&&d.hasAudioGroup(l.groupId)||l.type===N.SUBTITLE_TRACK&&d.hasSubtitleGroup(l.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=yt.SendAlternateToPenaltyBox,t.errorAction.flags=zt.MoveAllAlternatesMatchingHost;return}}return;case _.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:yt.SendAlternateToPenaltyBox,flags:zt.MoveAllAlternatesMatchingHDCP};return;case _.KEY_SYSTEM_SESSION_UPDATE_FAILED:case _.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case _.KEY_SYSTEM_NO_SESSION:t.errorAction={action:yt.SendAlternateToPenaltyBox,flags:zt.MoveAllAlternatesMatchingKey};return;case _.BUFFER_ADD_CODEC_ERROR:case _.REMUX_ALLOC_ERROR:case _.BUFFER_APPEND_ERROR:if(!t.errorAction){var h;t.errorAction=this.getLevelSwitchAction(t,(h=t.level)!=null?h:s.loadLevel)}return;case _.INTERNAL_EXCEPTION:case _.BUFFER_APPENDING_ERROR:case _.BUFFER_FULL_ERROR:case _.LEVEL_SWITCH_ERROR:case _.BUFFER_STALLED_ERROR:case _.BUFFER_SEEK_OVER_HOLE:case _.BUFFER_NUDGE_ON_STALL:t.errorAction=di();return}t.type===W.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=di())}},n.getPlaylistRetryOrSwitchAction=function(e,t){var i=this.hls,s=Fs(i.config.playlistLoadPolicy,e),l=this.playlistError++,u=fn(s,l,un(e),e.response);if(u)return{action:yt.RetryRequest,flags:zt.None,retryConfig:s,retryCount:l};var f=this.getLevelSwitchAction(e,t);return s&&(f.retryConfig=s,f.retryCount=l),f},n.getFragRetryOrSwitchAction=function(e){var t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],l=t.config,u=l.fragLoadPolicy,f=l.keyLoadPolicy,d=Fs(e.details.startsWith("key")?f:u,e),h=t.levels.reduce(function(g,m){return g+m.fragmentError},0);if(s){e.details!==_.FRAG_GAP&&s.fragmentError++;var c=fn(d,h,un(e),e.response);if(c)return{action:yt.RetryRequest,flags:zt.None,retryConfig:d,retryCount:h}}var v=this.getLevelSwitchAction(e,i);return d&&(v.retryConfig=d,v.retryCount=h),v},n.getLevelSwitchAction=function(e,t){var i=this.hls;t==null&&(t=i.loadLevel);var s=this.hls.levels[t];if(s){var l,u,f=e.details;s.loadError++,f===_.BUFFER_APPEND_ERROR&&s.fragmentError++;var d=-1,h=i.levels,c=i.loadLevel,v=i.minAutoLevel,g=i.maxAutoLevel;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);for(var m=(l=e.frag)==null?void 0:l.type,p=m===F.AUDIO&&f===_.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===_.BUFFER_ADD_CODEC_ERROR||f===_.BUFFER_APPEND_ERROR),E=p&&h.some(function(L){var I=L.audioCodec;return s.audioCodec!==I}),S=e.sourceBufferName==="video"&&(f===_.BUFFER_ADD_CODEC_ERROR||f===_.BUFFER_APPEND_ERROR),T=S&&h.some(function(L){var I=L.codecSet,P=L.audioCodec;return s.codecSet!==I&&s.audioCodec===P}),A=(u=e.context)!=null?u:{},x=A.type,b=A.groupId,D=function(){var I=(R+c)%h.length;if(I!==c&&I>=v&&I<=g&&h[I].loadError===0){var P,U,w=h[I];if(f===_.FRAG_GAP&&m===F.MAIN&&e.frag){var O=h[I].details;if(O){var K=Yr(e.frag,O.fragments,e.frag.start);if(K!=null&&K.gap)return 0}}else{if(x===N.AUDIO_TRACK&&w.hasAudioGroup(b)||x===N.SUBTITLE_TRACK&&w.hasSubtitleGroup(b))return 0;if(m===F.AUDIO&&(P=s.audioGroups)!=null&&P.some(function(z){return w.hasAudioGroup(z)})||m===F.SUBTITLE&&(U=s.subtitleGroups)!=null&&U.some(function(z){return w.hasSubtitleGroup(z)})||E&&s.audioCodec===w.audioCodec||T&&s.codecSet===w.codecSet||!E&&s.codecSet!==w.codecSet)return 0}return d=I,1}},k,R=h.length;R--&&(k=D(),!(k!==0&&k===1)););if(d>-1&&i.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:yt.SendAlternateToPenaltyBox,flags:zt.None,nextAutoLevel:d}}return{action:yt.SendAlternateToPenaltyBox,flags:zt.MoveAllAlternatesMatchingHost}},n.onErrorOut=function(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case yt.DoNothing:break;case yt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==_.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'+t.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}},n.sendAlternateToPenaltyBox=function(e){var t=this.hls,i=e.errorAction;if(i){var s=i.flags,l=i.nextAutoLevel;switch(s){case zt.None:this.switchLevel(e,l);break;case zt.MoveAllAlternatesMatchingHDCP:{var u=this.getVariantLevelIndex(e.frag),f=t.levels[u],d=f?.attrs["HDCP-LEVEL"];if(i.hdcpLevel=d,d){t.maxHdcpLevel=Ci[Ci.indexOf(d)-1],i.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower');break}}case zt.MoveAllAlternatesMatchingKey:{var h=e.decryptdata;if(h){for(var c=this.hls.levels,v=c.length;v--;)if(this.variantHasKey(c[v],h)){var g,m;this.log("Banned key found in level "+v+" ("+c[v].bitrate+'bps) or audio group "'+((g=c[v].audioGroups)==null?void 0:g.join(","))+'" ('+((m=e.frag)==null?void 0:m.type)+" fragment) "+Ke(h.keyId||[])),c[v].fragmentError++,c[v].loadError++,this.log("Removing level "+v+" with key error ("+e.error+")"),this.hls.removeLevel(v)}c.length&&(i.resolved=!0)}break}}i.resolved||this.switchLevel(e,l)}},n.switchLevel=function(e,t){if(t!==void 0&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===_.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo"))for(var i=Pi(e.mimeType),s=this.hls.levels,l=s.length;l--;)s[l][e.sourceBufferName+"Codec"]===i&&(this.log("Removing level "+l+" for "+e.details+' ("'+i+'" not supported)'),this.hls.removeLevel(l))},o})(te);function di(a){var o={action:yt.DoNothing,flags:zt.None};return a&&(o.resolved=!0),o}var lt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Tu=(function(){function a(n){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=n,this._registerListeners()}var o=a.prototype;return o._registerListeners=function(){var r=this.hls;r&&(r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.BUFFER_APPENDED,this.onBufferAppended,this),r.on(y.FRAG_BUFFERED,this.onFragBuffered,this),r.on(y.FRAG_LOADED,this.onFragLoaded,this))},o._unregisterListeners=function(){var r=this.hls;r&&(r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.BUFFER_APPENDED,this.onBufferAppended,this),r.off(y.FRAG_BUFFERED,this.onFragBuffered,this),r.off(y.FRAG_LOADED,this.onFragLoaded,this))},o.destroy=function(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},o.getAppendedFrag=function(r,e){var t=this.activePartLists[e];if(t)for(var i=t.length;i--;){var s=t[i];if(!s)break;if(s.start<=r&&r<=s.end&&s.loaded)return s}return this.getBufferedFrag(r,e)},o.getBufferedFrag=function(r,e){return this.getFragAtPos(r,e,!0)},o.getFragAtPos=function(r,e,t){for(var i=this.fragments,s=Object.keys(i),l=s.length;l--;){var u=i[s[l]];if(u?.body.type===e&&(!t||u.buffered)){var f=u.body;if(f.start<=r&&r<=f.end)return f}}return null},o.detectEvictedFragments=function(r,e,t,i,s){var l=this;this.timeRanges&&(this.timeRanges[r]=e);var u=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(function(f){var d=l.fragments[f];if(d&&!(u>=d.body.sn)){if(!d.buffered&&(!d.loaded||s)){d.body.type===t&&l.removeFragment(d.body);return}var h=d.range[r];if(h){if(h.time.length===0){l.removeFragment(d.body);return}h.time.some(function(c){var v=!l.isTimeBuffered(c.startPTS,c.endPTS,e);return v&&l.removeFragment(d.body),v})}}})},o.detectPartialFragments=function(r){var e=this,t=this.timeRanges;if(!(!t||r.frag.sn==="initSegment")){var i=r.frag,s=hi(i),l=this.fragments[s];if(!(!l||l.buffered&&i.gap)){var u=!i.relurl;if(Object.keys(t).forEach(function(d){var h=i.elementaryStreams[d];if(h){var c=t[d],v=u||h.partial===!0;l.range[d]=e.getBufferedTimes(i,r.part,v,c)}}),l.loaded=null,Object.keys(l.range).length){l.buffered=!0;var f=l.body.endList=i.endList||l.body.endList;f&&(this.endListFragments[l.body.type]=l),dn(l)||this.removeParts(i.sn-1,i.type)}else this.removeFragment(l.body)}}},o.removeParts=function(r,e){var t=this.activePartLists[e];t&&(this.activePartLists[e]=Us(t,function(i){return i.fragment.sn>=r}))},o.fragBuffered=function(r,e){var t=hi(r),i=this.fragments[t];!i&&e&&(i=this.fragments[t]={body:r,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},r.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},o.getBufferedTimes=function(r,e,t,i){for(var s={time:[],partial:t},l=r.start,u=r.end,f=r.minEndPTS||u,d=r.maxStartPTS||l,h=0;h<i.length;h++){var c=i.start(h)-this.bufferPadding,v=i.end(h)+this.bufferPadding;if(d>=c&&f<=v){s.time.push({startPTS:Math.max(l,i.start(h)),endPTS:Math.min(u,i.end(h))});break}else if(l<v&&u>c){var g=Math.max(l,i.start(h)),m=Math.min(u,i.end(h));m>g&&(s.partial=!0,s.time.push({startPTS:g,endPTS:m}))}else if(u<=c)break}return s},o.getPartialFragment=function(r){var e=null,t,i,s,l=0,u=this.bufferPadding,f=this.fragments;return Object.keys(f).forEach(function(d){var h=f[d];h&&dn(h)&&(i=h.body.start-u,s=h.body.end+u,r>=i&&r<=s&&(t=Math.min(r-i,s-r),l<=t&&(e=h.body,l=t)))}),e},o.isEndListAppended=function(r){var e=this.endListFragments[r];return e!==void 0&&(e.buffered||dn(e))},o.getState=function(r){var e=hi(r),t=this.fragments[e];return t?t.buffered?dn(t)?lt.PARTIAL:lt.OK:lt.APPENDING:lt.NOT_LOADED},o.isTimeBuffered=function(r,e,t){for(var i,s,l=0;l<t.length;l++){if(i=t.start(l)-this.bufferPadding,s=t.end(l)+this.bufferPadding,r>=i&&e<=s)return!0;if(e<=i)return!1}return!1},o.onManifestLoading=function(){this.removeAllFragments()},o.onFragLoaded=function(r,e){if(!(e.frag.sn==="initSegment"||e.frag.bitrateTest)){var t=e.frag,i=e.part?null:e,s=hi(t);this.fragments[s]={body:t,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}},o.onBufferAppended=function(r,e){var t=e.frag,i=e.part,s=e.timeRanges,l=e.type;if(t.sn!=="initSegment"){var u=t.type;if(i){var f=this.activePartLists[u];f||(this.activePartLists[u]=f=[]),f.push(i)}this.timeRanges=s;var d=s[l];this.detectEvictedFragments(l,d,u,i)}},o.onFragBuffered=function(r,e){this.detectPartialFragments(e)},o.hasFragment=function(r){var e=hi(r);return!!this.fragments[e]},o.hasFragments=function(r){var e=this.fragments,t=Object.keys(e);if(!r)return t.length>0;for(var i=t.length;i--;){var s=e[t[i]];if(s?.body.type===r)return!0}return!1},o.hasParts=function(r){var e;return!!((e=this.activePartLists[r])!=null&&e.length)},o.removeFragmentsInRange=function(r,e,t,i,s){var l=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach(function(u){var f=l.fragments[u];if(f){var d=f.body;d.type!==t||i&&!d.gap||d.start<e&&d.end>r&&(f.buffered||s)&&l.removeFragment(d)}})},o.removeFragment=function(r){var e=hi(r);r.clearElementaryStreamInfo();var t=this.activePartLists[r.type];if(t){var i=r.sn;this.activePartLists[r.type]=Us(t,function(s){return s.fragment.sn!==i})}delete this.fragments[e],r.endList&&delete this.endListFragments[r.type]},o.removeAllFragments=function(){var r;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;var e=(r=this.hls)==null||(r=r.latestLevelDetails)==null?void 0:r.partList;e&&e.forEach(function(t){return t.clearElementaryStreamInfo()})},a})();function dn(a){var o,n,r;return a.buffered&&!!(a.body.gap||(o=a.range.video)!=null&&o.partial||(n=a.range.audio)!=null&&n.partial||(r=a.range.audiovideo)!=null&&r.partial)}function hi(a){return a.type+"_"+a.level+"_"+a.sn}function Us(a,o){return a.filter(function(n){var r=o(n);return r||n.clearElementaryStreamInfo(),r})}var Cr={cbc:0,ctr:1},Su=(function(){function a(n,r,e){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=n,this.aesIV=r,this.aesMode=e}var o=a.prototype;return o.decrypt=function(r,e){switch(this.aesMode){case Cr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,r);case Cr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,r);default:throw new Error("[AESCrypto] invalid aes mode "+this.aesMode)}},a})();function Au(a){var o=a.byteLength,n=o&&new DataView(a.buffer).getUint8(o-1);return n?a.slice(0,o-n):a}var xu=(function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var o=a.prototype;return o.uint8ArrayToUint32Array_=function(r){for(var e=new DataView(r),t=new Uint32Array(4),i=0;i<4;i++)t[i]=e.getUint32(i*4);return t},o.initTable=function(){var r=this.sBox,e=this.invSBox,t=this.subMix,i=t[0],s=t[1],l=t[2],u=t[3],f=this.invSubMix,d=f[0],h=f[1],c=f[2],v=f[3],g=new Uint32Array(256),m=0,p=0,E=0;for(E=0;E<256;E++)E<128?g[E]=E<<1:g[E]=E<<1^283;for(E=0;E<256;E++){var S=p^p<<1^p<<2^p<<3^p<<4;S=S>>>8^S&255^99,r[m]=S,e[S]=m;var T=g[m],A=g[T],x=g[A],b=g[S]*257^S*16843008;i[m]=b<<24|b>>>8,s[m]=b<<16|b>>>16,l[m]=b<<8|b>>>24,u[m]=b,b=x*16843009^A*65537^T*257^m*16843008,d[S]=b<<24|b>>>8,h[S]=b<<16|b>>>16,c[S]=b<<8|b>>>24,v[S]=b,m?(m=T^g[g[g[x^T]]],p^=g[g[p]]):m=p=1}},o.expandKey=function(r){for(var e=this.uint8ArrayToUint32Array_(r),t=!0,i=0;i<e.length&&t;)t=e[i]===this.key[i],i++;if(!t){this.key=e;var s=this.keySize=e.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);var l=this.ksRows=(s+6+1)*4,u,f,d=this.keySchedule=new Uint32Array(l),h=this.invKeySchedule=new Uint32Array(l),c=this.sBox,v=this.rcon,g=this.invSubMix,m=g[0],p=g[1],E=g[2],S=g[3],T,A;for(u=0;u<l;u++){if(u<s){T=d[u]=e[u];continue}A=T,u%s===0?(A=A<<8|A>>>24,A=c[A>>>24]<<24|c[A>>>16&255]<<16|c[A>>>8&255]<<8|c[A&255],A^=v[u/s|0]<<24):s>6&&u%s===4&&(A=c[A>>>24]<<24|c[A>>>16&255]<<16|c[A>>>8&255]<<8|c[A&255]),d[u]=T=(d[u-s]^A)>>>0}for(f=0;f<l;f++)u=l-f,f&3?A=d[u]:A=d[u-4],f<4||u<=4?h[f]=A:h[f]=m[c[A>>>24]]^p[c[A>>>16&255]]^E[c[A>>>8&255]]^S[c[A&255]],h[f]=h[f]>>>0}},o.networkToHostOrderSwap=function(r){return r<<24|(r&65280)<<8|(r&16711680)>>8|r>>>24},o.decrypt=function(r,e,t){for(var i=this.keySize+6,s=this.invKeySchedule,l=this.invSBox,u=this.invSubMix,f=u[0],d=u[1],h=u[2],c=u[3],v=this.uint8ArrayToUint32Array_(t),g=v[0],m=v[1],p=v[2],E=v[3],S=new Int32Array(r),T=new Int32Array(S.length),A,x,b,D,k,R,L,I,P,U,w,O,K,z,X=this.networkToHostOrderSwap;e<S.length;){for(P=X(S[e]),U=X(S[e+1]),w=X(S[e+2]),O=X(S[e+3]),k=P^s[0],R=O^s[1],L=w^s[2],I=U^s[3],K=4,z=1;z<i;z++)A=f[k>>>24]^d[R>>16&255]^h[L>>8&255]^c[I&255]^s[K],x=f[R>>>24]^d[L>>16&255]^h[I>>8&255]^c[k&255]^s[K+1],b=f[L>>>24]^d[I>>16&255]^h[k>>8&255]^c[R&255]^s[K+2],D=f[I>>>24]^d[k>>16&255]^h[R>>8&255]^c[L&255]^s[K+3],k=A,R=x,L=b,I=D,K=K+4;A=l[k>>>24]<<24^l[R>>16&255]<<16^l[L>>8&255]<<8^l[I&255]^s[K],x=l[R>>>24]<<24^l[L>>16&255]<<16^l[I>>8&255]<<8^l[k&255]^s[K+1],b=l[L>>>24]<<24^l[I>>16&255]<<16^l[k>>8&255]<<8^l[R&255]^s[K+2],D=l[I>>>24]<<24^l[k>>16&255]<<16^l[R>>8&255]<<8^l[L&255]^s[K+3],T[e]=X(A^g),T[e+1]=X(D^m),T[e+2]=X(b^p),T[e+3]=X(x^E),g=P,m=U,p=w,E=O,e=e+4}return T.buffer},a})(),Lu=(function(){function a(n,r,e){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=n,this.key=r,this.aesMode=e}var o=a.prototype;return o.expandKey=function(){var r=Iu(this.aesMode);return this.subtle.importKey("raw",this.key,{name:r},!1,["encrypt","decrypt"])},a})();function Iu(a){switch(a){case Cr.cbc:return"AES-CBC";case Cr.ctr:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode "+a)}}var bu=16,da=(function(){function a(n,r){var e=r===void 0?{}:r,t=e.removePKCS7Padding,i=t===void 0?!0:t;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=n.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var o=a.prototype;return o.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},o.isSync=function(){return this.useSoftware},o.flush=function(){var r=this.currentResult,e=this.remainderData;if(!r||e)return this.reset(),null;var t=new Uint8Array(r);return this.reset(),this.removePKCS7Padding?Au(t):t},o.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},o.decrypt=function(r,e,t,i){var s=this;return this.useSoftware?new Promise(function(l,u){var f=ArrayBuffer.isView(r)?r:new Uint8Array(r);s.softwareDecrypt(f,e,t,i);var d=s.flush();d?l(d.buffer):u(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(r),e,t,i)},o.softwareDecrypt=function(r,e,t,i){var s=this.currentIV,l=this.currentResult,u=this.remainderData;if(i!==Cr.cbc||e.byteLength!==16)return Le.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(r=Kt(u,r),this.remainderData=null);var f=this.getValidChunk(r);if(!f.length)return null;s&&(t=s);var d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new xu),d.expandKey(e);var h=l;return this.currentResult=d.decrypt(f.buffer,0,t),this.currentIV=f.slice(-16).buffer,h||null},o.webCryptoDecrypt=function(r,e,t,i){var s=this;if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(r,e,t,i));this.key=e,this.fastAesKey=new Lu(this.subtle,e,i)}return this.fastAesKey.expandKey().then(function(l){if(!s.subtle)return Promise.reject(new Error("web crypto not initialized"));s.logOnce("WebCrypto AES decrypt");var u=new Su(s.subtle,new Uint8Array(t),i);return u.decrypt(r.buffer,l)}).catch(function(l){return Le.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+l.name+": "+l.message),s.onWebCryptoError(r,e,t,i)})},o.onWebCryptoError=function(r,e,t,i){var s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(r,e,t,i);var l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")},o.getValidChunk=function(r){var e=r,t=r.length-r.length%bu;return t!==r.length&&(e=r.slice(0,t),this.remainderData=r.slice(t)),e},o.logOnce=function(r){this.logEnabled&&(Le.log("[decrypter]: "+r),this.logEnabled=!1)},a})(),Bs=Math.pow(2,17),Ru=(function(){function a(n){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=n}var o=a.prototype;return o.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},o.abort=function(){this.loader&&this.loader.abort()},o.load=function(r,e){var t=this,i=r.url;if(!i)return Promise.reject(new Er({type:W.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:r,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var s=this.config,l=s.fLoader,u=s.loader;return new Promise(function(f,d){if(t.loader&&t.loader.destroy(),r.gap)if(r.tagList.some(function(p){return p[0]==="GAP"})){d(Ks(r));return}else r.gap=!1;var h=t.loader=l?new l(s):new u(s),c=Gs(r);r.loader=h;var v=Ns(s.fragLoadPolicy.default),g={loadPolicy:v,timeout:v.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:r.sn==="initSegment"?1/0:Bs};r.stats=h.stats;var m={onSuccess:function(E,S,T,A){t.resetLoader(r,h);var x=E.data;T.resetIV&&r.decryptdata&&(r.decryptdata.iv=new Uint8Array(x.slice(0,16)),x=x.slice(16)),f({frag:r,part:null,payload:x,networkDetails:A})},onError:function(E,S,T,A){t.resetLoader(r,h),d(new Er({type:W.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:Te({url:i,data:void 0},E),error:new Error("HTTP Error "+E.code+" "+E.text),networkDetails:T,stats:A}))},onAbort:function(E,S,T){t.resetLoader(r,h),d(new Er({type:W.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:r,error:new Error("Aborted"),networkDetails:T,stats:E}))},onTimeout:function(E,S,T){t.resetLoader(r,h),d(new Er({type:W.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:T,stats:E}))}};e&&(m.onProgress=function(p,E,S,T){return e({frag:r,part:null,payload:S,networkDetails:T})}),h.load(c,g,m)})},o.loadPart=function(r,e,t){var i=this;this.abort();var s=this.config,l=s.fLoader,u=s.loader;return new Promise(function(f,d){if(i.loader&&i.loader.destroy(),r.gap||e.gap){d(Ks(r,e));return}var h=i.loader=l?new l(s):new u(s),c=Gs(r,e);r.loader=h;var v=Ns(s.fragLoadPolicy.default),g={loadPolicy:v,timeout:v.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Bs};e.stats=h.stats,h.load(c,g,{onSuccess:function(p,E,S,T){i.resetLoader(r,h),i.updateStatsFromPart(r,e);var A={frag:r,part:e,payload:p.data,networkDetails:T};t(A),f(A)},onError:function(p,E,S,T){i.resetLoader(r,h),d(new Er({type:W.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:e,response:Te({url:c.url,data:void 0},p),error:new Error("HTTP Error "+p.code+" "+p.text),networkDetails:S,stats:T}))},onAbort:function(p,E,S){r.stats.aborted=e.stats.aborted,i.resetLoader(r,h),d(new Er({type:W.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:r,part:e,error:new Error("Aborted"),networkDetails:S,stats:p}))},onTimeout:function(p,E,S){i.resetLoader(r,h),d(new Er({type:W.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:e,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:S,stats:p}))}})})},o.updateStatsFromPart=function(r,e){var t=r.stats,i=e.stats,s=i.total;if(t.loaded+=i.loaded,s){var l=Math.round(r.duration/e.duration),u=Math.min(Math.round(t.loaded/s),l),f=l-u,d=f*Math.round(t.loaded/u);t.total=t.loaded+d}else t.total=Math.max(t.loaded,t.total);var h=t.loading,c=i.loading;h.start?h.first+=c.first-c.start:(h.start=c.start,h.first=c.first),h.end=c.end},o.resetLoader=function(r,e){r.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},a})();function Gs(a,o){o===void 0&&(o=null);var n=o||a,r={frag:a,part:o,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},e=n.byteRangeStartOffset,t=n.byteRangeEndOffset;if(H(e)&&H(t)){var i,s=e,l=t;if(a.sn==="initSegment"&&_u((i=a.decryptdata)==null?void 0:i.method)){var u=t-e;u%16&&(l=t+(16-u%16)),e!==0&&(r.resetIV=!0,s=e-16)}r.rangeStart=s,r.rangeEnd=l}return r}function Ks(a,o){var n=new Error("GAP "+(a.gap?"tag":"attribute")+" found"),r={type:W.MEDIA_ERROR,details:_.FRAG_GAP,fatal:!1,frag:a,error:n,networkDetails:null};return o&&(r.part=o),(o||a).stats.aborted=!0,new Er(r)}function _u(a){return a==="AES-128"||a==="AES-256"}var Er=(function(a){function o(n){var r;return r=a.call(this,n.error.message)||this,r.data=void 0,r.data=n,r}return se(o,a),o})(ze(Error)),Vs=(function(a){function o(r,e){var t;return t=a.call(this,r,e)||this,t._boundTick=void 0,t._tickTimer=null,t._tickInterval=null,t._tickCallCount=0,t._boundTick=t.tick.bind(t),t}se(o,a);var n=o.prototype;return n.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},n.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},n.onHandlerDestroyed=function(){},n.hasInterval=function(){return!!this._tickInterval},n.hasNextTick=function(){return!!this._tickTimer},n.setInterval=function(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},n.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},n.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},n.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},n.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},n.doTick=function(){},o})(te),ha=function(o,n,r,e,t,i){e===void 0&&(e=0),t===void 0&&(t=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=hn(),this.buffering={audio:hn(),video:hn(),audiovideo:hn()},this.level=o,this.sn=n,this.id=r,this.size=e,this.part=t,this.partial=i};function hn(){return{start:0,executeStart:0,executeEnd:0,end:0}}var Hs={length:0,start:function(){return 0},end:function(){return 0}},Se=(function(){function a(){}return a.isBuffered=function(n,r){if(n){for(var e=a.getBuffered(n),t=e.length;t--;)if(r>=e.start(t)&&r<=e.end(t))return!0}return!1},a.bufferedRanges=function(n){if(n){var r=a.getBuffered(n);return a.timeRangesToArray(r)}return[]},a.timeRangesToArray=function(n){for(var r=[],e=0;e<n.length;e++)r.push({start:n.start(e),end:n.end(e)});return r},a.bufferInfo=function(n,r,e){if(n){var t=a.bufferedRanges(n);if(t.length)return a.bufferedInfo(t,r,e)}return{len:0,start:r,end:r,bufferedIndex:-1}},a.bufferedInfo=function(n,r,e){r=Math.max(0,r),n.length>1&&n.sort(function(p,E){return p.start-E.start||E.end-p.end});var t=-1,i=[];if(e)for(var s=0;s<n.length;s++){r>=n[s].start&&r<=n[s].end&&(t=s);var l=i.length;if(l){var u=i[l-1].end;n[s].start-u<e?n[s].end>u&&(i[l-1].end=n[s].end):i.push(n[s])}else i.push(n[s])}else i=n;for(var f=0,d,h=r,c=r,v=0;v<i.length;v++){var g=i[v].start,m=i[v].end;if(t===-1&&r>=g&&r<=m&&(t=v),r+e>=g&&r<m)h=g,c=m,f=c-r;else if(r+e<g){d=g;break}}return{len:f,start:h||0,end:c||0,nextStart:d,buffered:n,bufferedIndex:t}},a.getBuffered=function(n){try{return n.buffered||Hs}catch(r){return Le.log("failed to get media.buffered",r),Hs}},a})(),Ys=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ws(a){return Ys.test(a)}function ca(a,o){if(a.variableList!==null||a.hasVariableRefs){var n=a.variableList;return o.replace(Ys,function(r){var e=r.substring(2,r.length-1),t=n?.[e];return t===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+e+'"')),r):t})}return o}function qs(a,o,n){var r=a.variableList;r||(a.variableList=r={});var e,t;if("QUERYPARAM"in o){e=o.QUERYPARAM;try{var i=new self.URL(n).searchParams;if(i.has(e))t=i.get(e);else throw new Error('"'+e+'" does not match any query parameter in URI: "'+n+'"')}catch(s){a.playlistParsingError||(a.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+s.message))}}else e=o.NAME,t=o.VALUE;e in r?a.playlistParsingError||(a.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+e+'"')):r[e]=t||""}function Du(a,o,n){var r=o.IMPORT;if(n&&r in n){var e=a.variableList;e||(a.variableList=e={}),e[r]=n[r]}else a.playlistParsingError||(a.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+r+'"'))}var ku=/^(\d+)x(\d+)$/,js=/(.+?)=(".*?"|.*?)(?:,|$)/g,et=(function(){function a(n,r){typeof n=="string"&&(n=a.parseAttrList(n,r)),ae(this,n)}var o=a.prototype;return o.decimalInteger=function(r){var e=parseInt(this[r],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},o.hexadecimalInteger=function(r){if(this[r]){var e=(this[r]||"0x").slice(2);e=(e.length&1?"0":"")+e;for(var t=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)t[i]=parseInt(e.slice(i*2,i*2+2),16);return t}return null},o.hexadecimalIntegerAsNumber=function(r){var e=parseInt(this[r],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},o.decimalFloatingPoint=function(r){return parseFloat(this[r])},o.optionalFloat=function(r,e){var t=this[r];return t?parseFloat(t):e},o.enumeratedString=function(r){return this[r]},o.enumeratedStringList=function(r,e){var t=this[r];return(t?t.split(/[ ,]+/):[]).reduce(function(i,s){return i[s.toLowerCase()]=!0,i},e)},o.bool=function(r){return this[r]==="YES"},o.decimalResolution=function(r){var e=ku.exec(this[r]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},a.parseAttrList=function(r,e){var t,i={},s='"';for(js.lastIndex=0;(t=js.exec(r))!==null;){var l=t[1].trim(),u=t[2],f=u.indexOf(s)===0&&u.lastIndexOf(s)===u.length-1,d=!1;if(f)u=u.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(e&&(f||d))u=ca(e,u);else if(!d&&!f)switch(l){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Le.warn(r+": attribute "+l+" is missing quotes")}i[l]=u}return i},Y(a,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(r){return r.substring(0,2)==="X-"})}}])})(),Pu="com.apple.hls.interstitial";function Cu(a){return a!=="ID"&&a!=="CLASS"&&a!=="CUE"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function wu(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}var Xs=(function(){function a(o,n,r){var e;if(r===void 0&&(r=0),this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=n?.tagAnchor||null,this.tagOrder=(e=n?.tagOrder)!=null?e:r,n){var t=n.attr;for(var i in t)if(Object.prototype.hasOwnProperty.call(o,i)&&o[i]!==t[i]){Le.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+o.ID+'"'),this._badValueForSameId=i;break}o=ae(new et({}),t,o)}if(this.attr=o,n?(this._startDate=n._startDate,this._cue=n._cue,this._endDate=n._endDate,this._dateAtEnd=n._dateAtEnd):this._startDate=new Date(o["START-DATE"]),"END-DATE"in this.attr){var s=n?.endDate||new Date(this.attr["END-DATE"]);H(s.getTime())&&(this._endDate=s)}}return Y(a,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"cue",get:function(){var n=this._cue;return n===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):n}},{key:"startTime",get:function(){var n=this.tagAnchor;return n===null||n.programDateTime===null?(Le.warn('Expected tagAnchor Fragment with PDT set for DateRange "'+this.id+'": '+n),NaN):n.start+(this.startDate.getTime()-n.programDateTime)/1e3}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var n=this._endDate||this._dateAtEnd;if(n)return n;var r=this.duration;return r!==null?this._dateAtEnd=new Date(this._startDate.getTime()+r*1e3):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var n=this.attr.decimalFloatingPoint("DURATION");if(H(n))return n}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isInterstitial",get:function(){return this.class===Pu}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&H(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}])})(),Mu=10,Ou=(function(){function a(n){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=n}var o=a.prototype;return o.reloaded=function(r){if(!r){this.advanced=!0,this.updated=!0;return}var e=this.lastPartSn-r.lastPartSn,t=this.lastPartIndex-r.lastPartIndex;this.updated=this.endSN!==r.endSN||!!t||!!e||!this.live,this.advanced=this.endSN>r.endSN||e>0||e===0&&t>0,this.updated||this.advanced?this.misses=Math.floor(r.misses*.6):this.misses=r.misses+1},o.hasKey=function(r){return this.encryptedFragments.some(function(e){var t=e.decryptdata;return t||(e.setKeyFormat(r.keyFormat),t=e.decryptdata),!!t&&r.matches(t)})},Y(a,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?H(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||Mu}},{key:"drift",get:function(){var r=this.driftEndTime-this.driftStartTime;if(r>0){var e=this.driftEnd-this.driftStart;return e*1e3/r}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}},{key:"fragmentStart",get:function(){return this.fragments.length?this.fragments[0].start:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].index:-1}},{key:"maxPartIndex",get:function(){var r=this.partList;if(r){var e=this.lastPartIndex;if(e!==-1){for(var t=r.length;t--;)if(r[t].index>e)return r[t].index;return e}}return 0}},{key:"lastPartSn",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}},{key:"expired",get:function(){if(this.live&&this.age&&this.misses<3){var r=this.partEnd-this.fragmentStart;return this.age>Math.max(r,this.totalduration)+this.levelTargetDuration}return!1}}])})();function zs(a,o){return a.length===o.length?!a.some(function(n,r){return n!==o[r]}):!1}function Qs(a,o){return!a&&!o?!0:!a||!o?!1:zs(a,o)}function ci(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function va(a){switch(a){case"AES-128":case"AES-256":return Cr.cbc;case"AES-256-CTR":return Cr.ctr;default:throw new Error("invalid full segment method "+a)}}function ga(a){return Uint8Array.from(atob(a),function(o){return o.charCodeAt(0)})}function ma(a){return Uint8Array.from(unescape(encodeURIComponent(a)),function(o){return o.charCodeAt(0)})}function Fu(a){var o=ma(a).subarray(0,16),n=new Uint8Array(16);return n.set(o,16-o.length),n}function Nu(a){var o=function(r,e,t){var i=r[e];r[e]=r[t],r[t]=i};o(a,0,3),o(a,1,2),o(a,4,5),o(a,6,7)}function Uu(a){var o=a.split(":"),n=null;if(o[0]==="data"&&o.length===2){var r=o[1].split(";"),e=r[r.length-1].split(",");if(e.length===2){var t=e[0]==="base64",i=e[1];t?(r.splice(-1,1),n=ga(i)):n=Fu(i)}}return n}var cn=typeof self<"u"?self:void 0,$e={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ht={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function vn(a){switch(a){case Ht.FAIRPLAY:return $e.FAIRPLAY;case Ht.PLAYREADY:return $e.PLAYREADY;case Ht.WIDEVINE:return $e.WIDEVINE;case Ht.CLEARKEY:return $e.CLEARKEY}}function pa(a){switch(a){case $e.FAIRPLAY:return Ht.FAIRPLAY;case $e.PLAYREADY:return Ht.PLAYREADY;case $e.WIDEVINE:return Ht.WIDEVINE;case $e.CLEARKEY:return Ht.CLEARKEY}}function Mi(a){var o=a.drmSystems,n=a.widevineLicenseUrl,r=o?[$e.FAIRPLAY,$e.WIDEVINE,$e.PLAYREADY,$e.CLEARKEY].filter(function(e){return!!o[e]}):[];return!r[$e.WIDEVINE]&&n&&r.push($e.WIDEVINE),r}var $s=(function(a){return cn!=null&&(a=cn.navigator)!=null&&a.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Bu(a,o,n,r){var e;switch(a){case $e.FAIRPLAY:e=["cenc","sinf"];break;case $e.WIDEVINE:case $e.PLAYREADY:e=["cenc"];break;case $e.CLEARKEY:e=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+a)}return Gu(e,o,n,r)}function Gu(a,o,n,r){var e={initDataTypes:a,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:o.map(function(t){return{contentType:"audio/mp4; codecs="+t,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null}}),videoCapabilities:n.map(function(t){return{contentType:"video/mp4; codecs="+t,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}})};return[e]}function Ku(a){var o;return!!a&&(a.sessionType==="persistent-license"||!!((o=a.sessionTypes)!=null&&o.some(function(n){return n==="persistent-license"})))}function Vu(a){var o=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),n=String.fromCharCode.apply(null,Array.from(o)),r=n.substring(n.indexOf("<"),n.length),e=new DOMParser,t=e.parseFromString(r,"text/xml"),i=t.getElementsByTagName("KID")[0];if(i){var s=i.childNodes[0]?i.childNodes[0].nodeValue:i.getAttribute("VALUE");if(s){var l=ga(s).subarray(0,16);return Nu(l),l}}return null}var gn={},Js=(function(){function a(n,r,e,t,i,s){t===void 0&&(t=[1]),i===void 0&&(i=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=n,this.uri=r,this.keyFormat=e,this.keyFormatVersions=t,this.iv=i,this.encrypted=n?n!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ci(n),s!=null&&s.startsWith("0x")&&(this.keyId=new Uint8Array(Re(s)))}a.clearKeyUriToKeyIdMap=function(){gn={}};var o=a.prototype;return o.matches=function(r){return r.uri===this.uri&&r.method===this.method&&r.encrypted===this.encrypted&&r.keyFormat===this.keyFormat&&zs(r.keyFormatVersions,this.keyFormatVersions)&&Qs(r.iv,this.iv)&&Qs(r.keyId,this.keyId)},o.isSupported=function(){if(this.method){if(ci(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ht.FAIRPLAY:case Ht.WIDEVINE:case Ht.PLAYREADY:case Ht.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},o.getDecryptData=function(r){if(!this.encrypted||!this.uri)return null;if(ci(this.method)&&this.uri&&!this.iv){typeof r!="number"&&(Le.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),r=0);var e=Hu(r),t=new a(this.method,this.uri,"identity",this.keyFormatVersions,e);return t}if(this.pssh&&this.keyId)return this;var i=Uu(this.uri);if(i)switch(this.keyFormat){case Ht.WIDEVINE:if(this.pssh=i,!this.keyId&&i.length>=22){var s=i.length-22;this.keyId=i.subarray(s,s+16)}break;case Ht.PLAYREADY:{var l=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Ri(l,null,i),this.keyId=Vu(i);break}default:{var u=i.subarray(0,16);if(u.length!==16){var f=new Uint8Array(16);f.set(u,16-u.length),u=f}this.keyId=u;break}}if(!this.keyId||this.keyId.byteLength!==16){var d=gn[this.uri];if(!d){var h=Object.keys(gn).length%Number.MAX_SAFE_INTEGER;d=new Uint8Array(16);var c=new DataView(d.buffer,12,4);c.setUint32(0,h),gn[this.uri]=d}this.keyId=d}return this},a})();function Hu(a){for(var o=new Uint8Array(16),n=12;n<16;n++)o[n]=a>>8*(15-n)&255;return o}var Zs=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,eo=/#EXT-X-MEDIA:(.*)/g,Yu=/^#EXT(?:INF|-X-TARGETDURATION):/m,ya=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Wu=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Oi=(function(){function a(){}return a.findGroup=function(n,r){for(var e=0;e<n.length;e++){var t=n[e];if(t.id===r)return t}},a.resolve=function(n,r){return _t.buildAbsoluteURL(r,n,{alwaysNormalize:!0})},a.isMediaPlaylist=function(n){return Yu.test(n)},a.parseMasterPlaylist=function(n,r){var e=Ws(n),t={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:e},i=[];Zs.lastIndex=0;for(var s;(s=Zs.exec(n))!=null;)if(s[1]){var l,u=new et(s[1],t),f=ca(t,s[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:a.resolve(f,r)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),no(u.CODECS,d);var c=u["SUPPLEMENTAL-CODECS"];c&&(d.supplemental={},no(c,d.supplemental)),(l=d.unknownCodecs)!=null&&l.length||i.push(d),t.levels.push(d)}else if(s[3]){var v=s[3],g=s[4];switch(v){case"SESSION-DATA":{var m=new et(g,t),p=m["DATA-ID"];p&&(t.sessionData===null&&(t.sessionData={}),t.sessionData[p]=m);break}case"SESSION-KEY":{var E=ro(g,r,t);E.encrypted&&E.isSupported()?(t.sessionKeys===null&&(t.sessionKeys=[]),t.sessionKeys.push(E)):Le.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+g+'"');break}case"DEFINE":{{var S=new et(g,t);qs(t,S,r)}break}case"CONTENT-STEERING":{var T=new et(g,t);t.contentSteering={uri:a.resolve(T["SERVER-URI"],r),pathwayId:T["PATHWAY-ID"]||"."};break}case"START":{t.startTimeOffset=io(g);break}}}var A=i.length>0&&i.length<t.levels.length;return t.levels=A?i:t.levels,t.levels.length===0&&(t.playlistParsingError=new Error("no levels found in manifest")),t},a.parseMasterPlaylistMedia=function(n,r,e){var t,i={},s=e.levels,l={AUDIO:s.map(function(A){return{id:A.attrs.AUDIO,audioCodec:A.audioCodec}}),SUBTITLES:s.map(function(A){return{id:A.attrs.SUBTITLES,textCodec:A.textCodec}}),"CLOSED-CAPTIONS":[]},u=0;for(eo.lastIndex=0;(t=eo.exec(n))!==null;){var f=new et(t[1],e),d=f.TYPE;if(d){var h=l[d],c=i[d]||[];i[d]=c;var v=f.LANGUAGE,g=f["ASSOC-LANGUAGE"],m=f.CHANNELS,p=f.CHARACTERISTICS,E=f["INSTREAM-ID"],S={attrs:f,bitrate:0,id:u++,groupId:f["GROUP-ID"]||"",name:f.NAME||v||"",type:d,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:v,url:f.URI?a.resolve(f.URI,r):""};if(g&&(S.assocLang=g),m&&(S.channels=m),p&&(S.characteristics=p),E&&(S.instreamId=E),h!=null&&h.length){var T=a.findGroup(h,S.groupId)||h[0];ao(S,T,"audioCodec"),ao(S,T,"textCodec")}c.push(S)}}return i},a.parseLevelPlaylist=function(n,r,e,t,i,s){var l,u={url:r},f=new Ou(r),d=f.fragments,h=[],c=null,v=0,g=0,m=0,p=0,E=0,S=null,T=new ht(t,u),A,x,b,D=-1,k=!1,R=null,L;if(ya.lastIndex=0,f.m3u8=n,f.hasVariableRefs=Ws(n),((l=ya.exec(n))==null?void 0:l[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(A=ya.exec(n))!==null;){k&&(k=!1,T=new ht(t,u),T.playlistOffset=m,T.setStart(m),T.sn=v,T.cc=p,E&&(T.bitrate=E),T.level=e,c&&(T.initSegment=c,c.rawProgramDateTime&&(T.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null),R&&(T.setByteRange(R),R=null)));var I=A[1];if(I){T.duration=parseFloat(I);var P=(" "+A[2]).slice(1);T.title=P||null,T.tagList.push(P?["INF",I,P]:["INF",I])}else if(A[3]){if(H(T.duration)){T.playlistOffset=m,T.setStart(m),b&&oo(T,b,f),T.sn=v,T.level=e,T.cc=p,d.push(T);var U=(" "+A[3]).slice(1);T.relurl=ca(f,U),Ea(T,S,h),S=T,m+=T.duration,v++,g=0,k=!0}}else{if(A=A[0].match(Wu),!A){Le.warn("No matches on slow regex match for level playlist!");continue}for(x=1;x<A.length&&A[x]===void 0;x++);var w=(" "+A[x]).slice(1),O=(" "+A[x+1]).slice(1),K=A[x+2]?(" "+A[x+2]).slice(1):null;switch(w){case"BYTERANGE":S?T.setByteRange(O,S):T.setByteRange(O);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=O,T.tagList.push(["PROGRAM-DATE-TIME",O]),D===-1&&(D=d.length);break;case"PLAYLIST-TYPE":f.type&&Tr(f,w,A),f.type=O.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?Tr(f,w,A):d.length>0&&lo(f,w,A),v=f.startSN=parseInt(O);break;case"SKIP":{f.skippedSegments&&Tr(f,w,A);var z=new et(O,f),X=z.decimalInteger("SKIPPED-SEGMENTS");if(H(X)){f.skippedSegments+=X;for(var Q=X;Q--;)d.push(null);v+=X}var ge=z.enumeratedString("RECENTLY-REMOVED-DATERANGES");ge&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(ge.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&Tr(f,w,A),f.targetduration=Math.max(parseInt(O),1);break;case"VERSION":f.version!==null&&Tr(f,w,A),f.version=parseInt(O);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||Tr(f,w,A),f.live=!1;break;case"#":(O||K)&&T.tagList.push(K?[O,K]:[O]);break;case"DISCONTINUITY":p++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([w]);break;case"BITRATE":T.tagList.push([w,O]),E=parseInt(O)*1e3,H(E)?T.bitrate=E:E=0;break;case"DATERANGE":{var $=new et(O,f),J=new Xs($,f.dateRanges[$.ID],f.dateRangeTagCount);f.dateRangeTagCount++,J.isValid||f.skippedSegments?f.dateRanges[J.id]=J:Le.warn('Ignoring invalid DATERANGE tag: "'+O+'"'),T.tagList.push(["EXT-X-DATERANGE",O]);break}case"DEFINE":{{var re=new et(O,f);"IMPORT"in re?Du(f,re,s):qs(f,re,r)}break}case"DISCONTINUITY-SEQUENCE":f.startCC!==0?Tr(f,w,A):d.length>0&&lo(f,w,A),f.startCC=p=parseInt(O);break;case"KEY":{var fe=ro(O,r,f);if(fe.isSupported()){if(fe.method==="NONE"){b=void 0;break}b||(b={});var _e=b[fe.keyFormat];_e!=null&&_e.matches(fe)||(_e&&(b=ae({},b)),b[fe.keyFormat]=fe)}else Le.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+O+'"');break}case"START":f.startTimeOffset=io(O);break;case"MAP":{var De=new et(O,f);if(T.duration){var Ye=new ht(t,u);so(Ye,De,e,b),c=Ye,T.initSegment=c,c.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=c.rawProgramDateTime)}else{var qe=T.byteRangeEndOffset;if(qe){var Oe=T.byteRangeStartOffset;R=qe-Oe+"@"+Oe}else R=null;so(T,De,e,b),c=T,k=!0}c.cc=p;break}case"SERVER-CONTROL":{L&&Tr(f,w,A),L=new et(O),f.canBlockReload=L.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=L.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&L.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=L.optionalFloat("PART-HOLD-BACK",0),f.holdBack=L.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&Tr(f,w,A);var It=new et(O);f.partTarget=It.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Be=f.partList;Be||(Be=f.partList=[]);var Ae=g>0?Be[Be.length-1]:void 0,nt=g++,bt=new et(O,f),ut=new Nt(bt,T,u,nt,Ae);Be.push(ut),T.duration+=ut.duration;break}case"PRELOAD-HINT":{var tt=new et(O,f);f.preloadHint=tt;break}case"RENDITION-REPORT":{var Pt=new et(O,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(Pt);break}default:Le.warn("line parsed but not handled: "+A);break}}}S&&!S.relurl?(d.pop(),m-=S.duration,f.partList&&(f.fragmentHint=S)):f.partList&&(Ea(T,S,h),T.cc=p,f.fragmentHint=T,b&&oo(T,b,f)),f.targetduration||(f.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));var Ct=d.length,wt=d[0],ft=d[Ct-1];if(m+=f.skippedSegments*f.targetduration,m>0&&Ct&&ft){f.averagetargetduration=m/Ct;var vt=ft.sn;f.endSN=vt!=="initSegment"?vt:0,f.live||(ft.endList=!0),D>0&&(ju(d,D),wt&&h.unshift(wt))}return f.fragmentHint&&(m+=f.fragmentHint.duration),f.totalduration=m,h.length&&f.dateRangeTagCount&&wt&&to(h,f),f.endCC=p,f},a})();function to(a,o){var n=a.length;if(!n)if(o.hasProgramDateTime){var r=o.fragments[o.fragments.length-1];a.push(r),n++}else return;for(var e=a[n-1],t=o.live?1/0:o.totalduration,i=Object.keys(o.dateRanges),s=i.length;s--;){var l=o.dateRanges[i[s]],u=l.startDate.getTime();l.tagAnchor=e.ref;for(var f=n;f--;){var d;if(((d=a[f])==null?void 0:d.sn)<o.startSN)break;var h=qu(o,u,a,f,t);if(h!==-1){l.tagAnchor=o.fragments[h].ref;break}}}}function qu(a,o,n,r,e){var t=n[r];if(t){var i=t.programDateTime;if(o>=i||r===0){var s,l=(((s=n[r+1])==null?void 0:s.start)||e)-t.start;if(o<=i+l*1e3){var u=n[r].sn-a.startSN;if(u<0)return-1;var f=a.fragments;if(f.length>n.length)for(var d=n[r+1]||f[f.length-1],h=d.sn-a.startSN,c=h;c>u;c--){var v=f[c].programDateTime;if(o>=v&&o<v+f[c].duration*1e3)return c}return u}}}return-1}function ro(a,o,n){var r,e,t=new et(a,n),i=(r=t.METHOD)!=null?r:"",s=t.URI,l=t.hexadecimalInteger("IV"),u=t.KEYFORMATVERSIONS,f=(e=t.KEYFORMAT)!=null?e:"identity";s&&t.IV&&!l&&Le.error("Invalid IV: "+t.IV);var d=s?Oi.resolve(s,o):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Js(i,d,f,h,l,t.KEYID)}function io(a){var o=new et(a),n=o.decimalFloatingPoint("TIME-OFFSET");return H(n)?n:null}function no(a,o){var n=(a||"").split(/[ ,]+/).filter(function(r){return r});["video","audio","text"].forEach(function(r){var e=n.filter(function(t){return _i(t,r)});e.length&&(o[r+"Codec"]=e.map(function(t){return t.split("/")[0]}).join(","),n=n.filter(function(t){return e.indexOf(t)===-1}))}),o.unknownCodecs=n}function ao(a,o,n){var r=o[n];r&&(a[n]=r)}function ju(a,o){for(var n=a[o],r=o;r--;){var e=a[r];if(!e)return;e.programDateTime=n.programDateTime-e.duration*1e3,n=e}}function Ea(a,o,n){a.rawProgramDateTime?n.push(a):o!=null&&o.programDateTime&&(a.programDateTime=o.endProgramDateTime)}function so(a,o,n,r){a.relurl=o.URI,o.BYTERANGE&&a.setByteRange(o.BYTERANGE),a.level=n,a.sn="initSegment",r&&(a.levelkeys=r),a.initSegment=null}function oo(a,o,n){a.levelkeys=o;var r=n.encryptedFragments;(!r.length||r[r.length-1].levelkeys!==o)&&Object.keys(o).some(function(e){return o[e].isCommonEncryption})&&r.push(a)}function Tr(a,o,n){a.playlistParsingError=new Error("#EXT-X-"+o+" must not appear more than once ("+n[0]+")")}function lo(a,o,n){a.playlistParsingError=new Error("#EXT-X-"+o+" must appear before the first Media Segment ("+n[0]+")")}function Ta(a,o){var n=o.startPTS;if(H(n)){var r=0,e;o.sn>a.sn?(r=n-a.start,e=a):(r=a.start-n,e=o),e.duration!==r&&e.setDuration(r)}else if(o.sn>a.sn){var t=a.cc===o.cc;t&&a.minEndPTS?o.setStart(a.start+(a.minEndPTS-a.start)):o.setStart(a.start+a.duration)}else o.setStart(Math.max(a.start-o.duration,0))}function uo(a,o,n,r,e,t,i){var s=r-n;s<=0&&(i.warn("Fragment should have a positive duration",o),r=n+o.duration,t=e+o.duration);var l=n,u=r,f=o.startPTS,d=o.endPTS;if(H(f)){var h=Math.abs(f-n);a&&h>a.totalduration?i.warn("media timestamps and playlist times differ by "+h+"s for level "+o.level+" "+a.url):H(o.deltaPTS)?o.deltaPTS=Math.max(h,o.deltaPTS):o.deltaPTS=h,l=Math.max(n,f),n=Math.min(n,f),e=o.startDTS!==void 0?Math.min(e,o.startDTS):e,u=Math.min(r,d),r=Math.max(r,d),t=o.endDTS!==void 0?Math.max(t,o.endDTS):t}var c=n-o.start;o.start!==0&&o.setStart(n),o.setDuration(r-o.start),o.startPTS=n,o.maxStartPTS=l,o.startDTS=e,o.endPTS=r,o.minEndPTS=u,o.endDTS=t;var v=o.sn;if(!a||v<a.startSN||v>a.endSN)return 0;var g,m=v-a.startSN,p=a.fragments;for(p[m]=o,g=m;g>0;g--)Ta(p[g],p[g-1]);for(g=m;g<p.length-1;g++)Ta(p[g],p[g+1]);return a.fragmentHint&&Ta(p[p.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,c}function Xu(a,o,n){if(a!==o){for(var r=null,e=a.fragments,t=e.length-1;t>=0;t--){var i=e[t].initSegment;if(i){r=i;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;var s;$u(a,o,function(p,E,S,T){if((!o.startCC||o.skippedSegments)&&E.cc!==p.cc){for(var A=p.cc-E.cc,x=S;x<T.length;x++)T[x].cc+=A;o.endCC=T[T.length-1].cc}H(p.startPTS)&&H(p.endPTS)&&(E.setStart(E.startPTS=p.startPTS),E.startDTS=p.startDTS,E.maxStartPTS=p.maxStartPTS,E.endPTS=p.endPTS,E.endDTS=p.endDTS,E.minEndPTS=p.minEndPTS,E.setDuration(p.endPTS-p.startPTS),E.duration&&(s=E),o.PTSKnown=o.alignedSliding=!0),p.hasStreams&&(E.elementaryStreams=p.elementaryStreams),E.loader=p.loader,p.hasStats&&(E.stats=p.stats),p.initSegment&&(E.initSegment=p.initSegment,r=p.initSegment)});var l=o.fragments,u=o.fragmentHint?l.concat(o.fragmentHint):l;if(r&&u.forEach(function(p){var E;p&&(!p.initSegment||p.initSegment.relurl===((E=r)==null?void 0:E.relurl))&&(p.initSegment=r)}),o.skippedSegments){if(o.deltaUpdateFailed=l.some(function(p){return!p}),o.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var f=o.skippedSegments;f--;)l.shift();o.startSN=l[0].sn}else{o.canSkipDateRanges&&(o.dateRanges=zu(a.dateRanges,o,n));var d=a.fragments.filter(function(p){return p.rawProgramDateTime});if(a.hasProgramDateTime&&!o.hasProgramDateTime)for(var h=1;h<u.length;h++)u[h].programDateTime===null&&Ea(u[h],u[h-1],d);to(d,o)}o.endCC=l[l.length-1].cc}if(!o.startCC){var c,v=vo(a,o.startSN-1);o.startCC=(c=v?.cc)!=null?c:l[0].cc}Qu(a.partList,o.partList,function(p,E){E.elementaryStreams=p.elementaryStreams,E.stats=p.stats}),s?uo(o,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,n):ho(a,o),l.length&&(o.totalduration=o.edge-l[0].start),o.driftStartTime=a.driftStartTime,o.driftStart=a.driftStart;var g=o.advancedDateTime;if(o.advanced&&g){var m=o.edge;o.driftStart||(o.driftStartTime=g,o.driftStart=m),o.driftEndTime=g,o.driftEnd=m}else o.driftEndTime=a.driftEndTime,o.driftEnd=a.driftEnd,o.advancedDateTime=a.advancedDateTime;o.requestScheduled===-1&&(o.requestScheduled=a.requestScheduled)}}function zu(a,o,n){var r=o.dateRanges,e=o.recentlyRemovedDateranges,t=ae({},a);e&&e.forEach(function(l){delete t[l]});var i=Object.keys(t),s=i.length;return s?(Object.keys(r).forEach(function(l){var u=t[l],f=new Xs(r[l].attr,u);f.isValid?(t[l]=f,u||(f.tagOrder+=s)):n.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+He(r[l].attr)+'"')}),t):r}function Qu(a,o,n){if(a&&o)for(var r=0,e=0,t=a.length;e<=t;e++){var i=a[e],s=o[e+r];i&&s&&i.index===s.index&&i.fragment.sn===s.fragment.sn?n(i,s):r--}}function $u(a,o,n){for(var r=o.skippedSegments,e=Math.max(a.startSN,o.startSN)-o.startSN,t=(a.fragmentHint?1:0)+(r?o.endSN:Math.min(a.endSN,o.endSN))-o.startSN,i=o.startSN-a.startSN,s=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,l=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,u=e;u<=t;u++){var f=l[i+u],d=s[u];if(r&&!d&&f&&(d=o.fragments[u]=f),f&&d){n(f,d,u,s);var h=f.relurl,c=d.relurl;if(h&&Ju(h,c)){o.playlistParsingError=fo("media sequence mismatch "+d.sn+":",a,o,f,d);return}else if(f.cc!==d.cc){o.playlistParsingError=fo("discontinuity sequence mismatch ("+f.cc+"!="+d.cc+")",a,o,f,d);return}}}}function fo(a,o,n,r,e){return new Error(a+" "+e.url+`
Playlist starting @`+o.startSN+`
`+o.m3u8+`

Playlist starting @`+n.startSN+`
`+n.m3u8)}function ho(a,o,n){n===void 0&&(n=!0);var r=o.startSN+o.skippedSegments-a.startSN,e=a.fragments,t=r>=0,i=0;if(t&&r<e.length)i=e[r].start;else if(t&&o.startSN===a.endSN+1)i=a.fragmentEnd;else if(t&&n)i=a.fragmentStart+r*o.levelTargetDuration;else if(!o.skippedSegments&&o.fragmentStart===0)i=a.fragmentStart;else return;Sa(o,i)}function Sa(a,o){if(o){for(var n=a.fragments,r=a.skippedSegments;r<n.length;r++)n[r].addStart(o);a.fragmentHint&&a.fragmentHint.addStart(o)}}function co(a,o){o===void 0&&(o=1/0);var n=1e3*a.targetduration;if(a.updated){var r=a.fragments,e=4;if(r.length&&n*e>o){var t=r[r.length-1].duration*1e3;t<n&&(n=t)}}else n/=2;return Math.round(n)}function vo(a,o,n){if(!a)return null;var r=a.fragments[o-a.startSN];return r||(r=a.fragmentHint,r&&r.sn===o)?r:o<a.startSN&&n&&n.sn===o?n:null}function go(a,o,n){return a?mo(a.partList,o,n):null}function mo(a,o,n){if(a)for(var r=a.length;r--;){var e=a[r];if(e.index===n&&e.fragment.sn===o)return e}return null}function po(a){a.forEach(function(o,n){var r;(r=o.details)==null||r.fragments.forEach(function(e){e.level=n,e.initSegment&&(e.initSegment.level=n)})})}function Ju(a,o){return a!==o&&o?yo(a)!==yo(o):!1}function yo(a){return a.replace(/\?[^?]*$/,"")}function Fi(a,o){for(var n=0,r=a.length;n<r;n++){var e;if(((e=a[n])==null?void 0:e.cc)===o)return a[n]}return null}function Zu(a,o){return!!(a&&o.startCC<a.endCC&&o.endCC>a.startCC)}function Eo(a,o){var n=a.start+o;a.startPTS=n,a.setStart(n),a.endPTS=n+a.duration}function To(a,o){for(var n=o.fragments,r=0,e=n.length;r<e;r++)Eo(n[r],a);o.fragmentHint&&Eo(o.fragmentHint,a),o.alignedSliding=!0}function ef(a,o){a&&(So(o,a),o.alignedSliding||mn(o,a),!o.alignedSliding&&!o.skippedSegments&&ho(a,o,!1))}function So(a,o){if(Zu(o,a)){var n=Math.min(o.endCC,a.endCC),r=Fi(o.fragments,n),e=Fi(a.fragments,n);if(!(!r||!e)){Le.log("Aligning playlist at start of dicontinuity sequence "+n);var t=r.start-e.start;To(t,a)}}}function mn(a,o){if(!(!a.hasProgramDateTime||!o.hasProgramDateTime)){var n=a.fragments,r=o.fragments;if(!(!n.length||!r.length)){var e,t,i=Math.min(o.endCC,a.endCC);o.startCC<i&&a.startCC<i&&(e=Fi(r,i),t=Fi(n,i)),(!e||!t)&&(e=r[Math.floor(r.length/2)],t=Fi(n,e.cc)||n[Math.floor(n.length/2)]);var s=e.programDateTime,l=t.programDateTime;if(!(!s||!l)){var u=(l-s)/1e3-(t.start-e.start);To(u,a)}}}}function kt(a,o,n){Yt(a,o,n),a.addEventListener(o,n)}function Yt(a,o,n){a.removeEventListener(o,n)}var tf={toString:function(o){for(var n="",r=o.length,e=0;e<r;e++)n+="["+o.start(e).toFixed(3)+"-"+o.end(e).toFixed(3)+"]";return n}},C={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Aa=(function(a){function o(r,e,t,i,s){var l;return l=a.call(this,i,r.logger)||this,l.hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=C.STOPPED,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.buffering=!0,l.loadingParts=!1,l.loopSn=void 0,l.onMediaSeeking=function(){var u=l,f=u.config,d=u.fragCurrent,h=u.media,c=u.mediaBuffer,v=u.state,g=h?h.currentTime:0,m=Se.bufferInfo(c||h,g,f.maxBufferHole),p=!m.len;if(l.log("Media seeking to "+(H(g)?g.toFixed(3):g)+", state: "+v+", "+(p?"out of":"in")+" buffer"),l.state===C.ENDED)l.resetLoadingState();else if(d){var E=f.maxFragLookUpTolerance,S=d.start-E,T=d.start+d.duration+E;if(p||T<m.start||S>m.end){var A=g>T;(g<S||A)&&(A&&d.loader&&(l.log("Cancelling fragment load for seek (sn: "+d.sn+")"),d.abortRequests(),l.resetLoadingState()),l.fragPrevious=null)}}if(h){l.fragmentTracker.removeFragmentsInRange(g,1/0,l.playlistType,!0);var x=l.lastCurrentTime;if(g>x&&(l.lastCurrentTime=g),!l.loadingParts){var b=Math.max(m.end,g),D=l.shouldLoadParts(l.getLevelDetails(),b);D&&(l.log("LL-Part loading ON after seeking to "+g.toFixed(2)+" with buffer @"+b.toFixed(2)),l.loadingParts=D)}}l.hls.hasEnoughToStart||(l.log("Setting "+(p?"startPosition":"nextLoadPosition")+" to "+g+" for seek without enough to start"),l.nextLoadPosition=g,p&&(l.startPosition=g)),p&&l.state===C.IDLE&&l.tickImmediate()},l.onMediaEnded=function(){l.log("setting startPosition to 0 because media ended"),l.startPosition=l.lastCurrentTime=0},l.playlistType=s,l.hls=r,l.fragmentLoader=new Ru(r.config),l.keyLoader=t,l.fragmentTracker=e,l.config=r.config,l.decrypter=new da(r.config),l}se(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.ERROR,this.onError,this)},n.doTick=function(){this.onTickEnd()},n.onTickEnd=function(){},n.startLoad=function(e){},n.stopLoad=function(){if(this.state!==C.STOPPED){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=C.STOPPED}},n.pauseBuffering=function(){this.buffering=!1},n.resumeBuffering=function(){this.buffering=!0},n._streamEnded=function(e,t){if(t.live||!this.media)return!1;var i=e.end||0,s=this.config.timelineOffset||0;if(i<=s)return!1;var l=e.buffered;this.config.maxBufferHole&&l&&l.length>1&&(e=Se.bufferedInfo(l,e.start,0));var u=e.nextStart,f=u&&u>s&&u<t.edge;if(f||this.media.currentTime<e.start)return!1;var d=t.partList;if(d!=null&&d.length){var h=d[d.length-1],c=Se.isBuffered(this.media,h.start+h.duration/2);return c}var v=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(v)},n.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details},n.onMediaAttached=function(e,t){var i=this.media=this.mediaBuffer=t.media;kt(i,"seeking",this.onMediaSeeking),kt(i,"ended",this.onMediaEnded);var s=this.config;this.levels&&s.autoStartLoad&&this.state===C.STOPPED&&this.startLoad(s.startPosition)},n.onMediaDetaching=function(e,t){var i=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Yt(s,"seeking",this.onMediaSeeking),Yt(s,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},n.onManifestLoading=function(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1},n.onError=function(e,t){},n.onManifestLoaded=function(e,t){this.startTimeOffset=t.startTimeOffset},n.onHandlerDestroying=function(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),a.prototype.onHandlerDestroying.call(this),this.hls=this.onMediaSeeking=this.onMediaEnded=null},n.onHandlerDestroyed=function(){this.state=C.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,a.prototype.onHandlerDestroyed.call(this)},n.loadFragment=function(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)},n._loadFragForPlayback=function(e,t,i){var s=this,l=function(f){var d=f.frag;if(s.fragContextChanged(d)){s.warn(d.type+" sn: "+d.sn+(f.part?" part: "+f.part.index:"")+" of "+s.fragInfo(d,!1,f.part)+") was dropped during download."),s.fragmentTracker.removeFragment(d);return}d.stats.chunkCount++,s._handleFragmentLoadProgress(f)};this._doFragLoad(e,t,i,l).then(function(u){if(u){var f=s.state,d=u.frag;if(s.fragContextChanged(d)){(f===C.FRAG_LOADING||!s.fragCurrent&&f===C.PARSING)&&(s.fragmentTracker.removeFragment(d),s.state=C.IDLE);return}"payload"in u&&(s.log("Loaded "+d.type+" sn: "+d.sn+" of "+s.playlistLabel()+" "+d.level),s.hls.trigger(y.FRAG_LOADED,u)),s._handleFragmentLoadComplete(u)}}).catch(function(u){s.state===C.STOPPED||s.state===C.ERROR||(s.warn("Frag error: "+(u?.message||u)),s.resetFragmentLoading(e))})},n.clearTrackerIfNeeded=function(e){var t,i=this.fragmentTracker,s=i.getState(e);if(s===lt.APPENDING){var l=e.type,u=this.getFwdBufferInfo(this.mediaBuffer,l),f=Math.max(e.duration,u?u.len:this.config.maxBufferLength),d=this.backtrackFragment,h=d?e.sn-d.sn:0;(h===1||this.reduceMaxBufferLength(f,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===lt.PARTIAL&&i.removeFragment(e))},n.checkLiveUpdate=function(e){if(e.updated&&!e.live){var t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)},n.waitForLive=function(e){var t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)},n.flushMainBuffer=function(e,t,i){if(i===void 0&&(i=null),!!(e-t)){var s={startOffset:e,endOffset:t,type:i};this.hls.trigger(y.BUFFER_FLUSHING,s)}},n._loadInitSegment=function(e,t){var i=this;this._doFragLoad(e,t).then(function(s){var l=s?.frag;if(!l||i.fragContextChanged(l)||!i.levels)throw new Error("init load aborted");return s}).then(function(s){var l=i.hls,u=s.frag,f=s.payload,d=u.decryptdata;if(f&&f.byteLength>0&&d!=null&&d.key&&d.iv&&ci(d.method)){var h=self.performance.now();return i.decrypter.decrypt(new Uint8Array(f),d.key.buffer,d.iv.buffer,va(d.method)).catch(function(c){throw l.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:u}),c}).then(function(c){var v=self.performance.now();return l.trigger(y.FRAG_DECRYPTED,{frag:u,payload:c,stats:{tstart:h,tdecrypt:v}}),s.payload=c,i.completeInitSegmentLoad(s)})}return i.completeInitSegmentLoad(s)}).catch(function(s){i.state===C.STOPPED||i.state===C.ERROR||(i.warn(s),i.resetFragmentLoading(e))})},n.completeInitSegmentLoad=function(e){var t=this.levels;if(!t)throw new Error("init load aborted, missing levels");var i=e.frag.stats;this.state!==C.STOPPED&&(this.state=C.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()},n.unhandledEncryptionError=function(e,t){var i,s,l=e.tracks;if(l&&!t.encrypted&&((i=l.audio)!=null&&i.encrypted||(s=l.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){var u=this.media,f=new Error("Encrypted track with no key in "+this.fragInfo(t)+" (media "+(u?"attached mediaKeys: "+u.mediaKeys:"detached")+")");return this.warn(f.message),!u||u.mediaKeys?!1:(this.hls.trigger(y.ERROR,{type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_KEYS,fatal:!1,error:f,frag:t}),this.resetTransmuxer(),!0)}return!1},n.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.sn!==t.sn||e.level!==t.level},n.fragBufferedComplete=function(e,t){var i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+this.fragInfo(e,!1,t)+" > buffer:"+(i?tf.toString(Se.getBuffered(i)):"(detached)")+")"),Ve(e)){var s;if(e.type!==F.SUBTITLE){var l=e.elementaryStreams;if(!Object.keys(l).some(function(f){return!!l[f]})){this.state=C.IDLE;return}}var u=(s=this.levels)==null?void 0:s[e.level];u!=null&&u.fragmentError&&(this.log("Resetting level fragment error count of "+u.fragmentError+" on frag buffered"),u.fragmentError=0)}this.state=C.IDLE},n._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var i=e.frag,s=e.part,l=e.partsLoaded,u=!l||l.length===0||l.some(function(d){return!d}),f=new ha(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!u);t.flush(f)}},n._handleFragmentLoadProgress=function(e){},n._doFragLoad=function(e,t,i,s){var l,u=this;i===void 0&&(i=null),this.fragCurrent=e;var f=t.details;if(!this.levels||!f)throw new Error("frag load aborted, missing level"+(f?"":" detail")+"s");var d=null;if(e.encrypted&&!((l=e.decryptdata)!=null&&l.key)){if(this.log("Loading key for "+e.sn+" of ["+f.startSN+"-"+f.endSN+"], "+this.playlistLabel()+" "+e.level),this.state=C.KEY_LOADING,this.fragCurrent=e,d=this.keyLoader.load(e).then(function(A){if(!u.fragContextChanged(A.frag))return u.hls.trigger(y.KEY_LOADED,A),u.state===C.KEY_LOADING&&(u.state=C.IDLE),A}),this.hls.trigger(y.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(d=this.keyLoader.loadClear(e,f.encryptedFragments,this.startFragRequested),d&&this.log("[eme] blocking frag load until media-keys acquired"));var h=this.fragPrevious;if(Ve(e)&&(!h||e.sn!==h.sn)){var c=this.shouldLoadParts(t.details,e.end);c!==this.loadingParts&&(this.log("LL-Part loading "+(c?"ON":"OFF")+" loading sn "+h?.sn+"->"+e.sn),this.loadingParts=c)}if(i=Math.max(e.start,i||0),this.loadingParts&&Ve(e)){var v=f.partList;if(v&&s){i>f.fragmentEnd&&f.fragmentHint&&(e=f.fragmentHint);var g=this.getNextPart(v,e,i);if(g>-1){var m=v[g];e=this.fragCurrent=m.fragment,this.log("Loading "+e.type+" sn: "+e.sn+" part: "+m.index+" ("+g+"/"+(v.length-1)+") of "+this.fragInfo(e,!1,m)+") cc: "+e.cc+" ["+f.startSN+"-"+f.endSN+"], target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=m.start+m.duration,this.state=C.FRAG_LOADING;var p;return d?p=d.then(function(A){return!A||u.fragContextChanged(A.frag)?null:u.doFragPartsLoad(e,m,t,s)}).catch(function(A){return u.handleFragLoadError(A)}):p=this.doFragPartsLoad(e,m,t,s).catch(function(A){return u.handleFragLoadError(A)}),this.hls.trigger(y.FRAG_LOADING,{frag:e,part:m,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(v,i))return Promise.resolve(null)}}if(Ve(e)&&this.loadingParts){var E;this.log("LL-Part loading OFF after next part miss @"+i.toFixed(2)+" Check buffer at sn: "+e.sn+" loaded parts: "+((E=f.partList)==null?void 0:E.filter(function(A){return A.loaded}).map(function(A){return"["+A.start+"-"+A.end+"]"}))),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log("Loading "+e.type+" sn: "+e.sn+" of "+this.fragInfo(e,!1)+") cc: "+e.cc+" "+("["+f.startSN+"-"+f.endSN+"]")+", target: "+parseFloat(i.toFixed(3))),H(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=C.FRAG_LOADING;var S=this.config.progressive,T;return S&&d?T=d.then(function(A){return!A||u.fragContextChanged(A.frag)?null:u.fragmentLoader.load(e,s)}).catch(function(A){return u.handleFragLoadError(A)}):T=Promise.all([this.fragmentLoader.load(e,S?s:void 0),d]).then(function(A){var x=A[0];return!S&&s&&s(x),x}).catch(function(A){return u.handleFragLoadError(A)}),this.hls.trigger(y.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):T},n.doFragPartsLoad=function(e,t,i,s){var l=this;return new Promise(function(u,f){var d,h=[],c=(d=i.details)==null?void 0:d.partList,v=function(m){l.fragmentLoader.loadPart(e,m,s).then(function(p){h[m.index]=p;var E=p.part;l.hls.trigger(y.FRAG_LOADED,p);var S=go(i.details,e.sn,m.index+1)||mo(c,e.sn,m.index+1);if(S)v(S);else return u({frag:e,part:E,partsLoaded:h})}).catch(f)};v(t)})},n.handleFragLoadError=function(e){if("data"in e){var t=e.data;t.frag&&t.details===_.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===W.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetFragmentLoading(t.frag)):this.hls.trigger(y.ERROR,t)}else this.hls.trigger(y.ERROR,{type:W.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},n._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(!t||this.state!==C.PARSING){!this.fragCurrent&&this.state!==C.STOPPED&&this.state!==C.ERROR&&(this.state=C.IDLE);return}var i=t.frag,s=t.part,l=t.level,u=self.performance.now();i.stats.parsing.end=u,s&&(s.stats.parsing.end=u);var f=this.getLevelDetails(),d=f&&i.sn>f.endSN,h=d||this.shouldLoadParts(f,i.end);h!==this.loadingParts&&(this.log("LL-Part loading "+(h?"ON":"OFF")+" after parsing segment ending @"+i.end.toFixed(2)),this.loadingParts=h),this.updateLevelTiming(i,s,l,e.partial)},n.shouldLoadParts=function(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i,s=e.partList[0];if(s.fragment.type===F.SUBTITLE)return!1;var l=s.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=l){var u,f=this.hls.hasEnoughToStart?((u=this.media)==null?void 0:u.currentTime)||this.lastCurrentTime:this.getLoadPosition();if(f>s.start-s.fragment.duration)return!0}}}return!1},n.getCurrentContext=function(e){var t=this.levels,i=this.fragCurrent,s=e.level,l=e.sn,u=e.part;if(!(t!=null&&t[s]))return this.warn("Levels object was unset while buffering fragment "+l+" of "+this.playlistLabel()+" "+s+". The current chunk will not be buffered."),null;var f=t[s],d=f.details,h=u>-1?go(d,l,u):null,c=h?h.fragment:vo(d,l,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:h,level:f}):null},n.bufferFragmentData=function(e,t,i,s,l){if(this.state===C.PARSING){var u=e.data1,f=e.data2,d=u;if(f&&(d=Kt(u,f)),!!d.length){var h=this.initPTS[t.cc],c=h?-h.baseTime/h.timescale:void 0,v={type:e.type,frag:t,part:i,chunkMeta:s,offset:c,parent:t.type,data:d};if(this.hls.trigger(y.BUFFER_APPENDING,v),e.dropped&&e.independent&&!i){if(l)return;this.flushBufferGap(t)}}}},n.flushBufferGap=function(e){var t=this.media;if(t){if(!Se.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}var i=t.currentTime,s=Se.bufferInfo(t,i,0),l=e.duration,u=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),f=Math.max(Math.min(e.start-u,s.end-u),i+u);e.start-f>u&&this.flushMainBuffer(f,e.start)}},n.getFwdBufferInfo=function(e,t){var i,s=this.getLoadPosition();if(!H(s))return null;var l=this.lastCurrentTime>s,u=l||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,u)},n.getFwdBufferInfoAtPos=function(e,t,i,s){var l=Se.bufferInfo(e,t,s);if(l.len===0&&l.nextStart!==void 0){var u=this.fragmentTracker.getBufferedFrag(t,i);if(u&&(l.nextStart<=u.end||u.gap)){var f=Math.max(Math.min(l.nextStart,u.end)-t,s);return Se.bufferInfo(e,t,f)}}return l},n.getMaxBufferLength=function(e){var t=this.config,i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)},n.reduceMaxBufferLength=function(e,t){var i=this.config,s=Math.max(Math.min(e-t,i.maxBufferLength),t),l=Math.max(e-t*3,i.maxMaxBufferLength/2,s);return l>=s?(i.maxMaxBufferLength=l,this.warn("Reduce max buffer length to "+l+"s"),!0):!1},n.getAppendedFrag=function(e,t){t===void 0&&(t=F.MAIN);var i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i},n.getNextFragment=function(e,t){var i=t.fragments,s=i.length;if(!s)return null;var l=this.config,u=i[0].start,f=l.lowLatencyMode&&!!t.partList,d=null;if(t.live){var h=l.initialLiveManifestSize;if(s<h)return this.warn("Not enough fragments to start playback (have: "+s+", need: "+h+")"),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<u){var c;f&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t);var v=this.hls.startPosition,g=this.hls.liveSyncPosition,m=d?(v!==-1&&v>=u?v:g)||d.start:e;this.log("Setting startPosition to "+m+" to match start frag at live edge. mainStart: "+v+" liveSyncPosition: "+g+" frag.start: "+((c=d)==null?void 0:c.start)),this.startPosition=this.nextLoadPosition=m}}else e<=u&&(d=i[0]);if(!d){var p=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,p,t)}var E=this.filterReplacedPrimary(d,t);if(!E&&d){var S=d.sn-t.startSN;E=this.filterReplacedPrimary(i[S+1]||null,t)}return this.mapToInitFragWhenRequired(E)},n.isLoopLoading=function(e,t){var i=this.fragmentTracker.getState(e);return(i===lt.OK||i===lt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t},n.getNextFragmentLoopLoading=function(e,t,i,s,l){var u=null;if(e.gap&&(u=this.getNextFragment(this.nextLoadPosition,t),u&&!u.gap&&i.nextStart)){var f=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s,0);if(f!==null&&i.len+f.len>=l){var d=u.sn;return this.loopSn!==d&&(this.log('buffer full after gaps in "'+s+'" playlist starting at sn: '+d),this.loopSn=d),null}}return this.loopSn=void 0,u},n.filterReplacedPrimary=function(e,t){if(!e)return e;if(Ao(this.config)&&e.type!==F.SUBTITLE){var i=this.hls.interstitialsManager,s=i?.bufferingItem;if(s){var l=s.event;if(l){if(l.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&t?.live===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}var u=i?.playerQueue;if(u)for(var f=u.length;f--;){var d=u[f].interstitial;if(d.appendInPlace&&e.start>=d.startTime&&e.end<=d.resumeTime)return null}}return e},n.mapToInitFragWhenRequired=function(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e},n.getNextPart=function(e,t,i){for(var s=-1,l=!1,u=!0,f=0,d=e.length;f<d;f++){var h=e[f];if(u=u&&!h.independent,s>-1&&i<h.start)break;var c=h.loaded;c?s=-1:(l||(h.independent||u)&&h.fragment===t)&&(h.fragment!==t&&this.warn("Need buffer at "+i+" but next unloaded part starts at "+h.start),s=f),l=c}return s},n.loadedEndOfParts=function(e,t){for(var i,s=e.length;s--;){if(i=e[s],!i.loaded)return!1;if(t>i.start)return!0}return!1},n.getInitialLiveFragment=function(e){var t=e.fragments,i=this.fragPrevious,s=null;if(i){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),s=gu(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){var l=i.sn+1;if(l>=e.startSN&&l<=e.endSN){var u=t[l-e.startSN];i.cc===u.cc&&(s=u,this.log("Live playlist, switching playlist, load frag with next SN: "+s.sn))}s||(s=Os(e,i.cc,i.end),s&&this.log("Live playlist, switching playlist, load frag with same CC: "+s.sn))}}else{var f=this.hls.liveSyncPosition;f!==null&&(s=this.getFragmentAtPosition(f,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s},n.getFragmentAtPosition=function(e,t,i){var s=this.config,l=this.fragPrevious,u=i.fragments,f=i.endSN,d=i.fragmentHint,h=s.maxFragLookUpTolerance,c=i.partList,v=!!(this.loadingParts&&c!=null&&c.length&&d);v&&!this.bitrateTest&&c[c.length-1].fragment.sn===d.sn&&(u=u.concat(d),f=d.sn);var g;if(e<t){var m,p=e<this.lastCurrentTime,E=p||e>t-h||(m=this.media)!=null&&m.paused||!this.startFragRequested?0:h;g=Yr(l,u,e,E)}else g=u[u.length-1];if(g){var S=g.sn-i.startSN,T=this.fragmentTracker.getState(g);if((T===lt.OK||T===lt.PARTIAL&&g.gap)&&(l=g),l&&g.sn===l.sn&&(!v||c[0].fragment.sn>g.sn||!i.live)){var A=g.level===l.level;if(A){var x=u[S+1];g.sn<f&&this.fragmentTracker.getState(x)!==lt.OK?g=x:g=null}}}return g},n.alignPlaylists=function(e,t,i){var s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;var l=e.fragmentStart,u=!t,f=e.alignedSliding&&H(l);if(u||!f&&!l){ef(i,e);var d=e.fragmentStart;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" fragments: "+s),d}return l},n.waitForCdnTuneIn=function(e){var t=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*t)},n.setStartPosition=function(e,t){var i=this.startPosition;i<t&&(i=-1);var s=this.timelineOffset;if(i===-1){var l=this.startTimeOffset!==null,u=l?this.startTimeOffset:e.startTimeOffset;u!==null&&H(u)?(i=t+u,u<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log("Setting startPosition to "+i+" for start time offset "+u+" found in "+(l?"multivariant":"media")+" playlist"),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge "+i),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+s}this.nextLoadPosition=i+s},n.getLoadPosition=function(){var e,t=this.media,i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i},n.handleFragLoadAborted=function(e,t){this.transmuxer&&e.type===this.playlistType&&Ve(e)&&e.stats.aborted&&(this.log("Fragment "+e.sn+(t?" part "+t.index:"")+" of "+this.playlistLabel()+" "+e.level+" was aborted"),this.resetFragmentLoading(e))},n.resetFragmentLoading=function(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==C.FRAG_LOADING_WAITING_RETRY)&&(this.state=C.IDLE)},n.onFragmentOrKeyLoadError=function(e,t){var i;if(t.chunkMeta&&!t.frag){var s=this.getCurrentContext(t.chunkMeta);s&&(t.frag=s.frag)}var l=t.frag;if(!(!l||l.type!==e||!this.levels)){if(this.fragContextChanged(l)){var u;this.warn("Frag load error must match current frag to retry "+l.url+" > "+((u=this.fragCurrent)==null?void 0:u.url));return}var f=t.details===_.FRAG_GAP;f&&this.fragmentTracker.fragBuffered(l,!0);var d=t.errorAction;if(!d){this.state=C.ERROR;return}var h=d.action,c=d.flags,v=d.retryCount,g=v===void 0?0:v,m=d.retryConfig,p=!!m,E=p&&h===yt.RetryRequest,S=p&&!d.resolved&&c===zt.MoveAllAlternatesMatchingHost,T=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!E&&S&&Ve(l)&&!l.endList&&T)this.resetFragmentErrors(e),this.treatAsGap(l),d.resolved=!0;else if((E||S)&&g<m.maxNumRetry){var A,x=fa((A=t.response)==null?void 0:A.code),b=ua(m,g);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+b,this.state=C.FRAG_LOADING_WAITING_RETRY,d.resolved=!0,x){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn("Fragment "+l.sn+" of "+e+" "+l.level+" errored with "+t.details+", retrying loading "+(g+1)+"/"+m.maxNumRetry+" in "+b+"ms")}else if(m)if(this.resetFragmentErrors(e),g<m.maxNumRetry)!f&&h!==yt.RemoveAlternatePermanently&&(d.resolved=!0);else{this.warn(t.details+" reached or exceeded max retry ("+g+")");return}else h===yt.SendAlternateToPenaltyBox?this.state=C.WAITING_LEVEL:this.state=C.ERROR;this.tickImmediate()}},n.checkRetryDate=function(){var e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!fa(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=C.IDLE)},n.reduceLengthAndFlushBuffer=function(e){if(this.state===C.PARSING||this.state===C.PARSED){var t=e.frag,i=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,i),l=s&&s.len>.5;l&&this.reduceMaxBufferLength(s.len,t?.duration||10);var u=!l;return u&&this.warn("Buffer full error while media.currentTime ("+this.getLoadPosition()+") is not buffered, flush "+i+" buffer"),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),u}return!1},n.resetFragmentErrors=function(e){e===F.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==C.STOPPED&&(this.state=C.IDLE)},n.afterBufferFlushed=function(e,t,i){if(e){var s=Se.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===C.ENDED&&this.resetLoadingState()}},n.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==C.STOPPED&&(this.state=C.IDLE)},n.resetStartWhenNotLoaded=function(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;var e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},n.resetWhenMissingContext=function(e){this.log("Loading context changed while buffering sn "+e.sn+" of "+this.playlistLabel()+" "+(e.level===-1?"<removed>":e.level)+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()},n.removeUnbufferedFrags=function(e){e===void 0&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},n.updateLevelTiming=function(e,t,i,s){var l=this,u=i.details;if(!u){this.warn("level.details undefined");return}var f=Object.keys(e.elementaryStreams).reduce(function(c,v){var g=e.elementaryStreams[v];if(g){var m=g.endPTS-g.startPTS;if(m<=0)return l.warn("Could not parse fragment "+e.sn+" "+v+" duration reliably ("+m+")"),c||!1;var p=s?0:uo(u,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS,l);return l.hls.trigger(y.LEVEL_PTS_UPDATED,{details:u,level:i,drift:p,type:v,frag:e,start:g.startPTS,end:g.endPTS}),!0}return c},!1);if(!f){var d;if(i.fragmentError===0&&this.treatAsGap(e,i),((d=this.transmuxer)==null?void 0:d.error)===null){var h=new Error("Found no media in fragment "+e.sn+" of "+this.playlistLabel()+" "+e.level+" resetting transmuxer to fallback to playlist timing");if(this.warn(h.message),this.hls.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:e,reason:"Found no media in msn "+e.sn+" of "+this.playlistLabel()+' "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}}this.state=C.PARSED,this.log("Parsed "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+this.fragInfo(e,!1,t)+")"),this.hls.trigger(y.FRAG_PARSED,{frag:e,part:t})},n.playlistLabel=function(){return this.playlistType===F.MAIN?"level":"track"},n.fragInfo=function(e,t,i){var s,l;return t===void 0&&(t=!0),this.playlistLabel()+" "+e.level+" ("+(i?"part":"frag")+":["+((s=t&&!i?e.startPTS:(i||e).start)!=null?s:NaN).toFixed(3)+"-"+((l=t&&!i?e.endPTS:(i||e).end)!=null?l:NaN).toFixed(3)+"]"+(i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):"")},n.treatAsGap=function(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)},n.resetTransmuxer=function(){var e;(e=this.transmuxer)==null||e.reset()},n.recoverWorkerError=function(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())},Y(o,[{key:"startPositionValue",get:function(){var e=this.nextLoadPosition,t=this.startPosition;return t===-1&&e?e:t}},{key:"bufferingEnabled",get:function(){return this.buffering}},{key:"inFlightFrag",get:function(){return{frag:this.fragCurrent,state:this.state}}},{key:"timelineOffset",get:function(){var e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}},{key:"primaryPrefetch",get:function(){if(Ao(this.config)){var e,t=(e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event;if(t)return!0}return!1}},{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}])})(Vs);function Ao(a){return!!a.interstitialsController&&a.enableInterstitialPlayback!==!1}var xo=(function(){function a(){this.chunks=[],this.dataLength=0}var o=a.prototype;return o.push=function(r){this.chunks.push(r),this.dataLength+=r.length},o.flush=function(){var r=this.chunks,e=this.dataLength,t;if(r.length)r.length===1?t=r[0]:t=rf(r,e);else return new Uint8Array(0);return this.reset(),t},o.reset=function(){this.chunks.length=0,this.dataLength=0},a})();function rf(a,o){for(var n=new Uint8Array(o),r=0,e=0;e<a.length;e++){var t=a[e];n.set(t,r),r+=t.length}return n}function Lo(a,o){return o+10<=a.length&&a[o]===51&&a[o+1]===68&&a[o+2]===73&&a[o+3]<255&&a[o+4]<255&&a[o+6]<128&&a[o+7]<128&&a[o+8]<128&&a[o+9]<128}function xa(a,o){return o+10<=a.length&&a[o]===73&&a[o+1]===68&&a[o+2]===51&&a[o+3]<255&&a[o+4]<255&&a[o+6]<128&&a[o+7]<128&&a[o+8]<128&&a[o+9]<128}function pn(a,o){var n=0;return n=(a[o]&127)<<21,n|=(a[o+1]&127)<<14,n|=(a[o+2]&127)<<7,n|=a[o+3]&127,n}function Ni(a,o){for(var n=o,r=0;xa(a,o);){r+=10;var e=pn(a,o+6);r+=e,Lo(a,o+10)&&(r+=10),o+=r}if(r>0)return a.subarray(n,n+r)}function nf(a,o,n,r){var e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],t=o[n+2],i=t>>2&15;if(i>12){var s=new Error("invalid ADTS sampling index:"+i);a.emit(y.ERROR,y.ERROR,{type:W.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!0,error:s,reason:s.message});return}var l=(t>>6&3)+1,u=o[n+3]>>6&3|(t&1)<<2,f="mp4a.40."+l,d=e[i],h=i;(l===5||l===29)&&(h-=3);var c=[l<<3|(h&14)>>1,(h&1)<<7|u<<3];return Le.log("manifest codec:"+r+", parsed codec:"+f+", channels:"+u+", rate:"+d+" (ADTS object type:"+l+" sampling index:"+i+")"),{config:c,samplerate:d,channelCount:u,codec:f,parsedCodec:f,manifestCodec:r}}function Io(a,o){return a[o]===255&&(a[o+1]&246)===240}function bo(a,o){return a[o+1]&1?7:9}function La(a,o){return(a[o+3]&3)<<11|a[o+4]<<3|(a[o+5]&224)>>>5}function af(a,o){return o+5<a.length}function yn(a,o){return o+1<a.length&&Io(a,o)}function sf(a,o){return af(a,o)&&Io(a,o)&&La(a,o)<=a.length-o}function of(a,o){if(yn(a,o)){var n=bo(a,o);if(o+n>=a.length)return!1;var r=La(a,o);if(r<=n)return!1;var e=o+r;return e===a.length||yn(a,e)}return!1}function Ro(a,o,n,r,e){if(!a.samplerate){var t=nf(o,n,r,e);if(!t)return;ae(a,t)}}function _o(a){return 1024*9e4/a}function lf(a,o){var n=bo(a,o);if(o+n<=a.length){var r=La(a,o)-n;if(r>0)return{headerLength:n,frameLength:r}}}function Do(a,o,n,r,e){var t=_o(a.samplerate),i=r+e*t,s=lf(o,n),l;if(s){var u=s.frameLength,f=s.headerLength,d=f+u,h=Math.max(0,n+d-o.length);h?(l=new Uint8Array(d-f),l.set(o.subarray(n+f,o.length),0)):l=o.subarray(n+f,n+d);var c={unit:l,pts:i};return h||a.samples.push(c),{sample:c,length:d,missing:h}}var v=o.length-n;l=new Uint8Array(v),l.set(o.subarray(n,o.length),0);var g={unit:l,pts:i};return{sample:g,length:v,missing:-1}}function uf(a,o){return xa(a,o)&&pn(a,o+6)+10<=a.length-o}function ff(a){return a instanceof ArrayBuffer?a:a.byteOffset==0&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer}function Ia(a,o,n){return o===void 0&&(o=0),n===void 0&&(n=1/0),df(a,o,n,Uint8Array)}function df(a,o,n,r){var e=hf(a),t=1;"BYTES_PER_ELEMENT"in r&&(t=r.BYTES_PER_ELEMENT);var i=cf(a)?a.byteOffset:0,s=(i+a.byteLength)/t,l=(i+o)/t,u=Math.floor(Math.max(0,Math.min(l,s))),f=Math.floor(Math.min(u+Math.max(n,0),s));return new r(e,u,f-u)}function hf(a){return a instanceof ArrayBuffer?a:a.buffer}function cf(a){return a&&a.buffer instanceof ArrayBuffer&&a.byteLength!==void 0&&a.byteOffset!==void 0}function vf(a){var o={key:a.type,description:"",data:"",mimeType:null,pictureType:null},n=3;if(!(a.size<2)){if(a.data[0]!==n){console.log("Ignore frame with unrecognized character encoding");return}var r=a.data.subarray(1).indexOf(0);if(r!==-1){var e=Me(Ia(a.data,1,r)),t=a.data[2+r],i=a.data.subarray(3+r).indexOf(0);if(i!==-1){var s=Me(Ia(a.data,3+r,i)),l;return e==="-->"?l=Me(Ia(a.data,4+r+i)):l=ff(a.data.subarray(4+r+i)),o.mimeType=e,o.pictureType=t,o.description=s,o.data=l,o}}}}function gf(a){if(!(a.size<2)){var o=Me(a.data,!0),n=new Uint8Array(a.data.subarray(o.length+1));return{key:a.type,info:o,data:n.buffer}}}function mf(a){if(!(a.size<2)){if(a.type==="TXXX"){var o=1,n=Me(a.data.subarray(o),!0);o+=n.length+1;var r=Me(a.data.subarray(o));return{key:a.type,info:n,data:r}}var e=Me(a.data.subarray(1));return{key:a.type,info:"",data:e}}}function pf(a){if(a.type==="WXXX"){if(a.size<2)return;var o=1,n=Me(a.data.subarray(o),!0);o+=n.length+1;var r=Me(a.data.subarray(o));return{key:a.type,info:n,data:r}}var e=Me(a.data);return{key:a.type,info:"",data:e}}function yf(a){return a.type==="PRIV"?gf(a):a.type[0]==="W"?pf(a):a.type==="APIC"?vf(a):mf(a)}function Ef(a){var o=String.fromCharCode(a[0],a[1],a[2],a[3]),n=pn(a,4),r=10;return{type:o,size:n,data:a.subarray(r,r+n)}}var En=10,Tf=10;function ko(a){for(var o=0,n=[];xa(a,o);){var r=pn(a,o+6);a[o+5]>>6&1&&(o+=En),o+=En;for(var e=o+r;o+Tf<e;){var t=Ef(a.subarray(o)),i=yf(t);i&&n.push(i),o+=t.size+En}Lo(a,o)&&(o+=En)}return n}function Po(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function Sf(a){if(a.data.byteLength===8){var o=new Uint8Array(a.data),n=o[3]&1,r=(o[4]<<23)+(o[5]<<15)+(o[6]<<7)+o[7];return r/=45,n&&(r+=4772185884e-2),Math.round(r)}}function ba(a){for(var o=ko(a),n=0;n<o.length;n++){var r=o[n];if(Po(r))return Sf(r)}}var Qt=(function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a})({});function cr(a,o){return a===void 0&&(a=""),o===void 0&&(o=9e4),{type:a,id:-1,pid:-1,inputTimeScale:o,sequenceNumber:-1,samples:[],dropped:0}}var Ra=(function(){function a(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var o=a.prototype;return o.resetInitSegment=function(r,e,t,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},o.resetTimeStamp=function(r){this.initPTS=r,this.resetContiguity()},o.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},o.canParse=function(r,e){return!1},o.appendFrame=function(r,e,t){},o.demux=function(r,e){this.cachedData&&(r=Kt(this.cachedData,r),this.cachedData=null);var t=Ni(r,0),i=t?t.length:0,s,l=this._audioTrack,u=this._id3Track,f=t?ba(t):void 0,d=r.length;for((this.basePTS===null||this.frameIndex===0&&H(f))&&(this.basePTS=Af(f,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),t&&t.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:t,type:Qt.audioId3,duration:Number.POSITIVE_INFINITY});i<d;){if(this.canParse(r,i)){var h=this.appendFrame(l,r,i);h?(this.frameIndex++,this.lastPTS=h.sample.pts,i+=h.length,s=i):i=d}else uf(r,i)?(t=Ni(r,i),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:t,type:Qt.audioId3,duration:Number.POSITIVE_INFINITY}),i+=t.length,s=i):i++;if(i===d&&s!==d){var c=r.slice(s);this.cachedData?this.cachedData=Kt(this.cachedData,c):this.cachedData=c}}return{audioTrack:l,videoTrack:cr(),id3Track:u,textTrack:cr()}},o.demuxSampleAes=function(r,e,t){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},o.flush=function(r){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:cr(),id3Track:this._id3Track,textTrack:cr()}},o.destroy=function(){this.cachedData=null,this._audioTrack=this._id3Track=void 0},a})(),Af=function(o,n,r){if(H(o))return o*90;var e=r?r.baseTime*9e4/r.timescale:0;return n*9e4+e},Tn=null,xf=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Lf=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],If=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],bf=[0,1,1,4];function Co(a,o,n,r,e){if(!(n+24>o.length)){var t=wo(o,n);if(t&&n+t.frameLength<=o.length){var i=t.samplesPerFrame*9e4/t.sampleRate,s=r+e*i,l={unit:o.subarray(n,n+t.frameLength),pts:s,dts:s};return a.config=[],a.channelCount=t.channelCount,a.samplerate=t.sampleRate,a.samples.push(l),{sample:l,length:t.frameLength,missing:0}}}}function wo(a,o){var n=a[o+1]>>3&3,r=a[o+1]>>1&3,e=a[o+2]>>4&15,t=a[o+2]>>2&3;if(n!==1&&e!==0&&e!==15&&t!==3){var i=a[o+2]>>1&1,s=a[o+3]>>6,l=n===3?3-r:r===3?3:4,u=xf[l*14+e-1]*1e3,f=n===3?0:n===2?1:2,d=Lf[f*3+t],h=s===3?1:2,c=If[n][r],v=bf[r],g=c*8*v,m=Math.floor(c*u/d+i)*v;if(Tn===null){var p=navigator.userAgent||"",E=p.match(/Chrome\/(\d+)/i);Tn=E?parseInt(E[1]):0}var S=!!Tn&&Tn<=87;return S&&r===2&&u>=224e3&&s===0&&(a[o+3]=a[o+3]|128),{sampleRate:d,channelCount:h,frameLength:m,samplesPerFrame:g}}}function _a(a,o){return a[o]===255&&(a[o+1]&224)===224&&(a[o+1]&6)!==0}function Mo(a,o){return o+1<a.length&&_a(a,o)}function Rf(a,o){var n=4;return _a(a,o)&&n<=a.length-o}function Oo(a,o){if(o+1<a.length&&_a(a,o)){var n=4,r=wo(a,o),e=n;r!=null&&r.frameLength&&(e=r.frameLength);var t=o+e;return t===a.length||Mo(a,t)}return!1}var _f=(function(a){function o(r,e){var t;return t=a.call(this)||this,t.observer=void 0,t.config=void 0,t.observer=r,t.config=e,t}se(o,a);var n=o.prototype;return n.resetInitSegment=function(e,t,i,s){a.prototype.resetInitSegment.call(this,e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}},o.probe=function(e,t){if(!e)return!1;var i=Ni(e,0),s=i?.length||0;if(Oo(e,s))return!1;for(var l=e.length;s<l;s++)if(of(e,s))return t.log("ADTS sync word found !"),!0;return!1},n.canParse=function(e,t){return sf(e,t)},n.appendFrame=function(e,t,i){Ro(e,this.observer,t,i,e.manifestCodec);var s=Do(e,t,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s},o})(Ra),Fo=function(o,n){var r=0,e=5;n+=e;for(var t=new Uint32Array(1),i=new Uint32Array(1),s=new Uint8Array(1);e>0;){s[0]=o[n];var l=Math.min(e,8),u=8-l;i[0]=4278190080>>>24+u<<u,t[0]=(s[0]&i[0])>>u,r=r?r<<l|t[0]:t[0],n+=1,e-=l}return r},Df=(function(a){function o(r){var e;return e=a.call(this)||this,e.observer=void 0,e.observer=r,e}se(o,a);var n=o.prototype;return n.resetInitSegment=function(e,t,i,s){a.prototype.resetInitSegment.call(this,e,t,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}},n.canParse=function(e,t){return t+64<e.length},n.appendFrame=function(e,t,i){var s=No(e,t,i,this.basePTS,this.frameIndex);if(s!==-1){var l=e.samples[e.samples.length-1];return{sample:l,length:s,missing:0}}},o.probe=function(e){if(!e)return!1;var t=Ni(e,0);if(!t)return!1;var i=t.length;return e[i]===11&&e[i+1]===119&&ba(t)!==void 0&&Fo(e,i)<16},o})(Ra);function No(a,o,n,r,e){if(n+8>o.length||o[n]!==11||o[n+1]!==119)return-1;var t=o[n+4]>>6;if(t>=3)return-1;var i=[48e3,44100,32e3],s=i[t],l=o[n+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920],f=u[l*3+t]*2;if(n+f>o.length)return-1;var d=o[n+6]>>5,h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));var c=(o[n+6]<<8|o[n+7])>>12-h&1,v=[2,1,2,3,3,4,4,5],g=v[d]+c,m=o[n+5]>>3,p=o[n+5]&7,E=new Uint8Array([t<<6|m<<1|p>>2,(p&3)<<6|d<<3|c<<2|l>>4,l<<4&224]),S=1536/s*9e4,T=r+e*S,A=o.subarray(n,n+f);return a.config=E,a.channelCount=g,a.samplerate=s,a.samples.push({unit:A,pts:T}),f}var kf=(function(a){function o(){return a.apply(this,arguments)||this}se(o,a);var n=o.prototype;return n.resetInitSegment=function(e,t,i,s){a.prototype.resetInitSegment.call(this,e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}},o.probe=function(e){if(!e)return!1;var t=Ni(e,0),i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&ba(t)!==void 0&&Fo(e,i)<=16)return!1;for(var s=e.length;i<s;i++)if(Oo(e,i))return Le.log("MPEG Audio sync word found !"),!0;return!1},n.canParse=function(e,t){return Rf(e,t)},n.appendFrame=function(e,t,i){if(this.basePTS!==null)return Co(e,t,i,this.basePTS,this.frameIndex)},o})(Ra),Pf=/\/emsg[-/]ID3/i,Cf=(function(){function a(n,r){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}var o=a.prototype;return o.resetTimeStamp=function(){},o.resetInitSegment=function(r,e,t,i){var s=this.videoTrack=cr("video",1),l=this.audioTrack=cr("audio",1),u=this.txtTrack=cr("text",1);if(this.id3Track=cr("id3",1),this.timeOffset=0,!!(r!=null&&r.byteLength)){var f=ii(r);if(f.video){var d=f.video,h=d.id,c=d.timescale,v=d.codec,g=d.supplemental;s.id=h,s.timescale=u.timescale=c,s.codec=v,s.supplemental=g}if(f.audio){var m=f.audio,p=m.id,E=m.timescale,S=m.codec;l.id=p,l.timescale=E,l.codec=S}u.id=jt.text,s.sampleDuration=0,s.duration=l.duration=i}},o.resetContiguity=function(){this.remainderData=null},a.probe=function(r){return xi(r)},o.demux=function(r,e){this.timeOffset=e;var t=r,i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(t=Kt(this.remainderData,r));var l=Ii(t);this.remainderData=l.remainder,i.samples=l.valid||new Uint8Array}else i.samples=t;var u=this.extractID3Track(i,e);return s.samples=ai(e,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:u,textTrack:this.txtTrack}},o.flush=function(){var r=this.timeOffset,e=this.videoTrack,t=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(e,this.timeOffset);return t.samples=ai(r,e),{videoTrack:e,audioTrack:cr(),id3Track:i,textTrack:cr()}},o.extractID3Track=function(r,e){var t=this,i=this.id3Track;if(r.samples.length){var s=ye(r.samples,["emsg"]);s&&s.forEach(function(l){var u=Zn(l);if(Pf.test(u.schemeIdUri)){var f=Uo(u,e),d=u.eventDuration===4294967295?Number.POSITIVE_INFINITY:u.eventDuration/u.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var h=u.payload;i.samples.push({data:h,len:h.byteLength,dts:f,pts:f,type:Qt.emsg,duration:d})}else if(t.config.enableEmsgKLVMetadata&&u.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){var c=Uo(u,e);i.samples.push({data:u.payload,len:u.payload.byteLength,dts:c,pts:c,type:Qt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i},o.demuxSampleAes=function(r,e,t){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},o.destroy=function(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0},a})();function Uo(a,o){return H(a.presentationTime)?a.presentationTime/a.timeScale:o+a.presentationTimeDelta/a.timeScale}var wf=(function(){function a(n,r,e){this.keyData=void 0,this.decrypter=void 0,this.keyData=e,this.decrypter=new da(r,{removePKCS7Padding:!1})}var o=a.prototype;return o.decryptBuffer=function(r){return this.decrypter.decrypt(r,this.keyData.key.buffer,this.keyData.iv.buffer,Cr.cbc)},o.decryptAacSample=function(r,e,t){var i=this,s=r[e].unit;if(!(s.length<=16)){var l=s.subarray(16,s.length-s.length%16),u=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(u).then(function(f){var d=new Uint8Array(f);s.set(d,16),i.decrypter.isSync()||i.decryptAacSamples(r,e+1,t)}).catch(t)}},o.decryptAacSamples=function(r,e,t){for(;;e++){if(e>=r.length){t();return}if(!(r[e].unit.length<32)&&(this.decryptAacSample(r,e,t),!this.decrypter.isSync()))return}},o.getAvcEncryptedData=function(r){for(var e=Math.floor((r.length-48)/160)*16+16,t=new Int8Array(e),i=0,s=32;s<r.length-16;s+=160,i+=16)t.set(r.subarray(s,s+16),i);return t},o.getAvcDecryptedUnit=function(r,e){for(var t=new Uint8Array(e),i=0,s=32;s<r.length-16;s+=160,i+=16)r.set(t.subarray(i,i+16),s);return r},o.decryptAvcSample=function(r,e,t,i,s){var l=this,u=si(s.data),f=this.getAvcEncryptedData(u);this.decryptBuffer(f.buffer).then(function(d){s.data=l.getAvcDecryptedUnit(u,d),l.decrypter.isSync()||l.decryptAvcSamples(r,e,t+1,i)}).catch(i)},o.decryptAvcSamples=function(r,e,t,i){if(r instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,t=0){if(e>=r.length){i();return}for(var s=r[e].units;!(t>=s.length);t++){var l=s[t];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(r,e,t,i,l),!this.decrypter.isSync()))return}}},a})(),Bo=(function(){function a(){this.VideoSample=null}var o=a.prototype;return o.createVideoSample=function(r,e,t){return{key:r,frame:!1,pts:e,dts:t,units:[],length:0}},o.getLastNalUnit=function(r){var e,t=this.VideoSample,i;if((!t||t.units.length===0)&&(t=r[r.length-1]),(e=t)!=null&&e.units){var s=t.units;i=s[s.length-1]}return i},o.pushAccessUnit=function(r,e){if(r.units.length&&r.frame){if(r.pts===void 0){var t=e.samples,i=t.length;if(i){var s=t[i-1];r.pts=s.pts,r.dts=s.dts}else{e.dropped++;return}}e.samples.push(r)}},o.parseNALu=function(r,e,t){var i=e.byteLength,s=r.naluState||0,l=s,u=[],f=0,d,h,c,v=-1,g=0;for(s===-1&&(v=0,g=this.getNALuType(e,0),s=0,f=1);f<i;){if(d=e[f++],!s){s=d?0:1;continue}if(s===1){s=d?0:2;continue}if(!d)s=3;else if(d===1){if(h=f-s-1,v>=0){var m={data:e.subarray(v,h),type:g};u.push(m)}else{var p=this.getLastNalUnit(r.samples);p&&(l&&f<=4-l&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-l)),h>0&&(p.data=Kt(p.data,e.subarray(0,h)),p.state=0))}f<i?(c=this.getNALuType(e,f),v=f,g=c,s=0):s=-1}else s=0}if(v>=0&&s>=0){var E={data:e.subarray(v,i),type:g,state:s};u.push(E)}if(u.length===0){var S=this.getLastNalUnit(r.samples);S&&(S.data=Kt(S.data,e))}return r.naluState=s,u},a})(),Ui=(function(){function a(n){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=n,this.bytesAvailable=n.byteLength,this.word=0,this.bitsAvailable=0}var o=a.prototype;return o.loadWord=function(){var r=this.data,e=this.bytesAvailable,t=r.byteLength-e,i=new Uint8Array(4),s=Math.min(4,e);if(s===0)throw new Error("no bytes available");i.set(r.subarray(t,t+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s},o.skipBits=function(r){var e;r=Math.min(r,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>r?(this.word<<=r,this.bitsAvailable-=r):(r-=this.bitsAvailable,e=r>>3,r-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=r,this.bitsAvailable-=r)},o.readBits=function(r){var e=Math.min(this.bitsAvailable,r),t=this.word>>>32-e;if(r>32&&Le.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=r-e,e>0&&this.bitsAvailable?t<<e|this.readBits(e):t},o.skipLZ=function(){var r;for(r=0;r<this.bitsAvailable;++r)if((this.word&2147483648>>>r)!==0)return this.word<<=r,this.bitsAvailable-=r,r;return this.loadWord(),r+this.skipLZ()},o.skipUEG=function(){this.skipBits(1+this.skipLZ())},o.skipEG=function(){this.skipBits(1+this.skipLZ())},o.readUEG=function(){var r=this.skipLZ();return this.readBits(r+1)-1},o.readEG=function(){var r=this.readUEG();return 1&r?1+r>>>1:-1*(r>>>1)},o.readBoolean=function(){return this.readBits(1)===1},o.readUByte=function(){return this.readBits(8)},o.readUShort=function(){return this.readBits(16)},o.readUInt=function(){return this.readBits(32)},a})(),Mf=(function(a){function o(){return a.apply(this,arguments)||this}se(o,a);var n=o.prototype;return n.parsePES=function(e,t,i,s){var l=this,u=this.parseNALu(e,i.data,s),f=this.VideoSample,d,h=!1;i.data=null,f&&u.length&&!e.audFound&&(this.pushAccessUnit(f,e),f=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(function(c){var v,g;switch(c.type){case 1:{var m=!1;d=!0;var p=c.data;if(h&&p.length>4){var E=l.readSliceType(p);(E===2||E===4||E===7||E===9)&&(m=!0)}if(m){var S;(S=f)!=null&&S.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null)}f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.frame=!0,f.key=m;break}case 5:d=!0,(v=f)!=null&&v.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null),f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0,f.frame=!0;break;case 6:{d=!0,Gr(c.data,1,i.pts,t.samples);break}case 7:{var T,A;d=!0,h=!0;var x=c.data,b=l.readSPS(x);if(!e.sps||e.width!==b.width||e.height!==b.height||((T=e.pixelRatio)==null?void 0:T[0])!==b.pixelRatio[0]||((A=e.pixelRatio)==null?void 0:A[1])!==b.pixelRatio[1]){e.width=b.width,e.height=b.height,e.pixelRatio=b.pixelRatio,e.sps=[x];for(var D=x.subarray(1,4),k="avc1.",R=0;R<3;R++){var L=D[R].toString(16);L.length<2&&(L="0"+L),k+=L}e.codec=k}break}case 8:d=!0,e.pps=[c.data];break;case 9:d=!0,e.audFound=!0,(g=f)!=null&&g.frame&&(l.pushAccessUnit(f,e),f=null),f||(f=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;case 12:d=!0;break;default:d=!1;break}if(f&&d){var I=f.units;I.push(c)}}),s&&f&&(this.pushAccessUnit(f,e),this.VideoSample=null)},n.getNALuType=function(e,t){return e[t]&31},n.readSliceType=function(e){var t=new Ui(e);return t.readUByte(),t.readUEG(),t.readUEG()},n.skipScalingList=function(e,t){for(var i=8,s=8,l,u=0;u<e;u++)s!==0&&(l=t.readEG(),s=(i+l+256)%256),i=s===0?i:s},n.readSPS=function(e){var t=new Ui(e),i=0,s=0,l=0,u=0,f,d,h,c=t.readUByte.bind(t),v=t.readBits.bind(t),g=t.readUEG.bind(t),m=t.readBoolean.bind(t),p=t.skipBits.bind(t),E=t.skipEG.bind(t),S=t.skipUEG.bind(t),T=this.skipScalingList.bind(this);c();var A=c();if(v(5),p(3),c(),S(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){var x=g();if(x===3&&p(1),S(),S(),p(1),m())for(d=x!==3?8:12,h=0;h<d;h++)m()&&(h<6?T(16,t):T(64,t))}S();var b=g();if(b===0)g();else if(b===1)for(p(1),E(),E(),f=g(),h=0;h<f;h++)E();S(),p(1);var D=g(),k=g(),R=v(1);R===0&&p(1),p(1),m()&&(i=g(),s=g(),l=g(),u=g());var L=[1,1];if(m()&&m()){var I=c();switch(I){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:{L=[c()<<8|c(),c()<<8|c()];break}}}return{width:Math.ceil((D+1)*16-i*2-s*2),height:(2-R)*(k+1)*16-(R?2:4)*(l+u),pixelRatio:L}},o})(Bo),Of=(function(a){function o(){for(var r,e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r=a.call.apply(a,[this].concat(t))||this,r.initVPS=null,r}se(o,a);var n=o.prototype;return n.parsePES=function(e,t,i,s){var l=this,u=this.parseNALu(e,i.data,s),f=this.VideoSample,d,h=!1;i.data=null,f&&u.length&&!e.audFound&&(this.pushAccessUnit(f,e),f=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(function(c){var v,g;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:f||(f=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts)),f.frame=!0,d=!0;break;case 16:case 17:case 18:case 21:if(d=!0,h){var m;(m=f)!=null&&m.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null)}f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0,f.frame=!0;break;case 19:case 20:d=!0,(v=f)!=null&&v.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null),f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0,f.frame=!0;break;case 39:d=!0,Gr(c.data,2,i.pts,t.samples);break;case 32:d=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ae(e.params,l.readVPS(c.data)),l.initVPS=c.data),e.vps=[c.data];break;case 33:if(d=!0,h=!0,e.vps!==void 0&&e.vps[0]!==l.initVPS&&e.sps!==void 0&&!l.matchSPS(e.sps[0],c.data)&&(l.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){var p=l.readSPS(c.data);e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.codec=p.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(var E in p.params)e.params[E]=p.params[E]}l.pushParameterSet(e.sps,c.data,e.vps),f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0;break;case 34:if(d=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];var S=l.readPPS(c.data);for(var T in S)e.params[T]=S[T]}l.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:d=!0,e.audFound=!0,(g=f)!=null&&g.frame&&(l.pushAccessUnit(f,e),f=null),f||(f=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;default:d=!1;break}if(f&&d){var A=f.units;A.push(c)}}),s&&f&&(this.pushAccessUnit(f,e),this.VideoSample=null)},n.pushParameterSet=function(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)},n.getNALuType=function(e,t){return(e[t]&126)>>>1},n.ebsp2rbsp=function(e){for(var t=new Uint8Array(e.byteLength),i=0,s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[i]=e[s],i++);return new Uint8Array(t.buffer,0,i)},n.pushAccessUnit=function(e,t){a.prototype.pushAccessUnit.call(this,e,t),this.initVPS&&(this.initVPS=null)},n.readVPS=function(e){var t=new Ui(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);var i=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:s}},n.readSPS=function(e){var t=new Ui(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);var i=t.readBits(3);t.readBoolean();for(var s=t.readBits(2),l=t.readBoolean(),u=t.readBits(5),f=t.readUByte(),d=t.readUByte(),h=t.readUByte(),c=t.readUByte(),v=t.readUByte(),g=t.readUByte(),m=t.readUByte(),p=t.readUByte(),E=t.readUByte(),S=t.readUByte(),T=t.readUByte(),A=[],x=[],b=0;b<i;b++)A.push(t.readBoolean()),x.push(t.readBoolean());if(i>0)for(var D=i;D<8;D++)t.readBits(2);for(var k=0;k<i;k++)A[k]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),x[k]&&t.readUByte();t.readUEG();var R=t.readUEG();R==3&&t.skipBits(1);var L=t.readUEG(),I=t.readUEG(),P=t.readBoolean(),U=0,w=0,O=0,K=0;P&&(U+=t.readUEG(),w+=t.readUEG(),O+=t.readUEG(),K+=t.readUEG());for(var z=t.readUEG(),X=t.readUEG(),Q=t.readUEG(),ge=t.readBoolean(),$=ge?0:i;$<=i;$++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();var J=t.readBoolean();if(J){var re=t.readBoolean();if(re)for(var fe=0;fe<4;fe++)for(var _e=0;_e<(fe===3?2:6);_e++){var De=t.readBoolean();if(!De)t.readUEG();else{var Ye=Math.min(64,1<<4+(fe<<1));fe>1&&t.readEG();for(var qe=0;qe<Ye;qe++)t.readEG()}}}t.readBoolean(),t.readBoolean();var Oe=t.readBoolean();Oe&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());for(var It=t.readUEG(),Be=0,Ae=0;Ae<It;Ae++){var nt=!1;if(Ae!==0&&(nt=t.readBoolean()),nt){Ae===It&&t.readUEG(),t.readBoolean(),t.readUEG();for(var bt=0,ut=0;ut<=Be;ut++){var tt=t.readBoolean(),Pt=!1;tt||(Pt=t.readBoolean()),(tt||Pt)&&bt++}Be=bt}else{var Ct=t.readUEG(),wt=t.readUEG();Be=Ct+wt;for(var ft=0;ft<Ct;ft++)t.readUEG(),t.readBoolean();for(var vt=0;vt<wt;vt++)t.readUEG(),t.readBoolean()}}var Tt=t.readBoolean();if(Tt)for(var zr=t.readUEG(),$t=0;$t<zr;$t++){for(var Qr=0;Qr<Q+4;Qr++)t.readBits(1);t.readBits(1)}var Yi=0,Wi=1,$r=1,Or=!0,qi=1,Jr=0;t.readBoolean(),t.readBoolean();var Fn=!1,ji=t.readBoolean();if(ji){var us=t.readBoolean();if(us){var Fr=t.readUByte(),Xi=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Jt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Fr>0&&Fr<16?(Wi=Xi[Fr-1],$r=Jt[Fr-1]):Fr===255&&(Wi=t.readBits(16),$r=t.readBits(16))}var Nn=t.readBoolean();Nn&&t.readBoolean();var Un=t.readBoolean();if(Un){t.readBits(3),t.readBoolean();var fs=t.readBoolean();fs&&(t.readUByte(),t.readUByte(),t.readUByte())}var ds=t.readBoolean();ds&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Fn=t.readBoolean(),Fn&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG());var hs=t.readBoolean();if(hs){qi=t.readBits(32),Jr=t.readBits(32);var cs=t.readBoolean();cs&&t.readUEG();var vs=t.readBoolean();if(vs){var Bn=t.readBoolean(),Zr=t.readBoolean(),Nr=!1;(Bn||Zr)&&(Nr=t.readBoolean(),Nr&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Nr&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(var Gn=0;Gn<=i;Gn++){Or=t.readBoolean();var gs=Or||t.readBoolean(),Xl=!1;gs?t.readEG():Xl=t.readBoolean();var zl=Xl?1:t.readUEG()+1;if(Bn)for(var Ql=0;Ql<zl;Ql++)t.readUEG(),t.readUEG(),Nr&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Zr)for(var $l=0;$l<zl;$l++)t.readUEG(),t.readUEG(),Nr&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}var Lc=t.readBoolean();Lc&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),Yi=t.readUEG())}var Jl=L,Zl=I;if(P){var Kn=1,ms=1;R===1?Kn=ms=2:R==2&&(Kn=2),Jl=L-Kn*w-Kn*U,Zl=I-ms*K-ms*O}for(var Ic=s?["A","B","C"][s]:"",bc=f<<24|d<<16|h<<8|c,ps=0,Vn=0;Vn<32;Vn++)ps=(ps|(bc>>Vn&1)<<31-Vn)>>>0;var ys=ps.toString(16);u===1&&ys==="2"&&(ys="6");var Rc=l?"H":"L";return{codecString:"hvc1."+Ic+u+"."+ys+"."+Rc+T+".B0",params:{general_tier_flag:l,general_profile_idc:u,general_profile_space:s,general_profile_compatibility_flags:[f,d,h,c],general_constraint_indicator_flags:[v,g,m,p,E,S],general_level_idc:T,bit_depth:z+8,bit_depth_luma_minus8:z,bit_depth_chroma_minus8:X,min_spatial_segmentation_idc:Yi,chroma_format_idc:R,frame_rate:{fixed:Or,fps:Jr/qi}},width:Jl,height:Zl,pixelRatio:[Wi,$r]}},n.readPPS=function(e){var t=new Ui(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);var i=t.readBoolean();i&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);var s=t.readBoolean(),l=t.readBoolean(),u=1;return l&&s?u=0:l?u=3:s&&(u=2),{parallelismType:u}},n.matchSPS=function(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)},o})(Bo),ct=188,Ff=(function(){function a(n,r,e,t){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=n,this.config=r,this.typeSupported=e,this.logger=t,this.videoParser=null}a.probe=function(r,e){var t=a.syncOffset(r);return t>0&&e.warn("MPEG2-TS detected but first sync word found @ offset "+t),t!==-1},a.syncOffset=function(r){for(var e=r.length,t=Math.min(ct*5,e-ct)+1,i=0;i<t;){for(var s=!1,l=-1,u=0,f=i;f<e;f+=ct)if(r[f]===71&&(e-f===ct||r[f+ct]===71)){if(u++,l===-1&&(l=f,l!==0&&(t=Math.min(l+ct*99,r.length-ct)+1)),s||(s=Da(r,f)===0),s&&u>1&&(l===0&&u>2||f+ct>t))return l}else{if(u)return-1;break}i++}return-1},a.createTrack=function(r,e){return{container:r==="video"||r==="audio"?"video/mp2t":void 0,type:r,id:jt[r],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:r==="audio"?e:void 0}};var o=a.prototype;return o.resetInitSegment=function(r,e,t,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=a.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=a.createTrack("audio",i),this._id3Track=a.createTrack("id3"),this._txtTrack=a.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=t},o.resetTimeStamp=function(){},o.resetContiguity=function(){var r=this._audioTrack,e=this._videoTrack,t=this._id3Track;r&&(r.pesData=null),e&&(e.pesData=null),t&&(t.pesData=null),this.aacOverFlow=null,this.remainderData=null},o.demux=function(r,e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!1),t||(this.sampleAes=null);var s,l=this._videoTrack,u=this._audioTrack,f=this._id3Track,d=this._txtTrack,h=l.pid,c=l.pesData,v=u.pid,g=f.pid,m=u.pesData,p=f.pesData,E=null,S=this.pmtParsed,T=this._pmtId,A=r.length;if(this.remainderData&&(r=Kt(this.remainderData,r),A=r.length,this.remainderData=null),A<ct&&!i)return this.remainderData=r,{audioTrack:u,videoTrack:l,id3Track:f,textTrack:d};var x=Math.max(0,a.syncOffset(r));A-=(A-x)%ct,A<r.byteLength&&!i&&(this.remainderData=new Uint8Array(r.buffer,A,r.buffer.byteLength-A));for(var b=0,D=x;D<A;D+=ct)if(r[D]===71){var k=!!(r[D+1]&64),R=Da(r,D),L=(r[D+3]&48)>>4,I=void 0;if(L>1){if(I=D+5+r[D+4],I===D+ct)continue}else I=D+4;switch(R){case h:k&&(c&&(s=vi(c,this.logger))&&(this.readyVideoParser(l.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(l,d,s,!1)),c={data:[],size:0}),c&&(c.data.push(r.subarray(I,D+ct)),c.size+=D+ct-I);break;case v:if(k){if(m&&(s=vi(m,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,s);break;case"mp3":this.parseMPEGPES(u,s);break;case"ac3":this.parseAC3PES(u,s);break}m={data:[],size:0}}m&&(m.data.push(r.subarray(I,D+ct)),m.size+=D+ct-I);break;case g:k&&(p&&(s=vi(p,this.logger))&&this.parseID3PES(f,s),p={data:[],size:0}),p&&(p.data.push(r.subarray(I,D+ct)),p.size+=D+ct-I);break;case 0:k&&(I+=r[I]+1),T=this._pmtId=Nf(r,I);break;case T:{k&&(I+=r[I]+1);var P=Uf(r,I,this.typeSupported,t,this.observer,this.logger);h=P.videoPid,h>0&&(l.pid=h,l.segmentCodec=P.segmentVideoCodec),v=P.audioPid,v>0&&(u.pid=v,u.segmentCodec=P.segmentAudioCodec),g=P.id3Pid,g>0&&(f.pid=g),E!==null&&!S&&(this.logger.warn("MPEG-TS PMT found at "+D+" after unknown PID '"+E+"'. Backtracking to sync byte @"+x+" to parse all TS packets."),E=null,D=x-188),S=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=R;break}}else b++;b>0&&ka(this.observer,new Error("Found "+b+" TS packet/s that do not start with 0x47"),void 0,this.logger),l.pesData=c,u.pesData=m,f.pesData=p;var U={audioTrack:u,videoTrack:l,id3Track:f,textTrack:d};return i&&this.extractRemainingSamples(U),U},o.flush=function(){var r=this.remainderData;this.remainderData=null;var e;return r?e=this.demux(r,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},o.extractRemainingSamples=function(r){var e=r.audioTrack,t=r.videoTrack,i=r.id3Track,s=r.textTrack,l=t.pesData,u=e.pesData,f=i.pesData,d;if(l&&(d=vi(l,this.logger))?(this.readyVideoParser(t.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(t,s,d,!0),t.pesData=null)):t.pesData=l,u&&(d=vi(u,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,d);break;case"mp3":this.parseMPEGPES(e,d);break;case"ac3":this.parseAC3PES(e,d);break}e.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=u;f&&(d=vi(f,this.logger))?(this.parseID3PES(i,d),i.pesData=null):i.pesData=f},o.demuxSampleAes=function(r,e,t){var i=this.demux(r,t,!0,!this.config.progressive),s=this.sampleAes=new wf(this.observer,this.config,e);return this.decrypt(i,s)},o.readyVideoParser=function(r){this.videoParser===null&&(r==="avc"?this.videoParser=new Mf:r==="hevc"&&(this.videoParser=new Of))},o.decrypt=function(r,e){return new Promise(function(t){var i=r.audioTrack,s=r.videoTrack;i.samples&&i.segmentCodec==="aac"?e.decryptAacSamples(i.samples,0,function(){s.samples?e.decryptAvcSamples(s.samples,0,0,function(){t(r)}):t(r)}):s.samples&&e.decryptAvcSamples(s.samples,0,0,function(){t(r)})})},o.destroy=function(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0},o.parseAACPES=function(r,e){var t=0,i=this.aacOverFlow,s=e.data;if(i){this.aacOverFlow=null;var l=i.missing,u=i.sample.unit.byteLength;if(l===-1)s=Kt(i.sample.unit,s);else{var f=u-l;i.sample.unit.set(s.subarray(0,l),f),r.samples.push(i.sample),t=i.missing}}var d,h;for(d=t,h=s.length;d<h-1&&!yn(s,d);d++);if(d!==t){var c,v=d<h-1;if(v?c="AAC PES did not start with ADTS header,offset:"+d:c="No ADTS header found in AAC PES",ka(this.observer,new Error(c),v,this.logger),!v)return}Ro(r,this.observer,s,d,this.audioCodec);var g;if(e.pts!==void 0)g=e.pts;else if(i){var m=_o(r.samplerate);g=i.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var p=0,E;d<h;)if(E=Do(r,s,d,g,p),d+=E.length,E.missing){this.aacOverFlow=E;break}else for(p++;d<h-1&&!yn(s,d);d++);},o.parseMPEGPES=function(r,e){var t=e.data,i=t.length,s=0,l=0,u=e.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<i;)if(Mo(t,l)){var f=Co(r,t,l,u,s);if(f)l+=f.length,s++;else break}else l++},o.parseAC3PES=function(r,e){{var t=e.data,i=e.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}for(var s=t.length,l=0,u=0,f;u<s&&(f=No(r,t,u,i,l++))>0;)u+=f}},o.parseID3PES=function(r,e){if(e.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var t=ae({},e,{type:this._videoTrack?Qt.emsg:Qt.audioId3,duration:Number.POSITIVE_INFINITY});r.samples.push(t)},a})();function Da(a,o){return((a[o+1]&31)<<8)+a[o+2]}function Nf(a,o){return(a[o+10]&31)<<8|a[o+11]}function Uf(a,o,n,r,e,t){var i={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},s=(a[o+1]&15)<<8|a[o+2],l=o+3+s-4,u=(a[o+10]&15)<<8|a[o+11];for(o+=12+u;o<l;){var f=Da(a,o),d=(a[o+3]&15)<<8|a[o+4];switch(a[o]){case 207:if(!r){Pa("ADTS AAC",t);break}case 15:i.audioPid===-1&&(i.audioPid=f);break;case 21:i.id3Pid===-1&&(i.id3Pid=f);break;case 219:if(!r){Pa("H.264",t);break}case 27:i.videoPid===-1&&(i.videoPid=f);break;case 3:case 4:!n.mpeg&&!n.mp3?t.log("MPEG audio found, not supported in this browser"):i.audioPid===-1&&(i.audioPid=f,i.segmentAudioCodec="mp3");break;case 193:if(!r){Pa("AC-3",t);break}case 129:n.ac3?i.audioPid===-1&&(i.audioPid=f,i.segmentAudioCodec="ac3"):t.log("AC-3 audio found, not supported in this browser");break;case 6:if(i.audioPid===-1&&d>0)for(var h=o+5,c=d;c>2;){var v=a[h];switch(v){case 106:n.ac3!==!0?t.log("AC-3 audio found, not supported in this browser for now"):(i.audioPid=f,i.segmentAudioCodec="ac3");break}var g=a[h+1]+2;h+=g,c-=g}break;case 194:case 135:return ka(e,new Error("Unsupported EC-3 in M2TS found"),void 0,t),i;case 36:i.videoPid===-1&&(i.videoPid=f,i.segmentVideoCodec="hevc",t.log("HEVC in M2TS found"));break}o+=d+5}return i}function ka(a,o,n,r){r.warn("parsing error: "+o.message),a.emit(y.ERROR,y.ERROR,{type:W.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:o,reason:o.message})}function Pa(a,o){o.log(a+" with AES-128-CBC encryption found in unencrypted stream")}function vi(a,o){var n=0,r,e,t,i,s,l=a.data;if(!a||a.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Kt(l[0],l[1]),l.splice(1,1);r=l[0];var u=(r[0]<<16)+(r[1]<<8)+r[2];if(u===1){if(e=(r[4]<<8)+r[5],e&&e>a.size-6)return null;var f=r[7];f&192&&(i=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,f&64?(s=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,i-s>60*9e4&&(o.warn(Math.round((i-s)/9e4)+"s delta between PTS and DTS, align them"),i=s)):s=i),t=r[8];var d=t+9;if(a.size<=d)return null;a.size-=d;for(var h=new Uint8Array(a.size),c=0,v=l.length;c<v;c++){r=l[c];var g=r.byteLength;if(d)if(d>g){d-=g;continue}else r=r.subarray(d),g-=d,d=0;h.set(r,n),n+=g}return e&&(e-=t+3),{data:h,pts:i,dts:s,len:e}}return null}var Bf=(function(){function a(){}return a.getSilentFrame=function(n,r){switch(n){case"mp4a.40.2":if(r===1)return new Uint8Array([0,200,0,128,35,128]);if(r===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(r===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(r===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(r===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(r===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(r===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},a})(),wr=Math.pow(2,32)-1,Et=(function(){function a(){}return a.init=function(){a.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var n;for(n in a.types)a.types.hasOwnProperty(n)&&(a.types[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:r,audio:e};var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=i,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,s,u,s,l),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,t))},a.box=function(n){for(var r=8,e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];for(var s=t.length,l=s;s--;)r+=t[s].byteLength;var u=new Uint8Array(r);for(u[0]=r>>24&255,u[1]=r>>16&255,u[2]=r>>8&255,u[3]=r&255,u.set(n,4),s=0,r=8;s<l;s++)u.set(t[s],r),r+=t[s].byteLength;return u},a.hdlr=function(n){return a.box(a.types.hdlr,a.HDLR_TYPES[n])},a.mdat=function(n){return a.box(a.types.mdat,n)},a.mdhd=function(n,r){r*=n;var e=Math.floor(r/(wr+1)),t=Math.floor(r%(wr+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255,t>>24,t>>16&255,t>>8&255,t&255,85,196,0,0]))},a.mdia=function(n){return a.box(a.types.mdia,a.mdhd(n.timescale||0,n.duration||0),a.hdlr(n.type),a.minf(n))},a.mfhd=function(n){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255]))},a.minf=function(n){return n.type==="audio"?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(n)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(n))},a.moof=function(n,r,e){return a.box(a.types.moof,a.mfhd(n),a.traf(e,r))},a.moov=function(n){for(var r=n.length,e=[];r--;)e[r]=a.trak(n[r]);return a.box.apply(null,[a.types.moov,a.mvhd(n[0].timescale||0,n[0].duration||0)].concat(e).concat(a.mvex(n)))},a.mvex=function(n){for(var r=n.length,e=[];r--;)e[r]=a.trex(n[r]);return a.box.apply(null,[a.types.mvex].concat(e))},a.mvhd=function(n,r){r*=n;var e=Math.floor(r/(wr+1)),t=Math.floor(r%(wr+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255,t>>24,t>>16&255,t>>8&255,t&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,i)},a.sdtp=function(n){var r=n.samples||[],e=new Uint8Array(4+r.length),t,i;for(t=0;t<r.length;t++)i=r[t].flags,e[t+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return a.box(a.types.sdtp,e)},a.stbl=function(n){return a.box(a.types.stbl,a.stsd(n),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(n){var r=[],e=[],t,i,s;for(t=0;t<n.sps.length;t++)i=n.sps[t],s=i.byteLength,r.push(s>>>8&255),r.push(s&255),r=r.concat(Array.prototype.slice.call(i));for(t=0;t<n.pps.length;t++)i=n.pps[t],s=i.byteLength,e.push(s>>>8&255),e.push(s&255),e=e.concat(Array.prototype.slice.call(i));var l=a.box(a.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|n.sps.length].concat(r).concat([n.pps.length]).concat(e))),u=n.width,f=n.height,d=n.pixelRatio[0],h=n.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,h>>24,h>>16&255,h>>8&255,h&255])))},a.esds=function(n){var r=n.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2].concat(r,[6,1,2]))},a.audioStsd=function(n){var r=n.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount||0,0,16,0,0,0,0,r>>8&255,r&255,0,0])},a.mp4a=function(n){return a.box(a.types.mp4a,a.audioStsd(n),a.box(a.types.esds,a.esds(n)))},a.mp3=function(n){return a.box(a.types[".mp3"],a.audioStsd(n))},a.ac3=function(n){return a.box(a.types["ac-3"],a.audioStsd(n),a.box(a.types.dac3,n.config))},a.stsd=function(n){var r=n.segmentCodec;if(n.type==="audio"){if(r==="aac")return a.box(a.types.stsd,a.STSD,a.mp4a(n));if(r==="ac3"&&n.config)return a.box(a.types.stsd,a.STSD,a.ac3(n));if(r==="mp3"&&n.codec==="mp3")return a.box(a.types.stsd,a.STSD,a.mp3(n))}else if(n.pps&&n.sps){if(r==="avc")return a.box(a.types.stsd,a.STSD,a.avc1(n));if(r==="hevc"&&n.vps)return a.box(a.types.stsd,a.STSD,a.hvc1(n))}else throw new Error("video track missing pps or sps");throw new Error("unsupported "+n.type+" segment codec ("+r+"/"+n.codec+")")},a.tkhd=function(n){var r=n.id,e=(n.duration||0)*(n.timescale||0),t=n.width||0,i=n.height||0,s=Math.floor(e/(wr+1)),l=Math.floor(e%(wr+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,t>>8&255,t&255,0,0,i>>8&255,i&255,0,0]))},a.traf=function(n,r){var e=a.sdtp(n),t=n.id,i=Math.floor(r/(wr+1)),s=Math.floor(r%(wr+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255])),a.trun(n,e.length+16+20+8+16+8+8),e)},a.trak=function(n){return n.duration=n.duration||4294967295,a.box(a.types.trak,a.tkhd(n),a.mdia(n))},a.trex=function(n){var r=n.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(n,r){var e=n.samples||[],t=e.length,i=12+16*t,s=new Uint8Array(i),l,u,f,d,h,c;for(r+=8+i,s.set([n.type==="video"?1:0,0,15,1,t>>>24&255,t>>>16&255,t>>>8&255,t&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0),l=0;l<t;l++)u=e[l],f=u.duration,d=u.size,h=u.flags,c=u.cts,s.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,c>>>24&255,c>>>16&255,c>>>8&255,c&255],12+16*l);return a.box(a.types.trun,s)},a.initSegment=function(n){a.types||a.init();var r=a.moov(n),e=Kt(a.FTYP,r);return e},a.hvc1=function(n){for(var r=n.params,e=[n.vps,n.sps,n.pps],t=4,i=new Uint8Array([1,r.general_profile_space<<6|(r.general_tier_flag?32:0)|r.general_profile_idc,r.general_profile_compatibility_flags[0],r.general_profile_compatibility_flags[1],r.general_profile_compatibility_flags[2],r.general_profile_compatibility_flags[3],r.general_constraint_indicator_flags[0],r.general_constraint_indicator_flags[1],r.general_constraint_indicator_flags[2],r.general_constraint_indicator_flags[3],r.general_constraint_indicator_flags[4],r.general_constraint_indicator_flags[5],r.general_level_idc,240|r.min_spatial_segmentation_idc>>8,255&r.min_spatial_segmentation_idc,252|r.parallelismType,252|r.chroma_format_idc,248|r.bit_depth_luma_minus8,248|r.bit_depth_chroma_minus8,0,parseInt(r.frame_rate.fps),t-1|r.temporal_id_nested<<2|r.num_temporal_layers<<3|(r.frame_rate.fixed?64:0),e.length]),s=i.length,l=0;l<e.length;l+=1){s+=3;for(var u=0;u<e[l].length;u+=1)s+=2+e[l][u].length}var f=new Uint8Array(s);f.set(i,0),s=i.length;for(var d=e.length-1,h=0;h<e.length;h+=1){f.set(new Uint8Array([32+h|(h===d?128:0),0,e[h].length]),s),s+=3;for(var c=0;c<e[h].length;c+=1)f.set(new Uint8Array([e[h][c].length>>8,e[h][c].length&255]),s),s+=2,f.set(e[h][c],s),s+=e[h][c].length}var v=a.box(a.types.hvcC,f),g=n.width,m=n.height,p=n.pixelRatio[0],E=n.pixelRatio[1];return a.box(a.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),v,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,E>>24,E>>16&255,E>>8&255,E&255])))},a})();Et.types=void 0,Et.HDLR_TYPES=void 0,Et.STTS=void 0,Et.STSC=void 0,Et.STCO=void 0,Et.STSZ=void 0,Et.VMHD=void 0,Et.SMHD=void 0,Et.STSD=void 0,Et.FTYP=void 0,Et.DINF=void 0;var Go=9e4;function Ca(a,o,n,r){n===void 0&&(n=1),r===void 0&&(r=!1);var e=a*o*n;return r?Math.round(e):e}function Gf(a,o,n,r){return n===void 0&&(n=1),r===void 0&&(r=!1),Ca(a,o,1/n,r)}function Bi(a,o){return Ca(a,1e3,1/Go,o)}function Kf(a,o){return o===void 0&&(o=1),Ca(a,Go,1/o)}var Vf=10*1e3,Hf=1024,Yf=1152,Wf=1536,gi=null,wa=null;function Ko(a,o,n,r){return{duration:o,size:n,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}var Sn=(function(a){function o(r,e,t,i){var s;if(s=a.call(this,"mp4-remuxer",i)||this,s.observer=void 0,s.config=void 0,s.typeSupported=void 0,s.ISGenerated=!1,s._initPTS=null,s._initDTS=null,s.nextVideoTs=null,s.nextAudioTs=null,s.videoSampleDuration=null,s.isAudioContiguous=!1,s.isVideoContiguous=!1,s.videoTrackConfig=void 0,s.observer=r,s.config=e,s.typeSupported=t,s.ISGenerated=!1,gi===null){var l=navigator.userAgent||"",u=l.match(/Chrome\/(\d+)/i);gi=u?parseInt(u[1]):0}if(wa===null){var f=navigator.userAgent.match(/Safari\/(\d+)/i);wa=f?parseInt(f[1]):0}return s}se(o,a);var n=o.prototype;return n.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},n.resetTimeStamp=function(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e},n.resetNextTimestamp=function(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},n.resetInitSegment=function(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},n.getVideoStartPts=function(e){var t=!1,i=e[0].pts,s=e.reduce(function(l,u){var f=u.pts,d=f-l;return d<-4294967296&&(t=!0,f=tr(f,i),d=f-l),d>0?l:f},i);return t&&this.debug("PTS rollover detected"),s},n.remux=function(e,t,i,s,l,u,f,d){var h,c,v,g,m,p,E=l,S=l,T=e.pid>-1,A=t.pid>-1,x=t.samples.length,b=e.samples.length>0,D=f&&x>0||x>1,k=(!T||b)&&(!A||D)||this.ISGenerated||f;if(k){if(this.ISGenerated){var R,L,I,P,U=this.videoTrackConfig;(U&&(t.width!==U.width||t.height!==U.height||((R=t.pixelRatio)==null?void 0:R[0])!==((L=U.pixelRatio)==null?void 0:L[0])||((I=t.pixelRatio)==null?void 0:I[1])!==((P=U.pixelRatio)==null?void 0:P[1]))||!U&&D||this.nextAudioTs===null&&b)&&this.resetInitSegment()}this.ISGenerated||(v=this.generateIS(e,t,l,u));var w=this.isVideoContiguous,O=-1,K;if(D&&(O=qf(t.samples),!w&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,O>0){this.warn("Dropped "+O+" out of "+x+" video samples due to a missing keyframe");var z=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(O),t.dropped+=O,S+=(t.samples[0].pts-z)/t.inputTimeScale,K=S}else O===-1&&(this.warn("No keyframe found out of "+x+" video samples"),p=!1);if(this.ISGenerated){if(b&&D){var X=this.getVideoStartPts(t.samples),Q=tr(e.samples[0].pts,X)-X,ge=Q/t.inputTimeScale;E+=Math.max(0,ge),S+=Math.max(0,-ge)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),v=this.generateIS(e,t,l,u)),c=this.remuxAudio(e,E,this.isAudioContiguous,u,A||D||d===F.AUDIO?S:void 0),D){var $=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),v=this.generateIS(e,t,l,u)),h=this.remuxVideo(t,S,w,$)}}else D&&(h=this.remuxVideo(t,S,w,0));h&&(h.firstKeyFrame=O,h.independent=O!==-1,h.firstKeyFramePTS=K)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(m=Vo(i,l,this._initPTS,this._initDTS)),s.samples.length&&(g=Ho(s,l,this._initPTS))),{audio:c,video:h,initSegment:v,independent:p,text:g,id3:m}},n.generateIS=function(e,t,i,s){var l=e.samples,u=t.samples,f=this.typeSupported,d={},h=this._initPTS,c=!h||s,v="audio/mp4",g,m,p,E=-1;if(c&&(g=m=1/0),e.config&&l.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":f.mpeg?(v="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:v,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&f.mpeg?new Uint8Array(0):Et.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(E=e.id,p=e.inputTimeScale,!h||p!==h.timescale?g=m=l[0].pts-Math.round(p*i):c=!1)}if(t.sps&&t.pps&&u.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Et.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(E=t.id,p=t.inputTimeScale,!h||p!==h.timescale){var S=this.getVideoStartPts(u),T=Math.round(p*i);m=Math.min(m,tr(u[0].dts,S)-T),g=Math.min(g,S-T)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,c?(h&&this.warn("Timestamps at playlist time: "+(s?"":"~")+i+" "+g/p+" != initPTS: "+h.baseTime/h.timescale+" ("+h.baseTime+"/"+h.timescale+") trackId: "+h.trackId),this.log("Found initPTS at playlist time: "+i+" offset: "+g/p+" ("+g+"/"+p+") trackId: "+E),this._initPTS={baseTime:g,timescale:p,trackId:E},this._initDTS={baseTime:m,timescale:p,trackId:E}):g=p=void 0,{tracks:d,initPTS:g,timescale:p,trackId:E}},n.remuxVideo=function(e,t,i,s){var l=e.inputTimeScale,u=e.samples,f=[],d=u.length,h=this._initPTS,c=h.baseTime*l/h.timescale,v=this.nextVideoTs,g=8,m=this.videoSampleDuration,p,E,S=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,A=!1;if(!i||v===null){var x=c+t*l,b=u[0].pts-tr(u[0].dts,u[0].pts);gi&&v!==null&&Math.abs(x-b-(v+c))<15e3?i=!0:v=x-b-c}for(var D=v+c,k=0;k<d;k++){var R=u[k];R.pts=tr(R.pts,D),R.dts=tr(R.dts,D),R.dts<u[k>0?k-1:k].dts&&(A=!0)}A&&u.sort(function(Zr,Nr){var Gn=Zr.dts-Nr.dts,gs=Zr.pts-Nr.pts;return Gn||gs}),p=u[0].dts,E=u[u.length-1].dts;var L=E-p,I=L?Math.round(L/(d-1)):m||e.inputTimeScale/30;if(i){var P=p-D,U=P>I,w=P<-1;if((U||w)&&(U?this.warn((e.segmentCodec||"").toUpperCase()+": "+Bi(P,!0)+" ms ("+P+"dts) hole between fragments detected at "+t.toFixed(3)):this.warn((e.segmentCodec||"").toUpperCase()+": "+Bi(-P,!0)+" ms ("+P+"dts) overlapping between fragments detected at "+t.toFixed(3)),!w||D>=u[0].pts||gi)){p=D;var O=u[0].pts-P;if(U)u[0].dts=p,u[0].pts=O;else for(var K=!0,z=0;z<u.length&&!(u[z].dts>O&&K);z++){var X=u[z].pts;if(u[z].dts-=P,u[z].pts-=P,z<u.length-1){var Q=u[z+1].pts,ge=u[z].pts,$=Q<=ge,J=Q<=X;K=$==J}}this.log("Video: Initial PTS/DTS adjusted: "+Bi(O,!0)+"/"+Bi(p,!0)+", delta: "+Bi(P,!0)+" ms")}}p=Math.max(0,p);for(var re=0,fe=0,_e=p,De=0;De<d;De++){for(var Ye=u[De],qe=Ye.units,Oe=qe.length,It=0,Be=0;Be<Oe;Be++)It+=qe[Be].data.length;fe+=It,re+=Oe,Ye.length=It,Ye.dts<_e?(Ye.dts=_e,_e+=I/4|0||1):_e=Ye.dts,S=Math.min(Ye.pts,S),T=Math.max(Ye.pts,T)}E=u[d-1].dts;var Ae=fe+4*re+8,nt;try{nt=new Uint8Array(Ae)}catch(Zr){this.observer.emit(y.ERROR,y.ERROR,{type:W.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:Zr,bytes:Ae,reason:"fail allocating video mdat "+Ae});return}var bt=new DataView(nt.buffer);bt.setUint32(0,Ae),nt.set(Et.types.mdat,4);for(var ut=!1,tt=Number.POSITIVE_INFINITY,Pt=Number.POSITIVE_INFINITY,Ct=Number.NEGATIVE_INFINITY,wt=Number.NEGATIVE_INFINITY,ft=0;ft<d;ft++){for(var vt=u[ft],Tt=vt.units,zr=0,$t=0,Qr=Tt.length;$t<Qr;$t++){var Yi=Tt[$t],Wi=Yi.data,$r=Yi.data.byteLength;bt.setUint32(g,$r),g+=4,nt.set(Wi,g),g+=$r,zr+=4+$r}var Or=void 0;if(ft<d-1)m=u[ft+1].dts-vt.dts,Or=u[ft+1].pts-vt.pts;else{var qi=this.config,Jr=ft>0?vt.dts-u[ft-1].dts:I;if(Or=ft>0?vt.pts-u[ft-1].pts:I,qi.stretchShortVideoTrack&&this.nextAudioTs!==null){var Fn=Math.floor(qi.maxBufferHole*l),ji=(s?S+s*l:this.nextAudioTs+c)-vt.pts;ji>Fn?(m=ji-Jr,m<0?m=Jr:ut=!0,this.log("It is approximately "+ji/90+" ms to the next segment; using duration "+m/90+" ms for the last video frame.")):m=Jr}else m=Jr}var us=Math.round(vt.pts-vt.dts);tt=Math.min(tt,m),Ct=Math.max(Ct,m),Pt=Math.min(Pt,Or),wt=Math.max(wt,Or),f.push(Ko(vt.key,m,zr,us))}if(f.length){if(gi){if(gi<70){var Fr=f[0].flags;Fr.dependsOn=2,Fr.isNonSync=0}}else if(wa&&wt-Pt<Ct-tt&&I/Ct<.025&&f[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Xi=p,Jt=0,Nn=f.length;Jt<Nn;Jt++){var Un=Xi+f[Jt].duration,fs=Xi+f[Jt].cts;if(Jt<Nn-1){var ds=Un+f[Jt+1].cts;f[Jt].duration=ds-fs}else f[Jt].duration=Jt?f[Jt-1].duration:I;f[Jt].cts=0,Xi=Un}}}m=ut||!m?I:m;var hs=E+m;this.nextVideoTs=v=hs-c,this.videoSampleDuration=m,this.isVideoContiguous=!0;var cs=Et.moof(e.sequenceNumber++,p,ae(e,{samples:f})),vs="video",Bn={data1:cs,data2:nt,startPTS:(S-c)/l,endPTS:(T+m-c)/l,startDTS:(p-c)/l,endDTS:v/l,type:vs,hasAudio:!1,hasVideo:!0,nb:f.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Bn},n.getSamplesPerFrame=function(e){switch(e.segmentCodec){case"mp3":return Yf;case"ac3":return Wf;default:return Hf}},n.remuxAudio=function(e,t,i,s,l){var u=e.inputTimeScale,f=e.samplerate?e.samplerate:u,d=u/f,h=this.getSamplesPerFrame(e),c=h*d,v=this._initPTS,g=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,m=[],p=l!==void 0,E=e.samples,S=g?0:8,T=this.nextAudioTs||-1,A=v.baseTime*u/v.timescale,x=A+t*u;if(this.isAudioContiguous=i=i||E.length&&T>0&&(s&&Math.abs(x-(T+A))<9e3||Math.abs(tr(E[0].pts,x)-(T+A))<20*c),E.forEach(function(tt){tt.pts=tr(tt.pts,x)}),!i||T<0){if(E=E.filter(function(tt){return tt.pts>=0}),!E.length)return;l===0?T=0:s&&!p?T=Math.max(0,x-A):T=E[0].pts-A}if(e.segmentCodec==="aac")for(var b=this.config.maxAudioFramesDrift,D=0,k=T+A;D<E.length;D++){var R=E[D],L=R.pts,I=L-k,P=Math.abs(1e3*I/u);if(I<=-b*c&&p)D===0&&(this.warn("Audio frame @ "+(L/u).toFixed(3)+"s overlaps marker by "+Math.round(1e3*I/u)+" ms."),this.nextAudioTs=T=L-A,k=L);else if(I>=b*c&&P<Vf&&p){var U=Math.round(I/c);for(k=L-U*c;k<0&&U&&c;)U--,k+=c;D===0&&(this.nextAudioTs=T=k-A),this.warn("Injecting "+U+" audio frames @ "+((k-A)/u).toFixed(3)+"s due to "+Math.round(1e3*I/u)+" ms gap.");for(var w=0;w<U;w++){var O=Bf.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);O||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),O=R.unit.subarray()),E.splice(D,0,{unit:O,pts:k}),k+=c,D++}}R.pts=k,k+=c}for(var K=null,z=null,X,Q=0,ge=E.length;ge--;)Q+=E[ge].unit.byteLength;for(var $=0,J=E.length;$<J;$++){var re=E[$],fe=re.unit,_e=re.pts;if(z!==null){var De=m[$-1];De.duration=Math.round((_e-z)/d)}else if(i&&e.segmentCodec==="aac"&&(_e=T+A),K=_e,Q>0){Q+=S;try{X=new Uint8Array(Q)}catch(tt){this.observer.emit(y.ERROR,y.ERROR,{type:W.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:tt,bytes:Q,reason:"fail allocating audio mdat "+Q});return}if(!g){var Ye=new DataView(X.buffer);Ye.setUint32(0,Q),X.set(Et.types.mdat,4)}}else return;X.set(fe,S);var qe=fe.byteLength;S+=qe,m.push(Ko(!0,h,qe,0)),z=_e}var Oe=m.length;if(Oe){var It=m[m.length-1];T=z-A,this.nextAudioTs=T+d*It.duration;var Be=g?new Uint8Array(0):Et.moof(e.sequenceNumber++,K/d,ae({},e,{samples:m}));e.samples=[];var Ae=(K-A)/u,nt=T/u,bt="audio",ut={data1:Be,data2:X,startPTS:Ae,endPTS:nt,startDTS:Ae,endDTS:nt,type:bt,hasAudio:!0,hasVideo:!1,nb:Oe};return this.isAudioContiguous=!0,ut}},o})(te);function tr(a,o){var n;if(o===null)return a;for(o<a?n=-8589934592:n=8589934592;Math.abs(a-o)>4294967296;)a+=n;return a}function qf(a){for(var o=0;o<a.length;o++)if(a[o].key)return o;return-1}function Vo(a,o,n,r){var e=a.samples.length;if(e){for(var t=a.inputTimeScale,i=0;i<e;i++){var s=a.samples[i];s.pts=tr(s.pts-n.baseTime*t/n.timescale,o*t)/t,s.dts=tr(s.dts-r.baseTime*t/r.timescale,o*t)/t}var l=a.samples;return a.samples=[],{samples:l}}}function Ho(a,o,n){var r=a.samples.length;if(r){for(var e=a.inputTimeScale,t=0;t<r;t++){var i=a.samples[t];i.pts=tr(i.pts-n.baseTime*e/n.timescale,o*e)/e}a.samples.sort(function(l,u){return l.pts-u.pts});var s=a.samples;return a.samples=[],{samples:s}}}var jf=(function(a){function o(r,e,t,i){var s;return s=a.call(this,"passthrough-remuxer",i)||this,s.emitInitSegment=!1,s.audioCodec=void 0,s.videoCodec=void 0,s.initData=void 0,s.initPTS=null,s.initTracks=void 0,s.lastEndTime=null,s.isVideoContiguous=!1,s}se(o,a);var n=o.prototype;return n.destroy=function(){},n.resetTimeStamp=function(e){this.lastEndTime=null;var t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)},n.resetNextTimestamp=function(){this.isVideoContiguous=!1,this.lastEndTime=null},n.resetInitSegment=function(e,t,i,s){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,s),this.emitInitSegment=!0},n.generateInitSegment=function(e,t){var i=this.audioCodec,s=this.videoCodec;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}var l=this.initData=ii(e),u=l.audio,f=l.video;if(t)$n(e,t);else{var d=u||f;d!=null&&d.encrypted&&this.warn('Init segment with encrypted track with has no key ("'+d.codec+'")!')}u&&(i=Yo(u,le.AUDIO,this)),f&&(s=Yo(f,le.VIDEO,this));var h={};u&&f?h.audiovideo={container:"video/mp4",codec:i+","+s,supplemental:f.supplemental,encrypted:f.encrypted,initSegment:e,id:"main"}:u?h.audio={container:"audio/mp4",codec:i,encrypted:u.encrypted,initSegment:e,id:"audio"}:f?h.video={container:"video/mp4",codec:s,supplemental:f.supplemental,encrypted:f.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=h},n.remux=function(e,t,i,s,l,u){var f,d,h=this.initPTS,c=this.lastEndTime,v={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};H(c)||(c=this.lastEndTime=l||0);var g=t.samples;if(!g.length)return v;var m={initPTS:void 0,timescale:void 0,trackId:void 0},p=this.initData;if((f=p)!=null&&f.length||(this.generateInitSegment(g),p=this.initData),!((d=p)!=null&&d.length))return this.warn("Failed to generate initSegment."),v;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);var E=Zi(g,p,this),S=p.audio?E[p.audio.id]:null,T=p.video?E[p.video.id]:null,A=An(T,1/0),x=An(S,1/0),b=An(T,0,!0),D=An(S,0,!0),k=l,R=0,L=S&&(!T||!h&&x<A||h&&h.trackId===p.audio.id),I=L?S:T;if(I){var P=I.timescale,U=I.start-l*P,w=L?p.audio.id:p.video.id;k=I.start/P,R=L?D-x:b-A,(u||!h)&&(Xf(h,k,l,R)||P!==h.timescale)&&(h&&this.warn("Timestamps at playlist time: "+(u?"":"~")+l+" "+U/P+" != initPTS: "+h.baseTime/h.timescale+" ("+h.baseTime+"/"+h.timescale+") trackId: "+h.trackId),this.log("Found initPTS at playlist time: "+l+" offset: "+(k-l)+" ("+U+"/"+P+") trackId: "+w),h=null,m.initPTS=U,m.timescale=P,m.trackId=w)}else this.warn("No audio or video samples found for initPTS at playlist time: "+l);h?(m.initPTS=h.baseTime,m.timescale=h.timescale,m.trackId=h.trackId):((!m.timescale||m.trackId===void 0||m.initPTS===void 0)&&(this.warn("Could not set initPTS"),m.initPTS=k,m.timescale=1,m.trackId=-1),this.initPTS=h={baseTime:m.initPTS,timescale:m.timescale,trackId:m.trackId});var O=k-h.baseTime/h.timescale,K=O+R;R>0?this.lastEndTime=K:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var z=!!p.audio,X=!!p.video,Q="";z&&(Q+="audio"),X&&(Q+="video");var ge=(p.audio?p.audio.encrypted:!1)||(p.video?p.video.encrypted:!1),$={data1:g,startPTS:O,startDTS:O,endPTS:K,endDTS:K,type:Q,hasAudio:z,hasVideo:X,nb:1,dropped:0,encrypted:ge};v.audio=z&&!X?$:void 0,v.video=X?$:void 0;var J=T?.sampleCount;if(J){var re=T.keyFrameIndex,fe=re!==-1;$.nb=J,$.dropped=re===0||this.isVideoContiguous?0:fe?re:J,$.independent=fe,$.firstKeyFrame=re,fe&&T.keyFrameStart&&($.firstKeyFramePTS=(T.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(v.independent=fe),this.isVideoContiguous||(this.isVideoContiguous=fe),$.dropped&&this.warn("fmp4 does not start with IDR: firstIDR "+re+"/"+J+" dropped: "+$.dropped+" start: "+($.firstKeyFramePTS||"NA"))}return v.initSegment=m,v.id3=Vo(i,l,h,h),s.samples.length&&(v.text=Ho(s,l,h)),v},o})(te);function An(a,o,n){return n===void 0&&(n=!1),a?.start!==void 0?(a.start+(n?a.duration:0))/a.timescale:o}function Xf(a,o,n,r){if(a===null)return!0;var e=Math.max(r,1),t=o-a.baseTime/a.timescale;return Math.abs(t-n)>e}function Yo(a,o,n){var r=a.codec;if(r&&r.length>4)return r;if(o===le.AUDIO){if(r==="ec-3"||r==="ac-3"||r==="alac")return r;if(r==="fLaC"||r==="Opus"){var e=!1;return Xt(r,e)}return n.warn('Unhandled audio codec "'+r+'" in mp4 MAP'),r||"mp4a"}return n.warn('Unhandled video codec "'+r+'" in mp4 MAP'),r||"avc1"}var Sr;try{Sr=self.performance.now.bind(self.performance)}catch{Sr=Date.now}var xn=[{demux:Cf,remux:jf},{demux:Ff,remux:Sn},{demux:_f,remux:Sn},{demux:kf,remux:Sn}];xn.splice(2,0,{demux:Df,remux:Sn});var Ma=(function(){function a(n,r,e,t,i,s){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=n,this.typeSupported=r,this.config=e,this.id=i,this.logger=s}var o=a.prototype;return o.configure=function(r){this.transmuxConfig=r,this.decrypter&&this.decrypter.reset()},o.push=function(r,e,t,i){var s=this,l=t.transmuxing;l.executeStart=Sr();var u=new Uint8Array(r),f=this.currentTransmuxState,d=this.transmuxConfig;i&&(this.currentTransmuxState=i);var h=i||f,c=h.contiguous,v=h.discontinuity,g=h.trackSwitch,m=h.accurateTimeOffset,p=h.timeOffset,E=h.initSegmentChange,S=d.audioCodec,T=d.videoCodec,A=d.defaultInitPts,x=d.duration,b=d.initSegmentData,D=zf(u,e);if(D&&ci(D.method)){var k=this.getDecrypter(),R=va(D.method);if(k.isSync()){var L=k.softwareDecrypt(u,D.key.buffer,D.iv.buffer,R),I=t.part>-1;if(I){var P=k.flush();L=P&&P.buffer}if(!L)return l.executeEnd=Sr(),Oa(t);u=new Uint8Array(L)}else return this.asyncResult=!0,this.decryptionPromise=k.webCryptoDecrypt(u,D.key.buffer,D.iv.buffer,R).then(function(z){var X=s.push(z,null,t);return s.decryptionPromise=null,X}),this.decryptionPromise}var U=this.needsProbing(v,g);if(U){var w=this.configureTransmuxer(u);if(w)return this.logger.warn("[transmuxer] "+w.message),this.observer.emit(y.ERROR,y.ERROR,{type:W.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:w,reason:w.message}),l.executeEnd=Sr(),Oa(t)}(v||g||E||U)&&this.resetInitSegment(b,S,T,x,e),(v||E||U)&&this.resetInitialTimestamp(A),c||this.resetContiguity();var O=this.transmux(u,D,p,m,t);this.asyncResult=Wr(O);var K=this.currentTransmuxState;return K.contiguous=!0,K.discontinuity=!1,K.trackSwitch=!1,l.executeEnd=Sr(),O},o.flush=function(r){var e=this,t=r.transmuxing;t.executeStart=Sr();var i=this.decrypter,s=this.currentTransmuxState,l=this.decryptionPromise;if(l)return this.asyncResult=!0,l.then(function(){return e.flush(r)});var u=[],f=s.timeOffset;if(i){var d=i.flush();d&&u.push(this.push(d.buffer,null,r))}var h=this.demuxer,c=this.remuxer;if(!h||!c){t.executeEnd=Sr();var v=[Oa(r)];return this.asyncResult?Promise.resolve(v):v}var g=h.flush(f);return Wr(g)?(this.asyncResult=!0,g.then(function(m){return e.flushRemux(u,m,r),u})):(this.flushRemux(u,g,r),this.asyncResult?Promise.resolve(u):u)},o.flushRemux=function(r,e,t){var i=e.audioTrack,s=e.videoTrack,l=e.id3Track,u=e.textTrack,f=this.currentTransmuxState,d=f.accurateTimeOffset,h=f.timeOffset;this.logger.log("[transmuxer.ts]: Flushed "+this.id+" sn: "+t.sn+(t.part>-1?" part: "+t.part:"")+" of "+(this.id===F.MAIN?"level":"track")+" "+t.level);var c=this.remuxer.remux(i,s,l,u,h,d,!0,this.id);r.push({remuxResult:c,chunkMeta:t}),t.transmuxing.executeEnd=Sr()},o.resetInitialTimestamp=function(r){var e=this.demuxer,t=this.remuxer;!e||!t||(e.resetTimeStamp(r),t.resetTimeStamp(r))},o.resetContiguity=function(){var r=this.demuxer,e=this.remuxer;!r||!e||(r.resetContiguity(),e.resetNextTimestamp())},o.resetInitSegment=function(r,e,t,i,s){var l=this.demuxer,u=this.remuxer;!l||!u||(l.resetInitSegment(r,e,t,i),u.resetInitSegment(r,e,t,s))},o.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},o.transmux=function(r,e,t,i,s){var l;return e&&e.method==="SAMPLE-AES"?l=this.transmuxSampleAes(r,e,t,i,s):l=this.transmuxUnencrypted(r,t,i,s),l},o.transmuxUnencrypted=function(r,e,t,i){var s=this.demuxer.demux(r,e,!1,!this.config.progressive),l=s.audioTrack,u=s.videoTrack,f=s.id3Track,d=s.textTrack,h=this.remuxer.remux(l,u,f,d,e,t,!1,this.id);return{remuxResult:h,chunkMeta:i}},o.transmuxSampleAes=function(r,e,t,i,s){var l=this;return this.demuxer.demuxSampleAes(r,e,t).then(function(u){var f=l.remuxer.remux(u.audioTrack,u.videoTrack,u.id3Track,u.textTrack,t,i,!1,l.id);return{remuxResult:f,chunkMeta:s}})},o.configureTransmuxer=function(r){for(var e=this.config,t=this.observer,i=this.typeSupported,s,l=0,u=xn.length;l<u;l++){var f;if((f=xn[l].demux)!=null&&f.probe(r,this.logger)){s=xn[l];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");var d=this.demuxer,h=this.remuxer,c=s.remux,v=s.demux;(!h||!(h instanceof c))&&(this.remuxer=new c(t,e,i,this.logger)),(!d||!(d instanceof v))&&(this.demuxer=new v(t,e,i,this.logger),this.probe=v.probe)},o.needsProbing=function(r,e){return!this.demuxer||!this.remuxer||r||e},o.getDecrypter=function(){var r=this.decrypter;return r||(r=this.decrypter=new da(this.config)),r},a})();function zf(a,o){var n=null;return a.byteLength>0&&o?.key!=null&&o.iv!==null&&o.method!=null&&(n=o),n}var Oa=function(o){return{remuxResult:{},chunkMeta:o}};function Wr(a){return"then"in a&&a.then instanceof Function}var Qf=function(o,n,r,e,t){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=o,this.videoCodec=n,this.initSegmentData=r,this.duration=e,this.defaultInitPts=t||null},$f=function(o,n,r,e,t,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=o,this.contiguous=n,this.accurateTimeOffset=r,this.trackSwitch=e,this.timeOffset=t,this.initSegmentChange=i},Fa=[];typeof je<"u"&&je&&Jf();function Jf(){self.addEventListener("message",function(a){var o=a.data,n=o.instanceNo;if(n!==void 0){var r=Fa[n];if(o.cmd==="reset"&&(delete Fa[o.resetNo],r&&r.destroy(),o.cmd="init"),o.cmd==="init"){var e=JSON.parse(o.config),t=new be;t.on(y.FRAG_DECRYPTED,mi),t.on(y.ERROR,mi);var i=Dt(e.debug,o.id);Zf(i,n),Fa[n]=new Ma(t,o.typeSupported,e,"",o.id,i),mi("init",null,n);return}if(r)switch(o.cmd){case"configure":{r.configure(o.config);break}case"demux":{var s=r.push(o.data,o.decryptdata,o.chunkMeta,o.state);Wr(s)?s.then(function(f){Na(self,f,n)}).catch(function(f){mi(y.ERROR,{instanceNo:n,type:W.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:o.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker push error"},n)}):Na(self,s,n);break}case"flush":{var l=o.chunkMeta,u=r.flush(l);Wr(u)?u.then(function(f){qo(self,f,l,n)}).catch(function(f){mi(y.ERROR,{type:W.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:o.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker flush error"},n)}):qo(self,u,l,n);break}}}})}function Na(a,o,n){if(ed(o.remuxResult))return!1;var r=[],e=o.remuxResult,t=e.audio,i=e.video;return t&&Wo(r,t),i&&Wo(r,i),a.postMessage({event:"transmuxComplete",data:o,instanceNo:n},r),!0}function Wo(a,o){o.data1&&a.push(o.data1.buffer),o.data2&&a.push(o.data2.buffer)}function qo(a,o,n,r){var e=o.reduce(function(t,i){return Na(a,i,r)||t},!1);e||a.postMessage({event:"transmuxComplete",data:o[0],instanceNo:r}),a.postMessage({event:"flush",data:n,instanceNo:r})}function mi(a,o,n){self.postMessage({event:a,data:o,instanceNo:n})}function Zf(a,o){var n=function(t){a[t]=function(){var i=Array.prototype.join.call(arguments," ");mi("workerLog",{logType:t,message:i},o)}};for(var r in a)n(r)}function ed(a){return!a.audio&&!a.video&&!a.text&&!a.id3&&!a.initSegment}var Gi="1.6.11",pi={};function td(){return typeof Ge=="function"}function rd(){var a=pi[Gi];if(a)return a.clientCount++,a;var o=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+Ge.toString()+")(true);"],{type:"text/javascript"}),n=self.URL.createObjectURL(o),r=new self.Worker(n),e={worker:r,objectURL:n,clientCount:1};return pi[Gi]=e,e}function id(a){var o=pi[a];if(o)return o.clientCount++,o;var n=new self.URL(a,self.location.href).href,r=new self.Worker(n),e={worker:r,scriptURL:n,clientCount:1};return pi[a]=e,e}function nd(a){var o=pi[a||Gi];if(o){var n=o.clientCount--;if(n===1){var r=o.worker,e=o.objectURL;delete pi[a||Gi],e&&self.URL.revokeObjectURL(e),r.terminate()}}}var jo=0,Xo=(function(){function a(n,r,e,t){var i=this;this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=jo++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=function(c){var v=c.data,g=i.hls;if(!(!g||!(v!=null&&v.event)||v.instanceNo!==i.instanceNo))switch(v.event){case"init":{var m,p=(m=i.workerContext)==null?void 0:m.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{i.handleTransmuxComplete(v.data);break}case"flush":{i.onFlush(v.data);break}case"workerLog":{g.logger[v.data.logType]&&g.logger[v.data.logType](v.data.message);break}default:{v.data=v.data||{},v.data.frag=i.frag,v.data.part=i.part,v.data.id=i.id,g.trigger(v.event,v.data);break}}},this.onWorkerError=function(c){if(i.hls){var v=new Error(c.message+"  ("+c.filename+":"+c.lineno+")");i.hls.config.enableWorker=!1,i.hls.logger.warn('Error in "'+i.id+'" Web Worker, fallback to inline'),i.hls.trigger(y.ERROR,{type:W.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:v})}};var s=n.config;this.hls=n,this.id=r,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=e,this.onFlush=t;var l=function(v,g){g=g||{},g.frag=i.frag||void 0,v===y.ERROR&&(g=g,g.parent=i.id,g.part=i.part,i.error=g.error),i.hls.trigger(v,g)};this.observer=new be,this.observer.on(y.FRAG_DECRYPTED,l),this.observer.on(y.ERROR,l);var u=rn(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){var f=this.hls.logger,d=s.workerPath||td();if(d){try{s.workerPath?(f.log("loading Web Worker "+s.workerPath+' for "'+r+'"'),this.workerContext=id(s.workerPath)):(f.log('injecting Web Worker for "'+r+'"'),this.workerContext=rd());var h=this.workerContext.worker;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:r,config:He(s)})}catch(c){f.warn('Error setting up "'+r+'" Web Worker, fallback to inline',c),this.terminateWorker(),this.error=null,this.transmuxer=new Ma(this.observer,u,s,"",r,n.logger)}return}}this.transmuxer=new Ma(this.observer,u,s,"",r,n.logger)}var o=a.prototype;return o.reset=function(){if(this.frag=null,this.part=null,this.workerContext){var r=this.instanceNo;this.instanceNo=jo++;var e=this.hls.config,t=rn(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:r,typeSupported:t,id:this.id,config:He(e)})}},o.terminateWorker=function(){if(this.workerContext){var r=this.workerContext.worker;this.workerContext=null,r.removeEventListener("message",this.onWorkerMessage),r.removeEventListener("error",this.onWorkerError),nd(this.hls.config.workerPath)}},o.destroy=function(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{var r=this.transmuxer;r&&(r.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null},o.push=function(r,e,t,i,s,l,u,f,d,h){var c,v,g=this;d.transmuxing.start=self.performance.now();var m=this.instanceNo,p=this.transmuxer,E=l?l.start:s.start,S=s.decryptdata,T=this.frag,A=!(T&&s.cc===T.cc),x=!(T&&d.level===T.level),b=T?d.sn-T.sn:-1,D=this.part?d.part-this.part.index:-1,k=b===0&&d.id>1&&d.id===T?.stats.chunkCount,R=!x&&(b===1||b===0&&(D===1||k&&D<=0)),L=self.performance.now();(x||b||s.stats.parsing.start===0)&&(s.stats.parsing.start=L),l&&(D||!R)&&(l.stats.parsing.start=L);var I=!(T&&((c=s.initSegment)==null?void 0:c.url)===((v=T.initSegment)==null?void 0:v.url)),P=new $f(A,R,f,x,E,I);if(!R||A||I){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for "+s.type+" sn: "+d.sn+(d.part>-1?" part: "+d.part:"")+" "+(this.id===F.MAIN?"level":"track")+": "+d.level+" id: "+d.id+`
        discontinuity: `+A+`
        trackSwitch: `+x+`
        contiguous: `+R+`
        accurateTimeOffset: `+f+`
        timeOffset: `+E+`
        initSegmentChange: `+I);var U=new Qf(t,i,e,u,h);this.configureTransmuxer(U)}if(this.frag=s,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:m,cmd:"demux",data:r,decryptdata:S,chunkMeta:d,state:P},r instanceof ArrayBuffer?[r]:[]);else if(p){var w=p.push(r,S,d,P);Wr(w)?w.then(function(O){g.handleTransmuxComplete(O)}).catch(function(O){g.transmuxerError(O,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(w)}},o.flush=function(r){var e=this;r.transmuxing.start=self.performance.now();var t=this.instanceNo,i=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:r});else if(i){var s=i.flush(r);Wr(s)?s.then(function(l){e.handleFlushResult(l,r)}).catch(function(l){e.transmuxerError(l,r,"transmuxer-interface flush error")}):this.handleFlushResult(s,r)}},o.transmuxerError=function(r,e,t){this.hls&&(this.error=r,this.hls.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:r,err:r,reason:t}))},o.handleFlushResult=function(r,e){var t=this;r.forEach(function(i){t.handleTransmuxComplete(i)}),this.onFlush(e)},o.configureTransmuxer=function(r){var e=this.instanceNo,t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:r}):t&&t.configure(r)},o.handleTransmuxComplete=function(r){r.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(r)},a})(),zo=100,ad=(function(a){function o(r,e,t){var i;return i=a.call(this,r,e,t,"audio-stream-controller",F.AUDIO)||this,i.mainAnchor=null,i.mainFragLoading=null,i.audioOnly=!1,i.bufferedTrack=null,i.switchingTrack=null,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.flushing=!1,i.bufferFlushed=!1,i.cachedTrackLoadedData=null,i.registerListeners(),i}se(o,a);var n=o.prototype;return n.onHandlerDestroying=function(){this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this),this.resetItem()},n.resetItem=function(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null},n.registerListeners=function(){a.prototype.registerListeners.call(this);var e=this.hls;e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},n.unregisterListeners=function(){var e=this.hls;e&&(a.prototype.unregisterListeners.call(this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this))},n.onInitPtsFound=function(e,t){var i=t.frag,s=t.id,l=t.initPTS,u=t.timescale,f=t.trackId;if(s===F.MAIN){var d=i.cc,h=this.fragCurrent;if(this.initPTS[d]={baseTime:l,timescale:u,trackId:f},this.log("InitPTS for cc: "+d+" found from main: "+l/u+" ("+l+"/"+u+") trackId: "+f),this.mainAnchor=i,this.state===C.WAITING_INIT_PTS){var c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==d)&&this.syncWithAnchor(i,c?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==d?(h.abortRequests(),this.syncWithAnchor(i,h)):this.state===C.IDLE&&this.tick()}},n.getLoadPosition=function(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:a.prototype.getLoadPosition.call(this)},n.syncWithAnchor=function(e,t){var i,s=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(!(t&&s?.cc===t.cc)){var l=(s||e).cc,u=this.getLevelDetails(),f=this.getLoadPosition(),d=Os(u,l,f);d&&(this.log("Syncing with main frag at "+d.start+" cc "+d.cc),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===C.IDLE&&this.doTickIdle())}},n.startLoad=function(e,t){if(!this.levels){this.startPosition=e,this.state=C.STOPPED;return}var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(zo),i>0&&e===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),e=i,this.state=C.IDLE):this.state=C.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()},n.doTick=function(){switch(this.state){case C.IDLE:this.doTickIdle();break;case C.WAITING_TRACK:{var e=this.levels,t=this.trackId,i=e?.[t],s=i?.details;if(s&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(s))break;this.state=C.WAITING_INIT_PTS}break}case C.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case C.WAITING_INIT_PTS:{var l=this.waitingData;if(l){var u=l.frag,f=l.part,d=l.cache,h=l.complete,c=this.mainAnchor;if(this.initPTS[u.cc]!==void 0){this.waitingData=null,this.state=C.FRAG_LOADING;var v=d.flush().buffer,g={frag:u,part:f,payload:v,networkDetails:null};this._handleFragmentLoadProgress(g),h&&a.prototype._handleFragmentLoadComplete.call(this,g)}else c&&c.cc!==l.frag.cc&&this.syncWithAnchor(c,l.frag)}else this.state=C.IDLE}}this.onTickEnd()},n.resetLoadingState=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),a.prototype.resetLoadingState.call(this)},n.onTickEnd=function(){var e=this.media;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)},n.doTickIdle=function(){var e,t=this.hls,i=this.levels,s=this.media,l=this.trackId,u=t.config;if(!(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!u.startFragPrefetch)||!(i!=null&&i[l]))){var f=i[l],d=f.details;if(!d||this.waitForLive(f)||this.waitForCdnTuneIn(d)){this.state=C.WAITING_TRACK,this.startFragRequested=!1;return}var h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,le.AUDIO,F.AUDIO));var c=this.getFwdBufferInfo(h,F.AUDIO);if(c!==null){if(!this.switchingTrack&&this._streamEnded(c,d)){t.trigger(y.BUFFER_EOS,{type:"audio"}),this.state=C.ENDED;return}var v=c.len,g=t.maxBufferLength,m=d.fragments,p=m[0].start,E=this.getLoadPosition(),S=this.flushing?E:c.end;if(this.switchingTrack&&s){var T=E;d.PTSKnown&&T<p&&(c.end>p||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=p+.05)}if(!(v>=g&&!this.switchingTrack&&S<m[m.length-1].start)){var A=this.getNextFragment(S,d);if(A&&this.isLoopLoading(A,S)&&(A=this.getNextFragmentLoopLoading(A,d,c,F.MAIN,g)),!A){this.bufferFlushed=!0;return}var x=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&x&&Ve(A)&&!A.endList&&(!d.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(x)===lt.OK&&(this.mainFragLoading=x=null),x&&Ve(x))){if(A.start>x.end){var b=this.fragmentTracker.getFragAtPos(S,F.MAIN);b&&b.end>x.end&&(x=b,this.mainFragLoading={frag:b,targetBufferTime:null})}var D=A.start>x.end;if(D)return}this.loadFragment(A,f,S)}}}},n.onMediaDetaching=function(e,t){this.bufferFlushed=this.flushing=!1,a.prototype.onMediaDetaching.call(this,e,t)},n.onAudioTracksUpdated=function(e,t){var i=t.audioTracks;this.resetTransmuxer(),this.levels=i.map(function(s){return new wi(s)})},n.onAudioTrackSwitching=function(e,t){var i=!!t.url;this.trackId=t.id;var s=this.fragCurrent;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==C.STOPPED&&(this.setInterval(zo),this.state=C.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())},n.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1},n.onLevelLoaded=function(e,t){this.mainDetails=t.details;var i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(y.AUDIO_TRACK_LOADED,i))},n.onAudioTrackLoaded=function(e,t){var i,s=this.levels,l=t.details,u=t.id,f=t.groupId,d=t.track;if(!s){this.warn("Audio tracks reset while loading track "+u+' "'+d.name+'" of "'+f+'"');return}var h=this.mainDetails;if(!h||l.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=t,this.state!==C.STOPPED&&(this.state=C.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log("Audio track "+u+' "'+d.name+'" of "'+f+'" loaded ['+l.startSN+","+l.endSN+"]"+(l.lastPartSn?"[part-"+l.lastPartSn+"-"+l.lastPartIndex+"]":"")+",duration:"+l.totalduration);var c=s[u],v=0;if(l.live||(i=c.details)!=null&&i.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(c.details){var g;v=this.alignPlaylists(l,c.details,(g=this.levelLastLoaded)==null?void 0:g.details)}l.alignedSliding||(So(l,h),l.alignedSliding||mn(l,h),v=l.fragmentStart)}c.details=l,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(h,v),this.hls.trigger(y.AUDIO_TRACK_UPDATED,{details:l,id:u,groupId:t.groupId}),this.state===C.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=C.IDLE),this.tick()},n._handleFragmentLoadProgress=function(e){var t,i=e.frag,s=e.part,l=e.payload,u=this.config,f=this.trackId,d=this.levels;if(!d){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var h=d[f];if(!h){this.warn("Audio track is undefined on fragment load progress");return}var c=h.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}var v=u.defaultAudioCodec||h.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new Xo(this.hls,F.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var m=this.initPTS[i.cc],p=(t=i.initSegment)==null?void 0:t.data;if(m!==void 0){var E=!1,S=s?s.index:-1,T=S!==-1,A=new ha(i.level,i.sn,i.stats.chunkCount,l.byteLength,S,T);g.push(l,p,v,"",i,s,c.totalduration,E,A,m)}else{this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+f);var x=this.waitingData=this.waitingData||{frag:i,part:s,cache:new xo,complete:!1},b=x.cache;b.push(new Uint8Array(l)),this.state!==C.STOPPED&&(this.state=C.WAITING_INIT_PTS)}},n._handleFragmentLoadComplete=function(e){if(this.waitingData){this.waitingData.complete=!0;return}a.prototype._handleFragmentLoadComplete.call(this,e)},n.onBufferReset=function(){this.mediaBuffer=null},n.onBufferCreated=function(e,t){this.bufferFlushed=this.flushing=!1;var i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)},n.onFragLoading=function(e,t){!this.audioOnly&&t.frag.type===F.MAIN&&Ve(t.frag)&&(this.mainFragLoading=t,this.state===C.IDLE&&this.tick())},n.onFragBuffered=function(e,t){var i=t.frag,s=t.part;if(i.type!==F.AUDIO){!this.audioOnly&&i.type===F.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(s?" p: "+s.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));return}if(Ve(i)){this.fragPrevious=i;var l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(y.AUDIO_TRACK_SWITCHED,Te({},l)))}this.fragBufferedComplete(i,s),this.media&&this.tick()},n.onError=function(e,t){var i;if(t.fatal){this.state=C.ERROR;return}switch(t.details){case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.AUDIO,t);break;case _.AUDIO_TRACK_LOAD_ERROR:case _.AUDIO_TRACK_LOAD_TIMEOUT:case _.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===C.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===N.AUDIO_TRACK&&(this.state=C.IDLE);break;case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case _.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case _.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}},n.onBufferFlushing=function(e,t){var i=t.type;i!==le.VIDEO&&(this.flushing=!0)},n.onBufferFlushed=function(e,t){var i=t.type;if(i!==le.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===C.ENDED&&(this.state=C.IDLE);var s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,i,F.AUDIO),this.tick())}},n._handleTransmuxComplete=function(e){var t,i="audio",s=this.hls,l=e.remuxResult,u=e.chunkMeta,f=this.getCurrentContext(u);if(!f){this.resetWhenMissingContext(u);return}var d=f.frag,h=f.part,c=f.level,v=c.details,g=l.audio,m=l.text,p=l.id3,E=l.initSegment;if(this.fragContextChanged(d)||!v){this.fragmentTracker.removeFragment(d);return}if(this.state=C.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){var S=d.initSegment||d;if(this.unhandledEncryptionError(E,d))return;this._bufferInitSegment(c,E.tracks,S,u),s.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:i,tracks:E.tracks})}if(g){var T=g.startPTS,A=g.endPTS,x=g.startDTS,b=g.endDTS;h&&(h.elementaryStreams[le.AUDIO]={startPTS:T,endPTS:A,startDTS:x,endDTS:b}),d.setElementaryStreamInfo(le.AUDIO,T,A,x,b),this.bufferFragmentData(g,d,h,u)}if(p!=null&&(t=p.samples)!=null&&t.length){var D=ae({id:i,frag:d,details:v},p);s.trigger(y.FRAG_PARSING_METADATA,D)}if(m){var k=ae({id:i,frag:d,details:v},m);s.trigger(y.FRAG_PARSING_USERDATA,k)}},n._bufferInitSegment=function(e,t,i,s){if(this.state===C.PARSING&&(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!!t.audio)){var l=t.audio;l.id=F.AUDIO;var u=e.audioCodec;this.log("Init audio buffer, container:"+l.container+", codecs[level/parsed]=["+u+"/"+l.codec+"]"),u&&u.split(",").length===1&&(l.levelCodec=u),this.hls.trigger(y.BUFFER_CODECS,t);var f=l.initSegment;if(f!=null&&f.byteLength){var d={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:f};this.hls.trigger(y.BUFFER_APPENDING,d)}this.tickImmediate()}},n.loadFragment=function(e,t,i){var s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===lt.NOT_LOADED||s===lt.PARTIAL){var l;if(!Ve(e))this._loadInitSegment(e,t);else if((l=t.details)!=null&&l.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=C.WAITING_INIT_PTS;var u=this.mainDetails;u&&u.fragmentStart!==t.details.fragmentStart&&mn(t.details,u)}else a.prototype.loadFragment.call(this,e,t,i)}else this.clearTrackerIfNeeded(e)},n.flushAudioIfNeeded=function(e){if(this.media&&this.bufferedTrack){var t=this.bufferedTrack,i=t.name,s=t.lang,l=t.assocLang,u=t.characteristics,f=t.audioCodec,d=t.channels;Vr({name:i,lang:s,assocLang:l,characteristics:u,audioCodec:f,channels:d},e,Hr)||(ln(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}},n.completeAudioSwitch=function(e){var t=this.hls;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(y.AUDIO_TRACK_SWITCHED,Te({},e))},o})(Aa),Ua=(function(a){function o(r,e){var t;return t=a.call(this,e,r.logger)||this,t.hls=void 0,t.canLoad=!1,t.timer=-1,t.hls=r,t}se(o,a);var n=o.prototype;return n.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},n.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},n.startLoad=function(){this.canLoad=!0,this.loadPlaylist()},n.stopLoad=function(){this.canLoad=!1,this.clearTimer()},n.switchParams=function(e,t,i){var s=t?.renditionReports;if(s){for(var l=-1,u=0;u<s.length;u++){var f=s[u],d=void 0;try{d=new self.URL(f.URI,t.url).href}catch(p){this.warn("Could not construct new URL for Rendition Report: "+p),d=f.URI||""}if(d===e){l=u;break}else d===e.substring(0,d.length)&&(l=u)}if(l!==-1){var h=s[l],c=parseInt(h["LAST-MSN"])||t.lastPartSn,v=parseInt(h["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){var g=Math.min(t.age-t.partTarget,t.targetduration);v>=0&&g>t.partTarget&&(v+=1)}var m=i&&Rs(i);return new _s(c,v>=0?v:void 0,m)}}},n.loadPlaylist=function(e){this.clearTimer()},n.loadingPlaylist=function(e,t){this.clearTimer()},n.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},n.getUrlWithDirectives=function(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}return e},n.playlistLoaded=function(e,t,i){var s=t.details,l=t.stats,u=self.performance.now(),f=l.loading.first?Math.max(0,u-l.loading.first):0;s.advancedDateTime=Date.now()-f;var d=this.hls.config.timelineOffset;if(d!==s.appliedTimelineOffset){var h=Math.max(d||0,0);s.appliedTimelineOffset=h,s.fragments.forEach(function(Q){Q.setStart(Q.playlistOffset+h)})}if(s.live||i!=null&&i.live){var c="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(i),i&&s.fragments.length>0){Xu(i,s,this);var v=s.playlistParsingError;if(v){this.warn(v);var g=this.hls;if(!g.config.ignorePlaylistParsingErrors){var m,p=t.networkDetails;g.trigger(y.ERROR,{type:W.NETWORK_ERROR,details:_.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:v,reason:v.message,level:t.level||void 0,parent:(m=s.fragments[0])==null?void 0:m.type,networkDetails:p,stats:l});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=l.loading.start);var E=this.hls.mainForwardBufferInfo,S=E?E.end-E.len:0,T=(s.edge-S)*1e3,A=co(s,T);if(s.requestScheduled+A<u?s.requestScheduled=u:s.requestScheduled+=A,this.log("live playlist "+e+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED")),!this.canLoad||!s.live)return;var x,b=void 0,D=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var k=this.hls.config.lowLatencyMode,R=s.lastPartSn,L=s.endSN,I=s.lastPartIndex,P=I!==-1,U=R===L;P?U?(b=L+1,D=k?0:I):(b=R,D=k?I+1:s.maxPartIndex):b=L+1;var w=s.age,O=w+s.ageHeader,K=Math.min(O-s.partTarget,s.targetduration*1.5);if(K>0){if(O>s.targetduration*3)this.log("Playlist last advanced "+w.toFixed(2)+"s ago. Omitting segment and part directives."),b=void 0,D=void 0;else if(i!=null&&i.tuneInGoal&&O-s.partTarget>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+K+" with playlist age: "+s.age),K=0;else{var z=Math.floor(K/s.targetduration);if(b+=z,D!==void 0){var X=Math.round(K%s.targetduration/s.partTarget);D+=X}this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+w.toFixed(2)+"s goal: "+K+" skip sn "+z+" to part "+D)}s.tuneInGoal=K}if(x=this.getDeliveryDirectives(s,t.deliveryDirectives,b,D),k||!U){s.requestScheduled=u,this.loadingPlaylist(c,x);return}}else(s.canBlockReload||s.canSkipUntil)&&(x=this.getDeliveryDirectives(s,t.deliveryDirectives,b,D));x&&b!==void 0&&s.canBlockReload&&(s.requestScheduled=l.loading.first+Math.max(A-f*2,A/2)),this.scheduleLoading(c,x,s)}else this.clearTimer()},n.scheduleLoading=function(e,t,i){var s=this,l=i||e.details;if(!l){this.loadingPlaylist(e,t);return}var u=self.performance.now(),f=l.requestScheduled;if(u>=f){this.loadingPlaylist(e,t);return}var d=f-u;this.log("reload live playlist "+(e.name||e.bitrate+"bps")+" in "+Math.round(d)+" ms"),this.clearTimer(),this.timer=self.setTimeout(function(){return s.loadingPlaylist(e,t)},d)},n.getDeliveryDirectives=function(e,t,i,s){var l=Rs(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,l=fi.No),new _s(i,s,l)},n.checkRetry=function(e){var t=this,i=e.details,s=un(e),l=e.errorAction,u=l||{},f=u.action,d=u.retryCount,h=d===void 0?0:d,c=u.retryConfig,v=!!l&&!!c&&(f===yt.RetryRequest||!l.resolved&&f===yt.SendAlternateToPenaltyBox);if(v){var g;if(h>=c.maxNumRetry)return!1;if(s&&(g=e.context)!=null&&g.deliveryDirectives)this.warn("Retrying playlist loading "+(h+1)+"/"+c.maxNumRetry+' after "'+i+'" without delivery-directives'),this.loadPlaylist();else{var m=ua(c,h);this.clearTimer(),this.timer=self.setTimeout(function(){return t.loadPlaylist()},m),this.warn("Retrying playlist loading "+(h+1)+"/"+c.maxNumRetry+' after "'+i+'" in '+m+"ms")}e.levelRetry=!0,l.resolved=!0}return v},o})(te);function Qo(a,o){if(a.length!==o.length)return!1;for(var n=0;n<a.length;n++)if(!Ki(a[n].attrs,o[n].attrs))return!1;return!0}function Ki(a,o,n){var r=a["STABLE-RENDITION-ID"];return r&&!n?r===o["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(function(e){return a[e]!==o[e]})}function Ba(a,o){return o.label.toLowerCase()===a.name.toLowerCase()&&(!o.language||o.language.toLowerCase()===(a.lang||"").toLowerCase())}var sd=(function(a){function o(r){var e;return e=a.call(this,r,"audio-track-controller")||this,e.tracks=[],e.groupIds=null,e.tracksInGroup=[],e.trackId=-1,e.currentTrack=null,e.selectDefaultTrack=!0,e.registerListeners(),e}se(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,a.prototype.destroy.call(this)},n.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(e,t){this.tracks=t.audioTracks||[]},n.onAudioTrackLoaded=function(e,t){var i=t.id,s=t.groupId,l=t.details,u=this.tracksInGroup[i];if(!u||u.groupId!==s){this.warn("Audio track with id:"+i+" and group:"+s+" not found in active group "+u?.groupId);return}var f=u.details;u.details=t.details,this.log("Audio track "+i+' "'+u.name+'" lang:'+u.lang+" group:"+s+" loaded ["+l.startSN+"-"+l.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,t,f)},n.onLevelLoading=function(e,t){this.switchLevel(t.level)},n.onLevelSwitching=function(e,t){this.switchLevel(t.level)},n.switchLevel=function(e){var t=this.hls.levels[e];if(t){var i=t.audioGroups||null,s=this.groupIds,l=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(function(E){return s?.indexOf(E)===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var u=this.tracks.filter(function(E){return!i||i.indexOf(E.groupId)!==-1});if(u.length)this.selectDefaultTrack&&!u.some(function(E){return E.default})&&(this.selectDefaultTrack=!1),u.forEach(function(E,S){E.id=S});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=u;var f=this.hls.config.audioPreference;if(!l&&f){var d=hr(f,u,Hr);if(d>-1)l=u[d];else{var h=hr(f,this.tracks);l=this.tracks[h]}}var c=this.findTrackId(l);c===-1&&l&&(c=this.findTrackId(null));var v={audioTracks:u};this.log("Updating audio tracks, "+u.length+" track(s) found in group(s): "+i?.join(",")),this.hls.trigger(y.AUDIO_TRACKS_UPDATED,v);var g=this.trackId;if(c!==-1&&g===-1)this.setAudioTrack(c);else if(u.length&&g===-1){var m,p=new Error("No audio track selected for current audio group-ID(s): "+((m=this.groupIds)==null?void 0:m.join(","))+" track count: "+u.length);this.warn(p.message),this.hls.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}}},n.onError=function(e,t){t.fatal||!t.context||t.context.type===N.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)},n.setAudioOption=function(e){var t=this.hls;if(t.config.audioPreference=e,e){var i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){var s=this.currentTrack;if(s&&Vr(e,s,Hr))return s;var l=hr(e,this.tracksInGroup,Hr);if(l>-1){var u=this.tracksInGroup[l];return this.setAudioTrack(l),u}else if(s){var f=t.loadLevel;f===-1&&(f=t.firstAutoLevel);var d=cu(e,t.levels,i,f,Hr);if(d===-1)return null;t.nextLoadLevel=d}if(e.channels||e.audioCodec){var h=hr(e,i);if(h>-1)return i[h]}}}return null},n.setAudioTrack=function(e){var t=this.tracksInGroup;if(e<0||e>=t.length){this.warn("Invalid audio track id: "+e);return}this.selectDefaultTrack=!1;var i=this.currentTrack,s=t[e],l=s.details&&!s.details.live;if(!(e===this.trackId&&s===i&&l)&&(this.log("Switching to audio-track "+e+' "'+s.name+'" lang:'+s.lang+" group:"+s.groupId+" channels:"+s.channels),this.trackId=e,this.currentTrack=s,this.hls.trigger(y.AUDIO_TRACK_SWITCHING,Te({},s)),!l)){var u=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(u)}},n.findTrackId=function(e){for(var t=this.tracksInGroup,i=0;i<t.length;i++){var s=t[i];if(!(this.selectDefaultTrack&&!s.default)&&(!e||Vr(e,s,Hr)))return i}if(e){for(var l=e.name,u=e.lang,f=e.assocLang,d=e.characteristics,h=e.audioCodec,c=e.channels,v=0;v<t.length;v++){var g=t[v];if(Vr({name:l,lang:u,assocLang:f,characteristics:d,audioCodec:h,channels:c},g,Hr))return v}for(var m=0;m<t.length;m++){var p=t[m];if(Ki(e.attrs,p.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return m}for(var E=0;E<t.length;E++){var S=t[E];if(Ki(e.attrs,S.attrs,["LANGUAGE"]))return E}}return-1},n.loadPlaylist=function(e){a.prototype.loadPlaylist.call(this);var t=this.currentTrack;this.shouldLoadPlaylist(t)&&ln(t.url,this.hls)&&this.scheduleLoading(t,e)},n.loadingPlaylist=function(e,t){a.prototype.loadingPlaylist.call(this,e,t);var i=e.id,s=e.groupId,l=this.getUrlWithDirectives(e.url,t),u=e.details,f=u?.age;this.log("Loading audio-track "+i+' "'+e.name+'" lang:'+e.lang+" group:"+s+(t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+l),this.hls.trigger(y.AUDIO_TRACK_LOADING,{url:l,id:i,groupId:s,deliveryDirectives:t||null,track:e})},Y(o,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}])})(Ua),od=(function(){function a(n){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=n}var o=a.prototype;return o.destroy=function(){this.tracks=this.queues=null},o.append=function(r,e,t){if(!(this.queues===null||this.tracks===null)){var i=this.queues[e];i.push(r),i.length===1&&!t&&this.executeNext(e)}},o.appendBlocker=function(r){var e=this;return new Promise(function(t){var i={label:"async-blocker",execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};e.append(i,r)})},o.prependBlocker=function(r){var e=this;return new Promise(function(t){if(e.queues){var i={label:"async-blocker-prepend",execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};e.queues[r].unshift(i)}})},o.removeBlockers=function(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(function(r){var e,t=(e=r[0])==null?void 0:e.label;(t==="async-blocker"||t==="async-blocker-prepend")&&(r[0].execute(),r.splice(0,1))})},o.unblockAudio=function(r){if(this.queues!==null){var e=this.queues.audio;e[0]===r&&this.shiftAndExecuteNext("audio")}},o.executeNext=function(r){if(!(this.queues===null||this.tracks===null)){var e=this.queues[r];if(e.length){var t=e[0];try{t.execute()}catch(l){var i;if(t.onError(l),this.queues===null||this.tracks===null)return;var s=(i=this.tracks[r])==null?void 0:i.buffer;s!=null&&s.updating||this.shiftAndExecuteNext(r)}}}},o.shiftAndExecuteNext=function(r){this.queues!==null&&(this.queues[r].shift(),this.executeNext(r))},o.current=function(r){var e;return((e=this.queues)==null?void 0:e[r][0])||null},o.toString=function(){var r=this.queues,e=this.tracks;return r===null||e===null?"<destroyed>":`
`+this.list("video")+`
`+this.list("audio")+`
`+this.list("audiovideo")+"}"},o.list=function(r){var e,t;return(e=this.queues)!=null&&e[r]||(t=this.tracks)!=null&&t[r]?r+": ("+this.listSbInfo(r)+") "+this.listOps(r):""},o.listSbInfo=function(r){var e,t=(e=this.tracks)==null?void 0:e[r],i=t?.buffer;return i?"SourceBuffer"+(i.updating?" updating":"")+(t.ended?" ended":"")+(t.ending?" ending":""):"none"},o.listOps=function(r){var e;return((e=this.queues)==null?void 0:e[r].map(function(t){return t.label}).join(", "))||""},a})(),$o=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Jo="HlsJsTrackRemovedError",ld=(function(a){function o(n){var r;return r=a.call(this,n)||this,r.name=Jo,r}return se(o,a),o})(ze(Error)),ud=(function(a){function o(r,e){var t;return t=a.call(this,"buffer-controller",r.logger)||this,t.hls=void 0,t.fragmentTracker=void 0,t.details=null,t._objectUrl=null,t.operationQueue=null,t.bufferCodecEventsTotal=0,t.media=null,t.mediaSource=null,t.lastMpegAudioChunk=null,t.blockedAudioAppend=null,t.lastVideoAppendEnd=0,t.appendSource=void 0,t.transferData=void 0,t.overrides=void 0,t.appendErrors={audio:0,video:0,audiovideo:0},t.tracks={},t.sourceBuffers=[[null,null],[null,null]],t._onEndStreaming=function(i){var s;t.hls&&((s=t.mediaSource)==null?void 0:s.readyState)==="open"&&t.hls.pauseBuffering()},t._onStartStreaming=function(i){t.hls&&t.hls.resumeBuffering()},t._onMediaSourceOpen=function(i){var s=t,l=s.media,u=s.mediaSource;i&&t.log("Media source opened"),!(!l||!u)&&(u.removeEventListener("sourceopen",t._onMediaSourceOpen),l.removeEventListener("emptied",t._onMediaEmptied),t.updateDuration(),t.hls.trigger(y.MEDIA_ATTACHED,{media:l,mediaSource:u}),t.mediaSource!==null&&t.checkPendingTracks())},t._onMediaSourceClose=function(){t.log("Media source closed")},t._onMediaSourceEnded=function(){t.log("Media source ended")},t._onMediaEmptied=function(){var i=t,s=i.mediaSrc,l=i._objectUrl;s!==l&&t.error("Media element src was set while attaching MediaSource ("+l+" > "+s+")")},t.hls=r,t.fragmentTracker=e,t.appendSource=Ne(Ie(r.config.preferManagedMediaSource)),t.initTracks(),t.registerListeners(),t}se(o,a);var n=o.prototype;return n.hasSourceTypes=function(){return Object.keys(this.tracks).length>0},n.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null},n.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_APPENDING,this.onBufferAppending,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.BUFFER_EOS,this.onBufferEos,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.FRAG_PARSED,this.onFragParsed,this),e.on(y.FRAG_CHANGED,this.onFragChanged,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_APPENDING,this.onBufferAppending,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_EOS,this.onBufferEos,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.FRAG_PARSED,this.onFragParsed,this),e.off(y.FRAG_CHANGED,this.onFragChanged,this),e.off(y.ERROR,this.onError,this)},n.transferMedia=function(){var e=this,t=this.media,i=this.mediaSource;if(!t)return null;var s={};if(this.operationQueue){var l=this.isUpdating();l||this.operationQueue.removeBlockers();var u=this.isQueued();(l||u)&&this.warn("Transfering MediaSource with"+(u?" operations in queue":"")+(l?" updating SourceBuffer(s)":"")+" "+this.operationQueue),this.operationQueue.destroy()}var f=this.transferData;return!this.sourceBufferCount&&f&&f.mediaSource===i?ae(s,f.tracks):this.sourceBuffers.forEach(function(d){var h=d[0];h&&(s[h]=ae({},e.tracks[h]),e.removeBuffer(h)),d[0]=d[1]=null}),{media:t,mediaSource:i,tracks:s}},n.initTracks=function(){var e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0},n.onManifestLoading=function(){this.bufferCodecEventsTotal=0,this.details=null},n.onManifestParsed=function(e,t){var i,s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(s+" bufferCodec event(s) expected."),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()},n.onMediaAttaching=function(e,t){var i=this.media=t.media;this.transferData=this.overrides=void 0;var s=Ie(this.appendSource);if(s){var l=!!t.mediaSource;(l||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);var u=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(u),l)this._objectUrl=i.src,this.attachTransferred();else{var f=this._objectUrl=self.URL.createObjectURL(u);if(this.appendSource)try{i.removeAttribute("src");var d=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||d&&u instanceof d,Zo(i),fd(i,f),i.load()}catch{i.src=f}else i.src=f}i.addEventListener("emptied",this._onMediaEmptied)}},n.assignMediaSource=function(e){var t,i;this.log((((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created")+" media source: "+((i=e.constructor)==null?void 0:i.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))},n.attachTransferred=function(){var e=this,t=this.media,i=this.transferData;if(!(!i||!t)){var s=this.tracks,l=i.tracks,u=l?Object.keys(l):null,f=u?u.length:0,d=function(){Promise.resolve().then(function(){e.media&&e.mediaSourceOpenOrEnded&&e._onMediaSourceOpen()})};if(l&&u&&f){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log("attachTransferred: (bufferCodecEventsTotal "+this.bufferCodecEventsTotal+`)
required tracks: `+He(s,function(g,m){return g==="initSegment"?void 0:m})+`;
transfer tracks: `+He(l,function(g,m){return g==="initSegment"?void 0:m})+"}"),!ot(l,s)){i.mediaSource=null,i.tracks=void 0;var h=t.currentTime,c=this.details,v=Math.max(h,c?.fragments[0].start||0);if(v-h>1){this.log("attachTransferred: waiting for playback to reach new tracks start time "+h+" -> "+v);return}this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'+Object.keys(l)+'"->"'+Object.keys(s)+'") start time: '+v+" currentTime: "+h),this.onMediaDetaching(y.MEDIA_DETACHING,{}),this.onMediaAttaching(y.MEDIA_ATTACHING,i),t.currentTime=v;return}this.transferData=void 0,u.forEach(function(g){var m=g,p=l[m];if(p){var E=p.buffer;if(E){var S=e.fragmentTracker,T=p.id;if(S.hasFragments(T)||S.hasParts(T)){var A=Se.getBuffered(E);S.detectEvictedFragments(m,A,T,null,!0)}var x=Ga(m),b=[m,E];e.sourceBuffers[x]=b,E.updating&&e.operationQueue&&e.operationQueue.prependBlocker(m),e.trackSourceBuffer(m,p)}}}),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}},n.onMediaDetaching=function(e,t){var i=this,s=!!t.transferMedia;this.transferData=this.overrides=void 0;var l=this.media,u=this.mediaSource,f=this._objectUrl;if(u){if(this.log("media source "+(s?"transferring":"detaching")),s)this.sourceBuffers.forEach(function(v){var g=v[0];g&&i.removeBuffer(g)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){var d=u.readyState==="open";try{for(var h=u.sourceBuffers,c=h.length;c--;)d&&h[c].abort(),u.removeSourceBuffer(h[c]);d&&u.endOfStream()}catch(v){this.warn("onMediaDetaching: "+v.message+" while calling endOfStream")}}this.sourceBufferCount&&this.onBufferReset()}u.removeEventListener("sourceopen",this._onMediaSourceOpen),u.removeEventListener("sourceended",this._onMediaSourceEnded),u.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(u.removeEventListener("startstreaming",this._onStartStreaming),u.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}l&&(l.removeEventListener("emptied",this._onMediaEmptied),s||(f&&self.URL.revokeObjectURL(f),this.mediaSrc===f?(l.removeAttribute("src"),this.appendSource&&Zo(l),l.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(y.MEDIA_DETACHED,t)},n.onBufferReset=function(){var e=this;this.sourceBuffers.forEach(function(t){var i=t[0];i&&e.resetBuffer(i)}),this.initTracks()},n.resetBuffer=function(e){var t,i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(l){this.warn("onBufferReset "+e,l)}delete this.tracks[e]},n.removeBuffer=function(e){this.removeBufferListeners(e),this.sourceBuffers[Ga(e)]=[null,null];var t=this.tracks[e];t&&(t.buffer=void 0)},n.resetQueue=function(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new od(this.tracks)},n.onBufferCodecs=function(e,t){var i=this,s=this.tracks,l=Object.keys(t);this.log('BUFFER_CODECS: "'+l+'" (current SB count '+this.sourceBufferCount+")");var u="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),f=!u&&this.sourceBufferCount&&this.media&&l.some(function(d){return!s[d]});if(u||f){this.warn('Unsupported transition between "'+Object.keys(s)+'" and "'+l+'" SourceBuffers');return}l.forEach(function(d){var h,c,v=t[d],g=v.id,m=v.codec,p=v.levelCodec,E=v.container,S=v.metadata,T=v.supplemental,A=s[d],x=(h=i.transferData)==null||(h=h.tracks)==null?void 0:h[d],b=x!=null&&x.buffer?x:A,D=b?.pendingCodec||b?.codec,k=b?.levelCodec;A||(A=s[d]={buffer:void 0,listeners:[],codec:m,supplemental:T,container:E,levelCodec:p,metadata:S,id:g});var R=nr(D,k),L=R?.replace($o,"$1"),I=nr(m,p),P=(c=I)==null?void 0:c.replace($o,"$1");I&&R&&L!==P&&(d.slice(0,5)==="audio"&&(I=Xt(I,i.appendSource)),i.log("switching codec "+D+" to "+I),I!==(A.pendingCodec||A.codec)&&(A.pendingCodec=I),A.container=E,i.appendChangeType(d,E,I))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()},n.appendChangeType=function(e,t,i){var s=this,l=t+";codecs="+i,u={label:"change-type="+l,execute:function(){var d=s.tracks[e];if(d){var h=d.buffer;h!=null&&h.changeType&&(s.log("changing "+e+" sourceBuffer type to "+l),h.changeType(l),d.codec=i,d.container=t)}s.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(d){s.warn("Failed to change "+e+" SourceBuffer type",d)}};this.append(u,e,this.isPending(this.tracks[e]))},n.blockAudio=function(e){var t,i=this,s=e.start,l=s+e.duration*.05,u=((t=this.fragmentTracker.getAppendedFrag(s,F.MAIN))==null?void 0:t.gap)===!0;if(!u){var f={label:"block-audio",execute:function(){var h,c=i.tracks.video;(i.lastVideoAppendEnd>l||c!=null&&c.buffer&&Se.isBuffered(c.buffer,l)||((h=i.fragmentTracker.getAppendedFrag(l,F.MAIN))==null?void 0:h.gap)===!0)&&(i.blockedAudioAppend=null,i.shiftAndExecuteNext("audio"))},onStart:function(){},onComplete:function(){},onError:function(h){i.warn("Error executing block-audio operation",h)}};this.blockedAudioAppend={op:f,frag:e},this.append(f,"audio",!0)}},n.unblockAudio=function(){var e=this.blockedAudioAppend,t=this.operationQueue;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))},n.onBufferAppending=function(e,t){var i=this,s=this.tracks,l=t.data,u=t.type,f=t.parent,d=t.frag,h=t.part,c=t.chunkMeta,v=t.offset,g=c.buffering[u],m=d.sn,p=d.cc,E=self.performance.now();g.start=E;var S=d.stats.buffering,T=h?h.stats.buffering:null;S.start===0&&(S.start=E),T&&T.start===0&&(T.start=E);var A=s.audio,x=!1;u==="audio"&&A?.container==="audio/mpeg"&&(x=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var b=s.video,D=b?.buffer;if(D&&m!=="initSegment"){var k=h||d,R=this.blockedAudioAppend;if(u==="audio"&&f!=="main"&&!this.blockedAudioAppend&&!(b.ending||b.ended)){var L=k.start,I=L+k.duration*.05,P=D.buffered,U=this.currentOp("video");!P.length&&!U?this.blockAudio(k):!U&&!Se.isBuffered(D,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(k)}else if(u==="video"){var w=k.end;if(R){var O=R.frag.start;(w>O||w<this.lastVideoAppendEnd||Se.isBuffered(D,O))&&this.unblockAudio()}this.lastVideoAppendEnd=w}}var K=(h||d).start,z={label:"append-"+u,execute:function(){var Q;g.executeStart=self.performance.now();var ge=(Q=i.tracks[u])==null?void 0:Q.buffer;ge&&(x?i.updateTimestampOffset(ge,K,.1,u,m,p):v!==void 0&&H(v)&&i.updateTimestampOffset(ge,v,1e-6,u,m,p)),i.appendExecutor(l,u)},onStart:function(){},onComplete:function(){var Q=self.performance.now();g.executeEnd=g.end=Q,S.first===0&&(S.first=Q),T&&T.first===0&&(T.first=Q);var ge={};i.sourceBuffers.forEach(function($){var J=$[0],re=$[1];J&&(ge[J]=Se.getBuffered(re))}),i.appendErrors[u]=0,u==="audio"||u==="video"?i.appendErrors.audiovideo=0:(i.appendErrors.audio=0,i.appendErrors.video=0),i.hls.trigger(y.BUFFER_APPENDED,{type:u,frag:d,part:h,chunkMeta:c,parent:d.type,timeRanges:ge})},onError:function(Q){var ge,$={type:W.MEDIA_ERROR,parent:d.type,details:_.BUFFER_APPEND_ERROR,sourceBufferName:u,frag:d,part:h,chunkMeta:c,error:Q,err:Q,fatal:!1},J=(ge=i.media)==null?void 0:ge.error;if(Q.code===DOMException.QUOTA_EXCEEDED_ERR||Q.name=="QuotaExceededError"||"quota"in Q)$.details=_.BUFFER_FULL_ERROR;else if(Q.code===DOMException.INVALID_STATE_ERR&&i.mediaSourceOpenOrEnded&&!J)$.errorAction=di(!0);else if(Q.name===Jo&&i.sourceBufferCount===0)$.errorAction=di(!0);else{var re=++i.appendErrors[u];i.warn("Failed "+re+"/"+i.hls.config.appendErrorMaxRetry+' times to append segment in "'+u+'" sourceBuffer ('+(J||"no media error")+")"),(re>=i.hls.config.appendErrorMaxRetry||J)&&($.fatal=!0)}i.hls.trigger(y.ERROR,$)}};this.append(z,u,this.isPending(this.tracks[u]))},n.getFlushOp=function(e,t,i){var s=this;return this.log('queuing "'+e+'" remove '+t+"-"+i),{label:"remove",execute:function(){s.removeExecutor(e,t,i)},onStart:function(){},onComplete:function(){s.hls.trigger(y.BUFFER_FLUSHED,{type:e})},onError:function(u){s.warn("Failed to remove "+t+"-"+i+' from "'+e+'" SourceBuffer',u)}}},n.onBufferFlushing=function(e,t){var i=this,s=t.type,l=t.startOffset,u=t.endOffset;s?this.append(this.getFlushOp(s,l,u),s):this.sourceBuffers.forEach(function(f){var d=f[0];d&&i.append(i.getFlushOp(d,l,u),d)})},n.onFragParsed=function(e,t){var i=this,s=t.frag,l=t.part,u=[],f=l?l.elementaryStreams:s.elementaryStreams;f[le.AUDIOVIDEO]?u.push("audiovideo"):(f[le.AUDIO]&&u.push("audio"),f[le.VIDEO]&&u.push("video"));var d=function(){var c=self.performance.now();s.stats.buffering.end=c,l&&(l.stats.buffering.end=c);var v=l?l.stats:s.stats;i.hls.trigger(y.FRAG_BUFFERED,{frag:s,part:l,stats:v,id:s.type})};u.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+s.type+" level: "+s.level+" sn: "+s.sn),this.blockBuffers(d,u).catch(function(h){i.warn("Fragment buffered callback "+h),i.stepOperationQueue(i.sourceBufferTypes)})},n.onFragChanged=function(e,t){this.trimBuffers()},n.onBufferEos=function(e,t){var i=this,s;this.sourceBuffers.forEach(function(f){var d=f[0];if(d){var h=i.tracks[d];(!t.type||t.type===d)&&(h.ending=!0,h.ended||(h.ended=!0,i.log(d+" buffer reached EOS")))}});var l=((s=this.overrides)==null?void 0:s.endOfStream)!==!1,u=this.sourceBufferCount>0&&!this.sourceBuffers.some(function(f){var d,h=f[0];return h&&!((d=i.tracks[h])!=null&&d.ended)});u?l?(this.log("Queueing EOS"),this.blockUntilOpen(function(){i.tracksEnded();var f=i.mediaSource;if(!f||f.readyState!=="open"){f&&i.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+f.readyState);return}i.log("Calling mediaSource.endOfStream()"),f.endOfStream(),i.hls.trigger(y.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(y.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()},n.tracksEnded=function(){var e=this;this.sourceBuffers.forEach(function(t){var i=t[0];if(i!==null){var s=e.tracks[i];s&&(s.ending=!1)}})},n.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.updateDuration())},n.updateDuration=function(){var e=this;this.blockUntilOpen(function(){var t=e.getDurationAndRange();t&&e.updateMediaSource(t)})},n.onError=function(e,t){if(t.details===_.BUFFER_APPEND_ERROR&&t.frag){var i,s=(i=t.errorAction)==null?void 0:i.nextAutoLevel;H(s)&&s!==t.frag.level&&this.resetAppendErrors()}},n.resetAppendErrors=function(){this.appendErrors={audio:0,video:0,audiovideo:0}},n.trimBuffers=function(){var e=this.hls,t=this.details,i=this.media;if(!(!i||t===null)&&this.sourceBufferCount){var s=e.config,l=i.currentTime,u=t.levelTargetDuration,f=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(H(f)&&f>=0){var d=Math.max(f,u),h=Math.floor(l/u)*u-d;this.flushBackBuffer(l,u,h)}var c=s.frontBufferFlushThreshold;if(H(c)&&c>0){var v=Math.max(s.maxBufferLength,c),g=Math.max(v,u),m=Math.floor(l/u)*u+g;this.flushFrontBuffer(l,u,m)}}},n.flushBackBuffer=function(e,t,i){var s=this;this.sourceBuffers.forEach(function(l){var u=l[0],f=l[1];if(f){var d=Se.getBuffered(f);if(d.length>0&&i>d.start(0)){var h;s.hls.trigger(y.BACK_BUFFER_REACHED,{bufferEnd:i});var c=s.tracks[u];if((h=s.details)!=null&&h.live)s.hls.trigger(y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(c!=null&&c.ended){s.log("Cannot flush "+u+" back buffer while SourceBuffer is in ended state");return}s.hls.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:u})}}})},n.flushFrontBuffer=function(e,t,i){var s=this;this.sourceBuffers.forEach(function(l){var u=l[0],f=l[1];if(f){var d=Se.getBuffered(f),h=d.length;if(h<2)return;var c=d.start(h-1),v=d.end(h-1);if(i>c||e>=c&&e<=v)return;s.hls.trigger(y.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:u})}})},n.getDurationAndRange=function(){var e,t=this.details,i=this.mediaSource;if(!t||!this.media||i?.readyState!=="open")return null;var s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){var l=t.fragments.length;if(l&&i.setLiveSeekableRange){var u=Math.max(0,t.fragmentStart),f=Math.max(u,s);return{duration:1/0,start:u,end:f}}return{duration:1/0}}var d=(e=this.overrides)==null?void 0:e.duration;if(d)return H(d)?{duration:d}:null;var h=this.media.duration,c=H(i.duration)?i.duration:0;return s>c&&s>h||!H(h)?{duration:s}:null},n.updateMediaSource=function(e){var t=e.duration,i=e.start,s=e.end,l=this.mediaSource;!this.media||!l||l.readyState!=="open"||(l.duration!==t&&(H(t)&&this.log("Updating MediaSource duration to "+t.toFixed(3)),l.duration=t),i!==void 0&&s!==void 0&&(this.log("MediaSource duration is set to "+l.duration+". Setting seekable range to "+i+"-"+s+"."),l.setLiveSeekableRange(i,s)))},n.checkPendingTracks=function(){var e=this.bufferCodecEventsTotal,t=this.pendingTrackCount,i=this.tracks;if(this.log("checkPendingTracks (pending: "+t+" codec events expected: "+e+") "+He(i)),this.tracksReady){var s,l=(s=this.transferData)==null?void 0:s.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}},n.bufferCreated=function(){var e=this;if(this.sourceBufferCount){var t={};this.sourceBuffers.forEach(function(s){var l=s[0],u=s[1];if(l){var f=e.tracks[l];t[l]={buffer:u,container:f.container,codec:f.codec,supplemental:f.supplemental,levelCodec:f.levelCodec,id:f.id,metadata:f.metadata}}}),this.hls.trigger(y.BUFFER_CREATED,{tracks:t}),this.log("SourceBuffers created. Running queue: "+this.operationQueue),this.sourceBuffers.forEach(function(s){var l=s[0];e.executeNext(l)})}else{var i=new Error("could not create source buffer for media codec(s)");this.hls.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:i,reason:i.message})}},n.createSourceBuffers=function(){var e=this.tracks,t=this.sourceBuffers,i=this.mediaSource;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(var s in e){var l=s,u=e[l];if(this.isPending(u)){var f=this.getTrackCodec(u,l),d=u.container+";codecs="+f;u.codec=f,this.log("creating sourceBuffer("+d+")"+(this.currentOp(l)?" Queued":"")+" "+He(u));try{var h=i.addSourceBuffer(d),c=Ga(l),v=[l,h];t[c]=v,u.buffer=h}catch(m){var g;this.error("error while trying to add sourceBuffer: "+m.message),this.shiftAndExecuteNext(l),(g=this.operationQueue)==null||g.removeBlockers(),delete this.tracks[l],this.hls.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:l,mimeType:d,parent:u.id});return}this.trackSourceBuffer(l,u)}}this.bufferCreated()},n.getTrackCodec=function(e,t){var i=e.supplemental,s=e.codec;i&&(t==="video"||t==="audiovideo")&&oi(i,"video")&&(s=kr(s,i));var l=nr(s,e.levelCodec);return l?t.slice(0,5)==="audio"?Xt(l,this.appendSource):l:""},n.trackSourceBuffer=function(e,t){var i=this,s=t.buffer;if(s){var l=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:l,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",function(u,f){var d=f.removedRanges;d!=null&&d.length&&i.hls.trigger(y.BUFFER_FLUSHED,{type:u})})}},n.onSBUpdateStart=function(e){var t=this.currentOp(e);t&&t.onStart()},n.onSBUpdateEnd=function(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}var i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))},n.onSBUpdateError=function(e,t){var i,s=new Error(e+" SourceBuffer error. MediaSource readyState: "+((i=this.mediaSource)==null?void 0:i.readyState));this.error(""+s,t),this.hls.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});var l=this.currentOp(e);l&&l.onError(s)},n.updateTimestampOffset=function(e,t,i,s,l,u){var f=t-e.timestampOffset;Math.abs(f)>=i&&(this.log("Updating "+s+" SourceBuffer timestampOffset to "+t+" (sn: "+l+" cc: "+u+")"),e.timestampOffset=t)},n.removeExecutor=function(e,t,i){var s=this.media,l=this.mediaSource,u=this.tracks[e],f=u?.buffer;if(!s||!l||!f){this.warn("Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),this.shiftAndExecuteNext(e);return}var d=H(s.duration)?s.duration:1/0,h=H(l.duration)?l.duration:1/0,c=Math.max(0,t),v=Math.min(i,d,h);v>c&&(!u.ending||u.ended)?(u.ended=!1,this.log("Removing ["+c+","+v+"] from the "+e+" SourceBuffer"),f.remove(c,v)):this.shiftAndExecuteNext(e)},n.appendExecutor=function(e,t){var i=this.tracks[t],s=i?.buffer;if(!s)throw new ld("Attempting to append to the "+t+" SourceBuffer, but it does not exist");i.ending=!1,i.ended=!1,s.appendBuffer(e)},n.blockUntilOpen=function(e){var t=this;if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(function(i){t.warn("SourceBuffer blocked callback "+i),t.stepOperationQueue(t.sourceBufferTypes)});else try{e()}catch(i){this.warn("Callback run without blocking "+this.operationQueue+" "+i)}},n.isUpdating=function(){return this.sourceBuffers.some(function(e){var t=e[0],i=e[1];return t&&i.updating})},n.isQueued=function(){var e=this;return this.sourceBuffers.some(function(t){var i=t[0];return i&&!!e.currentOp(i)})},n.isPending=function(e){return!!e&&!e.buffer},n.blockBuffers=function(e,t){var i=this;if(t===void 0&&(t=this.sourceBufferTypes),!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);var s=this.operationQueue,l=t.map(function(f){return i.appendBlocker(f)}),u=t.length>1&&!!this.blockedAudioAppend;return u&&this.unblockAudio(),Promise.all(l).then(function(f){s===i.operationQueue&&(e(),i.stepOperationQueue(i.sourceBufferTypes))})},n.stepOperationQueue=function(e){var t=this;e.forEach(function(i){var s,l=(s=t.tracks[i])==null?void 0:s.buffer;!l||l.updating||t.shiftAndExecuteNext(i)})},n.append=function(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)},n.appendBlocker=function(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)},n.currentOp=function(e){return this.operationQueue?this.operationQueue.current(e):null},n.executeNext=function(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)},n.shiftAndExecuteNext=function(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)},n.addBufferListener=function(e,t,i){var s=this.tracks[e];if(s){var l=s.buffer;if(l){var u=i.bind(this,e);s.listeners.push({event:t,listener:u}),l.addEventListener(t,u)}}},n.removeBufferListeners=function(e){var t=this.tracks[e];if(t){var i=t.buffer;i&&(t.listeners.forEach(function(s){i.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}},Y(o,[{key:"mediaSourceOpenOrEnded",get:function(){var e,t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}},{key:"sourceBufferTracks",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(t,i){var s=e.tracks[i];return t[i]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},t},{})}},{key:"bufferedToEnd",get:function(){var e=this;return this.sourceBufferCount>0&&!this.sourceBuffers.some(function(t){var i=t[0];if(i){var s=e.tracks[i];if(s)return!s.ended||s.ending}return!1})}},{key:"tracksReady",get:function(){var e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}},{key:"mediaSrc",get:function(){var e,t,i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}},{key:"pendingTrackCount",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(t,i){return t+(e.isPending(e.tracks[i])?1:0)},0)}},{key:"sourceBufferCount",get:function(){return this.sourceBuffers.reduce(function(e,t){var i=t[0];return e+(i?1:0)},0)}},{key:"sourceBufferTypes",get:function(){return this.sourceBuffers.map(function(e){var t=e[0];return t}).filter(function(e){return!!e})}}])})(te);function Zo(a){var o=a.querySelectorAll("source");[].slice.call(o).forEach(function(n){a.removeChild(n)})}function fd(a,o){var n=self.document.createElement("source");n.type="video/mp4",n.src=o,a.appendChild(n)}function Ga(a){return a==="audio"?1:0}var dd=(function(){function a(n){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=n,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var o=a.prototype;return o.setStreamController=function(r){this.streamController=r},o.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},o.registerListeners=function(){var r=this.hls;r.on(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(y.MANIFEST_PARSED,this.onManifestParsed,this),r.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(y.BUFFER_CODECS,this.onBufferCodecs,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)},o.unregisterListener=function(){var r=this.hls;r.off(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(y.MANIFEST_PARSED,this.onManifestParsed,this),r.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(y.BUFFER_CODECS,this.onBufferCodecs,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)},o.onFpsDropLevelCapping=function(r,e){var t=this.hls.levels[e.droppedLevel];this.isLevelAllowed(t)&&this.restrictedLevels.push({bitrate:t.bitrate,height:t.height,width:t.width})},o.onMediaAttaching=function(r,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},o.onManifestParsed=function(r,e){var t=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onLevelsUpdated=function(r,e){this.timer&&H(this.autoLevelCapping)&&this.detectPlayerSize()},o.onBufferCodecs=function(r,e){var t=this.hls;t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onMediaDetaching=function(){this.stopCapping(),this.media=null},o.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}var r=this.hls.levels;if(r.length){var e=this.hls,t=this.getMaxLevel(r.length-1);t!==this.autoLevelCapping&&e.logger.log("Setting autoLevelCapping to "+t+": "+r[t].height+"p@"+r[t].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),e.autoLevelCapping=t,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},o.getMaxLevel=function(r){var e=this,t=this.hls.levels;if(!t.length)return-1;var i=t.filter(function(s,l){return e.isLevelAllowed(s)&&l<=r});return this.clientRect=null,a.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},o.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},o.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},o.getDimensions=function(){if(this.clientRect)return this.clientRect;var r=this.media,e={width:0,height:0};if(r){var t=r.getBoundingClientRect();e.width=t.width,e.height=t.height,!e.width&&!e.height&&(e.width=t.right-t.left||r.width||0,e.height=t.bottom-t.top||r.height||0)}return this.clientRect=e,e},o.isLevelAllowed=function(r){var e=this.restrictedLevels;return!e.some(function(t){return r.bitrate===t.bitrate&&r.width===t.width&&r.height===t.height})},a.getMaxLevelByMediaSize=function(r,e,t){if(!(r!=null&&r.length))return-1;for(var i=function(h,c){return c?h.width!==c.width||h.height!==c.height:!0},s=r.length-1,l=Math.max(e,t),u=0;u<r.length;u+=1){var f=r[u];if((f.width>=l||f.height>=l)&&i(f,r[u+1])){s=u;break}}return s},Y(a,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var r=1;if(!this.hls.config.ignoreDevicePixelRatio)try{r=self.devicePixelRatio}catch{}return Math.min(r,this.hls.config.maxDevicePixelRatio)}}])})(),hd={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Wt=hd,cd={HLS:"h"},vd=cd,qr=function a(o,n){Array.isArray(o)&&(o=o.map(function(r){return r instanceof a?r:new a(r)})),this.value=o,this.params=n},gd="Dict";function md(a){return Array.isArray(a)?JSON.stringify(a):a instanceof Map?"Map{}":a instanceof Set?"Set{}":typeof a=="object"?JSON.stringify(a):String(a)}function pd(a,o,n,r){return new Error("failed to "+a+' "'+md(o)+'" as '+n,{cause:r})}function vr(a,o,n){return pd("serialize",a,o,n)}var el=function(o){this.description=o},tl="Bare Item",yd="Boolean";function Ed(a){if(typeof a!="boolean")throw vr(a,yd);return a?"?1":"?0"}function Td(a){return btoa(String.fromCharCode.apply(String,a))}var Sd="Byte Sequence";function Ad(a){if(ArrayBuffer.isView(a)===!1)throw vr(a,Sd);return":"+Td(a)+":"}var xd="Integer";function Ld(a){return a<-999999999999999||999999999999999<a}function rl(a){if(Ld(a))throw vr(a,xd);return a.toString()}function Id(a){return"@"+rl(a.getTime()/1e3)}function il(a,o){if(a<0)return-il(-a,o);var n=Math.pow(10,o),r=Math.abs(a*n%1-.5)<Number.EPSILON;if(r){var e=Math.floor(a*n);return(e%2===0?e:e+1)/n}else return Math.round(a*n)/n}var bd="Decimal";function Rd(a){var o=il(a,3);if(Math.floor(Math.abs(o)).toString().length>12)throw vr(a,bd);var n=o.toString();return n.includes(".")?n:n+".0"}var _d="String",Dd=/[\x00-\x1f\x7f]+/;function kd(a){if(Dd.test(a))throw vr(a,_d);return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Pd(a){return a.description||a.toString().slice(7,-1)}var Cd="Token";function nl(a){var o=Pd(a);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(o)===!1)throw vr(o,Cd);return o}function Ka(a){switch(typeof a){case"number":if(!H(a))throw vr(a,tl);return Number.isInteger(a)?rl(a):Rd(a);case"string":return kd(a);case"symbol":return nl(a);case"boolean":return Ed(a);case"object":if(a instanceof Date)return Id(a);if(a instanceof Uint8Array)return Ad(a);if(a instanceof el)return nl(a);default:throw vr(a,tl)}}var wd="Key";function Va(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw vr(a,wd);return a}function Ha(a){return a==null?"":Object.entries(a).map(function(o){var n=o[0],r=o[1];return r===!0?";"+Va(n):";"+Va(n)+"="+Ka(r)}).join("")}function al(a){return a instanceof qr?""+Ka(a.value)+Ha(a.params):Ka(a)}function Md(a){return"("+a.value.map(al).join(" ")+")"+Ha(a.params)}function Od(a,o){if(o===void 0&&(o={whitespace:!0}),typeof a!="object"||a==null)throw vr(a,gd);var n=a instanceof Map?a.entries():Object.entries(a),r=o?.whitespace?" ":"";return Array.from(n).map(function(e){var t=e[0],i=e[1];i instanceof qr||(i=new qr(i));var s=Va(t);return i.value===!0?s+=Ha(i.params):(s+="=",Array.isArray(i.value)?s+=Md(i):s+=al(i)),s}).join(","+r)}function sl(a,o){return Od(a,o)}var gr="CMCD-Object",Je="CMCD-Request",jr="CMCD-Session",Mr="CMCD-Status",Fd={br:gr,ab:gr,d:gr,ot:gr,tb:gr,tpb:gr,lb:gr,tab:gr,lab:gr,url:gr,pb:Je,bl:Je,tbl:Je,dl:Je,ltc:Je,mtp:Je,nor:Je,nrr:Je,rc:Je,sn:Je,sta:Je,su:Je,ttfb:Je,ttfbb:Je,ttlb:Je,cmsdd:Je,cmsds:Je,smrt:Je,df:Je,cs:Je,ts:Je,cid:jr,pr:jr,sf:jr,sid:jr,st:jr,v:jr,msd:jr,bs:Mr,bsd:Mr,cdn:Mr,rtp:Mr,bg:Mr,pt:Mr,ec:Mr,e:Mr},Nd={REQUEST:Je};function Ud(a){return Object.keys(a).reduce(function(o,n){var r;return(r=a[n])===null||r===void 0||r.forEach(function(e){return o[e]=n}),o},{})}function Bd(a,o){var n={};if(!a)return n;var r=Object.keys(a),e=o?Ud(o):{};return r.reduce(function(t,i){var s,l=Fd[i]||e[i]||Nd.REQUEST,u=(s=t[l])!==null&&s!==void 0?s:t[l]={};return u[i]=a[i],t},n)}function Gd(a){return["ot","sf","st","e","sta"].includes(a)}function Kd(a){return typeof a=="number"?H(a):a!=null&&a!==""&&a!==!1}var ol="event";function Vd(a,o){var n=new URL(a),r=new URL(o);if(n.origin!==r.origin)return a;for(var e=n.pathname.split("/").slice(1),t=r.pathname.split("/").slice(1,-1);e[0]===t[0];)e.shift(),t.shift();for(;t.length;)t.shift(),e.unshift("..");var i=e.join("/");return i+n.search+n.hash}var Ln=function(o){return Math.round(o)},Ya=function(o,n){return Array.isArray(o)?o.map(function(r){return Ya(r,n)}):o instanceof qr&&typeof o.value=="string"?new qr(Ya(o.value,n),o.params):(n.baseUrl&&(o=Vd(o,n.baseUrl)),n.version===1?encodeURIComponent(o):o)},In=function(o){return Ln(o/100)*100},Hd=function(o,n){var r=o;return n.version>=2&&(o instanceof qr&&typeof o.value=="string"?r=new qr([o]):typeof o=="string"&&(r=[o])),Ya(r,n)},Yd={br:Ln,d:Ln,bl:In,dl:In,mtp:In,nor:Hd,rtp:In,tb:Ln},ll="request",ul="response",Wa=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Wd=["e"],qd=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function bn(a){return qd.test(a)}function jd(a){return Wa.includes(a)||Wd.includes(a)||bn(a)}var fl=["d","dl","nor","ot","rtp","su"];function Xd(a){return Wa.includes(a)||fl.includes(a)||bn(a)}var zd=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function Qd(a){return Wa.includes(a)||fl.includes(a)||zd.includes(a)||bn(a)}var $d=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Jd(a){return $d.includes(a)||bn(a)}var Vi,Zd=(Vi={},Vi[ul]=Qd,Vi[ol]=jd,Vi[ll]=Xd,Vi);function dl(a,o){o===void 0&&(o={});var n={};if(a==null||typeof a!="object")return n;var r=o.version||a.v||1,e=o.reportingMode||ll,t=r===1?Jd:Zd[e],i=Object.keys(a).filter(t),s=o.filter;typeof s=="function"&&(i=i.filter(s));var l=e===ul||e===ol;l&&!i.includes("ts")&&i.push("ts"),r>1&&!i.includes("v")&&i.push("v");var u=ae({},Yd,o.formatters),f={version:r,reportingMode:e,baseUrl:o.baseUrl};return i.sort().forEach(function(d){var h=a[d],c=u[d];if(typeof c=="function"&&(h=c(h,f)),d==="v"){if(r===1)return;h=r}d=="pr"&&h===1||(l&&d==="ts"&&!H(h)&&(h=Date.now()),Kd(h)&&(Gd(d)&&typeof h=="string"&&(h=new el(h)),n[d]=h))}),n}function eh(a,o){o===void 0&&(o={});var n={};if(!a)return n;var r=dl(a,o),e=Bd(r,o?.customHeaderMap);return Object.entries(e).reduce(function(t,i){var s=i[0],l=i[1],u=sl(l,{whitespace:!1});return u&&(t[s]=u),t},n)}function th(a,o,n){return ae(a,eh(o,n))}var rh="CMCD";function ih(a,o){return o===void 0&&(o={}),a?sl(dl(a,o),{whitespace:!1}):""}function nh(a,o){if(o===void 0&&(o={}),!a)return"";var n=ih(a,o);return encodeURIComponent(n)}function ah(a,o){if(o===void 0&&(o={}),!a)return"";var n=nh(a,o);return rh+"="+n}var hl=/CMCD=[^&#]+/;function sh(a,o,n){var r=ah(o,n);if(!r)return a;if(hl.test(a))return a.replace(hl,r);var e=a.includes("?")?"&":"?";return""+a+e+r}var oh=(function(){function a(n){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(i){try{r.apply(i,{ot:Wt.MANIFEST,su:!r.initialized})}catch(s){r.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=function(i){try{var s=i.frag,l=i.part,u=r.hls.levels[s.level],f=r.getObjectType(s),d={d:(l||s).duration*1e3,ot:f};(f===Wt.VIDEO||f===Wt.AUDIO||f==Wt.MUXED)&&(d.br=u.bitrate/1e3,d.tb=r.getTopBandwidth(f)/1e3,d.bl=r.getBufferLength(f));var h=l?r.getNextPart(l):r.getNextFrag(s);h!=null&&h.url&&h.url!==s.url&&(d.nor=h.url),r.apply(i,d)}catch(c){r.hls.logger.warn("Could not generate segment CMCD data.",c)}},this.hls=n;var e=this.config=n.config,t=e.cmcd;t!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=t.sessionId||n.sessionId,this.cid=t.contentId,this.useHeaders=t.useHeaders===!0,this.includeKeys=t.includeKeys,this.registerListeners())}var o=a.prototype;return o.registerListeners=function(){var r=this.hls;r.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(y.MEDIA_DETACHED,this.onMediaDetached,this),r.on(y.BUFFER_CREATED,this.onBufferCreated,this)},o.unregisterListeners=function(){var r=this.hls;r.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(y.MEDIA_DETACHED,this.onMediaDetached,this),r.off(y.BUFFER_CREATED,this.onBufferCreated,this)},o.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null},o.onMediaAttached=function(r,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},o.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},o.onBufferCreated=function(r,e){var t,i;this.audioBuffer=(t=e.tracks.audio)==null?void 0:t.buffer,this.videoBuffer=(i=e.tracks.video)==null?void 0:i.buffer},o.createData=function(){var r;return{v:1,sf:vd.HLS,sid:this.sid,cid:this.cid,pr:(r=this.media)==null?void 0:r.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},o.apply=function(r,e){e===void 0&&(e={}),ae(e,this.createData());var t=e.ot===Wt.INIT||e.ot===Wt.VIDEO||e.ot===Wt.MUXED;this.starved&&t&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering);var i=this.includeKeys;i&&(e=Object.keys(e).reduce(function(l,u){return i.includes(u)&&(l[u]=e[u]),l},{}));var s={baseUrl:r.url};this.useHeaders?(r.headers||(r.headers={}),th(r.headers,e,s)):r.url=sh(r.url,e,s)},o.getNextFrag=function(r){var e,t=(e=this.hls.levels[r.level])==null?void 0:e.details;if(t){var i=r.sn-t.startSN;return t.fragments[i+1]}},o.getNextPart=function(r){var e,t=r.index,i=r.fragment,s=(e=this.hls.levels[i.level])==null||(e=e.details)==null?void 0:e.partList;if(s)for(var l=i.sn,u=s.length-1;u>=0;u--){var f=s[u];if(f.index===t&&f.fragment.sn===l)return s[u+1]}},o.getObjectType=function(r){var e=r.type;if(e==="subtitle")return Wt.TIMED_TEXT;if(r.sn==="initSegment")return Wt.INIT;if(e==="audio")return Wt.AUDIO;if(e==="main")return this.hls.audioTracks.length?Wt.VIDEO:Wt.MUXED},o.getTopBandwidth=function(r){var e=0,t,i=this.hls;if(r===Wt.AUDIO)t=i.audioTracks;else{var s=i.maxAutoLevel,l=s>-1?s+1:i.levels.length;t=i.levels.slice(0,l)}return t.forEach(function(u){u.bitrate>e&&(e=u.bitrate)}),e>0?e:NaN},o.getBufferLength=function(r){var e=this.media,t=r===Wt.AUDIO?this.audioBuffer:this.videoBuffer;if(!t||!e)return NaN;var i=Se.bufferInfo(t,e.currentTime,this.config.maxBufferHole);return i.len*1e3},o.createPlaylistLoader=function(){var r=this.config.pLoader,e=this.applyPlaylistData,t=r||this.config.loader;return(function(){function i(l){this.loader=void 0,this.loader=new t(l)}var s=i.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(u,f,d){e(u),this.loader.load(u,f,d)},Y(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])})()},o.createFragmentLoader=function(){var r=this.config.fLoader,e=this.applyFragmentData,t=r||this.config.loader;return(function(){function i(l){this.loader=void 0,this.loader=new t(l)}var s=i.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(u,f,d){e(u),this.loader.load(u,f,d)},Y(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])})()},a})(),lh=3e5,uh=(function(a){function o(r){var e;return e=a.call(this,"content-steering",r.logger)||this,e.hls=void 0,e.loader=null,e.uri=null,e.pathwayId=".",e._pathwayPriority=null,e.timeToLoad=300,e.reloadTimer=-1,e.updated=0,e.started=!1,e.enabled=!0,e.levels=null,e.audioTracks=null,e.subtitleTracks=null,e.penalizedPathways={},e.hls=r,e.registerListeners(),e}se(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.ERROR,this.onError,this))},n.pathways=function(){return(this.levels||[]).reduce(function(e,t){return e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e},[])},n.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}},n.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},n.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},n.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},n.removeLevel=function(e){var t=this.levels;t&&(this.levels=t.filter(function(i){return i!==e}))},n.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},n.onManifestLoaded=function(e,t){var i=t.contentSteering;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())},n.onManifestParsed=function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks},n.onError=function(e,t){var i=t.errorAction;if(i?.action===yt.SendAlternateToPenaltyBox&&i.flags===zt.MoveAllAlternatesMatchingHost){var s=this.levels,l=this._pathwayPriority,u=this.pathwayId;if(t.context){var f=t.context,d=f.groupId,h=f.pathwayId,c=f.type;d&&s?u=this.getPathwayForGroupId(d,c,u):h&&(u=h)}u in this.penalizedPathways||(this.penalizedPathways[u]=performance.now()),!l&&s&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),i.resolved=this.pathwayId!==u),t.details===_.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn("Could not resolve "+t.details+' ("'+t.error.message+'") with content-steering for Pathway: '+u+" levels: "+(s&&s.length)+" priorities: "+He(l)+" penalized: "+He(this.penalizedPathways))}},n.filterParsedLevels=function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){var i=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+i+'"'),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log("Found "+t.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),t},n.getLevelsForPathway=function(e){return this.levels===null?[]:this.levels.filter(function(t){return e===t.pathwayId})},n.updatePathwayPriority=function(e){this._pathwayPriority=e;var t,i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(function(c){s-i[c]>lh&&delete i[c]});for(var l=0;l<e.length;l++){var u=e[l];if(!(u in i)){if(u===this.pathwayId)return;var f=this.hls.nextLoadLevel,d=this.hls.levels[f];if(t=this.getLevelsForPathway(u),t.length>0){this.log('Setting Pathway to "'+u+'"'),this.pathwayId=u,po(t),this.hls.trigger(y.LEVELS_UPDATED,{levels:t});var h=this.hls.levels[f];d&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==d.bitrate&&this.log("Unstable Pathways change from bitrate "+d.bitrate+" to "+h.bitrate),this.hls.nextLoadLevel=f);break}}}},n.getPathwayForGroupId=function(e,t,i){for(var s=this.getLevelsForPathway(i).concat(this.levels||[]),l=0;l<s.length;l++)if(t===N.AUDIO_TRACK&&s[l].hasAudioGroup(e)||t===N.SUBTITLE_TRACK&&s[l].hasSubtitleGroup(e))return s[l].pathwayId;return i},n.clonePathways=function(e){var t=this,i=this.levels;if(i){var s={},l={};e.forEach(function(u){var f=u.ID,d=u["BASE-ID"],h=u["URI-REPLACEMENT"];if(!i.some(function(v){return v.pathwayId===f})){var c=t.getLevelsForPathway(d).map(function(v){var g=new et(v.attrs);g["PATHWAY-ID"]=f;var m=g.AUDIO&&g.AUDIO+"_clone_"+f,p=g.SUBTITLES&&g.SUBTITLES+"_clone_"+f;m&&(s[g.AUDIO]=m,g.AUDIO=m),p&&(l[g.SUBTITLES]=p,g.SUBTITLES=p);var E=vl(v.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),S=new wi({attrs:g,audioCodec:v.audioCodec,bitrate:v.bitrate,height:v.height,name:v.name,url:E,videoCodec:v.videoCodec,width:v.width});if(v.audioGroups)for(var T=1;T<v.audioGroups.length;T++)S.addGroupId("audio",v.audioGroups[T]+"_clone_"+f);if(v.subtitleGroups)for(var A=1;A<v.subtitleGroups.length;A++)S.addGroupId("text",v.subtitleGroups[A]+"_clone_"+f);return S});i.push.apply(i,c),cl(t.audioTracks,s,h,f),cl(t.subtitleTracks,l,h,f)}})}},n.loadSteeringManifest=function(e){var t=this,i=this.hls.config,s=i.loader;this.loader&&this.loader.destroy(),this.loader=new s(i);var l;try{l=new self.URL(e)}catch{this.enabled=!1,this.log("Failed to parse Steering Manifest URI: "+e);return}if(l.protocol!=="data:"){var u=(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate)|0;l.searchParams.set("_HLS_pathway",this.pathwayId),l.searchParams.set("_HLS_throughput",""+u)}var f={responseType:"json",url:l.href},d=i.steeringManifestLoadPolicy.default,h=d.errorRetry||d.timeoutRetry||{},c={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},v={onSuccess:function(m,p,E,S){t.log('Loaded steering manifest: "'+l+'"');var T=m.data;if(T?.VERSION!==1){t.log("Steering VERSION "+T.VERSION+" not supported!");return}t.updated=performance.now(),t.timeToLoad=T.TTL;var A=T["RELOAD-URI"],x=T["PATHWAY-CLONES"],b=T["PATHWAY-PRIORITY"];if(A)try{t.uri=new self.URL(A,l).href}catch{t.enabled=!1,t.log("Failed to parse Steering Manifest RELOAD-URI: "+A);return}t.scheduleRefresh(t.uri||E.url),x&&t.clonePathways(x);var D={steeringManifest:T,url:l.toString()};t.hls.trigger(y.STEERING_MANIFEST_LOADED,D),b&&t.updatePathwayPriority(b)},onError:function(m,p,E,S){if(t.log("Error loading steering manifest: "+m.code+" "+m.text+" ("+p.url+")"),t.stopLoad(),m.code===410){t.enabled=!1,t.log("Steering manifest "+p.url+" no longer available");return}var T=t.timeToLoad*1e3;if(m.code===429){var A=t.loader;if(typeof A?.getResponseHeader=="function"){var x=A.getResponseHeader("Retry-After");x&&(T=parseFloat(x)*1e3)}t.log("Steering manifest "+p.url+" rate limited");return}t.scheduleRefresh(t.uri||p.url,T)},onTimeout:function(m,p,E){t.log("Timeout loading steering manifest ("+p.url+")"),t.scheduleRefresh(t.uri||p.url)}};this.log("Requesting steering manifest: "+l),this.loader.load(f,c,v)},n.scheduleRefresh=function(e,t){var i=this;t===void 0&&(t=this.timeToLoad*1e3),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var s,l=(s=i.hls)==null?void 0:s.media;if(l&&!l.ended){i.loadSteeringManifest(e);return}i.scheduleRefresh(e,i.timeToLoad*1e3)},t)},Y(o,[{key:"pathwayPriority",get:function(){return this._pathwayPriority},set:function(e){this.updatePathwayPriority(e)}}])})(te);function cl(a,o,n,r){a&&Object.keys(o).forEach(function(e){var t=a.filter(function(i){return i.groupId===e}).map(function(i){var s=ae({},i);return s.details=void 0,s.attrs=new et(s.attrs),s.url=s.attrs.URI=vl(i.url,i.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),s.groupId=s.attrs["GROUP-ID"]=o[e],s.attrs["PATHWAY-ID"]=r,s});a.push.apply(a,t)})}function vl(a,o,n,r){var e=r.HOST,t=r.PARAMS,i=r[n],s;o&&(s=i?.[o],s&&(a=s));var l=new self.URL(a);return e&&!s&&(l.host=e),t&&Object.keys(t).sort().forEach(function(u){u&&l.searchParams.set(u,t[u])}),l.href}var gl=(function(a){function o(r){var e;return e=a.call(this,"eme",r.logger)||this,e.hls=void 0,e.config=void 0,e.media=null,e.keyFormatPromise=null,e.keySystemAccessPromises={},e._requestLicenseFailureCount=0,e.mediaKeySessions=[],e.keyIdToKeySessionPromise={},e.mediaKeys=null,e.setMediaKeysQueue=o.CDMCleanupPromise?[o.CDMCleanupPromise]:[],e.bannedKeyIds={},e.onMediaEncrypted=function(t){var i=t.initDataType,s=t.initData,l='"'+t.type+'" event: init data type: "'+i+'"';if(e.debug(l),s!==null){if(!e.keyFormatPromise){var u=Object.keys(e.keySystemAccessPromises);u.length||(u=Mi(e.config));var f=u.map(pa).filter(function(d){return!!d});e.keyFormatPromise=e.getKeyFormatPromise(f)}e.keyFormatPromise.then(function(d){var h=vn(d);if(i!=="sinf"||h!==$e.FAIRPLAY){e.log('Ignoring "'+t.type+'" event with init data type: "'+i+'" for selected key-system '+h);return}var c;try{var v=Ue(new Uint8Array(s)),g=ga(JSON.parse(v).sinf),m=ni(g);if(!m)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");c=new Uint8Array(m.subarray(8,24))}catch(k){e.warn(l+" Failed to parse sinf: "+k);return}for(var p=Ke(c),E=e,S=E.keyIdToKeySessionPromise,T=E.mediaKeySessions,A=S[p],x=function(){var R=T[D],L=R.decryptdata;if(!L.keyId)return 0;var I=Ke(L.keyId);if(p===I||L.uri.replace(/-/g,"").indexOf(p)!==-1)return A=S[I],A?(L.pssh||(delete S[I],L.pssh=new Uint8Array(s),L.keyId=c,A=S[p]=A.then(function(){return e.generateRequestWithPreferredKeySession(R,i,s,"encrypted-event-key-match")}),A.catch(function(P){return e.handleError(P)})),1):0},b,D=0;D<T.length&&(b=x(),!(b!==0&&b===1));D++);A||e.handleError(new Error("Key ID "+p+" not encountered in playlist. Key-system sessions "+T.length+"."))}).catch(function(d){return e.handleError(d)})}},e.onWaitingForKey=function(t){e.log('"'+t.type+'" event')},e.hls=r,e.config=r.config,e.registerListeners(),e}se(o,a);var n=o.prototype;return n.destroy=function(){this.onDestroying(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null},n.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(y.DESTROYING,this.onDestroying,this)},n.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(y.DESTROYING,this.onDestroying,this)},n.getLicenseServerUrl=function(e){var t=this.config,i=t.drmSystems,s=t.widevineLicenseUrl,l=i?.[e];if(l)return l.licenseUrl;if(e===$e.WIDEVINE&&s)return s},n.getLicenseServerUrlOrThrow=function(e){var t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error('no license server URL configured for key-system "'+e+'"');return t},n.getServerCertificateUrl=function(e){var t=this.config.drmSystems,i=t?.[e];if(i)return i.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},n.attemptKeySystemAccess=function(e){var t=this,i=this.hls.levels,s=function(d,h,c){return!!d&&c.indexOf(d)===h},l=i.map(function(f){return f.audioCodec}).filter(s),u=i.map(function(f){return f.videoCodec}).filter(s);return l.length+u.length===0&&u.push("avc1.42e01e"),new Promise(function(f,d){var h=function(v){var g=v.shift();t.getMediaKeysPromise(g,l,u).then(function(m){return f({keySystem:g,mediaKeys:m})}).catch(function(m){v.length?h(v):m instanceof ar?d(m):d(new ar({type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};h(e)})},n.requestMediaKeySystemAccess=function(e,t){var i=this.config.requestMediaKeySystemAccessFunc;if(typeof i!="function"){var s="Configured requestMediaKeySystemAccess is not a function "+i;return $s===null&&self.location.protocol==="http:"&&(s="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(s))}return i(e,t)},n.getMediaKeysPromise=function(e,t,i){var s,l=this,u=Bu(e,t,i,this.config.drmSystemOptions||{}),f=this.keySystemAccessPromises[e],d=(s=f)==null?void 0:s.keySystemAccess;if(!d){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+He(u)),d=this.requestMediaKeySystemAccess(e,u);var h=f=this.keySystemAccessPromises[e]={keySystemAccess:d};return d.catch(function(c){l.log('Failed to obtain access to key-system "'+e+'": '+c)}),d.then(function(c){l.log('Access for key-system "'+c.keySystem+'" obtained');var v=l.fetchServerCertificate(e);l.log('Create media-keys for "'+e+'"');var g=h.mediaKeys=c.createMediaKeys().then(function(m){return l.log('Media-keys created for "'+e+'"'),h.hasMediaKeys=!0,v.then(function(p){return p?l.setMediaKeysServerCertificate(m,e,p):m})});return g.catch(function(m){l.error('Failed to create media-keys for "'+e+'"}: '+m)}),g})}return d.then(function(){return f.mediaKeys})},n.createMediaKeySessionContext=function(e){var t=e.decryptdata,i=e.keySystem,s=e.mediaKeys;this.log('Creating key-system session "'+i+'" keyId: '+Ke(t.keyId||[]));var l=s.createSession(),u={decryptdata:t,keySystem:i,mediaKeys:s,mediaKeysSession:l,keyStatus:"status-pending"};return this.mediaKeySessions.push(u),u},n.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var i=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),l="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,l,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},n.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Ke(e.keyId)},n.updateKeySession=function(e,t){var i=e.mediaKeysSession;return this.log('Updating key-session "'+i.sessionId+'" for keyId '+Ke(e.decryptdata.keyId||[])+`
      } (data length: `+t.byteLength+")"),i.update(t)},n.getSelectedKeySystemFormats=function(){var e=this;return Object.keys(this.keySystemAccessPromises).map(function(t){return{keySystem:t,hasMediaKeys:e.keySystemAccessPromises[t].hasMediaKeys}}).filter(function(t){var i=t.hasMediaKeys;return!!i}).map(function(t){var i=t.keySystem;return pa(i)}).filter(function(t){return!!t})},n.getKeySystemAccess=function(e){var t=this;return this.getKeySystemSelectionPromise(e).then(function(i){var s=i.keySystem,l=i.mediaKeys;return t.attemptSetMediaKeys(s,l)})},n.selectKeySystem=function(e){var t=this;return new Promise(function(i,s){t.getKeySystemSelectionPromise(e).then(function(l){var u=l.keySystem,f=pa(u);f?i(f):s(new Error('Unable to find format for key-system "'+u+'"'))}).catch(s)})},n.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},n.getKeyFormatPromise=function(e){var t=Mi(this.config),i=e.map(vn).filter(function(s){return!!s&&t.indexOf(s)!==-1});return this.selectKeySystem(i)},n.loadKey=function(e){var t=this,i=e.keyInfo.decryptdata,s=this.getKeyIdString(i),l=this.bannedKeyIds[s];if(l){var u=ml(l,i);return this.handleError(u,e.frag),Promise.reject(u)}var f="(keyId: "+s+' format: "'+i.keyFormat+'" method: '+i.method+" uri: "+i.uri+")";this.log("Starting session for key "+f);var d=this.keyIdToKeySessionPromise[s];if(!d){var h=this.getKeySystemForKeyPromise(i).then(function(c){var v=c.keySystem,g=c.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+f),t.attemptSetMediaKeys(v,g).then(function(){return t.throwIfDestroyed(),t.createMediaKeySessionContext({keySystem:v,mediaKeys:g,decryptdata:i})})}).then(function(c){var v="cenc",g=i.pssh?i.pssh.buffer:null;return t.generateRequestWithPreferredKeySession(c,v,g,"playlist-key")});return h.catch(function(c){return t.handleError(c,e.frag)}),this.keyIdToKeySessionPromise[s]=h,h}return d},n.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},n.handleError=function(e,t){this.hls&&(this.error(e.message),e instanceof ar?(t&&(e.data.frag=t),this.hls.trigger(y.ERROR,e.data)):this.hls.trigger(y.ERROR,{type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},n.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){var s=vn(e.keyFormat),l=s?[s]:Mi(this.config);return this.attemptKeySystemAccess(l)}return i},n.getKeySystemSelectionPromise=function(e){if(e.length||(e=Mi(this.config)),e.length===0)throw new ar({type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+He({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},n.attemptSetMediaKeys=function(e,t){var i=this;if(this.mediaKeys===t)return Promise.resolve();var s=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var l=Promise.all(s).then(function(){if(!i.media)throw i.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return i.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(l),l.then(function(){i.log('Media-keys set for "'+e+'"'),s.push(l),i.setMediaKeysQueue=i.setMediaKeysQueue.filter(function(u){return s.indexOf(u)===-1})})},n.generateRequestWithPreferredKeySession=function(e,t,i,s){var l,u=this,f=(l=this.config.drmSystems)==null||(l=l[e.keySystem])==null?void 0:l.generateRequest;if(f)try{var d=f.call(this.hls,t,i,e);if(!d)throw new Error("Invalid response from configured generateRequest filter");t=d.initDataType,i=d.initData?d.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(p){if(this.warn(p.message),this.hls&&this.hls.config.debug)throw p}if(i===null)return this.log('Skipping key-session request for "'+s+'" (no initData)'),Promise.resolve(e);var h=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+s+'": '+h+" (init data type: "+t+" length: "+i.byteLength+")");var c=new be,v=e._onmessage=function(p){var E=e.mediaKeysSession;if(!E){c.emit("error",new Error("invalid state"));return}var S=p.messageType,T=p.message;u.log('"'+S+'" message event for session "'+E.sessionId+'" message size: '+T.byteLength),S==="license-request"||S==="license-renewal"?u.renewLicense(e,T).catch(function(A){c.eventNames().length?c.emit("error",A):u.handleError(A)}):S==="license-release"?e.keySystem===$e.FAIRPLAY&&(u.updateKeySession(e,ma("acknowledged")),u.removeSession(e)):u.warn('unhandled media key message type "'+S+'"')},g=e._onkeystatuseschange=function(p){var E=e.mediaKeysSession;if(!E){c.emit("error",new Error("invalid state"));return}var S=e.keyStatus;u.onKeyStatusChange(e);var T=e.keyStatus;T!==S&&(c.emit("keyStatus",T,e),T==="expired"&&(u.log(e.keySystem+" expired for key "+h),u.renewKeySession(e)))};kt(e.mediaKeysSession,"message",v),kt(e.mediaKeysSession,"keystatuseschange",g);var m=new Promise(function(p,E){c.on("error",E),c.on("keyStatus",function(S,T){var A=T.decryptdata;S.startsWith("usable")?p():S==="internal-error"||S==="output-restricted"?E(ml(S,A)):S==="expired"?E(new Error("key expired while generating request (keyId: "+h+")")):u.warn('unhandled key status change "'+S+'" (keyId: '+h+")")})});return e.mediaKeysSession.generateRequest(t,i).then(function(){u.log('Request generated for key-session "'+e.mediaKeysSession.sessionId+'" keyId: '+h)}).catch(function(p){throw new ar({type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_SESSION,error:p,decryptdata:e.decryptdata,fatal:!1},"Error generating key-session request: "+p)}).then(function(){return m}).catch(function(p){throw c.removeAllListeners(),u.removeSession(e),p}).then(function(){return c.removeAllListeners(),e})},n.onKeyStatusChange=function(e){var t=this,i=Ke(new Uint8Array(e.decryptdata.keyId||[]));e.mediaKeysSession.keyStatuses.forEach(function(s,l){if(typeof l=="string"&&typeof s=="object"){var u=l;l=s,s=u}var f=Ke("buffer"in l?new Uint8Array(l.buffer,l.byteOffset,l.byteLength):new Uint8Array(l));s==="internal-error"&&(t.bannedKeyIds[f]=s);var d=f===i;t.log((d?"":"un")+'matched key status change "'+s+'" for keyStatuses keyId: '+f+" session keyId: "+i+" uri: "+e.decryptdata.uri),d&&(e.keyStatus=s)})},n.fetchServerCertificate=function(e){var t=this.config,i=t.loader,s=new i(t),l=this.getServerCertificateUrl(e);return l?(this.log('Fetching server certificate for "'+e+'"'),new Promise(function(u,f){var d={responseType:"arraybuffer",url:l},h=t.certLoadPolicy.default,c={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},v={onSuccess:function(m,p,E,S){u(m.data)},onError:function(m,p,E,S){f(new ar({type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:Te({url:d.url,data:void 0},m)},'"'+e+'" certificate request failed ('+l+"). Status: "+m.code+" ("+m.text+")"))},onTimeout:function(m,p,E){f(new ar({type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:d.url,data:void 0}},'"'+e+'" certificate request timed out ('+l+")"))},onAbort:function(m,p,E){f(new Error("aborted"))}};s.load(d,c,v)})):Promise.resolve()},n.setMediaKeysServerCertificate=function(e,t,i){var s=this;return new Promise(function(l,u){e.setServerCertificate(i).then(function(f){s.log("setServerCertificate "+(f?"success":"not supported by CDM")+" ("+i.byteLength+') on "'+t+'"'),l(e)}).catch(function(f){u(new ar({type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:f,fatal:!0},f.message))})})},n.renewLicense=function(e,t){var i=this;return this.requestLicense(e,new Uint8Array(t)).then(function(s){return i.updateKeySession(e,new Uint8Array(s)).catch(function(l){throw new ar({type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:l,fatal:!1},l.message)})})},n.unpackPlayReadyKeyMessage=function(e,t){var i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;var s=new DOMParser().parseFromString(i,"application/xml"),l=s.querySelectorAll("HttpHeader");if(l.length>0)for(var u,f=0,d=l.length;f<d;f++){var h,c;u=l[f];var v=(h=u.querySelector("name"))==null?void 0:h.textContent,g=(c=u.querySelector("value"))==null?void 0:c.textContent;v&&g&&e.setRequestHeader(v,g)}var m=s.querySelector("Challenge"),p=m?.textContent;if(!p)throw new Error("Cannot find <Challenge> in key message");return ma(atob(p))},n.setupLicenseXHR=function(e,t,i,s){var l=this,u=this.config.licenseXhrSetup;return u?Promise.resolve().then(function(){if(!i.decryptdata)throw new Error("Key removed");return u.call(l.hls,e,t,i,s)}).catch(function(f){if(!i.decryptdata)throw f;return e.open("POST",t,!0),u.call(l.hls,e,t,i,s)}).then(function(f){e.readyState||e.open("POST",t,!0);var d=f||s;return{xhr:e,licenseChallenge:d}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))},n.requestLicense=function(e,t){var i=this,s=this.config.keyLoadPolicy.default;return new Promise(function(l,u){var f=i.getLicenseServerUrlOrThrow(e.keySystem);i.log("Sending license request to URL: "+f);var d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=function(){if(!i.hls||!e.mediaKeysSession)return u(new Error("invalid state"));if(d.readyState===4)if(d.status===200){i._requestLicenseFailureCount=0;var h=d.response;i.log("License received "+(h instanceof ArrayBuffer?h.byteLength:h));var c=i.config.licenseResponseCallback;if(c)try{h=c.call(i.hls,d,f,e)}catch(p){i.error(p)}l(h)}else{var v=s.errorRetry,g=v?v.maxNumRetry:0;if(i._requestLicenseFailureCount++,i._requestLicenseFailureCount>g||d.status>=400&&d.status<500)u(new ar({type:W.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:d,response:{url:f,data:void 0,code:d.status,text:d.statusText}},"License Request XHR failed ("+f+"). Status: "+d.status+" ("+d.statusText+")"));else{var m=g-i._requestLicenseFailureCount+1;i.warn("Retrying license request, "+m+" attempts left"),i.requestLicense(e,t).then(l,u)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=d,i.setupLicenseXHR(d,f,e,t).then(function(h){var c=h.xhr,v=h.licenseChallenge;e.keySystem==$e.PLAYREADY&&(v=i.unpackPlayReadyKeyMessage(c,v)),c.send(v)}).catch(u)})},n.onDestroying=function(){this.unregisterListeners(),this._clear()},n.onMediaAttached=function(e,t){if(this.config.emeEnabled){var i=t.media;this.media=i,kt(i,"encrypted",this.onMediaEncrypted),kt(i,"waitingforkey",this.onWaitingForKey)}},n.onMediaDetached=function(){var e=this.media;e&&(Yt(e,"encrypted",this.onMediaEncrypted),Yt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)},n._clear=function(){var e=this,t;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!(!this.mediaKeys&&!this.mediaKeySessions.length)){var i=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Js.clearKeyUriToKeyIdMap();var l=s.length;o.CDMCleanupPromise=Promise.all(s.map(function(u){return e.removeSession(u)}).concat(i==null||(t=i.setMediaKeys(null))==null?void 0:t.catch(function(u){e.log("Could not clear media keys: "+u),e.hls&&e.hls.trigger(y.ERROR,{type:W.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: "+u)})}))).catch(function(u){e.log("Could not close sessions and clear media keys: "+u),e.hls&&e.hls.trigger(y.ERROR,{type:W.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: "+u)})}).then(function(){l&&e.log("finished closing key sessions and clearing media keys")})}},n.onManifestLoading=function(){this.keyFormatPromise=null,this.bannedKeyIds={}},n.onManifestLoaded=function(e,t){var i=t.sessionKeys;if(!(!i||!this.config.emeEnabled)&&!this.keyFormatPromise){var s=i.reduce(function(l,u){return l.indexOf(u.keyFormat)===-1&&l.push(u.keyFormat),l},[]);this.log("Selecting key-system from session-keys "+s.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(s)}},n.removeSession=function(e){var t=this,i=e.mediaKeysSession,s=e.licenseXhr,l=e.decryptdata;if(i){this.log('Remove licenses and keys and close session "'+i.sessionId+'" keyId: '+Ke(l?.keyId||[])),e._onmessage&&(i.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var u=this.mediaKeySessions.indexOf(e);u>-1&&this.mediaKeySessions.splice(u,1);var f=this.config.drmSystemOptions,d=Ku(f)?new Promise(function(h,c){self.setTimeout(function(){return c(new Error("MediaKeySession.remove() timeout"))},8e3),i.remove().then(h).catch(c)}):Promise.resolve();return d.catch(function(h){t.log("Could not remove session: "+h),t.hls&&t.hls.trigger(y.ERROR,{type:W.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: "+h)})}).then(function(){return i.close()}).catch(function(h){t.log("Could not close session: "+h),t.hls&&t.hls.trigger(y.ERROR,{type:W.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: "+h)})})}},o})(te);gl.CDMCleanupPromise=void 0;var ar=(function(a){function o(n,r){var e;return e=a.call(this,r)||this,e.data=void 0,n.error||(n.error=new Error(r)),e.data=n,n.err=n.error,e}return se(o,a),o})(ze(Error));function ml(a,o){var n=a==="output-restricted",r=n?_.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:_.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new ar({type:W.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:o},n?"HDCP level output restricted":'key status changed to "'+a+'"')}var fh=(function(){function a(n){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=n,this.registerListeners()}var o=a.prototype;return o.setStreamController=function(r){this.streamController=r},o.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)},o.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)},o.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},o.onMediaAttaching=function(r,e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var i=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},o.onMediaDetaching=function(){this.media=null},o.checkFPS=function(r,e,t){var i=performance.now();if(e){if(this.lastTime){var s=i-this.lastTime,l=t-this.lastDroppedFrames,u=e-this.lastDecodedFrames,f=1e3*l/s,d=this.hls;if(d.trigger(y.FPS_DROP,{currentDropped:l,currentDecoded:u,totalDroppedFrames:t}),f>0&&l>d.config.fpsDroppedMonitoringThreshold*u){var h=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=h)&&(h=h-1,d.trigger(y.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=t,this.lastDecodedFrames=e}},o.checkFPSInterval=function(){var r=this.media;if(r)if(this.isVideoPlaybackQualityAvailable){var e=r.getVideoPlaybackQuality();this.checkFPS(r,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(r,r.webkitDecodedFrameCount,r.webkitDroppedFrameCount)},a})();function Hi(a){for(var o=5381,n=a.length;n;)o=o*33^a.charCodeAt(--n);return(o>>>0).toString()}var yi=.025,Rn=(function(a){return a[a.Point=0]="Point",a[a.Range=1]="Range",a})({});function dh(a,o,n){return a.identifier+"-"+(n+1)+"-"+Hi(o)}var hh=(function(){function a(n,r){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=r,this.dateRange=n,this.setDateRange(n)}var o=a.prototype;return o.setDateRange=function(r){this.dateRange=r,this.resumeOffset=r.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=r.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=r.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=r.attr.enumeratedStringList("X-SNAP",this.snapOptions)},o.reset=function(){var r;this.appendInPlaceStarted=!1,(r=this.assetListLoader)==null||r.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)},o.isAssetPastPlayoutLimit=function(r){var e;if(r>0&&r>=this.assetList.length)return!0;var t=this.playoutLimit;if(r<=0||isNaN(t))return!1;if(t===0)return!0;var i=((e=this.assetList[r])==null?void 0:e.startOffset)||0;return i>t},o.findAssetIndex=function(r){var e=this.assetList.indexOf(r);return e},o.toString=function(){return ch(this)},Y(a,[{key:"identifier",get:function(){return this.dateRange.id}},{key:"startDate",get:function(){return this.dateRange.startDate}},{key:"startTime",get:function(){var r=this.dateRange.startTime;if(this.snapOptions.out){var e=this.dateRange.tagAnchor;if(e)return qa(r,e)}return r}},{key:"startOffset",get:function(){return this.cue.pre?0:this.startTime}},{key:"startIsAligned",get:function(){if(this.startTime===0||this.snapOptions.out)return!0;var r=this.dateRange.tagAnchor;if(r){var e=this.dateRange.startTime,t=qa(e,r);return e-t<.1}return!1}},{key:"resumptionOffset",get:function(){var r=this.resumeOffset,e=H(r)?r:this.duration;return this.cumulativeDuration+e}},{key:"resumeTime",get:function(){var r=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){var e=this.resumeAnchor;if(e)return qa(r,e)}return r}},{key:"appendInPlace",get:function(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<yi))},set:function(r){if(this.appendInPlaceStarted){this.resetOnResume=!r;return}this.appendInPlaceDisabled=!r}},{key:"timelineStart",get:function(){return this._timelineStart!==null?this._timelineStart:this.startTime},set:function(r){this._timelineStart=r}},{key:"duration",get:function(){var r=this.playoutLimit,e;return this._duration!==null?e=this._duration:this.dateRange.duration?e=this.dateRange.duration:e=this.dateRange.plannedDuration||0,!isNaN(r)&&r<e&&(e=r),e},set:function(r){this._duration=r}},{key:"cue",get:function(){return this.dateRange.cue}},{key:"timelineOccupancy",get:function(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Rn.Range:Rn.Point}},{key:"supplementsPrimary",get:function(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}},{key:"contentMayVary",get:function(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}},{key:"assetUrl",get:function(){return this.dateRange.attr["X-ASSET-URI"]}},{key:"assetListUrl",get:function(){return this.dateRange.attr["X-ASSET-LIST"]}},{key:"baseUrl",get:function(){return this.base.url}},{key:"assetListLoaded",get:function(){return this.assetList.length>0||this.assetListResponse!==null}}])})();function qa(a,o){return a-o.start<o.duration/2&&!(Math.abs(a-(o.start+o.duration))<yi)?o.start:o.start+o.duration}function pl(a,o,n){var r=new self.URL(a,n);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",o),r}function ja(a,o){for(;(n=a.assetList[++o])!=null&&n.error;)var n;return o}function ch(a){return'["'+a.identifier+'" '+(a.cue.pre?"<pre>":a.cue.post?"<post>":"")+a.timelineStart.toFixed(2)+"-"+a.resumeTime.toFixed(2)+"]"}function Ei(a){var o=a.timelineStart,n=a.duration||0;return'["'+a.identifier+'" '+o.toFixed(2)+"-"+(o+n).toFixed(2)+"]"}var vh=(function(){function a(n,r,e,t){var i=this;this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=function(){i.reachedPlayout(i.currentTime)&&i.hls&&i.hls.trigger(y.PLAYOUT_LIMIT_REACHED,{})};var s=this.hls=new n(r);this.interstitial=e,this.assetItem=t;var l=function(){i.hasDetails=!0};s.once(y.LEVEL_LOADED,l),s.once(y.AUDIO_TRACK_LOADED,l),s.once(y.SUBTITLE_TRACK_LOADED,l),s.on(y.MEDIA_ATTACHING,function(u,f){var d=f.media;i.removeMediaListeners(),i.mediaAttached=d;var h=i.interstitial;h.playoutLimit&&(d.addEventListener("timeupdate",i.checkPlayout),i.appendInPlace&&s.on(y.BUFFER_APPENDED,function(){var c=i.bufferedEnd;i.reachedPlayout(c)&&(i._bufferedEosTime=c,s.trigger(y.BUFFERED_TO_END,void 0))}))})}var o=a.prototype;return o.loadSource=function(){var r=this.hls;if(r)if(r.url)r.levels.length&&!r.started&&r.startLoad(-1,!0);else{var e=this.assetItem.uri;try{e=pl(e,r.config.primarySessionId||"").href}catch{}r.loadSource(e)}},o.bufferedInPlaceToEnd=function(r){var e;if(!this.appendInPlace)return!1;if((e=this.hls)!=null&&e.bufferedToEnd)return!0;if(!r)return!1;var t=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,s=Se.bufferInfo(r,i,0),l=this.getAssetTime(s.end);return l>=t-.02},o.reachedPlayout=function(r){var e=this.interstitial,t=e.playoutLimit;return this.startOffset+r>=t},o.getAssetTime=function(r){var e=this.timelineOffset,t=this.duration;return Math.min(Math.max(0,r-e),t)},o.removeMediaListeners=function(){var r=this.mediaAttached;r&&(this._currentTime=r.currentTime,this.bufferSnapShot(),r.removeEventListener("timeupdate",this.checkPlayout))},o.bufferSnapShot=function(){if(this.mediaAttached){var r;(r=this.hls)!=null&&r.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}},o.destroy=function(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null},o.attachMedia=function(r){var e;this.loadSource(),(e=this.hls)==null||e.attachMedia(r)},o.detachMedia=function(){var r;this.removeMediaListeners(),this.mediaAttached=null,(r=this.hls)==null||r.detachMedia()},o.resumeBuffering=function(){var r;(r=this.hls)==null||r.resumeBuffering()},o.pauseBuffering=function(){var r;(r=this.hls)==null||r.pauseBuffering()},o.transferMedia=function(){var r;return this.bufferSnapShot(),((r=this.hls)==null?void 0:r.transferMedia())||null},o.resetDetails=function(){var r=this.hls;if(r&&this.hasDetails){r.stopLoad();var e=function(i){return delete i.details};r.levels.forEach(e),r.allAudioTracks.forEach(e),r.allSubtitleTracks.forEach(e),this.hasDetails=!1}},o.on=function(r,e,t){var i;(i=this.hls)==null||i.on(r,e)},o.once=function(r,e,t){var i;(i=this.hls)==null||i.once(r,e)},o.off=function(r,e,t){var i;(i=this.hls)==null||i.off(r,e)},o.toString=function(){var r;return"HlsAssetPlayer: "+Ei(this.assetItem)+" "+((r=this.hls)==null?void 0:r.sessionId)+" "+(this.appendInPlace?"append-in-place":"")},Y(a,[{key:"appendInPlace",get:function(){return this.interstitial.appendInPlace}},{key:"destroyed",get:function(){var r;return!((r=this.hls)!=null&&r.userConfig)}},{key:"assetId",get:function(){return this.assetItem.identifier}},{key:"interstitialId",get:function(){return this.assetItem.parentIdentifier}},{key:"media",get:function(){var r;return((r=this.hls)==null?void 0:r.media)||null}},{key:"bufferedEnd",get:function(){var r=this.media||this.mediaAttached;if(!r)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;var e=Se.bufferInfo(r,r.currentTime,.001);return this.getAssetTime(e.end)}},{key:"currentTime",get:function(){var r=this.media||this.mediaAttached;return r?this.getAssetTime(r.currentTime):this._currentTime||0}},{key:"duration",get:function(){var r=this.assetItem.duration;if(!r)return 0;var e=this.interstitial.playoutLimit;if(e){var t=e-this.startOffset;if(t>0&&t<r)return t}return r}},{key:"remaining",get:function(){var r=this.duration;return r?Math.max(0,r-this.currentTime):0}},{key:"startOffset",get:function(){return this.assetItem.startOffset}},{key:"timelineOffset",get:function(){var r;return((r=this.hls)==null?void 0:r.config.timelineOffset)||0},set:function(r){var e=this.timelineOffset;if(r!==e){var t=r-e;if(Math.abs(t)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=r}}}}])})(),yl=.033,gh=(function(a){function o(r,e){var t;return t=a.call(this,"interstitials-sched",e)||this,t.onScheduleUpdate=void 0,t.eventMap={},t.events=null,t.items=null,t.durations={primary:0,playout:0,integrated:0},t.onScheduleUpdate=r,t}se(o,a);var n=o.prototype;return n.destroy=function(){this.reset(),this.onScheduleUpdate=null},n.reset=function(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(function(e){return e.reset()}),this.events=this.items=null},n.resetErrorsInRange=function(e,t){return this.events?this.events.reduce(function(i,s){return e<=s.startOffset&&t>s.startOffset?(delete s.error,i+1):i},0):0},n.getEvent=function(e){return e&&this.eventMap[e]||null},n.hasEvent=function(e){return e in this.eventMap},n.findItemIndex=function(e,t){if(e.event)return this.findEventIndex(e.event.identifier);var i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);var s=this.items;if(s)for(s[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(l=s[i])!=null&&l.event;){var l;i--}return i},n.findItemIndexAtTime=function(e,t){var i=this.items;if(i)for(var s=0;s<i.length;s++){var l=i[s];if(t&&t!=="primary"&&(l=l[t]),e===l.start||e>l.start&&e<l.end)return s}return-1},n.findJumpRestrictedIndex=function(e,t){var i=this.items;if(i)for(var s=e;s<=t&&i[s];s++){var l=i[s].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return s}return-1},n.findEventIndex=function(e){var t=this.items;if(t)for(var i=t.length;i--;){var s;if(((s=t[i].event)==null?void 0:s.identifier)===e)return i}return-1},n.findAssetIndex=function(e,t){var i=e.assetList,s=i.length;if(s>1)for(var l=0;l<s;l++){var u=i[l];if(!u.error){var f=u.timelineStart;if(t===f||t>f&&(t<f+(u.duration||0)||l===s-1))return l}}return 0},n.parseInterstitialDateRanges=function(e,t){var i=this,s=e.main.details,l=s.dateRanges,u=this.events,f=this.parseDateRanges(l,{url:s.url},t),d=Object.keys(l),h=u?u.filter(function(c){return!d.includes(c.identifier)}):[];f.length&&f.sort(function(c,v){var g=c.cue.pre,m=c.cue.post,p=v.cue.pre,E=v.cue.post;if(g&&!p)return-1;if(p&&!g||m&&!E)return 1;if(E&&!m)return-1;if(!g&&!p&&!m&&!E){var S=c.startTime,T=v.startTime;if(S!==T)return S-T}return c.dateRange.tagOrder-v.dateRange.tagOrder}),this.events=f,h.forEach(function(c){i.removeEvent(c)}),this.updateSchedule(e,h)},n.updateSchedule=function(e,t,i){t===void 0&&(t=[]),i===void 0&&(i=!1);var s=this.events||[];if(s.length||t.length||this.length<2){var l=this.items,u=this.parseSchedule(s,e),f=i||t.length||l?.length!==u.length||u.some(function(d,h){return Math.abs(d.playout.start-l[h].playout.start)>.005||Math.abs(d.playout.end-l[h].playout.end)>.005});f&&(this.items=u,this.onScheduleUpdate(t,l))}},n.parseDateRanges=function(e,t,i){for(var s=[],l=Object.keys(e),u=0;u<l.length;u++){var f=l[u],d=e[f];if(d.isInterstitial){var h=this.eventMap[f];h?h.setDateRange(d):(h=new hh(d,t),this.eventMap[f]=h,i===!1&&(h.appendInPlace=i)),s.push(h)}}return s},n.parseSchedule=function(e,t){var i=[],s=t.main.details,l=s.live?1/0:s.edge,u=0;if(e=e.filter(function(E){return!E.error&&!(E.cue.once&&E.hasPlayed)}),e.length){this.resolveOffsets(e,t);var f=0,d=0;if(e.forEach(function(E,S){var T=E.cue.pre,A=E.cue.post,x=e[S-1]||null,b=E.appendInPlace,D=A?l:E.startOffset,k=E.duration,R=E.timelineOccupancy===Rn.Range?k:0,L=E.resumptionOffset,I=x?.startTime===D,P=D+E.cumulativeDuration,U=b?P+k:D+L;if(T||!A&&D<=0){var w=d;d+=R,E.timelineStart=P;var O=u;u+=k,i.push({event:E,start:P,end:U,playout:{start:O,end:u},integrated:{start:w,end:d}})}else if(D<=l){if(!I){var K=D-f;if(K>yl){var z=f,X=d;d+=K;var Q=u;u+=K;var ge={previousEvent:e[S-1]||null,nextEvent:E,start:z,end:z+K,playout:{start:Q,end:u},integrated:{start:X,end:d}};i.push(ge)}else K>0&&x&&(x.cumulativeDuration+=K,i[i.length-1].end=D)}A&&(U=P),E.timelineStart=P;var $=d;d+=R;var J=u;u+=k,i.push({event:E,start:P,end:U,playout:{start:J,end:u},integrated:{start:$,end:d}})}else return;var re=E.resumeTime;A||re>l?f=l:f=re}),f<l){var h,c=f,v=d,g=l-f;d+=g;var m=u;u+=g,i.push({previousEvent:((h=i[i.length-1])==null?void 0:h.event)||null,nextEvent:null,start:f,end:c+g,playout:{start:m,end:u},integrated:{start:v,end:d}})}this.setDurations(l,u,d)}else{var p=0;i.push({previousEvent:null,nextEvent:null,start:p,end:l,playout:{start:p,end:l},integrated:{start:p,end:l}}),this.setDurations(l,l,l)}return i},n.setDurations=function(e,t,i){this.durations={primary:e,playout:t,integrated:i}},n.resolveOffsets=function(e,t){var i=this,s=t.main.details,l=s.live?1/0:s.edge,u=0,f=-1;e.forEach(function(d,h){var c=d.cue.pre,v=d.cue.post,g=c?0:v?l:d.startTime;i.updateAssetDurations(d);var m=f===g;if(m?d.cumulativeDuration=u:(u=0,f=g),!v&&d.snapOptions.in&&(d.resumeAnchor=Yr(null,s.fragments,d.startOffset+d.resumptionOffset,0,0)||void 0),d.appendInPlace&&!d.appendInPlaceStarted){var p=i.primaryCanResumeInPlaceAt(d,t);p||(d.appendInPlace=!1)}if(!d.appendInPlace&&h+1<e.length){var E=e[h+1].startTime-e[h].resumeTime;E<yl&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&i.warn("Could not change append strategy for abutting event "+d))}var S=H(d.resumeOffset)?d.resumeOffset:d.duration;u+=S})},n.primaryCanResumeInPlaceAt=function(e,t){var i=this,s=e.resumeTime,l=e.startTime+e.resumptionOffset;if(Math.abs(s-l)>yi)return this.log('"'+e.identifier+'" resumption '+s+" not aligned with estimated timeline end "+l),!1;var u=Object.keys(t);return!u.some(function(f){var d=t[f].details,h=d.edge;if(s>=h)return i.log('"'+e.identifier+'" resumption '+s+" past "+f+" playlist end "+h),!1;var c=Yr(null,d.fragments,s);if(!c)return i.log('"'+e.identifier+'" resumption '+s+" does not align with any fragments in "+f+" playlist ("+d.fragStart+"-"+d.fragmentEnd+")"),!0;var v=f==="audio"?.175:0,g=Math.abs(c.start-s)<yi+v||Math.abs(c.end-s)<yi+v;return g?!1:(i.log('"'+e.identifier+'" resumption '+s+" not aligned with "+f+" fragment bounds ("+c.start+"-"+c.end+" sn: "+c.sn+" cc: "+c.cc+")"),!0)})},n.updateAssetDurations=function(e){if(e.assetListLoaded){for(var t=e.timelineStart,i=0,s=!1,l=!1,u=0;u<e.assetList.length;u++){var f=e.assetList[u],d=t+i;f.startOffset=i,f.timelineStart=d,s||(s=f.duration===null),l||(l=!!f.error);var h=f.error?0:f.duration||0;i+=h}s&&!l?e.duration=Math.max(i,e.duration):e.duration=i}},n.removeEvent=function(e){e.reset(),delete this.eventMap[e.identifier]},Y(o,[{key:"duration",get:function(){var e=this.items;return e?e[e.length-1].end:0}},{key:"length",get:function(){return this.items?this.items.length:0}},{key:"assetIdAtEnd",get:function(){var e,t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){var i=t.assetList,s=i[i.length-1];if(s)return s.identifier}return null}}])})(te);function sr(a){return"["+(a.event?'"'+a.event.identifier+'"':"primary")+": "+a.start.toFixed(2)+"-"+a.end.toFixed(2)+"]"}var mh=(function(){function a(n){this.hls=void 0,this.hls=n}var o=a.prototype;return o.destroy=function(){this.hls=null},o.loadAssetList=function(r,e){var t=this,i=r.assetListUrl,s;try{s=pl(i,this.hls.sessionId,r.baseUrl)}catch(m){var l=this.assignAssetListError(r,_.ASSET_LIST_LOAD_ERROR,m,i);this.hls.trigger(y.ERROR,l);return}e&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+e);var u=this.hls.config,f=u.loader,d=new f(u),h={responseType:"json",url:s.href},c=u.interstitialAssetListLoadPolicy.default,v={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:function(p,E,S,T){var A=p.data,x=A?.ASSETS;if(!Array.isArray(x)){var b=t.assignAssetListError(r,_.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,E,T);t.hls.trigger(y.ERROR,b);return}r.assetListResponse=A,t.hls.trigger(y.ASSET_LIST_LOADED,{event:r,assetListResponse:A,networkDetails:T})},onError:function(p,E,S,T){var A=t.assignAssetListError(r,_.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status "+p.code+" "+p.text+" ("+E.url+")"),E.url,T,S);t.hls.trigger(y.ERROR,A)},onTimeout:function(p,E,S){var T=t.assignAssetListError(r,_.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST ("+E.url+")"),E.url,p,S);t.hls.trigger(y.ERROR,T)}};return d.load(h,v,g),this.hls.trigger(y.ASSET_LIST_LOADING,{event:r}),d},o.assignAssetListError=function(r,e,t,i,s,l){return r.error=t,{type:W.NETWORK_ERROR,details:e,fatal:!1,interstitial:r,url:i,error:t,networkDetails:l,stats:s}},a})();function El(a){a?.play().catch(function(){})}function _n(a,o){return"["+a+"] Advancing timeline position to "+o}var ph=(function(a){function o(r,e){var t;return t=a.call(this,"interstitials",r.logger)||this,t.HlsPlayerClass=void 0,t.hls=void 0,t.assetListLoader=void 0,t.mediaSelection=null,t.altSelection=null,t.media=null,t.detachedData=null,t.requiredTracks=null,t.manager=null,t.playerQueue=[],t.bufferedPos=-1,t.timelinePos=-1,t.schedule=void 0,t.playingItem=null,t.bufferingItem=null,t.waitingItem=null,t.endedItem=null,t.playingAsset=null,t.endedAsset=null,t.bufferingAsset=null,t.shouldPlay=!1,t.onPlay=function(){t.shouldPlay=!0},t.onPause=function(){t.shouldPlay=!1},t.onSeeking=function(){var i=t.currentTime;if(!(i===void 0||t.playbackDisabled||!t.schedule)){var s=i-t.timelinePos,l=Math.abs(s)<1/7056e5;if(!l){var u=s<=-.01;t.timelinePos=i,t.bufferedPos=i;var f=t.playingItem;if(!f){t.checkBuffer();return}if(u){var d=t.schedule.resetErrorsInRange(i,i-s);d&&t.updateSchedule(!0)}if(t.checkBuffer(),u&&i<f.start||i>=f.end){var h,c=t.findItemIndex(f),v=t.schedule.findItemIndexAtTime(i);if(v===-1&&(v=c+(u?-1:1),t.log("seeked "+(u?"back ":"")+"to position not covered by schedule "+i+" (resolving from "+c+" to "+v+")")),!t.isInterstitial(f)&&(h=t.media)!=null&&h.paused&&(t.shouldPlay=!1),!u&&v>c){var g=t.schedule.findJumpRestrictedIndex(c+1,v);if(g>c){t.setSchedulePosition(g);return}}t.setSchedulePosition(v);return}var m=t.playingAsset;if(!m){if(t.playingLastItem&&t.isInterstitial(f)){var p=f.event.assetList[0];p&&(t.endedItem=t.playingItem,t.playingItem=null,t.setScheduleToAssetAtTime(i,p))}return}var E=m.timelineStart,S=m.duration||0;if(u&&i<E||i>=E+S){var T;(T=f.event)!=null&&T.appendInPlace&&(t.clearInterstitial(f.event,f),t.flushFrontBuffer(i)),t.setScheduleToAssetAtTime(i,m)}}}},t.onTimeupdate=function(){var i=t.currentTime;if(!(i===void 0||t.playbackDisabled)){if(i>t.timelinePos)t.timelinePos=i,i>t.bufferedPos&&t.checkBuffer();else return;var s=t.playingItem;if(!(!s||t.playingLastItem)){if(i>=s.end){t.timelinePos=s.end;var l=t.findItemIndex(s);t.setSchedulePosition(l+1)}var u=t.playingAsset;if(u){var f=u.timelineStart+(u.duration||0);i>=f&&t.setScheduleToAssetAtTime(i,u)}}}},t.onScheduleUpdate=function(i,s){var l=t.schedule;if(l){var u=t.playingItem,f=l.events||[],d=l.items||[],h=l.durations,c=i.map(function(E){return E.identifier}),v=!!(f.length||c.length);(v||s)&&t.log("INTERSTITIALS_UPDATED ("+f.length+"): "+f+`
Schedule: `+d.map(function(E){return sr(E)})+" pos: "+t.timelinePos),c.length&&t.log("Removed events "+c);var g=null,m=null;u&&(g=t.updateItem(u,t.timelinePos),t.itemsMatch(u,g)?t.playingItem=g:t.waitingItem=t.endedItem=null),t.waitingItem=t.updateItem(t.waitingItem),t.endedItem=t.updateItem(t.endedItem);var p=t.bufferingItem;if(p&&(m=t.updateItem(p,t.bufferedPos),t.itemsMatch(p,m)?t.bufferingItem=m:p.event&&(t.bufferingItem=t.playingItem,t.clearInterstitial(p.event,null))),i.forEach(function(E){E.assetList.forEach(function(S){t.clearAssetPlayer(S.identifier,null)})}),t.playerQueue.forEach(function(E){if(E.interstitial.appendInPlace){var S=E.assetItem.timelineStart,T=E.timelineOffset-S;if(T)try{E.timelineOffset=S}catch(A){Math.abs(T)>yi&&t.warn(A+' ("'+E.assetId+'" '+E.timelineOffset+"->"+S+")")}}}),v||s){if(t.hls.trigger(y.INTERSTITIALS_UPDATED,{events:f.slice(0),schedule:d.slice(0),durations:h,removedIds:c}),t.isInterstitial(u)&&c.includes(u.event.identifier)){t.warn('Interstitial "'+u.event.identifier+'" removed while playing'),t.primaryFallback(u.event);return}u&&t.trimInPlace(g,u),p&&m!==g&&t.trimInPlace(m,p),t.checkBuffer()}}},t.hls=r,t.HlsPlayerClass=e,t.assetListLoader=new mh(r),t.schedule=new gh(t.onScheduleUpdate,r.logger),t.registerListeners(),t}se(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e&&(e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(y.MEDIA_ENDED,this.onMediaEnded,this),e.on(y.ERROR,this.onError,this),e.on(y.DESTROYING,this.onDestroying,this))},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(y.MEDIA_ENDED,this.onMediaEnded,this),e.off(y.ERROR,this.onError,this),e.off(y.DESTROYING,this.onDestroying,this))},n.startLoad=function(){this.resumeBuffering()},n.stopLoad=function(){this.pauseBuffering()},n.resumeBuffering=function(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()},n.pauseBuffering=function(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()},n.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null},n.onDestroying=function(){var e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)},n.removeMediaListeners=function(e){Yt(e,"play",this.onPlay),Yt(e,"pause",this.onPause),Yt(e,"seeking",this.onSeeking),Yt(e,"timeupdate",this.onTimeupdate)},n.onMediaAttaching=function(e,t){var i=this.media=t.media;kt(i,"seeking",this.onSeeking),kt(i,"timeupdate",this.onTimeupdate),kt(i,"play",this.onPlay),kt(i,"pause",this.onPause)},n.onMediaAttached=function(e,t){var i=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!s){this.clearScheduleState();var l=this.findItemIndex(i);this.setSchedulePosition(l)}},n.clearScheduleState=function(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null},n.onMediaDetaching=function(e,t){var i=!!t.transferMedia,s=this.media;if(this.media=null,!i&&(s&&this.removeMediaListeners(s),this.detachedData)){var l=this.getBufferingPlayer();l&&(this.log("Removing schedule state for detachedData and "+l),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}},n.isInterstitial=function(e){return!!(e!=null&&e.event)},n.retreiveMediaSource=function(e,t){var i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)},n.transferMediaFromPlayer=function(e,t){var i=e.interstitial.appendInPlace,s=e.media;if(i&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}var l=e.transferMedia();this.log("transfer MediaSource from "+e+" "+He(l)),this.detachedData=l}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))},n.transferMediaTo=function(e,t){var i,s=this,l;if(e.media!==t){var u=null,f=this.hls,d=e!==f,h=d&&e.interstitial.appendInPlace,c=(i=this.detachedData)==null?void 0:i.mediaSource,v;if(f.media)h&&(u=f.transferMedia(),this.detachedData=u),v="Primary";else if(c){var g=this.getBufferingPlayer();g?(u=g.transferMedia(),v=""+g):v="detached MediaSource"}else v="detached media";if(!u){if(c)u=this.detachedData,this.log("using detachedData: MediaSource "+He(u));else if(!this.detachedData||f.media===t){var m=this.playerQueue;m.length>1&&m.forEach(function(A){if(d&&A.interstitial.appendInPlace!==h){var x=A.interstitial;s.clearInterstitial(A.interstitial,null),x.appendInPlace=!1,x.appendInPlace&&s.warn("Could not change append strategy for queued assets "+x)}}),this.hls.detachMedia(),this.detachedData={media:t}}}var p=u&&"mediaSource"in u&&((l=u.mediaSource)==null?void 0:l.readyState)!=="closed",E=p&&u?u:t;this.log((p?"transfering MediaSource":"attaching media")+" to "+(d?e:"Primary")+" from "+v+" (media.currentTime: "+t.currentTime+")");var S=this.schedule;if(E===u&&S){var T=d&&e.assetId===S.assetIdAtEnd;E.overrides={duration:S.duration,endOfStream:!d||T,cueRemoval:!d}}e.attachMedia(E)}},n.onInterstitialCueEnter=function(){this.onTimeupdate()},n.checkStart=function(){var e=this.schedule,t=e?.events;if(!(!t||this.playbackDisabled||!this.media)){this.bufferedPos===-1&&(this.bufferedPos=0);var i=this.timelinePos,s=this.effectivePlayingItem;if(i===-1){var l=this.hls.startPosition;if(this.log(_n("checkStart",l)),this.timelinePos=l,t.length&&t[0].cue.pre){var u=e.findEventIndex(t[0].identifier);this.setSchedulePosition(u)}else if(l>=0||!this.primaryLive){var f=this.timelinePos=l>0?l:0,d=e.findItemIndexAtTime(f);this.setSchedulePosition(d)}}else if(s&&!this.playingItem){var h=e.findItemIndex(s);this.setSchedulePosition(h)}}},n.advanceAssetBuffering=function(e,t){var i=e.event,s=i.findAssetIndex(t),l=ja(i,s);if(!i.isAssetPastPlayoutLimit(l))this.bufferedToEvent(e,l);else if(this.schedule){var u,f=(u=this.schedule.items)==null?void 0:u[this.findItemIndex(e)+1];f&&this.bufferedToItem(f)}},n.advanceAfterAssetEnded=function(e,t,i){var s=ja(e,i);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){var u=this.schedule.items;if(u){var f=t+1,d=u.length;if(f>=d){this.setSchedulePosition(-1);return}var h=e.resumeTime;this.timelinePos<h&&(this.log(_n("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(f)}}}else{if(e.appendInPlace){var l=e.assetList[s];l&&this.advanceInPlace(l.timelineStart)}this.setSchedulePosition(t,s)}},n.setScheduleToAssetAtTime=function(e,t){var i=this.schedule;if(i){var s=t.parentIdentifier,l=i.getEvent(s);if(l){var u=i.findEventIndex(s),f=i.findAssetIndex(l,e);this.advanceAfterAssetEnded(l,u,f-1)}}},n.setSchedulePosition=function(e,t){var i,s=(i=this.schedule)==null?void 0:i.items;if(!(!s||this.playbackDisabled)){var l=e>=0?s[e]:null;this.log("setSchedulePosition "+e+", "+t+" ("+(l&&sr(l))+") pos: "+this.timelinePos);var u=this.waitingItem||this.playingItem,f=this.playingLastItem;if(this.isInterstitial(u)){var d=u.event,h=this.playingAsset,c=h?.identifier,v=c?this.getAssetPlayer(c):null;if(v&&c&&(!this.eventItemsMatch(u,l)||t!==void 0&&c!==d.assetList[t].identifier)){var g,m=d.findAssetIndex(h);if(this.log("INTERSTITIAL_ASSET_ENDED "+(m+1)+"/"+d.assetList.length+" "+Ei(h)),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(y.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:m,event:d,schedule:s.slice(0),scheduleIndex:e,player:v}),u!==this.playingItem){this.itemsMatch(u,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(d,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(c,l),v.media&&!((g=this.detachedData)!=null&&g.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(u,l)&&(this.endedItem=u,this.playingItem=null,this.log("INTERSTITIAL_ENDED "+d+" "+sr(u)),d.hasPlayed=!0,this.hls.trigger(y.INTERSTITIAL_ENDED,{event:d,schedule:s.slice(0),scheduleIndex:e}),d.cue.once)){var p;this.updateSchedule();var E=(p=this.schedule)==null?void 0:p.items;if(l&&E){var S=this.findItemIndex(l);this.advanceSchedule(S,E,t,u,f)}return}}this.advanceSchedule(e,s,t,u,f)}},n.advanceSchedule=function(e,t,i,s,l){var u=this,f=this.schedule;if(f){var d=t[e]||null,h=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(function(T){var A=T.interstitial,x=f.findEventIndex(A.identifier);(x<e||x>e+1)&&u.clearInterstitial(A,d)}),this.isInterstitial(d)){this.timelinePos=Math.min(Math.max(this.timelinePos,d.start),d.end);var v=d.event;if(i===void 0){i=f.findAssetIndex(v,this.timelinePos);var g=ja(v,i-1);if(v.isAssetPastPlayoutLimit(g)||v.appendInPlace&&this.timelinePos===d.end){this.advanceAfterAssetEnded(v,e,i);return}i=g}var m=this.waitingItem;this.assetsBuffered(d,h)||this.setBufferingItem(d);var p=this.preloadAssets(v,i);if(this.eventItemsMatch(d,m||s)||(this.waitingItem=d,this.log("INTERSTITIAL_STARTED "+sr(d)+" "+(v.appendInPlace?"append in place":"")),this.hls.trigger(y.INTERSTITIAL_STARTED,{event:v,schedule:t.slice(0),scheduleIndex:e})),!v.assetListLoaded){this.log("Waiting for ASSET-LIST to complete loading "+v);return}if(v.assetListLoader&&(v.assetListLoader.destroy(),v.assetListLoader=void 0),!h){this.log("Waiting for attachMedia to start Interstitial "+v);return}this.waitingItem=this.endedItem=null,this.playingItem=d;var E=v.assetList[i];if(!E){this.advanceAfterAssetEnded(v,e,i||0);return}if(p||(p=this.getAssetPlayer(E.identifier)),p===null||p.destroyed){var S=v.assetList.length;this.warn("asset "+(i+1)+"/"+S+" player destroyed "+v),p=this.createAssetPlayer(v,E,i),p.loadSource()}if(!this.eventItemsMatch(d,this.bufferingItem)&&v.appendInPlace&&this.isAssetBuffered(E))return;this.startAssetPlayer(p,i,t,e,h),this.shouldPlay&&El(p.media)}else d?(this.resumePrimary(d,e,s),this.shouldPlay&&El(this.hls.media)):l&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(f.durations.primary,null))}},n.resumePrimary=function(e,t,i){var s,l;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming "+sr(e)),!((s=this.detachedData)!=null&&s.mediaSource)){var u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(_n("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(i){var f=(l=this.schedule)==null?void 0:l.items;f&&(this.log("INTERSTITIALS_PRIMARY_RESUMED "+sr(e)),this.hls.trigger(y.INTERSTITIALS_PRIMARY_RESUMED,{schedule:f.slice(0),scheduleIndex:t}),this.checkBuffer())}},n.getPrimaryResumption=function(e,t){var i=e.start;if(this.primaryLive){var s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(i<s.fragmentStart||i>s.edge))return this.hls.liveSyncPosition||-1}return i},n.isAssetBuffered=function(e){var t=this.getAssetPlayer(e.identifier);if(t!=null&&t.hls)return t.hls.bufferedToEnd;var i=Se.bufferInfo(this.primaryMedia,this.timelinePos,0);return i.end+1>=e.timelineStart+(e.duration||0)},n.attachPrimary=function(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;var s=this.primaryMedia;if(s){var l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,s),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(_n("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}},n.startLoadingPrimaryAt=function(e,t){var i,s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((i=s.mainForwardBufferInfo)==null?void 0:i.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()},n.onManifestLoading=function(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(y.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(y.BUFFER_CODECS,this.onBufferCodecs,this)},n.onLevelUpdated=function(e,t){if(!(t.level===-1||!this.schedule)){var i=this.hls.levels[t.level],s=Te(Te({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}},n.onAudioTrackUpdated=function(e,t){var i=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Te(Te({},this.altSelection),{},{audio:i});return}var l=Te(Te({},s),{},{audio:i});this.mediaSelection=l},n.onSubtitleTrackUpdated=function(e,t){var i=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Te(Te({},this.altSelection),{},{subtitles:i});return}var l=Te(Te({},s),{},{subtitles:i});this.mediaSelection=l},n.onAudioTrackSwitching=function(e,t){var i=Ps(t);this.playerQueue.forEach(function(s){var l=s.hls;return l&&(l.setAudioOption(t)||l.setAudioOption(i))})},n.onSubtitleTrackSwitch=function(e,t){var i=Ps(t);this.playerQueue.forEach(function(s){var l=s.hls;return l&&(l.setSubtitleOption(t)||t.id!==-1&&l.setSubtitleOption(i))})},n.onBufferCodecs=function(e,t){var i=t.tracks;i&&(this.requiredTracks=i)},n.onBufferAppended=function(e,t){this.checkBuffer()},n.onBufferFlushed=function(e,t){var i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){var s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}},n.onBufferedToEnd=function(e){if(this.schedule){var t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(var i=0;i<t.length;i++){var s=t[i];if(s.cue.post){var l,u=this.schedule.findEventIndex(s.identifier),f=(l=this.schedule.items)==null?void 0:l[u];this.isInterstitial(f)&&this.eventItemsMatch(f,this.bufferingItem)&&this.bufferedToItem(f,0);break}}this.bufferedPos=Number.MAX_VALUE}}},n.onMediaEnded=function(e){var t=this.playingItem;if(!this.playingLastItem&&t){var i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1},n.updateItem=function(e,t){var i,s=(i=this.schedule)==null?void 0:i.items;if(e&&s){var l=this.findItemIndex(e,t);return s[l]||null}return null},n.trimInPlace=function(e,t){var i=this;if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach(function(f,d){e.event.isAssetPastPlayoutLimit(d)&&i.clearAssetPlayer(f.identifier,null)});var s=e.end+.25,l=Se.bufferInfo(this.primaryMedia,s,0);if(l.end>s||(l.nextStart||0)>s){this.log("trim buffered interstitial "+sr(e)+" (was "+sr(t)+")");var u=!0;this.attachPrimary(s,null,u),this.flushFrontBuffer(s)}}},n.itemsMatch=function(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))},n.eventItemsMatch=function(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))},n.findItemIndex=function(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1},n.updateSchedule=function(e){var t;e===void 0&&(e=!1);var i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))},n.checkBuffer=function(e){var t,i=(t=this.schedule)==null?void 0:t.items;if(i){var s=Se.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,i,e)}},n.updateBufferedPos=function(e,t,i){var s=this.schedule,l=this.bufferingItem;if(!(this.bufferedPos>e||!s)){if(t.length===1&&this.itemsMatch(t[0],l)){this.bufferedPos=e;return}var u=this.playingItem,f=this.findItemIndex(u),d=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var h,c=this.findItemIndex(l),v=Math.min(c+1,t.length-1),g=t[v];if((d===-1&&l&&e>=l.end||(h=g.event)!=null&&h.appendInPlace&&e+.01>=g.start)&&(d=v),this.isInterstitial(l)){var m=l.event;if(v-f>1&&m.appendInPlace===!1||m.assetList.length===0&&m.assetListLoader)return}if(this.bufferedPos=e,d>c&&d>f)this.bufferedToItem(g);else{var p=this.primaryDetails;this.primaryLive&&p&&e>p.edge-p.targetduration&&g.start<p.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(g)&&this.preloadAssets(g.event,0)}}else i&&u&&!this.itemsMatch(u,l)&&(d===f?this.bufferedToItem(u):d===f+1&&this.bufferedToItem(t[d]))}},n.assetsBuffered=function(e,t){var i=this,s=e.event.assetList;return s.length===0?!1:!e.event.assetList.some(function(l){var u=i.getAssetPlayer(l.identifier);return!(u!=null&&u.bufferedInPlaceToEnd(t))})},n.setBufferingItem=function(e){var t=this,i=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,i)&&s){var l=s.items,u=s.events;if(!l||!u)return i;var f=this.isInterstitial(e),d=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));var h=d?d.remaining:i?i.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY "+sr(e)+(i?" ("+h.toFixed(2)+" remaining)":"")),!this.playbackDisabled)if(f){var c=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach(function(v,g){var m=t.getAssetPlayer(v.identifier);m&&(g===c&&m.loadSource(),m.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(function(v){return v.pauseBuffering()});this.hls.trigger(y.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:u.slice(0),schedule:l.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return i},n.bufferedToItem=function(e,t){t===void 0&&(t=0);var i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;var s=this.detachedData;if(s)if(s.mediaSource){var l=!0;this.attachPrimary(e.start,e,l)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}},n.preloadPrimary=function(e){var t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)},n.bufferedToEvent=function(e,t){var i=e.event,s=i.assetList.length===0&&!i.assetListLoader,l=i.cue.once;if(s||!l){var u=this.preloadAssets(i,t);if(u!=null&&u.interstitial.appendInPlace){var f=this.primaryMedia;f&&this.bufferAssetPlayer(u,f)}}},n.preloadAssets=function(e,t){var i=e.assetUrl,s=e.assetList.length,l=s===0&&!e.assetListLoader,u=e.cue.once;if(l){var f=e.timelineStart;if(e.appendInPlace){var d,h=this.playingItem;!this.isInterstitial(h)&&(h==null||(d=h.nextEvent)==null?void 0:d.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}var c,v=0;if(!this.playingItem&&this.primaryLive&&(v=this.hls.startPosition,v===-1&&(v=this.hls.liveSyncPosition||0)),v&&!(e.cue.pre||e.cue.post)){var g=v-f;g>0&&(c=Math.round(g*1e3)/1e3)}if(this.log("Load interstitial asset "+(t+1)+"/"+(i?1:s)+" "+e+(c?" live-start: "+v+" start-offset: "+c:"")),i)return this.createAsset(e,0,0,f,e.duration,i);var m=this.assetListLoader.loadAssetList(e,c);m&&(e.assetListLoader=m)}else if(!u&&s){for(var p=t;p<s;p++){var E=e.assetList[p],S=this.getAssetPlayerQueueIndex(E.identifier);(S===-1||this.playerQueue[S].destroyed)&&!E.error&&this.createAssetPlayer(e,E,p)}var T=e.assetList[t];if(T){var A=this.getAssetPlayer(T.identifier);return A&&A.loadSource(),A}}return null},n.flushFrontBuffer=function(e){var t=this,i=this.requiredTracks;if(i){this.log("Removing front buffer starting at "+e);var s=Object.keys(i);s.forEach(function(l){t.hls.trigger(y.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:l})})}},n.getAssetPlayerQueueIndex=function(e){for(var t=this.playerQueue,i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1},n.getAssetPlayer=function(e){var t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null},n.getBufferingPlayer=function(){var e=this.playerQueue,t=this.primaryMedia;if(t){for(var i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null},n.createAsset=function(e,t,i,s,l,u){var f={parentIdentifier:e.identifier,identifier:dh(e,u,t),duration:l,startOffset:i,timelineStart:s,uri:u};return this.createAssetPlayer(e,f,t)},n.createAssetPlayer=function(e,t,i){var s=this,l=this.hls,u=l.userConfig,f=u.videoPreference,d=l.loadLevelObj||l.levels[l.currentLevel];(f||d)&&(f=ae({},f),d.videoCodec&&(f.videoCodec=d.videoCodec),d.videoRange&&(f.allowedVideoRanges=[d.videoRange]));var h=l.audioTracks[l.audioTrack],c=l.subtitleTracks[l.subtitleTrack],v=0;if(this.primaryLive||e.appendInPlace){var g=this.timelinePos-t.timelineStart;if(g>1){var m=t.duration;m&&g<m&&(v=g)}}var p=t.identifier,E=Te(Te({},u),{},{maxMaxBufferLength:Math.min(180,l.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:l.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:l.bandwidthEstimate,interstitialsController:void 0,startPosition:v,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:f,audioPreference:h||u.audioPreference,subtitlePreference:c||u.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(E.timelineOffset=t.timelineStart));var S=E.cmcd;S!=null&&S.sessionId&&S.contentId&&(E.cmcd=ae({},S,{contentId:Hi(t.uri)})),this.getAssetPlayer(p)&&this.warn("Duplicate date range identifier "+e+" and asset "+p);var T=new vh(this.HlsPlayerClass,E,e,t);this.playerQueue.push(T),e.assetList[i]=t;var A=!0,x=function(L){if(L.live){var I,P=new Error("Interstitials MUST be VOD assets "+e),U={fatal:!0,type:W.OTHER_ERROR,details:_.INTERSTITIAL_ASSET_ITEM_ERROR,error:P},w=((I=s.schedule)==null?void 0:I.findEventIndex(e.identifier))||-1;s.handleAssetItemError(U,e,w,i,P.message);return}var O=L.edge-L.fragmentStart,K=t.duration;(A||K===null||O>K)&&(A=!1,s.log('Interstitial asset "'+p+'" duration change '+K+" > "+O),t.duration=O,s.updateSchedule())};T.on(y.LEVEL_UPDATED,function(R,L){var I=L.details;return x(I)}),T.on(y.LEVEL_PTS_UPDATED,function(R,L){var I=L.details;return x(I)}),T.on(y.EVENT_CUE_ENTER,function(){return s.onInterstitialCueEnter()});var b=function(L,I){var P=s.getAssetPlayer(p);if(P&&I.tracks){P.off(y.BUFFER_CODECS,b),P.tracks=I.tracks;var U=s.primaryMedia;s.bufferingAsset===P.assetItem&&U&&!P.media&&s.bufferAssetPlayer(P,U)}};T.on(y.BUFFER_CODECS,b);var D=function(){var L,I=s.getAssetPlayer(p);if(s.log("buffered to end of asset "+I),!(!I||!s.schedule)){var P=s.schedule.findEventIndex(e.identifier),U=(L=s.schedule.items)==null?void 0:L[P];s.isInterstitial(U)&&s.advanceAssetBuffering(U,t)}};T.on(y.BUFFERED_TO_END,D);var k=function(L){return function(){var I=s.getAssetPlayer(p);if(!(!I||!s.schedule)){s.shouldPlay=!0;var P=s.schedule.findEventIndex(e.identifier);s.advanceAfterAssetEnded(e,P,L)}}};return T.once(y.MEDIA_ENDED,k(i)),T.once(y.PLAYOUT_LIMIT_REACHED,k(1/0)),T.on(y.ERROR,function(R,L){if(s.schedule){var I=s.getAssetPlayer(p);if(L.details===_.BUFFER_STALLED_ERROR){if(I!=null&&I.appendInPlace){s.handleInPlaceStall(e);return}s.onTimeupdate(),s.checkBuffer(!0);return}s.handleAssetItemError(L,e,s.schedule.findEventIndex(e.identifier),i,"Asset player error "+L.error+" "+e)}}),T.on(y.DESTROYING,function(){var R=s.getAssetPlayer(p);if(!(!R||!s.schedule)){var L=new Error("Asset player destroyed unexpectedly "+p),I={fatal:!0,type:W.OTHER_ERROR,details:_.INTERSTITIAL_ASSET_ITEM_ERROR,error:L};s.handleAssetItemError(I,e,s.schedule.findEventIndex(e.identifier),i,L.message)}}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED "+Ei(t)),this.hls.trigger(y.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:T}),T},n.clearInterstitial=function(e,t){var i=this;e.assetList.forEach(function(s){i.clearAssetPlayer(s.identifier,t)}),e.reset()},n.resetAssetPlayer=function(e){var t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log('reset asset player "'+e+'" after error');var i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}},n.clearAssetPlayer=function(e,t){var i=this.getAssetPlayerQueueIndex(e);if(i!==-1){var s=this.playerQueue[i];this.log("clear "+s+" toSegment: "+(t&&sr(t))),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(i,1),s.destroy()}},n.emptyPlayerQueue=function(){for(var e;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]},n.startAssetPlayer=function(e,t,i,s,l){var u=e.interstitial,f=e.assetItem,d=e.assetId,h=u.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=f,(!c||c.identifier!==d)&&(c&&(this.clearAssetPlayer(c.identifier,i[s]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED "+(t+1)+"/"+h+" "+Ei(f)),this.hls.trigger(y.INTERSTITIAL_ASSET_STARTED,{asset:f,assetListIndex:t,event:u,schedule:i.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,l)},n.bufferAssetPlayer=function(e,t){var i,s;if(this.schedule){var l=e.interstitial,u=e.assetItem,f=this.schedule.findEventIndex(l.identifier),d=(i=this.schedule.items)==null?void 0:i[f];if(d){e.loadSource(),this.setBufferingItem(d),this.bufferingAsset=u;var h=this.getBufferingPlayer();if(h!==e){var c=l.appendInPlace;if(!(c&&h?.interstitial.appendInPlace===!1)){var v=h?.tracks||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(c&&u!==this.playingAsset){if(!e.tracks){this.log("Waiting for track info before buffering "+e);return}if(v&&!ot(v,e.tracks)){var g=new Error("Asset "+Ei(u)+" SourceBuffer tracks ('"+Object.keys(e.tracks)+"') are not compatible with primary content tracks ('"+Object.keys(v)+"')"),m={fatal:!0,type:W.OTHER_ERROR,details:_.INTERSTITIAL_ASSET_ITEM_ERROR,error:g},p=l.findAssetIndex(u);this.handleAssetItemError(m,l,f,p,g.message);return}}this.transferMediaTo(e,t)}}}}},n.handleInPlaceStall=function(e){var t=this.schedule,i=this.primaryMedia;if(!(!t||!i)){var s=i.currentTime,l=t.findAssetIndex(e,s),u=e.assetList[l];if(u){var f=this.getAssetPlayer(u.identifier);if(f){var d=f.currentTime||s-u.timelineStart,h=f.duration-d;if(this.warn("Stalled at "+d+" of "+(d+h)+" in "+f+" "+e+" (media.currentTime: "+s+")"),d&&(h/i.playbackRate<.5||f.bufferedInPlaceToEnd(i))&&f.hls){var c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,l)}}}}},n.advanceInPlace=function(e){var t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)},n.handleAssetItemError=function(e,t,i,s,l){if(e.details!==_.BUFFER_STALLED_ERROR){var u=t.assetList[s]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR "+(u&&Ei(u))+" "+e.error),!!this.schedule){var f=u?.identifier||"",d=this.getAssetPlayerQueueIndex(f),h=this.playerQueue[d]||null,c=this.schedule.items,v=ae({},e,{fatal:!1,errorAction:di(!0),asset:u,assetListIndex:s,event:t,schedule:c,scheduleIndex:i,player:h});if(this.hls.trigger(y.INTERSTITIAL_ASSET_ERROR,v),!!e.fatal){var g=this.playingAsset,m=this.bufferingAsset,p=new Error(l);if(u&&(this.clearAssetPlayer(f,null),u.error=p),!t.assetList.some(function(S){return!S.error}))t.error=p;else for(var E=s;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):g&&g.identifier===f?this.advanceAfterAssetEnded(t,i,s):m&&m.identifier===f&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,m)}}}},n.primaryFallback=function(e){var t=e.timelineStart,i=this.effectivePlayingItem;if(i){this.log('Fallback to primary from event "'+e.identifier+'" start: '+t+" pos: "+this.timelinePos+" playing: "+sr(i)+" error: "+e.error);var s=this.timelinePos;s===-1&&(s=this.hls.startPosition);var l=this.updateItem(i,s);if(this.itemsMatch(i,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;var u=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(u)}else this.checkStart()},n.onAssetListLoaded=function(e,t){var i,s=this,l,u=t.event,f=u.identifier,d=t.assetListResponse.ASSETS;if((i=this.schedule)!=null&&i.hasEvent(f)){var h=u.timelineStart,c=u.duration,v=0;d.forEach(function(k,R){var L=parseFloat(k.DURATION);s.createAsset(u,R,v,h+v,L,k.URI),v+=L}),u.duration=v,this.log("Loaded asset-list with duration: "+v+" (was: "+c+") "+u);var g=this.waitingItem,m=g?.event.identifier===f;this.updateSchedule();var p=(l=this.bufferingItem)==null?void 0:l.event;if(m){var E,S=this.schedule.findEventIndex(f),T=(E=this.schedule.items)==null?void 0:E[S];if(T){if(!this.playingItem&&this.timelinePos>T.end){var A=this.schedule.findItemIndexAtTime(this.timelinePos);if(A!==S){u.error=new Error("Interstitial no longer within playback range "+this.timelinePos+" "+u),this.updateSchedule(!0),this.primaryFallback(u);return}}this.setBufferingItem(T)}this.setSchedulePosition(S)}else if(p?.identifier===f){var x=u.assetList[0];if(x){var b=this.getAssetPlayer(x.identifier);if(p.appendInPlace){var D=this.primaryMedia;b&&D&&this.bufferAssetPlayer(b,D)}else b&&b.loadSource()}}}},n.onError=function(e,t){if(this.schedule)switch(t.details){case _.ASSET_LIST_PARSING_ERROR:case _.ASSET_LIST_LOAD_ERROR:case _.ASSET_LIST_LOAD_TIMEOUT:{var i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case _.BUFFER_STALLED_ERROR:{var s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log("Primary player stall @"+this.timelinePos+" bufferedPos: "+this.bufferedPos),this.onTimeupdate(),this.checkBuffer(!0);break}}},Y(o,[{key:"interstitialsManager",get:function(){if(!this.hls)return null;if(this.manager)return this.manager;var e=this,t=function(){return e.bufferingItem||e.waitingItem},i=function(g){return g&&e.getAssetPlayer(g.identifier)},s=function(g,m,p,E,S){if(g){var T=g[m].start,A=g.event;if(A){if(m==="playout"||A.timelineOccupancy!==Rn.Point){var x=i(p);x?.interstitial===A&&(T+=x.assetItem.startOffset+x[S])}}else{var b=E==="bufferedPos"?u():e[E];T+=b-g.start}return T}return 0},l=function(g,m){var p;if(g!==0&&m!=="primary"&&(p=e.schedule)!=null&&p.length){var E,S=e.schedule.findItemIndexAtTime(g),T=(E=e.schedule.items)==null?void 0:E[S];if(T){var A=T[m].start-T.start;return g+A}}return g},u=function(){var g=e.bufferedPos;return g===Number.MAX_VALUE?f("primary"):Math.max(g,0)},f=function(g){var m,p;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:((p=e.schedule)==null?void 0:p.durations[g])||0},d=function(g,m){var p,E,S=e.effectivePlayingItem;if(!(S!=null&&(p=S.event)!=null&&p.restrictions.skip||!e.schedule)){e.log("seek to "+g+' "'+m+'"');var T=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(g,m),x=(E=e.schedule.items)==null?void 0:E[A],b=e.getBufferingPlayer(),D=b?.interstitial,k=D?.appendInPlace,R=T&&e.itemsMatch(T,x);if(T&&(k||R)){var L=i(e.playingAsset),I=L?.media||e.primaryMedia;if(I){var P=m==="primary"?I.currentTime:s(T,m,e.playingAsset,"timelinePos","currentTime"),U=g-P,w=(k?P:I.currentTime)+U;if(w>=0&&(!L||k||w<=L.duration)){I.currentTime=w;return}}}if(x){var O=g;if(m!=="primary"){var K=x[m].start,z=g-K;O=x.start+z}var X=!e.isInterstitial(x);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(X||x.event.appendInPlace)){var Q=e.media||(k?b?.media:null);Q&&(Q.currentTime=O)}else if(T){var ge=e.findItemIndex(T);if(A>ge){var $=e.schedule.findJumpRestrictedIndex(ge+1,A);if($>ge){e.setSchedulePosition($);return}}var J=0;if(X)e.timelinePos=O,e.checkBuffer();else for(var re=x.event.assetList,fe=g-(x[m]||x).start,_e=re.length;_e--;){var De=re[_e];if(De.duration&&fe>=De.startOffset&&fe<De.startOffset+De.duration){J=_e;break}}e.setSchedulePosition(A,J)}}}},h=function(){var g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;var m=t();return e.isInterstitial(m)?m:null},c={get bufferedEnd(){var v=t(),g=e.bufferingItem;if(g&&g===v){var m;return s(g,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-g.playout.start||((m=e.bufferingAsset)==null?void 0:m.startOffset)||0}return 0},get currentTime(){var v=h(),g=e.effectivePlayingItem;return g&&g===v?s(g,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-g.playout.start:0},set currentTime(v){var g=h(),m=e.effectivePlayingItem;m&&m===g&&d(v+m.playout.start,"playout")},get duration(){var v=h();return v?v.playout.end-v.playout.start:0},get assetPlayers(){var v,g=(v=h())==null?void 0:v.event.assetList;return g?g.map(function(m){return e.getAssetPlayer(m.identifier)}):[]},get playingIndex(){var v,g=(v=h())==null?void 0:v.event;return g&&e.effectivePlayingAsset?g.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return h()}};return this.manager={get events(){var v;return((v=e.schedule)==null||(v=v.events)==null?void 0:v.slice(0))||[]},get schedule(){var v;return((v=e.schedule)==null||(v=v.items)==null?void 0:v.slice(0))||[]},get interstitialPlayer(){return h()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){var v=t();return e.findItemIndex(v)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){var v=e.effectivePlayingItem;return e.findItemIndex(v)},primary:{get bufferedEnd(){return u()},get currentTime(){var v=e.timelinePos;return v>0?v:0},set currentTime(v){d(v,"primary")},get duration(){return f("primary")},get seekableStart(){var v;return((v=e.primaryDetails)==null?void 0:v.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(v){d(v,"integrated")},get duration(){return f("integrated")},get seekableStart(){var v;return l(((v=e.primaryDetails)==null?void 0:v.fragmentStart)||0,"integrated")}},skip:function(){var g=e.effectivePlayingItem,m=g?.event;if(m&&!m.restrictions.skip){var p=e.findItemIndex(g);if(m.appendInPlace){var E=g.playout.start+g.event.duration;d(E+.001,"playout")}else e.advanceAfterAssetEnded(m,p,1/0)}}}}},{key:"effectivePlayingItem",get:function(){return this.waitingItem||this.playingItem||this.endedItem}},{key:"effectivePlayingAsset",get:function(){return this.playingAsset||this.endedAsset}},{key:"playingLastItem",get:function(){var e,t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}},{key:"playbackStarted",get:function(){return this.effectivePlayingItem!==null}},{key:"currentTime",get:function(){var e,t;if(this.mediaSelection!==null){var i=this.waitingItem||this.playingItem;if(!(this.isInterstitial(i)&&!i.event.appendInPlace)){var s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);var l=(t=s)==null?void 0:t.currentTime;if(!(l===void 0||!H(l)))return l}}}},{key:"primaryMedia",get:function(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}},{key:"playbackDisabled",get:function(){return this.hls.config.enableInterstitialPlayback===!1}},{key:"primaryDetails",get:function(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}},{key:"primaryLive",get:function(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}}])})(te),Tl=500,yh=(function(a){function o(r,e,t){var i;return i=a.call(this,r,e,t,"subtitle-stream-controller",F.SUBTITLE)||this,i.currentTrackId=-1,i.tracksBuffered=[],i.mainDetails=null,i.registerListeners(),i}se(o,a);var n=o.prototype;return n.onHandlerDestroying=function(){this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this),this.mainDetails=null},n.registerListeners=function(){a.prototype.registerListeners.call(this);var e=this.hls;e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)},n.unregisterListeners=function(){a.prototype.unregisterListeners.call(this);var e=this.hls;e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this)},n.startLoad=function(e,t){this.stopLoad(),this.state=C.IDLE,this.setInterval(Tl),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()},n.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.mainDetails=null},n.onMediaDetaching=function(e,t){this.tracksBuffered=[],a.prototype.onMediaDetaching.call(this,e,t)},n.onLevelLoaded=function(e,t){this.mainDetails=t.details},n.onSubtitleFragProcessed=function(e,t){var i=t.frag,s=t.success;if(this.fragContextChanged(i)||(Ve(i)&&(this.fragPrevious=i),this.state=C.IDLE),!!s){var l=this.tracksBuffered[this.currentTrackId];if(l){for(var u,f=i.start,d=0;d<l.length;d++)if(f>=l[d].start&&f<=l[d].end){u=l[d];break}var h=i.start+i.duration;u?u.end=h:(u={start:f,end:h},l.push(u)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}}},n.onBufferFlushing=function(e,t){var i=t.startOffset,s=t.endOffset;if(i===0&&s!==Number.POSITIVE_INFINITY){var l=s-1;if(l<=0)return;t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(function(u){for(var f=0;f<u.length;){if(u[f].end<=l){u.shift();continue}else if(u[f].start<l)u[f].start=l;else break;f++}}),this.fragmentTracker.removeFragmentsInRange(i,l,F.SUBTITLE)}},n.onError=function(e,t){var i=t.frag;i?.type===F.SUBTITLE&&(t.details===_.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==C.STOPPED&&(this.state=C.IDLE))},n.onSubtitleTracksUpdated=function(e,t){var i=this,s=t.subtitleTracks;if(this.levels&&Qo(this.levels,s)){this.levels=s.map(function(l){return new wi(l)});return}this.tracksBuffered=[],this.levels=s.map(function(l){var u=new wi(l);return i.tracksBuffered[u.id]=[],u}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,F.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null},n.onSubtitleTrackSwitch=function(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}var s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==C.STOPPED&&this.setInterval(Tl)},n.onSubtitleTrackLoaded=function(e,t){var i,s=this.currentTrackId,l=this.levels,u=t.details,f=t.id;if(!l){this.warn("Subtitle tracks were reset while loading level "+f);return}var d=l[f];if(!(f>=l.length||!d)){this.log("Subtitle track "+f+" loaded ["+u.startSN+","+u.endSN+"]"+(u.lastPartSn?"[part-"+u.lastPartSn+"-"+u.lastPartIndex+"]":"")+",duration:"+u.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges;var h=0;if(u.live||(i=d.details)!=null&&i.live){if(u.deltaUpdateFailed)return;var c=this.mainDetails;if(!c){this.startFragRequested=!1;return}var v=c.fragments[0];if(!d.details)u.hasProgramDateTime&&c.hasProgramDateTime?(mn(u,c),h=u.fragmentStart):v&&(h=v.start,Sa(u,h));else{var g;h=this.alignPlaylists(u,d.details,(g=this.levelLastLoaded)==null?void 0:g.details),h===0&&v&&(h=v.start,Sa(u,h))}c&&!this.startFragRequested&&this.setStartPosition(c,h)}if(d.details=u,this.levelLastLoaded=d,f===s&&(this.hls.trigger(y.SUBTITLE_TRACK_UPDATED,{details:u,id:f,groupId:t.groupId}),this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===C.IDLE)){var m=Yr(null,u.fragments,this.media.currentTime,0);m||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)}}},n._handleFragmentLoadComplete=function(e){var t=this,i=e.frag,s=e.payload,l=i.decryptdata,u=this.hls;if(!this.fragContextChanged(i)&&s&&s.byteLength>0&&l!=null&&l.key&&l.iv&&ci(l.method)){var f=performance.now();this.decrypter.decrypt(new Uint8Array(s),l.key.buffer,l.iv.buffer,va(l.method)).catch(function(d){throw u.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:i}),d}).then(function(d){var h=performance.now();u.trigger(y.FRAG_DECRYPTED,{frag:i,payload:d,stats:{tstart:f,tdecrypt:h}})}).catch(function(d){t.warn(d.name+": "+d.message),t.state=C.IDLE})}},n.doTick=function(){if(!this.media){this.state=C.IDLE;return}if(this.state===C.IDLE){var e=this.currentTrackId,t=this.levels,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;var s=this.config,l=this.getLoadPosition(),u=Se.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,s.maxBufferHole),f=u.end,d=u.len,h=i.details,c=this.hls.maxBufferLength+h.levelTargetDuration;if(d>c)return;var v=h.fragments,g=v.length,m=h.edge,p=null,E=this.fragPrevious;if(f<m){var S=s.maxFragLookUpTolerance,T=f>m-S?0:S;p=Yr(E,v,Math.max(v[0].start,f),T),!p&&E&&E.start<v[0].start&&(p=v[0])}else p=v[g-1];if(p=this.filterReplacedPrimary(p,i.details),!p)return;var A=p.sn-h.startSN,x=v[A-1];if(x&&x.cc===p.cc&&this.fragmentTracker.getState(x)===lt.NOT_LOADED&&(p=x),this.fragmentTracker.getState(p)===lt.NOT_LOADED){var b=this.mapToInitFragWhenRequired(p);b&&this.loadFragment(b,i,f)}}},n.loadFragment=function(e,t,i){Ve(e)?a.prototype.loadFragment.call(this,e,t,i):this._loadInitSegment(e,t)},Y(o,[{key:"mediaBufferTimeRanges",get:function(){return new Eh(this.tracksBuffered[this.currentTrackId]||[])}}])})(Aa),Eh=function(o){this.buffered=void 0;var n=function(e,t,i){if(t=t>>>0,t>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+i+")");return o[t][e]};this.buffered={get length(){return o.length},end:function(e){return n("end",e,o.length)},start:function(e){return n("start",e,o.length)}}};function Sl(a,o){var n;try{n=new Event("addtrack")}catch{n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=a,o.dispatchEvent(n)}function Al(a,o){var n=a.mode;if(n==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(o.id))try{if(a.addCue(o),!a.cues.getCueById(o.id))throw new Error("addCue is failed for: "+o)}catch(e){Le.debug("[texttrack-utils]: "+e);try{var r=new self.TextTrackCue(o.startTime,o.endTime,o.text);r.id=o.id,a.addCue(r)}catch(t){Le.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+t)}}n==="disabled"&&(a.mode=n)}function Ti(a,o){var n=a.mode;if(n==="disabled"&&(a.mode="hidden"),a.cues)for(var r=a.cues.length;r--;)o&&a.cues[r].removeEventListener("enter",o),a.removeCue(a.cues[r]);n==="disabled"&&(a.mode=n)}function Xa(a,o,n,r){var e=a.mode;if(e==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0)for(var t=Sh(a.cues,o,n),i=0;i<t.length;i++)(!r||r(t[i]))&&a.removeCue(t[i]);e==="disabled"&&(a.mode=e)}function Th(a,o){if(o<=a[0].startTime)return 0;var n=a.length-1;if(o>a[n].endTime)return-1;for(var r=0,e=n,t;r<=e;)if(t=Math.floor((e+r)/2),o<a[t].startTime)e=t-1;else if(o>a[t].startTime&&r<n)r=t+1;else return t;return a[r].startTime-o<o-a[e].startTime?r:e}function Sh(a,o,n){var r=[],e=Th(a,o);if(e>-1)for(var t=e,i=a.length;t<i;t++){var s=a[t];if(s.startTime>=o&&s.endTime<=n)r.push(s);else if(s.startTime>n)return r}return r}function Dn(a){for(var o=[],n=0;n<a.length;n++){var r=a[n];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&o.push(a[n])}return o}var Ah=(function(a){function o(r){var e;return e=a.call(this,r,"subtitle-track-controller")||this,e.media=null,e.tracks=[],e.groupIds=null,e.tracksInGroup=[],e.trackId=-1,e.currentTrack=null,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.onTextTracksChanged=function(){if(e.useTextTrackPolling||self.clearInterval(e.subtitlePollingInterval),!(!e.media||!e.hls.config.renderTextTracksNatively)){for(var t=null,i=Dn(e.media.textTracks),s=0;s<i.length;s++)if(i[s].mode==="hidden")t=i[s];else if(i[s].mode==="showing"){t=i[s];break}var l=e.findTrackForTextTrack(t);e.subtitleTrack!==l&&e.setSubtitleTrack(l)}},e.registerListeners(),e}se(o,a);var n=o.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,a.prototype.destroy.call(this)},n.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.ERROR,this.onError,this)},n.onMediaAttached=function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)},n.onMediaDetaching=function(e,t){var i=this.media;if(i){var s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,!s){var l=Dn(i.textTracks);l.forEach(function(u){Ti(u)})}}},n.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},n.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},n.onSubtitleTrackLoaded=function(e,t){var i=t.id,s=t.groupId,l=t.details,u=this.tracksInGroup[i];if(!u||u.groupId!==s){this.warn("Subtitle track with id:"+i+" and group:"+s+" not found in active group "+u?.groupId);return}var f=u.details;u.details=t.details,this.log("Subtitle track "+i+' "'+u.name+'" lang:'+u.lang+" group:"+s+" loaded ["+l.startSN+"-"+l.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,t,f)},n.onLevelLoading=function(e,t){this.switchLevel(t.level)},n.onLevelSwitching=function(e,t){this.switchLevel(t.level)},n.switchLevel=function(e){var t=this.hls.levels[e];if(t){var i=t.subtitleGroups||null,s=this.groupIds,l=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(function(g){return s?.indexOf(g)===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var u=this.tracks.filter(function(g){return!i||i.indexOf(g.groupId)!==-1});if(u.length)this.selectDefaultTrack&&!u.some(function(g){return g.default})&&(this.selectDefaultTrack=!1),u.forEach(function(g,m){g.id=m});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=u;var f=this.hls.config.subtitlePreference;if(!l&&f){this.selectDefaultTrack=!1;var d=hr(f,u);if(d>-1)l=u[d];else{var h=hr(f,this.tracks);l=this.tracks[h]}}var c=this.findTrackId(l);c===-1&&l&&(c=this.findTrackId(null));var v={subtitleTracks:u};this.log("Updating subtitle tracks, "+u.length+' track(s) found in "'+i?.join(",")+'" group-id'),this.hls.trigger(y.SUBTITLE_TRACKS_UPDATED,v),c!==-1&&this.trackId===-1&&this.setSubtitleTrack(c)}}},n.findTrackId=function(e){for(var t=this.tracksInGroup,i=this.selectDefaultTrack,s=0;s<t.length;s++){var l=t[s];if(!(i&&!l.default||!i&&!e)&&(!e||Vr(l,e)))return s}if(e){for(var u=0;u<t.length;u++){var f=t[u];if(Ki(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(var d=0;d<t.length;d++){var h=t[d];if(Ki(e.attrs,h.attrs,["LANGUAGE"]))return d}}return-1},n.findTrackForTextTrack=function(e){if(e)for(var t=this.tracksInGroup,i=0;i<t.length;i++){var s=t[i];if(Ba(s,e))return i}return-1},n.onError=function(e,t){t.fatal||!t.context||t.context.type===N.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)},n.setSubtitleOption=function(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;var t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){var i=this.currentTrack;if(i&&Vr(e,i))return i;var s=hr(e,this.tracksInGroup);if(s>-1){var l=this.tracksInGroup[s];return this.setSubtitleTrack(s),l}else{if(i)return null;var u=hr(e,t);if(u>-1)return t[u]}}}return null},n.loadPlaylist=function(e){a.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)},n.loadingPlaylist=function(e,t){a.prototype.loadingPlaylist.call(this,e,t);var i=e.id,s=e.groupId,l=this.getUrlWithDirectives(e.url,t),u=e.details,f=u?.age;this.log("Loading subtitle "+i+' "'+e.name+'" lang:'+e.lang+" group:"+s+(t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+l),this.hls.trigger(y.SUBTITLE_TRACK_LOADING,{url:l,id:i,groupId:s,deliveryDirectives:t||null,track:e})},n.toggleTrackModes=function(){var e=this.media;if(e){var t=Dn(e.textTracks),i=this.currentTrack,s;if(i&&(s=t.filter(function(u){return Ba(i,u)})[0],s||this.warn('Unable to find subtitle TextTrack with name "'+i.name+'" and language "'+i.lang+'"')),[].slice.call(t).forEach(function(u){u.mode!=="disabled"&&u!==s&&(u.mode="disabled")}),s){var l=this.subtitleDisplay?"showing":"hidden";s.mode!==l&&(s.mode=l)}}},n.setSubtitleTrack=function(e){var t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!H(e)){this.warn("Invalid subtitle track id: "+e);return}this.selectDefaultTrack=!1;var i=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:e});return}var l=!!s.details&&!s.details.live;if(!(e===this.trackId&&s===i&&l)){this.log("Switching to subtitle-track "+e+(s?' "'+s.name+'" lang:'+s.lang+" group:"+s.groupId:""));var u=s.id,f=s.groupId,d=f===void 0?"":f,h=s.name,c=s.type,v=s.url;this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:u,groupId:d,name:h,type:c,url:v});var g=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(g)}},Y(o,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}}])})(Ua),xh={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},xl=function(o){return String.fromCharCode(xh[o]||o)},or=15,Ar=100,Lh={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ih={17:2,18:4,21:6,22:8,23:10,19:13,20:15},bh={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Rh={25:2,26:4,29:6,30:8,31:10,27:13,28:15},_h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Dh=(function(){function a(){this.time=null,this.verboseLevel=0}var o=a.prototype;return o.log=function(r,e){if(this.verboseLevel>=r){var t=typeof e=="function"?e():e;Le.log(this.time+" ["+r+"] "+t)}},a})(),Xr=function(o){for(var n=[],r=0;r<o.length;r++)n.push(o[r].toString(16));return n},Ll=(function(){function a(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var o=a.prototype;return o.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},o.setStyles=function(r){for(var e=["foreground","underline","italics","background","flash"],t=0;t<e.length;t++){var i=e[t];r.hasOwnProperty(i)&&(this[i]=r[i])}},o.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},o.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},o.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},o.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a})(),kh=(function(){function a(){this.uchar=" ",this.penState=new Ll}var o=a.prototype;return o.reset=function(){this.uchar=" ",this.penState.reset()},o.setChar=function(r,e){this.uchar=r,this.penState.copy(e)},o.setPenState=function(r){this.penState.copy(r)},o.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},o.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},o.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},a})(),Ph=(function(){function a(n){this.chars=[],this.pos=0,this.currPenState=new Ll,this.cueStartTime=null,this.logger=void 0;for(var r=0;r<Ar;r++)this.chars.push(new kh);this.logger=n}var o=a.prototype;return o.equals=function(r){for(var e=0;e<Ar;e++)if(!this.chars[e].equals(r.chars[e]))return!1;return!0},o.copy=function(r){for(var e=0;e<Ar;e++)this.chars[e].copy(r.chars[e])},o.isEmpty=function(){for(var r=!0,e=0;e<Ar;e++)if(!this.chars[e].isEmpty()){r=!1;break}return r},o.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ar&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ar)},o.moveCursor=function(r){var e=this.pos+r;if(r>1)for(var t=this.pos+1;t<e+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(e)},o.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},o.insertChar=function(r){var e=this;r>=144&&this.backSpace();var t=xl(r);if(this.pos>=Ar){this.logger.log(0,function(){return"Cannot insert "+r.toString(16)+" ("+t+") at position "+e.pos+". Skipping it!"});return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)},o.clearFromPos=function(r){var e;for(e=r;e<Ar;e++)this.chars[e].reset()},o.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},o.clearToEndOfRow=function(){this.clearFromPos(this.pos)},o.getTextString=function(){for(var r=[],e=!0,t=0;t<Ar;t++){var i=this.chars[t].uchar;i!==" "&&(e=!1),r.push(i)}return e?"":r.join("")},o.setPenStyles=function(r){this.currPenState.setStyles(r);var e=this.chars[this.pos];e.setPenState(this.currPenState)},a})(),za=(function(){function a(n){this.rows=[],this.currRow=or-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var r=0;r<or;r++)this.rows.push(new Ph(n));this.logger=n}var o=a.prototype;return o.reset=function(){for(var r=0;r<or;r++)this.rows[r].clear();this.currRow=or-1},o.equals=function(r){for(var e=!0,t=0;t<or;t++)if(!this.rows[t].equals(r.rows[t])){e=!1;break}return e},o.copy=function(r){for(var e=0;e<or;e++)this.rows[e].copy(r.rows[e])},o.isEmpty=function(){for(var r=!0,e=0;e<or;e++)if(!this.rows[e].isEmpty()){r=!1;break}return r},o.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},o.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},o.insertChar=function(r){var e=this.rows[this.currRow];e.insertChar(r)},o.setPen=function(r){var e=this.rows[this.currRow];e.setPenStyles(r)},o.moveCursor=function(r){var e=this.rows[this.currRow];e.moveCursor(r)},o.setCursor=function(r){this.logger.log(2,"setCursor: "+r);var e=this.rows[this.currRow];e.setCursor(r)},o.setPAC=function(r){this.logger.log(2,function(){return"pacData = "+He(r)});var e=r.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var t=0;t<or;t++)this.rows[t].clear();var i=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var l=s.rows[i].cueStartTime,u=this.logger.time;if(l!==null&&u!==null&&l<u)for(var f=0;f<this.nrRollUpRows;f++)this.rows[e-this.nrRollUpRows+f+1].copy(s.rows[i+f])}}this.currRow=e;var d=this.rows[this.currRow];if(r.indent!==null){var h=r.indent,c=Math.max(h-1,0);d.setCursor(r.indent),r.color=d.chars[c].penState.foreground}var v={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(v)},o.setBkgData=function(r){this.logger.log(2,function(){return"bkgData = "+He(r)}),this.backSpace(),this.setPen(r),this.insertChar(32)},o.setRollUpRows=function(r){this.nrRollUpRows=r},o.rollUp=function(){var r=this;if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,function(){return r.getDisplayText()});var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")},o.getDisplayText=function(r){r=r||!1;for(var e=[],t="",i=-1,s=0;s<or;s++){var l=this.rows[s].getTextString();l&&(i=s+1,r?e.push("Row "+i+": '"+l+"'"):e.push(l.trim()))}return e.length>0&&(r?t="["+e.join(" | ")+"]":t=e.join(`
`)),t},o.getTextAndFormat=function(){return this.rows},a})(),Il=(function(){function a(n,r,e){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new za(e),this.nonDisplayedMemory=new za(e),this.lastOutputScreen=new za(e),this.currRollUpRow=this.displayedMemory.rows[or-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=e}var o=a.prototype;return o.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[or-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},o.getHandler=function(){return this.outputFilter},o.setHandler=function(r){this.outputFilter=r},o.setPAC=function(r){this.writeScreen.setPAC(r)},o.setBkgData=function(r){this.writeScreen.setBkgData(r)},o.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(2,function(){return"MODE="+r}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},o.insertChars=function(r){for(var e=this,t=0;t<r.length;t++)this.writeScreen.insertChar(r[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+e.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,function(){return"DISPLAYED: "+e.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},o.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},o.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},o.ccAOF=function(){},o.ccAON=function(){},o.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},o.ccRU=function(r){this.logger.log(2,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},o.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},o.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},o.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},o.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},o.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},o.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},o.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},o.ccEOC=function(){var r=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+r.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},o.ccTO=function(r){this.logger.log(2,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},o.ccMIDROW=function(r){var e={flash:!1};if(e.underline=r%2===1,e.italics=r>=46,e.italics)e.foreground="white";else{var t=Math.floor(r/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=i[t]}this.logger.log(2,"MIDROW: "+He(e)),this.writeScreen.setPen(e)},o.outputDataUpdate=function(r){r===void 0&&(r=!1);var e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))},o.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},a})(),bl=(function(){function a(n,r,e){this.channels=void 0,this.currentChannel=0,this.cmdHistory=wh(),this.logger=void 0;var t=this.logger=new Dh;this.channels=[null,new Il(n,r,t),new Il(n+1,e,t)]}var o=a.prototype;return o.getHandler=function(r){return this.channels[r].getHandler()},o.setHandler=function(r,e){this.channels[r].setHandler(e)},o.addData=function(r,e){var t=this;this.logger.time=r;for(var i=function(f){var d=e[f]&127,h=e[f+1]&127,c=!1,v=null;if(d===0&&h===0)return 0;t.logger.log(3,function(){return"["+Xr([e[f],e[f+1]])+"] -> ("+Xr([d,h])+")"});var g=t.cmdHistory,m=d>=16&&d<=31;if(m){if(Ch(d,h,g))return kn(null,null,g),t.logger.log(3,function(){return"Repeated command ("+Xr([d,h])+") is dropped"}),0;kn(d,h,t.cmdHistory),c=t.parseCmd(d,h),c||(c=t.parseMidrow(d,h)),c||(c=t.parsePAC(d,h)),c||(c=t.parseBackgroundAttributes(d,h))}else kn(null,null,g);if(!c&&(v=t.parseChars(d,h),v)){var p=t.currentChannel;if(p&&p>0){var E=t.channels[p];E.insertChars(v)}else t.logger.log(2,"No channel found yet. TEXT-MODE?")}!c&&!v&&t.logger.log(2,function(){return"Couldn't parse cleaned data "+Xr([d,h])+" orig: "+Xr([e[f],e[f+1]])})},s,l=0;l<e.length;l+=2)s=i(l)},o.parseCmd=function(r,e){var t=(r===20||r===28||r===21||r===29)&&e>=32&&e<=47,i=(r===23||r===31)&&e>=33&&e<=35;if(!(t||i))return!1;var s=r===20||r===21||r===23?1:2,l=this.channels[s];return r===20||r===21||r===28||r===29?e===32?l.ccRCL():e===33?l.ccBS():e===34?l.ccAOF():e===35?l.ccAON():e===36?l.ccDER():e===37?l.ccRU(2):e===38?l.ccRU(3):e===39?l.ccRU(4):e===40?l.ccFON():e===41?l.ccRDC():e===42?l.ccTR():e===43?l.ccRTD():e===44?l.ccEDM():e===45?l.ccCR():e===46?l.ccENM():e===47&&l.ccEOC():l.ccTO(e-32),this.currentChannel=s,!0},o.parseMidrow=function(r,e){var t=0;if((r===17||r===25)&&e>=32&&e<=47){if(r===17?t=1:t=2,t!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[t];return i?(i.ccMIDROW(e),this.logger.log(3,function(){return"MIDROW ("+Xr([r,e])+")"}),!0):!1}return!1},o.parsePAC=function(r,e){var t,i=(r>=17&&r<=23||r>=25&&r<=31)&&e>=64&&e<=127,s=(r===16||r===24)&&e>=64&&e<=95;if(!(i||s))return!1;var l=r<=23?1:2;e>=64&&e<=95?t=l===1?Lh[r]:bh[r]:t=l===1?Ih[r]:Rh[r];var u=this.channels[l];return u?(u.setPAC(this.interpretPAC(t,e)),this.currentChannel=l,!0):!1},o.interpretPAC=function(r,e){var t,i={color:null,italics:!1,indent:null,underline:!1,row:r};return e>95?t=e-96:t=e-64,i.underline=(t&1)===1,t<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(t/2)]:t<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((t-16)/2)*4,i},o.parseChars=function(r,e){var t,i=null,s=null;if(r>=25?(t=2,s=r-8):(t=1,s=r),s>=17&&s<=19){var l;s===17?l=e+80:s===18?l=e+112:l=e+144,this.logger.log(2,function(){return"Special char '"+xl(l)+"' in channel "+t}),i=[l]}else r>=32&&r<=127&&(i=e===0?[r]:[r,e]);return i&&this.logger.log(3,function(){return"Char codes =  "+Xr(i).join(",")}),i},o.parseBackgroundAttributes=function(r,e){var t=(r===16||r===24)&&e>=32&&e<=47,i=(r===23||r===31)&&e>=45&&e<=47;if(!(t||i))return!1;var s,l={};r===16||r===24?(s=Math.floor((e-32)/2),l.background=_h[s],e%2===1&&(l.background=l.background+"_semi")):e===45?l.background="transparent":(l.foreground="black",e===47&&(l.underline=!0));var u=r<=23?1:2,f=this.channels[u];return f.setBkgData(l),!0},o.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var e=this.channels[r];e&&e.reset()}kn(null,null,this.cmdHistory)},o.cueSplitAtTime=function(r){for(var e=0;e<this.channels.length;e++){var t=this.channels[e];t&&t.cueSplitAtTime(r)}},a})();function kn(a,o,n){n.a=a,n.b=o}function Ch(a,o,n){return n.a===a&&n.b===o}function wh(){return{a:null,b:null}}var Qa=(function(){if(cn!=null&&cn.VTTCue)return self.VTTCue;var a=["","lr","rl"],o=["start","middle","end","left","right"];function n(s,l){if(typeof l!="string"||!Array.isArray(s))return!1;var u=l.toLowerCase();return~s.indexOf(u)?u:!1}function r(s){return n(a,s)}function e(s){return n(o,s)}function t(s){for(var l=arguments.length,u=new Array(l>1?l-1:0),f=1;f<l;f++)u[f-1]=arguments[f];for(var d=1;d<arguments.length;d++){var h=arguments[d];for(var c in h)s[c]=h[c]}return s}function i(s,l,u){var f=this,d={enumerable:!0};f.hasBeenReset=!1;var h="",c=!1,v=s,g=l,m=u,p=null,E="",S=!0,T="auto",A="start",x=50,b="middle",D=50,k="middle";Object.defineProperty(f,"id",t({},d,{get:function(){return h},set:function(L){h=""+L}})),Object.defineProperty(f,"pauseOnExit",t({},d,{get:function(){return c},set:function(L){c=!!L}})),Object.defineProperty(f,"startTime",t({},d,{get:function(){return v},set:function(L){if(typeof L!="number")throw new TypeError("Start time must be set to a number.");v=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",t({},d,{get:function(){return g},set:function(L){if(typeof L!="number")throw new TypeError("End time must be set to a number.");g=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",t({},d,{get:function(){return m},set:function(L){m=""+L,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",t({},d,{get:function(){return p},set:function(L){p=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",t({},d,{get:function(){return E},set:function(L){var I=r(L);if(I===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=I,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",t({},d,{get:function(){return S},set:function(L){S=!!L,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",t({},d,{get:function(){return T},set:function(L){if(typeof L!="number"&&L!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",t({},d,{get:function(){return A},set:function(L){var I=e(L);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");A=I,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",t({},d,{get:function(){return x},set:function(L){if(L<0||L>100)throw new Error("Position must be between 0 and 100.");x=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",t({},d,{get:function(){return b},set:function(L){var I=e(L);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");b=I,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",t({},d,{get:function(){return D},set:function(L){if(L<0||L>100)throw new Error("Size must be between 0 and 100.");D=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",t({},d,{get:function(){return k},set:function(L){var I=e(L);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");k=I,this.hasBeenReset=!0}})),f.displayState=void 0}return i.prototype.getCueAsHTML=function(){var s=self.WebVTT;return s.convertCueToDOMTree(self,this.text)},i})(),Mh=(function(){function a(){}var o=a.prototype;return o.decode=function(r,e){if(!r)return"";if(typeof r!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(r))},a})();function Rl(a){function o(r,e,t,i){return(r|0)*3600+(e|0)*60+(t|0)+parseFloat(i||0)}var n=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?o(n[2],n[3],0,n[4]):o(n[1],n[2],n[3],n[4]):null}var Oh=(function(){function a(){this.values=Object.create(null)}var o=a.prototype;return o.set=function(r,e){!this.get(r)&&e!==""&&(this.values[r]=e)},o.get=function(r,e,t){return t?this.has(r)?this.values[r]:e[t]:this.has(r)?this.values[r]:e},o.has=function(r){return r in this.values},o.alt=function(r,e,t){for(var i=0;i<t.length;++i)if(e===t[i]){this.set(r,e);break}},o.integer=function(r,e){/^-?\d+$/.test(e)&&this.set(r,parseInt(e,10))},o.percent=function(r,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var t=parseFloat(e);if(t>=0&&t<=100)return this.set(r,t),!0}return!1},a})();function _l(a,o,n,r){var e=r?a.split(r):[a];for(var t in e)if(typeof e[t]=="string"){var i=e[t].split(n);if(i.length===2){var s=i[0],l=i[1];o(s,l)}}}var $a=new Qa(0,0,""),Pn=$a.align==="middle"?"middle":"center";function Fh(a,o,n){var r=a;function e(){var s=Rl(a);if(s===null)throw new Error("Malformed timestamp: "+r);return a=a.replace(/^[^\sa-zA-Z-]+/,""),s}function t(s,l){var u=new Oh;_l(s,function(h,c){var v;switch(h){case"region":for(var g=n.length-1;g>=0;g--)if(n[g].id===c){u.set(h,n[g].region);break}break;case"vertical":u.alt(h,c,["rl","lr"]);break;case"line":v=c.split(","),u.integer(h,v[0]),u.percent(h,v[0])&&u.set("snapToLines",!1),u.alt(h,v[0],["auto"]),v.length===2&&u.alt("lineAlign",v[1],["start",Pn,"end"]);break;case"position":v=c.split(","),u.percent(h,v[0]),v.length===2&&u.alt("positionAlign",v[1],["start",Pn,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,c);break;case"align":u.alt(h,c,["start",Pn,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");var f=u.get("line","auto");f==="auto"&&$a.line===-1&&(f=-1),l.line=f,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Pn);var d=u.get("position","auto");d==="auto"&&$a.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function i(){a=a.replace(/^\s+/,"")}if(i(),o.startTime=e(),i(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);a=a.slice(3),i(),o.endTime=e(),i(),t(a,o)}function Dl(a){return a.replace(/<br(?: \/)?>/gi,`
`)}var Nh=(function(){function a(){this.state="INITIAL",this.buffer="",this.decoder=new Mh,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var o=a.prototype;return o.parse=function(r){var e=this;r&&(e.buffer+=e.decoder.decode(r,{stream:!0}));function t(){var d=e.buffer,h=0;for(d=Dl(d);h<d.length&&d[h]!=="\r"&&d[h]!==`
`;)++h;var c=d.slice(0,h);return d[h]==="\r"&&++h,d[h]===`
`&&++h,e.buffer=d.slice(h),c}function i(d){_l(d,function(h,c){},/:/)}try{var s="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;s=t();var l=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(l!=null&&l[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var u=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(u?u=!1:s=t(),e.state){case"HEADER":/:/.test(s)?i(s):s||(e.state="ID");continue;case"NOTE":s||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){e.state="NOTE";break}if(!s)continue;if(e.cue=new Qa(0,0,""),e.state="CUE",s.indexOf("-->")===-1){e.cue.id=s;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{Fh(s,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var f=s.indexOf("-->")!==-1;if(!s||f&&(u=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=s}continue;case"BADCUE":s||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},o.flush=function(){var r=this;try{if((r.cue||r.state==="HEADER")&&(r.buffer+=`

`,r.parse()),r.state==="INITIAL"||r.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){r.onparsingerror&&r.onparsingerror(e)}return r.onflush&&r.onflush(),this},a})(),Uh=/\r\n|\n\r|\n|\r/g,Ja=function(o,n,r){return r===void 0&&(r=0),o.slice(r,r+n.length)===n},Bh=function(o){var n=parseInt(o.slice(-3)),r=parseInt(o.slice(-6,-4)),e=parseInt(o.slice(-9,-7)),t=o.length>9?parseInt(o.substring(0,o.indexOf(":"))):0;if(!H(n)||!H(r)||!H(e)||!H(t))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+o);return n+=1e3*r,n+=60*1e3*e,n+=3600*1e3*t,n};function Za(a,o,n){return Hi(a.toString())+Hi(o.toString())+Hi(n)}var Gh=function(o,n,r){var e=o[n],t=o[e.prevCC];if(!t||!t.new&&e.new){o.ccOffset=o.presentationOffset=e.start,e.new=!1;return}for(;(i=t)!=null&&i.new;){var i;o.ccOffset+=e.start-t.start,e.new=!1,e=t,t=o[e.prevCC]}o.presentationOffset=r};function Kh(a,o,n,r,e,t,i){var s=new Nh,l=Me(new Uint8Array(a)).trim().replace(Uh,`
`).split(`
`),u=[],f=o?Kf(o.baseTime,o.timescale):0,d="00:00.000",h=0,c=0,v,g=!0;s.oncue=function(m){var p=n[r],E=n.ccOffset,S=(h-f)/9e4;if(p!=null&&p.new&&(c!==void 0?E=n.ccOffset=p.start:Gh(n,r,S)),S){if(!o){v=new Error("Missing initPTS for VTT MPEGTS");return}E=S-n.presentationOffset}var T=m.endTime-m.startTime,A=tr((m.startTime+E-c)*9e4,e*9e4)/9e4;m.startTime=Math.max(A,0),m.endTime=Math.max(A+T,0);var x=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(x)),m.id||(m.id=Za(m.startTime,m.endTime,x)),m.endTime>0&&u.push(m)},s.onparsingerror=function(m){v=m},s.onflush=function(){if(v){i(v);return}t(u)},l.forEach(function(m){if(g)if(Ja(m,"X-TIMESTAMP-MAP=")){g=!1,m.slice(16).split(",").forEach(function(p){Ja(p,"LOCAL:")?d=p.slice(6):Ja(p,"MPEGTS:")&&(h=parseInt(p.slice(7)))});try{c=Bh(d)/1e3}catch(p){v=p}return}else m===""&&(g=!1);s.parse(m+`
`)}),s.flush()}var es="stpp.ttml.im1t",kl=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Pl=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Vh={left:"start",center:"center",right:"end",start:"start",end:"end"};function Cl(a,o,n,r){var e=ye(new Uint8Array(a),["mdat"]);if(e.length===0){r(new Error("Could not parse IMSC1 mdat"));return}var t=e.map(function(s){return Me(s)}),i=Gf(o.baseTime,1,o.timescale);try{t.forEach(function(s){return n(Hh(s,i))})}catch(s){r(s)}}function Hh(a,o){var n=new DOMParser,r=n.parseFromString(a,"text/xml"),e=r.getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");var t={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(t).reduce(function(d,h){return d[h]=e.getAttribute("ttp:"+h)||t[h],d},{}),s=e.getAttribute("xml:space")!=="preserve",l=wl(ts(e,"styling","style")),u=wl(ts(e,"layout","region")),f=ts(e,"body","[begin]");return[].map.call(f,function(d){var h=Ml(d,s);if(!h||!d.hasAttribute("begin"))return null;var c=is(d.getAttribute("begin"),i),v=is(d.getAttribute("dur"),i),g=is(d.getAttribute("end"),i);if(c===null)throw Ol(d);if(g===null){if(v===null)throw Ol(d);g=c+v}var m=new Qa(c-o,g-o,h);m.id=Za(m.startTime,m.endTime,m.text);var p=u[d.getAttribute("region")],E=l[d.getAttribute("style")],S=Yh(p,E,l),T=S.textAlign;if(T){var A=Vh[T];A&&(m.lineAlign=A),m.align=T}return ae(m,S),m}).filter(function(d){return d!==null})}function ts(a,o,n){var r=a.getElementsByTagName(o)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function wl(a){return a.reduce(function(o,n){var r=n.getAttribute("xml:id");return r&&(o[r]=n),o},{})}function Ml(a,o){return[].slice.call(a.childNodes).reduce(function(n,r,e){var t;return r.nodeName==="br"&&e?n+`
`:(t=r.childNodes)!=null&&t.length?Ml(r,o):o?n+r.textContent.trim().replace(/\s+/g," "):n+r.textContent},"")}function Yh(a,o,n){var r="http://www.w3.org/ns/ttml#styling",e=null,t=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],i=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return i&&n.hasOwnProperty(i)&&(e=n[i]),t.reduce(function(s,l){var u=rs(o,r,l)||rs(a,r,l)||rs(e,r,l);return u&&(s[l]=u),s},{})}function rs(a,o,n){return a&&a.hasAttributeNS(o,n)?a.getAttributeNS(o,n):null}function Ol(a){return new Error("Could not parse ttml timestamp "+a)}function is(a,o){if(!a)return null;var n=Rl(a);return n===null&&(kl.test(a)?n=Wh(a,o):Pl.test(a)&&(n=qh(a,o))),n}function Wh(a,o){var n=kl.exec(a),r=(n[4]|0)+(n[5]|0)/o.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+r/o.frameRate}function qh(a,o){var n=Pl.exec(a),r=Number(n[1]),e=n[2];switch(e){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/o.frameRate;case"t":return r/o.tickRate}return r}var Cn=(function(){function a(n,r){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=n,this.trackName=r}var o=a.prototype;return o.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},o.newCue=function(r,e,t){(this.startTime===null||this.startTime>r)&&(this.startTime=r),this.endTime=e,this.screen=t,this.timelineController.createCaptionsTrack(this.trackName)},o.reset=function(){this.cueRanges=[],this.startTime=null},a})(),jh=(function(){function a(n){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ul(),this.captionsProperties=void 0,this.hls=n,this.config=n.config,this.Cues=n.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},n.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(y.MANIFEST_LOADING,this.onManifestLoading,this),n.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),n.on(y.FRAG_LOADING,this.onFragLoading,this),n.on(y.FRAG_LOADED,this.onFragLoaded,this),n.on(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),n.on(y.FRAG_DECRYPTED,this.onFragDecrypted,this),n.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),n.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}var o=a.prototype;return o.destroy=function(){var r=this.hls;r.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(y.FRAG_LOADING,this.onFragLoading,this),r.off(y.FRAG_LOADED,this.onFragLoaded,this),r.off(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.off(y.FRAG_DECRYPTED,this.onFragDecrypted,this),r.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0},o.initCea608Parsers=function(){var r=new Cn(this,"textTrack1"),e=new Cn(this,"textTrack2"),t=new Cn(this,"textTrack3"),i=new Cn(this,"textTrack4");this.cea608Parser1=new bl(1,r,e),this.cea608Parser2=new bl(3,t,i)},o.addCues=function(r,e,t,i,s){for(var l=!1,u=s.length;u--;){var f=s[u],d=Xh(f[0],f[1],e,t);if(d>=0&&(f[0]=Math.min(f[0],e),f[1]=Math.max(f[1],t),l=!0,d/(t-e)>.5))return}if(l||s.push([e,t]),this.config.renderTextTracksNatively){var h=this.captionsTracks[r];this.Cues.newCue(h,e,t,i)}else{var c=this.Cues.newCue(null,e,t,i);this.hls.trigger(y.CUES_PARSED,{type:"captions",cues:c,track:r})}},o.onInitPtsFound=function(r,e){var t=this,i=e.frag,s=e.id,l=e.initPTS,u=e.timescale,f=e.trackId,d=this.unparsedVttFrags;s===F.MAIN&&(this.initPTS[i.cc]={baseTime:l,timescale:u,trackId:f}),d.length&&(this.unparsedVttFrags=[],d.forEach(function(h){t.initPTS[h.frag.cc]?t.onFragLoaded(y.FRAG_LOADED,h):t.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))},o.getExistingTrack=function(r,e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var s=t.textTracks[i];if(Nl(s,{name:r,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null},o.createCaptionsTrack=function(r){this.config.renderTextTracksNatively?this.createNativeTrack(r):this.createNonNativeTrack(r)},o.createNativeTrack=function(r){if(!this.captionsTracks[r]){var e=this.captionsProperties,t=this.captionsTracks,i=this.media,s=e[r],l=s.label,u=s.languageCode,f=this.getExistingTrack(l,u);if(f)t[r]=f,Ti(t[r]),Sl(t[r],i);else{var d=this.createTextTrack("captions",l,u);d&&(d[r]=!0,t[r]=d)}}},o.createNonNativeTrack=function(r){if(!this.nonNativeCaptionsTracks[r]){var e=this.captionsProperties[r];if(e){var t=e.label,i={_id:r,label:t,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[r]=i,this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},o.createTextTrack=function(r,e,t){var i=this.media;if(i)return i.addTextTrack(r,e,t)},o.onMediaAttaching=function(r,e){this.media=e.media,e.mediaSource||this._cleanTracks()},o.onMediaDetaching=function(r,e){var t=!!e.transferMedia;if(this.media=null,!t){var i=this.captionsTracks;Object.keys(i).forEach(function(s){Ti(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}},o.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ul(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},o._cleanTracks=function(){var r=this.media;if(r){var e=r.textTracks;if(e)for(var t=0;t<e.length;t++)Ti(e[t])}},o.onSubtitleTracksUpdated=function(r,e){var t=this,i=e.subtitleTracks||[],s=i.some(function(c){return c.textCodec===es});if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var l=Qo(this.tracks,i);if(l){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var u=this.media,f=u?Dn(u.textTracks):null;if(this.tracks.forEach(function(c,v){var g;if(f){for(var m=null,p=0;p<f.length;p++)if(f[p]&&Nl(f[p],c)){m=f[p],f[p]=null;break}m&&(g=m)}if(g)Ti(g);else{var E=Fl(c);g=t.createTextTrack(E,c.name,c.lang),g&&(g.mode="disabled")}g&&t.textTracks.push(g)}),f!=null&&f.length){var d=f.filter(function(c){return c!==null}).map(function(c){return c.label});d.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: "+d.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var h=this.tracks.map(function(c){return{label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}});this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:h})}}},o.onManifestLoaded=function(r,e){var t=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(i){var s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(s){var l="textTrack"+s[1],u=t.captionsProperties[l];u&&(u.label=i.name,i.lang&&(u.languageCode=i.lang),u.media=i)}})},o.closedCaptionsForLevel=function(r){var e=this.hls.levels[r.level];return e?.attrs["CLOSED-CAPTIONS"]},o.onFragLoading=function(r,e){if(this.enabled&&e.frag.type===F.MAIN){var t,i,s=this.cea608Parser1,l=this.cea608Parser2,u=this.lastSn,f=e.frag,d=f.cc,h=f.sn,c=(t=(i=e.part)==null?void 0:i.index)!=null?t:-1;s&&l&&(h!==u+1||h===u&&c!==this.lastPartIndex+1||d!==this.lastCc)&&(s.reset(),l.reset()),this.lastCc=d,this.lastSn=h,this.lastPartIndex=c}},o.onFragLoaded=function(r,e){var t=e.frag,i=e.payload;if(t.type===F.SUBTITLE)if(i.byteLength){var s=t.decryptdata,l="stats"in e;if(s==null||!s.encrypted||l){var u=this.tracks[t.level],f=this.vttCCs;f[t.cc]||(f[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),u&&u.textCodec===es?this._parseIMSC1(t,i):this._parseVTTs(e)}}else this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},o._parseIMSC1=function(r,e){var t=this,i=this.hls;Cl(e,this.initPTS[r.cc],function(s){t._appendCues(s,r.level),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},function(s){i.logger.log("Failed to parse IMSC1: "+s),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:s})})},o._parseVTTs=function(r){var e,t=this,i=r.frag,s=r.payload,l=this.initPTS,u=this.unparsedVttFrags,f=l.length-1;if(!l[i.cc]&&f===-1){u.push(r);return}var d=this.hls,h=(e=i.initSegment)!=null&&e.data?Kt(i.initSegment.data,new Uint8Array(s)).buffer:s;Kh(h,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,function(c){t._appendCues(c,i.level),d.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},function(c){var v=c.message==="Missing initPTS for VTT MPEGTS";v?u.push(r):t._fallbackToIMSC1(i,s),d.logger.log("Failed to parse VTT cue: "+c),!(v&&f>i.cc)&&d.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:c})})},o._fallbackToIMSC1=function(r,e){var t=this,i=this.tracks[r.level];i.textCodec||Cl(e,this.initPTS[r.cc],function(){i.textCodec=es,t._parseIMSC1(r,e)},function(){i.textCodec="wvtt"})},o._appendCues=function(r,e){var t=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[e];if(!i||i.mode==="disabled")return;r.forEach(function(u){return Al(i,u)})}else{var s=this.tracks[e];if(!s)return;var l=s.default?"default":"subtitles"+e;t.trigger(y.CUES_PARSED,{type:"subtitles",cues:r,track:l})}},o.onFragDecrypted=function(r,e){var t=e.frag;t.type===F.SUBTITLE&&this.onFragLoaded(y.FRAG_LOADED,e)},o.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},o.onFragParsingUserdata=function(r,e){if(!(!this.enabled||!this.config.enableCEA708Captions)){var t=e.frag,i=e.samples;if(!(t.type===F.MAIN&&this.closedCaptionsForLevel(t)==="NONE"))for(var s=0;s<i.length;s++){var l=i[s].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();var u=this.extractCea608Data(l);this.cea608Parser1.addData(i[s].pts,u[0]),this.cea608Parser2.addData(i[s].pts,u[1])}}}},o.onBufferFlushing=function(r,e){var t=e.startOffset,i=e.endOffset,s=e.endOffsetSubtitles,l=e.type,u=this.media;if(!(!u||u.currentTime<i)){if(!l||l==="video"){var f=this.captionsTracks;Object.keys(f).forEach(function(h){return Xa(f[h],t,i)})}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){var d=this.textTracks;Object.keys(d).forEach(function(h){return Xa(d[h],t,s)})}}},o.extractCea608Data=function(r){for(var e=[[],[]],t=r[0]&31,i=2,s=0;s<t;s++){var l=r[i++],u=127&r[i++],f=127&r[i++];if(!(u===0&&f===0)){var d=(4&l)!==0;if(d){var h=3&l;(h===0||h===1)&&(e[h].push(u),e[h].push(f))}}}return e},a})();function Fl(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function Nl(a,o){return!!a&&a.kind===Fl(o)&&Ba(o,a)}function Xh(a,o,n,r){return Math.min(o,r)-Math.max(a,n)}function Ul(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var zh=/\s/,Qh={newCue:function(o,n,r,e){for(var t=[],i,s,l,u,f,d=self.VTTCue||self.TextTrackCue,h=0;h<e.rows.length;h++)if(i=e.rows[h],l=!0,u=0,f="",!i.isEmpty()){for(var c,v=0;v<i.chars.length;v++)zh.test(i.chars[v].uchar)&&l?u++:(f+=i.chars[v].uchar,l=!1);i.cueStartTime=n,n===r&&(r+=1e-4),u>=16?u--:u++;var g=Dl(f.trim()),m=Za(n,r,g);o!=null&&(c=o.cues)!=null&&c.getCueById(m)||(s=new d(n,r,g),s.id=m,s.line=h+1,s.align="left",s.position=10+Math.min(80,Math.floor(u*8/32)*10),t.push(s))}return o&&t.length&&(t.sort(function(p,E){return p.line==="auto"||E.line==="auto"?0:p.line>8&&E.line>8?E.line-p.line:p.line-E.line}),t.forEach(function(p){return Al(o,p)})),t}};function $h(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var Jh=/(\d+)-(\d+)\/(\d+)/,Bl=(function(){function a(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||rc,this.controller=new self.AbortController,this.stats=new ve}var o=a.prototype;return o.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},o.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},o.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},o.load=function(r,e,t){var i=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var l=Zh(r,this.controller.signal),u=r.responseType==="arraybuffer",f=u?"byteLength":"length",d=e.loadPolicy,h=d.maxTimeToFirstByteMs,c=d.maxLoadTimeMs;this.context=r,this.config=e,this.callbacks=t,this.request=this.fetchSetup(r,l),self.clearTimeout(this.requestTimeout),e.timeout=h&&H(h)?h:c,this.requestTimeout=self.setTimeout(function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(s,r,i.response))},e.timeout);var v=Wr(this.request)?this.request.then(self.fetch):self.fetch(this.request);v.then(function(g){var m;i.response=i.loader=g;var p=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(i.requestTimeout),e.timeout=c,i.requestTimeout=self.setTimeout(function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(s,r,i.response))},c-(p-s.loading.start)),!g.ok){var E=g.status,S=g.statusText;throw new ic(S||"fetch, bad network response",E,g)}s.loading.first=p,s.total=tc(g.headers)||s.total;var T=(m=i.callbacks)==null?void 0:m.onProgress;return T&&H(e.highWaterMark)?i.loadProgressively(g,s,r,e.highWaterMark,T):u?g.arrayBuffer():r.responseType==="json"?g.json():g.text()}).then(function(g){var m,p,E=i.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(i.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var S=g[f];S&&(s.loaded=s.total=S);var T={url:E.url,data:g,code:E.status},A=(m=i.callbacks)==null?void 0:m.onProgress;A&&!H(e.highWaterMark)&&A(s,r,g,E),(p=i.callbacks)==null||p.onSuccess(T,s,r,E)}).catch(function(g){var m;if(self.clearTimeout(i.requestTimeout),!s.aborted){var p=g&&g.code||0,E=g?g.message:null;(m=i.callbacks)==null||m.onError({code:p,text:E},r,g?g.details:null,s)}})},o.getCacheAge=function(){var r=null;if(this.response){var e=this.response.headers.get("age");r=e?parseFloat(e):null}return r},o.getResponseHeader=function(r){return this.response?this.response.headers.get(r):null},o.loadProgressively=function(r,e,t,i,s){i===void 0&&(i=0);var l=new xo,u=r.body.getReader(),f=function(){return u.read().then(function(h){if(h.done)return l.dataLength&&s(e,t,l.flush().buffer,r),Promise.resolve(new ArrayBuffer(0));var c=h.value,v=c.length;return e.loaded+=v,v<i||l.dataLength?(l.push(c),l.dataLength>=i&&s(e,t,l.flush().buffer,r)):s(e,t,c.buffer,r),f()}).catch(function(){return Promise.reject()})};return f()},a})();function Zh(a,o){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:o,headers:new self.Headers(ae({},a.headers))};return a.rangeEnd&&n.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),n}function ec(a){var o=Jh.exec(a);if(o)return parseInt(o[2])-parseInt(o[1])+1}function tc(a){var o=a.get("Content-Range");if(o){var n=ec(o);if(H(n))return n}var r=a.get("Content-Length");if(r)return parseInt(r)}function rc(a,o){return new self.Request(a.url,o)}var ic=(function(a){function o(n,r,e){var t;return t=a.call(this,n)||this,t.code=void 0,t.details=void 0,t.code=r,t.details=e,t}return se(o,a),o})(ze(Error)),nc=/^age:\s*[\d.]+\s*$/im,Gl=(function(){function a(n){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=n&&n.xhrSetup||null,this.stats=new ve,this.retryDelay=0}var o=a.prototype;return o.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},o.abortInternal=function(){var r=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),r&&(r.onreadystatechange=null,r.onprogress=null,r.readyState!==4&&(this.stats.aborted=!0,r.abort()))},o.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},o.load=function(r,e,t){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=r,this.config=e,this.callbacks=t,this.loadInternal()},o.loadInternal=function(){var r=this,e=this.config,t=this.context;if(!(!e||!t)){var i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;var l=this.xhrSetup;l?Promise.resolve().then(function(){if(!(r.loader!==i||r.stats.aborted))return l(i,t.url)}).catch(function(u){if(!(r.loader!==i||r.stats.aborted))return i.open("GET",t.url,!0),l(i,t.url)}).then(function(){r.loader!==i||r.stats.aborted||r.openAndSendXhr(i,t,e)}).catch(function(u){var f;(f=r.callbacks)==null||f.onError({code:i.status,text:u.message},t,i,s)}):this.openAndSendXhr(i,t,e)}},o.openAndSendXhr=function(r,e,t){r.readyState||r.open("GET",e.url,!0);var i=e.headers,s=t.loadPolicy,l=s.maxTimeToFirstByteMs,u=s.maxLoadTimeMs;if(i)for(var f in i)r.setRequestHeader(f,i[f]);e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,self.clearTimeout(this.requestTimeout),t.timeout=l&&H(l)?l:u,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),r.send()},o.readystatechange=function(){var r=this.context,e=this.loader,t=this.stats;if(!(!r||!e)){var i=e.readyState,s=this.config;if(!t.aborted&&i>=2&&(t.loading.first===0&&(t.loading.first=Math.max(self.performance.now(),t.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(t.loading.first-t.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;var l=e.status,u=e.responseType==="text"?e.responseText:null;if(l>=200&&l<300){var f=u??e.response;if(f!=null){var d,h;t.loading.end=Math.max(self.performance.now(),t.loading.first);var c=e.responseType==="arraybuffer"?f.byteLength:f.length;t.loaded=t.total=c,t.bwEstimate=t.total*8e3/(t.loading.end-t.loading.first);var v=(d=this.callbacks)==null?void 0:d.onProgress;v&&v(t,r,f,e);var g={url:e.responseURL,data:f,code:l};(h=this.callbacks)==null||h.onSuccess(g,t,r,e);return}}var m=s.loadPolicy.errorRetry,p=t.retry,E={url:r.url,data:void 0,code:l};if(fn(m,p,!1,E))this.retry(m);else{var S;Le.error(l+" while loading "+r.url),(S=this.callbacks)==null||S.onError({code:l,text:e.statusText},r,e,t)}}}},o.loadtimeout=function(){if(this.config){var r=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(fn(r,e,!0))this.retry(r);else{var t;Le.warn("timeout while loading "+((t=this.context)==null?void 0:t.url));var i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}},o.retry=function(r){var e=this.context,t=this.stats;this.retryDelay=ua(r,t.retry),t.retry++,Le.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+e?.url+", retrying "+t.retry+"/"+r.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},o.loadprogress=function(r){var e=this.stats;e.loaded=r.loaded,r.lengthComputable&&(e.total=r.total)},o.getCacheAge=function(){var r=null;if(this.loader&&nc.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");r=e?parseFloat(e):null}return r},o.getResponseHeader=function(r){return this.loader&&new RegExp("^"+r+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(r):null},a})(),ac={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},sc=Te(Te({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Gl,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:vu,bufferController:ud,capLevelController:dd,errorController:Eu,fpsController:fh,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:$s,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:ac},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},oc()),{},{subtitleStreamController:yh,subtitleTrackController:Ah,timelineController:jh,audioStreamController:ad,audioTrackController:sd,emeController:gl,cmcdController:oh,contentSteeringController:uh,interstitialsController:ph});function oc(){return{cueHandler:Qh,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function lc(a,o,n){if((o.liveSyncDurationCount||o.liveMaxLatencyDurationCount)&&(o.liveSyncDuration||o.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(o.liveMaxLatencyDurationCount!==void 0&&(o.liveSyncDurationCount===void 0||o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(o.liveMaxLatencyDuration!==void 0&&(o.liveSyncDuration===void 0||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var r=ns(a),e=["manifest","level","frag"],t=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return e.forEach(function(i){var s=(i==="level"?"playlist":i)+"LoadPolicy",l=o[s]===void 0,u=[];t.forEach(function(f){var d=i+"Loading"+f,h=o[d];if(h!==void 0&&l){u.push(d);var c=r[s].default;switch(o[s]={default:c},f){case"TimeOut":c.maxLoadTimeMs=h,c.maxTimeToFirstByteMs=h;break;case"MaxRetry":c.errorRetry.maxNumRetry=h,c.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":c.errorRetry.retryDelayMs=h,c.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":c.errorRetry.maxRetryDelayMs=h,c.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&n.warn('hls.js config: "'+u.join('", "')+'" setting(s) are deprecated, use "'+s+'": '+He(o[s]))}),Te(Te({},r),o)}function ns(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(ns):Object.keys(a).reduce(function(o,n){return o[n]=ns(a[n]),o},{}):a}function uc(a,o){var n=a.loader;if(n!==Bl&&n!==Gl)o.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1;else{var r=$h();r&&(a.loader=Bl,a.progressive=!0,a.enableSoftwareAES=!0,o.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var wn=2,fc=.1,dc=.05,hc=100,cc=(function(a){function o(r,e){var t;return t=a.call(this,"gap-controller",r.logger)||this,t.hls=void 0,t.fragmentTracker=void 0,t.media=null,t.mediaSource=void 0,t.nudgeRetry=0,t.stallReported=!1,t.stalled=null,t.moved=!1,t.seeking=!1,t.buffered={},t.lastCurrentTime=0,t.ended=0,t.waiting=0,t.onMediaPlaying=function(){t.ended=0,t.waiting=0},t.onMediaWaiting=function(){var i;(i=t.media)!=null&&i.seeking||(t.waiting=self.performance.now(),t.tick())},t.onMediaEnded=function(){if(t.hls){var i;t.ended=((i=t.media)==null?void 0:i.currentTime)||1,t.hls.trigger(y.MEDIA_ENDED,{stalled:!1})}},t.hls=r,t.fragmentTracker=e,t.registerListeners(),t}se(o,a);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e&&(e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this))},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this))},n.destroy=function(){a.prototype.destroy.call(this),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0},n.onMediaAttached=function(e,t){this.setInterval(hc),this.mediaSource=t.mediaSource;var i=this.media=t.media;kt(i,"playing",this.onMediaPlaying),kt(i,"waiting",this.onMediaWaiting),kt(i,"ended",this.onMediaEnded)},n.onMediaDetaching=function(e,t){this.clearInterval();var i=this.media;i&&(Yt(i,"playing",this.onMediaPlaying),Yt(i,"waiting",this.onMediaWaiting),Yt(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0},n.onBufferAppended=function(e,t){this.buffered=t.timeRanges},n.tick=function(){var e;if(!(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)){var t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}},n.poll=function(e,t){var i,s,l=(i=this.hls)==null?void 0:i.config;if(l){var u=this.media;if(u){var f=u.seeking,d=this.seeking&&!f,h=!this.seeking&&f,c=u.paused&&!f||u.ended||u.playbackRate===0;if(this.seeking=f,e!==t){t&&(this.ended=0),this.moved=!0,f||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(h||d){d&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&u.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!1}));return}if(!Se.getBuffered(u).length){this.nudgeRetry=0;return}var v=Se.bufferInfo(u,e,0),g=v.nextStart||0,m=this.fragmentTracker;if(f&&m&&this.hls){var p=Kl(this.hls.inFlightFragments,e),E=v.len>wn,S=!g||p||g-e>wn&&!m.getPartialFragment(e);if(E||S)return;this.moved=!1}var T=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&m){var A=v.len>0;if(!A&&!g)return;var x=Math.max(g,v.start||0)-e,b=!!(T!=null&&T.live),D=b?T.targetduration*2:wn,k=Mn(e,m);if(x>0&&(x<=D||k)){u.paused||this._trySkipBufferHole(k);return}}var R=l.detectStallWithCurrentTimeMs,L=self.performance.now(),I=this.waiting,P=this.stalled;if(P===null)if(I>0&&L-I<R)P=this.stalled=I;else{this.stalled=L;return}var U=L-P;if(!f&&(U>=R||I)&&this.hls){var w;if(((w=this.mediaSource)==null?void 0:w.readyState)==="ended"&&!(T!=null&&T.live)&&Math.abs(e-(T?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(v),!this.media||!this.hls)return}var O=Se.bufferInfo(u,e,l.maxBufferHole);this._tryFixBufferStall(O,U,e)}}},n.stallResolved=function(e){var t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){var i=self.performance.now()-t;this.log("playback not stuck anymore @"+e+", after "+Math.round(i)+"ms"),this.stallReported=!1,this.waiting=0,this.hls.trigger(y.STALL_RESOLVED,{})}},n.nudgeOnVideoHole=function(e,t){var i,s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&s&&s.length>1&&e>s.end(0)){var l=Se.bufferedInfo(Se.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&t>=l.start){var u=Se.timeRangesToArray(s),f=Se.bufferedInfo(u,t,0).bufferedIndex;if(f>-1&&f<u.length-1){var d=Se.bufferedInfo(u,e,0).bufferedIndex,h=u[f].end,c=u[f+1].start;if((d===-1||d>f)&&c-h<1&&e-h<2){var v=new Error("nudging playhead to flush pipeline after video hole. currentTime: "+e+" hole: "+h+" -> "+c+" buffered index: "+d);this.warn(v.message),this.media.currentTime+=1e-6;var g=Mn(e,this.fragmentTracker);g&&"fragment"in g?g=g.fragment:g||(g=void 0);var m=Se.bufferInfo(this.media,e,0);this.hls.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,frag:g,buffer:m.len,bufferInfo:m})}}}}},n._tryFixBufferStall=function(e,t,i){var s,l,u=this.fragmentTracker,f=this.media,d=(s=this.hls)==null?void 0:s.config;if(!(!f||!u||!d)){var h=(l=this.hls)==null?void 0:l.latestLevelDetails,c=Mn(i,u);if(c||h!=null&&h.live&&i<h.fragmentStart){var v=this._trySkipBufferHole(c);if(v||!this.media)return}var g=e.buffered,m=this.adjacentTraversal(e,i);(g&&g.length>1&&e.len>d.maxBufferHole||e.nextStart&&(e.nextStart-i<d.maxBufferHole||m))&&(t>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}},n.adjacentTraversal=function(e,t){var i=this.fragmentTracker,s=e.nextStart;if(i&&s){var l=i.getFragAtPos(t,F.MAIN),u=i.getFragAtPos(s,F.MAIN);if(l&&u)return u.sn-l.sn<2}return!1},n._reportStall=function(e){var t=this.hls,i=this.media,s=this.stallReported,l=this.stalled;if(!s&&l!==null&&i&&t){this.stallReported=!0;var u=new Error("Playback stalling at @"+i.currentTime+" due to low buffer ("+He(e)+")");this.warn(u.message),t.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,fatal:!1,error:u,buffer:e.len,bufferInfo:e,stalled:{start:l}})}},n._trySkipBufferHole=function(e){var t,i=this.fragmentTracker,s=this.media,l=(t=this.hls)==null?void 0:t.config;if(!s||!i||!l)return 0;var u=s.currentTime,f=Se.bufferInfo(s,u,0),d=u<f.start?f.start:f.nextStart;if(d&&this.hls){var h=f.len<=l.maxBufferHole,c=f.len>0&&f.len<1&&s.readyState<3,v=d-u;if(v>0&&(h||c)){if(v>l.maxBufferHole){var g=!1;if(u===0){var m=i.getAppendedFrag(0,F.MAIN);m&&d<m.end&&(g=!0)}if(!g&&e){var p;if(!((p=this.hls.loadLevelObj)!=null&&p.details))return 0;var E=Kl(this.hls.inFlightFragments,d);if(E)return 0;for(var S=!1,T=e.end;T<d;){var A=Mn(T,i);if(A)T+=A.duration;else{S=!0;break}}if(S)return 0}}var x=Math.max(d+dc,u+fc);if(this.warn("skipping hole, adjusting currentTime from "+u+" to "+x),this.moved=!0,s.currentTime=x,!(e!=null&&e.gap)){var b=new Error("fragment loaded with buffer holes, seeking from "+u+" to "+x),D={type:W.MEDIA_ERROR,details:_.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:b,reason:b.message,buffer:f.len,bufferInfo:f};e&&("fragment"in e?D.part=e:D.frag=e),this.hls.trigger(y.ERROR,D)}return x}}return 0},n._tryNudgeBuffer=function(e){var t=this.hls,i=this.media,s=this.nudgeRetry,l=t?.config;if(!i||!l)return 0;var u=i.currentTime;if(this.nudgeRetry++,s<l.nudgeMaxRetry){var f=u+(s+1)*l.nudgeOffset,d=new Error("Nudging 'currentTime' from "+u+" to "+f);this.warn(d.message),i.currentTime=f,t.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{var h=new Error("Playhead still not moving while enough data buffered @"+u+" after "+l.nudgeMaxRetry+" nudges");this.error(h.message),t.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,error:h,fatal:!0,buffer:e.len,bufferInfo:e})}},Y(o,[{key:"hasBuffered",get:function(){return Object.keys(this.buffered).length>0}}])})(Vs);function Kl(a,o){var n=Vl(a.main);if(n&&n.start<=o)return n;var r=Vl(a.audio);return r&&r.start<=o?r:null}function Vl(a){if(!a)return null;switch(a.state){case C.IDLE:case C.STOPPED:case C.ENDED:case C.ERROR:return null}return a.frag}function Mn(a,o){return o.getAppendedFrag(a,F.MAIN)||o.getPartialFragment(a)}var vc=.25;function as(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function ss(a,o,n,r,e){var t=new a(o,n,"");try{t.value=r,e&&(t.type=e)}catch{t=new a(o,n,He(e?Te({type:e},r):r))}return t}var On=(function(){var a=as();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})(),gc=(function(){function a(n){var r=this;this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=function(){r.hls&&r.hls.trigger(y.EVENT_CUE_ENTER,{})},this.hls=n,this._registerListeners()}var o=a.prototype;return o.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null},o._registerListeners=function(){var r=this.hls;r&&(r.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))},o._unregisterListeners=function(){var r=this.hls;r&&(r.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))},o.onMediaAttaching=function(r,e){var t;this.media=e.media,((t=e.overrides)==null?void 0:t.cueRemoval)===!1&&(this.removeCues=!1)},o.onMediaAttached=function(){var r,e=(r=this.hls)==null?void 0:r.latestLevelDetails;e&&this.updateDateRangeCues(e)},o.onMediaDetaching=function(r,e){this.media=null;var t=!!e.transferMedia;t||(this.id3Track&&(this.removeCues&&Ti(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})},o.onManifestLoading=function(){this.dateRangeCuesAppended={}},o.createTrack=function(r){var e=this.getID3Track(r.textTracks);return e.mode="hidden",e},o.getID3Track=function(r){if(this.media){for(var e=0;e<r.length;e++){var t=r[e];if(t.kind==="metadata"&&t.label==="id3")return Sl(t,this.media),t}return this.media.addTextTrack("metadata","id3")}},o.onFragParsingMetadata=function(r,e){if(!(!this.media||!this.hls)){var t=this.hls.config,i=t.enableEmsgMetadataCues,s=t.enableID3MetadataCues;if(!(!i&&!s)){var l=e.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var u=as();if(u)for(var f=0;f<l.length;f++){var d=l[f].type;if(!(d===Qt.emsg&&!i||!s)){var h=ko(l[f].data),c=l[f].pts,v=c+l[f].duration;v>On&&(v=On);var g=v-c;g<=0&&(v=c+vc);for(var m=0;m<h.length;m++){var p=h[m];if(!Po(p)){this.updateId3CueEnds(c,d);var E=ss(u,c,v,p,d);E&&this.id3Track.addCue(E)}}}}}}},o.updateId3CueEnds=function(r,e){var t,i=(t=this.id3Track)==null?void 0:t.cues;if(i)for(var s=i.length;s--;){var l=i[s];l.type===e&&l.startTime<r&&l.endTime===On&&(l.endTime=r)}},o.onBufferFlushing=function(r,e){var t=e.startOffset,i=e.endOffset,s=e.type,l=this.id3Track,u=this.hls;if(u){var f=u.config,d=f.enableEmsgMetadataCues,h=f.enableID3MetadataCues;if(l&&(d||h)){var c;s==="audio"?c=function(g){return g.type===Qt.audioId3&&h}:s==="video"?c=function(g){return g.type===Qt.emsg&&d}:c=function(g){return g.type===Qt.audioId3&&h||g.type===Qt.emsg&&d},Xa(l,t,i,c)}}},o.onLevelUpdated=function(r,e){var t=e.details;this.updateDateRangeCues(t,!0)},o.onLevelPtsUpdated=function(r,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)},o.updateDateRangeCues=function(r,e){var t=this;if(!(!this.hls||!this.media)){var i=this.hls.config,s=i.assetPlayerId,l=i.timelineOffset,u=i.enableDateRangeMetadataCues,f=i.interstitialsController;if(u){var d=as();if(s&&l&&!f){var h=r.fragmentStart,c=r.fragmentEnd,v=this.assetCue;v?(v.startTime=h,v.endTime=c):d&&(v=this.assetCue=ss(d,h,c,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),v&&(v.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(v),v.addEventListener("enter",this.onEventCueEnter)))}if(r.hasProgramDateTime){var g=this.id3Track,m=r.dateRanges,p=Object.keys(m),E=this.dateRangeCuesAppended;if(g&&e){var S;if((S=g.cues)!=null&&S.length)for(var T=Object.keys(E).filter(function(R){return!p.includes(R)}),A=function(){var L,I=T[x],P=(L=E[I])==null?void 0:L.cues;delete E[I],P&&Object.keys(P).forEach(function(U){var w=P[U];if(w){w.removeEventListener("enter",t.onEventCueEnter);try{g.removeCue(w)}catch{}}})},x=T.length;x--;)A();else E=this.dateRangeCuesAppended={}}var b=r.fragments[r.fragments.length-1];if(!(p.length===0||!H(b?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var D=function(){var L=p[k],I=m[L],P=I.startTime,U=E[L],w=U?.cues||{},O=U?.durationKnown||!1,K=On,z=I.duration,X=I.endDate;if(X&&z!==null)K=P+z,O=!0;else if(I.endOnNext&&!O){var Q=p.reduce(function(Ye,qe){if(qe!==I.id){var Oe=m[qe];if(Oe.class===I.class&&Oe.startDate>I.startDate&&(!Ye||I.startDate<Ye.startDate))return Oe}return Ye},null);Q&&(K=Q.startTime,O=!0)}for(var ge=Object.keys(I.attr),$=0;$<ge.length;$++){var J=ge[$];if(Cu(J)){var re=w[J];if(re)O&&!(U!=null&&U.durationKnown)?re.endTime=K:Math.abs(re.startTime-P)>.01&&(re.startTime=P,re.endTime=K);else if(d){var fe=I.attr[J];wu(J)&&(fe=Re(fe));var _e={key:J,data:fe},De=ss(d,P,K,_e,Qt.dateRange);De&&(De.id=L,t.id3Track.addCue(De),w[J]=De,f&&(J==="X-ASSET-LIST"||J==="X-ASSET-URL")&&De.addEventListener("enter",t.onEventCueEnter))}}}E[L]={cues:w,dateRange:I,durationKnown:O}},k=0;k<p.length;k++)D()}}}}},a})(),mc=(function(){function a(n){var r=this;this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=function(){var e=r.media,t=r.levelDetails;if(!(!e||!t)){r.currentTime=e.currentTime;var i=r.computeLatency();if(i!==null){r._latency=i;var s=r.config,l=s.lowLatencyMode,u=s.maxLiveSyncPlaybackRate;if(!(!l||u===1||!t.live)){var f=r.targetLatency;if(f!==null){var d=i-f,h=Math.min(r.maxLatency,f+t.targetduration),c=d<h;if(c&&d>.05&&r.forwardBufferLength>1){var v=Math.min(2,Math.max(1,u)),g=Math.round(2/(1+Math.exp(-.75*d-r.edgeStalled))*20)/20,m=Math.min(v,Math.max(1,g));r.changeMediaPlaybackRate(e,m)}else e.playbackRate!==1&&e.playbackRate!==0&&r.changeMediaPlaybackRate(e,1)}}}}},this.hls=n,this.config=n.config,this.registerListeners()}var o=a.prototype;return o.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null},o.registerListeners=function(){var r=this.hls;r&&(r.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(y.ERROR,this.onError,this))},o.unregisterListeners=function(){var r=this.hls;r&&(r.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(y.ERROR,this.onError,this))},o.onMediaAttached=function(r,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)},o.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)},o.onManifestLoading=function(){this._latency=null,this.stallCount=0},o.onLevelUpdated=function(r,e){var t=e.details;t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)},o.onError=function(r,e){var t;e.details===_.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(t=this.levelDetails)!=null&&t.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))},o.changeMediaPlaybackRate=function(r,e){var t,i;r.playbackRate!==e&&((t=this.hls)==null||t.logger.debug("[latency-controller]: latency="+this.latency.toFixed(3)+", targetLatency="+((i=this.targetLatency)==null?void 0:i.toFixed(3))+", forwardBufferLength="+this.forwardBufferLength.toFixed(3)+": adjusting playback rate from "+r.playbackRate+" to "+e),r.playbackRate=e)},o.estimateLiveEdge=function(){var r=this.levelDetails;return r===null?null:r.edge+r.age},o.computeLatency=function(){var r=this.estimateLiveEdge();return r===null?null:r-this.currentTime},Y(a,[{key:"levelDetails",get:function(){var r;return((r=this.hls)==null?void 0:r.latestLevelDetails)||null}},{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var r=this.config;if(r.liveMaxLatencyDuration!==void 0)return r.liveMaxLatencyDuration;var e=this.levelDetails;return e?r.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var r=this.levelDetails;if(r===null||this.hls===null)return null;var e=r.holdBack,t=r.partHoldBack,i=r.targetduration,s=this.config,l=s.liveSyncDuration,u=s.liveSyncDurationCount,f=s.lowLatencyMode,d=this.hls.userConfig,h=f&&t||e;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=l!==void 0?l:u*i);var c=i;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)},set:function(r){this.stallCount=0,this.config.liveSyncDuration=r,this._targetLatencyUpdated=!0}},{key:"liveSyncPosition",get:function(){var r=this.estimateLiveEdge(),e=this.targetLatency;if(r===null||e===null)return null;var t=this.levelDetails;if(t===null)return null;var i=t.edge,s=r-e-this.edgeStalled,l=i-t.totalduration,u=i-(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.min(Math.max(l,s),u)}},{key:"drift",get:function(){var r=this.levelDetails;return r===null?1:r.drift}},{key:"edgeStalled",get:function(){var r=this.levelDetails;if(r===null)return 0;var e=(this.config.lowLatencyMode&&r.partTarget||r.targetduration)*3;return Math.max(r.age-e,0)}},{key:"forwardBufferLength",get:function(){var r=this.media,e=this.levelDetails;if(!r||!e)return 0;var t=r.buffered.length;return(t?r.buffered.end(t-1):e.edge)-this.currentTime}}])})(),pc=(function(a){function o(r,e){var t;return t=a.call(this,r,"level-controller")||this,t._levels=[],t._firstLevel=-1,t._maxAutoLevel=-1,t._startLevel=void 0,t.currentLevel=null,t.currentLevelIndex=-1,t.manualLevelIndex=-1,t.steering=void 0,t.onParsedComplete=void 0,t.steering=e,t._registerListeners(),t}se(o,a);var n=o.prototype;return n._registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.ERROR,this.onError,this)},n._unregisterListeners=function(){var e=this.hls;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),a.prototype.destroy.call(this)},n.stopLoad=function(){var e=this._levels;e.forEach(function(t){t.loadError=0,t.fragmentError=0}),a.prototype.stopLoad.call(this)},n.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},n.onManifestLoading=function(e,t){this.resetLevels()},n.onManifestLoaded=function(e,t){var i=this,s=this.hls.config.preferManagedMediaSource,l=[],u={},f={},d=!1,h=!1,c=!1;t.levels.forEach(function(v){var g=v.attrs,m=v.audioCodec,p=v.videoCodec;m&&(v.audioCodec=m=Xt(m,s)||void 0),p&&(p=v.videoCodec=Vt(p));var E=v.width,S=v.height,T=v.unknownCodecs,A=T?T.length:0;if(T)for(var x=A;x--;){var b=T[x];i.isAudioSupported(b)?(v.audioCodec=m=m?m+","+b:b,A--,yr.audio[m.substring(0,4)]=2):i.isVideoSupported(b)&&(v.videoCodec=p=p?p+","+b:b,A--,yr.video[p.substring(0,4)]=2)}if(d||(d=!!(E&&S)),h||(h=!!p),c||(c=!!m),A||m&&!i.isAudioSupported(m)||p&&!i.isVideoSupported(p)){i.log('Some or all CODECS not supported "'+g.CODECS+'"');return}var D=g.CODECS,k=g["FRAME-RATE"],R=g["HDCP-LEVEL"],L=g["PATHWAY-ID"],I=g.RESOLUTION,P=g["VIDEO-RANGE"],U=(L||".")+"-",w=""+U+v.bitrate+"-"+I+"-"+k+"-"+D+"-"+P+"-"+R;if(u[w])if(u[w].uri!==v.url&&!v.attrs["PATHWAY-ID"]){var K=f[w]+=1;v.attrs["PATHWAY-ID"]=new Array(K+1).join(".");var z=i.createLevel(v);u[w]=z,l.push(z)}else u[w].addGroupId("audio",g.AUDIO),u[w].addGroupId("text",g.SUBTITLES);else{var O=i.createLevel(v);u[w]=O,f[w]=1,l.push(O)}}),this.filterAndSortMediaOptions(l,t,d,h,c)},n.createLevel=function(e){var t=new wi(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){var s=new Error('SUPPLEMENTAL-CODECS not supported "'+i.videoCodec+'"');this.log(s.message),t.supportedResult=an(s,[])}return t},n.isAudioSupported=function(e){return oi(e,"audio",this.hls.config.preferManagedMediaSource)},n.isVideoSupported=function(e){return oi(e,"video",this.hls.config.preferManagedMediaSource)},n.filterAndSortMediaOptions=function(e,t,i,s,l){var u=this,f=[],d=[],h=e;if((i||s)&&l&&(h=h.filter(function(k){var R=k.videoCodec,L=k.videoRange,I=k.width,P=k.height;return(!!R||!!(I&&P))&&la(L)})),h.length===0){Promise.resolve().then(function(){if(u.hls){var k="no level with compatible codecs found in manifest",R=k;t.levels.length&&(R="one or more CODECS in variant not supported: "+He(t.levels.map(function(I){return I.attrs.CODECS}).filter(function(I,P,U){return U.indexOf(I)===P})),u.warn(R),k+=" ("+R+")");var L=new Error(k);u.hls.trigger(y.ERROR,{type:W.MEDIA_ERROR,details:_.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:L,reason:R})}});return}t.audioTracks&&(f=t.audioTracks.filter(function(k){return!k.audioCodec||u.isAudioSupported(k.audioCodec)}),Hl(f)),t.subtitles&&(d=t.subtitles,Hl(d));var c=h.slice(0);h.sort(function(k,R){if(k.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(k.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&k.height!==R.height)return k.height-R.height;if(k.frameRate!==R.frameRate)return k.frameRate-R.frameRate;if(k.videoRange!==R.videoRange)return ui.indexOf(k.videoRange)-ui.indexOf(R.videoRange);if(k.videoCodec!==R.videoCodec){var L=Di(k.videoCodec),I=Di(R.videoCodec);if(L!==I)return I-L}if(k.uri===R.uri&&k.codecSet!==R.codecSet){var P=Dr(k.codecSet),U=Dr(R.codecSet);if(P!==U)return U-P}return k.averageBitrate!==R.averageBitrate?k.averageBitrate-R.averageBitrate:0});var v=c[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==c.length)){for(var g=0;g<c.length;g++)if(c[g].pathwayId===h[0].pathwayId){v=c[g];break}}this._levels=h;for(var m=0;m<h.length;m++)if(h[m]===v){var p;this._firstLevel=m;var E=v.bitrate,S=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+h.length+" level(s) found, first bitrate: "+E),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){var T=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);T>S&&S===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}var A=l&&!s,x=this.hls.config,b=!!(x.audioStreamController&&x.audioTrackController),D={levels:h,audioTracks:f,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:s,altAudio:b&&!A&&f.some(function(k){return!!k.url})};this.hls.trigger(y.MANIFEST_PARSED,D)},n.onError=function(e,t){t.fatal||!t.context||t.context.type===N.LEVEL&&t.context.level===this.level&&this.checkRetry(t)},n.onFragBuffered=function(e,t){var i=t.frag;if(i!==void 0&&i.type===F.MAIN){var s=i.elementaryStreams;if(!Object.keys(s).some(function(u){return!!s[u]}))return;var l=this._levels[i.level];l!=null&&l.loadError&&(this.log("Resetting level error count of "+l.loadError+" on frag buffered"),l.loadError=0)}},n.onLevelLoaded=function(e,t){var i,s=t.level,l=t.details,u=t.levelInfo;if(!u){var f;this.warn("Invalid level index "+s),(f=t.deliveryDirectives)!=null&&f.skip&&(l.deltaUpdateFailed=!0);return}if(u===this.currentLevel||t.withoutMultiVariant){u.fragmentError===0&&(u.loadError=0);var d=u.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(s,t,d)}else(i=t.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)},n.loadPlaylist=function(e){a.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)},n.loadingPlaylist=function(e,t){a.prototype.loadingPlaylist.call(this,e,t);var i=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],u=e.details,f=u?.age;this.log("Loading level index "+s+(t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:"")+(l?" Pathway "+l:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+i),this.hls.trigger(y.LEVEL_LOADING,{url:i,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})},n.removeLevel=function(e){var t=this,i;if(this._levels.length!==1){var s=this._levels.filter(function(u,f){return f!==e?!0:(t.steering&&t.steering.removeLevel(u),u===t.currentLevel&&(t.currentLevel=null,t.currentLevelIndex=-1,u.details&&u.details.fragments.forEach(function(d){return d.level=-1})),!1)});po(s),this._levels=s,this.currentLevelIndex>-1&&(i=this.currentLevel)!=null&&i.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);var l=s.length-1;this._firstLevel=Math.min(this._firstLevel,l),this._startLevel&&(this._startLevel=Math.min(this._startLevel,l)),this.hls.trigger(y.LEVELS_UPDATED,{levels:s})}},n.onLevelsUpdated=function(e,t){var i=t.levels;this._levels=i},n.checkMaxAutoUpdated=function(){var e=this.hls,t=e.autoLevelCapping,i=e.maxAutoLevel,s=e.maxHdcpLevel;this._maxAutoLevel!==i&&(this._maxAutoLevel=i,this.hls.trigger(y.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:i,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))},Y(o,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"loadLevelObj",get:function(){return this.currentLevel}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(t.length!==0){if(e<0||e>=t.length){var i=new Error("invalid level idx"),s=e<0;if(this.hls.trigger(y.ERROR,{type:W.OTHER_ERROR,details:_.LEVEL_SWITCH_ERROR,level:e,fatal:s,error:i,reason:i.message}),s)return;e=Math.min(e,t.length-1)}var l=this.currentLevelIndex,u=this.currentLevel,f=u?u.attrs["PATHWAY-ID"]:void 0,d=t[e],h=d.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=d,!(l===e&&u&&f===h)){this.log("Switching to level "+e+" ("+(d.height?d.height+"p ":"")+(d.videoRange?d.videoRange+" ":"")+(d.codecSet?d.codecSet+" ":"")+"@"+d.bitrate+")"+(h?" with Pathway "+h:"")+" from level "+l+(f?" with Pathway "+f:""));var c={level:e,attrs:d.attrs,details:d.details,bitrate:d.bitrate,averageBitrate:d.averageBitrate,maxBitrate:d.maxBitrate,realBitrate:d.realBitrate,width:d.width,height:d.height,codecSet:d.codecSet,audioCodec:d.audioCodec,videoCodec:d.videoCodec,audioGroups:d.audioGroups,subtitleGroups:d.subtitleGroups,loaded:d.loaded,loadError:d.loadError,fragmentError:d.fragmentError,name:d.name,id:d.id,uri:d.uri,url:d.url,urlId:0,audioGroupIds:d.audioGroupIds,textGroupIds:d.textGroupIds};this.hls.trigger(y.LEVEL_SWITCHING,c);var v=d.details;if(!v||v.live){var g=this.switchParams(d.uri,u?.details,v);this.loadPlaylist(g)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"pathways",get:function(){return this.steering?this.steering.pathways():[]}},{key:"pathwayPriority",get:function(){return this.steering?this.steering.pathwayPriority:null},set:function(e){if(this.steering){var t=this.steering.pathways(),i=e.filter(function(s){return t.indexOf(s)!==-1});if(e.length<1){this.warn("pathwayPriority "+e+" should contain at least one pathway from list: "+t);return}this.steering.pathwayPriority=i}}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}])})(Ua);function Hl(a){var o={};a.forEach(function(n){var r=n.groupId||"";n.id=o[r]=o[r]||0,o[r]++})}function Yl(){return self.SourceBuffer||self.WebKitSourceBuffer}function Wl(){var a=Ie();if(!a)return!1;var o=Yl();return!o||o.prototype&&typeof o.prototype.appendBuffer=="function"&&typeof o.prototype.remove=="function"}function yc(){if(!Wl())return!1;var a=Ie();return typeof a?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(o){return a.isTypeSupported(Kr(o,"video"))})||["mp4a.40.2","fLaC"].some(function(o){return a.isTypeSupported(Kr(o,"audio"))}))}function Ec(){var a,o=Yl();return typeof(o==null||(a=o.prototype)==null?void 0:a.changeType)=="function"}var Tc=100,Sc=(function(a){function o(r,e,t){var i;return i=a.call(this,r,e,t,"stream-controller",F.MAIN)||this,i.audioCodecSwap=!1,i.level=-1,i._forceStartLoad=!1,i._hasEnoughToStart=!1,i.altAudio=0,i.audioOnly=!1,i.fragPlaying=null,i.fragLastKbps=0,i.couldBacktrack=!1,i.backtrackFragment=null,i.audioCodecSwitch=!1,i.videoBuffer=null,i.onMediaPlaying=function(){i.tick()},i.onMediaSeeked=function(){var s=i.media,l=s?s.currentTime:null;if(!(l===null||!H(l))&&(i.log("Media seeked to "+l.toFixed(3)),!!i.getBufferedFrag(l))){var u=i.getFwdBufferInfoAtPos(s,l,F.MAIN,0);if(u===null||u.len===0){i.warn("Main forward buffer length at "+l+' on "seeked" event '+(u?u.len:"empty")+")");return}i.tick()}},i.registerListeners(),i}se(o,a);var n=o.prototype;return n.registerListeners=function(){a.prototype.registerListeners.call(this);var e=this.hls;e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},n.unregisterListeners=function(){a.prototype.unregisterListeners.call(this);var e=this.hls;e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)},n.onHandlerDestroying=function(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this)},n.startLoad=function(e,t){if(this.levels){var i=this.lastCurrentTime,s=this.hls;if(this.stopLoad(),this.setInterval(Tc),this.level=-1,!this.startFragRequested){var l=s.startLevel;l===-1&&(s.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=s.firstAutoLevel),s.nextLoadLevel=l,this.level=s.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),e=i),this.state=C.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=C.STOPPED},n.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},n.doTick=function(){switch(this.state){case C.WAITING_LEVEL:{var e=this.levels,t=this.level,i=e?.[t],s=i?.details;if(s&&(!s.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(s))break;this.state=C.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=C.IDLE;break}break}case C.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===C.IDLE&&this.doTickIdle(),this.onTickEnd()},n.onTickEnd=function(){var e;a.prototype.onTickEnd.call(this),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()},n.doTickIdle=function(){var e=this.hls,t=this.levelLastLoaded,i=this.levels,s=this.media;if(!(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)){var l=this.buffering?e.nextLoadLevel:e.loadLevel;if(i!=null&&i[l]){var u=i[l],f=this.getMainFwdBufferInfo();if(f!==null){var d=this.getLevelDetails();if(d&&this._streamEnded(f,d)){var h={};this.altAudio===2&&(h.type="video"),this.hls.trigger(y.BUFFER_EOS,h),this.state=C.ENDED;return}if(this.buffering){e.loadLevel!==l&&e.manualLevel===-1&&this.log("Adapting to level "+l+" from level "+this.level),this.level=e.nextLoadLevel=l;var c=u.details;if(!c||this.state===C.WAITING_LEVEL||this.waitForLive(u)){this.level=l,this.state=C.WAITING_LEVEL,this.startFragRequested=!1;return}var v=f.len,g=this.getMaxBufferLength(u.maxBitrate);if(!(v>=g)){this.backtrackFragment&&this.backtrackFragment.start>f.end&&(this.backtrackFragment=null);var m=this.backtrackFragment?this.backtrackFragment.start:f.end,p=this.getNextFragment(m,c);if(this.couldBacktrack&&!this.fragPrevious&&p&&Ve(p)&&this.fragmentTracker.getState(p)!==lt.OK){var E,S=((E=this.backtrackFragment)!=null?E:p).sn,T=S-c.startSN,A=c.fragments[T-1];A&&p.cc===A.cc&&(p=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&f.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,m)){var x=p.gap;if(!x){var b=this.audioOnly&&!this.altAudio?le.AUDIO:le.VIDEO,D=(b===le.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;D&&this.afterBufferFlushed(D,b,F.MAIN)}p=this.getNextFragmentLoopLoading(p,c,f,F.MAIN,g)}p&&(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,u,m))}}}}}},n.loadFragment=function(e,t,i){var s=this.fragmentTracker.getState(e);s===lt.NOT_LOADED||s===lt.PARTIAL?Ve(e)?this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e,t)):a.prototype.loadFragment.call(this,e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)},n.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,F.MAIN)},n.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},n.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},n.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(t!=null&&t.readyState){var i,s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);var l=this.getLevelDetails();if(l!=null&&l.live){var u=this.getMainFwdBufferInfo();if(!u||u.len<l.targetduration*2)return}if(!t.paused&&e){var f=this.hls.nextLoadLevel,d=e[f],h=this.fragLastKbps;h&&this.fragCurrent?i=this.fragCurrent.duration*d.maxBitrate/(1e3*h)+1:i=0}else i=0;var c=this.getBufferedFrag(t.currentTime+i);if(c){var v=this.followingBufferedFrag(c);if(v){this.abortCurrentFrag();var g=v.maxStartPTS?v.maxStartPTS:v.start,m=v.duration,p=Math.max(c.end,g+Math.min(Math.max(m-this.config.maxFragLookUpTolerance,m*(this.couldBacktrack?.5:.125)),m*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(p,Number.POSITIVE_INFINITY)}}}},n.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case C.KEY_LOADING:case C.FRAG_LOADING:case C.FRAG_LOADING_WAITING_RETRY:case C.PARSING:case C.PARSED:this.state=C.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},n.flushMainBuffer=function(e,t){a.prototype.flushMainBuffer.call(this,e,t,this.altAudio===2?"video":null)},n.onMediaAttached=function(e,t){a.prototype.onMediaAttached.call(this,e,t);var i=t.media;kt(i,"playing",this.onMediaPlaying),kt(i,"seeked",this.onMediaSeeked)},n.onMediaDetaching=function(e,t){var i=this.media;i&&(Yt(i,"playing",this.onMediaPlaying),Yt(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,a.prototype.onMediaDetaching.call(this,e,t);var s=!!t.transferMedia;s||(this._hasEnoughToStart=!1)},n.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1},n.onManifestParsed=function(e,t){for(var i=!1,s=!1,l=0;l<t.levels.length;l++){var u=t.levels[l].audioCodec;u&&(i=i||u.indexOf("mp4a.40.2")!==-1,s=s||u.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&s&&!Ec(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},n.onLevelLoading=function(e,t){var i=this.levels;if(!(!i||this.state!==C.IDLE)){var s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=C.WAITING_LEVEL)}},n.onLevelLoaded=function(e,t){var i,s=this.levels,l=this.startFragRequested,u=t.level,f=t.details,d=f.totalduration;if(!s){this.warn("Levels were reset while loading level "+u);return}this.log("Level "+u+" loaded ["+f.startSN+","+f.endSN+"]"+(f.lastPartSn?"[part-"+f.lastPartSn+"-"+f.lastPartIndex+"]":"")+", cc ["+f.startCC+", "+f.endCC+"] duration:"+d);var h=t.levelInfo,c=this.fragCurrent;c&&(this.state===C.FRAG_LOADING||this.state===C.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();var v=0;if(f.live||(i=h.details)!=null&&i.live){var g;if(this.checkLiveUpdate(f),f.deltaUpdateFailed)return;v=this.alignPlaylists(f,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(h.details=f,this.levelLastLoaded=h,l||this.setStartPosition(f,v),this.hls.trigger(y.LEVEL_UPDATED,{details:f,level:u}),this.state===C.WAITING_LEVEL){if(this.waitForCdnTuneIn(f))return;this.state=C.IDLE}l&&f.live&&this.synchronizeToLiveEdge(f),this.tick()},n.synchronizeToLiveEdge=function(e){var t=this.config,i=this.media;if(i){var s=this.hls.liveSyncPosition,l=this.getLoadPosition(),u=e.fragmentStart,f=e.edge,d=l>=u-t.maxFragLookUpTolerance&&l<=f;if(s!==null&&i.duration>s&&(l<s||!d)){var h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!d&&i.readyState<4||l<f-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),i.readyState))if(this.warn("Playback: "+l.toFixed(3)+" is located too far from the end of live sliding playlist: "+f+", reset currentTime to : "+s.toFixed(3)),this.config.liveSyncMode==="buffered"){var c,v=Se.bufferInfo(i,s,0);if(!((c=v.buffered)!=null&&c.length)){i.currentTime=s;return}var g=v.start<=l;if(g){i.currentTime=s;return}var m=Se.bufferedInfo(v.buffered,l,0),p=m.nextStart;p&&(i.currentTime=p)}else i.currentTime=s}}},n._handleFragmentLoadProgress=function(e){var t,i=e.frag,s=e.part,l=e.payload,u=this.levels;if(!u){this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var f=u[i.level];if(!f){this.warn("Level "+i.level+" not found on progress");return}var d=f.details;if(!d){this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),this.fragmentTracker.removeFragment(i);return}var h=f.videoCodec,c=d.PTSKnown||!d.live,v=(t=i.initSegment)==null?void 0:t.data,g=this._getAudioCodec(f),m=this.transmuxer=this.transmuxer||new Xo(this.hls,F.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=s?s.index:-1,E=p!==-1,S=new ha(i.level,i.sn,i.stats.chunkCount,l.byteLength,p,E),T=this.initPTS[i.cc];m.push(l,v,g,h,i,s,d.totalduration,c,S,T)},n.onAudioTrackSwitching=function(e,t){var i=this,s=this.hls,l=this.altAudio===2,u=ln(t.url,s);if(u)this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var f=this.fragCurrent;f&&(this.log("Switching to main audio track, cancel main fragment load"),f.abortRequests(),this.fragmentTracker.removeFragment(f)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(l){this.fragmentTracker.removeAllFragments(),s.once(y.BUFFER_FLUSHED,function(){i.hls&&i.hls.trigger(y.AUDIO_TRACK_SWITCHED,t)}),s.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(y.AUDIO_TRACK_SWITCHED,t)}},n.onAudioTrackSwitched=function(e,t){var i=ln(t.url,this.hls);if(i){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i?2:0,this.tick()},n.onBufferCreated=function(e,t){var i=t.tracks,s,l,u=!1;for(var f in i){var d=i[f];if(d.id==="main"){if(l=f,s=d,f==="video"){var h=i[f];h&&(this.videoBuffer=h.buffer)}}else u=!0}u&&s?(this.log("Alternate track found, use "+l+".buffered to schedule main fragment loading"),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media},n.onFragBuffered=function(e,t){var i=t.frag,s=t.part,l=i.type===F.MAIN;if(l){if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(s?" p: "+s.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),this.state===C.PARSED&&(this.state=C.IDLE);return}var u=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),Ve(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}var f=this.media;f&&(!this._hasEnoughToStart&&Se.getBuffered(f).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())},n.onError=function(e,t){var i;if(t.fatal){this.state=C.ERROR;return}switch(t.details){case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.MAIN,t);break;case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:case _.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===C.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===N.LEVEL&&(this.state=C.IDLE);break;case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case _.BUFFER_FULL_ERROR:if(t.parent!=="main")return;if(this.reduceLengthAndFlushBuffer(t)){var s=!this.config.interstitialsController&&this.config.assetPlayerId;s?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case _.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}},n.onFragLoadEmergencyAborted=function(){this.state=C.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()},n.onBufferFlushed=function(e,t){var i=t.type;if(i!==le.AUDIO||!this.altAudio){var s=(i===le.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,i,F.MAIN),this.tick())}},n.onLevelsUpdated=function(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels},n.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},n.seekToStartPos=function(){var e=this.media;if(e){var t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log("could not seek to "+i+", already seeking at "+t);return}var s=this.timelineOffset;s&&i&&(i+=s);var l=this.getLevelDetails(),u=Se.getBuffered(e),f=u.length?u.start(0):0,d=f-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<h||this.loadingParts&&d<2*(l?.partTarget||0)))&&(this.log("adjusting start position by "+d+" to match buffer start"),i+=d,this.startPosition=i),t<i&&(this.log("seek to target start position "+i+" from current time "+t+" buffer start "+f),e.currentTime=i)}}},n._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t},n._loadBitrateTestFrag=function(e,t){var i=this;e.bitrateTest=!0,this._doFragLoad(e,t).then(function(s){var l=i.hls,u=s?.frag;if(!(!u||i.fragContextChanged(u))){t.fragmentError=0,i.state=C.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var f=u.stats;f.parsing.start=f.parsing.end=f.buffering.start=f.buffering.end=self.performance.now(),l.trigger(y.FRAG_LOADED,s),u.bitrateTest=!1}}).catch(function(s){i.state===C.STOPPED||i.state===C.ERROR||(i.warn(s),i.resetFragmentLoading(e))})},n._handleTransmuxComplete=function(e){var t=this.playlistType,i=this.hls,s=e.remuxResult,l=e.chunkMeta,u=this.getCurrentContext(l);if(!u){this.resetWhenMissingContext(l);return}var f=u.frag,d=u.part,h=u.level,c=s.video,v=s.text,g=s.id3,m=s.initSegment,p=h.details,E=this.altAudio?void 0:s.audio;if(this.fragContextChanged(f)){this.fragmentTracker.removeFragment(f);return}if(this.state=C.PARSING,m){var S=m.tracks;if(S){var T=f.initSegment||f;if(this.unhandledEncryptionError(m,f))return;this._bufferInitSegment(h,S,T,l),i.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:t,tracks:S})}var A=m.initPTS,x=m.timescale,b=this.initPTS[f.cc];if(H(A)&&(!b||b.baseTime!==A||b.timescale!==x)){var D=m.trackId;this.initPTS[f.cc]={baseTime:A,timescale:x,trackId:D},i.trigger(y.INIT_PTS_FOUND,{frag:f,id:t,initPTS:A,timescale:x,trackId:D})}}if(c&&p){E&&c.type==="audiovideo"&&this.logMuxedErr(f);var k=p.fragments[f.sn-1-p.startSN],R=f.sn===p.startSN,L=!k||f.cc>k.cc;if(s.independent!==!1){var I=c.startPTS,P=c.endPTS,U=c.startDTS,w=c.endDTS;if(d)d.elementaryStreams[c.type]={startPTS:I,endPTS:P,startDTS:U,endDTS:w};else if(c.firstKeyFrame&&c.independent&&l.id===1&&!L&&(this.couldBacktrack=!0),c.dropped&&c.independent){var O=this.getMainFwdBufferInfo(),K=(O?O.end:this.getLoadPosition())+this.config.maxBufferHole,z=c.firstKeyFramePTS?c.firstKeyFramePTS:I;if(!R&&K<z-this.config.maxBufferHole&&!L){this.backtrack(f);return}else L&&(f.gap=!0);f.setElementaryStreamInfo(c.type,f.start,P,f.start,w,!0)}else R&&I-(p.appliedTimelineOffset||0)>wn&&(f.gap=!0);f.setElementaryStreamInfo(c.type,I,P,U,w),this.backtrackFragment&&(this.backtrackFragment=f),this.bufferFragmentData(c,f,d,l,R||L)}else if(R||L)f.gap=!0;else{this.backtrack(f);return}}if(E){var X=E.startPTS,Q=E.endPTS,ge=E.startDTS,$=E.endDTS;d&&(d.elementaryStreams[le.AUDIO]={startPTS:X,endPTS:Q,startDTS:ge,endDTS:$}),f.setElementaryStreamInfo(le.AUDIO,X,Q,ge,$),this.bufferFragmentData(E,f,d,l)}if(p&&g!=null&&g.samples.length){var J={id:t,frag:f,details:p,samples:g.samples};i.trigger(y.FRAG_PARSING_METADATA,J)}if(p&&v){var re={id:t,frag:f,details:p,samples:v.samples};i.trigger(y.FRAG_PARSING_USERDATA,re)}},n.logMuxedErr=function(e){this.warn((Ve(e)?"Media":"Init")+" segment with muxed audiovideo where only video expected: "+e.url)},n._bufferInitSegment=function(e,t,i,s){var l=this;if(this.state===C.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));var u=t.audio,f=t.video,d=t.audiovideo;if(u){var h=e.audioCodec,c=nr(u.codec,h);c==="mp4a"&&(c="mp4a.40.5");var v=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");var g=u.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&v.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&v.indexOf("android")!==-1&&u.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log("Android: force audio codec to "+c)),h&&h!==c&&this.log('Swapping manifest audio codec "'+h+'" for "'+c+'"'),u.levelCodec=c,u.id=F.MAIN,this.log("Init audio buffer, container:"+u.container+", codecs[selected/level/parsed]=["+(c||"")+"/"+(h||"")+"/"+u.codec+"]"),delete t.audiovideo}if(f){f.levelCodec=e.videoCodec,f.id=F.MAIN;var m=f.codec;if(m?.length===4)switch(m){case"hvc1":case"hev1":f.codec="hvc1.1.6.L120.90";break;case"av01":f.codec="av01.0.04M.08";break;case"avc1":f.codec="avc1.42e01e";break}this.log("Init video buffer, container:"+f.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+m+"]"+(f.codec!==m?" parsed-corrected="+f.codec:"")+(f.supplemental?" supplemental="+f.supplemental:"")),delete t.audiovideo}d&&(this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+e.codecs+"/"+d.codec+"]"),delete t.video,delete t.audio);var p=Object.keys(t);if(p.length){if(this.hls.trigger(y.BUFFER_CODECS,t),!this.hls)return;p.forEach(function(E){var S=t[E],T=S.initSegment;T!=null&&T.byteLength&&l.hls.trigger(y.BUFFER_APPENDING,{type:E,data:T,frag:i,part:null,chunkMeta:s,parent:i.type})})}this.tickImmediate()}},n.getMainFwdBufferInfo=function(){var e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,F.MAIN)},n.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=C.IDLE},n.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&e.seeking===!1){var i=e.currentTime;if(Se.isBuffered(e,i)?t=this.getAppendedFrag(i):Se.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;var s=this.fragPlaying,l=t.level;(!s||t.sn!==s.sn||s.level!==l)&&(this.fragPlaying=t,this.hls.trigger(y.FRAG_CHANGED,{frag:t}),(!s||s.level!==l)&&this.hls.trigger(y.LEVEL_SWITCHED,{level:l}))}}},Y(o,[{key:"hasEnoughToStart",get:function(){return this._hasEnoughToStart}},{key:"maxBufferLength",get:function(){var e=this.levels,t=this.level,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e;if(this.fragPlaying)return this.fragPlaying;var t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return H(t)?this.getAppendedFrag(t):null}},{key:"currentProgramDateTime",get:function(){var e,t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(H(t)){var i=this.getLevelDetails(),s=this.currentFrag||(i?Yr(null,i.fragments,t):null);if(s){var l=s.programDateTime;if(l!==null){var u=l+(t-s.start)*1e3;return new Date(u)}}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])})(Aa),Ac=(function(a){function o(r,e){var t;return t=a.call(this,"key-loader",e)||this,t.config=void 0,t.keyIdToKeyInfo={},t.emeController=null,t.config=r,t}se(o,a);var n=o.prototype;return n.abort=function(e){for(var t in this.keyIdToKeyInfo){var i=this.keyIdToKeyInfo[t].loader;if(i){var s;if(e&&e!==((s=i.context)==null?void 0:s.frag.type))return;i.abort()}}},n.detach=function(){for(var e in this.keyIdToKeyInfo){var t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}},n.destroy=function(){this.detach();for(var e in this.keyIdToKeyInfo){var t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}},n.createKeyLoadError=function(e,t,i,s,l){return t===void 0&&(t=_.KEY_LOAD_ERROR),new Er({type:W.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:l,error:i,networkDetails:s})},n.loadClear=function(e,t,i){var s=this;if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length){for(var l=function(){var v=t[f];if(e.cc<=v.cc&&(!Ve(e)||!Ve(v)||e.sn<v.sn)||!i&&f==d-1)return{v:s.emeController.selectKeySystemFormat(v).then(function(g){if(s.emeController){v.setKeyFormat(g);var m=vn(g);if(m)return s.emeController.getKeySystemAccess([m])}})}},u,f=0,d=t.length;f<d;f++)if(u=l(),u)return u.v}if(this.config.requireKeySystemAccessOnStart){var h=Mi(this.config);if(h.length)return this.emeController.getKeySystemAccess(h)}}return null},n.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(function(i){return t.loadInternal(e,i)}):this.loadInternal(e)},n.loadInternal=function(e,t){var i,s;t&&e.setKeyFormat(t);var l=e.decryptdata;if(!l){var u=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,_.KEY_LOAD_ERROR,u))}var f=l.uri;if(!f)return Promise.reject(this.createKeyLoadError(e,_.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+f+'"')));var d=os(l),h=this.keyIdToKeyInfo[d];if((i=h)!=null&&i.decryptdata.key)return l.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if((s=h)!=null&&s.keyLoadPromise){var c,v=(c=h.mediaKeySessionContext)==null?void 0:c.keyStatus;switch(v){case"usable":case"usable-in-future":return h.keyLoadPromise.then(function(g){var m=g.keyInfo;return l.key=m.decryptdata.key,{frag:e,keyInfo:m}})}}switch(this.log("Loading key "+Ke(l.keyId||[])+" from "+e.type+" "+e.level),h=this.keyIdToKeyInfo[d]={decryptdata:l,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},l.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return l.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,_.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+l.method+'"')))}},n.loadKeyEME=function(e,t){var i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s=this.emeController.loadKey(i);return(e.keyLoadPromise=s.then(function(l){return e.mediaKeySessionContext=l,i})).catch(function(l){throw e.keyLoadPromise=null,l.data&&(l.data.frag=t),l})}return Promise.resolve(i)},n.loadKeyHTTP=function(e,t){var i=this,s=this.config,l=s.loader,u=new l(s);return t.keyLoader=e.loader=u,e.keyLoadPromise=new Promise(function(f,d){var h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=s.keyLoadPolicy.default,v={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:function(p,E,S,T){var A=S.frag,x=S.keyInfo,b=S.url,D=os(x.decryptdata)||b;if(!A.decryptdata||x!==i.keyIdToKeyInfo[D])return d(i.createKeyLoadError(A,_.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));x.decryptdata.key=A.decryptdata.key=new Uint8Array(p.data),A.keyLoader=null,x.loader=null,f({frag:A,keyInfo:x})},onError:function(p,E,S,T){i.resetLoader(E),d(i.createKeyLoadError(t,_.KEY_LOAD_ERROR,new Error("HTTP Error "+p.code+" loading key "+p.text),S,Te({url:h.url,data:void 0},p)))},onTimeout:function(p,E,S){i.resetLoader(E),d(i.createKeyLoadError(t,_.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:function(p,E,S){i.resetLoader(E),d(i.createKeyLoadError(t,_.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};u.load(h,v,g)})},n.resetLoader=function(e){var t=e.frag,i=e.keyInfo,s=e.url,l=i.loader;t.keyLoader===l&&(t.keyLoader=null,i.loader=null);var u=os(i.decryptdata)||s;delete this.keyIdToKeyInfo[u],l&&l.destroy()},o})(te);function os(a){var o=a.keyId;return o?Ke(o):a.uri}function ql(a){var o=a.type;switch(o){case N.AUDIO_TRACK:return F.AUDIO;case N.SUBTITLE_TRACK:return F.SUBTITLE;default:return F.MAIN}}function ls(a,o){var n=a.url;return(n===void 0||n.indexOf("data:")===0)&&(n=o.url),n}var xc=(function(){function a(n){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=n,this.registerListeners()}var o=a.prototype;return o.startLoad=function(r){},o.stopLoad=function(){this.destroyInternalLoaders()},o.registerListeners=function(){var r=this.hls;r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.LEVEL_LOADING,this.onLevelLoading,this),r.on(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this)},o.unregisterListeners=function(){var r=this.hls;r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.LEVEL_LOADING,this.onLevelLoading,this),r.off(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this)},o.createInternalLoader=function(r){var e=this.hls.config,t=e.pLoader,i=e.loader,s=t||i,l=new s(e);return this.loaders[r.type]=l,l},o.getInternalLoader=function(r){return this.loaders[r.type]},o.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},o.destroyInternalLoaders=function(){for(var r in this.loaders){var e=this.loaders[r];e&&e.destroy(),this.resetInternalLoader(r)}},o.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},o.onManifestLoading=function(r,e){var t=e.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:N.MANIFEST,url:t,deliveryDirectives:null,levelOrTrack:null})},o.onLevelLoading=function(r,e){var t=e.id,i=e.level,s=e.pathwayId,l=e.url,u=e.deliveryDirectives,f=e.levelInfo;this.load({id:t,level:i,pathwayId:s,responseType:"text",type:N.LEVEL,url:l,deliveryDirectives:u,levelOrTrack:f})},o.onAudioTrackLoading=function(r,e){var t=e.id,i=e.groupId,s=e.url,l=e.deliveryDirectives,u=e.track;this.load({id:t,groupId:i,level:null,responseType:"text",type:N.AUDIO_TRACK,url:s,deliveryDirectives:l,levelOrTrack:u})},o.onSubtitleTrackLoading=function(r,e){var t=e.id,i=e.groupId,s=e.url,l=e.deliveryDirectives,u=e.track;this.load({id:t,groupId:i,level:null,responseType:"text",type:N.SUBTITLE_TRACK,url:s,deliveryDirectives:l,levelOrTrack:u})},o.onLevelsUpdated=function(r,e){var t=this.loaders[N.LEVEL];if(t){var i=t.context;i&&!e.levels.some(function(s){return s===i.levelOrTrack})&&(t.abort(),delete this.loaders[N.LEVEL])}},o.load=function(r){var e,t=this,i=this.hls.config,s=this.getInternalLoader(r);if(s){var l=this.hls.logger,u=s.context;if(u&&u.levelOrTrack===r.levelOrTrack&&(u.url===r.url||u.deliveryDirectives&&!r.deliveryDirectives)){u.url===r.url?l.log("[playlist-loader]: ignore "+r.url+" ongoing request"):l.log("[playlist-loader]: ignore "+r.url+" in favor of "+u.url);return}l.log("[playlist-loader]: aborting previous loader for type: "+r.type),s.abort()}var f;if(r.type===N.MANIFEST?f=i.manifestLoadPolicy.default:f=ae({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(r),H((e=r.deliveryDirectives)==null?void 0:e.part)){var d;if(r.type===N.LEVEL&&r.level!==null?d=this.hls.levels[r.level].details:r.type===N.AUDIO_TRACK&&r.id!==null?d=this.hls.audioTracks[r.id].details:r.type===N.SUBTITLE_TRACK&&r.id!==null&&(d=this.hls.subtitleTracks[r.id].details),d){var h=d.partTarget,c=d.targetduration;if(h&&c){var v=Math.max(h*3,c*.8)*1e3;f=ae({},f,{maxTimeToFirstByteMs:Math.min(v,f.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,f.maxTimeToFirstByteMs)})}}}var g=f.errorRetry||f.timeoutRetry||{},m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:g.maxNumRetry||0,retryDelay:g.retryDelayMs||0,maxRetryDelay:g.maxRetryDelayMs||0},p={onSuccess:function(S,T,A,x){var b=t.getInternalLoader(A);t.resetInternalLoader(A.type);var D=S.data;if(D.indexOf("#EXTM3U")!==0){t.handleManifestParsingError(S,A,new Error("no EXTM3U delimiter"),x||null,T);return}T.parsing.start=performance.now(),Oi.isMediaPlaylist(D)||A.type!==N.MANIFEST?t.handleTrackOrLevelPlaylist(S,T,A,x||null,b):t.handleMasterPlaylist(S,T,A,x)},onError:function(S,T,A,x){t.handleNetworkError(T,A,!1,S,x)},onTimeout:function(S,T,A){t.handleNetworkError(T,A,!0,void 0,S)}};s.load(r,m,p)},o.checkAutostartLoad=function(){if(this.hls){var r=this.hls,e=r.config,t=e.autoStartLoad,i=e.startPosition,s=r.forceStartLoad;(t||s)&&(this.hls.logger.log((t?"auto":"force")+" startLoad with configured startPosition "+i),this.hls.startLoad(i))}},o.handleMasterPlaylist=function(r,e,t,i){var s=this.hls,l=r.data,u=ls(r,t),f=Oi.parseMasterPlaylist(l,u);if(f.playlistParsingError){this.handleManifestParsingError(r,t,f.playlistParsingError,i,e);return}var d=f.contentSteering,h=f.levels,c=f.sessionData,v=f.sessionKeys,g=f.startTimeOffset,m=f.variableList;this.variableList=m;var p=Oi.parseMasterPlaylistMedia(l,u,f),E=p.AUDIO,S=E===void 0?[]:E,T=p.SUBTITLES,A=p["CLOSED-CAPTIONS"];if(S.length){var x=S.some(function(b){return!b.url});!x&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new et({}),bitrate:0,url:""}))}s.trigger(y.MANIFEST_LOADED,{levels:h,audioTracks:S,subtitles:T,captions:A,contentSteering:d,url:u,stats:e,networkDetails:i,sessionData:c,sessionKeys:v,startTimeOffset:g,variableList:m})},o.handleTrackOrLevelPlaylist=function(r,e,t,i,s){var l=this.hls,u=t.id,f=t.level,d=t.type,h=ls(r,t),c=H(f)?f:H(u)?u:0,v=ql(t),g=Oi.parseLevelPlaylist(r.data,h,c,v,0,this.variableList);if(d===N.MANIFEST){var m={attrs:new et({}),bitrate:0,details:g,name:"",url:h};g.requestScheduled=e.loading.start+co(g,0),l.trigger(y.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:h,stats:e,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),t.levelDetails=g,this.handlePlaylistLoaded(g,r,e,t,i,s)},o.handleManifestParsingError=function(r,e,t,i,s){this.hls.trigger(y.ERROR,{type:W.NETWORK_ERROR,details:_.MANIFEST_PARSING_ERROR,fatal:e.type===N.MANIFEST,url:r.url,err:t,error:t,reason:t.message,response:r,context:e,networkDetails:i,stats:s})},o.handleNetworkError=function(r,e,t,i,s){t===void 0&&(t=!1);var l="A network "+(t?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+r.type;r.type===N.LEVEL?l+=": "+r.level+" id: "+r.id:(r.type===N.AUDIO_TRACK||r.type===N.SUBTITLE_TRACK)&&(l+=" id: "+r.id+' group-id: "'+r.groupId+'"');var u=new Error(l);this.hls.logger.warn("[playlist-loader]: "+l);var f=_.UNKNOWN,d=!1,h=this.getInternalLoader(r);switch(r.type){case N.MANIFEST:f=t?_.MANIFEST_LOAD_TIMEOUT:_.MANIFEST_LOAD_ERROR,d=!0;break;case N.LEVEL:f=t?_.LEVEL_LOAD_TIMEOUT:_.LEVEL_LOAD_ERROR,d=!1;break;case N.AUDIO_TRACK:f=t?_.AUDIO_TRACK_LOAD_TIMEOUT:_.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case N.SUBTITLE_TRACK:f=t?_.SUBTITLE_TRACK_LOAD_TIMEOUT:_.SUBTITLE_LOAD_ERROR,d=!1;break}h&&this.resetInternalLoader(r.type);var c={type:W.NETWORK_ERROR,details:f,fatal:d,url:r.url,loader:h,context:r,error:u,networkDetails:e,stats:s};if(i){var v=e?.url||r.url;c.response=Te({url:v,data:void 0},i)}this.hls.trigger(y.ERROR,c)},o.handlePlaylistLoaded=function(r,e,t,i,s,l){var u=this.hls,f=i.type,d=i.level,h=i.id,c=i.groupId,v=i.deliveryDirectives,g=ls(e,i),m=ql(i),p=typeof i.level=="number"&&m===F.MAIN?d:void 0;if(!r.fragments.length){var E=r.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(y.ERROR,{type:W.NETWORK_ERROR,details:_.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:E,reason:E.message,response:e,context:i,level:p,parent:m,networkDetails:s,stats:t});return}r.targetduration||(r.playlistParsingError=new Error("Missing Target Duration"));var S=r.playlistParsingError;if(S){if(this.hls.logger.warn(S+" "+r.url),!u.config.ignorePlaylistParsingErrors){u.trigger(y.ERROR,{type:W.NETWORK_ERROR,details:_.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:S,reason:S.message,response:e,context:i,level:p,parent:m,networkDetails:s,stats:t});return}r.playlistParsingError=null}switch(r.live&&l&&(l.getCacheAge&&(r.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(r.ageHeader))&&(r.ageHeader=0)),f){case N.MANIFEST:case N.LEVEL:u.trigger(y.LEVEL_LOADED,{details:r,levelInfo:i.levelOrTrack||u.levels[0],level:p||0,id:h||0,stats:t,networkDetails:s,deliveryDirectives:v,withoutMultiVariant:f===N.MANIFEST});break;case N.AUDIO_TRACK:u.trigger(y.AUDIO_TRACK_LOADED,{details:r,track:i.levelOrTrack,id:h||0,groupId:c||"",stats:t,networkDetails:s,deliveryDirectives:v});break;case N.SUBTITLE_TRACK:u.trigger(y.SUBTITLE_TRACK_LOADED,{details:r,track:i.levelOrTrack,id:h||0,groupId:c||"",stats:t,networkDetails:s,deliveryDirectives:v});break}},a})(),jl=(function(){function a(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new be,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;var r=this.logger=Dt(n.debug||!1,"Hls instance",n.assetPlayerId),e=this.config=lc(a.DefaultConfig,n,r);this.userConfig=n,e.progressive&&uc(e,r);var t=e.abrController,i=e.bufferController,s=e.capLevelController,l=e.errorController,u=e.fpsController,f=new l(this),d=this.abrController=new t(this),h=new Tu(this),c=e.interstitialsController,v=c?this.interstitialsController=new c(this,a):null,g=this.bufferController=new i(this,h),m=this.capLevelController=new s(this),p=new u(this),E=new xc(this),S=e.contentSteeringController,T=S?new S(this):null,A=this.levelController=new pc(this,T),x=new gc(this),b=new Ac(this.config,this.logger),D=this.streamController=new Sc(this,h,b),k=this.gapController=new cc(this,h);m.setStreamController(D),p.setStreamController(D);var R=[E,A,D];v&&R.splice(1,0,v),T&&R.splice(1,0,T),this.networkControllers=R;var L=[d,g,k,m,p,x,h];this.audioTrackController=this.createController(e.audioTrackController,R);var I=e.audioStreamController;I&&R.push(this.audioStreamController=new I(this,h,b)),this.subtitleTrackController=this.createController(e.subtitleTrackController,R);var P=e.subtitleStreamController;P&&R.push(this.subtititleStreamController=new P(this,h,b)),this.createController(e.timelineController,L),b.emeController=this.emeController=this.createController(e.emeController,L),this.cmcdController=this.createController(e.cmcdController,L),this.latencyController=this.createController(mc,L),this.coreComponents=L,R.push(f);var U=f.onErrorOut;typeof U=="function"&&this.on(y.ERROR,U,f),this.on(y.MANIFEST_LOADED,E.onManifestLoaded,E)}a.isMSESupported=function(){return Wl()},a.isSupported=function(){return yc()},a.getMediaSource=function(){return Ie()};var o=a.prototype;return o.createController=function(r,e){if(r){var t=new r(this);return e&&e.push(t),t}return null},o.on=function(r,e,t){t===void 0&&(t=this),this._emitter.on(r,e,t)},o.once=function(r,e,t){t===void 0&&(t=this),this._emitter.once(r,e,t)},o.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},o.off=function(r,e,t,i){t===void 0&&(t=this),this._emitter.off(r,e,t,i)},o.listeners=function(r){return this._emitter.listeners(r)},o.emit=function(r,e,t){return this._emitter.emit(r,e,t)},o.trigger=function(r,e){if(this.config.debug)return this.emit(r,r,e);try{return this.emit(r,r,e)}catch(i){if(this.logger.error("An internal error happened while handling event "+r+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;var t=r===y.ERROR;this.trigger(y.ERROR,{type:W.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:t,event:r,error:i}),this.triggeringException=!1}}return!1},o.listenerCount=function(r){return this._emitter.listenerCount(r)},o.destroy=function(){this.logger.log("destroy"),this.trigger(y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0;var r=this.config;r.xhrSetup=r.fetchSetup=void 0,this.userConfig=null},o.attachMedia=function(r){if(!r||"media"in r&&!r.media){var e=new Error("attachMedia failed: invalid argument ("+r+")");this.trigger(y.ERROR,{type:W.OTHER_ERROR,details:_.ATTACH_MEDIA_ERROR,fatal:!0,error:e});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());var t="media"in r,i=t?r.media:r,s=t?r:{media:i};this._media=i,this.trigger(y.MEDIA_ATTACHING,s)},o.detachMedia=function(){this.logger.log("detachMedia"),this.trigger(y.MEDIA_DETACHING,{}),this._media=null},o.transferMedia=function(){this._media=null;var r=this.bufferController.transferMedia();return this.trigger(y.MEDIA_DETACHING,{transferMedia:r}),r},o.loadSource=function(r){this.stopLoad();var e=this.media,t=this._url,i=this._url=_t.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:"+i),e&&t&&(t!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(y.MANIFEST_LOADING,{url:r})},o.startLoad=function(r,e){r===void 0&&(r=-1),this.logger.log("startLoad("+(r+(e?", <skip seek to start>":""))+")"),this.started=!0,this.resumeBuffering();for(var t=0;t<this.networkControllers.length&&(this.networkControllers[t].startLoad(r,e),!(!this.started||!this.networkControllers));t++);},o.stopLoad=function(){this.logger.log("stopLoad"),this.started=!1;for(var r=0;r<this.networkControllers.length&&(this.networkControllers[r].stopLoad(),!(this.started||!this.networkControllers));r++);},o.resumeBuffering=function(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(function(r){r.resumeBuffering&&r.resumeBuffering()}))},o.pauseBuffering=function(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(function(r){r.pauseBuffering&&r.pauseBuffering()}))},o.swapAudioCodec=function(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},o.recoverMediaError=function(){this.logger.log("recoverMediaError");var r=this._media,e=r?.currentTime;this.detachMedia(),r&&(this.attachMedia(r),e&&this.startLoad(e))},o.removeLevel=function(r){this.levelController.removeLevel(r)},o.setAudioOption=function(r){var e;return((e=this.audioTrackController)==null?void 0:e.setAudioOption(r))||null},o.setSubtitleOption=function(r){var e;return((e=this.subtitleTrackController)==null?void 0:e.setSubtitleOption(r))||null},o.getMediaDecodingInfo=function(r,e){e===void 0&&(e=this.allAudioTracks);var t=ks(e);return sn(r,t,navigator.mediaCapabilities)},Y(a,[{key:"url",get:function(){return this._url}},{key:"hasEnoughToStart",get:function(){return this.streamController.hasEnoughToStart}},{key:"startPosition",get:function(){return this.streamController.startPositionValue}},{key:"loadingEnabled",get:function(){return this.started}},{key:"bufferingEnabled",get:function(){return this.streamController.bufferingEnabled}},{key:"inFlightFragments",get:function(){var r,e=(r={},r[F.MAIN]=this.streamController.inFlightFrag,r);return this.audioStreamController&&(e[F.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[F.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}},{key:"sessionId",get:function(){var r=this._sessionId;return r||(r=this._sessionId=G()),r}},{key:"levels",get:function(){var r=this.levelController.levels;return r||[]}},{key:"latestLevelDetails",get:function(){return this.streamController.getLevelDetails()||null}},{key:"loadLevelObj",get:function(){return this.levelController.loadLevelObj}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){this.logger.log("set currentLevel:"+r),this.levelController.manualLevel=r,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){this.logger.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){this.logger.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){this.logger.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){var r=this.levelController.startLevel;return r===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:r},set:function(r){this.logger.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var e=!!r;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(this.logger.log("set autoLevelCapping:"+r),this._autoLevelCapping=r,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN},set:function(r){this.abrController.resetEstimator(r)}},{key:"abrEwmaDefaultEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.defaultEstimate:NaN}},{key:"ttfbEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(r){oa(r)&&this._maxHdcpLevel!==r&&(this._maxHdcpLevel=r,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,e=this.config.minAutoBitrate;if(!r)return 0;for(var t=r.length,i=0;i<t;i++)if(r[i].maxBitrate>=e)return i;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,e=this.autoLevelCapping,t=this.maxHdcpLevel,i;if(e===-1&&r!=null&&r.length?i=r.length-1:i=e,t)for(var s=i;s--;){var l=r[s].attrs["HDCP-LEVEL"];if(l&&l<=t)return s}return i}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(r){this.abrController.nextAutoLevel=r}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"maxBufferLength",get:function(){return this.streamController.maxBufferLength}},{key:"allAudioTracks",get:function(){var r=this.audioTrackController;return r?r.allAudioTracks:[]}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var e=this.audioTrackController;e&&(e.audioTrack=r)}},{key:"allSubtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var e=this.subtitleTrackController;e&&(e.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return r?r.subtitleDisplay:!1},set:function(r){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency},set:function(r){this.latencyController.targetLatency=r}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}},{key:"pathways",get:function(){return this.levelController.pathways}},{key:"pathwayPriority",get:function(){return this.levelController.pathwayPriority},set:function(r){this.levelController.pathwayPriority=r}},{key:"bufferedToEnd",get:function(){var r;return!!((r=this.bufferController)!=null&&r.bufferedToEnd)}},{key:"interstitialsManager",get:function(){var r;return((r=this.interstitialsController)==null?void 0:r.interstitialsManager)||null}}],[{key:"version",get:function(){return Gi}},{key:"Events",get:function(){return y}},{key:"MetadataSchema",get:function(){return Qt}},{key:"ErrorTypes",get:function(){return W}},{key:"ErrorDetails",get:function(){return _}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:sc},set:function(r){a.defaultConfig=r}}])})();return jl.defaultConfig=void 0,jl}))})(!1)})(Ts)),Ts.exports}var rv=tv();const Si=Fc(rv);var iv=Ze('<div class="flex w-full items-center gap-4 py-2"><audio preload="none" class="hidden"></audio> <button> </button> <iconify-icon></iconify-icon> <input type="range" min="0" max="1" step="0.01" class="range range-xs w-full"/></div>',2);function nv(ne,M){Wn(M,!0);const[Ge,je]=jn(),V=()=>ri(Xn,"$_",Ge);let oe,Y=null,Xe=ei(!1),ae=ei(.7);bs(()=>{M.gameId&&dt(M.gameId)});async function dt(me){if(!oe)return;Y&&(Y.destroy(),Y=null);const be=`${M.url}/tts/${me}/playlist.m3u8`;Si.isSupported()?(Y=new Si({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,xhrSetup(pe){pe.setRequestHeader("ngrok-skip-browser-warning","true")}}),Y.loadSource(be),Y.attachMedia(oe),Y.on(Si.Events.MANIFEST_PARSED,()=>{console.log("Received HLS manifest"),se()}),Y.on(Si.Events.ERROR,(pe,Pe)=>{if(console.error("HLS error:",Pe),Pe.fatal)switch(Pe.type){case Si.ErrorTypes.NETWORK_ERROR:console.log("Network error, trying to recover..."),Y?.startLoad();break;case Si.ErrorTypes.MEDIA_ERROR:console.log("Media error, trying to recover..."),Y?.recoverMediaError();break;default:console.log("Fatal error, destroying HLS instance"),Y?.destroy(),Y=null;break}})):oe.canPlayType("application/vnd.apple.mpegurl")?(oe.src=be,se()):console.error("HLS is not supported in this browser")}function se(){oe&&oe.play().then(()=>{er(Xe,!0),console.log("Audio playback started")}).catch(me=>{console.error("Failed to play audio:",me),er(Xe,!1)})}function gt(){oe&&(oe.pause(),er(Xe,!1),console.log("Audio playback paused"))}function at(){B(Xe)?gt():se()}function st(me){oe&&(er(ae,Math.max(0,Math.min(1,me)),!0),oe.volume=B(ae))}function Te(){er(Xe,!0)}function mt(){er(Xe,!1)}function Rt(){er(Xe,!1)}Yn(()=>{Y&&(Y.destroy(),Y=null)});var pt=iv(),ze=j(pt);Lr(ze,me=>oe=me,()=>oe);var G=Z(ze,2);G.__click=at;var ee=j(G,!0);q(G);var ie=Z(G,2);qt(ie,"inline",!0),qt(ie,"icon","mdi:volume");var ce=Z(ie,2);Zt(ce),q(pt),rt(me=>{ti(G,1,`btn btn-sm ${B(Xe)?"btn-error":"btn-success"}`),G.disabled=!M.gameId,Ee(ee,me)},[()=>B(Xe)?V()("audio.stop"):V()("audio.play")]),Qi("play",ze,Te),Qi("pause",ze,mt),Qi("ended",ze,Rt),Bc(ce,()=>B(ae),me=>er(ae,me)),Ce(ne,pt);var xe=qn({toggleAudio:at,updateVolume:st});return je(),xe}Hn(["click"]);var av=Ze('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),sv=Ze('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),ov=Ze('<div class="status status-error"></div>'),lv=(ne,M)=>M("connection.url",ne.currentTarget.value),uv=(ne,M)=>M("connection.token",ne.currentTarget.value),fv=(ne,M)=>M("display.canvas.name",ne.currentTarget.checked),dv=(ne,M)=>M("display.canvas.team",ne.currentTarget.checked),hv=(ne,M)=>M("display.canvas.role",ne.currentTarget.checked),cv=(ne,M)=>M("display.bubble.name",ne.currentTarget.checked),vv=(ne,M)=>M("display.bubble.team",ne.currentTarget.checked),gv=(ne,M)=>M("display.bubble.role",ne.currentTarget.checked),mv=(ne,M)=>M("display.text.name",ne.currentTarget.checked),pv=(ne,M)=>M("display.text.team",ne.currentTarget.checked),yv=(ne,M)=>M("display.text.role",ne.currentTarget.checked),Ev=(ne,M)=>M("display.largeScale",ne.currentTarget.checked),Tv=Ze('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><a class="text-3xl font-bold text-nowrap ml-2" href="./"> </a> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow"/></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow"/> <span class="badge badge-neutral badge-xs"> </span></label> <button class="btn btn-info"> </button> <button class="btn btn-error"> </button> <button class="btn"> </button> <button class="btn"> </button> <dialog class="modal"><div class="modal-box"><div class="form-control my-2"><h3 class="text-lg font-bold"> </h3> <h4 class="text-base font-bold mt-2"> </h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label></div> <h4 class="text-base font-bold mt-2"> </h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label></div> <h4 class="text-base font-bold mt-2"> </h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label></div> <h4 class="text-base font-bold mt-2"> </h4> <label class="label cursor-pointer my-2"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <h4 class="text-base font-bold mt-2"> </h4> <div class="my-2"><!></div></div></div> <form method="dialog" class="modal-backdrop"><button> </button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"/> <iconify-icon></iconify-icon></label></div>',2);function Sv(ne,M){Wn(M,!0);const[Ge,je]=jn(),V=()=>ri(Xn,"$_",Ge),oe=()=>ri(pr,"$realtimeSocketState",Ge);let Y=ei(void 0);const Xe=Ai.subscribe(Lt=>{er(Y,Lt,!0)});Yn(()=>{Xe()});function ae(Lt,Xt){Ai.update(kr=>{const nr=Lt.split("."),Pr=nr.pop();let Vt=kr;for(const fr of nr)fr&&(Vt=Vt[fr]);return Vt[Pr]=Xt,{...kr}})}function dt(){pr.connect()}function se(){pr.disconnect()}async function gt(){await pr.loadFromClipboard()}let at;var st=Tv(),Te=j(st),mt=j(Te,!0);q(Te);var Rt=Z(Te,2),pt=j(Rt),ze=j(pt);{var G=Lt=>{var Xt=av();As(2),Ce(Lt,Xt)},ee=Lt=>{var Xt=xr(),kr=rr(Xt);{var nr=Vt=>{var fr=sv();As(2),Ce(Vt,fr)},Pr=Vt=>{var fr=ov();Ce(Vt,fr)};At(kr,Vt=>{oe().status===lr.CONNECTING?Vt(nr):Vt(Pr,!1)},!0)}Ce(Lt,Xt)};At(ze,Lt=>{oe().status===lr.CONNECTED?Lt(G):Lt(ee,!1)})}q(pt),q(Rt);var ie=Z(Rt,2),ce=j(ie);ti(ce,1,"h-[1em] opacity-50"),qt(ce,"inline",!0),qt(ce,"icon","mdi:link");var xe=Z(ce,2);Zt(xe),xe.__input=[lv,ae],q(ie);var me=Z(ie,2),be=j(me);ti(be,1,"h-[1em] opacity-50"),qt(be,"inline",!0),qt(be,"icon","mdi:key");var pe=Z(be,2);Zt(pe),pe.__input=[uv,ae];var Pe=Z(pe,2),xt=j(Pe,!0);q(Pe),q(me);var _t=Z(me,2);_t.__click=dt;var H=j(_t,!0);q(_t);var he=Z(_t,2);he.__click=se;var ke=j(he,!0);q(he);var W=Z(he,2);W.__click=gt;var _=j(W,!0);q(W);var y=Z(W,2);y.__click=()=>at.showModal();var N=j(y,!0);q(y);var F=Z(y,2),de=j(F),We=j(de),te=j(We),Fe=j(te,!0);q(te);var Mt=Z(te,2),Ot=j(Mt,!0);q(Mt);var it=Z(Mt,2),we=j(it),Qe=j(we),Dt=j(Qe,!0);q(Qe);var Le=Z(Qe,2);Zt(Le),Le.__change=[fv,ae],q(we);var Ie=Z(we,2),Ne=j(Ie),ot=j(Ne,!0);q(Ne);var Me=Z(Ne,2);Zt(Me),Me.__change=[dv,ae],q(Ie);var Ke=Z(Ie,2),Re=j(Ke),ve=j(Re,!0);q(Re);var le=Z(Re,2);Zt(le),le.__change=[hv,ae],q(Ke),q(it);var Ft=Z(it,2),Ve=j(Ft,!0);q(Ft);var ht=Z(Ft,2),Nt=j(ht),Ut=j(Nt),Ur=j(Ut,!0);q(Ut);var ir=Z(Ut,2);Zt(ir),ir.__change=[cv,ae],q(Nt);var Bt=Z(Nt,2),jt=j(Bt),Ue=j(jt,!0);q(jt);var ur=Z(jt,2);Zt(ur),ur.__change=[vv,ae],q(Bt);var ue=Z(Bt,2),Ir=j(ue),Ji=j(Ir,!0);q(Ir);var xi=Z(Ir,2);Zt(xi),xi.__change=[gv,ae],q(ue),q(ht);var ye=Z(ht,2),zn=j(ye,!0);q(ye);var ii=Z(ye,2),Li=j(ii),br=j(Li),Qn=j(br,!0);q(br);var Br=Z(br,2);Zt(Br),Br.__change=[mv,ae],q(Li);var Rr=Z(Li,2),Gt=j(Rr),$n=j(Gt,!0);q(Gt);var ni=Z(Gt,2);Zt(ni),ni.__change=[pv,ae],q(Rr);var Zi=Z(Rr,2),Ii=j(Zi),Kt=j(Ii,!0);q(Ii);var ai=Z(Ii,2);Zt(ai),ai.__change=[yv,ae],q(Zi),q(ii);var _r=Z(ii,2),Jn=j(_r,!0);q(_r);var Gr=Z(_r,2),si=j(Gr),Zn=j(si,!0);q(si);var bi=Z(si,2);Zt(bi),bi.__change=[Ev,ae],q(Gr);var Ri=Z(Gr,2),en=j(Ri,!0);q(Ri);var yr=Z(Ri,2),_i=j(yr);Dc(_i,{}),q(yr),q(We),q(de);var oi=Z(de,2),li=j(oi),Kr=j(li,!0);q(li),q(oi),q(F),Lr(F,Lt=>at=Lt,()=>at);var Di=Z(F,2),Dr=j(Di);qt(Dr,"inline",!0),qt(Dr,"icon","mdi:white-balance-sunny");var ki=Z(Dr,2),tn=Z(ki,2);qt(tn,"inline",!0),qt(tn,"icon","mdi:moon-and-stars"),q(Di),q(st),rt((Lt,Xt,kr,nr,Pr,Vt,fr,rn,Pi,ea,ta,nn,an,ra,sn,ia,na,aa,on,sa,Ci,oa,ui,la,fi)=>{Ee(mt,Lt),$i(xe,"placeholder",Xt),tu(xe,B(Y)?.connection.url),$i(pe,"placeholder",kr),tu(pe,B(Y)?.connection.token),Ee(xt,nr),_t.disabled=oe().status!==lr.DISCONNECTED,Ee(H,Pr),he.disabled=oe().status===lr.DISCONNECTED,Ee(ke,Vt),Ee(_,fr),Ee(N,rn),Ee(Fe,Pi),Ee(Ot,ea),Ee(Dt,ta),mr(Le,B(Y)?.display.canvas.name),Ee(ot,nn),mr(Me,B(Y)?.display.canvas.team),Ee(ve,an),mr(le,B(Y)?.display.canvas.role),Ee(Ve,ra),Ee(Ur,sn),mr(ir,B(Y)?.display.bubble.name),Ee(Ue,ia),mr(ur,B(Y)?.display.bubble.team),Ee(Ji,na),mr(xi,B(Y)?.display.bubble.role),Ee(zn,aa),Ee(Qn,on),mr(Br,B(Y)?.display.text.name),Ee($n,sa),mr(ni,B(Y)?.display.text.team),Ee(Kt,Ci),mr(ai,B(Y)?.display.text.role),Ee(Jn,oa),Ee(Zn,ui),mr(bi,B(Y)?.display.largeScale),Ee(en,la),Ee(Kr,fi)},[()=>V()("appName"),()=>V()("realtime.websocketUrl"),()=>V()("realtime.authKey"),()=>V()("realtime.optional"),()=>V()("realtime.connect"),()=>V()("realtime.disconnect"),()=>V()("realtime.pasteFromClipboard"),()=>V()("realtime.settings"),()=>V()("realtime.displaySettings"),()=>V()("realtime.canvasAgentInfo"),()=>V()("realtime.name"),()=>V()("realtime.teamName"),()=>V()("realtime.role"),()=>V()("realtime.messageBoxAgentInfo"),()=>V()("realtime.name"),()=>V()("realtime.teamName"),()=>V()("realtime.role"),()=>V()("realtime.listAgentInfo"),()=>V()("realtime.name"),()=>V()("realtime.teamName"),()=>V()("realtime.role"),()=>V()("realtime.largeScreen"),()=>V()("realtime.enable"),()=>V()("common.language"),()=>V()("common.close")]),Ce(ne,st),qn(),je()}Hn(["input","click","change"]);var Av=Ze("<option> </option>"),xv=Ze('<div class="divider"> </div>'),Lv=Ze('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),Iv=Ze('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),bv=Ze('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),Rv=Ze('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),_v=Ze('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),Dv=Ze("<!> <button><!></button>",1),kv=Ze('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full" role="region"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="flex-1 overflow-y-auto h-full pr-2"><div class="flex flex-col p-2"><!> <div class="mb-2"><select class="w-full select"></select></div> <div class="list overflow-y-auto flex-1 my-2"><!></div></div></div></div></main>');function jv(ne,M){Wn(M,!0);const[Ge,je]=jn(),V=()=>ri(pr,"$realtimeSocketState",Ge),oe=()=>ri(dt,"$currentPacket",Ge),Y=()=>ri(Xn,"$_",Ge);let Xe=ei(void 0);const ae={id:"",idx:-1,day:0,is_day:!0,agents:Kc(13),event:"未接続",message:void 0,from_idx:void 0,to_idx:void 0,bubble_idx:void 0},dt=au(ae);let se=ei(void 0),gt=ei(80),at=!1,st=null;function Te(){{const N=Oc.url.searchParams,F=N.get("url"),de=N.get("token");F&&(Ai.update(We=>({...We,connection:{url:F??"",token:de??""}})),pr.connect())}}function mt(N){N.preventDefault(),N.stopPropagation(),N.dataTransfer&&(N.dataTransfer.dropEffect="copy")}function Rt(N){N.preventDefault(),N.stopPropagation();const F=N.dataTransfer?.files;!F||F.length===0||pr.loadFromFiles(F)}function pt(N){if(!at||!st)return;const F=st.getBoundingClientRect(),de=N-F.left,We=F.width;er(gt,Math.min(90,Math.max(10,de/We*100)),!0)}function ze(){at=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const N=de=>{const We=de instanceof MouseEvent?de.clientX:de.touches[0].clientX;pt(We)},F=()=>{at=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",N),window.removeEventListener("touchmove",N),window.removeEventListener("mouseup",F),window.removeEventListener("touchend",F)};window.addEventListener("mousemove",N),window.addEventListener("touchmove",N),window.addEventListener("mouseup",F),window.addEventListener("touchend",F)}nu(()=>{Te();const N=pr.currentPacket.subscribe(de=>{dt.set(de||ae)}),F=Ai.subscribe(de=>{er(se,de,!0)});Yn(()=>{N(),F()}),window.addEventListener("beforeunload",de=>{V().status===lr.CONNECTED&&de.preventDefault()}),window.addEventListener("popstate",de=>{V().status===lr.CONNECTED&&de.preventDefault()})});let G=null;bs(()=>{if(G&&V().selectedPacketIdx!==null){const N=G.querySelectorAll("button");V().selectedPacketIdx>=0&&V().selectedPacketIdx<N.length&&N[V().selectedPacketIdx].scrollIntoView({behavior:"smooth",block:"center"})}});var ee=kv(),ie=j(ee);Sv(ie,{});var ce=Z(ie,2),xe=j(ce),me=j(xe);ev(me,{get packet(){return oe()},get focusIdx(){return B(Xe)},set focusIdx(N){er(Xe,N,!0)}}),q(xe);var be=Z(xe,2);be.__mousedown=ze,be.__touchstart=ze;var pe=Z(be,2),Pe=j(pe),xt=j(Pe);{var _t=N=>{{let F=Ss(()=>B(se)?.connection.url??"http://localhost:8080/tts"),de=Ss(()=>V().currentGameId??"");nv(N,{get url(){return B(F)},get gameId(){return B(de)}})}};At(xt,N=>{N(_t)})}var H=Z(xt,2),he=j(H);he.__change=N=>{const F=N.currentTarget.value;pr.switchToGame(F,!0)},xs(he,5,()=>V().gameItems,Ls,(N,F)=>{var de=Av(),We=j(de);q(de);var te={};rt(Fe=>{Ee(We,`${(B(F).filename||B(F).id)??""}
                (${Fe??""})`),te!==(te=B(F).id)&&(de.value=(de.__value=B(F).id)??"")},[()=>new Date(B(F).updated_at).toLocaleTimeString()]),Ce(N,de)}),q(he);var ke;wc(he),q(H);var W=Z(H,2),_=j(W);{var y=N=>{var F=xr(),de=rr(F);xs(de,1,()=>V().entries[V().currentGameId]||[],Ls,(We,te,Fe)=>{var Mt=Dv(),Ot=rr(Mt);{var it=Ie=>{var Ne=xv(),ot=j(Ne);q(Ne),rt(()=>Ee(ot,`${B(te).day??""}日目 ${B(te).is_day?"昼":"夜"}`)),Ce(Ie,Ne)};At(Ot,Ie=>{(Fe>0&&(B(te).day!==V().entries[V().currentGameId][Fe-1].day||B(te).is_day!==V().entries[V().currentGameId][Fe-1].is_day)||Fe===0)&&Ie(it)})}var we=Z(Ot,2);we.__click=()=>{pr.selectPacket(Fe,!0)};var Qe=j(we);{var Dt=Ie=>{var Ne=xr(),ot=rr(Ne);{var Me=Re=>{var ve=Lv(),le=j(ve,!0);q(ve),rt(Ft=>Ee(le,Ft),[()=>Y()(`realtime.eventTypes.${B(te).event}`,{default:B(te).event})]),Ce(Re,ve)},Ke=Re=>{var ve=xr(),le=rr(ve);{var Ft=ht=>{var Nt=Iv(),Ut=rr(Nt),Ur=j(Ut,!0);q(Ut);var ir=Z(Ut,2);qt(ir,"inline",!0),qt(ir,"icon","mdi:skip-forward"),rt(Bt=>Ee(Ur,Bt),[()=>St(B(se)?.display.text,B(te),B(te).bubble_idx)]),Ce(ht,Nt)},Ve=ht=>{var Nt=xr(),Ut=rr(Nt);{var Ur=Bt=>{var jt=bv(),Ue=rr(jt),ur=j(Ue,!0);q(Ue);var ue=Z(Ue,2);qt(ue,"inline",!0),qt(ue,"icon","mdi:arrow-u-down-right-bold"),rt(Ir=>Ee(ur,Ir),[()=>St(B(se)?.display.text,B(te),B(te).bubble_idx)]),Ce(Bt,jt)},ir=Bt=>{var jt=Rv(),Ue=j(jt,!0);q(jt),rt(ur=>Ee(Ue,ur),[()=>St(B(se)?.display.text,B(te),B(te).bubble_idx)+"<"+B(te).message]),Ce(Bt,jt)};At(Ut,Bt=>{B(te).message==="Skip"?Bt(Ur):Bt(ir,!1)},!0)}Ce(ht,Nt)};At(le,ht=>{B(te).message==="Over"?ht(Ft):ht(Ve,!1)},!0)}Ce(Re,ve)};At(ot,Re=>{B(te).event==="囁き"&&B(Xe)!==void 0&&B(te).agents.find(ve=>ve.idx===B(Xe))?.role!=="WEREWOLF"?Re(Me):Re(Ke,!1)})}Ce(Ie,Ne)},Le=Ie=>{var Ne=_v(),ot=j(Ne);{var Me=ve=>{var le=eu();rt(Ft=>Ee(le,Ft),[()=>St(B(se)?.display.text,B(te),B(te).from_idx)]),Ce(ve,le)},Ke=ve=>{var le=xr(),Ft=rr(le);{var Ve=ht=>{var Nt=eu();rt(Ut=>Ee(Nt,Ut),[()=>St(B(se)?.display.text,B(te),B(te).to_idx)]),Ce(ht,Nt)};At(Ft,ht=>{(B(te).event==="追放"||B(te).event==="襲撃")&&ht(Ve)},!0)}Ce(ve,le)};At(ot,ve=>{B(te).event==="投票"||B(te).event==="占い"?ve(Me):ve(Ke,!1)})}var Re=Z(ot);q(Ne),rt(ve=>Ee(Re,` ${ve??""}`),[()=>Y()(`realtime.eventTypes.${B(te).event}`,{default:B(te).event})]),Ce(Ie,Ne)};At(Qe,Ie=>{B(te).event==="トーク"||B(te).event==="囁き"?Ie(Dt):Ie(Le,!1)})}q(we),rt(()=>ti(we,1,`btn ${Fe===V().selectedPacketIdx?"btn-primary":""}`)),Ce(We,Mt)}),Ce(N,F)};At(_,N=>{V().currentGameId&&V().entries[V().currentGameId]&&N(y)})}q(W),Lr(W,N=>G=N,()=>G),q(Pe),q(pe),q(ce),Lr(ce,N=>st=N,()=>st),q(ee),rt(()=>{Is(xe,`width: ${B(gt)??""}%`),ke!==(ke=V().currentGameId)&&(he.value=(he.__value=V().currentGameId)??"",Mc(he,V().currentGameId))}),Qi("dragover",ce,mt),Qi("drop",ce,Rt),Ce(ne,ee),qn(),je()}Hn(["mousedown","touchstart","change","click"]);export{jv as component};
