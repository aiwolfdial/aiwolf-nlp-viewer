import{b as ae,e as Le,a as L,t as T}from"../chunks/disclose-version.D43NzN4s.js";import{i as fe}from"../chunks/legacy.D9yvZ7kn.js";import{v as M,L as K,a5 as _e,a4 as Te,I as j,m as pe,H as he,am as ge,J as De,K as re,M as X,w as Y,ai as Re,at as W,N as be,n as te,O as Ne,D as se,au as Se,av as $e,al as Me,aw as Oe,q as me,a9 as Ce,a3 as Ve,z as ne,ax as He,ay as Ue,az as Fe,af as xe,aj as Be,ah as Ye,G as ze,aA as Ge,p as ye,c as x,r as h,s as w,t as $,h as m,a as Ee,a1 as Q,aB as qe,aC as ie,aD as Ke,aE as le,B as F}from"../chunks/runtime.CS0sFaaY.js";import{a as C,d as We,e as B}from"../chunks/store.Bxm6ll-m.js";import{p as Z,i as H}from"../chunks/props.A0qESEiI.js";import{b as Je}from"../chunks/paths.DsK1pd-k.js";function J(a,e){return e}function Pe(a,e,t,r){for(var o=[],s=e.length,i=0;i<s;i++)$e(e[i].e,o,!0);var d=s>0&&o.length===0&&t!==null;if(d){var f=t.parentNode;Me(f),f.append(t),r.clear(),U(a,e[0].prev,e[s-1].next)}Oe(o,()=>{for(var E=0;E<s;E++){var v=e[E];d||(r.delete(v.k),U(a,v.prev,v.next)),me(v.e,!d)}})}function P(a,e,t,r,o,s=null){var i=a,d={flags:e,items:new Map,first:null};{var f=a;i=M?K(_e(f)):f.appendChild(Te())}M&&j();var E=null,v=!1;pe(()=>{var y=t(),l=he(y)?y:y==null?[]:ge(y),n=l.length;if(v&&n===0)return;v=n===0;let g=!1;if(M){var k=i.data===De;k!==(n===0)&&(i=re(),K(i),X(!1),g=!0)}if(M){for(var A=null,_,c=0;c<n;c++){if(Y.nodeType===8&&Y.data===Re){i=Y,g=!0,X(!1);break}var p=l[c],u=r(p,c);_=Ae(Y,d,A,null,p,u,c,o,e),d.items.set(u,_),A=_}n>0&&K(re())}if(!M){var b=Ce;Xe(l,d,i,o,e,(b.f&W)!==0,r)}s!==null&&(n===0?E?be(E):E=te(()=>s(i)):E!==null&&Ne(E,()=>{E=null})),g&&X(!0),t()}),M&&(i=Y)}function Xe(a,e,t,r,o,s,i){var d=a.length,f=e.items,E=e.first,v=E,y,l=null,n=[],g=[],k,A,_,c;for(c=0;c<d;c+=1){if(k=a[c],A=i(k,c),_=f.get(A),_===void 0){var p=v?v.e.nodes_start:t;l=Ae(p,e,l,l===null?e.first:l.next,k,A,c,r,o),f.set(A,l),n=[],g=[],v=l.next;continue}if(Qe(_,k,c),_.e.f&W&&be(_.e),_!==v){if(y!==void 0&&y.has(_)){if(n.length<g.length){var u=g[0],b;l=u.prev;var R=n[0],N=n[n.length-1];for(b=0;b<n.length;b+=1)oe(n[b],u,t);for(b=0;b<g.length;b+=1)y.delete(g[b]);U(e,R.prev,N.next),U(e,l,R),U(e,N,u),v=u,l=N,c-=1,n=[],g=[]}else y.delete(_),oe(_,v,t),U(e,_.prev,_.next),U(e,_,l===null?e.first:l.next),U(e,l,_),l=_;continue}for(n=[],g=[];v!==null&&v.k!==A;)(s||!(v.e.f&W))&&(y??(y=new Set)).add(v),g.push(v),v=v.next;if(v===null)continue;_=v}n.push(_),l=_,v=_.next}if(v!==null||y!==void 0){for(var O=y===void 0?[]:ge(y);v!==null;)(s||!(v.e.f&W))&&O.push(v),v=v.next;var V=O.length;if(V>0){var I=d===0?t:null;Pe(e,O,I,f)}}se.first=e.first&&e.first.e,se.last=l&&l.e}function Qe(a,e,t,r){Se(a.v,e),a.i=t}function Ae(a,e,t,r,o,s,i,d,f){var E=(f&Ue)!==0,v=(f&Fe)===0,y=E?v?Ve(o):ne(o):o,l=f&He?ne(i):i,n={i:l,v:y,k:s,a:null,e:null,prev:t,next:r};try{return n.e=te(()=>d(a,y,l),M),n.e.prev=t&&t.e,n.e.next=r&&r.e,t===null?e.first=n:(t.next=n,t.e.next=n.e),r!==null&&(r.prev=n,r.e.prev=n.e),n}finally{}}function oe(a,e,t){for(var r=a.next?a.next.e.nodes_start:t,o=e?e.e.nodes_start:t,s=a.e.nodes_start;s!==r;){var i=xe(s);o.before(s),s=i}}function U(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ze(a,e,t,r,o){var s=a,i="",d;pe(()=>{if(i===(i=e()??"")){M&&j();return}d!==void 0&&(me(d),d=void 0),i!==""&&(d=te(()=>{if(M){Y.data;for(var f=j(),E=f;f!==null&&(f.nodeType!==8||f.data!=="");)E=f,f=xe(f);if(f===null)throw Be(),Ye;ae(Y,E),s=K(f);return}var v=i+"",y=Le(v);ae(_e(y),y.lastChild),s.before(y)}))})}function je(a,e,t,r){var o=a.__attributes??(a.__attributes={});M&&(o[e]=a.getAttribute(e),a.nodeName==="LINK")||o[e]!==(o[e]=t)&&(t==null?a.removeAttribute(e):typeof t!="string"&&et(a).includes(e)?a[e]=t:a.setAttribute(e,t))}var ve=new Map;function et(a){var e=ve.get(a.nodeName);if(e)return e;ve.set(a.nodeName,e=[]);for(var t,r=a,o=Element.prototype;o!==r;){t=Ge(r);for(var s in t)t[s].set&&e.push(s);r=ze(r)}return e}function ee(a,e,t){if(t){if(a.classList.contains(e))return;a.classList.add(e)}else{if(!a.classList.contains(e))return;a.classList.remove(e)}}function q(a){return function(...e){var t=e[0];return t.preventDefault(),a==null?void 0:a.apply(this,e)}}function ce(a,e){var s;var t=(s=a.$$events)==null?void 0:s[e.type],r=he(t)?t.slice():t==null?[]:[t];for(var o of r)o.call(this,e)}const ue={VILLAGER:"村人",SEER:"占い師",MEDIUM:"霊能者",BODYGUARD:"騎士",WEREWOLF:"人狼",POSSESSED:"狂人"},tt={ALIVE:"生存",DEAD:"死亡"};function de(a){const e={};return a.forEach(t=>{const[r,o,...s]=t.split(",");e[r]||(e[r]=at()),rt(e[r],o,s)}),e}function at(){return{status:{},talks:[],votes:[],execution:null,divine:null,attackVotes:[],attack:null,result:null}}function rt(a,e,t){const o={status:([s,i,d,f])=>{a.status[s]={role:i,status:d,name:f}},talk:([s,i,d,f])=>{a.talks.push({talkIdx:s,turn:i,agentIdx:d,text:f})},vote:([s,i])=>{a.votes.push({voteAgentIdx:s,targetAgentIdx:i})},execute:([s,i])=>{a.execution={agentIdx:s,role:i}},divine:([s,i,d])=>{a.divine={agentIdx:s,targetAgentIdx:i,result:d}},attackVote:([s,i])=>{a.attackVotes.push({voteAgentIdx:s,targetAgentIdx:i})},attack:([s,i])=>{a.attack={agentIdx:s,isSuccessful:i==="true"}},result:([s,i,d])=>{a.result={villagers:s,werewolves:i,winSide:d}}}[e];o&&o(t)}function z(a,e,t){var o;const r=(o=a[e])==null?void 0:o.status[t];return r?`Agent[${t}] (${r.name})`:`Agent[${t}]`}function st(a){const e=a.match(/>>Agent\[\d+\]/);return e?a.replace(e[0],`<strong>${e[0]}</strong>`).trim():a.trim()}var nt=T("<li><strong> </strong> </li>"),it=T('<section class="status-section"><h3>エージェント</h3> <ul></ul></section>'),lt=T('<div class="divine-section"><h3>占い結果</h3> <p> </p></div>'),ot=T('<div class="attack-section"><h3>襲撃結果</h3> <p> </p></div>'),vt=T('<div class="execution-section"><h3>追放結果</h3> <p> </p></div>'),ct=T('<section class="game-events"><!> <!> <!></section>'),ut=T('<div class="talk"><strong> </strong> <!></div>'),dt=T('<section class="game-result-section"><h3>ゲーム結果</h3> <p> </p></section>'),ft=T('<div class="day-column"><div class="day-section"><h2> </h2> <div class="scrollable-content"><!> <!> <section class="talks-section"><h3>会話ログ</h3> <div class="talks"></div></section> <!></div></div></div>');function _t(a,e){ye(e,!1);let t=Z(e,"day",8),r=Z(e,"dayLog",8),o=Z(e,"processedLogs",8);fe();var s=ft(),i=x(s),d=x(i),f=x(d);h(d);var E=w(d,2),v=x(E);{var y=c=>{var p=it(),u=w(x(p),2);P(u,5,()=>Object.entries(r().status),J,(b,R)=>{let N=()=>m(R)[0],O=()=>m(R)[1];var V=nt(),I=x(V),D=x(I,!0);$(()=>C(D,z(o(),t(),N()))),h(I);var S=w(I);h(V),$(()=>{ee(V,"over",O().status!=="ALIVE"),C(S,` ${ue[O().role]??"NULL"??""} -
                ${tt[O().status]??"NULL"??""}`)}),L(b,V)}),h(u),h(p),L(c,p)};H(v,c=>{Object.keys(r().status).length>0&&c(y)})}var l=w(v,2);{var n=c=>{var p=ct(),u=x(p);{var b=I=>{var D=lt(),S=w(x(D),2);const G=Q(()=>z(o(),t(),r().divine.agentIdx)??""),ke=Q(()=>z(o(),t(),r().divine.targetAgentIdx)??""),we=Q(()=>r().divine.result??"");var Ie=x(S);$(()=>C(Ie,`${m(G)} が
                ${m(ke)}
                を占った結果:
                ${m(we)}`)),h(S),h(D),L(I,D)};H(u,I=>{r().divine&&I(b)})}var R=w(u,2);{var N=I=>{var D=ot(),S=w(x(D),2),G=x(S);$(()=>C(G,`${z(o(),t(),r().attack.agentIdx)??""} への襲撃:
                ${(r().attack.isSuccessful?"成功":"失敗")??""}`)),h(S),h(D),L(I,D)};H(R,I=>{r().attack&&I(N)})}var O=w(R,2);{var V=I=>{var D=vt(),S=w(x(D),2),G=x(S);$(()=>C(G,`${z(o(),t(),r().execution.agentIdx)??""} が追放されました
                (役職: ${ue[r().execution.role]??"NULL"??""})`)),h(S),h(D),L(I,D)};H(O,I=>{r().execution&&I(V)})}h(p),L(c,p)};H(l,c=>{(r().divine||r().attack||r().execution)&&c(n)})}var g=w(l,2),k=w(x(g),2);P(k,5,()=>r().talks,J,(c,p)=>{var u=ut(),b=x(u),R=x(b,!0);$(()=>C(R,z(o(),t(),m(p).agentIdx))),h(b);var N=w(b,2);Ze(N,()=>st(m(p).text)),h(u),$(()=>ee(u,"over",m(p).text==="Over")),L(c,u)}),h(k),h(g);var A=w(g,2);{var _=c=>{var p=dt(),u=w(x(p),2),b=x(u);h(u),h(p),$(()=>C(b,`村人: ${r().result.villagers??""}人 人狼: ${r().result.werewolves??""}人
            勝利陣営: ${r().result.winSide??""}`)),L(c,p)};H(A,c=>{r().result&&c(_)})}h(E),h(i),h(s),$(()=>C(f,`Day ${t()??""}`)),L(a,s),Ee()}var pt=T('<link rel="stylesheet">'),ht=T('<div tabindex="0" class="file-input-container" role="button"><label class="file-input-label"><input type="file" accept=".log" multiple> <span>ファイルを選択もしくはドラッグアンドドロップしてください</span></label></div>'),gt=T('<div class="tab-wrapper"><button class="tab-button"> </button> <button class="close-button" aria-label="Close tab">✕</button></div>'),bt=T('<div class="log-container"><div class="tabs-container"><div class="tabs"></div></div> <div class="days-container"></div></div>'),mt=T('<main><pre class="title">aiwolf-nlp-viewer</pre> <!> <!></main>');function It(a,e){ye(e,!1);let t=le([]),r=le(0);function o(l){const n=l.target;Array.from(n.files||[]).forEach(k=>{const A=new FileReader;A.onload=_=>{var u;const p=(((u=_.target)==null?void 0:u.result)??"").split(`
`).filter(b=>b.trim());F(t,[...m(t),{name:k.name,data:p,processed:de(p)}]),F(r,m(t).length-1)},A.readAsText(k)})}function s(l){var g;Array.from(((g=l.dataTransfer)==null?void 0:g.files)||[]).forEach(k=>{const A=new FileReader;A.onload=_=>{var u;const p=(((u=_.target)==null?void 0:u.result)??"").split(`
`).filter(b=>b.trim());F(t,[...m(t),{name:k.name,data:p,processed:de(p)}]),F(r,m(t).length-1)},A.readAsText(k)})}function i(l){F(t,m(t).filter((n,g)=>g!==l)),m(r)>=m(t).length&&F(r,m(t).length-1)}fe();var d=mt();We(l=>{var n=pt();qe.title="aiwolf-nlp-viewer",je(n,"href",`${Je??""}/global.css`),L(l,n)}),B("dragover",ie,q(function(l){ce.call(this,e,l)})),B("drop",ie,q(s));var f=w(x(d),2);{var E=l=>{var n=ht(),g=x(n),k=x(g);Ke(2),h(g),h(n),B("change",k,o),B("dragover",n,q(function(A){ce.call(this,e,A)})),B("drop",n,q(s)),L(l,n)};H(f,l=>{m(t).length===0&&l(E)})}var v=w(f,2);{var y=l=>{var n=bt(),g=x(n),k=x(g);P(k,5,()=>m(t),J,(_,c,p)=>{var u=gt(),b=x(u),R=x(b,!0);h(b);var N=w(b,2);h(u),$(()=>{ee(u,"active",m(r)===p),C(R,m(c).name)}),B("click",b,()=>F(r,p)),B("click",N,()=>i(p)),L(_,u)}),h(k),h(g);var A=w(g,2);P(A,5,()=>Object.entries(m(t)[m(r)].processed),J,(_,c)=>{let p=()=>m(c)[0],u=()=>m(c)[1];_t(_,{get day(){return p()},get dayLog(){return u()},get processedLogs(){return m(t)[m(r)].processed}})}),h(A),h(n),L(l,n)};H(v,l=>{m(t).length>0&&l(y)})}h(d),L(a,d),Ee()}export{It as component};
