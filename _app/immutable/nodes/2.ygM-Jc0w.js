import{b as yt,e as Jt,a as I,t as k}from"../chunks/disclose-version.C1wkHDwB.js";import{i as wt}from"../chunks/legacy.Bdlp7kM8.js";import{v as Y,L as et,a8 as Lt,a7 as Pt,I as lt,m as St,H as Tt,ao as Rt,J as Xt,K as xt,M as it,w as X,ak as Qt,at,N as Dt,n as ut,O as Zt,D as ct,au as jt,av as te,an as ee,aw as ae,q as Nt,ac as Mt,a6 as re,z as mt,ax as ne,ay as ie,az as se,ah as Ot,al as oe,aj as le,G as ce,aA as ve,ab as It,_ as kt,aB as fe,p as Vt,c as d,s as _,r as v,t as C,a as Ct,h as p,aC as tt,aD as ue,f as de,aE as st,B as q}from"../chunks/runtime.D7ZyB6oo.js";import{a as H,d as _e,e as P}from"../chunks/store._Z7yHLtq.js";import{p as ot,i as O,b as ge}from"../chunks/props.CLyYlMCv.js";import{b as he}from"../chunks/paths.BgQkTSsg.js";function Q(a,t){return t}function pe(a,t,e,r){for(var c=[],s=t.length,l=0;l<s;l++)te(t[l].e,c,!0);var g=s>0&&c.length===0&&e!==null;if(g){var h=e.parentNode;ee(h),h.append(e),r.clear(),J(a,t[0].prev,t[s-1].next)}ae(c,()=>{for(var L=0;L<s;L++){var u=t[L];g||(r.delete(u.k),J(a,u.prev,u.next)),Nt(u.e,!g)}})}function Z(a,t,e,r,c,s=null){var l=a,g={flags:t,items:new Map,first:null};{var h=a;l=Y?et(Lt(h)):h.appendChild(Pt())}Y&&lt();var L=null,u=!1;St(()=>{var E=e(),x=Tt(E)?E:E==null?[]:Rt(E),o=x.length;if(u&&o===0)return;u=o===0;let y=!1;if(Y){var S=l.data===Xt;S!==(o===0)&&(l=xt(),et(l),it(!1),y=!0)}if(Y){for(var w=null,f,m=0;m<o;m++){if(X.nodeType===8&&X.data===Qt){l=X,y=!0,it(!1);break}var U=x[m],D=r(U,m);f=Ht(X,g,w,null,U,D,m,c,t),g.items.set(D,f),w=f}o>0&&et(xt())}if(!Y){var b=Mt;ye(x,g,l,c,t,(b.f&at)!==0,r)}s!==null&&(o===0?L?Dt(L):L=ut(()=>s(l)):L!==null&&Zt(L,()=>{L=null})),y&&it(!0),e()}),Y&&(l=X)}function ye(a,t,e,r,c,s,l){var g=a.length,h=t.items,L=t.first,u=L,E,x=null,o=[],y=[],S,w,f,m;for(m=0;m<g;m+=1){if(S=a[m],w=l(S,m),f=h.get(w),f===void 0){var U=u?u.e.nodes_start:e;x=Ht(U,t,x,x===null?t.first:x.next,S,w,m,r,c),h.set(w,x),o=[],y=[],u=x.next;continue}if(xe(f,S,m),f.e.f&at&&Dt(f.e),f!==u){if(E!==void 0&&E.has(f)){if(o.length<y.length){var D=y[0],b;x=D.prev;var B=o[0],z=o[o.length-1];for(b=0;b<o.length;b+=1)Et(o[b],D,e);for(b=0;b<y.length;b+=1)E.delete(y[b]);J(t,B.prev,z.next),J(t,x,B),J(t,z,D),u=D,x=z,m-=1,o=[],y=[]}else E.delete(f),Et(f,u,e),J(t,f.prev,f.next),J(t,f,x===null?t.first:x.next),J(t,x,f),x=f;continue}for(o=[],y=[];u!==null&&u.k!==w;)(s||!(u.e.f&at))&&(E??(E=new Set)).add(u),y.push(u),u=u.next;if(u===null)continue;f=u}o.push(f),x=f,u=f.next}if(u!==null||E!==void 0){for(var K=E===void 0?[]:Rt(E);u!==null;)(s||!(u.e.f&at))&&K.push(u),u=u.next;var rt=K.length;if(rt>0){var j=g===0?e:null;pe(t,K,j,h)}}ct.first=t.first&&t.first.e,ct.last=x&&x.e}function xe(a,t,e,r){jt(a.v,t),a.i=e}function Ht(a,t,e,r,c,s,l,g,h){var L=(h&ie)!==0,u=(h&se)===0,E=L?u?re(c):mt(c):c,x=h&ne?mt(l):l,o={i:x,v:E,k:s,a:null,e:null,prev:e,next:r};try{return o.e=ut(()=>g(a,E,x),Y),o.e.prev=e&&e.e,o.e.next=r&&r.e,e===null?t.first=o:(e.next=o,e.e.next=o.e),r!==null&&(r.prev=o,r.e.prev=o.e),o}finally{}}function Et(a,t,e){for(var r=a.next?a.next.e.nodes_start:e,c=t?t.e.nodes_start:e,s=a.e.nodes_start;s!==r;){var l=Ot(s);c.before(s),s=l}}function J(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function me(a,t,e,r,c){var s=a,l="",g;St(()=>{if(l===(l=t()??"")){Y&&lt();return}g!==void 0&&(Nt(g),g=void 0),l!==""&&(g=ut(()=>{if(Y){X.data;for(var h=lt(),L=h;h!==null&&(h.nodeType!==8||h.data!=="");)L=h,h=Ot(h);if(h===null)throw oe(),le;yt(X,L),s=et(h);return}var u=l+"",E=Jt(u);yt(Lt(E),E.lastChild),s.before(E)}))})}function Ft(a,t,e,r){var c=a.__attributes??(a.__attributes={});Y&&(c[t]=a.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&a.nodeName==="LINK")||c[t]!==(c[t]=e)&&(t==="style"&&"__styles"in a&&(a.__styles={}),t==="loading"&&(a[fe]=e),e==null?a.removeAttribute(t):typeof e!="string"&&Ut(a).includes(t)?a[t]=e:a.setAttribute(t,e))}function W(a,t,e){var r=Mt,c=ct;It(null),kt(null);try{(vt.has(a.nodeName)||customElements.get(a.tagName.toLowerCase())?Ut(a).includes(t):e&&typeof e=="object")?a[t]=e:Ft(a,t,e==null?e:String(e))}finally{It(r),kt(c)}}var vt=new Map;function Ut(a){var t=vt.get(a.nodeName);if(t)return t;vt.set(a.nodeName,t=[]);for(var e,r=a,c=Element.prototype;c!==r;){e=ve(r);for(var s in e)e[s].set&&t.push(s);r=ce(r)}return t}function ft(a,t,e){if(e){if(a.classList.contains(t))return;a.classList.add(t)}else{if(!a.classList.contains(t))return;a.classList.remove(t)}}function bt(a){return function(...t){var e=t[0];return e.preventDefault(),a==null?void 0:a.apply(this,t)}}function Ie(a,t){var s;var e=(s=a.$$events)==null?void 0:s[t.type],r=Tt(e)?e.slice():e==null?[]:[e];for(var c of r)c.call(this,t)}const ke={VILLAGER:"村人",SEER:"占い師",MEDIUM:"霊能者",BODYGUARD:"騎士",WEREWOLF:"人狼",POSSESSED:"狂人"},Ee={ALIVE:"生存",DEAD:"死亡"},be={HUMAN:"人間",WEREWOLF:"人狼"},Ae={VILLAGER:"村人陣営",WEREWOLF:"人狼陣営"};function At(a){const t={};return a.forEach(e=>{const[r,c,...s]=e.split(",");t[r]||(t[r]=we()),Le(t[r],c,s)}),t}function we(){return{agents:{},talks:[],votes:[],execution:null,divine:null,attackVotes:[],attack:null,result:null}}function Le(a,t,e){const c={status:([s,l,g,h])=>{a.agents[s]={role:l,status:g,name:h}},talk:([s,l,g,h])=>{a.talks.push({talkIdx:s,turnIdx:l,agentIdx:g,text:h})},vote:([s,l])=>{a.votes.push({agentIdx:s,targetIdx:l})},execute:([s,l])=>{a.execution={agentIdx:s,role:l}},divine:([s,l,g])=>{a.divine={agentIdx:s,targetIdx:l,result:g}},attackVote:([s,l])=>{a.attackVotes.push({agentIdx:s,targetIdx:l})},attack:([s,l])=>{a.attack={targetIdx:s,isSuccessful:l==="true"}},result:([s,l,g])=>{a.result={villagers:s,werewolves:l,winSide:g}}}[t];c&&c(e)}function G(a,t,e){var s;const r=(s=a[t])==null?void 0:s.agents[e];return`Agent[${e.padStart(2,"0")}]`}function Se(a){const t=a.match(/>>Agent\[\d+\]/);return t?a.replace(t[0],`<strong>${t[0]}</strong>`).trim():a.trim()}var Te=k("<iconify-icon></iconify-icon>",2),Re=k("<iconify-icon></iconify-icon>",2),De=k("<iconify-icon></iconify-icon>",2),Ne=k("<iconify-icon></iconify-icon>",2),Me=k("<iconify-icon></iconify-icon>",2),Oe=k("<iconify-icon></iconify-icon>",2),Ve=k("<iconify-icon></iconify-icon>",2),Ce=k("<li><strong> </strong> </li>"),He=k('<section class="agent-section"><h3>エージェント</h3> <ul></ul></section>'),Fe=k('<div class="talk"><strong> </strong> <!></div>'),Ue=k('<section class="talks-section"><h3>会話</h3> <div class="talks"></div></section>'),We=k("<li><strong> </strong> が <strong> </strong> に投票</li>"),Be=k('<section class="votes-section"><h3>投票</h3> <ul></ul></section>'),Ge=k('<section class="execution-section"><h3>追放</h3> <p><strong> </strong> を追放</p></section>'),Ye=k("<li><strong> </strong> が <strong> </strong> に投票</li>"),ze=k('<section class="attack-votes-section"><h3>襲撃投票</h3> <ul></ul></section>'),Ke=k("<p><strong> </strong> を襲撃: <strong> </strong></p>"),$e=k("<p>襲撃対象なし</p>"),qe=k('<section class="attack-section"><h3>襲撃</h3> <!></section>'),Je=k('<section class="divine-section"><h3>占い</h3> <p><strong> </strong> が <strong> </strong> を占い: <strong> </strong></p></section>'),Pe=k('<section class="result-section"><h3>結果</h3> <p><strong> </strong> が勝利</p></section>'),Xe=k('<div class="day-column"><div class="day-section"><h2 style="margin-bottom: 0"> <!> <!> <!> <!> <!> <!> <!></h2> <div class="scrollable-content"><!> <!> <!> <!> <!> <!> <!> <!></div></div></div>');function Qe(a,t){Vt(t,!1);let e=ot(t,"dayIdx",8),r=ot(t,"dayStatus",8),c=ot(t,"dayStatuses",8);wt();var s=Xe(),l=d(s),g=d(l),h=d(g),L=_(h);{var u=n=>{var i=Te();W(i,"inline",!0),W(i,"icon","mdi:conversation"),I(n,i)};O(L,n=>{r().talks.length>0&&n(u)})}var E=_(L,2);{var x=n=>{var i=Re();W(i,"inline",!0),W(i,"icon","mdi:vote"),I(n,i)};O(E,n=>{r().votes.length>0&&n(x)})}var o=_(E,2);{var y=n=>{var i=De();W(i,"inline",!0),W(i,"icon","mdi:account-remove"),I(n,i)};O(o,n=>{r().execution&&n(y)})}var S=_(o,2);{var w=n=>{var i=Ne();W(i,"inline",!0),W(i,"icon","mdi:vote"),I(n,i)};O(S,n=>{r().attackVotes.length>0&&n(w)})}var f=_(S,2);{var m=n=>{var i=Me();W(i,"inline",!0),W(i,"icon","mdi:sword"),I(n,i)};O(f,n=>{r().attack&&n(m)})}var U=_(f,2);{var D=n=>{var i=Oe();W(i,"inline",!0),W(i,"icon","mdi:account-eye"),I(n,i)};O(U,n=>{r().divine&&n(D)})}var b=_(U,2);{var B=n=>{var i=Ve();W(i,"inline",!0),W(i,"icon","mdi:trophy"),I(n,i)};O(b,n=>{r().result&&n(B)})}v(g);var z=_(g,2),K=d(z);{var rt=n=>{var i=He(),R=_(d(i),2);Z(R,5,()=>Object.entries(r().agents),Q,(M,N)=>{let A=()=>p(N)[0],T=()=>p(N)[1];var V=Ce(),F=d(V),$=d(F,!0);C(()=>H($,G(c(),e(),A()))),v(F);var nt=_(F);v(V),C(()=>{ft(V,"over",T().status!=="ALIVE"),H(nt,` ${ke[T().role]??"NULL"??""} -
                ${Ee[T().status]??"NULL"??""}`)}),I(M,V)}),v(R),v(i),I(n,i)};O(K,n=>{Object.keys(r().agents).length>0&&n(rt)})}var j=_(K,2);{var Wt=n=>{var i=Ue(),R=_(d(i),2);Z(R,5,()=>r().talks,Q,(M,N)=>{var A=Fe(),T=d(A),V=d(T,!0);C(()=>H(V,G(c(),e(),p(N).agentIdx))),v(T);var F=_(T,2);me(F,()=>Se(p(N).text)),v(A),C(()=>ft(A,"over",p(N).text==="Over")),I(M,A)}),v(R),v(i),I(n,i)};O(j,n=>{r().talks.length>0&&n(Wt)})}var dt=_(j,2);{var Bt=n=>{var i=Be(),R=_(d(i),2);Z(R,5,()=>r().votes,Q,(M,N)=>{var A=We(),T=d(A),V=d(T,!0);C(()=>H(V,G(c(),e(),p(N).agentIdx))),v(T);var F=_(T,2),$=d(F,!0);C(()=>H($,G(c(),e(),p(N).targetIdx))),v(F),tt(),v(A),I(M,A)}),v(R),v(i),I(n,i)};O(dt,n=>{r().votes.length>0&&n(Bt)})}var _t=_(dt,2);{var Gt=n=>{var i=Ge(),R=_(d(i),2),M=d(R),N=d(M,!0);C(()=>H(N,G(c(),e(),r().execution.agentIdx))),v(M),tt(),v(R),v(i),I(n,i)};O(_t,n=>{r().execution&&n(Gt)})}var gt=_(_t,2);{var Yt=n=>{var i=ze(),R=_(d(i),2);Z(R,5,()=>r().attackVotes,Q,(M,N)=>{var A=Ye(),T=d(A),V=d(T,!0);C(()=>H(V,G(c(),e(),p(N).agentIdx))),v(T);var F=_(T,2),$=d(F,!0);C(()=>H($,G(c(),e(),p(N).targetIdx))),v(F),tt(),v(A),I(M,A)}),v(R),v(i),I(n,i)};O(gt,n=>{r().attackVotes.length>0&&n(Yt)})}var ht=_(gt,2);{var zt=n=>{var i=qe(),R=_(d(i),2);{var M=A=>{var T=Ke(),V=d(T),F=d(V,!0);C(()=>H(F,G(c(),e(),r().attack.targetIdx))),v(V);var $=_(V,2),nt=d($,!0);v($),v(T),C(()=>H(nt,r().attack.isSuccessful?"成功":"失敗")),I(A,T)},N=A=>{var T=$e();I(A,T)};O(R,A=>{r().attack.targetIdx!=="-1"?A(M):A(N,!1)})}v(i),I(n,i)};O(ht,n=>{r().attack&&n(zt)})}var pt=_(ht,2);{var Kt=n=>{var i=Je(),R=_(d(i),2),M=d(R),N=d(M,!0);C(()=>H(N,G(c(),e(),r().divine.agentIdx))),v(M);var A=_(M,2),T=d(A,!0);C(()=>H(T,G(c(),e(),r().divine.targetIdx))),v(A);var V=_(A,2),F=d(V,!0);v(V),v(R),v(i),C(()=>H(F,be[r().divine.result]??"NULL")),I(n,i)};O(pt,n=>{r().divine&&n(Kt)})}var $t=_(pt,2);{var qt=n=>{var i=Pe(),R=_(d(i),2),M=d(R),N=d(M,!0);v(M),tt(),v(R),v(i),C(()=>H(N,Ae[r().result.winSide])),I(n,i)};O($t,n=>{r().result&&n(qt)})}v(z),v(l),v(s),C(()=>H(h,`Day ${e()??""} `)),I(a,s),Ct()}var Ze=k('<link rel="stylesheet">'),je=k('<input id="fileInput" type="file" accept=".log" multiple hidden> <div tabindex="0" class="file-input-container" role="button"><div class="file-input-label"><span>ファイルを選択もしくはドラッグアンドドロップしてください</span></div></div>',1),ta=k('<div class="tab-wrapper"><button class="tab-button"> </button> <button class="close-button" aria-label="Close tab">✕</button></div>'),ea=k('<div class="log-container"><div class="tabs-container"><div class="tabs"></div></div> <div class="days-container"></div></div>'),aa=k('<main><pre class="title">aiwolf-nlp-viewer</pre> <!> <!></main>');function ca(a,t){Vt(t,!1);let e=st([]),r=st(0);function c(o){const y=o.target;Array.from(y.files||[]).forEach(w=>{const f=new FileReader;f.onload=m=>{var b;const D=(((b=m.target)==null?void 0:b.result)??"").split(/\r?\n/).filter(B=>B.trim());q(e,[...p(e),{name:w.name,data:D,processed:At(D)}]),q(r,p(e).length-1)},f.readAsText(w)})}function s(o){var S;Array.from(((S=o.dataTransfer)==null?void 0:S.files)||[]).forEach(w=>{const f=new FileReader;f.onload=m=>{var b;const D=(((b=m.target)==null?void 0:b.result)??"").split(`
`).filter(B=>B.trim());q(e,[...p(e),{name:w.name,data:D,processed:At(D)}]),q(r,p(e).length-1)},f.readAsText(w)})}function l(o){q(e,p(e).filter((y,S)=>S!==o)),p(r)>=p(e).length&&q(r,p(e).length-1)}let g=st(null);wt();var h=aa();_e(o=>{var y=Ze();ue.title="aiwolf-nlp-viewer",Ft(y,"href",`${he??""}/global.css`),I(o,y)});var L=_(d(h),2);{var u=o=>{var y=je(),S=de(y);ge(S,f=>q(g,f),()=>p(g));var w=_(S,2);P("change",S,c),P("dragover",w,bt(function(f){Ie.call(this,t,f)})),P("drop",w,bt(s)),P("click",w,()=>{var f;return(f=p(g))==null?void 0:f.click()}),P("keydown",w,f=>{var m;f.key==="Enter"&&((m=p(g))==null||m.click())}),I(o,y)};O(L,o=>{p(e).length===0&&o(u)})}var E=_(L,2);{var x=o=>{var y=ea(),S=d(y),w=d(S);Z(w,5,()=>p(e),Q,(m,U,D)=>{var b=ta(),B=d(b),z=d(B,!0);v(B);var K=_(B,2);v(b),C(()=>{ft(b,"active",p(r)===D),H(z,p(U).name)}),P("click",B,()=>q(r,D)),P("click",K,()=>l(D)),I(m,b)}),v(w),v(S);var f=_(S,2);Z(f,5,()=>Object.entries(p(e)[p(r)].processed),Q,(m,U)=>{let D=()=>p(U)[0],b=()=>p(U)[1];Qe(m,{get dayIdx(){return D()},get dayStatus(){return b()},get dayStatuses(){return p(e)[p(r)].processed}})}),v(f),v(y),I(o,y)};O(E,o=>{p(e).length>0&&o(x)})}v(h),I(a,h),Ct()}export{ca as component};
