import{t as P,a as N,c as lt}from"../chunks/Co3XnC6y.js";import{p as it,s as z,h as g,i as at,a as ct,aE as V,c as y,g as $,f as O,aF as R,av as ft,$ as dt}from"../chunks/BgVlIibR.js";import{d as mt,s as bt}from"../chunks/DYnTS7MI.js";import{h as gt}from"../chunks/BcqNrQiA.js";import{p as q}from"../chunks/DR9iGoyE.js";import{s as pt,a as tt}from"../chunks/Du4kYnFj.js";import{w as C}from"../chunks/CdKjNHNx.js";import{a as ut,o as vt}from"../chunks/CbCva-KA.js";/* empty css                */import{i as nt}from"../chunks/BuyP8_jq.js";import{a as h,r as et,c as ot}from"../chunks/IJDf9Saa.js";import{b as _t}from"../chunks/BNHwseCK.js";class B{static fromJson(n){return St(JSON.parse(n),H("AgentSettings"))}static toJson(n){return JSON.stringify(jt(n,H("AgentSettings")),null,2)}}function j(t,n,e,o=""){const l=G(t),w=o?` on ${o}`:"",p=e?` for key "${e}"`:"";throw Error(`Invalid value${p}${w}. Expected ${l} but got ${JSON.stringify(n)}`)}function G(t){return Array.isArray(t)?t.length===2&&t[0]===void 0?`an optional ${G(t[1])}`:`one of [${t.map(n=>G(n)).join(", ")}]`:typeof t=="object"&&t.literal!==void 0?t.literal:typeof t}function ht(t){if(t.jsonToJS===void 0){const n={};t.props.forEach(e=>n[e.json]={key:e.js,typ:e.typ}),t.jsonToJS=n}return t.jsonToJS}function wt(t){if(t.jsToJSON===void 0){const n={};t.props.forEach(e=>n[e.js]={key:e.json,typ:e.typ}),t.jsToJSON=n}return t.jsToJSON}function A(t,n,e,o="",l=""){function w(r,s){return typeof r==typeof s?s:j(r,s,o,l)}function p(r,s){const c=r.length;for(let d=0;d<c;d++){const i=r[d];try{return A(s,i,e)}catch{}}return j(r,s,o,l)}function u(r,s){return r.indexOf(s)!==-1?s:j(r.map(c=>M(c)),s,o,l)}function a(r,s){return Array.isArray(s)?s.map(c=>A(c,r,e)):j(M("array"),s,o,l)}function m(r){if(r===null)return null;const s=new Date(r);return isNaN(s.valueOf())?j(M("Date"),r,o,l):s}function v(r,s,c){if(c===null||typeof c!="object"||Array.isArray(c))return j(M(b||"object"),c,o,l);const d={};return Object.getOwnPropertyNames(r).forEach(i=>{const x=r[i],k=Object.prototype.hasOwnProperty.call(c,i)?c[i]:void 0;d[x.key]=A(k,x.typ,e,i,b)}),Object.getOwnPropertyNames(c).forEach(i=>{Object.prototype.hasOwnProperty.call(r,i)||(d[i]=A(c[i],s,e,i,b))}),d}if(n==="any")return t;if(n===null)return t===null?t:j(n,t,o,l);if(n===!1)return j(n,t,o,l);let b;for(;typeof n=="object"&&n.ref!==void 0;)b=n.ref,n=yt[n.ref];return Array.isArray(n)?u(n,t):typeof n=="object"?n.hasOwnProperty("unionMembers")?p(n.unionMembers,t):n.hasOwnProperty("arrayItems")?a(n.arrayItems,t):n.hasOwnProperty("props")?v(e(n),n.additional,t):j(n,t,o,l):n===Date&&typeof t!="number"?m(t):w(n,t)}function St(t,n){return A(t,n,ht)}function jt(t,n){return A(t,n,wt)}function M(t){return{literal:t}}function st(t,n){return{props:t,additional:n}}function H(t){return{ref:t}}const yt={AgentSettings:st([{json:"connection",js:"connection",typ:H("Connection")}],!1),Connection:st([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1)},rt={connection:{url:"ws://localhost:8080/ws",token:""}};function Ot(){const t=localStorage.getItem("agent-settings");if(t)try{return B.fromJson(t)}catch(n){console.error(n)}return localStorage.setItem("agent-settings",B.toJson(rt)),rt}const T=C(Ot());T.subscribe(t=>{localStorage.setItem("agent-settings",B.toJson(t))});function xt(){const{subscribe:t,update:n}=C({status:"disconnected",entries:[]});let e=null,o=null;T.subscribe(u=>{o=u});function l(){if(!o)return;n(a=>({...a,status:"connecting"}));const u=new URL(o.connection.url);o.connection.token&&u.searchParams.set("token",o.connection.token),e=new WebSocket(u),e.onopen=()=>{n(a=>({...a,status:"connected"}))},e.onclose=()=>{n(a=>({...a,status:"disconnected"})),e=null},e.onerror=()=>{n(a=>({...a,status:"disconnected"})),e=null},e.onmessage=a=>{try{const m=JSON.parse(a.data);n(v=>{const b=v.entries.slice();return b.push(m),{...v,entries:b}})}catch(m){console.error("Failed to parse message:",m)}}}function w(){e&&(n(u=>({...u,status:"disconnected"})),e.close(),e=null)}function p(u){if(e&&e.readyState===WebSocket.OPEN)try{e.send(u)}catch(a){console.error("Failed to send message:",a)}}return{subscribe:t,connect:l,disconnect:w,send:p,entries:{subscribe:u=>t(a=>{u(a.entries)})}}}const E=xt();function kt(){E.connect()}function Jt(){E.disconnect()}var $t=P('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Nt=P('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),At=P('<div class="status status-error"></div>'),Tt=(t,n)=>n("connection.url",t.currentTarget.value),Et=(t,n)=>n("connection.token",t.currentTarget.value),Pt=P('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Dt(t,n){it(n,!0);let e=V(void 0),o=V(void 0);const l=T.subscribe(f=>{z(e,q(f))}),w=E.subscribe(f=>{z(o,q(f.status))});ut(()=>{l(),w()});function p(f,S){T.update(D=>{const I=f.split("."),K=I.pop();let _=D;for(const J of I)J&&(_=_[J]);return _[K]=S,{...D}})}let u;var a=Pt(),m=g(y(a),2),v=y(m),b=y(v);{var r=f=>{var S=$t();R(2),N(f,S)},s=f=>{var S=lt(),D=ft(S);{var I=_=>{var J=Nt();R(2),N(_,J)},K=_=>{var J=At();N(_,J)};nt(D,_=>{$(o)==="connecting"?_(I):_(K,!1)},!0)}N(f,S)};nt(b,f=>{$(o)==="connected"?f(r):f(s,!1)})}O(v),O(m);var c=g(m,2),d=y(c);h(d,"class","h-[1em] opacity-50"),h(d,"inline",!0),h(d,"icon","mdi:link");var i=g(d,2);et(i),i.__input=[Tt,p],O(c);var x=g(c,2),k=y(x);h(k,"class","h-[1em] opacity-50"),h(k,"inline",!0),h(k,"icon","mdi:key");var U=g(k,2);et(U),U.__input=[Et,p],R(2),O(x);var F=g(x,2);F.__click=[kt];var L=g(F,2);L.__click=[Jt];var Q=g(L,2);Q.__click=()=>u.showModal();var X=g(Q,2);_t(X,f=>u=f,()=>u);var Y=g(X,2),W=y(Y);h(W,"inline",!0),h(W,"icon","mdi:white-balance-sunny");var Z=g(W,4);h(Z,"inline",!0),h(Z,"icon","mdi:moon-and-stars"),O(Y),O(a),at(()=>{var f,S;ot(i,(f=$(e))==null?void 0:f.connection.url),ot(U,(S=$(e))==null?void 0:S.connection.token),F.disabled=$(o)!=="disconnected",L.disabled=$(o)==="disconnected"}),N(t,a),ct()}mt(["input","click"]);var It=P('<main class="h-screen"><!> <pre> </pre></main>');function Gt(t,n){it(n,!0);const[e,o]=pt(),l=()=>tt(u,"$status",e),w=()=>tt(p,"$entries",e),p=C([]),u=C("");let a=V(void 0);vt(()=>{const s=E.subscribe(i=>{p.set(i.entries)}),c=E.subscribe(i=>{u.set(i.status)}),d=T.subscribe(i=>{z(a,q(i))});ut(()=>{s(),c(),d()}),window.addEventListener("beforeunload",i=>{l()==="connecting"&&i.preventDefault()})});var m=It();gt(s=>{dt.title="aiwolf-nlp-viewer"});var v=y(m);Dt(v,{});var b=g(v,2),r=y(b,!0);O(b),O(m),at(s=>bt(r,s),[()=>JSON.stringify(w(),null,2)]),N(t,m),ct(),o()}export{Gt as component};
