import{t as J,a as w,c as ke,d as at}from"../chunks/KF065-Of.js";import{p as Ze,i as Pe,F as ot,t as W,a as $e,aG as Je,c as i,s as o,d as n,r as s,aI as Be,h as ut,f as ve,$ as dt}from"../chunks/WljbgmZ9.js";import{d as et,s as H}from"../chunks/Czb08BA8.js";import{i as Y}from"../chunks/CGvRluNl.js";import{e as qe,i as Ke}from"../chunks/BOY3IeON.js";import{h as ft}from"../chunks/DvJjqZJ0.js";import{a as Ue,s as ne,r as ce,c as rt,d as _e}from"../chunks/k-SCwr8L.js";import{I as lt,s as Ye,c as st,d as vt,t as Ve}from"../chunks/9NpjLArR.js";import{p as Ne}from"../chunks/RnHXTejU.js";import{b as bt}from"../chunks/DfBBF2dG.js";import{b as Se}from"../chunks/C28Vk92-.js";import{s as We,a as _t,b as mt}from"../chunks/DfkBhsIr.js";import{p as pt}from"../chunks/BD85P5Yk.js";import{w as Te,d as xt}from"../chunks/DSmV8dyb.js";import{a as tt,o as ct}from"../chunks/DqW53znk.js";/* empty css                */import{p as gt}from"../chunks/2NXx3BEr.js";import{b as ht}from"../chunks/UIyLli2V.js";function yt(t,e,a,r){var k=t.__styles??(t.__styles={});k[e]!==a&&(k[e]=a,a==null?t.style.removeProperty(e):t.style.setProperty(e,a,""))}class Ge{static fromJson(e){return St(JSON.parse(e),Oe("RealtimeSettings"))}static toJson(e){return JSON.stringify(jt(e,Oe("RealtimeSettings")),null,2)}}function he(t,e,a,r=""){const k=Qe(t),U=r?` on ${r}`:"",_=a?` for key "${a}"`:"";throw Error(`Invalid value${_}${U}. Expected ${k} but got ${JSON.stringify(e)}`)}function Qe(t){return Array.isArray(t)?t.length===2&&t[0]===void 0?`an optional ${Qe(t[1])}`:`one of [${t.map(e=>Qe(e)).join(", ")}]`:typeof t=="object"&&t.literal!==void 0?t.literal:typeof t}function wt(t){if(t.jsonToJS===void 0){const e={};t.props.forEach(a=>e[a.json]={key:a.js,typ:a.typ}),t.jsonToJS=e}return t.jsonToJS}function kt(t){if(t.jsToJSON===void 0){const e={};t.props.forEach(a=>e[a.js]={key:a.json,typ:a.typ}),t.jsToJSON=e}return t.jsToJSON}function Ie(t,e,a,r="",k=""){function U(E,T){return typeof E==typeof T?T:he(E,T,r,k)}function _(E,T){const R=E.length;for(let q=0;q<R;q++){const C=E[q];try{return Ie(T,C,a)}catch{}}return he(E,T,r,k)}function m(E,T){return E.indexOf(T)!==-1?T:he(E.map(R=>Fe(R)),T,r,k)}function N(E,T){return Array.isArray(T)?T.map(R=>Ie(R,E,a)):he(Fe("array"),T,r,k)}function V(E){if(E===null)return null;const T=new Date(E);return isNaN(T.valueOf())?he(Fe("Date"),E,r,k):T}function X(E,T,R){if(R===null||typeof R!="object"||Array.isArray(R))return he(Fe($||"object"),R,r,k);const q={};return Object.getOwnPropertyNames(E).forEach(C=>{const ae=E[C],te=Object.prototype.hasOwnProperty.call(R,C)?R[C]:void 0;q[ae.key]=Ie(te,ae.typ,a,C,$)}),Object.getOwnPropertyNames(R).forEach(C=>{Object.prototype.hasOwnProperty.call(E,C)||(q[C]=Ie(R[C],T,a,C,$))}),q}if(e==="any")return t;if(e===null)return t===null?t:he(e,t,r,k);if(e===!1)return he(e,t,r,k);let $;for(;typeof e=="object"&&e.ref!==void 0;)$=e.ref,e=Et[e.ref];return Array.isArray(e)?m(e,t):typeof e=="object"?e.hasOwnProperty("unionMembers")?_(e.unionMembers,t):e.hasOwnProperty("arrayItems")?N(e.arrayItems,t):e.hasOwnProperty("props")?X(a(e),e.additional,t):he(e,t,r,k):e===Date&&typeof t!="number"?V(t):U(e,t)}function St(t,e){return Ie(t,e,wt)}function jt(t,e){return Ie(t,e,kt)}function Fe(t){return{literal:t}}function He(t,e){return{props:t,additional:e}}function Oe(t){return{ref:t}}const Et={RealtimeSettings:He([{json:"connection",js:"connection",typ:Oe("Connection")},{json:"display",js:"display",typ:Oe("Display")}],!1),Connection:He([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:He([{json:"canvas",js:"canvas",typ:Oe("Agent")},{json:"bubble",js:"bubble",typ:Oe("Agent")},{json:"text",js:"text",typ:Oe("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:He([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},it={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function Tt(){const t=localStorage.getItem("realtime-settings");if(t)try{return Ge.fromJson(t)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",Ge.toJson(it)),it}const Re=Te(Tt());Re.subscribe(t=>{localStorage.setItem("realtime-settings",Ge.toJson(t))});function Ot(t){return Array.from({length:t},(e,a)=>({idx:a+1,team:"Undefined",name:lt(a+1),role:"Undefined",is_alive:!0}))}function Q(t,e,a){var k,U,_;if(a===void 0)return"該当なし";let r=[];return t!=null&&t.name&&r.push((k=e.agents.find(m=>m.idx===a))==null?void 0:k.name),t!=null&&t.team&&r.push((U=e.agents.find(m=>m.idx===a))==null?void 0:U.team),t!=null&&t.role&&r.push((_=e.agents.find(m=>m.idx===a))==null?void 0:_.role),r.join(" ")}function ze(t,e){return(t||e)&&!(t&&e)}function Rt(){const{subscribe:t,update:e}=Te({status:"disconnected",entries:{}});let a=null,r=null;Re.subscribe(_=>{r=_});function k(){if(!r)return;e(m=>({...m,status:"connecting"}));const _=new URL(r.connection.url);r.connection.token&&_.searchParams.set("token",r.connection.token),a=new WebSocket(_),a.onopen=()=>{e(m=>({...m,status:"connected"}))},a.onclose=()=>{e(m=>({...m,status:"disconnected"})),a=null},a.onerror=()=>{e(m=>({...m,status:"disconnected"})),a=null},a.onmessage=m=>{try{const N=JSON.parse(m.data);console.log("Received packet:",N),e(V=>{const X={...V.entries};return X[N.id]||(X[N.id]=[]),X[N.id].push(N),{...V,entries:X}})}catch(N){console.error("Failed to parse message:",N)}}}function U(){a&&(e(_=>({..._,status:"disconnected"})),a.close(),a=null)}return{subscribe:t,connect:k,disconnect:U,entries:{subscribe:_=>t(m=>_(m.entries))}}}const Me=Rt();var Ct=J('<div role="alert" class="alert m-4"><span class="text-lg font-bold"> </span></div>'),Lt=J('<pre class="base-content w-2/5 text-5xl font-bold opacity-70 absolute top-0 left-0 -mt-4 ml-8 select-none"> <br> <br> </pre>'),At=(t,e,a)=>{e()===n(a).idx?e(void 0):e(n(a).idx)},It=J('<div class="absolute inset-0 flex items-center justify-center"><pre class="text-9xl font-bold opacity-75 select-none"> </pre></div>'),Pt=J('<pre class="base-content select-none"> </pre>'),Jt=J('<pre class="base-content text-2xl mt-2 select-none"> </pre>'),Nt=J('<pre class="base-content select-none"> </pre>'),Mt=J('<pre class="base-content text-2xl mt-2 select-none"> </pre>'),Dt=J('<pre class="base-content select-none"> </pre>'),Wt=J('<div class="absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-x72s6v"><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"> <!></button></div></div> <!> <!> <!></div>'),zt=J('<div class="h-full flex flex-col"><div class="bg-secondary"></div> <!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><span>イラスト : 石黒正数氏</span></aside></footer></div>');function Bt(t,e){Ze(e,!0);let a=gt(e,"focusIdx",15),r=Je(void 0);const k=Re.subscribe(f=>{Pe(r,Ne(f))});tt(k);let U=ut(()=>{var f,c,I,S,M,h,j,P,u,p,b,L,d,l;switch(e.packet.event){case"未接続":return"未接続";case"トーク":return e.packet.message;case"囁き":return ze(a()===void 0,((f=e.packet.agents.find(v=>v.idx===a()))==null?void 0:f.role)==="WEREWOLF")?e.packet.message:"囁きました";case"襲撃投票":return ze(a()===void 0,e.packet.from_idx===a())?`${Q((c=n(r))==null?void 0:c.display.bubble,e.packet,e.packet.from_idx)} が ${Q((I=n(r))==null?void 0:I.display.bubble,e.packet,e.packet.to_idx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return ze(a()===void 0,e.packet.from_idx===a())?`${Q((S=n(r))==null?void 0:S.display.bubble,e.packet,e.packet.from_idx)} が ${Q((M=n(r))==null?void 0:M.display.bubble,e.packet,e.packet.to_idx)} に投票しました`:`${Q((h=n(r))==null?void 0:h.display.bubble,e.packet,e.packet.from_idx)} が投票しました`;case"追放":return e.packet.to_idx===void 0?"誰も追放されませんでした":`${Q((j=n(r))==null?void 0:j.display.bubble,e.packet,e.packet.to_idx)} を追放しました`;case"襲撃":return e.packet.to_idx===void 0?"誰も襲撃されませんでした":e.packet.from_idx===-1?`${Q((P=n(r))==null?void 0:P.display.bubble,e.packet,e.packet.to_idx)} が襲撃されましたが、護衛されました`:`${Q((u=n(r))==null?void 0:u.display.bubble,e.packet,e.packet.to_idx)} が襲撃されました`;case"占い":return ze(a()===void 0,e.packet.from_idx===a())?`${Q((p=n(r))==null?void 0:p.display.bubble,e.packet,e.packet.from_idx)} が ${Q((b=n(r))==null?void 0:b.display.bubble,e.packet,e.packet.to_idx)} を占った結果、${vt((L=e.packet.agents.find(v=>v.idx===e.packet.to_idx))==null?void 0:L.role)} でした`:"占いました";case"護衛":return ze(a()===void 0,e.packet.from_idx===a())?`${Q((d=n(r))==null?void 0:d.display.bubble,e.packet,e.packet.from_idx)} が ${Q((l=n(r))==null?void 0:l.display.bubble,e.packet,e.packet.to_idx)} を護衛対象にしました`:"護衛しました";case"終了":return e.packet.message+" が勝利しました";default:return}}),_,m,N,V,X;ct(()=>(window.addEventListener("resize",$),()=>{window.removeEventListener("resize",$)})),ot(()=>{$()});function $(){var M;if(!m||!N||!_)return;const f=_.getBoundingClientRect();if([m,N].forEach(h=>{h.width=f.width,h.height=f.height;const j=h.getContext("2d");j&&(j.clearRect(0,0,h.width,h.height),j.globalAlpha=1,j.lineWidth=2)}),a()!==void 0&&(e.packet.event==="囁き"&&((M=e.packet.agents.find(h=>h.idx===a()))==null?void 0:M.role)!=="WEREWOLF"||e.packet.event==="占い"&&e.packet.from_idx!==a()||e.packet.event==="投票"&&e.packet.from_idx!==a()||e.packet.event==="襲撃投票"&&e.packet.from_idx!==a()))return;const c=m.getContext("2d"),I=N.getContext("2d");if(!c||!I)return;const S=N.getBoundingClientRect();if(e.packet.from_idx!==void 0&&e.packet.to_idx!==void 0){const h=document.getElementById(`agent-${e.packet.from_idx}`);if(!(h instanceof HTMLElement))return;const j=h.getBoundingClientRect(),P=j.left+j.width/2-S.left,u=j.top+j.height/2-S.top,p=document.getElementById(`agent-${e.packet.to_idx}`);if(!(p instanceof HTMLElement))return;const b=p.getBoundingClientRect();E(I,P,u,b.left+b.width/2-S.left,b.top+b.height/2-S.top,!1,getComputedStyle(X).getPropertyValue("background-color"))}if(e.packet.bubble_idx!==void 0){const h=document.getElementById(`agent-${e.packet.bubble_idx}`);if(!(h instanceof HTMLElement))return;const j=h.getBoundingClientRect(),P=j.left+j.width/2-S.left,u=j.top+j.height/2-S.top;E(c,S.width/2,S.height/2,P,u,!0,getComputedStyle(V).getPropertyValue("background-color"))}}function E(f,c,I,S,M,h,j){const P=h?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];f.strokeStyle=f.fillStyle=j,f.beginPath();let u=S-c,p=M-I,b=Math.sqrt(u*u+p*p),L=p/b,d=u/b,l=[];l.push(0,0);for(let v=0;v<P.length;v+=2){let z=P[v],y=P[v+1];l.push(z<0?b+z:z,y)}l.push(b,0);for(let v=P.length;v>0;v-=2){let z=P[v-2],y=P[v-1];l.push(z<0?b+z:z,-y)}l.push(0,0);for(let v=0;v<l.length;v+=2){let z=l[v]*d-l[v+1]*L+c,y=l[v]*L+l[v+1]*d+I;v===0?f.moveTo(z,y):f.lineTo(z,y)}f.fill()}var T=zt(),R=i(T);Se(R,f=>X=f,()=>X);var q=o(R,2);{var C=f=>{var c=Ct(),I=i(c),S=i(I);s(I),s(c),W(()=>H(S,`${e.packet.day??""}日目 ${(e.packet.is_day?"昼":"夜")??""}
        ${e.packet.event??""}フェーズ`)),w(f,c)};Y(q,f=>{var c;(c=n(r))!=null&&c.display.largeScale||f(C)})}var ae=o(q,2),te=i(ae),ue=i(te);{var je=f=>{var c=Lt(),I=i(c),S=o(I,2,!0),M=o(S,2,!0);s(c),W(()=>{H(I,`${e.packet.day??""}日目`),H(S,e.packet.is_day?"昼":"夜"),H(M,e.packet.event)}),w(f,c)};Y(ue,f=>{var c;(c=n(r))!=null&&c.display.largeScale&&f(je)})}var ye=o(ue,2);Se(ye,f=>m=f,()=>m);var we=o(ye,2);Se(we,f=>N=f,()=>N);var ee=o(we,2),me=i(ee),pe=i(me),xe=i(pe,!0);s(pe),s(me),s(ee),Se(ee,f=>V=f,()=>V);var be=o(ee,2);qe(be,17,()=>e.packet.agents,Ke,(f,c,I)=>{var S=Wt(),M=i(S),h=i(M),j=i(h);j.__click=[At,a,c];var P=i(j),u=o(P,2);{var p=y=>{var x=It(),F=i(x),le=i(F,!0);s(F),s(x),W(()=>H(le,n(c).idx)),w(y,x)};Y(u,y=>{var x,F;(x=n(r))!=null&&x.display.largeScale&&((F=n(r))!=null&&F.display.canvas.name)&&y(p)})}s(j),s(h),s(M);var b=o(M,2);{var L=y=>{var x=Pt(),F=i(x,!0);s(x),W(le=>H(F,le),[()=>lt(n(c).idx)]),w(y,x)};Y(b,y=>{var x,F;!((x=n(r))!=null&&x.display.largeScale)&&((F=n(r))!=null&&F.display.canvas.name)&&y(L)})}var d=o(b,2);{var l=y=>{var x=ke(),F=ve(x);{var le=O=>{var g=Jt(),G=i(g,!0);s(g),W(()=>H(G,n(c).team)),w(O,g)},ge=O=>{var g=Nt(),G=i(g,!0);s(g),W(()=>H(G,n(c).team)),w(O,g)};Y(F,O=>{var g;(g=n(r))!=null&&g.display.largeScale?O(le):O(ge,!1)})}w(y,x)};Y(d,y=>{var x;(x=n(r))!=null&&x.display.canvas.team&&y(l)})}var v=o(d,2);{var z=y=>{var x=ke(),F=ve(x);{var le=O=>{var g=Mt(),G=i(g,!0);s(g),W(()=>H(G,n(c).role)),w(O,g)},ge=O=>{var g=Dt(),G=i(g,!0);s(g),W(()=>H(G,n(c).role)),w(O,g)};Y(F,O=>{var g;(g=n(r))!=null&&g.display.largeScale?O(le):O(ge,!1)})}w(y,x)};Y(v,y=>{var x;(x=n(r))!=null&&x.display.canvas.role&&(n(c).idx===a()||a()===void 0)&&y(z)})}s(S),W(y=>{var x;Ue(S,"style",`--angle: ${I*(360/e.packet.agents.length)}`),Ue(S,"id",`agent-${n(c).idx??""}`),Ve(S,"bg-focus",n(c).idx===a()),Ye(h,st((x=n(r))!=null&&x.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-x72s6v"),Ve(h,"ring-success",n(c).is_alive),Ve(h,"ring-error",!n(c).is_alive),yt(h,"opacity",n(c).is_alive?1:.25),Ue(P,"src",`${ht??""}/images/male/${y??""}.png`),Ue(P,"alt",n(c).name)},[()=>n(c).idx.toString().padStart(2,"0")]),w(f,S)}),s(te),Se(te,f=>_=f,()=>_),s(ae),Be(2),s(T),W(()=>{var f;ee.hidden=!n(U),Ye(pe,st((f=n(r))!=null&&f.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center"),"svelte-x72s6v"),H(xe,n(U))}),w(t,T),$e()}et(["click"]);function Ut(){Me.connect()}function Xt(){Me.disconnect()}var Ft=J('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Ht=J('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Vt=J('<div class="status status-error"></div>'),qt=(t,e)=>e("connection.url",t.currentTarget.value),Kt=(t,e)=>e("connection.token",t.currentTarget.value),Yt=(t,e)=>e("display.canvas.name",t.currentTarget.checked),Gt=(t,e)=>e("display.canvas.team",t.currentTarget.checked),Qt=(t,e)=>e("display.canvas.role",t.currentTarget.checked),Zt=(t,e)=>e("display.bubble.name",t.currentTarget.checked),$t=(t,e)=>e("display.bubble.team",t.currentTarget.checked),en=(t,e)=>e("display.bubble.role",t.currentTarget.checked),tn=(t,e)=>e("display.text.name",t.currentTarget.checked),nn=(t,e)=>e("display.text.team",t.currentTarget.checked),an=(t,e)=>e("display.text.role",t.currentTarget.checked),rn=(t,e)=>e("display.largeScale",t.currentTarget.checked),sn=J('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control my-2"><h3 class="text-lg font-bold">表示設定</h3> <h4 class="text-base font-bold mt-2">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function on(t,e){Ze(e,!0);let a=Je(void 0),r=Je(void 0);const k=Re.subscribe(B=>{Pe(a,Ne(B))}),U=Me.subscribe(B=>{Pe(r,Ne(B.status))});tt(()=>{k(),U()});function _(B,re){Re.update(Z=>{const A=B.split("."),K=A.pop();let D=Z;for(const se of A)se&&(D=D[se]);return D[K]=re,{...Z}})}let m;var N=sn(),V=o(i(N),2),X=i(V),$=i(X);{var E=B=>{var re=Ft();Be(2),w(B,re)},T=B=>{var re=ke(),Z=ve(re);{var A=D=>{var se=Ht();Be(2),w(D,se)},K=D=>{var se=Vt();w(D,se)};Y(Z,D=>{n(r)==="connecting"?D(A):D(K,!1)},!0)}w(B,re)};Y($,B=>{n(r)==="connected"?B(E):B(T,!1)})}s(X),s(V);var R=o(V,2),q=i(R);ne(q,"class","h-[1em] opacity-50"),ne(q,"inline",!0),ne(q,"icon","mdi:link");var C=o(q,2);ce(C),C.__input=[qt,_],s(R);var ae=o(R,2),te=i(ae);ne(te,"class","h-[1em] opacity-50"),ne(te,"inline",!0),ne(te,"icon","mdi:key");var ue=o(te,2);ce(ue),ue.__input=[Kt,_],Be(2),s(ae);var je=o(ae,2);je.__click=[Ut];var ye=o(je,2);ye.__click=[Xt];var we=o(ye,2);we.__click=()=>m.showModal();var ee=o(we,2),me=i(ee),pe=i(me),xe=o(i(pe),4),be=i(xe),f=o(i(be),2);ce(f),f.__change=[Yt,_],s(be);var c=o(be,2),I=o(i(c),2);ce(I),I.__change=[Gt,_],s(c);var S=o(c,2),M=o(i(S),2);ce(M),M.__change=[Qt,_],s(S),s(xe);var h=o(xe,4),j=i(h),P=o(i(j),2);ce(P),P.__change=[Zt,_],s(j);var u=o(j,2),p=o(i(u),2);ce(p),p.__change=[$t,_],s(u);var b=o(u,2),L=o(i(b),2);ce(L),L.__change=[en,_],s(b),s(h);var d=o(h,4),l=i(d),v=o(i(l),2);ce(v),v.__change=[tn,_],s(l);var z=o(l,2),y=o(i(z),2);ce(y),y.__change=[nn,_],s(z);var x=o(z,2),F=o(i(x),2);ce(F),F.__change=[an,_],s(x),s(d);var le=o(d,4),ge=o(i(le),2);ce(ge),ge.__change=[rn,_],s(le),s(pe),s(me),Be(2),s(ee),Se(ee,B=>m=B,()=>m);var O=o(ee,2),g=i(O);ne(g,"inline",!0),ne(g,"icon","mdi:white-balance-sunny");var G=o(g,4);ne(G,"inline",!0),ne(G,"icon","mdi:moon-and-stars"),s(O),s(N),W(()=>{var B,re,Z,A,K,D,se,ie,de,oe,Ce,Ee;rt(C,(B=n(a))==null?void 0:B.connection.url),rt(ue,(re=n(a))==null?void 0:re.connection.token),je.disabled=n(r)!=="disconnected",ye.disabled=n(r)==="disconnected",_e(f,(Z=n(a))==null?void 0:Z.display.canvas.name),_e(I,(A=n(a))==null?void 0:A.display.canvas.team),_e(M,(K=n(a))==null?void 0:K.display.canvas.role),_e(P,(D=n(a))==null?void 0:D.display.bubble.name),_e(p,(se=n(a))==null?void 0:se.display.bubble.team),_e(L,(ie=n(a))==null?void 0:ie.display.bubble.role),_e(v,(de=n(a))==null?void 0:de.display.text.name),_e(y,(oe=n(a))==null?void 0:oe.display.text.team),_e(F,(Ce=n(a))==null?void 0:Ce.display.text.role),_e(ge,(Ee=n(a))==null?void 0:Ee.display.largeScale)}),w(t,N),$e()}et(["input","click","change"]);var ln=J("<option> </option>"),cn=J('<div class="divider"> </div>'),un=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),dn=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),fn=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),vn=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),bn=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),_n=J("<!> <button><!></button>",1),mn=J('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="flex-1 overflow-y-auto h-full pr-2"><div class="flex flex-col p-2"><select class="w-full select"></select> <div class="list overflow-y-auto flex-1 my-2"><!></div></div></div></div></main>');function Jn(t,e){Ze(e,!0);const[a,r]=_t(),k=()=>We(V,"$selectedId",a),U=()=>We(R,"$entries",a),_=()=>We(q,"$status",a),m=()=>We(X,"$selectedIdx",a),N=()=>We(T,"$currentPacket",a),V=Te(null),X=Te(null);let $=Je(void 0);const E={id:"",idx:-1,day:0,is_day:!0,agents:Ot(5),event:"未接続",message:void 0,from_idx:void 0,to_idx:void 0,bubble_idx:void 0},T=Te(E),R=Te({}),q=Te("");let C=Je(void 0),ae=Je(80),te=!1,ue=null;function je(){{const u=pt.url.searchParams,p=u.get("url"),b=u.get("token");p&&(Re.update(L=>({...L,connection:{url:p??"",token:b??""}})),Me.connect())}}function ye(u){if(!te||!ue)return;const p=ue.getBoundingClientRect(),b=u-p.left,L=p.width;Pe(ae,Ne(Math.min(90,Math.max(10,b/L*100))))}function we(){te=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const u=b=>{const L=b instanceof MouseEvent?b.clientX:b.touches[0].clientX;ye(L)},p=()=>{te=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",u),window.removeEventListener("touchmove",u),window.removeEventListener("mouseup",p),window.removeEventListener("touchend",p)};window.addEventListener("mousemove",u),window.addEventListener("touchmove",u),window.addEventListener("mouseup",p),window.addEventListener("touchend",p)}ct(()=>{je();const u=Me.entries.subscribe(l=>{R.set(l),V.update(v=>v||Object.keys(l)[0]),X.update(()=>k()?l[k()].length-1:null)}),p=Me.subscribe(l=>{q.set(l.status)}),b=V.subscribe(l=>{var v;l&&((v=U()[l])==null?void 0:v.length)>0?X.set(U()[l].length-1):X.set(null)}),L=Re.subscribe(l=>{Pe(C,Ne(l))}),d=xt([V,X,R],([l,v,z])=>{if(!l||v===null)return E;const y=z[l];return!y||v<0||v>=y.length?E:y[v]}).subscribe(l=>{T.set(l)});tt(()=>{u(),p(),L(),b(),d()}),window.addEventListener("beforeunload",l=>{_()==="connected"&&l.preventDefault()}),window.addEventListener("popstate",l=>{_()==="connected"&&l.preventDefault()})});let ee=null;ot(()=>{if(ee&&m()!==null){const u=ee.querySelectorAll("button");m()>=0&&m()<u.length&&u[m()].scrollIntoView({behavior:"smooth",block:"center"})}});var me=mn();ft(u=>{dt.title="aiwolf-nlp-viewer"});var pe=i(me);on(pe,{});var xe=o(pe,2),be=i(xe),f=i(be);Bt(f,{get packet(){return N()},get focusIdx(){return n($)},set focusIdx(u){Pe($,Ne(u))}}),s(be);var c=o(be,2);c.__mousedown=we,c.__touchstart=we;var I=o(c,2),S=i(I),M=i(S);qe(M,5,()=>Object.keys(U()),Ke,(u,p)=>{var b=ln(),L={},d=i(b,!0);s(b),W(()=>{L!==(L=n(p))&&(b.value=(b.__value=n(p))==null?"":n(p)),H(d,n(p))}),w(u,b)}),s(M);var h=o(M,2),j=i(h);{var P=u=>{var p=ke(),b=ve(p);qe(b,1,()=>U()[k()]||[],Ke,(L,d,l)=>{var v=_n(),z=ve(v);{var y=O=>{var g=cn(),G=i(g);s(g),W(()=>H(G,`${n(d).day??""}日目 ${(n(d).is_day?"昼":"夜")??""}`)),w(O,g)};Y(z,O=>{(l>0&&(n(d).day!==U()[k()][l-1].day||n(d).is_day!==U()[k()][l-1].is_day)||l===0)&&O(y)})}var x=o(z,2);x.__click=()=>X.set(l);var F=i(x);{var le=O=>{var g=ke(),G=ve(g);{var B=Z=>{var A=un(),K=i(A,!0);s(A),W(()=>H(K,n(d).event)),w(Z,A)},re=Z=>{var A=ke(),K=ve(A);{var D=ie=>{var de=dn(),oe=ve(de),Ce=i(oe,!0);s(oe);var Ee=o(oe,2);ne(Ee,"inline",!0),ne(Ee,"icon","mdi:skip-forward"),W(fe=>H(Ce,fe),[()=>{var fe;return Q((fe=n(C))==null?void 0:fe.display.text,n(d),n(d).bubble_idx)}]),w(ie,de)},se=ie=>{var de=ke(),oe=ve(de);{var Ce=fe=>{var Le=fn(),De=ve(Le),Ae=i(De,!0);s(De);var nt=o(De,2);ne(nt,"inline",!0),ne(nt,"icon","mdi:arrow-u-down-right-bold"),W(Xe=>H(Ae,Xe),[()=>{var Xe;return Q((Xe=n(C))==null?void 0:Xe.display.text,n(d),n(d).bubble_idx)}]),w(fe,Le)},Ee=fe=>{var Le=vn(),De=i(Le,!0);s(Le),W(Ae=>H(De,Ae),[()=>{var Ae;return Q((Ae=n(C))==null?void 0:Ae.display.text,n(d),n(d).bubble_idx)+"<"+n(d).message}]),w(fe,Le)};Y(oe,fe=>{n(d).message==="Skip"?fe(Ce):fe(Ee,!1)},!0)}w(ie,de)};Y(K,ie=>{n(d).message==="Over"?ie(D):ie(se,!1)},!0)}w(Z,A)};Y(G,Z=>{var A;n(d).event==="囁き"&&n($)!==void 0&&((A=n(d).agents.find(K=>K.idx===n($)))==null?void 0:A.role)!=="WEREWOLF"?Z(B):Z(re,!1)})}w(O,g)},ge=O=>{var g=bn(),G=i(g);{var B=A=>{var K=at();W(D=>H(K,D),[()=>{var D;return Q((D=n(C))==null?void 0:D.display.text,n(d),n(d).from_idx)}]),w(A,K)},re=A=>{var K=ke(),D=ve(K);{var se=ie=>{var de=at();W(oe=>H(de,oe),[()=>{var oe;return Q((oe=n(C))==null?void 0:oe.display.text,n(d),n(d).to_idx)}]),w(ie,de)};Y(D,ie=>{(n(d).event==="追放"||n(d).event==="襲撃")&&ie(se)},!0)}w(A,K)};Y(G,A=>{n(d).event==="投票"||n(d).event==="占い"?A(B):A(re,!1)})}var Z=o(G);s(g),W(()=>H(Z,` ${n(d).event??""}`)),w(O,g)};Y(F,O=>{n(d).event==="トーク"||n(d).event==="囁き"?O(le):O(ge,!1)})}s(x),W(()=>Ye(x,`btn ${(l===m()?"btn-primary":"")??""}`)),w(L,v)}),w(u,p)};Y(j,u=>{k()&&u(P)})}s(h),Se(h,u=>ee=u,()=>ee),s(S),s(I),s(xe),Se(xe,u=>ue=u,()=>ue),s(me),W(()=>Ue(be,"style",`width: ${n(ae)??""}%`)),bt(M,k,u=>mt(V,u)),w(t,me),$e(),r()}et(["mousedown","touchstart","click"]);export{Jn as component};
