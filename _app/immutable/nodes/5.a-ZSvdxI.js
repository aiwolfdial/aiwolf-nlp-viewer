import{t as M,a as h,c as je,d as Ze}from"../chunks/CQIKem6B.js";import{p as Ke,h as Te,o as at,t as H,a as Ye,aG as Re,c as r,s as o,g as t,r as s,aI as Le,y as st,f as fe,$ as rt}from"../chunks/DJzILnW5.js";import{d as qe,s as $}from"../chunks/bj5TrsLi.js";import{i as ee}from"../chunks/bGcRSTrU.js";import{e as Ue,i as Xe}from"../chunks/n8ULSs76.js";import{h as ot}from"../chunks/74kPUpG4.js";import{s as Oe,a as re,r as ce,c as $e,d as de}from"../chunks/BBBnxr-X.js";import{I as Fe,s as He,c as et,d as lt,t as ze}from"../chunks/WWpWeALV.js";import{p as Pe}from"../chunks/BaREKndI.js";import{b as it}from"../chunks/Bdk-xZ3b.js";import{b as ke}from"../chunks/D1AgY69q.js";import{a as Je,s as ct,b as ut}from"../chunks/BiPIVzBk.js";import{p as dt}from"../chunks/CTe_BcGp.js";import{w as Se,d as ft}from"../chunks/B7xs7M_3.js";import{a as Ge,o as nt}from"../chunks/CSRI-F4q.js";/* empty css                */import{b as vt}from"../chunks/tBmCRIm7.js";function bt(n,e,a,m){var l=n.__styles??(n.__styles={});l[e]!==a&&(l[e]=a,a==null?n.style.removeProperty(e):n.style.setProperty(e,a,""))}class We{static fromJson(e){return _t(JSON.parse(e),Ie("RealtimeSettings"))}static toJson(e){return JSON.stringify(gt(e,Ie("RealtimeSettings")),null,2)}}function ge(n,e,a,m=""){const l=Ve(n),W=m?` on ${m}`:"",b=a?` for key "${a}"`:"";throw Error(`Invalid value${b}${W}. Expected ${l} but got ${JSON.stringify(e)}`)}function Ve(n){return Array.isArray(n)?n.length===2&&n[0]===void 0?`an optional ${Ve(n[1])}`:`one of [${n.map(e=>Ve(e)).join(", ")}]`:typeof n=="object"&&n.literal!==void 0?n.literal:typeof n}function mt(n){if(n.jsonToJS===void 0){const e={};n.props.forEach(a=>e[a.json]={key:a.js,typ:a.typ}),n.jsonToJS=e}return n.jsonToJS}function pt(n){if(n.jsToJSON===void 0){const e={};n.props.forEach(a=>e[a.js]={key:a.json,typ:a.typ}),n.jsToJSON=e}return n.jsToJSON}function Ae(n,e,a,m="",l=""){function W(T,w){return typeof T==typeof w?w:ge(T,w,m,l)}function b(T,w){const R=T.length;for(let L=0;L<R;L++){const z=T[L];try{return Ae(w,z,a)}catch{}}return ge(T,w,m,l)}function A(T,w){return T.indexOf(w)!==-1?w:ge(T.map(R=>Ne(R)),w,m,l)}function B(T,w){return Array.isArray(w)?w.map(R=>Ae(R,T,a)):ge(Ne("array"),w,m,l)}function F(T){if(T===null)return null;const w=new Date(T);return isNaN(w.valueOf())?ge(Ne("Date"),T,m,l):w}function V(T,w,R){if(R===null||typeof R!="object"||Array.isArray(R))return ge(Ne(ne||"object"),R,m,l);const L={};return Object.getOwnPropertyNames(T).forEach(z=>{const ae=T[z],te=Object.prototype.hasOwnProperty.call(R,z)?R[z]:void 0;L[ae.key]=Ae(te,ae.typ,a,z,ne)}),Object.getOwnPropertyNames(R).forEach(z=>{Object.prototype.hasOwnProperty.call(T,z)||(L[z]=Ae(R[z],w,a,z,ne))}),L}if(e==="any")return n;if(e===null)return n===null?n:ge(e,n,m,l);if(e===!1)return ge(e,n,m,l);let ne;for(;typeof e=="object"&&e.ref!==void 0;)ne=e.ref,e=ht[e.ref];return Array.isArray(e)?A(e,n):typeof e=="object"?e.hasOwnProperty("unionMembers")?b(e.unionMembers,n):e.hasOwnProperty("arrayItems")?B(e.arrayItems,n):e.hasOwnProperty("props")?V(a(e),e.additional,n):ge(e,n,m,l):e===Date&&typeof n!="number"?F(n):W(e,n)}function _t(n,e){return Ae(n,e,mt)}function gt(n,e){return Ae(n,e,pt)}function Ne(n){return{literal:n}}function Me(n,e){return{props:n,additional:e}}function Ie(n){return{ref:n}}const ht={RealtimeSettings:Me([{json:"connection",js:"connection",typ:Ie("Connection")},{json:"display",js:"display",typ:Ie("Display")}],!1),Connection:Me([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:Me([{json:"canvas",js:"canvas",typ:Ie("Agent")},{json:"bubble",js:"bubble",typ:Ie("Agent")},{json:"text",js:"text",typ:Ie("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:Me([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},tt={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function xt(){const n=localStorage.getItem("realtime-settings");if(n)try{return We.fromJson(n)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",We.toJson(tt)),tt}const Ee=Se(xt());Ee.subscribe(n=>{localStorage.setItem("realtime-settings",We.toJson(n))});function yt(n){return Array.from({length:n},(e,a)=>({idx:a+1,team:"Undefined",name:Fe(a+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}function Z(n,e,a){var l,W;if(a===void 0)return"該当なし";let m=[];return n!=null&&n.name&&m.push(Fe(a)),n!=null&&n.team&&m.push((l=e.agents.find(b=>b.idx===a))==null?void 0:l.team),n!=null&&n.role&&m.push((W=e.agents.find(b=>b.idx===a))==null?void 0:W.role),m.join(" ")}function Be(n,e){return(n||e)&&!(n&&e)}function wt(){const{subscribe:n,update:e}=Se({status:"disconnected",entries:{}});let a=null,m=null;Ee.subscribe(b=>{m=b});function l(){if(!m)return;e(A=>({...A,status:"connecting"}));const b=new URL(m.connection.url);m.connection.token&&b.searchParams.set("token",m.connection.token),a=new WebSocket(b),a.onopen=()=>{e(A=>({...A,status:"connected"}))},a.onclose=()=>{e(A=>({...A,status:"disconnected"})),a=null},a.onerror=()=>{e(A=>({...A,status:"disconnected"})),a=null},a.onmessage=A=>{try{const B=JSON.parse(A.data);e(F=>{const V={...F.entries};return V[B.id]||(V[B.id]=[]),V[B.id].push(B),{...F,entries:V}})}catch(B){console.error("Failed to parse message:",B)}}}function W(){a&&(e(b=>({...b,status:"disconnected"})),a.close(),a=null)}return{subscribe:n,connect:l,disconnect:W,entries:{subscribe:b=>n(A=>b(A.entries))}}}const Ce=wt();var kt=M('<div role="alert" class="alert m-4"><span class="text-lg font-bold"> </span></div>'),St=M('<span class="base-content w-2/5 text-9xl font-black opacity-50 absolute top-0 left-0 -mt-4 ml-8 select-none"> </span>'),It=(n,e,a)=>{t(e)===t(a).idx?Te(e,void 0):Te(e,Pe(t(a).idx))},jt=M('<div class="absolute inset-0 flex items-center justify-center"><span class="text-9xl font-bold opacity-75 select-none"> </span></div>'),Tt=M('<span class="base-content select-none"> </span>'),Et=M('<span class="base-content text-2xl mt-2 select-none"> </span>'),Ot=M('<span class="base-content select-none"> </span>'),At=M('<span class="base-content text-2xl mt-2 select-none"> </span>'),Ct=M('<span class="base-content select-none"> </span>'),Rt=M('<div class="absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-1d36lc1"><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"> <!></button></div></div> <!> <!> <!></div>'),Pt=M('<div class="h-full flex flex-col"><div class="bg-secondary"></div> <!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><p>イラスト : 石黒正数氏</p></aside></footer></div>');function Dt(n,e){Ke(e,!0);let a=Re(void 0);const m=Ee.subscribe(i=>{Te(a,Pe(i))});Ge(m);let l=Re(void 0),W=st(()=>{var i,c,P,j,E,g,f,d,p,x,u,v,O;switch(e.packet.event){case"未接続":return"未接続";case"トーク":case"囁き":return e.packet.message;case"襲撃投票":return Be(t(l)===void 0,e.packet.fromIdx===t(l))?`${Z((i=t(a))==null?void 0:i.display.bubble,e.packet,e.packet.fromIdx)} が ${Z((c=t(a))==null?void 0:c.display.bubble,e.packet,e.packet.toIdx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return Be(t(l)===void 0,e.packet.fromIdx===t(l))?`${Z((P=t(a))==null?void 0:P.display.bubble,e.packet,e.packet.fromIdx)} が ${Z((j=t(a))==null?void 0:j.display.bubble,e.packet,e.packet.toIdx)} に投票しました`:`${Z((E=t(a))==null?void 0:E.display.bubble,e.packet,e.packet.fromIdx)} が投票しました`;case"追放":return e.packet.toIdx===void 0?"誰も追放されませんでした":`${Z((g=t(a))==null?void 0:g.display.bubble,e.packet,e.packet.toIdx)} を追放しました`;case"襲撃":return e.packet.toIdx===void 0?"誰も襲撃されませんでした":e.packet.fromIdx===-1?`${Z((f=t(a))==null?void 0:f.display.bubble,e.packet,e.packet.toIdx)} が襲撃されましたが、護衛されました`:`${Z((d=t(a))==null?void 0:d.display.bubble,e.packet,e.packet.toIdx)} が襲撃されました`;case"占い":return Be(t(l)===void 0,e.packet.fromIdx===t(l))?`${Z((p=t(a))==null?void 0:p.display.bubble,e.packet,e.packet.fromIdx)} が ${Z((x=t(a))==null?void 0:x.display.bubble,e.packet,e.packet.toIdx)} を占った結果、${lt((u=e.packet.agents.find(D=>D.idx===e.packet.toIdx))==null?void 0:u.role)} でした`:"占いました";case"護衛":return Be(t(l)===void 0,e.packet.fromIdx===t(l))?`${Z((v=t(a))==null?void 0:v.display.bubble,e.packet,e.packet.fromIdx)} が ${Z((O=t(a))==null?void 0:O.display.bubble,e.packet,e.packet.toIdx)} を護衛対象にしました`:"護衛しました";case"終了":return e.packet.message+" が勝利しました";default:return}}),b,A,B,F,V;nt(()=>(window.addEventListener("resize",ne),()=>{window.removeEventListener("resize",ne)})),at(()=>{ne()});function ne(){if(!A||!B||!b)return;const i=b.getBoundingClientRect();if([A,B].forEach(E=>{E.width=i.width,E.height=i.height;const g=E.getContext("2d");g&&(g.clearRect(0,0,E.width,E.height),g.globalAlpha=1,g.lineWidth=2)}),t(l)!==void 0&&(e.packet.event==="占い"&&e.packet.fromIdx!==t(l)||e.packet.event==="投票"&&e.packet.fromIdx!==t(l)||e.packet.event==="襲撃投票"&&e.packet.fromIdx!==t(l)))return;const c=A.getContext("2d"),P=B.getContext("2d");if(!c||!P)return;const j=B.getBoundingClientRect();if(e.packet.fromIdx!==void 0&&e.packet.toIdx!==void 0){const E=document.getElementById(`agent-${e.packet.fromIdx}`);if(!(E instanceof HTMLElement))return;const g=E.getBoundingClientRect(),f=g.left+g.width/2-j.left,d=g.top+g.height/2-j.top,p=document.getElementById(`agent-${e.packet.toIdx}`);if(!(p instanceof HTMLElement))return;const x=p.getBoundingClientRect();T(P,f,d,x.left+x.width/2-j.left,x.top+x.height/2-j.top,!1,getComputedStyle(V).getPropertyValue("background-color"))}if(e.packet.bubbleIdx!==void 0){const E=document.getElementById(`agent-${e.packet.bubbleIdx}`);if(!(E instanceof HTMLElement))return;const g=E.getBoundingClientRect(),f=g.left+g.width/2-j.left,d=g.top+g.height/2-j.top;T(c,j.width/2,j.height/2,f,d,!0,getComputedStyle(F).getPropertyValue("background-color"))}}function T(i,c,P,j,E,g,f){const d=g?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];i.strokeStyle=i.fillStyle=f,i.beginPath();let p=j-c,x=E-P,u=Math.sqrt(p*p+x*x),v=x/u,O=p/u,D=[];D.push(0,0);for(let k=0;k<d.length;k+=2){let U=d[k],y=d[k+1];D.push(U<0?u+U:U,y)}D.push(u,0);for(let k=d.length;k>0;k-=2){let U=d[k-2],y=d[k-1];D.push(U<0?u+U:U,-y)}D.push(0,0);for(let k=0;k<D.length;k+=2){let U=D[k]*O-D[k+1]*v+c,y=D[k]*v+D[k+1]*O+P;k===0?i.moveTo(U,y):i.lineTo(U,y)}i.fill()}var w=Pt(),R=r(w);ke(R,i=>V=i,()=>V);var L=o(R,2);{var z=i=>{var c=kt(),P=r(c),j=r(P);s(P),s(c),H(()=>$(j,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}
        ${e.packet.event??""}フェーズ`)),h(i,c)};ee(L,i=>{var c;(c=t(a))!=null&&c.display.largeScale||i(z)})}var ae=o(L,2),te=r(ae),he=r(te);{var xe=i=>{var c=St(),P=r(c);s(c),H(()=>$(P,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),h(i,c)};ee(he,i=>{var c;(c=t(a))!=null&&c.display.largeScale&&i(xe)})}var ve=o(he,2);ke(ve,i=>A=i,()=>A);var be=o(ve,2);ke(be,i=>B=i,()=>B);var oe=o(be,2),me=r(oe),ue=r(me),ye=r(ue,!0);s(ue),s(me),s(oe),ke(oe,i=>F=i,()=>F);var pe=o(oe,2);Ue(pe,17,()=>e.packet.agents,Xe,(i,c,P)=>{var j=Rt(),E=r(j),g=r(E),f=r(g);f.__click=[It,l,c];var d=r(f),p=o(d,2);{var x=y=>{var _=jt(),K=r(_),X=r(K,!0);s(K),s(_),H(()=>$(X,t(c).idx)),h(y,_)};ee(p,y=>{var _,K;(_=t(a))!=null&&_.display.largeScale&&((K=t(a))!=null&&K.display.canvas.name)&&y(x)})}s(f),s(g),s(E);var u=o(E,2);{var v=y=>{var _=Tt(),K=r(_,!0);s(_),H(X=>$(K,X),[()=>Fe(t(c).idx)]),h(y,_)};ee(u,y=>{var _,K;!((_=t(a))!=null&&_.display.largeScale)&&((K=t(a))!=null&&K.display.canvas.name)&&y(v)})}var O=o(u,2);{var D=y=>{var _=je(),K=fe(_);{var X=J=>{var S=Et(),se=r(S,!0);s(S),H(()=>$(se,t(c).team)),h(J,S)},G=J=>{var S=Ot(),se=r(S,!0);s(S),H(()=>$(se,t(c).team)),h(J,S)};ee(K,J=>{var S;(S=t(a))!=null&&S.display.largeScale?J(X):J(G,!1)})}h(y,_)};ee(O,y=>{var _;(_=t(a))!=null&&_.display.canvas.team&&y(D)})}var k=o(O,2);{var U=y=>{var _=je(),K=fe(_);{var X=J=>{var S=At(),se=r(S,!0);s(S),H(()=>$(se,t(c).role)),h(J,S)},G=J=>{var S=Ct(),se=r(S,!0);s(S),H(()=>$(se,t(c).role)),h(J,S)};ee(K,J=>{var S;(S=t(a))!=null&&S.display.largeScale?J(X):J(G,!1)})}h(y,_)};ee(k,y=>{var _;(_=t(a))!=null&&_.display.canvas.role&&(t(c).idx===t(l)||t(l)===void 0)&&y(U)})}s(j),H(y=>{var _;Oe(j,"style",`--angle: ${P*(360/e.packet.agents.length)}`),Oe(j,"id",`agent-${t(c).idx??""}`),ze(j,"bg-focus",t(c).idx===t(l)),He(g,et((_=t(a))!=null&&_.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-1d36lc1"),ze(g,"ring-success",t(c).isAlive),ze(g,"ring-error",!t(c).isAlive),bt(g,"opacity",t(c).isAlive?1:.25),Oe(d,"src",`${vt??""}/images/male/${y??""}.png`),Oe(d,"alt",t(c).name)},[()=>t(c).idx.toString().padStart(2,"0")]),h(i,j)}),s(te),ke(te,i=>b=i,()=>b),s(ae),Le(2),s(w),H(()=>{var i;oe.hidden=!t(W),He(ue,et((i=t(a))!=null&&i.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center"),"svelte-1d36lc1"),$(ye,t(W))}),h(n,w),Ye()}qe(["click"]);function Jt(){Ce.connect()}function Lt(){Ce.disconnect()}var Nt=M('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Mt=M('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Bt=M('<div class="status status-error"></div>'),zt=(n,e)=>e("connection.url",n.currentTarget.value),Ut=(n,e)=>e("connection.token",n.currentTarget.value),Xt=(n,e)=>e("display.canvas.name",n.currentTarget.checked),Ht=(n,e)=>e("display.canvas.team",n.currentTarget.checked),Wt=(n,e)=>e("display.canvas.role",n.currentTarget.checked),Vt=(n,e)=>e("display.bubble.name",n.currentTarget.checked),Kt=(n,e)=>e("display.bubble.team",n.currentTarget.checked),Yt=(n,e)=>e("display.bubble.role",n.currentTarget.checked),qt=(n,e)=>e("display.text.name",n.currentTarget.checked),Ft=(n,e)=>e("display.text.team",n.currentTarget.checked),Gt=(n,e)=>e("display.text.role",n.currentTarget.checked),Qt=(n,e)=>e("display.largeScale",n.currentTarget.checked),Zt=M('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">表示設定</h3> <h4 class="text-base font-bold mt-4">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function $t(n,e){Ke(e,!0);let a=Re(void 0),m=Re(void 0);const l=Ee.subscribe(C=>{Te(a,Pe(C))}),W=Ce.subscribe(C=>{Te(m,Pe(C.status))});Ge(()=>{l(),W()});function b(C,N){Ee.update(Y=>{const Q=C.split("."),le=Q.pop();let I=Y;for(const q of Q)q&&(I=I[q]);return I[le]=N,{...Y}})}let A;var B=Zt(),F=o(r(B),2),V=r(F),ne=r(V);{var T=C=>{var N=Nt();Le(2),h(C,N)},w=C=>{var N=je(),Y=fe(N);{var Q=I=>{var q=Mt();Le(2),h(I,q)},le=I=>{var q=Bt();h(I,q)};ee(Y,I=>{t(m)==="connecting"?I(Q):I(le,!1)},!0)}h(C,N)};ee(ne,C=>{t(m)==="connected"?C(T):C(w,!1)})}s(V),s(F);var R=o(F,2),L=r(R);re(L,"class","h-[1em] opacity-50"),re(L,"inline",!0),re(L,"icon","mdi:link");var z=o(L,2);ce(z),z.__input=[zt,b],s(R);var ae=o(R,2),te=r(ae);re(te,"class","h-[1em] opacity-50"),re(te,"inline",!0),re(te,"icon","mdi:key");var he=o(te,2);ce(he),he.__input=[Ut,b],Le(2),s(ae);var xe=o(ae,2);xe.__click=[Jt];var ve=o(xe,2);ve.__click=[Lt];var be=o(ve,2);be.__click=()=>A.showModal();var oe=o(be,2),me=r(oe),ue=r(me),ye=o(r(ue),4),pe=r(ye),i=o(r(pe),2);ce(i),i.__change=[Xt,b],s(pe);var c=o(pe,2),P=o(r(c),2);ce(P),P.__change=[Ht,b],s(c);var j=o(c,2),E=o(r(j),2);ce(E),E.__change=[Wt,b],s(j),s(ye);var g=o(ye,4),f=r(g),d=o(r(f),2);ce(d),d.__change=[Vt,b],s(f);var p=o(f,2),x=o(r(p),2);ce(x),x.__change=[Kt,b],s(p);var u=o(p,2),v=o(r(u),2);ce(v),v.__change=[Yt,b],s(u),s(g);var O=o(g,4),D=r(O),k=o(r(D),2);ce(k),k.__change=[qt,b],s(D);var U=o(D,2),y=o(r(U),2);ce(y),y.__change=[Ft,b],s(U);var _=o(U,2),K=o(r(_),2);ce(K),K.__change=[Gt,b],s(_),s(O);var X=o(O,4),G=o(r(X),2);ce(G),G.__change=[Qt,b],s(X),s(ue),s(me),Le(2),s(oe),ke(oe,C=>A=C,()=>A);var J=o(oe,2),S=r(J);re(S,"inline",!0),re(S,"icon","mdi:white-balance-sunny");var se=o(S,4);re(se,"inline",!0),re(se,"icon","mdi:moon-and-stars"),s(J),s(B),H(()=>{var C,N,Y,Q,le,I,q,ie,_e,De,we,Qe;$e(z,(C=t(a))==null?void 0:C.connection.url),$e(he,(N=t(a))==null?void 0:N.connection.token),xe.disabled=t(m)!=="disconnected",ve.disabled=t(m)==="disconnected",de(i,(Y=t(a))==null?void 0:Y.display.canvas.name),de(P,(Q=t(a))==null?void 0:Q.display.canvas.team),de(E,(le=t(a))==null?void 0:le.display.canvas.role),de(d,(I=t(a))==null?void 0:I.display.bubble.name),de(x,(q=t(a))==null?void 0:q.display.bubble.team),de(v,(ie=t(a))==null?void 0:ie.display.bubble.role),de(k,(_e=t(a))==null?void 0:_e.display.text.name),de(y,(De=t(a))==null?void 0:De.display.text.team),de(K,(we=t(a))==null?void 0:we.display.text.role),de(G,(Qe=t(a))==null?void 0:Qe.display.largeScale)}),h(n,B),Ye()}qe(["input","click","change"]);var en=M("<option> </option>"),tn=M('<div class="divider"> </div>'),nn=M('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),an=M('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),sn=M('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),rn=M('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),on=M("<!> <button><!></button>",1),ln=M('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="overflow-y-auto pl-2 h-full"><div class="flex flex-col p-2"><select class="w-full select"></select> <ul class="list overflow-y-auto flex-1 my-2"><!></ul></div></div></div></main>');function jn(n,e){Ke(e,!0);const[a,m]=ct(),l=()=>Je(F,"$selectedId",a),W=()=>Je(w,"$entries",a),b=()=>Je(R,"$status",a),A=()=>Je(T,"$currentPacket",a),B=()=>Je(V,"$selectedIdx",a),F=Se(null),V=Se(null),ne={id:"",idx:-1,day:0,isDay:!0,agents:yt(5),event:"未接続",message:void 0,fromIdx:void 0,toIdx:void 0,bubbleIdx:void 0},T=Se(ne),w=Se({}),R=Se("");let L=Re(void 0),z=Re(80),ae=!1,te=null;function he(){{const f=dt.url.searchParams,d=f.get("url"),p=f.get("token");d&&(Ee.update(x=>({...x,connection:{url:d??"",token:p??""}})),Ce.connect())}}function xe(f){if(!ae||!te)return;const d=te.getBoundingClientRect(),p=f-d.left,x=d.width;Te(z,Pe(Math.min(90,Math.max(10,p/x*100))))}function ve(){ae=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const f=p=>{const x=p instanceof MouseEvent?p.clientX:p.touches[0].clientX;xe(x)},d=()=>{ae=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",f),window.removeEventListener("touchmove",f),window.removeEventListener("mouseup",d),window.removeEventListener("touchend",d)};window.addEventListener("mousemove",f),window.addEventListener("touchmove",f),window.addEventListener("mouseup",d),window.addEventListener("touchend",d)}nt(()=>{he();const f=Ce.entries.subscribe(v=>{w.set(v),F.update(O=>O||Object.keys(v)[0]),V.update(()=>l()?v[l()].length-1:null)}),d=Ce.subscribe(v=>{R.set(v.status)}),p=F.subscribe(v=>{var O;v&&((O=W()[v])==null?void 0:O.length)>0?V.set(W()[v].length-1):V.set(null)}),x=Ee.subscribe(v=>{Te(L,Pe(v))}),u=ft([F,V,w],([v,O,D])=>{if(!v||O===null)return ne;const k=D[v];return!k||O<0||O>=k.length?ne:k[O]}).subscribe(v=>{T.set(v)});Ge(()=>{f(),d(),x(),p(),u()}),window.addEventListener("beforeunload",v=>{b()==="connected"&&v.preventDefault()}),window.addEventListener("popstate",v=>{b()==="connected"&&v.preventDefault()})});var be=ln();ot(f=>{rt.title="aiwolf-nlp-viewer"});var oe=r(be);$t(oe,{});var me=o(oe,2),ue=r(me),ye=r(ue);Dt(ye,{get packet(){return A()}}),s(ue);var pe=o(ue,2);pe.__mousedown=ve,pe.__touchstart=ve;var i=o(pe,2),c=r(i),P=r(c);Ue(P,5,()=>Object.keys(W()),Xe,(f,d)=>{var p=en(),x={},u=r(p,!0);s(p),H(()=>{x!==(x=t(d))&&(p.value=(p.__value=t(d))==null?"":t(d)),$(u,t(d))}),h(f,p)}),s(P);var j=o(P,2),E=r(j);{var g=f=>{var d=je(),p=fe(d);Ue(p,1,()=>W()[l()]||[],Xe,(x,u,v)=>{var O=on(),D=fe(O);{var k=X=>{var G=tn(),J=r(G);s(G),H(()=>$(J,`${t(u).day??""}日目 ${(t(u).isDay?"昼":"夜")??""}`)),h(X,G)};ee(D,X=>{(v>0&&(t(u).day!==W()[l()][v-1].day||t(u).isDay!==W()[l()][v-1].isDay)||v===0)&&X(k)})}var U=o(D,2);U.__click=()=>V.set(v);var y=r(U);{var _=X=>{var G=je(),J=fe(G);{var S=C=>{var N=nn(),Y=fe(N),Q=r(Y,!0);s(Y);var le=o(Y,2);re(le,"inline",!0),re(le,"icon","mdi:skip-forward"),H(I=>$(Q,I),[()=>{var I;return Z((I=t(L))==null?void 0:I.display.text,t(u),t(u).bubbleIdx)}]),h(C,N)},se=C=>{var N=je(),Y=fe(N);{var Q=I=>{var q=an(),ie=fe(q),_e=r(ie,!0);s(ie);var De=o(ie,2);re(De,"inline",!0),re(De,"icon","mdi:arrow-u-down-right-bold"),H(we=>$(_e,we),[()=>{var we;return Z((we=t(L))==null?void 0:we.display.text,t(u),t(u).bubbleIdx)}]),h(I,q)},le=I=>{var q=sn(),ie=r(q,!0);s(q),H(_e=>$(ie,_e),[()=>{var _e;return Z((_e=t(L))==null?void 0:_e.display.text,t(u),t(u).bubbleIdx)+"<"+t(u).message}]),h(I,q)};ee(Y,I=>{t(u).message==="Skip"?I(Q):I(le,!1)},!0)}h(C,N)};ee(J,C=>{t(u).message==="Over"?C(S):C(se,!1)})}h(X,G)},K=X=>{var G=rn(),J=r(G);{var S=N=>{var Y=Ze();H(Q=>$(Y,Q),[()=>{var Q;return Z((Q=t(L))==null?void 0:Q.display.text,t(u),t(u).fromIdx)}]),h(N,Y)},se=N=>{var Y=je(),Q=fe(Y);{var le=I=>{var q=Ze();H(ie=>$(q,ie),[()=>{var ie;return Z((ie=t(L))==null?void 0:ie.display.text,t(u),t(u).toIdx)}]),h(I,q)};ee(Q,I=>{(t(u).event==="追放"||t(u).event==="襲撃")&&I(le)},!0)}h(N,Y)};ee(J,N=>{t(u).event==="投票"||t(u).event==="占い"?N(S):N(se,!1)})}var C=o(J);s(G),H(()=>$(C,` ${t(u).event??""}`)),h(X,G)};ee(y,X=>{t(u).event==="トーク"||t(u).event==="囁き"?X(_):X(K,!1)})}s(U),H(()=>He(U,`btn ${(v===B()?"btn-primary":"")??""}`)),h(x,O)}),h(f,d)};ee(E,f=>{l()&&f(g)})}s(j),s(c),s(i),s(me),ke(me,f=>te=f,()=>te),s(be),H(()=>{Oe(ue,"style",`width: ${t(z)??""}%`),Oe(i,"style",`width: ${100-t(z)-.5}%;`)}),it(P,l,f=>ut(F,f)),h(n,be),Ye(),m()}qe(["mousedown","touchstart","click"]);export{jn as component};
