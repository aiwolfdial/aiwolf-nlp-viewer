import{b as ce,d as Oe,a as O,t as M}from"../chunks/disclose-version.DT2i68bb.js";import{i as Me}from"../chunks/legacy.8xEp6qYB.js";import{v as C,L as P,a5 as me,a4 as Ve,I as se,m as ke,H as Ce,a8 as Ae,J as He,K as fe,M as ee,w as K,a9 as Se,aa as Q,N as ye,n as ie,O as qe,D as ue,ab as Fe,ac as Ye,ad as ze,ae as Be,q as Ie,af as Ke,a3 as Ge,z as de,ag as Je,ah as Ue,ai as We,aj as we,ak as Xe,al as Pe,G as Qe,am as Ze,p as je,an as et,ao as tt,a as at,ap as rt,i as D,c as m,r as p,s as b,aq as _e,B as pe,j as st,t as S,$ as te}from"../chunks/runtime.SnmOziKA.js";import{h as it,e as nt,a as F}from"../chunks/store.D8R4b1hQ.js";import{p as lt,i as B}from"../chunks/props.CytARZG8.js";import{b as ot}from"../chunks/paths.DaJMwUMo.js";function ae(r,e){return e}function vt(r,e,t,v){for(var h=[],d=e.length,u=0;u<d;u++)Ye(e[u].e,h,!0);var k=d>0&&h.length===0&&t!==null;if(k){var _=t.parentNode;ze(_),_.append(t),v.clear(),Y(r,e[0].prev,e[d-1].next)}Be(h,()=>{for(var g=0;g<d;g++){var n=e[g];k||(v.delete(n.k),Y(r,n.prev,n.next)),Ie(n.e,!k)}})}function re(r,e,t,v,h,d=null){var u=r,k={flags:e,items:new Map,first:null};{var _=r;u=C?P(me(_)):_.appendChild(Ve())}C&&se();var g=null,n=!1;ke(()=>{var x=t(),f=Ce(x)?x:x==null?[]:Ae(x),o=f.length;if(n&&o===0)return;n=o===0;let T=!1;if(C){var q=u.data===He;q!==(o===0)&&(u=fe(),P(u),ee(!1),T=!0)}if(C){for(var l=null,a,c=0;c<o;c++){if(K.nodeType===8&&K.data===Se){u=K,T=!0,ee(!1);break}var I=f[c],A=v(I,c);a=Ee(K,k,l,null,I,A,c,h,e),k.items.set(A,a),l=a}o>0&&P(fe())}if(!C){var i=Ke;ct(f,k,u,h,e,(i.f&Q)!==0,v)}d!==null&&(o===0?g?ye(g):g=ie(()=>d(u)):g!==null&&qe(g,()=>{g=null})),T&&ee(!0),t()}),C&&(u=K)}function ct(r,e,t,v,h,d,u){var k=r.length,_=e.items,g=e.first,n=g,x,f=null,o=[],T=[],q,l,a,c;for(c=0;c<k;c+=1){if(q=r[c],l=u(q,c),a=_.get(l),a===void 0){var I=n?n.e.nodes_start:t;f=Ee(I,e,f,f===null?e.first:f.next,q,l,c,v,h),_.set(l,f),o=[],T=[],n=f.next;continue}if(ft(a,q,c),a.e.f&Q&&ye(a.e),a!==n){if(x!==void 0&&x.has(a)){if(o.length<T.length){var A=T[0],i;f=A.prev;var s=o[0],y=o[o.length-1];for(i=0;i<o.length;i+=1)he(o[i],A,t);for(i=0;i<T.length;i+=1)x.delete(T[i]);Y(e,s.prev,y.next),Y(e,f,s),Y(e,y,A),n=A,f=y,c-=1,o=[],T=[]}else x.delete(a),he(a,n,t),Y(e,a.prev,a.next),Y(e,a,f===null?e.first:f.next),Y(e,f,a),f=a;continue}for(o=[],T=[];n!==null&&n.k!==l;)(d||!(n.e.f&Q))&&(x??(x=new Set)).add(n),T.push(n),n=n.next;if(n===null)continue;a=n}o.push(a),f=a,n=a.next}if(n!==null||x!==void 0){for(var L=x===void 0?[]:Ae(x);n!==null;)(d||!(n.e.f&Q))&&L.push(n),n=n.next;var J=L.length;if(J>0){var Z=k===0?t:null;vt(e,L,Z,_)}}ue.first=e.first&&e.first.e,ue.last=f&&f.e}function ft(r,e,t,v){Fe(r.v,e),r.i=t}function Ee(r,e,t,v,h,d,u,k,_){var g=(_&Ue)!==0,n=(_&We)===0,x=g?n?Ge(h):de(h):h,f=_&Je?de(u):u,o={i:f,v:x,k:d,a:null,e:null,prev:t,next:v};try{return o.e=ie(()=>k(r,x,f),C),o.e.prev=t&&t.e,o.e.next=v&&v.e,t===null?e.first=o:(t.next=o,t.e.next=o.e),v!==null&&(v.prev=o,v.e.prev=o.e),o}finally{}}function he(r,e,t){for(var v=r.next?r.next.e.nodes_start:t,h=e?e.e.nodes_start:t,d=r.e.nodes_start;d!==v;){var u=we(d);h.before(d),d=u}}function Y(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function ut(r,e,t,v,h){var d=r,u="",k;ke(()=>{if(u===(u=e()??"")){C&&se();return}k!==void 0&&(Ie(k),k=void 0),u!==""&&(k=ie(()=>{if(C){K.data;for(var _=se(),g=_;_!==null&&(_.nodeType!==8||_.data!=="");)g=_,_=we(_);if(_===null)throw Xe(),Pe;ce(K,g),d=P(_);return}var n=u+"",x=Oe(n);ce(me(x),x.lastChild),d.before(x)}))})}function dt(r,e,t,v){var h=r.__attributes??(r.__attributes={});C&&(h[e]=r.getAttribute(e),r.nodeName==="LINK")||h[e]!==(h[e]=t)&&(t==null?r.removeAttribute(e):typeof t!="string"&&_t(r).includes(e)?r[e]=t:r.setAttribute(e,t))}var ge=new Map;function _t(r){var e=ge.get(r.nodeName);if(e)return e;ge.set(r.nodeName,e=[]);for(var t,v=r,h=Element.prototype;h!==v;){t=Ze(v);for(var d in t)t[d].set&&e.push(d);v=Qe(v)}return e}function xe(r,e,t){if(t){if(r.classList.contains(e))return;r.classList.add(e)}else{if(!r.classList.contains(e))return;r.classList.remove(e)}}var pt=M('<link rel="stylesheet">'),ht=M("<li><strong> </strong> </li>"),gt=M('<section class="status-section"><h3>エージェント</h3> <ul></ul></section>'),xt=M('<div class="divine-section"><h3>占い結果</h3> <p> </p></div>'),mt=M('<div class="attack-section"><h3>襲撃結果</h3> <p> </p></div>'),kt=M('<div class="execution-section"><h3>追放結果</h3> <p> </p></div>'),At=M('<section class="game-events"><!> <!> <!></section>'),yt=M('<div class="talk"><strong> </strong> <!></div>'),It=M('<section class="game-result-section"><h3>ゲーム結果</h3> <p> </p></section>'),wt=M('<div class="day-column"><div class="day-section"><h2> </h2> <div class="scrollable-content"><!> <!> <section class="talks-section"><h3>会話ログ</h3> <div class="talks"></div></section> <!></div></div></div>'),Et=M('<div class="werewolf-log-viewer"><div class="days-container"></div></div>'),bt=M('<main><div class="file-input"><input type="file" accept=".log"></div> <!></main>');function Ot(r,e){je(e,!1);const t=_e();let v=lt(e,"logData",28,()=>[]),h=_e(null);function d(l){var I;const c=(I=l.target.files)==null?void 0:I[0];if(pe(h,c??null),c){const A=new FileReader;A.onload=i=>{var y;const s=((y=i.target)==null?void 0:y.result)??"";v(s.split(`
`).filter(L=>L.trim()))},A.readAsText(c)}}function u(l){const a={};return l.forEach(c=>{const[I,A,...i]=c.split(",");a[I]||(a[I]=k()),_(a[I],A,i)}),a}function k(){return{status:{},talks:[],votes:[],execution:null,divine:null,attackVotes:[],attack:null,result:null}}function _(l,a,c){const A={status:([i,s,y,L])=>{l.status[i]={role:s,status:y,name:L}},talk:([i,s,y,L])=>{l.talks.push({talkIdx:i,turn:s,agentIdx:y,text:L})},vote:([i,s])=>{l.votes.push({voteAgentIdx:i,targetAgentIdx:s})},execute:([i,s])=>{l.execution={agentIdx:i,role:s}},divine:([i,s,y])=>{l.divine={agentIdx:i,targetAgentIdx:s,result:y}},attackVote:([i,s])=>{l.attackVotes.push({voteAgentIdx:i,targetAgentIdx:s})},attack:([i,s])=>{l.attack={agentIdx:i,isSuccessful:s==="true"}},result:([i,s,y])=>{l.result={villagers:i,werewolves:s,winSide:y}}}[a];A&&A(c)}function g(l,a){var I;const c=(I=D(t)[l])==null?void 0:I.status[a];return c?`Agent[${a}] (${c.name})`:`Agent[${a}]`}function n(l){const a=l.match(/>>Agent\[\d+\]/);return a?l.replace(a[0],`<strong>${a[0]}</strong>`).trim():l.trim()}et(()=>st(v()),()=>{pe(t,u(v()))}),tt(),Me();var x=bt();it(l=>{var a=pt();rt.title="AIWolf Log Viewer",dt(a,"href",`${ot??""}/global.css`),O(l,a)});var f=m(x),o=m(f);p(f);var T=b(f,2);{var q=l=>{var a=Et(),c=m(a);re(c,5,()=>Object.entries(D(t)),ae,(I,A)=>{let i=()=>D(A)[0],s=()=>D(A)[1];var y=wt(),L=m(y),J=m(L),Z=m(J);p(J);var ne=b(J,2),le=m(ne);{var be=$=>{var w=gt(),N=b(m(w),2);re(N,5,()=>Object.entries(s().status),ae,(H,z)=>{let U=()=>D(z)[0],W=()=>D(z)[1];var G=ht(),E=m(G),R=m(E,!0);S(()=>F(R,g(i(),U()))),p(E);var V=b(E);p(G),S(()=>{xe(G,"over",W().status!=="ALIVE"),F(V,` ${W().role??""} -
                          ${(W().status==="ALIVE"?"生存":"死亡")??""}`)}),O(H,G)}),p(N),p(w),O($,w)};B(le,$=>{Object.keys(s().status).length>0&&$(be)})}var oe=b(le,2);{var Te=$=>{var w=At(),N=m(w);{var H=E=>{var R=xt(),V=b(m(R),2);const X=te(()=>g(i(),s().divine.agentIdx)??""),Re=te(()=>g(i(),s().divine.targetAgentIdx)??""),De=te(()=>s().divine.result??"");var Le=m(V);S(()=>F(Le,`${D(X)} が
                          ${D(Re)} を占った結果:
                          ${D(De)}`)),p(V),p(R),O(E,R)};B(N,E=>{s().divine&&E(H)})}var z=b(N,2);{var U=E=>{var R=mt(),V=b(m(R),2),X=m(V);S(()=>F(X,`${g(i(),s().attack.agentIdx)??""} への襲撃:
                          ${(s().attack.isSuccessful?"成功":"失敗")??""}`)),p(V),p(R),O(E,R)};B(z,E=>{s().attack&&E(U)})}var W=b(z,2);{var G=E=>{var R=kt(),V=b(m(R),2),X=m(V);S(()=>F(X,`${g(i(),s().execution.agentIdx)??""} が追放されました
                          (役職: ${s().execution.role??""})`)),p(V),p(R),O(E,R)};B(W,E=>{s().execution&&E(G)})}p(w),O($,w)};B(oe,$=>{(s().divine||s().attack||s().execution)&&$(Te)})}var j=b(oe,2),ve=b(m(j),2);re(ve,5,()=>s().talks,ae,($,w)=>{var N=yt(),H=m(N),z=m(H,!0);S(()=>F(z,g(i(),D(w).agentIdx))),p(H);var U=b(H,2);ut(U,()=>n(D(w).text)),p(N),S(()=>xe(N,"over",D(w).text==="Over")),O($,N)}),p(ve),p(j);var $e=b(j,2);{var Ne=$=>{var w=It(),N=b(m(w),2),H=m(N);p(N),p(w),S(()=>F(H,`村人: ${s().result.villagers??""}人 人狼: ${s().result.werewolves??""}人 勝利陣営: ${s().result.winSide??""}`)),O($,w)};B($e,$=>{s().result&&$(Ne)})}p(ne),p(L),p(y),S(()=>F(Z,`Day ${i()??""}`)),O(I,y)}),p(c),p(a),O(l,a)};B(T,l=>{D(h)&&l(q)})}p(x),nt("change",o,d),O(r,x),at()}export{Ot as component};
