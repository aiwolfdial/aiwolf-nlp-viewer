import{t as L,a as S,c as Te,d as Ze}from"../chunks/D6xU7Ia-.js";import{p as Ke,h as Ee,o as nt,t as B,a as Ye,aG as Ce,c as s,s as o,g as t,r,aI as Le,y as rt,f as me,$ as st}from"../chunks/D71tB1-8.js";import{d as Fe,s as K}from"../chunks/CmmD0BWm.js";import{i as ee}from"../chunks/XVGiJ86u.js";import{e as Xe,i as He}from"../chunks/DtvBwiBb.js";import{h as ot}from"../chunks/C80A9f_5.js";import{a as Ne,s as oe,r as ue,c as $e,d as be}from"../chunks/BQxvY0yg.js";import{I as Ge,s as We,c as et,d as lt,t as Ue}from"../chunks/o0XeAbLk.js";import{p as Pe}from"../chunks/Dh106H1m.js";import{b as it}from"../chunks/D_f7hNZQ.js";import{b as ye}from"../chunks/EZdGMfFB.js";import{s as Je,a as ct,b as ut}from"../chunks/Bed5y4Kk.js";import{p as dt}from"../chunks/cyh1r80c.js";import{w as Ie,d as ft}from"../chunks/Bd_Kett6.js";import{a as Qe,o as at}from"../chunks/BJiA8Uac.js";/* empty css                */import{b as vt}from"../chunks/BBlvtWkN.js";function bt(n,e,a,p){var i=n.__styles??(n.__styles={});i[e]!==a&&(i[e]=a,a==null?n.style.removeProperty(e):n.style.setProperty(e,a,""))}class Ve{static fromJson(e){return _t(JSON.parse(e),je("RealtimeSettings"))}static toJson(e){return JSON.stringify(gt(e,je("RealtimeSettings")),null,2)}}function ge(n,e,a,p=""){const i=qe(n),z=p?` on ${p}`:"",v=a?` for key "${a}"`:"";throw Error(`Invalid value${v}${z}. Expected ${i} but got ${JSON.stringify(e)}`)}function qe(n){return Array.isArray(n)?n.length===2&&n[0]===void 0?`an optional ${qe(n[1])}`:`one of [${n.map(e=>qe(e)).join(", ")}]`:typeof n=="object"&&n.literal!==void 0?n.literal:typeof n}function mt(n){if(n.jsonToJS===void 0){const e={};n.props.forEach(a=>e[a.json]={key:a.js,typ:a.typ}),n.jsonToJS=e}return n.jsonToJS}function pt(n){if(n.jsToJSON===void 0){const e={};n.props.forEach(a=>e[a.js]={key:a.json,typ:a.typ}),n.jsToJSON=e}return n.jsToJSON}function Ae(n,e,a,p="",i=""){function z(E,j){return typeof E==typeof j?j:ge(E,j,p,i)}function v(E,j){const C=E.length;for(let D=0;D<C;D++){const X=E[D];try{return Ae(j,X,a)}catch{}}return ge(E,j,p,i)}function I(E,j){return E.indexOf(j)!==-1?j:ge(E.map(C=>Me(C)),j,p,i)}function N(E,j){return Array.isArray(j)?j.map(C=>Ae(C,E,a)):ge(Me("array"),j,p,i)}function Y(E){if(E===null)return null;const j=new Date(E);return isNaN(j.valueOf())?ge(Me("Date"),E,p,i):j}function U(E,j,C){if(C===null||typeof C!="object"||Array.isArray(C))return ge(Me(ne||"object"),C,p,i);const D={};return Object.getOwnPropertyNames(E).forEach(X=>{const ae=E[X],te=Object.prototype.hasOwnProperty.call(C,X)?C[X]:void 0;D[ae.key]=Ae(te,ae.typ,a,X,ne)}),Object.getOwnPropertyNames(C).forEach(X=>{Object.prototype.hasOwnProperty.call(E,X)||(D[X]=Ae(C[X],j,a,X,ne))}),D}if(e==="any")return n;if(e===null)return n===null?n:ge(e,n,p,i);if(e===!1)return ge(e,n,p,i);let ne;for(;typeof e=="object"&&e.ref!==void 0;)ne=e.ref,e=xt[e.ref];return Array.isArray(e)?I(e,n):typeof e=="object"?e.hasOwnProperty("unionMembers")?v(e.unionMembers,n):e.hasOwnProperty("arrayItems")?N(e.arrayItems,n):e.hasOwnProperty("props")?U(a(e),e.additional,n):ge(e,n,p,i):e===Date&&typeof n!="number"?Y(n):z(e,n)}function _t(n,e){return Ae(n,e,mt)}function gt(n,e){return Ae(n,e,pt)}function Me(n){return{literal:n}}function Be(n,e){return{props:n,additional:e}}function je(n){return{ref:n}}const xt={RealtimeSettings:Be([{json:"connection",js:"connection",typ:je("Connection")},{json:"display",js:"display",typ:je("Display")}],!1),Connection:Be([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:Be([{json:"canvas",js:"canvas",typ:je("Agent")},{json:"bubble",js:"bubble",typ:je("Agent")},{json:"text",js:"text",typ:je("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:Be([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},tt={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function ht(){const n=localStorage.getItem("realtime-settings");if(n)try{return Ve.fromJson(n)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",Ve.toJson(tt)),tt}const Oe=Ie(ht());Oe.subscribe(n=>{localStorage.setItem("realtime-settings",Ve.toJson(n))});function yt(n){return Array.from({length:n},(e,a)=>({idx:a+1,team:"Undefined",name:Ge(a+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}function $(n,e,a){var i,z;if(a===void 0)return"該当なし";let p=[];return n!=null&&n.name&&p.push(Ge(a)),n!=null&&n.team&&p.push((i=e.agents.find(v=>v.idx===a))==null?void 0:i.team),n!=null&&n.role&&p.push((z=e.agents.find(v=>v.idx===a))==null?void 0:z.role),p.join(" ")}function ze(n,e){return(n||e)&&!(n&&e)}function wt(){const{subscribe:n,update:e}=Ie({status:"disconnected",entries:{}});let a=null,p=null;Oe.subscribe(v=>{p=v});function i(){if(!p)return;e(I=>({...I,status:"connecting"}));const v=new URL(p.connection.url);p.connection.token&&v.searchParams.set("token",p.connection.token),a=new WebSocket(v),a.onopen=()=>{e(I=>({...I,status:"connected"}))},a.onclose=()=>{e(I=>({...I,status:"disconnected"})),a=null},a.onerror=()=>{e(I=>({...I,status:"disconnected"})),a=null},a.onmessage=I=>{try{const N=JSON.parse(I.data);e(Y=>{const U={...Y.entries};return U[N.id]||(U[N.id]=[]),U[N.id].push(N),{...Y,entries:U}})}catch(N){console.error("Failed to parse message:",N)}}}function z(){a&&(e(v=>({...v,status:"disconnected"})),a.close(),a=null)}return{subscribe:n,connect:i,disconnect:z,entries:{subscribe:v=>n(I=>v(I.entries))}}}const Re=wt();var kt=L('<div role="alert" class="alert m-4"><span class="text-lg font-bold"> </span></div>'),St=L('<pre class="base-content w-2/5 text-5xl font-bold opacity-70 absolute top-0 left-0 -mt-4 ml-8 select-none"> <br> <br> </pre>'),It=(n,e,a)=>{t(e)===t(a).idx?Ee(e,void 0):Ee(e,Pe(t(a).idx))},jt=L('<div class="absolute inset-0 flex items-center justify-center"><pre class="text-9xl font-bold opacity-75 select-none"> </pre></div>'),Tt=L('<pre class="base-content select-none"> </pre>'),Et=L('<pre class="base-content text-2xl mt-2 select-none"> </pre>'),Ot=L('<pre class="base-content select-none"> </pre>'),At=L('<pre class="base-content text-2xl mt-2 select-none"> </pre>'),Rt=L('<pre class="base-content select-none"> </pre>'),Ct=L('<div class="absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-x72s6v"><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"> <!></button></div></div> <!> <!> <!></div>'),Pt=L('<div class="h-full flex flex-col"><div class="bg-secondary"></div> <!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><span>イラスト : 石黒正数氏</span></aside></footer></div>');function Dt(n,e){Ke(e,!0);let a=Ce(void 0);const p=Oe.subscribe(c=>{Ee(a,Pe(c))});Qe(p);let i=Ce(void 0),z=rt(()=>{var c,u,P,_,k,y,F,l,b,m,O,d,f;switch(e.packet.event){case"未接続":return"未接続";case"トーク":case"囁き":return e.packet.message;case"襲撃投票":return ze(t(i)===void 0,e.packet.fromIdx===t(i))?`${$((c=t(a))==null?void 0:c.display.bubble,e.packet,e.packet.fromIdx)} が ${$((u=t(a))==null?void 0:u.display.bubble,e.packet,e.packet.toIdx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return ze(t(i)===void 0,e.packet.fromIdx===t(i))?`${$((P=t(a))==null?void 0:P.display.bubble,e.packet,e.packet.fromIdx)} が ${$((_=t(a))==null?void 0:_.display.bubble,e.packet,e.packet.toIdx)} に投票しました`:`${$((k=t(a))==null?void 0:k.display.bubble,e.packet,e.packet.fromIdx)} が投票しました`;case"追放":return e.packet.toIdx===void 0?"誰も追放されませんでした":`${$((y=t(a))==null?void 0:y.display.bubble,e.packet,e.packet.toIdx)} を追放しました`;case"襲撃":return e.packet.toIdx===void 0?"誰も襲撃されませんでした":e.packet.fromIdx===-1?`${$((F=t(a))==null?void 0:F.display.bubble,e.packet,e.packet.toIdx)} が襲撃されましたが、護衛されました`:`${$((l=t(a))==null?void 0:l.display.bubble,e.packet,e.packet.toIdx)} が襲撃されました`;case"占い":return ze(t(i)===void 0,e.packet.fromIdx===t(i))?`${$((b=t(a))==null?void 0:b.display.bubble,e.packet,e.packet.fromIdx)} が ${$((m=t(a))==null?void 0:m.display.bubble,e.packet,e.packet.toIdx)} を占った結果、${lt((O=e.packet.agents.find(g=>g.idx===e.packet.toIdx))==null?void 0:O.role)} でした`:"占いました";case"護衛":return ze(t(i)===void 0,e.packet.fromIdx===t(i))?`${$((d=t(a))==null?void 0:d.display.bubble,e.packet,e.packet.fromIdx)} が ${$((f=t(a))==null?void 0:f.display.bubble,e.packet,e.packet.toIdx)} を護衛対象にしました`:"護衛しました";case"終了":return e.packet.message+" が勝利しました";default:return}}),v,I,N,Y,U;at(()=>(window.addEventListener("resize",ne),()=>{window.removeEventListener("resize",ne)})),nt(()=>{ne()});function ne(){if(!I||!N||!v)return;const c=v.getBoundingClientRect();if([I,N].forEach(k=>{k.width=c.width,k.height=c.height;const y=k.getContext("2d");y&&(y.clearRect(0,0,k.width,k.height),y.globalAlpha=1,y.lineWidth=2)}),t(i)!==void 0&&(e.packet.event==="占い"&&e.packet.fromIdx!==t(i)||e.packet.event==="投票"&&e.packet.fromIdx!==t(i)||e.packet.event==="襲撃投票"&&e.packet.fromIdx!==t(i)))return;const u=I.getContext("2d"),P=N.getContext("2d");if(!u||!P)return;const _=N.getBoundingClientRect();if(e.packet.fromIdx!==void 0&&e.packet.toIdx!==void 0){const k=document.getElementById(`agent-${e.packet.fromIdx}`);if(!(k instanceof HTMLElement))return;const y=k.getBoundingClientRect(),F=y.left+y.width/2-_.left,l=y.top+y.height/2-_.top,b=document.getElementById(`agent-${e.packet.toIdx}`);if(!(b instanceof HTMLElement))return;const m=b.getBoundingClientRect();E(P,F,l,m.left+m.width/2-_.left,m.top+m.height/2-_.top,!1,getComputedStyle(U).getPropertyValue("background-color"))}if(e.packet.bubbleIdx!==void 0){const k=document.getElementById(`agent-${e.packet.bubbleIdx}`);if(!(k instanceof HTMLElement))return;const y=k.getBoundingClientRect(),F=y.left+y.width/2-_.left,l=y.top+y.height/2-_.top;E(u,_.width/2,_.height/2,F,l,!0,getComputedStyle(Y).getPropertyValue("background-color"))}}function E(c,u,P,_,k,y,F){const l=y?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];c.strokeStyle=c.fillStyle=F,c.beginPath();let b=_-u,m=k-P,O=Math.sqrt(b*b+m*m),d=m/O,f=b/O,g=[];g.push(0,0);for(let T=0;T<l.length;T+=2){let J=l[T],x=l[T+1];g.push(J<0?O+J:J,x)}g.push(O,0);for(let T=l.length;T>0;T-=2){let J=l[T-2],x=l[T-1];g.push(J<0?O+J:J,-x)}g.push(0,0);for(let T=0;T<g.length;T+=2){let J=g[T]*f-g[T+1]*d+u,x=g[T]*d+g[T+1]*f+P;T===0?c.moveTo(J,x):c.lineTo(J,x)}c.fill()}var j=Pt(),C=s(j);ye(C,c=>U=c,()=>U);var D=o(C,2);{var X=c=>{var u=kt(),P=s(u),_=s(P);r(P),r(u),B(()=>K(_,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}
        ${e.packet.event??""}フェーズ`)),S(c,u)};ee(D,c=>{var u;(u=t(a))!=null&&u.display.largeScale||c(X)})}var ae=o(D,2),te=s(ae),xe=s(te);{var we=c=>{var u=St(),P=s(u),_=o(P,2,!0),k=o(_,2,!0);r(u),B(()=>{K(P,`${e.packet.day??""}日目`),K(_,e.packet.isDay?"昼":"夜"),K(k,e.packet.event)}),S(c,u)};ee(xe,c=>{var u;(u=t(a))!=null&&u.display.largeScale&&c(we)})}var pe=o(xe,2);ye(pe,c=>I=c,()=>I);var de=o(pe,2);ye(de,c=>N=c,()=>N);var re=o(de,2),he=s(re),fe=s(he),ve=s(fe,!0);r(fe),r(he),r(re),ye(re,c=>Y=c,()=>Y);var ke=o(re,2);Xe(ke,17,()=>e.packet.agents,He,(c,u,P)=>{var _=Ct(),k=s(_),y=s(k),F=s(y);F.__click=[It,i,u];var l=s(F),b=o(l,2);{var m=x=>{var h=jt(),H=s(h),ie=s(H,!0);r(H),r(h),B(()=>K(ie,t(u).idx)),S(x,h)};ee(b,x=>{var h,H;(h=t(a))!=null&&h.display.largeScale&&((H=t(a))!=null&&H.display.canvas.name)&&x(m)})}r(F),r(y),r(k);var O=o(k,2);{var d=x=>{var h=Tt(),H=s(h,!0);r(h),B(ie=>K(H,ie),[()=>Ge(t(u).idx)]),S(x,h)};ee(O,x=>{var h,H;!((h=t(a))!=null&&h.display.largeScale)&&((H=t(a))!=null&&H.display.canvas.name)&&x(d)})}var f=o(O,2);{var g=x=>{var h=Te(),H=me(h);{var ie=A=>{var w=Et(),se=s(w,!0);r(w),B(()=>K(se,t(u).team)),S(A,w)},G=A=>{var w=Ot(),se=s(w,!0);r(w),B(()=>K(se,t(u).team)),S(A,w)};ee(H,A=>{var w;(w=t(a))!=null&&w.display.largeScale?A(ie):A(G,!1)})}S(x,h)};ee(f,x=>{var h;(h=t(a))!=null&&h.display.canvas.team&&x(g)})}var T=o(f,2);{var J=x=>{var h=Te(),H=me(h);{var ie=A=>{var w=At(),se=s(w,!0);r(w),B(()=>K(se,t(u).role)),S(A,w)},G=A=>{var w=Rt(),se=s(w,!0);r(w),B(()=>K(se,t(u).role)),S(A,w)};ee(H,A=>{var w;(w=t(a))!=null&&w.display.largeScale?A(ie):A(G,!1)})}S(x,h)};ee(T,x=>{var h;(h=t(a))!=null&&h.display.canvas.role&&(t(u).idx===t(i)||t(i)===void 0)&&x(J)})}r(_),B(x=>{var h;Ne(_,"style",`--angle: ${P*(360/e.packet.agents.length)}`),Ne(_,"id",`agent-${t(u).idx??""}`),Ue(_,"bg-focus",t(u).idx===t(i)),We(y,et((h=t(a))!=null&&h.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-x72s6v"),Ue(y,"ring-success",t(u).isAlive),Ue(y,"ring-error",!t(u).isAlive),bt(y,"opacity",t(u).isAlive?1:.25),Ne(l,"src",`${vt??""}/images/male/${x??""}.png`),Ne(l,"alt",t(u).name)},[()=>t(u).idx.toString().padStart(2,"0")]),S(c,_)}),r(te),ye(te,c=>v=c,()=>v),r(ae),Le(2),r(j),B(()=>{var c;re.hidden=!t(z),We(fe,et((c=t(a))!=null&&c.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center"),"svelte-x72s6v"),K(ve,t(z))}),S(n,j),Ye()}Fe(["click"]);function Jt(){Re.connect()}function Lt(){Re.disconnect()}var Nt=L('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Mt=L('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Bt=L('<div class="status status-error"></div>'),zt=(n,e)=>e("connection.url",n.currentTarget.value),Ut=(n,e)=>e("connection.token",n.currentTarget.value),Xt=(n,e)=>e("display.canvas.name",n.currentTarget.checked),Ht=(n,e)=>e("display.canvas.team",n.currentTarget.checked),Wt=(n,e)=>e("display.canvas.role",n.currentTarget.checked),Vt=(n,e)=>e("display.bubble.name",n.currentTarget.checked),qt=(n,e)=>e("display.bubble.team",n.currentTarget.checked),Kt=(n,e)=>e("display.bubble.role",n.currentTarget.checked),Yt=(n,e)=>e("display.text.name",n.currentTarget.checked),Ft=(n,e)=>e("display.text.team",n.currentTarget.checked),Gt=(n,e)=>e("display.text.role",n.currentTarget.checked),Qt=(n,e)=>e("display.largeScale",n.currentTarget.checked),Zt=L('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control my-2"><h3 class="text-lg font-bold">表示設定</h3> <h4 class="text-base font-bold mt-2">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function $t(n,e){Ke(e,!0);let a=Ce(void 0),p=Ce(void 0);const i=Oe.subscribe(M=>{Ee(a,Pe(M))}),z=Re.subscribe(M=>{Ee(p,Pe(M.status))});Qe(()=>{i(),z()});function v(M,Q){Oe.update(W=>{const q=M.split("."),Z=q.pop();let V=W;for(const R of q)R&&(V=V[R]);return V[Z]=Q,{...W}})}let I;var N=Zt(),Y=o(s(N),2),U=s(Y),ne=s(U);{var E=M=>{var Q=Nt();Le(2),S(M,Q)},j=M=>{var Q=Te(),W=me(Q);{var q=V=>{var R=Mt();Le(2),S(V,R)},Z=V=>{var R=Bt();S(V,R)};ee(W,V=>{t(p)==="connecting"?V(q):V(Z,!1)},!0)}S(M,Q)};ee(ne,M=>{t(p)==="connected"?M(E):M(j,!1)})}r(U),r(Y);var C=o(Y,2),D=s(C);oe(D,"class","h-[1em] opacity-50"),oe(D,"inline",!0),oe(D,"icon","mdi:link");var X=o(D,2);ue(X),X.__input=[zt,v],r(C);var ae=o(C,2),te=s(ae);oe(te,"class","h-[1em] opacity-50"),oe(te,"inline",!0),oe(te,"icon","mdi:key");var xe=o(te,2);ue(xe),xe.__input=[Ut,v],Le(2),r(ae);var we=o(ae,2);we.__click=[Jt];var pe=o(we,2);pe.__click=[Lt];var de=o(pe,2);de.__click=()=>I.showModal();var re=o(de,2),he=s(re),fe=s(he),ve=o(s(fe),4),ke=s(ve),c=o(s(ke),2);ue(c),c.__change=[Xt,v],r(ke);var u=o(ke,2),P=o(s(u),2);ue(P),P.__change=[Ht,v],r(u);var _=o(u,2),k=o(s(_),2);ue(k),k.__change=[Wt,v],r(_),r(ve);var y=o(ve,4),F=s(y),l=o(s(F),2);ue(l),l.__change=[Vt,v],r(F);var b=o(F,2),m=o(s(b),2);ue(m),m.__change=[qt,v],r(b);var O=o(b,2),d=o(s(O),2);ue(d),d.__change=[Kt,v],r(O),r(y);var f=o(y,4),g=s(f),T=o(s(g),2);ue(T),T.__change=[Yt,v],r(g);var J=o(g,2),x=o(s(J),2);ue(x),x.__change=[Ft,v],r(J);var h=o(J,2),H=o(s(h),2);ue(H),H.__change=[Gt,v],r(h),r(f);var ie=o(f,4),G=o(s(ie),2);ue(G),G.__change=[Qt,v],r(ie),r(fe),r(he),Le(2),r(re),ye(re,M=>I=M,()=>I);var A=o(re,2),w=s(A);oe(w,"inline",!0),oe(w,"icon","mdi:white-balance-sunny");var se=o(w,4);oe(se,"inline",!0),oe(se,"icon","mdi:moon-and-stars"),r(A),r(N),B(()=>{var M,Q,W,q,Z,V,R,ce,le,_e,De,Se;$e(X,(M=t(a))==null?void 0:M.connection.url),$e(xe,(Q=t(a))==null?void 0:Q.connection.token),we.disabled=t(p)!=="disconnected",pe.disabled=t(p)==="disconnected",be(c,(W=t(a))==null?void 0:W.display.canvas.name),be(P,(q=t(a))==null?void 0:q.display.canvas.team),be(k,(Z=t(a))==null?void 0:Z.display.canvas.role),be(l,(V=t(a))==null?void 0:V.display.bubble.name),be(m,(R=t(a))==null?void 0:R.display.bubble.team),be(d,(ce=t(a))==null?void 0:ce.display.bubble.role),be(T,(le=t(a))==null?void 0:le.display.text.name),be(x,(_e=t(a))==null?void 0:_e.display.text.team),be(H,(De=t(a))==null?void 0:De.display.text.role),be(G,(Se=t(a))==null?void 0:Se.display.largeScale)}),S(n,N),Ye()}Fe(["input","click","change"]);var en=L("<option> </option>"),tn=L('<div class="divider"> </div>'),nn=L('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),an=L('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),rn=L('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),sn=L('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),on=L("<!> <button><!></button>",1),ln=L('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="flex-1 overflow-y-auto h-full pr-2"><div class="flex flex-col p-2"><select class="w-full select"></select> <div class="list overflow-y-auto flex-1 my-2"><!></div></div></div></div></main>');function jn(n,e){Ke(e,!0);const[a,p]=ct(),i=()=>Je(Y,"$selectedId",a),z=()=>Je(j,"$entries",a),v=()=>Je(C,"$status",a),I=()=>Je(U,"$selectedIdx",a),N=()=>Je(E,"$currentPacket",a),Y=Ie(null),U=Ie(null),ne={id:"",idx:-1,day:0,isDay:!0,agents:yt(5),event:"未接続",message:void 0,fromIdx:void 0,toIdx:void 0,bubbleIdx:void 0},E=Ie(ne),j=Ie({}),C=Ie("");let D=Ce(void 0),X=Ce(80),ae=!1,te=null;function xe(){{const l=dt.url.searchParams,b=l.get("url"),m=l.get("token");b&&(Oe.update(O=>({...O,connection:{url:b??"",token:m??""}})),Re.connect())}}function we(l){if(!ae||!te)return;const b=te.getBoundingClientRect(),m=l-b.left,O=b.width;Ee(X,Pe(Math.min(90,Math.max(10,m/O*100))))}function pe(){ae=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const l=m=>{const O=m instanceof MouseEvent?m.clientX:m.touches[0].clientX;we(O)},b=()=>{ae=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",l),window.removeEventListener("touchmove",l),window.removeEventListener("mouseup",b),window.removeEventListener("touchend",b)};window.addEventListener("mousemove",l),window.addEventListener("touchmove",l),window.addEventListener("mouseup",b),window.addEventListener("touchend",b)}at(()=>{xe();const l=Re.entries.subscribe(f=>{j.set(f),Y.update(g=>g||Object.keys(f)[0]),U.update(()=>i()?f[i()].length-1:null)}),b=Re.subscribe(f=>{C.set(f.status)}),m=Y.subscribe(f=>{var g;f&&((g=z()[f])==null?void 0:g.length)>0?U.set(z()[f].length-1):U.set(null)}),O=Oe.subscribe(f=>{Ee(D,Pe(f))}),d=ft([Y,U,j],([f,g,T])=>{if(!f||g===null)return ne;const J=T[f];return!J||g<0||g>=J.length?ne:J[g]}).subscribe(f=>{E.set(f)});Qe(()=>{l(),b(),O(),m(),d()}),window.addEventListener("beforeunload",f=>{v()==="connected"&&f.preventDefault()}),window.addEventListener("popstate",f=>{v()==="connected"&&f.preventDefault()})});let de=null;nt(()=>{if(de&&I()!==null){const l=de.querySelectorAll("button");I()>=0&&I()<l.length&&l[I()].scrollIntoView({behavior:"smooth",block:"center"})}});var re=ln();ot(l=>{st.title="aiwolf-nlp-viewer"});var he=s(re);$t(he,{});var fe=o(he,2),ve=s(fe),ke=s(ve);Dt(ke,{get packet(){return N()}}),r(ve);var c=o(ve,2);c.__mousedown=pe,c.__touchstart=pe;var u=o(c,2),P=s(u),_=s(P);Xe(_,5,()=>Object.keys(z()),He,(l,b)=>{var m=en(),O={},d=s(m,!0);r(m),B(()=>{O!==(O=t(b))&&(m.value=(m.__value=t(b))==null?"":t(b)),K(d,t(b))}),S(l,m)}),r(_);var k=o(_,2),y=s(k);{var F=l=>{var b=Te(),m=me(b);Xe(m,1,()=>z()[i()]||[],He,(O,d,f)=>{var g=on(),T=me(g);{var J=G=>{var A=tn(),w=s(A);r(A),B(()=>K(w,`${t(d).day??""}日目 ${(t(d).isDay?"昼":"夜")??""}`)),S(G,A)};ee(T,G=>{(f>0&&(t(d).day!==z()[i()][f-1].day||t(d).isDay!==z()[i()][f-1].isDay)||f===0)&&G(J)})}var x=o(T,2);x.__click=()=>U.set(f);var h=s(x);{var H=G=>{var A=Te(),w=me(A);{var se=Q=>{var W=nn(),q=me(W),Z=s(q,!0);r(q);var V=o(q,2);oe(V,"inline",!0),oe(V,"icon","mdi:skip-forward"),B(R=>K(Z,R),[()=>{var R;return $((R=t(D))==null?void 0:R.display.text,t(d),t(d).bubbleIdx)}]),S(Q,W)},M=Q=>{var W=Te(),q=me(W);{var Z=R=>{var ce=an(),le=me(ce),_e=s(le,!0);r(le);var De=o(le,2);oe(De,"inline",!0),oe(De,"icon","mdi:arrow-u-down-right-bold"),B(Se=>K(_e,Se),[()=>{var Se;return $((Se=t(D))==null?void 0:Se.display.text,t(d),t(d).bubbleIdx)}]),S(R,ce)},V=R=>{var ce=rn(),le=s(ce,!0);r(ce),B(_e=>K(le,_e),[()=>{var _e;return $((_e=t(D))==null?void 0:_e.display.text,t(d),t(d).bubbleIdx)+"<"+t(d).message}]),S(R,ce)};ee(q,R=>{t(d).message==="Skip"?R(Z):R(V,!1)},!0)}S(Q,W)};ee(w,Q=>{t(d).message==="Over"?Q(se):Q(M,!1)})}S(G,A)},ie=G=>{var A=sn(),w=s(A);{var se=W=>{var q=Ze();B(Z=>K(q,Z),[()=>{var Z;return $((Z=t(D))==null?void 0:Z.display.text,t(d),t(d).fromIdx)}]),S(W,q)},M=W=>{var q=Te(),Z=me(q);{var V=R=>{var ce=Ze();B(le=>K(ce,le),[()=>{var le;return $((le=t(D))==null?void 0:le.display.text,t(d),t(d).toIdx)}]),S(R,ce)};ee(Z,R=>{(t(d).event==="追放"||t(d).event==="襲撃")&&R(V)},!0)}S(W,q)};ee(w,W=>{t(d).event==="投票"||t(d).event==="占い"?W(se):W(M,!1)})}var Q=o(w);r(A),B(()=>K(Q,` ${t(d).event??""}`)),S(G,A)};ee(h,G=>{t(d).event==="トーク"||t(d).event==="囁き"?G(H):G(ie,!1)})}r(x),B(()=>We(x,`btn ${(f===I()?"btn-primary":"")??""}`)),S(O,g)}),S(l,b)};ee(y,l=>{i()&&l(F)})}r(k),ye(k,l=>de=l,()=>de),r(P),r(u),r(fe),ye(fe,l=>te=l,()=>te),r(re),B(()=>Ne(ve,"style",`width: ${t(X)??""}%`)),it(_,i,l=>ut(Y,l)),S(n,re),Ye(),p()}Fe(["mousedown","touchstart","click"]);export{jn as component};
