var Yt=Object.defineProperty;var Zt=(e,t,n)=>t in e?Yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var yt=(e,t,n)=>Zt(e,typeof t!="symbol"?t+"":t,n);import{t as k,a as g,c as st}from"../chunks/CQIKem6B.js";import{e as Vt,u as Bt,p as vt,c as s,s as o,r as a,aI as at,t as Y,a as ft,f as tt,g as M,h as kt,aG as Et,y as zt,$ as Qt}from"../chunks/DJzILnW5.js";import{h as Xt}from"../chunks/74kPUpG4.js";import{i as J}from"../chunks/bGcRSTrU.js";import{p as ht}from"../chunks/BaREKndI.js";import{s as nt,b as Rt,a as Ft}from"../chunks/CmdMf11p.js";import{p as $t}from"../chunks/C1W9v0JG.js";import{w as Q}from"../chunks/B7xs7M_3.js";import{a as Wt,o as te}from"../chunks/CSRI-F4q.js";/* empty css                */import{d as Jt,s as S}from"../chunks/bj5TrsLi.js";import{e as ot,i as lt}from"../chunks/n8ULSs76.js";import{r as gt,s as K,a as _t,c as pt,d as ee}from"../chunks/GM4Wqstv.js";import{b as ne}from"../chunks/D44jfrx6.js";import{b as Ut}from"../chunks/D1AgY69q.js";function re(e,t,n){Vt(()=>{var u=Bt(()=>t(e,n==null?void 0:n())||{});if(u!=null&&u.destroy)return()=>u.destroy()})}class wt{static fromJson(t){return ie(JSON.parse(t),Tt("AgentSettings"))}static toJson(t){return JSON.stringify(oe(t,Tt("AgentSettings")),null,2)}}function rt(e,t,n,u=""){const y=St(e),m=u?` on ${u}`:"",T=n?` for key "${n}"`:"";throw Error(`Invalid value${T}${m}. Expected ${y} but got ${JSON.stringify(t)}`)}function St(e){return Array.isArray(e)?e.length===2&&e[0]===void 0?`an optional ${St(e[1])}`:`one of [${e.map(t=>St(t)).join(", ")}]`:typeof e=="object"&&e.literal!==void 0?e.literal:typeof e}function ae(e){if(e.jsonToJS===void 0){const t={};e.props.forEach(n=>t[n.json]={key:n.js,typ:n.typ}),e.jsonToJS=t}return e.jsonToJS}function se(e){if(e.jsToJSON===void 0){const t={};e.props.forEach(n=>t[n.js]={key:n.json,typ:n.typ}),e.jsToJSON=t}return e.jsToJSON}function ct(e,t,n,u="",y=""){function m(r,v){return typeof r==typeof v?v:rt(r,v,u,y)}function T(r,v){const x=r.length;for(let f=0;f<x;f++){const p=r[f];try{return ct(v,p,n)}catch{}}return rt(r,v,u,y)}function V(r,v){return r.indexOf(v)!==-1?v:rt(r.map(x=>bt(x)),v,u,y)}function F(r,v){return Array.isArray(v)?v.map(x=>ct(x,r,n)):rt(bt("array"),v,u,y)}function E(r){if(r===null)return null;const v=new Date(r);return isNaN(v.valueOf())?rt(bt("Date"),r,u,y):v}function b(r,v,x){if(x===null||typeof x!="object"||Array.isArray(x))return rt(bt(R||"object"),x,u,y);const f={};return Object.getOwnPropertyNames(r).forEach(p=>{const w=r[p],j=Object.prototype.hasOwnProperty.call(x,p)?x[p]:void 0;f[w.key]=ct(j,w.typ,n,p,R)}),Object.getOwnPropertyNames(x).forEach(p=>{Object.prototype.hasOwnProperty.call(r,p)||(f[p]=ct(x[p],v,n,p,R))}),f}if(t==="any")return e;if(t===null)return e===null?e:rt(t,e,u,y);if(t===!1)return rt(t,e,u,y);let R;for(;typeof t=="object"&&t.ref!==void 0;)R=t.ref,t=le[t.ref];return Array.isArray(t)?V(t,e):typeof t=="object"?t.hasOwnProperty("unionMembers")?T(t.unionMembers,e):t.hasOwnProperty("arrayItems")?F(t.arrayItems,e):t.hasOwnProperty("props")?b(n(t),t.additional,e):rt(t,e,u,y):t===Date&&typeof e!="number"?E(e):m(t,e)}function ie(e,t){return ct(e,t,ae)}function oe(e,t){return ct(e,t,se)}function bt(e){return{literal:e}}function Lt(e,t){return{props:e,additional:t}}function Tt(e){return{ref:e}}const le={AgentSettings:Lt([{json:"connection",js:"connection",typ:Tt("Connection")},{json:"team",js:"team",typ:""}],!1),Connection:Lt([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1)},Mt={connection:{url:"ws://localhost:8080/ws",token:""},team:"default"};function ce(){const e=localStorage.getItem("agent-settings");if(e)try{return wt.fromJson(e)}catch(t){console.error(t)}return localStorage.setItem("agent-settings",wt.toJson(Mt)),Mt}const dt=Q(ce());dt.subscribe(e=>{localStorage.setItem("agent-settings",wt.toJson(e))});var G=(e=>(e.NAME="NAME",e.TALK="TALK",e.WHISPER="WHISPER",e.VOTE="VOTE",e.DIVINE="DIVINE",e.GUARD="GUARD",e.ATTACK="ATTACK",e.INITIALIZE="INITIALIZE",e.DAILY_INITIALIZE="DAILY_INITIALIZE",e.DAILY_FINISH="DAILY_FINISH",e.FINISH="FINISH",e))(G||{});const Ot={NAME:"名前",TALK:"トーク",WHISPER:"囁き",VOTE:"投票",DIVINE:"占い",GUARD:"護衛",ATTACK:"襲撃",INITIALIZE:"ゲーム開始",DAILY_INITIALIZE:"昼開始",DAILY_FINISH:"昼終了",FINISH:"ゲーム終了"};var Dt=(e=>(e.HUMAN="HUMAN",e.WEREWOLF="WEREWOLF",e))(Dt||{});const xt={HUMAN:"人間",WEREWOLF:"人狼"};var At=(e=>(e.ALIVE="ALIVE",e.DEAD="DEAD",e))(At||{});const jt={ALIVE:"生存",DEAD:"死亡"};var Pt=(e=>(e.WEREWOLF="WEREWOLF",e.POSSESSED="POSSESSED",e.SEER="SEER",e.BODYGUARD="BODYGUARD",e.VILLAGER="VILLAGER",e.MEDIUM="MEDIUM",e))(Pt||{});const It={WEREWOLF:"人狼",POSSESSED:"狂人",SEER:"占い師",BODYGUARD:"騎士",VILLAGER:"村人",MEDIUM:"霊媒師"};function ue(){const{subscribe:e,update:t}=Q({status:"disconnected",deadline:null,entries:[],role:null,request:null,info:null,mediumResults:[],divineResults:[],setting:null,talkHistory:[],whisperHistory:[],executedAgents:[],attackedAgents:[]});let n=null,u=null,y=null,m=null;dt.subscribe(E=>{u=E});function T(){n&&(n.close(),n=null,t(E=>({...E,status:"disconnected"}))),m&&(m.clear(),m=null)}function V(){if(!u)return;n&&t(b=>({...b,status:"disconnected",deadline:null,entries:[],role:null,request:null,info:null,mediumResults:[],divineResults:[],setting:null,talkHistory:[],whisperHistory:[],executedAgents:[],attackedAgents:[]})),t(b=>({...b,status:"connecting"}));const E=new URL(u.connection.url);u.connection.token&&E.searchParams.set("token",u.connection.token),n=new WebSocket(E),n.onopen=()=>{t(b=>({...b,status:"connected"}))},n.onclose=()=>{T()},n.onerror=()=>{T()},n.onmessage=b=>{try{const R=Date.now(),r=JSON.parse(b.data);switch(t(v=>{const x=v.entries.slice();x.push(r);const f={...v,entries:x,request:r.request};if(r.info){if(f.info=r.info,r.info.mediumResult){const p=r.info.mediumResult;f.mediumResults.findIndex(w=>w.day===p.day&&w.agent===p.agent)<0&&f.mediumResults.push(r.info.mediumResult)}if(r.info.divineResult){const p=r.info.divineResult;f.divineResults.findIndex(w=>w.day===p.day&&w.agent===p.agent)<0&&f.divineResults.push(r.info.divineResult)}r.info.executedAgent&&f.executedAgents.push(r.info.executedAgent),r.info.attackedAgent&&f.attackedAgents.push(r.info.attackedAgent)}return r.setting&&(f.setting=r.setting,y=r.setting.actionTimeout),r.talkHistory&&f.talkHistory.push(...r.talkHistory),r.whisperHistory&&f.whisperHistory.push(...r.whisperHistory),r.request===G.INITIALIZE&&f.info&&f.info.roleMap&&f.info.agent&&(f.role=f.info.roleMap[f.info.agent]),f}),r.request){case G.NAME:F((u==null?void 0:u.team)||"viewer"+Math.floor(Math.random()*1e3));break;case G.TALK:case G.WHISPER:case G.VOTE:case G.DIVINE:case G.GUARD:case G.ATTACK:m&&m.clear(),m=new de(()=>{F("TIMEOUT")},new Date(R+(y??6e4))),t(v=>({...v,deadline:(m==null?void 0:m.deadline())??null}));break;case G.FINISH:T();break}}catch(R){console.error("Failed to parse message:",R)}}}function F(E){if(m&&(m.clear(),m=null,t(b=>({...b,deadline:null}))),n&&n.readyState===WebSocket.OPEN)try{n.send(E),t(b=>{const R=b.entries.slice();return R.push(E),{...b,entries:R}})}catch(b){console.error("Failed to send message:",b)}}return{subscribe:e,connect:V,disconnect:T,send:F}}const ut=ue();class de{constructor(t,n){yt(this,"timeout");yt(this,"_deadline");this.timeout=setTimeout(t,n.getTime()-new Date().getTime()),this._deadline=n}deadline(){return this._deadline}clear(){clearTimeout(this.timeout)}}function ve(e,t,n,u){e.key==="Enter"&&(e.preventDefault(),(e.ctrlKey||e.metaKey)&&t.onSendMessage(n()))}var fe=k('<span aria-live="polite"> </span>m',1),_e=(e,t,n)=>t(n()),ge=k('<button class="btn"> </button>'),me=k('<span class="bg-primary text-primary-content text-lg font-bold"> </span> <!>',1),be=(e,t)=>t("Skip"),xe=k('<button class="btn" aria-label="Skip"><iconify-icon></iconify-icon> SKIP</button>',2),pe=(e,t)=>t("Over"),he=k('<span class="bg-primary text-primary-content text-lg font-bold"> </span> <!> <button class="btn" aria-label="Over"><iconify-icon></iconify-icon> OVER</button>',3),Ae=k("<option></option>"),ye=k("<option></option>"),Ie=k("<!> <option></option>",1),ke=(e,t,n,u)=>t.onSendMessage(n()),Ee=k('<form class="flex-none bg-base-200" data-sveltekit-keepfocus=""><div class="flex gap-2 items-center mx-4 mt-4"><span class="countdown font-mono text-2xl"><!> <span aria-live="polite"> </span>s</span> <!> <input type="text" class="input flex-1" list="suggests"> <datalist id="suggests"><!></datalist> <button class="btn" aria-label="Send"><iconify-icon></iconify-icon> 送信</button></div> <div class="mx-4 mb-2"><progress class="progress" max="100"></progress></div></form>',2);function we(e,t){vt(t,!0);const[n,u]=Ft(),y=()=>nt(m,"$message",n),m=Q("");function T(l){Rt(m,ht(l)),V.focus()}let V;function F(l){l.focus()}var E=Ee(),b=s(E),R=s(b),r=s(R);{var v=l=>{var h=fe(),_=tt(h),L=s(_,!0);a(_),at(),Y((i,c)=>{_t(_,"style",`--value:${i??""};`),_t(_,"aria-label",c),S(L,i)},[()=>Math.floor(t.remain/6e4),()=>Math.floor(t.remain/6e4).toString()]),g(l,h)};J(r,l=>{t.remain&&t.remain>6e4&&l(v)})}var x=o(r,2),f=s(x,!0);a(x),at(),a(R);var p=o(R,2);{var w=l=>{var h=me(),_=tt(h),L=s(_);a(_);var i=o(_,2);ot(i,17,()=>{var c;return Object.entries(((c=t.info)==null?void 0:c.statusMap)??{})},lt,(c,d)=>{let N=()=>M(d)[0],I=()=>M(d)[1];var A=st(),O=tt(A);{var Z=q=>{var B=ge();B.__click=[_e,T,N];var D=s(B,!0);a(B),Y(()=>S(D,N())),g(q,B)};J(O,q=>{var B;I()===At.ALIVE&&N()!==((B=t.info)==null?void 0:B.agent)&&q(Z)})}g(c,A)}),Y(()=>S(L,`${Ot[t.request]??""}対象を選択してください`)),g(l,h)},j=l=>{var h=he(),_=tt(h),L=s(_);a(_);var i=o(_,2);{var c=I=>{var A=xe();A.__click=[be,T];var O=s(A);K(O,"icon","mdi:arrow-u-down-right-bold"),at(),a(A),g(I,A)};J(i,I=>{var A;(((A=t.setting)==null?void 0:A.maxSkip)??0)>0&&I(c)})}var d=o(i,2);d.__click=[pe,T];var N=s(d);K(N,"icon","mdi:skip-forward"),at(),a(d),Y(()=>S(L,`${Ot[t.request??G.INITIALIZE]??""}内容を入力してください`)),g(l,h)};J(p,l=>{t.request===G.VOTE||t.request===G.DIVINE||t.request===G.GUARD||t.request===G.ATTACK?l(w):l(j,!1)})}var X=o(p,2);gt(X),X.__keydown=[ve,t,y,m],Vt(()=>ne(X,y,l=>Rt(m,l))),re(X,l=>F==null?void 0:F(l)),Ut(X,l=>V=l,()=>V);var H=o(X,2),W=s(H);{var U=l=>{var h=st(),_=tt(h);ot(_,17,()=>{var L;return Object.entries(((L=t.info)==null?void 0:L.statusMap)??{})},lt,(L,i)=>{let c=()=>M(i)[0],d=()=>M(i)[1];var N=st(),I=tt(N);{var A=O=>{var Z=Ae(),q={};Y(()=>{q!==(q=c())&&(Z.value=(Z.__value=c())==null?"":c())}),g(O,Z)};J(I,O=>{var Z;d()===At.ALIVE&&c()!==((Z=t.info)==null?void 0:Z.agent)&&O(A)})}g(L,N)}),g(l,h)},z=l=>{var h=Ie(),_=tt(h);{var L=c=>{var d=ye();d.value=(d.__value="Skip")==null?"":"Skip",g(c,d)};J(_,c=>{var d;(((d=t.setting)==null?void 0:d.maxSkip)??0)>0&&c(L)})}var i=o(_,2);i.value=(i.__value="Over")==null?"":"Over",g(l,h)};J(W,l=>{t.request===G.VOTE||t.request===G.DIVINE||t.request===G.GUARD||t.request===G.ATTACK?l(U):l(z,!1)})}a(H);var P=o(H,2);P.__click=[ke,t,y,m];var et=s(P);K(et,"icon","mdi:send"),at(),a(P),a(b);var $=o(b,2),C=s($);a($),a(E),Y((l,h)=>{var _;_t(x,"style",`--value:${l??""};`),_t(x,"aria-label",h),S(f,l),pt(C,t.remain!==null?t.remain/(((_=t.setting)==null?void 0:_.actionTimeout)??6e4)*100:0)},[()=>Math.floor((t.remain?t.remain%6e4:0)/1e3),()=>Math.floor((t.remain?t.remain%6e4:0)/1e3).toString()]),g(e,E),ft(),u()}Jt(["click","keydown"]);var Se=k('<pre class="text-lg text-center"> </pre>'),Te=k('<div class="bg-info text-info-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),Oe=k('<div class="bg-error text-error-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),De=k('<div class="bg-error text-error-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),Ne=k('<div class="bg-success text-success-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),Re=k('<h2 class="text-lg font-bold pt-2">霊能結果</h2> <!>',1),Le=k('<div class="bg-error text-error-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),Me=k('<div class="bg-success text-success-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),je=k('<h2 class="font-bold text-lg pt-2">占い結果</h2> <!>',1),He=k('<div class="flex-[0_0_400px] rounded-lg bg-base-200"><div class="flex flex-col h-full p-4"><h2 class="text-xl font-bold pb-2">エージェント</h2> <div class="grow overflow-y-auto pr-4"><div class="flex justify-around"><div><h2 class="text-lg font-bold text-center">役職</h2> <pre class="text-lg text-center"> </pre></div> <div><h2 class="text-lg font-bold text-center">日数</h2> <pre class="text-lg text-center"> </pre></div> <div><h2 class="text-lg font-bold text-center">リクエスト</h2> <!></div></div> <h2 class="text-lg font-bold pt-2">ステータス</h2> <!> <!> <!></div></div></div>');function Ve(e,t){vt(t,!0);var n=He(),u=s(n),y=o(s(u),2),m=s(y),T=s(m),V=o(s(T),2),F=s(V,!0);a(V),a(T);var E=o(T,2),b=o(s(E),2),R=s(b,!0);a(b),a(E);var r=o(E,2),v=o(s(r),2);{var x=H=>{var W=Se(),U=s(W,!0);a(W),Y(()=>S(U,Ot[t.request])),g(H,W)};J(v,H=>{t.request!==null&&H(x)})}a(r),a(m);var f=o(m,4);ot(f,17,()=>Object.entries(t.info.statusMap??{}),lt,(H,W)=>{let U=()=>M(W)[0],z=()=>M(W)[1];var P=st(),et=tt(P);{var $=l=>{var h=Te(),_=s(h),L=s(_,!0);a(_);var i=o(_,2),c=s(i,!0);a(i);var d=o(i,2),N=s(d,!0);a(d),a(h),Y(()=>{S(L,U()),S(c,It[(t.info.roleMap??{})[U()]]??""),S(N,jt[z()])}),g(l,h)},C=l=>{var h=Oe(),_=s(h),L=s(_,!0);a(_);var i=o(_,2),c=s(i,!0);a(i);var d=o(i,2),N=s(d);a(d),a(h),Y(I=>{S(L,U()),S(c,It[(t.info.roleMap??{})[U()]]??""),S(N,`${jt[z()]??""}${I??""}`)},[()=>t.executedAgents.includes(U())?" (追放)":t.attackedAgents.includes(U())?" (襲撃)":""]),g(l,h)};J(et,l=>{z()===At.ALIVE?l($):l(C,!1)})}g(H,P)});var p=o(f,2);{var w=H=>{var W=Re(),U=o(tt(W),2);ot(U,17,()=>t.mediumResults,lt,(z,P)=>{let et=()=>M(P).day,$=()=>M(P).target,C=()=>M(P).result;var l=st(),h=tt(l);{var _=i=>{var c=De(),d=s(c),N=s(d,!0);a(d);var I=o(d,2),A=s(I);a(I);var O=o(I,2),Z=s(O,!0);a(O),a(c),Y(()=>{S(N,$()),S(A,`(${et()??""}日目)`),S(Z,xt[C()])}),g(i,c)},L=i=>{var c=Ne(),d=s(c),N=s(d,!0);a(d);var I=o(d,2),A=s(I);a(I);var O=o(I,2),Z=s(O,!0);a(O),a(c),Y(()=>{S(N,$()),S(A,`(${et()??""}日目)`),S(Z,xt[C()])}),g(i,c)};J(h,i=>{C()!==Dt.HUMAN?i(_):i(L,!1)})}g(z,l)}),g(H,W)};J(p,H=>{t.mediumResults.length>0&&H(w)})}var j=o(p,2);{var X=H=>{var W=je(),U=o(tt(W),2);ot(U,17,()=>t.divineResults,lt,(z,P)=>{let et=()=>M(P).day,$=()=>M(P).target,C=()=>M(P).result;var l=st(),h=tt(l);{var _=i=>{var c=Le(),d=s(c),N=s(d,!0);a(d);var I=o(d,2),A=s(I);a(I);var O=o(I,2),Z=s(O,!0);a(O),a(c),Y(()=>{S(N,$()),S(A,`(${et()??""}日目)`),S(Z,xt[C()])}),g(i,c)},L=i=>{var c=Me(),d=s(c),N=s(d,!0);a(d);var I=o(d,2),A=s(I);a(I);var O=o(I,2),Z=s(O,!0);a(O),a(c),Y(()=>{S(N,$()),S(A,`(${et()??""}日目)`),S(Z,xt[C()])}),g(i,c)};J(h,i=>{C()!==Dt.HUMAN?i(_):i(L,!1)})}g(z,l)}),g(H,W)};J(j,H=>{t.divineResults.length>0&&H(X)})}a(y),a(u),a(n),Y(()=>{S(F,t.role!==null?It[t.role]:"ゲーム外"),S(R,t.info!==null?t.info.day+"日目":"ゲーム外")}),g(e,n),ft()}function Fe(){ut.connect()}function We(){ut.disconnect()}var Je=k('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Ue=k('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Pe=k('<div class="status status-error"></div>'),qe=(e,t)=>t("connection.url",e.currentTarget.value),Ke=(e,t)=>t("connection.token",e.currentTarget.value),Ce=(e,t)=>t("team",e.currentTarget.value),Ge=k('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">エージェント設定</h3> <h4 class="text-base font-bold mt-4">チーム名</h4> <label class="input min-w-3xs w-3xs my-2"><iconify-icon></iconify-icon> <input type="text" class="grow"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Ye(e,t){vt(t,!0);let n=Et(void 0),u=Et(void 0);const y=dt.subscribe(i=>{kt(n,ht(i))}),m=ut.subscribe(i=>{kt(u,ht(i.status))});Wt(()=>{y(),m()});function T(i,c){dt.update(d=>{const N=i.split("."),I=N.pop();let A=d;for(const O of N)O&&(A=A[O]);return A[I]=c,{...d}})}let V;var F=Ge(),E=o(s(F),2),b=s(E),R=s(b);{var r=i=>{var c=Je();at(2),g(i,c)},v=i=>{var c=st(),d=tt(c);{var N=A=>{var O=Ue();at(2),g(A,O)},I=A=>{var O=Pe();g(A,O)};J(d,A=>{M(u)==="connecting"?A(N):A(I,!1)},!0)}g(i,c)};J(R,i=>{M(u)==="connected"?i(r):i(v,!1)})}a(b),a(E);var x=o(E,2),f=s(x);K(f,"class","h-[1em] opacity-50"),K(f,"inline",!0),K(f,"icon","mdi:link");var p=o(f,2);gt(p),p.__input=[qe,T],a(x);var w=o(x,2),j=s(w);K(j,"class","h-[1em] opacity-50"),K(j,"inline",!0),K(j,"icon","mdi:key");var X=o(j,2);gt(X),X.__input=[Ke,T],at(2),a(w);var H=o(w,2);H.__click=[Fe];var W=o(H,2);W.__click=[We];var U=o(W,2);U.__click=()=>V.showModal();var z=o(U,2),P=s(z),et=s(P),$=o(s(et),4),C=s($);K(C,"class","h-[1em] opacity-50"),K(C,"inline",!0),K(C,"icon","mdi:rename");var l=o(C,2);gt(l),l.__input=[Ce,T],a($),a(et),a(P),at(2),a(z),Ut(z,i=>V=i,()=>V);var h=o(z,2),_=s(h);K(_,"inline",!0),K(_,"icon","mdi:white-balance-sunny");var L=o(_,4);K(L,"inline",!0),K(L,"icon","mdi:moon-and-stars"),a(h),a(F),Y(()=>{var i,c,d;pt(p,(i=M(n))==null?void 0:i.connection.url),pt(X,(c=M(n))==null?void 0:c.connection.token),H.disabled=M(u)!=="disconnected",W.disabled=M(u)==="disconnected",pt(l,(d=M(n))==null?void 0:d.team)}),g(e,F),ft()}Jt(["input","click"]);var Ze=k("<iconify-icon></iconify-icon>",2),Be=k("<iconify-icon></iconify-icon>",2),ze=k('<div class="chat-bubble bg-base-100 text-pretty break-all"> </div>'),Qe=k('<div class="chat chat-start"><div class="chat-image avatar avatar-placeholder"><div class="bg-neutral text-neutral-content w-12 rounded-full"><span class="text-2xl"> </span></div></div> <div class="chat-header"></div> <!> <pre class="chat-footer opacity-50"> </pre></div>');function Xe(e,t){vt(t,!0);var n=Qe(),u=s(n),y=s(u),m=s(y),T=s(m,!0);a(m),a(y),a(u);var V=o(u,4);{var F=r=>{var v=Ze();K(v,"inline",!0),K(v,"icon","mdi:skip-forward"),g(r,v)},E=r=>{var v=st(),x=tt(v);{var f=w=>{var j=Be();K(j,"inline",!0),K(j,"icon","mdi:arrow-u-down-right-bold"),g(w,j)},p=w=>{var j=ze(),X=s(j,!0);a(j),Y(()=>S(X,t.talk.text)),g(w,j)};J(x,w=>{t.talk.skip?w(f):w(p,!1)},!0)}g(r,v)};J(V,r=>{t.talk.over?r(F):r(E,!1)})}var b=o(V,2),R=s(b,!0);a(b),a(n),Y(r=>{S(T,r),S(R,t.talk.idx)},[()=>{var r;return Number((r=t.talk.agent.match(/Agent\[(\d+)\]/))==null?void 0:r[1])??""}]),g(e,n),ft()}var $e=k('<input type="radio" name="talk_days" class="tab"> <div class="tab-content my-4"></div>',1),tn=k('<div class="tabs tabs-border"></div>'),en=k('<div class="flex-[0_0_600px] rounded-lg bg-base-200"><div class="flex flex-col h-full p-4"><h2 class="text-xl font-bold pb-2"> </h2> <div class="grow overflow-y-auto pr-4"><!></div></div></div>');function Ht(e,t){vt(t,!0);var n=en(),u=s(n),y=s(u),m=s(y,!0);a(y);var T=o(y,2),V=s(T);{var F=E=>{var b=tn();const R=zt(()=>[...new Set(t.talks.map(r=>r.day))].sort((r,v)=>v-r));ot(b,21,()=>M(R),lt,(r,v)=>{var x=$e(),f=tt(x);gt(f);var p=o(f,2);ot(p,21,()=>t.talks.filter(w=>w.day===M(v)),lt,(w,j)=>{Xe(w,{get talk(){return M(j)}})}),a(p),Y(()=>{ee(f,M(v)===M(R)[0]),_t(f,"aria-label",`${M(v)}日目`)}),g(r,x)}),a(b),g(E,b)};J(V,E=>{t.talks.length>0&&E(F)})}a(T),a(u),a(n),Y(()=>S(m,t.header)),g(e,n),ft()}var nn=k('<div class="overflow-y-hidden flex grow overflox-x-auto gap-4 p-4"><!> <!> <!></div> <!>',1),rn=k('<main class="h-screen flex flex-col bg-base-300"><!> <!></main>');function An(e,t){vt(t,!0);const[n,u]=Ft(),y=()=>nt(j,"$deadline",n),m=()=>nt(w,"$status",n),T=()=>nt(U,"$info",n),V=()=>nt(H,"$role",n),F=()=>nt(W,"$request",n),E=()=>nt(z,"$mediumResults",n),b=()=>nt(P,"$divineResults",n),R=()=>nt(l,"$executedAgents",n),r=()=>nt(h,"$attackedAgents",n),v=()=>nt($,"$talkHistory",n),x=()=>nt(C,"$whisperHistory",n),f=()=>nt(_,"$remain",n),p=()=>nt(et,"$setting",n),w=Q(""),j=Q(null),X=Q([]),H=Q(null),W=Q(null),U=Q(null),z=Q([]),P=Q([]),et=Q(null),$=Q([]),C=Q([]),l=Q([]),h=Q([]),_=Q(null);let L=Et(void 0),i;function c(){{const q=$t.url.searchParams,B=q.get("url"),D=q.get("token");B&&(dt.update(mt=>({...mt,connection:{url:B??"",token:D??""}})),ut.connect())}}function d(){if(y()!==null){const q=Date.now(),B=Math.max(0,y()-q);_.set(B),B>0?i=requestAnimationFrame(d):_.set(0)}return()=>{i&&cancelAnimationFrame(i)}}te(()=>{c();const q=ut.subscribe(D=>{w.set(D.status),D.deadline?(j.set(D.deadline.getTime()),i&&cancelAnimationFrame(i),i=requestAnimationFrame(d)):(j.set(null),_.set(null)),X.set(D.entries),H.set(D.role),W.set(D.request),U.set(D.info),z.set(D.mediumResults),P.set(D.divineResults),et.set(D.setting),$.set(D.talkHistory),C.set(D.whisperHistory),l.set(D.executedAgents),h.set(D.attackedAgents)}),B=dt.subscribe(D=>{kt(L,ht(D))});Wt(()=>{q(),B(),i&&cancelAnimationFrame(i)}),window.addEventListener("beforeunload",D=>{m()==="connected"&&D.preventDefault()}),window.addEventListener("popstate",D=>{m()==="connected"&&D.preventDefault()})});function N(q){ut.send(q)}var I=rn();Xt(q=>{Qt.title="aiwolf-nlp-viewer"});var A=s(I);Ye(A,{});var O=o(A,2);{var Z=q=>{var B=nn(),D=tt(B),mt=s(D);Ve(mt,{get role(){return V()},get request(){return F()},get info(){return T()},get mediumResults(){return E()},get divineResults(){return b()},get executedAgents(){return R()},get attackedAgents(){return r()}});var Nt=o(mt,2);Ht(Nt,{header:"トーク履歴",get talks(){return v()}});var qt=o(Nt,2);{var Kt=it=>{Ht(it,{header:"囁き履歴",get talks(){return x()}})};J(qt,it=>{V()===Pt.WEREWOLF&&it(Kt)})}a(D);var Ct=o(D,2);{var Gt=it=>{we(it,{get remain(){return f()},get setting(){return p()},get request(){return F()},get info(){return T()},onSendMessage:N})};J(Ct,it=>{f()!==null&&it(Gt)})}g(q,B)};J(O,q=>{T()!==null&&q(Z)})}a(I),g(e,I),ft(),u()}export{An as component};
