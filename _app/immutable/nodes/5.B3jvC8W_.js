import{t as J,a as k,c as We,d as et}from"../chunks/mIMC2spK.js";import{p as Ye,ai as Ae,i as rt,t as D,a as Ge,aI as Ie,c as s,s as o,l as n,r,aL as De,aK as it,f as ke,$ as ot}from"../chunks/CzSJPQjd.js";import{d as Qe,s as V}from"../chunks/DuMCJiwN.js";import{i as Z}from"../chunks/BbBOvd3h.js";import{e as He,i as Fe}from"../chunks/_gRLrEI3.js";import{h as lt}from"../chunks/vngoCuur.js";import{a as Xe,s as de,r as ue,b as tt,c as be}from"../chunks/C-pHt_F9.js";import{s as Je,c as nt}from"../chunks/C4VwiCoO.js";import{s as Ve}from"../chunks/CxxO55Dj.js";import{b as ct}from"../chunks/DWigfQlt.js";import{b as Se}from"../chunks/BaZll9VJ.js";import{p as ut,s as Ne,a as dt,b as ft}from"../chunks/BfILAozT.js";import{p as vt}from"../chunks/CQbSTwbh.js";import{w as Ee,d as bt}from"../chunks/CD6rncXF.js";import{I as _t}from"../chunks/Dz1Iufi4.js";import{S as mt,R as pt}from"../chunks/BON7M-IV.js";import{a as Ze,o as st}from"../chunks/_pmIgHwY.js";/* empty css                */import{b as xt}from"../chunks/CXcdFoYL.js";class Ke{static fromJson(e){return yt(JSON.parse(e),Te("RealtimeSettings"))}static toJson(e){return JSON.stringify(wt(e,Te("RealtimeSettings")),null,2)}}function ge(t,e,a,i=""){const j=qe(t),U=i?` on ${i}`:"",p=a?` for key "${a}"`:"";throw Error(`Invalid value${p}${U}. Expected ${j} but got ${JSON.stringify(e)}`)}function qe(t){return Array.isArray(t)?t.length===2&&t[0]===void 0?`an optional ${qe(t[1])}`:`one of [${t.map(e=>qe(e)).join(", ")}]`:typeof t=="object"&&t.literal!==void 0?t.literal:typeof t}function gt(t){if(t.jsonToJS===void 0){const e={};t.props.forEach(a=>e[a.json]={key:a.js,typ:a.typ}),t.jsonToJS=e}return t.jsonToJS}function ht(t){if(t.jsToJSON===void 0){const e={};t.props.forEach(a=>e[a.js]={key:a.json,typ:a.typ}),t.jsToJSON=e}return t.jsToJSON}function Le(t,e,a,i="",j=""){function U(E,T){return typeof E==typeof T?T:ge(E,T,i,j)}function p(E,T){const O=E.length;for(let Y=0;Y<O;Y++){const C=E[Y];try{return Le(T,C,a)}catch{}}return ge(E,T,i,j)}function x(E,T){return E.indexOf(T)!==-1?T:ge(E.map(O=>Be(O)),T,i,j)}function P(E,T){return Array.isArray(T)?T.map(O=>Le(O,E,a)):ge(Be("array"),T,i,j)}function q(E){if(E===null)return null;const T=new Date(E);return isNaN(T.valueOf())?ge(Be("Date"),E,i,j):T}function X(E,T,O){if(O===null||typeof O!="object"||Array.isArray(O))return ge(Be(te||"object"),O,i,j);const Y={};return Object.getOwnPropertyNames(E).forEach(C=>{const se=E[C],ae=Object.prototype.hasOwnProperty.call(O,C)?O[C]:void 0;Y[se.key]=Le(ae,se.typ,a,C,te)}),Object.getOwnPropertyNames(O).forEach(C=>{Object.prototype.hasOwnProperty.call(E,C)||(Y[C]=Le(O[C],T,a,C,te))}),Y}if(e==="any")return t;if(e===null)return t===null?t:ge(e,t,i,j);if(e===!1)return ge(e,t,i,j);let te;for(;typeof e=="object"&&e.ref!==void 0;)te=e.ref,e=kt[e.ref];return Array.isArray(e)?x(e,t):typeof e=="object"?e.hasOwnProperty("unionMembers")?p(e.unionMembers,t):e.hasOwnProperty("arrayItems")?P(e.arrayItems,t):e.hasOwnProperty("props")?X(a(e),e.additional,t):ge(e,t,i,j):e===Date&&typeof t!="number"?q(t):U(e,t)}function yt(t,e){return Le(t,e,gt)}function wt(t,e){return Le(t,e,ht)}function Be(t){return{literal:t}}function Ue(t,e){return{props:t,additional:e}}function Te(t){return{ref:t}}const kt={RealtimeSettings:Ue([{json:"connection",js:"connection",typ:Te("Connection")},{json:"display",js:"display",typ:Te("Display")}],!1),Connection:Ue([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:Ue([{json:"canvas",js:"canvas",typ:Te("Agent")},{json:"bubble",js:"bubble",typ:Te("Agent")},{json:"text",js:"text",typ:Te("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:Ue([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},at={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function St(){const t=localStorage.getItem("realtime-settings");if(t)try{return Ke.fromJson(t)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",Ke.toJson(at)),at}const Oe=Ee(St());Oe.subscribe(t=>{localStorage.setItem("realtime-settings",Ke.toJson(t))});function jt(t){return Array.from({length:t},(e,a)=>({idx:a+1,team:"Undefined",name:_t(a+1),profile:void 0,avatar:void 0,role:"Undefined",is_alive:!0}))}function ee(t,e,a){var j,U,p;if(a===void 0)return"該当なし";let i=[];return t!=null&&t.name&&i.push((j=e.agents.find(x=>x.idx===a))==null?void 0:j.name),t!=null&&t.team&&i.push((U=e.agents.find(x=>x.idx===a))==null?void 0:U.team),t!=null&&t.role&&i.push((p=e.agents.find(x=>x.idx===a))==null?void 0:p.role),i.join(" ")}function Et(t){return t?mt[pt[t]]:""}function Me(t,e){return(t||e)&&!(t&&e)}function Tt(){const{subscribe:t,update:e}=Ee({status:"disconnected",entries:{}});let a=null,i=null;Oe.subscribe(p=>{i=p});function j(){if(!i)return;e(x=>({...x,status:"connecting"}));const p=new URL(i.connection.url);i.connection.token&&p.searchParams.set("token",i.connection.token),a=new WebSocket(p),a.onopen=()=>{e(x=>({...x,status:"connected"}))},a.onclose=()=>{e(x=>({...x,status:"disconnected"})),a=null},a.onerror=()=>{e(x=>({...x,status:"disconnected"})),a=null},a.onmessage=x=>{try{const P=JSON.parse(x.data);console.log("Received packet:",P),e(q=>{const X={...q.entries};return X[P.id]||(X[P.id]=[]),X[P.id].push(P),{...q,entries:X}})}catch(P){console.error("Failed to parse message:",P)}}}function U(){a&&(e(p=>({...p,status:"disconnected"})),a.close(),a=null)}return{subscribe:t,connect:j,disconnect:U,entries:{subscribe:p=>t(x=>p(x.entries))}}}const Pe=Tt();var Ot=J('<div role="alert" class="alert m-4"><span class="text-lg font-bold"> </span></div>'),Rt=J('<pre class="base-content w-2/5 text-5xl font-bold opacity-70 absolute top-0 left-0 -mt-4 ml-8 select-none"> <br> <br> </pre>'),Ct=(t,e,a)=>{e()===n(a).idx?e(void 0):e(n(a).idx)},Lt=J('<pre class="base-content text-2xl select-none"> </pre>'),At=J('<pre class="base-content select-none"> </pre>'),It=J('<pre class="base-content text-2xl select-none"> </pre>'),Jt=J('<pre class="base-content select-none"> </pre>'),Pt=J('<pre class="base-content text-2xl select-none"> </pre>'),Nt=J('<pre class="base-content select-none"> </pre>'),Mt=J('<div><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"></button></div></div> <div class="mt-2"><!> <!> <!></div></div>'),Dt=J('<div class="h-full flex flex-col"><div class="bg-secondary"></div> <!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><span>イラスト : 石黒正数氏</span></aside></footer></div>');function Wt(t,e){Ye(e,!0);let a=ut(e,"focusIdx",15),i=Ie(void 0);const j=Oe.subscribe(f=>{Ae(i,f,!0)});Ze(j);let U=it(()=>{var f,l,A,h,W,y,w,N,c,_,m,R,d,u;switch(e.packet.event){case"未接続":return"未接続";case"トーク":return e.packet.message;case"囁き":return Me(a()===void 0,((f=e.packet.agents.find(v=>v.idx===a()))==null?void 0:f.role)==="WEREWOLF")?e.packet.message:"囁きました";case"襲撃投票":return Me(a()===void 0,e.packet.from_idx===a())?`${ee((l=n(i))==null?void 0:l.display.bubble,e.packet,e.packet.from_idx)} が ${ee((A=n(i))==null?void 0:A.display.bubble,e.packet,e.packet.to_idx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return Me(a()===void 0,e.packet.from_idx===a())?`${ee((h=n(i))==null?void 0:h.display.bubble,e.packet,e.packet.from_idx)} が ${ee((W=n(i))==null?void 0:W.display.bubble,e.packet,e.packet.to_idx)} に投票しました`:`${ee((y=n(i))==null?void 0:y.display.bubble,e.packet,e.packet.from_idx)} が投票しました`;case"追放":return e.packet.to_idx===void 0?"誰も追放されませんでした":`${ee((w=n(i))==null?void 0:w.display.bubble,e.packet,e.packet.to_idx)} を追放しました`;case"襲撃":return e.packet.to_idx===void 0?"誰も襲撃されませんでした":e.packet.from_idx===-1?`${ee((N=n(i))==null?void 0:N.display.bubble,e.packet,e.packet.to_idx)} が襲撃されましたが、護衛されました`:`${ee((c=n(i))==null?void 0:c.display.bubble,e.packet,e.packet.to_idx)} が襲撃されました`;case"占い":return Me(a()===void 0,e.packet.from_idx===a())?`${ee((_=n(i))==null?void 0:_.display.bubble,e.packet,e.packet.from_idx)} が ${ee((m=n(i))==null?void 0:m.display.bubble,e.packet,e.packet.to_idx)} を占った結果、${Et((R=e.packet.agents.find(v=>v.idx===e.packet.to_idx))==null?void 0:R.role)} でした`:"占いました";case"護衛":return Me(a()===void 0,e.packet.from_idx===a())?`${ee((d=n(i))==null?void 0:d.display.bubble,e.packet,e.packet.from_idx)} が ${ee((u=n(i))==null?void 0:u.display.bubble,e.packet,e.packet.to_idx)} を護衛対象にしました`:"護衛しました";case"終了":return e.packet.message+" が勝利しました";default:return}}),p,x,P,q,X;st(()=>(window.addEventListener("resize",te),()=>{window.removeEventListener("resize",te)})),rt(()=>{te()});function te(){var W;if(!x||!P||!p)return;const f=p.getBoundingClientRect();if([x,P].forEach(y=>{y.width=f.width,y.height=f.height;const w=y.getContext("2d");w&&(w.clearRect(0,0,y.width,y.height),w.globalAlpha=1,w.lineWidth=2)}),a()!==void 0&&(e.packet.event==="囁き"&&((W=e.packet.agents.find(y=>y.idx===a()))==null?void 0:W.role)!=="WEREWOLF"||e.packet.event==="占い"&&e.packet.from_idx!==a()||e.packet.event==="投票"&&e.packet.from_idx!==a()||e.packet.event==="襲撃投票"&&e.packet.from_idx!==a()))return;const l=x.getContext("2d"),A=P.getContext("2d");if(!l||!A)return;const h=P.getBoundingClientRect();if(e.packet.from_idx!==void 0&&e.packet.to_idx!==void 0){const y=document.getElementById(`agent-${e.packet.from_idx}`);if(!(y instanceof HTMLElement))return;const w=y.getBoundingClientRect(),N=w.left+w.width/2-h.left,c=w.top+w.height/2-h.top,_=document.getElementById(`agent-${e.packet.to_idx}`);if(!(_ instanceof HTMLElement))return;const m=_.getBoundingClientRect();E(A,N,c,m.left+m.width/2-h.left,m.top+m.height/2-h.top,!1,getComputedStyle(X).getPropertyValue("background-color"))}if(e.packet.bubble_idx!==void 0){const y=document.getElementById(`agent-${e.packet.bubble_idx}`);if(!(y instanceof HTMLElement))return;const w=y.getBoundingClientRect(),N=w.left+w.width/2-h.left,c=w.top+w.height/2-h.top;E(l,h.width/2,h.height/2,N,c,!0,getComputedStyle(q).getPropertyValue("background-color"))}}function E(f,l,A,h,W,y,w){const N=y?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];f.strokeStyle=f.fillStyle=w,f.beginPath();let c=h-l,_=W-A,m=Math.sqrt(c*c+_*_),R=_/m,d=c/m,u=[];u.push(0,0);for(let v=0;v<N.length;v+=2){let z=N[v],G=N[v+1];u.push(z<0?m+z:z,G)}u.push(m,0);for(let v=N.length;v>0;v-=2){let z=N[v-2],G=N[v-1];u.push(z<0?m+z:z,-G)}u.push(0,0);for(let v=0;v<u.length;v+=2){let z=u[v]*d-u[v+1]*R+l,G=u[v]*R+u[v+1]*d+A;v===0?f.moveTo(z,G):f.lineTo(z,G)}f.fill()}var T=Dt(),O=s(T);Se(O,f=>X=f,()=>X);var Y=o(O,2);{var C=f=>{var l=Ot(),A=s(l),h=s(A);r(A),r(l),D(()=>V(h,`${e.packet.day??""}日目 ${e.packet.is_day?"昼":"夜"}
        ${e.packet.event??""}フェーズ`)),k(f,l)};Z(Y,f=>{var l;(l=n(i))!=null&&l.display.largeScale||f(C)})}var se=o(Y,2),ae=s(se),fe=s(ae);{var je=f=>{var l=Rt(),A=s(l),h=o(A,2,!0),W=o(h,2,!0);r(l),D(()=>{V(A,`${e.packet.day??""}日目`),V(h,e.packet.is_day?"昼":"夜"),V(W,e.packet.event)}),k(f,l)};Z(fe,f=>{var l;(l=n(i))!=null&&l.display.largeScale&&f(je)})}var he=o(fe,2);Se(he,f=>x=f,()=>x);var ye=o(he,2);Se(ye,f=>P=f,()=>P);var ne=o(ye,2),_e=s(ne),me=s(_e),pe=s(me,!0);r(me),r(_e),r(ne),Se(ne,f=>q=f,()=>q);var ve=o(ne,2);He(ve,17,()=>e.packet.agents,Fe,(f,l,A)=>{var h=Mt();let W;var y=s(h),w=s(y);let N,c;var _=s(w);_.__click=[Ct,a,l];var m=s(_);r(_),r(w),r(y);var R=o(y,2),d=s(R);{var u=K=>{var L=We(),ie=ke(L);{var M=S=>{var b=Lt(),g=s(b,!0);r(b),D(()=>V(g,n(l).name)),k(S,b)},H=S=>{var b=At(),g=s(b,!0);r(b),D(()=>V(g,n(l).name)),k(S,b)};Z(ie,S=>{var b;(b=n(i))!=null&&b.display.largeScale?S(M):S(H,!1)})}k(K,L)};Z(d,K=>{var L;(L=n(i))!=null&&L.display.canvas.name&&K(u)})}var v=o(d,2);{var z=K=>{var L=We(),ie=ke(L);{var M=S=>{var b=It(),g=s(b,!0);r(b),D(()=>V(g,n(l).team)),k(S,b)},H=S=>{var b=Jt(),g=s(b,!0);r(b),D(()=>V(g,n(l).team)),k(S,b)};Z(ie,S=>{var b;(b=n(i))!=null&&b.display.largeScale?S(M):S(H,!1)})}k(K,L)};Z(v,K=>{var L;(L=n(i))!=null&&L.display.canvas.team&&K(z)})}var G=o(v,2);{var xe=K=>{var L=We(),ie=ke(L);{var M=S=>{var b=Pt(),g=s(b,!0);r(b),D(()=>V(g,n(l).role)),k(S,b)},H=S=>{var b=Nt(),g=s(b,!0);r(b),D(()=>V(g,n(l).role)),k(S,b)};Z(ie,S=>{var b;(b=n(i))!=null&&b.display.largeScale?S(M):S(H,!1)})}k(K,L)};Z(G,K=>{var L;(L=n(i))!=null&&L.display.canvas.role&&(n(l).idx===a()||a()===void 0)&&K(xe)})}r(R),r(h),D((K,L,ie)=>{var M;W=Je(h,1,"absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-1xlm15x",null,W,K),Ve(h,`--angle: ${A*(360/e.packet.agents.length)}`),Xe(h,"id",`agent-${n(l).idx??""}`),N=Je(w,1,nt((M=n(i))!=null&&M.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-1xlm15x",N,L),c=Ve(w,"",c,{opacity:n(l).is_alive?1:.25}),Xe(m,"src",ie),Xe(m,"alt",n(l).name)},[()=>({"bg-focus":n(l).idx===a()}),()=>({"ring-info":n(l).is_alive,"ring-error":!n(l).is_alive}),()=>n(l).avatar===void 0?`${xt}/images/male/${n(l).idx.toString().padStart(2,"0")}.png`:n(l).avatar]),k(f,h)}),r(ae),Se(ae,f=>p=f,()=>p),r(se),De(2),r(T),D(()=>{var f;ne.hidden=!n(U),Je(me,1,nt((f=n(i))!=null&&f.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center")),V(pe,n(U))}),k(t,T),Ge()}Qe(["click"]);function zt(){Pe.connect()}function Bt(){Pe.disconnect()}var Ut=J('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Xt=J('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Ht=J('<div class="status status-error"></div>'),Ft=(t,e)=>e("connection.url",t.currentTarget.value),Vt=(t,e)=>e("connection.token",t.currentTarget.value),Kt=(t,e)=>e("display.canvas.name",t.currentTarget.checked),qt=(t,e)=>e("display.canvas.team",t.currentTarget.checked),Yt=(t,e)=>e("display.canvas.role",t.currentTarget.checked),Gt=(t,e)=>e("display.bubble.name",t.currentTarget.checked),Qt=(t,e)=>e("display.bubble.team",t.currentTarget.checked),Zt=(t,e)=>e("display.bubble.role",t.currentTarget.checked),$t=(t,e)=>e("display.text.name",t.currentTarget.checked),en=(t,e)=>e("display.text.team",t.currentTarget.checked),tn=(t,e)=>e("display.text.role",t.currentTarget.checked),nn=(t,e)=>e("display.largeScale",t.currentTarget.checked),an=J('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><a class="text-3xl font-bold text-nowrap ml-2" href="./">aiwolf-nlp-viewer</a> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control my-2"><h3 class="text-lg font-bold">表示設定</h3> <h4 class="text-base font-bold mt-2">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function rn(t,e){Ye(e,!0);let a=Ie(void 0),i=Ie(void 0);const j=Oe.subscribe(g=>{Ae(a,g,!0)}),U=Pe.subscribe(g=>{Ae(i,g.status,!0)});Ze(()=>{j(),U()});function p(g,$){Oe.update(I=>{const Q=g.split("."),F=Q.pop();let B=I;for(const oe of Q)oe&&(B=B[oe]);return B[F]=$,{...I}})}let x;var P=an(),q=o(s(P),2),X=s(q),te=s(X);{var E=g=>{var $=Ut();De(2),k(g,$)},T=(g,$)=>{{var I=F=>{var B=Xt();De(2),k(F,B)},Q=F=>{var B=Ht();k(F,B)};Z(g,F=>{n(i)==="connecting"?F(I):F(Q,!1)},$)}};Z(te,g=>{n(i)==="connected"?g(E):g(T,!1)})}r(X),r(q);var O=o(q,2),Y=s(O);Je(Y,1,"h-[1em] opacity-50"),de(Y,"inline",!0),de(Y,"icon","mdi:link");var C=o(Y,2);ue(C),C.__input=[Ft,p],r(O);var se=o(O,2),ae=s(se);Je(ae,1,"h-[1em] opacity-50"),de(ae,"inline",!0),de(ae,"icon","mdi:key");var fe=o(ae,2);ue(fe),fe.__input=[Vt,p],De(2),r(se);var je=o(se,2);je.__click=[zt];var he=o(je,2);he.__click=[Bt];var ye=o(he,2);ye.__click=()=>x.showModal();var ne=o(ye,2),_e=s(ne),me=s(_e),pe=o(s(me),4),ve=s(pe),f=o(s(ve),2);ue(f),f.__change=[Kt,p],r(ve);var l=o(ve,2),A=o(s(l),2);ue(A),A.__change=[qt,p],r(l);var h=o(l,2),W=o(s(h),2);ue(W),W.__change=[Yt,p],r(h),r(pe);var y=o(pe,4),w=s(y),N=o(s(w),2);ue(N),N.__change=[Gt,p],r(w);var c=o(w,2),_=o(s(c),2);ue(_),_.__change=[Qt,p],r(c);var m=o(c,2),R=o(s(m),2);ue(R),R.__change=[Zt,p],r(m),r(y);var d=o(y,4),u=s(d),v=o(s(u),2);ue(v),v.__change=[$t,p],r(u);var z=o(u,2),G=o(s(z),2);ue(G),G.__change=[en,p],r(z);var xe=o(z,2),K=o(s(xe),2);ue(K),K.__change=[tn,p],r(xe),r(d);var L=o(d,4),ie=o(s(L),2);ue(ie),ie.__change=[nn,p],r(L),r(me),r(_e),De(2),r(ne),Se(ne,g=>x=g,()=>x);var M=o(ne,2),H=s(M);de(H,"inline",!0),de(H,"icon","mdi:white-balance-sunny");var S=o(H,2),b=o(S,2);de(b,"inline",!0),de(b,"icon","mdi:moon-and-stars"),r(M),r(P),D(()=>{var g,$,I,Q,F,B,oe,le,Re,ce,re,we;tt(C,(g=n(a))==null?void 0:g.connection.url),tt(fe,($=n(a))==null?void 0:$.connection.token),je.disabled=n(i)!=="disconnected",he.disabled=n(i)==="disconnected",be(f,(I=n(a))==null?void 0:I.display.canvas.name),be(A,(Q=n(a))==null?void 0:Q.display.canvas.team),be(W,(F=n(a))==null?void 0:F.display.canvas.role),be(N,(B=n(a))==null?void 0:B.display.bubble.name),be(_,(oe=n(a))==null?void 0:oe.display.bubble.team),be(R,(le=n(a))==null?void 0:le.display.bubble.role),be(v,(Re=n(a))==null?void 0:Re.display.text.name),be(G,(ce=n(a))==null?void 0:ce.display.text.team),be(K,(re=n(a))==null?void 0:re.display.text.role),be(ie,(we=n(a))==null?void 0:we.display.largeScale)}),k(t,P),Ge()}Qe(["input","click","change"]);var sn=J("<option> </option>"),on=J('<div class="divider"> </div>'),ln=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),cn=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),un=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),dn=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),fn=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),vn=J("<!> <button><!></button>",1),bn=J('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="flex-1 overflow-y-auto h-full pr-2"><div class="flex flex-col p-2"><select class="w-full select"></select> <div class="list overflow-y-auto flex-1 my-2"><!></div></div></div></div></main>');function Jn(t,e){Ye(e,!0);const[a,i]=dt(),j=()=>Ne(q,"$selectedId",a),U=()=>Ne(O,"$entries",a),p=()=>Ne(Y,"$status",a),x=()=>Ne(X,"$selectedIdx",a),P=()=>Ne(T,"$currentPacket",a),q=Ee(null),X=Ee(null);let te=Ie(void 0);const E={id:"",idx:-1,day:0,is_day:!0,agents:jt(5),event:"未接続",message:void 0,from_idx:void 0,to_idx:void 0,bubble_idx:void 0},T=Ee(E),O=Ee({}),Y=Ee("");let C=Ie(void 0),se=Ie(80),ae=!1,fe=null;function je(){{const c=vt.url.searchParams,_=c.get("url"),m=c.get("token");_&&(Oe.update(R=>({...R,connection:{url:_??"",token:m??""}})),Pe.connect())}}function he(c){if(!ae||!fe)return;const _=fe.getBoundingClientRect(),m=c-_.left,R=_.width;Ae(se,Math.min(90,Math.max(10,m/R*100)),!0)}function ye(){ae=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const c=m=>{const R=m instanceof MouseEvent?m.clientX:m.touches[0].clientX;he(R)},_=()=>{ae=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",c),window.removeEventListener("touchmove",c),window.removeEventListener("mouseup",_),window.removeEventListener("touchend",_)};window.addEventListener("mousemove",c),window.addEventListener("touchmove",c),window.addEventListener("mouseup",_),window.addEventListener("touchend",_)}st(()=>{je();const c=Pe.entries.subscribe(u=>{O.set(u),q.update(v=>v||Object.keys(u)[0]),X.update(()=>j()?u[j()].length-1:null)}),_=Pe.subscribe(u=>{Y.set(u.status)}),m=q.subscribe(u=>{var v;u&&((v=U()[u])==null?void 0:v.length)>0?X.set(U()[u].length-1):X.set(null)}),R=Oe.subscribe(u=>{Ae(C,u,!0)}),d=bt([q,X,O],([u,v,z])=>{if(!u||v===null)return E;const G=z[u];return!G||v<0||v>=G.length?E:G[v]}).subscribe(u=>{T.set(u)});Ze(()=>{c(),_(),R(),m(),d()}),window.addEventListener("beforeunload",u=>{p()==="connected"&&u.preventDefault()}),window.addEventListener("popstate",u=>{p()==="connected"&&u.preventDefault()})});let ne=null;rt(()=>{if(ne&&x()!==null){const c=ne.querySelectorAll("button");x()>=0&&x()<c.length&&c[x()].scrollIntoView({behavior:"smooth",block:"center"})}});var _e=bn();lt(c=>{ot.title="aiwolf-nlp-viewer"});var me=s(_e);rn(me,{});var pe=o(me,2),ve=s(pe),f=s(ve);Wt(f,{get packet(){return P()},get focusIdx(){return n(te)},set focusIdx(c){Ae(te,c,!0)}}),r(ve);var l=o(ve,2);l.__mousedown=ye,l.__touchstart=ye;var A=o(l,2),h=s(A),W=s(h);He(W,5,()=>Object.keys(U()),Fe,(c,_)=>{var m=sn(),R={},d=s(m,!0);r(m),D(()=>{R!==(R=n(_))&&(m.value=(m.__value=n(_))??""),V(d,n(_))}),k(c,m)}),r(W);var y=o(W,2),w=s(y);{var N=c=>{var _=We(),m=ke(_);He(m,1,()=>U()[j()]||[],Fe,(R,d,u)=>{var v=vn(),z=ke(v);{var G=M=>{var H=on(),S=s(H);r(H),D(()=>V(S,`${n(d).day??""}日目 ${n(d).is_day?"昼":"夜"}`)),k(M,H)};Z(z,M=>{(u>0&&(n(d).day!==U()[j()][u-1].day||n(d).is_day!==U()[j()][u-1].is_day)||u===0)&&M(G)})}var xe=o(z,2);xe.__click=()=>X.set(u);var K=s(xe);{var L=M=>{var H=We(),S=ke(H);{var b=$=>{var I=ln(),Q=s(I,!0);r(I),D(()=>V(Q,n(d).event)),k($,I)},g=($,I)=>{{var Q=B=>{var oe=cn(),le=ke(oe),Re=s(le,!0);r(le);var ce=o(le,2);de(ce,"inline",!0),de(ce,"icon","mdi:skip-forward"),D(re=>V(Re,re),[()=>{var re;return ee((re=n(C))==null?void 0:re.display.text,n(d),n(d).bubble_idx)}]),k(B,oe)},F=(B,oe)=>{{var le=ce=>{var re=un(),we=ke(re),Ce=s(we,!0);r(we);var $e=o(we,2);de($e,"inline",!0),de($e,"icon","mdi:arrow-u-down-right-bold"),D(ze=>V(Ce,ze),[()=>{var ze;return ee((ze=n(C))==null?void 0:ze.display.text,n(d),n(d).bubble_idx)}]),k(ce,re)},Re=ce=>{var re=dn(),we=s(re,!0);r(re),D(Ce=>V(we,Ce),[()=>{var Ce;return ee((Ce=n(C))==null?void 0:Ce.display.text,n(d),n(d).bubble_idx)+"<"+n(d).message}]),k(ce,re)};Z(B,ce=>{n(d).message==="Skip"?ce(le):ce(Re,!1)},oe)}};Z($,B=>{n(d).message==="Over"?B(Q):B(F,!1)},I)}};Z(S,$=>{var I;n(d).event==="囁き"&&n(te)!==void 0&&((I=n(d).agents.find(Q=>Q.idx===n(te)))==null?void 0:I.role)!=="WEREWOLF"?$(b):$(g,!1)})}k(M,H)},ie=M=>{var H=fn(),S=s(H);{var b=I=>{var Q=et();D(F=>V(Q,F),[()=>{var F;return ee((F=n(C))==null?void 0:F.display.text,n(d),n(d).from_idx)}]),k(I,Q)},g=(I,Q)=>{{var F=B=>{var oe=et();D(le=>V(oe,le),[()=>{var le;return ee((le=n(C))==null?void 0:le.display.text,n(d),n(d).to_idx)}]),k(B,oe)};Z(I,B=>{(n(d).event==="追放"||n(d).event==="襲撃")&&B(F)},Q)}};Z(S,I=>{n(d).event==="投票"||n(d).event==="占い"?I(b):I(g,!1)})}var $=o(S);r(H),D(()=>V($,` ${n(d).event??""}`)),k(M,H)};Z(K,M=>{n(d).event==="トーク"||n(d).event==="囁き"?M(L):M(ie,!1)})}r(xe),D(()=>Je(xe,1,`btn ${u===x()?"btn-primary":""}`)),k(R,v)}),k(c,_)};Z(w,c=>{j()&&c(N)})}r(y),Se(y,c=>ne=c,()=>ne),r(h),r(A),r(pe),Se(pe,c=>fe=c,()=>fe),r(_e),D(()=>Ve(ve,`width: ${n(se)??""}%`)),ct(W,j,c=>ft(q,c)),k(t,_e),Ge(),i()}Qe(["mousedown","touchstart","click"]);export{Jn as component};
