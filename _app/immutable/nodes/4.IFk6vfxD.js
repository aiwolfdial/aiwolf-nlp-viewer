import{t as G,a as X}from"../chunks/D1-2HBWE.js";import{i as oe}from"../chunks/YxGi1cMD.js";import{p as se,j as W,a3 as fe,ai as ve,x as te,a as ne,aF as ge,s as b,c,r,aH as le,i as t,w as q,$ as me}from"../chunks/CeyBd2Nv.js";import{s as ee}from"../chunks/TjTo9LhE.js";import{e as ce,i as ue}from"../chunks/DRqcREdK.js";import{e as $,h as be}from"../chunks/sQXm3MJV.js";import{a as ae,o as pe}from"../chunks/_skLJMym.js";import{s as Q,t as N,a as z,r as ie,b as re,I as he}from"../chunks/B8prnrLd.js";import{p as xe}from"../chunks/CXWLIbYs.js";import{b as Z}from"../chunks/CE6qI5Vk.js";import{b as ye}from"../chunks/CJbdu2BS.js";import{w as de}from"../chunks/D1A2bqQE.js";/* empty css                */function _e(o,n,e,l){var p=o.__styles??(o.__styles={});p[n]!==e&&(p[n]=e,e==null?o.style.removeProperty(n):o.style.setProperty(n,e,""))}const we={url:"ws://localhost:8080/realtime",token:""};function ke(){const o=localStorage.getItem("realtime-settings");return o?JSON.parse(o):we}const Y=de(ke());Y.subscribe(o=>{localStorage.setItem("realtime-settings",JSON.stringify(o))});var Se=G('<div class="absolute origin-center text-center flex flex-col gap-2 items-center transform-angle svelte-1lpd0gy"><div class="avatar"><div class="w-24 rounded-full ring-offset-base-100 ring ring-offset-2 svelte-1lpd0gy"><img></div></div> <span class="badge"> </span></div>'),Ce=G('<div role="alert" class="alert"><p class="text-lg font-bold"> </p></div> <div class="w-4/5 h-4/5 flex items-center justify-center relative rounded-1/2 box-border m-auto mt-16"><canvas class="w-full h-full absolute top-0 left-0"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-xs shadow-sm overflow-auto p-4 z-1"><div class="card-body"><p class="text-lg text-pretty text-center"> </p></div></div> <!></div> <footer class="footer footer-center text-base-content p-4"><aside><p>イラスト : 石黒正数氏</p></aside></footer>',1);function Ee(o,n){se(n,!0);let e=ge(void 0);const l=Y.subscribe(i=>{W(e,xe(i))});ae(l);let p,v,f,w;pe(()=>(window.addEventListener("resize",A),()=>{window.removeEventListener("resize",A)})),fe(()=>{A()});function A(){if(!p||!v||!f)return;const i=p.getContext("2d"),m=v.getContext("2d");if(!i||!m)return;const T=f.getBoundingClientRect();[p,v].forEach(s=>{s.width=T.width,s.height=T.height;const _=s.getContext("2d");_&&(_.clearRect(0,0,s.width,s.height),_.globalAlpha=1,_.lineWidth=2)}),n.packet.agents.forEach(s=>{const{idx:_,targetIdxs:E=[],isAlive:J,isBubble:R}=s;if(!J)return;const M=document.getElementById(`agent-${_}`);if(!(M instanceof HTMLElement))return;const L=M.getBoundingClientRect(),C=v.getBoundingClientRect(),F=L.left+L.width/2-C.left,V=L.top+L.height/2-C.top;E.forEach(k=>{if(k===-1)return;const u=document.getElementById(`agent-${k}`);if(!(u instanceof HTMLElement))return;const y=u.getBoundingClientRect();d(m,F,V,y.left+y.width/2-C.left,y.top+y.height/2-C.top,!1,getComputedStyle(w).getPropertyValue("background-color"))}),R&&d(i,C.width/2,C.height/2,F,V,!0,getComputedStyle(w).getPropertyValue("background-color"))})}function d(i,m,T,s,_,E,J){const R=E?[0,0,0,0,0,15]:[0,5,-20,5,-20,15];i.strokeStyle=i.fillStyle=J,i.beginPath();let M=s-m,L=_-T,C=Math.sqrt(M*M+L*L),F=L/C,V=M/C,k=[];k.push(0,0);for(let u=0;u<R.length;u+=2){let y=R[u],U=R[u+1];k.push(y<0?C+y:y,U)}k.push(C,0);for(let u=R.length;u>0;u-=2){let y=R[u-2],U=R[u-1];k.push(y<0?C+y:y,-U)}k.push(0,0);for(let u=0;u<k.length;u+=2){let y=k[u]*V-k[u+1]*F+m,U=k[u]*F+k[u+1]*V+T;u===0?i.moveTo(y,U):i.lineTo(y,U)}i.fill()}var g=Ce(),S=ve(g),h=c(S),D=c(h);r(h),r(S);var I=b(S,2),B=c(I);Z(B,i=>p=i,()=>p);var O=b(B,2);Z(O,i=>v=i,()=>v);var a=b(O,2),x=c(a),j=c(x),P=c(j,!0);r(j),r(x),r(a),Z(a,i=>w=i,()=>w);var H=b(a,2);ce(H,17,()=>n.packet.agents,ue,(i,m,T)=>{var s=Se(),_=c(s),E=c(_),J=c(E);r(E),r(_);var R=b(_,2),M=c(R,!0);r(R),r(s),te(L=>{Q(s,"style",`--angle: ${T*(360/n.packet.agents.length)}`),Q(s,"id",`agent-${t(m).idx??""}`),N(E,"ring-success",t(m).isAlive),N(E,"ring-error",!t(m).isAlive),_e(E,"opacity",t(m).isAlive?1:.25),Q(J,"src",`${ye??""}/images/male/${L??""}.png`),Q(J,"alt",t(m).name),ee(M,t(m).name)},[()=>t(m).idx.toString().padStart(2,"0")]),X(i,s)}),r(I),Z(I,i=>f=i,()=>f),le(2),te(()=>{ee(D,`${n.packet.day??""}日目 ${(n.packet.isDay?"昼":"夜")??""}`),a.hidden=!n.packet.message,ee(P,n.packet.message)}),X(o,g),ne()}function Re(){const{subscribe:o,update:n}=de({status:"disconnected",entries:{}});let e=null,l=null;Y.subscribe(f=>{l=f});function p(){if(!l)return;const{url:f,token:w}=l;n(d=>({...d,status:"connecting"}));const A=new URL(f);w&&A.searchParams.set("token",w),e=new WebSocket(A),e.onopen=()=>{n(d=>({...d,status:"connected"}))},e.onclose=()=>{n(d=>({...d,status:"disconnected"})),e=null},e.onerror=()=>{n(d=>({...d,status:"disconnected"})),e=null},e.onmessage=d=>{try{const g=JSON.parse(d.data);n(S=>{const h={...S.entries};return h[g.id]||(h[g.id]=[]),h[g.id].push(g),{...S,entries:h}})}catch(g){console.error("Failed to parse message:",g)}}}function v(){e&&(n(f=>({...f,status:"disconnected"})),e.close(),e=null)}return{subscribe:o,connect:p,disconnect:v,entries:{subscribe:f=>o(w=>f(w.entries))}}}const K=Re();var Ae=G('<div class="navbar bg-base-100 flex justify-start"><h1 class="text-3xl font-bold truncate mx-4">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><div class="status"></div> <div class="status"></div></div></div> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info mx-2">接続</button> <button class="btn btn-error mx-2">切断</button> <label class="flex items-center cursor-pointer gap-2 mx-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Be(o,n){se(n,!1);let e=q(),l=q();const p=Y.subscribe(s=>{W(e,s)}),v=K.subscribe(s=>{W(l,s.status)});ae(()=>{p(),v()});function f(s,_){Y.update(E=>({...E,[s]:_}))}function w(){K.connect()}function A(){K.disconnect()}oe();var d=Ae(),g=b(c(d),2),S=c(g),h=c(S),D=b(h,2);r(S),r(g);var I=b(g,2),B=c(I);z(B,"class","h-[1em] opacity-50"),z(B,"inline",!0),z(B,"icon","mdi:link");var O=b(B,2);ie(O),r(I);var a=b(I,2),x=c(a);z(x,"class","h-[1em] opacity-50"),z(x,"inline",!0),z(x,"icon","mdi:key");var j=b(x,2);ie(j),le(2),r(a);var P=b(a,2),H=b(P,2),i=b(H,2),m=c(i);z(m,"inline",!0),z(m,"icon","mdi:white-balance-sunny");var T=b(m,4);z(T,"inline",!0),z(T,"icon","mdi:moon-and-stars"),r(i),r(d),te(()=>{N(h,"status-success",t(l)==="connected"),N(h,"status-warning",t(l)==="connecting"),N(h,"status-error",t(l)==="disconnected"),N(h,"animate-ping",t(l)==="connected"||t(l)==="connecting"),D.hidden=t(l)==="disconnected",N(D,"status-success",t(l)==="connected"),N(D,"status-warning",t(l)==="connecting"),re(O,t(e).url),re(j,t(e).token),P.disabled=t(l)!=="disconnected",H.disabled=t(l)==="disconnected"}),$("input",O,s=>f("url",s.currentTarget.value)),$("input",j,s=>f("token",s.currentTarget.value)),$("click",P,w),$("click",H,A),X(o,d),ne()}function Pe(o){return Array.from({length:o},(n,e)=>({idx:e+1,name:he(e+1),role:"",isAlive:!0,targetIdxs:[],isBubble:!1}))}var Te=G('<button class="btn"> </button>'),Le=G('<main class="h-screen flex flex-col"><!> <div class="flex flex-1 overflow-hidden w-full flex-col md:flex-row"><div class="flex-auto pt-8 px-8 bg-base-300"><!></div> <div class="w-full md:w-64 max-md:h-32 flex flex-col bg-base-200"><ul class="list overflow-y-auto flex-1 px-1"></ul></div></div></main>');function $e(o,n){se(n,!1);let e=q(""),l=-1,p=q({id:"",idx:-1,day:0,isDay:!0,agents:Pe(5),message:"未接続",summary:"未接続",isDivider:!1}),v=q(),f;const w=K.entries.subscribe(a=>{var x;W(v,a),t(e)===""&&Object.keys(a).length>0&&W(e,Object.keys(a)[0]),l=((x=t(v)[t(e)])==null?void 0:x.length)-1,d(t(e),l)}),A=K.subscribe(a=>{f=a.status});ae(()=>{w(),A()});function d(a,x){t(v)[a]&&(x<0||x>=t(v)[a].length||W(p,t(v)[a][x]))}window.addEventListener("beforeunload",a=>{f==="connecting"&&a.preventDefault()}),oe();var g=Le();be(a=>{me.title="aiwolf-nlp-viewer"});var S=c(g);Be(S,{});var h=b(S,2),D=c(h),I=c(D);Ee(I,{get packet(){return t(p)}}),r(D);var B=b(D,2),O=c(B);ce(O,5,()=>t(v)[t(e)]||[],ue,(a,x,j)=>{var P=Te(),H=c(P);r(P),te(()=>ee(H,`${j+1}. ${t(x).summary??""}`)),$("click",P,()=>d(t(e),j)),X(a,P)}),r(O),r(B),r(h),r(g),X(o,g),ne()}export{$e as component};
