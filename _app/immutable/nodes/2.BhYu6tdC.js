import{b as vt,e as St,a as S,t as D}from"../chunks/disclose-version.Aq8ZEj2B.js";import{i as bt}from"../chunks/legacy.DBkgwB2Y.js";import{v as B,L as tt,a5 as mt,a4 as Dt,I as it,m as It,H as Et,am as yt,J as Nt,K as ct,M as st,w as P,ai as Mt,at as et,N as kt,n as lt,O as Ot,D as ut,au as Vt,av as Ct,al as Ht,aw as Ft,q as At,a9 as Ut,a3 as Wt,z as dt,ax as Bt,ay as Gt,az as Yt,af as wt,aj as zt,ah as Kt,G as qt,aA as Jt,p as Lt,c,r as i,s as b,t as C,a as Tt,h as x,aB as Z,aC as Pt,aD as ft,aE as _t,B as q}from"../chunks/runtime.CzbUD4B0.js";import{a as H,d as Xt,e as J}from"../chunks/store.B5d2yPhV.js";import{p as nt,i as U}from"../chunks/props.1aHTRxO7.js";import{b as $t}from"../chunks/paths.Cm5lRztd.js";function X(a,t){return t}function Qt(a,t,e,r){for(var l=[],s=t.length,o=0;o<s;o++)Ct(t[o].e,l,!0);var d=s>0&&l.length===0&&e!==null;if(d){var _=e.parentNode;Ht(_),_.append(e),r.clear(),Y(a,t[0].prev,t[s-1].next)}Ft(l,()=>{for(var A=0;A<s;A++){var u=t[A];d||(r.delete(u.k),Y(a,u.prev,u.next)),At(u.e,!d)}})}function $(a,t,e,r,l,s=null){var o=a,d={flags:t,items:new Map,first:null};{var _=a;o=B?tt(mt(_)):_.appendChild(Dt())}B&&it();var A=null,u=!1;It(()=>{var I=e(),v=Et(I)?I:I==null?[]:yt(I),n=v.length;if(u&&n===0)return;u=n===0;let p=!1;if(B){var N=o.data===Nt;N!==(n===0)&&(o=ct(),tt(o),st(!1),p=!0)}if(B){for(var w=null,g,E=0;E<n;E++){if(P.nodeType===8&&P.data===Mt){o=P,p=!0,st(!1);break}var O=v[E],y=r(O,E);g=Rt(P,d,w,null,O,y,E,l,t),d.items.set(y,g),w=g}n>0&&tt(ct())}if(!B){var T=Ut;Zt(v,d,o,l,t,(T.f&et)!==0,r)}s!==null&&(n===0?A?kt(A):A=lt(()=>s(o)):A!==null&&Ot(A,()=>{A=null})),p&&st(!0),e()}),B&&(o=P)}function Zt(a,t,e,r,l,s,o){var d=a.length,_=t.items,A=t.first,u=A,I,v=null,n=[],p=[],N,w,g,E;for(E=0;E<d;E+=1){if(N=a[E],w=o(N,E),g=_.get(w),g===void 0){var O=u?u.e.nodes_start:e;v=Rt(O,t,v,v===null?t.first:v.next,N,w,E,r,l),_.set(w,v),n=[],p=[],u=v.next;continue}if(jt(g,N,E),g.e.f&et&&kt(g.e),g!==u){if(I!==void 0&&I.has(g)){if(n.length<p.length){var y=p[0],T;v=y.prev;var z=n[0],K=n[n.length-1];for(T=0;T<n.length;T+=1)gt(n[T],y,e);for(T=0;T<p.length;T+=1)I.delete(p[T]);Y(t,z.prev,K.next),Y(t,v,z),Y(t,K,y),u=y,v=K,E-=1,n=[],p=[]}else I.delete(g),gt(g,u,e),Y(t,g.prev,g.next),Y(t,g,v===null?t.first:v.next),Y(t,v,g),v=g;continue}for(n=[],p=[];u!==null&&u.k!==w;)(s||!(u.e.f&et))&&(I??(I=new Set)).add(u),p.push(u),u=u.next;if(u===null)continue;g=u}n.push(g),v=g,u=g.next}if(u!==null||I!==void 0){for(var Q=I===void 0?[]:yt(I);u!==null;)(s||!(u.e.f&et))&&Q.push(u),u=u.next;var at=Q.length;if(at>0){var f=d===0?e:null;Qt(t,Q,f,_)}}ut.first=t.first&&t.first.e,ut.last=v&&v.e}function jt(a,t,e,r){Vt(a.v,t),a.i=e}function Rt(a,t,e,r,l,s,o,d,_){var A=(_&Gt)!==0,u=(_&Yt)===0,I=A?u?Wt(l):dt(l):l,v=_&Bt?dt(o):o,n={i:v,v:I,k:s,a:null,e:null,prev:e,next:r};try{return n.e=lt(()=>d(a,I,v),B),n.e.prev=e&&e.e,n.e.next=r&&r.e,e===null?t.first=n:(e.next=n,e.e.next=n.e),r!==null&&(r.prev=n,r.e.prev=n.e),n}finally{}}function gt(a,t,e){for(var r=a.next?a.next.e.nodes_start:e,l=t?t.e.nodes_start:e,s=a.e.nodes_start;s!==r;){var o=wt(s);l.before(s),s=o}}function Y(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function te(a,t,e,r,l){var s=a,o="",d;It(()=>{if(o===(o=t()??"")){B&&it();return}d!==void 0&&(At(d),d=void 0),o!==""&&(d=lt(()=>{if(B){P.data;for(var _=it(),A=_;_!==null&&(_.nodeType!==8||_.data!=="");)A=_,_=wt(_);if(_===null)throw zt(),Kt;vt(P,A),s=tt(_);return}var u=o+"",I=St(u);vt(mt(I),I.lastChild),s.before(I)}))})}function ee(a,t,e,r){var l=a.__attributes??(a.__attributes={});B&&(l[t]=a.getAttribute(t),a.nodeName==="LINK")||l[t]!==(l[t]=e)&&(e==null?a.removeAttribute(t):typeof e!="string"&&ae(a).includes(t)?a[t]=e:a.setAttribute(t,e))}var ht=new Map;function ae(a){var t=ht.get(a.nodeName);if(t)return t;ht.set(a.nodeName,t=[]);for(var e,r=a,l=Element.prototype;l!==r;){e=Jt(r);for(var s in e)e[s].set&&t.push(s);r=qt(r)}return t}function ot(a,t,e){if(e){if(a.classList.contains(t))return;a.classList.add(t)}else{if(!a.classList.contains(t))return;a.classList.remove(t)}}function j(a){return function(...t){var e=t[0];return e.preventDefault(),a==null?void 0:a.apply(this,t)}}function pt(a,t){var s;var e=(s=a.$$events)==null?void 0:s[t.type],r=Et(e)?e.slice():e==null?[]:[e];for(var l of r)l.call(this,t)}const re={VILLAGER:"村人",SEER:"占い師",MEDIUM:"霊能者",BODYGUARD:"騎士",WEREWOLF:"人狼",POSSESSED:"狂人"},se={ALIVE:"生存",DEAD:"死亡"},ne={HUMAN:"人間",WEREWOLF:"人狼"},ie={VILLAGER:"村人陣営",WEREWOLF:"人狼陣営"};function xt(a){const t={};return a.forEach(e=>{const[r,l,...s]=e.split(",");t[r]||(t[r]=oe()),le(t[r],l,s)}),t}function oe(){return{agents:{},talks:[],votes:[],execution:null,divine:null,attackVotes:[],attack:null,result:null}}function le(a,t,e){const l={status:([s,o,d,_])=>{a.agents[s]={role:o,status:d,name:_}},talk:([s,o,d,_])=>{a.talks.push({talkIdx:s,turnIdx:o,agentIdx:d,text:_})},vote:([s,o])=>{a.votes.push({agentIdx:s,targetIdx:o})},execute:([s,o])=>{a.execution={agentIdx:s,role:o}},divine:([s,o,d])=>{a.divine={agentIdx:s,targetIdx:o,result:d}},attackVote:([s,o])=>{a.attackVotes.push({agentIdx:s,targetIdx:o})},attack:([s,o])=>{a.attack={targetIdx:s,isSuccessful:o==="true"}},result:([s,o,d])=>{a.result={villagers:s,werewolves:o,winSide:d}}}[t];l&&l(e)}function W(a,t,e){var l;const r=(l=a[t])==null?void 0:l.agents[e];return`Agent[${e}]`}function ve(a){const t=a.match(/>>Agent\[\d+\]/);return t?a.replace(t[0],`<strong>${t[0]}</strong>`).trim():a.trim()}var ce=D("<li><strong> </strong> </li>"),ue=D('<section class="agent-section"><h3>エージェント</h3> <ul></ul></section>'),de=D('<div class="talk"><strong> </strong> <!></div>'),fe=D('<section class="talks-section"><h3>会話</h3> <div class="talks"></div></section>'),_e=D("<li><strong> </strong> が <strong> </strong> に投票</li>"),ge=D('<section class="votes-section"><h3>投票</h3> <ul></ul></section>'),he=D('<section class="execution-section"><h3>追放</h3> <p><strong> </strong> を追放</p></section>'),pe=D("<li><strong> </strong> が <strong> </strong> に投票</li>"),xe=D('<section class="attack-votes-section"><h3>襲撃投票</h3> <ul></ul></section>'),be=D("<p><strong> </strong> を襲撃: <strong> </strong></p>"),me=D("<p>襲撃対象なし</p>"),Ie=D('<section class="attack-section"><h3>襲撃</h3> <!></section>'),Ee=D('<section class="divine-section"><h3>占い</h3> <p><strong> </strong> が <strong> </strong> を占い: <strong> </strong></p></section>'),ye=D('<section class="result-section"><h3>結果</h3> <p><strong> </strong> が勝利</p></section>'),ke=D('<div class="day-column"><div class="day-section"><h2> </h2> <div class="scrollable-content"><!> <!> <!> <!> <!> <!> <!> <!></div></div></div>');function Ae(a,t){Lt(t,!1);let e=nt(t,"dayIdx",8),r=nt(t,"dayStatus",8),l=nt(t,"dayStatuses",8);bt();var s=ke(),o=c(s),d=c(o),_=c(d);i(d);var A=b(d,2),u=c(A);{var I=f=>{var h=ue(),L=b(c(h),2);$(L,5,()=>Object.entries(r().agents),X,(M,R)=>{let m=()=>x(R)[0],k=()=>x(R)[1];var V=ce(),F=c(V),G=c(F,!0);C(()=>H(G,W(l(),e(),m()))),i(F);var rt=b(F);i(V),C(()=>{ot(V,"over",k().status!=="ALIVE"),H(rt,` ${re[k().role]??"NULL"??""} -
                ${se[k().status]??"NULL"??""}`)}),S(M,V)}),i(L),i(h),S(f,h)};U(u,f=>{Object.keys(r().agents).length>0&&f(I)})}var v=b(u,2);{var n=f=>{var h=fe(),L=b(c(h),2);$(L,5,()=>r().talks,X,(M,R)=>{var m=de(),k=c(m),V=c(k,!0);C(()=>H(V,W(l(),e(),x(R).agentIdx))),i(k);var F=b(k,2);te(F,()=>ve(x(R).text)),i(m),C(()=>ot(m,"over",x(R).text==="Over")),S(M,m)}),i(L),i(h),S(f,h)};U(v,f=>{r().talks.length>0&&f(n)})}var p=b(v,2);{var N=f=>{var h=ge(),L=b(c(h),2);$(L,5,()=>r().votes,X,(M,R)=>{var m=_e(),k=c(m),V=c(k,!0);C(()=>H(V,W(l(),e(),x(R).agentIdx))),i(k);var F=b(k,2),G=c(F,!0);C(()=>H(G,W(l(),e(),x(R).targetIdx))),i(F),Z(),i(m),S(M,m)}),i(L),i(h),S(f,h)};U(p,f=>{r().votes.length>0&&f(N)})}var w=b(p,2);{var g=f=>{var h=he(),L=b(c(h),2),M=c(L),R=c(M,!0);C(()=>H(R,W(l(),e(),r().execution.agentIdx))),i(M),Z(),i(L),i(h),S(f,h)};U(w,f=>{r().execution&&f(g)})}var E=b(w,2);{var O=f=>{var h=xe(),L=b(c(h),2);$(L,5,()=>r().attackVotes,X,(M,R)=>{var m=pe(),k=c(m),V=c(k,!0);C(()=>H(V,W(l(),e(),x(R).agentIdx))),i(k);var F=b(k,2),G=c(F,!0);C(()=>H(G,W(l(),e(),x(R).targetIdx))),i(F),Z(),i(m),S(M,m)}),i(L),i(h),S(f,h)};U(E,f=>{r().attackVotes.length>0&&f(O)})}var y=b(E,2);{var T=f=>{var h=Ie(),L=b(c(h),2);{var M=m=>{var k=be(),V=c(k),F=c(V,!0);C(()=>H(F,W(l(),e(),r().attack.targetIdx))),i(V);var G=b(V,2),rt=c(G,!0);i(G),i(k),C(()=>H(rt,r().attack.isSuccessful?"成功":"失敗")),S(m,k)},R=m=>{var k=me();S(m,k)};U(L,m=>{r().attack.targetIdx!=="-1"?m(M):m(R,!1)})}i(h),S(f,h)};U(y,f=>{r().attack&&f(T)})}var z=b(y,2);{var K=f=>{var h=Ee(),L=b(c(h),2),M=c(L),R=c(M,!0);C(()=>H(R,W(l(),e(),r().divine.agentIdx))),i(M);var m=b(M,2),k=c(m,!0);C(()=>H(k,W(l(),e(),r().divine.targetIdx))),i(m);var V=b(m,2),F=c(V,!0);i(V),i(L),i(h),C(()=>H(F,ne[r().divine.result]??"NULL")),S(f,h)};U(z,f=>{r().divine&&f(K)})}var Q=b(z,2);{var at=f=>{var h=ye(),L=b(c(h),2),M=c(L),R=c(M,!0);i(M),Z(),i(L),i(h),C(()=>H(R,ie[r().result.winSide])),S(f,h)};U(Q,f=>{r().result&&f(at)})}i(A),i(o),i(s),C(()=>H(_,`Day ${e()??""}`)),S(a,s),Tt()}var we=D('<link rel="stylesheet">'),Le=D('<div tabindex="0" class="file-input-container" role="button"><label class="file-input-label"><input type="file" accept=".log" multiple> <span>ファイルを選択もしくはドラッグアンドドロップしてください</span></label></div>'),Te=D('<div class="tab-wrapper"><button class="tab-button"> </button> <button class="close-button" aria-label="Close tab">✕</button></div>'),Re=D('<div class="log-container"><div class="tabs-container"><div class="tabs"></div></div> <div class="days-container"></div></div>'),Se=D('<main><pre class="title">aiwolf-nlp-viewer</pre> <!> <!></main>');function He(a,t){Lt(t,!1);let e=_t([]),r=_t(0);function l(v){const n=v.target;Array.from(n.files||[]).forEach(N=>{const w=new FileReader;w.onload=g=>{var y;const O=(((y=g.target)==null?void 0:y.result)??"").split(`
`).filter(T=>T.trim());q(e,[...x(e),{name:N.name,data:O,processed:xt(O)}]),q(r,x(e).length-1)},w.readAsText(N)})}function s(v){var p;Array.from(((p=v.dataTransfer)==null?void 0:p.files)||[]).forEach(N=>{const w=new FileReader;w.onload=g=>{var y;const O=(((y=g.target)==null?void 0:y.result)??"").split(`
`).filter(T=>T.trim());q(e,[...x(e),{name:N.name,data:O,processed:xt(O)}]),q(r,x(e).length-1)},w.readAsText(N)})}function o(v){q(e,x(e).filter((n,p)=>p!==v)),x(r)>=x(e).length&&q(r,x(e).length-1)}bt();var d=Se();Xt(v=>{var n=we();Pt.title="aiwolf-nlp-viewer",ee(n,"href",`${$t??""}/global.css`),S(v,n)}),J("dragover",ft,j(function(v){pt.call(this,t,v)})),J("drop",ft,j(s));var _=b(c(d),2);{var A=v=>{var n=Le(),p=c(n),N=c(p);Z(2),i(p),i(n),J("change",N,l),J("dragover",n,j(function(w){pt.call(this,t,w)})),J("drop",n,j(s)),S(v,n)};U(_,v=>{x(e).length===0&&v(A)})}var u=b(_,2);{var I=v=>{var n=Re(),p=c(n),N=c(p);$(N,5,()=>x(e),X,(g,E,O)=>{var y=Te(),T=c(y),z=c(T,!0);i(T);var K=b(T,2);i(y),C(()=>{ot(y,"active",x(r)===O),H(z,x(E).name)}),J("click",T,()=>q(r,O)),J("click",K,()=>o(O)),S(g,y)}),i(N),i(p);var w=b(p,2);$(w,5,()=>Object.entries(x(e)[x(r)].processed),X,(g,E)=>{let O=()=>x(E)[0],y=()=>x(E)[1];Ae(g,{get dayIdx(){return O()},get dayStatus(){return y()},get dayStatuses(){return x(e)[x(r)].processed}})}),i(w),i(n),S(v,n)};U(u,v=>{x(e).length>0&&v(I)})}i(d),S(a,d),Tt()}export{He as component};
