import{b as ie,d as De,a as L,t as R}from"../chunks/disclose-version.0HFg1qD0.js";import{i as ge}from"../chunks/legacy.C6KCpk-9.js";import{v as M,L as P,a5 as pe,a4 as Le,I as re,m as me,H as xe,am as be,J as Re,K as le,M as te,w as U,ai as Ne,ao as Q,N as ye,n as ne,O as Oe,D as oe,ap as Se,aq as $e,al as Me,ar as Ve,q as Ee,a9 as Ce,a3 as He,z as ve,as as Fe,at as Ye,au as qe,af as Ae,aj as ze,ah as Be,G as Ge,av as Ue,p as ke,c as m,r as g,s as w,t as S,h,a as we,a1 as z,aw as We,ax as ce,ay as Ke,f as Xe,az as ue,B}from"../chunks/runtime.BQMbqn8H.js";import{a as V,h as Je,e as G}from"../chunks/store.BFak2Tfs.js";import{p as ae,i as C}from"../chunks/props.E7He8GK1.js";import{b as Pe}from"../chunks/paths.D18sUmIB.js";function Z(a,e){return e}function Qe(a,e,t,r){for(var o=[],s=e.length,i=0;i<s;i++)$e(e[i].e,o,!0);var f=s>0&&o.length===0&&t!==null;if(f){var d=t.parentNode;Me(d),d.append(t),r.clear(),H(a,e[0].prev,e[s-1].next)}Ve(o,()=>{for(var b=0;b<s;b++){var c=e[b];f||(r.delete(c.k),H(a,c.prev,c.next)),Ee(c.e,!f)}})}function j(a,e,t,r,o,s=null){var i=a,f={flags:e,items:new Map,first:null};{var d=a;i=M?P(pe(d)):d.appendChild(Le())}M&&re();var b=null,c=!1;me(()=>{var x=t(),l=xe(x)?x:x==null?[]:be(x),n=l.length;if(c&&n===0)return;c=n===0;let p=!1;if(M){var k=i.data===Re;k!==(n===0)&&(i=le(),P(i),te(!1),p=!0)}if(M){for(var y=null,_,E=0;E<n;E++){if(U.nodeType===8&&U.data===Ne){i=U,p=!0,te(!1);break}var I=l[E],v=r(I,E);_=Ie(U,f,y,null,I,v,E,o,e),f.items.set(v,_),y=_}n>0&&P(le())}if(!M){var u=Ce;Ze(l,f,i,o,e,(u.f&Q)!==0,r)}s!==null&&(n===0?b?ye(b):b=ne(()=>s(i)):b!==null&&Oe(b,()=>{b=null})),p&&te(!0),t()}),M&&(i=U)}function Ze(a,e,t,r,o,s,i){var f=a.length,d=e.items,b=e.first,c=b,x,l=null,n=[],p=[],k,y,_,E;for(E=0;E<f;E+=1){if(k=a[E],y=i(k,E),_=d.get(y),_===void 0){var I=c?c.e.nodes_start:t;l=Ie(I,e,l,l===null?e.first:l.next,k,y,E,r,o),d.set(y,l),n=[],p=[],c=l.next;continue}if(je(_,k,E),_.e.f&Q&&ye(_.e),_!==c){if(x!==void 0&&x.has(_)){if(n.length<p.length){var v=p[0],u;l=v.prev;var A=n[0],T=n[n.length-1];for(u=0;u<n.length;u+=1)fe(n[u],v,t);for(u=0;u<p.length;u+=1)x.delete(p[u]);H(e,A.prev,T.next),H(e,l,A),H(e,T,v),c=v,l=T,E-=1,n=[],p=[]}else x.delete(_),fe(_,c,t),H(e,_.prev,_.next),H(e,_,l===null?e.first:l.next),H(e,l,_),l=_;continue}for(n=[],p=[];c!==null&&c.k!==y;)(s||!(c.e.f&Q))&&(x??(x=new Set)).add(c),p.push(c),c=c.next;if(c===null)continue;_=c}n.push(_),l=_,c=_.next}if(c!==null||x!==void 0){for(var N=x===void 0?[]:be(x);c!==null;)(s||!(c.e.f&Q))&&N.push(c),c=c.next;var F=N.length;if(F>0){var Y=f===0?t:null;Qe(e,N,Y,d)}}oe.first=e.first&&e.first.e,oe.last=l&&l.e}function je(a,e,t,r){Se(a.v,e),a.i=t}function Ie(a,e,t,r,o,s,i,f,d){var b=(d&Ye)!==0,c=(d&qe)===0,x=b?c?He(o):ve(o):o,l=d&Fe?ve(i):i,n={i:l,v:x,k:s,a:null,e:null,prev:t,next:r};try{return n.e=ne(()=>f(a,x,l),M),n.e.prev=t&&t.e,n.e.next=r&&r.e,t===null?e.first=n:(t.next=n,t.e.next=n.e),r!==null&&(r.prev=n,r.e.prev=n.e),n}finally{}}function fe(a,e,t){for(var r=a.next?a.next.e.nodes_start:t,o=e?e.e.nodes_start:t,s=a.e.nodes_start;s!==r;){var i=Ae(s);o.before(s),s=i}}function H(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function et(a,e,t,r,o){var s=a,i="",f;me(()=>{if(i===(i=e()??"")){M&&re();return}f!==void 0&&(Ee(f),f=void 0),i!==""&&(f=ne(()=>{if(M){U.data;for(var d=re(),b=d;d!==null&&(d.nodeType!==8||d.data!=="");)b=d,d=Ae(d);if(d===null)throw ze(),Be;ie(U,b),s=P(d);return}var c=i+"",x=De(c);ie(pe(x),x.lastChild),s.before(x)}))})}function tt(a,e,t,r){var o=a.__attributes??(a.__attributes={});M&&(o[e]=a.getAttribute(e),a.nodeName==="LINK")||o[e]!==(o[e]=t)&&(t==null?a.removeAttribute(e):typeof t!="string"&&at(a).includes(e)?a[e]=t:a.setAttribute(e,t))}var de=new Map;function at(a){var e=de.get(a.nodeName);if(e)return e;de.set(a.nodeName,e=[]);for(var t,r=a,o=Element.prototype;o!==r;){t=Ue(r);for(var s in t)t[s].set&&e.push(s);r=Ge(r)}return e}function se(a,e,t){if(t){if(a.classList.contains(e))return;a.classList.add(e)}else{if(!a.classList.contains(e))return;a.classList.remove(e)}}function J(a){return function(...e){var t=e[0];return t.preventDefault(),a==null?void 0:a.apply(this,e)}}function _e(a,e){var s;var t=(s=a.$$events)==null?void 0:s[e.type],r=xe(t)?t.slice():t==null?[]:[t];for(var o of r)o.call(this,e)}function he(a){const e={};return a.forEach(t=>{const[r,o,...s]=t.split(",");e[r]||(e[r]=rt()),st(e[r],o,s)}),e}function rt(){return{status:{},talks:[],votes:[],execution:null,divine:null,attackVotes:[],attack:null,result:null}}function st(a,e,t){const o={status:([s,i,f,d])=>{a.status[s]={role:i,status:f,name:d}},talk:([s,i,f,d])=>{a.talks.push({talkIdx:s,turn:i,agentIdx:f,text:d})},vote:([s,i])=>{a.votes.push({voteAgentIdx:s,targetAgentIdx:i})},execute:([s,i])=>{a.execution={agentIdx:s,role:i}},divine:([s,i,f])=>{a.divine={agentIdx:s,targetAgentIdx:i,result:f}},attackVote:([s,i])=>{a.attackVotes.push({voteAgentIdx:s,targetAgentIdx:i})},attack:([s,i])=>{a.attack={agentIdx:s,isSuccessful:i==="true"}},result:([s,i,f])=>{a.result={villagers:s,werewolves:i,winSide:f}}}[e];o&&o(t)}function K(a,e,t){var o;const r=(o=a[e])==null?void 0:o.status[t];return r?`Agent[${t}] (${r.name})`:`Agent[${t}]`}function nt(a){const e=a.match(/>>Agent\[\d+\]/);return e?a.replace(e[0],`<strong>${e[0]}</strong>`).trim():a.trim()}var it=R("<li><strong> </strong> </li>"),lt=R('<section class="status-section"><h3>エージェント</h3> <ul></ul></section>'),ot=R('<div class="divine-section"><h3>占い結果</h3> <p> </p></div>'),vt=R('<div class="attack-section"><h3>襲撃結果</h3> <p> </p></div>'),ct=R('<div class="execution-section"><h3>追放結果</h3> <p> </p></div>'),ut=R('<section class="game-events"><!> <!> <!></section>'),ft=R('<div class="talk"><strong> </strong> <!></div>'),dt=R('<section class="game-result-section"><h3>ゲーム結果</h3> <p> </p></section>'),_t=R('<div class="day-column"><div class="day-section"><h2> </h2> <div class="scrollable-content"><!> <!> <section class="talks-section"><h3>会話ログ</h3> <div class="talks"></div></section> <!></div></div></div>');function ht(a,e){ke(e,!1);let t=ae(e,"day",8),r=ae(e,"dayLog",8),o=ae(e,"processedLogs",8);function s(v){switch(v){case"VILLAGER":return"村人";case"SEER":return"占い師";case"MEDIUM":return"霊能者";case"BODYGUARD":return"狩人";case"WEREWOLF":return"人狼";case"POSSESSED":return"狂人";case"FOX":return"妖狐";default:return v}}function i(v){switch(v){case"ALIVE":return"生存";case"DEAD":return"死亡";default:return v}}ge();var f=_t(),d=m(f),b=m(d),c=m(b);g(b);var x=w(b,2),l=m(x);{var n=v=>{var u=lt(),A=w(m(u),2);j(A,5,()=>Object.entries(r().status),Z,(T,N)=>{let F=()=>h(N)[0],Y=()=>h(N)[1];var W=it(),D=m(W),O=m(D,!0);S(()=>V(O,K(o(),t(),F()))),g(D);const $=z(()=>s(Y().role)??""),q=z(()=>i(Y().status)??"");var X=w(D);S(()=>V(X,` ${h($)} -
                ${h(q)}`)),g(W),S(()=>se(W,"over",Y().status!=="ALIVE")),L(T,W)}),g(A),g(u),L(v,u)};C(l,v=>{Object.keys(r().status).length>0&&v(n)})}var p=w(l,2);{var k=v=>{var u=ut(),A=m(u);{var T=D=>{var O=ot(),$=w(m(O),2);const q=z(()=>K(o(),t(),r().divine.agentIdx)??""),X=z(()=>K(o(),t(),r().divine.targetAgentIdx)??""),ee=z(()=>r().divine.result??"");var Te=m($);S(()=>V(Te,`${h(q)} が
                ${h(X)}
                を占った結果:
                ${h(ee)}`)),g($),g(O),L(D,O)};C(A,D=>{r().divine&&D(T)})}var N=w(A,2);{var F=D=>{var O=vt(),$=w(m(O),2),q=m($);S(()=>V(q,`${K(o(),t(),r().attack.agentIdx)??""} への襲撃:
                ${(r().attack.isSuccessful?"成功":"失敗")??""}`)),g($),g(O),L(D,O)};C(N,D=>{r().attack&&D(F)})}var Y=w(N,2);{var W=D=>{var O=ct(),$=w(m(O),2);const q=z(()=>K(o(),t(),r().execution.agentIdx)??""),X=z(()=>s(r().execution.role)??"");var ee=m($);S(()=>V(ee,`${h(q)} が追放されました
                (役職: ${h(X)})`)),g($),g(O),L(D,O)};C(Y,D=>{r().execution&&D(W)})}g(u),L(v,u)};C(p,v=>{(r().divine||r().attack||r().execution)&&v(k)})}var y=w(p,2),_=w(m(y),2);j(_,5,()=>r().talks,Z,(v,u)=>{var A=ft(),T=m(A),N=m(T,!0);S(()=>V(N,K(o(),t(),h(u).agentIdx))),g(T);var F=w(T,2);et(F,()=>nt(h(u).text)),g(A),S(()=>se(A,"over",h(u).text==="Over")),L(v,A)}),g(_),g(y);var E=w(y,2);{var I=v=>{var u=dt(),A=w(m(u),2),T=m(A);g(A),g(u),S(()=>V(T,`村人: ${r().result.villagers??""}人 人狼: ${r().result.werewolves??""}人
            勝利陣営: ${r().result.winSide??""}`)),L(v,u)};C(E,v=>{r().result&&v(I)})}g(x),g(d),g(f),S(()=>V(c,`Day ${t()??""}`)),L(a,f),we()}var gt=R('<link rel="stylesheet">'),pt=R('<div tabindex="0" class="file-input-container" role="button"><label class="file-input-label"><input type="file" accept=".log" multiple> <span>ファイルを選択もしくはドラッグアンドドロップしてください</span></label></div>'),mt=R('<div class="tab-wrapper"><button class="tab-button"> </button> <button class="close-button" aria-label="Close tab">✕</button></div>'),xt=R('<div class="tabs-container"><div class="tabs"></div></div> <div class="werewolf-log-viewer"><div class="days-container"></div></div>',1),bt=R('<main><pre class="title">aiwolf-nlp-server</pre> <!> <!></main>');function Tt(a,e){ke(e,!1);let t=ue([]),r=ue(0);function o(l){const n=l.target;Array.from(n.files||[]).forEach(k=>{const y=new FileReader;y.onload=_=>{var v;const I=(((v=_.target)==null?void 0:v.result)??"").split(`
`).filter(u=>u.trim());B(t,[...h(t),{name:k.name,data:I,processed:he(I)}]),B(r,h(t).length-1)},y.readAsText(k)})}function s(l){var p;Array.from(((p=l.dataTransfer)==null?void 0:p.files)||[]).forEach(k=>{const y=new FileReader;y.onload=_=>{var v;const I=(((v=_.target)==null?void 0:v.result)??"").split(`
`).filter(u=>u.trim());B(t,[...h(t),{name:k.name,data:I,processed:he(I)}]),B(r,h(t).length-1)},y.readAsText(k)})}function i(l){B(t,h(t).filter((n,p)=>p!==l)),h(r)>=h(t).length&&B(r,h(t).length-1)}ge();var f=bt();Je(l=>{var n=gt();We.title="AIWolf Log Viewer",tt(n,"href",`${Pe??""}/global.css`),L(l,n)}),G("dragover",ce,J(function(l){_e.call(this,e,l)})),G("drop",ce,J(s));var d=w(m(f),2);{var b=l=>{var n=pt(),p=m(n),k=m(p);Ke(2),g(p),g(n),G("change",k,o),G("dragover",n,J(function(y){_e.call(this,e,y)})),G("drop",n,J(s)),L(l,n)};C(d,l=>{h(t).length===0&&l(b)})}var c=w(d,2);{var x=l=>{var n=xt(),p=Xe(n),k=m(p);j(k,5,()=>h(t),Z,(E,I,v)=>{var u=mt(),A=m(u),T=m(A,!0);g(A);var N=w(A,2);g(u),S(()=>{se(u,"active",h(r)===v),V(T,h(I).name)}),G("click",A,()=>B(r,v)),G("click",N,()=>i(v)),L(E,u)}),g(k),g(p);var y=w(p,2),_=m(y);j(_,5,()=>Object.entries(h(t)[h(r)].processed),Z,(E,I)=>{let v=()=>h(I)[0],u=()=>h(I)[1];ht(E,{get day(){return v()},get dayLog(){return u()},get processedLogs(){return h(t)[h(r)].processed}})}),g(_),g(y),L(l,n)};C(c,l=>{h(t).length>0&&l(x)})}g(f),L(a,f),we()}export{Tt as component};
