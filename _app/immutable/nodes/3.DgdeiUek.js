var st=Object.defineProperty;var it=(r,e,l)=>e in r?st(r,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[e]=l;var Pe=(r,e,l)=>it(r,typeof e!="symbol"?e+"":e,l);import{t as f,a as c,c as oe}from"../chunks/DZZmuuX7.js";import{e as Ce,u as ot,p as je,i as be,aG as he,c as a,d as y,r as t,a as qe,f as L,s as n,aI as ve,t as U,h as Ve,$ as lt}from"../chunks/GgKHaYu0.js";import{h as ct}from"../chunks/DzLYAf1N.js";import{i as R}from"../chunks/DZaBf__1.js";import{p as ke}from"../chunks/Dp0dL1if.js";import{a as at,s as ce,b as Le}from"../chunks/Drh9bN7Z.js";import{p as vt}from"../chunks/D2DnKdTD.js";import{w as ie}from"../chunks/Bdk12Bmn.js";import{a as ee,b as Se,c as Oe,d as Ae,e as Ne,f as Me,S as pe,D as Ue,g as ut}from"../chunks/BON7M-IV.js";import{o as De,a as Re}from"../chunks/13KfLqIi.js";/* empty css                */import{d as rt,s as m}from"../chunks/B8d4Zkqd.js";import{e as de,i as fe}from"../chunks/CFxjjtNT.js";import{r as ye,s as re,a as ue,c as Ee,d as Fe}from"../chunks/sI1lmN0c.js";import{b as ze}from"../chunks/CydVBU-2.js";import{b as Ge}from"../chunks/CTIVbONc.js";import{b as Qe}from"../chunks/xupyKZQP.js";function Xe(r,e,l){Ce(()=>{var A=ot(()=>e(r,l==null?void 0:l())||{});if(A!=null&&A.destroy)return()=>A.destroy()})}class We{static fromJson(e){return _t(JSON.parse(e),He("AgentSettings"))}static toJson(e){return JSON.stringify(gt(e,He("AgentSettings")),null,2)}}function xe(r,e,l,A=""){const G=Ze(r),Y=A?` on ${A}`:"",B=l?` for key "${l}"`:"";throw Error(`Invalid value${B}${Y}. Expected ${G} but got ${JSON.stringify(e)}`)}function Ze(r){return Array.isArray(r)?r.length===2&&r[0]===void 0?`an optional ${Ze(r[1])}`:`one of [${r.map(e=>Ze(e)).join(", ")}]`:typeof r=="object"&&r.literal!==void 0?r.literal:typeof r}function dt(r){if(r.jsonToJS===void 0){const e={};r.props.forEach(l=>e[l.json]={key:l.js,typ:l.typ}),r.jsonToJS=e}return r.jsonToJS}function ft(r){if(r.jsToJSON===void 0){const e={};r.props.forEach(l=>e[l.js]={key:l.json,typ:l.typ}),r.jsToJSON=e}return r.jsToJSON}function Ie(r,e,l,A="",G=""){function Y(u,j){return typeof u==typeof j?j:xe(u,j,A,G)}function B(u,j){const k=u.length;for(let g=0;g<k;g++){const O=u[g];try{return Ie(j,O,l)}catch{}}return xe(u,j,A,G)}function te(u,j){return u.indexOf(j)!==-1?j:xe(u.map(k=>Je(k)),j,A,G)}function N(u,j){return Array.isArray(j)?j.map(k=>Ie(k,u,l)):xe(Je("array"),j,A,G)}function b(u){if(u===null)return null;const j=new Date(u);return isNaN(j.valueOf())?xe(Je("Date"),u,A,G):j}function S(u,j,k){if(k===null||typeof k!="object"||Array.isArray(k))return xe(Je(K||"object"),k,A,G);const g={};return Object.getOwnPropertyNames(u).forEach(O=>{const q=u[O],$=Object.prototype.hasOwnProperty.call(k,O)?k[O]:void 0;g[q.key]=Ie($,q.typ,l,O,K)}),Object.getOwnPropertyNames(k).forEach(O=>{Object.prototype.hasOwnProperty.call(u,O)||(g[O]=Ie(k[O],j,l,O,K))}),g}if(e==="any")return r;if(e===null)return r===null?r:xe(e,r,A,G);if(e===!1)return xe(e,r,A,G);let K;for(;typeof e=="object"&&e.ref!==void 0;)K=e.ref,e=mt[e.ref];return Array.isArray(e)?te(e,r):typeof e=="object"?e.hasOwnProperty("unionMembers")?B(e.unionMembers,r):e.hasOwnProperty("arrayItems")?N(e.arrayItems,r):e.hasOwnProperty("props")?S(l(e),e.additional,r):xe(e,r,A,G):e===Date&&typeof r!="number"?b(r):Y(e,r)}function _t(r,e){return Ie(r,e,dt)}function gt(r,e){return Ie(r,e,ft)}function Je(r){return{literal:r}}function Ke(r,e){return{props:r,additional:e}}function He(r){return{ref:r}}const mt={AgentSettings:Ke([{json:"connection",js:"connection",typ:He("Connection")},{json:"team",js:"team",typ:""},{json:"display",js:"display",typ:He("Display")}],!1),Connection:Ke([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:Ke([{json:"largeScale",js:"largeScale",typ:!0}],!1)},Ye={connection:{url:"ws://localhost:8080/ws",token:""},team:"aiwolf-nlp-viewer",display:{largeScale:!1}};function xt(){const r=localStorage.getItem("agent-settings");if(r)try{return We.fromJson(r)}catch(e){console.error(e)}return localStorage.setItem("agent-settings",We.toJson(Ye)),Ye}const me=ie(xt());me.subscribe(r=>{localStorage.setItem("agent-settings",We.toJson(r))});function bt(){const{subscribe:r,update:e}=ie({status:"disconnected",deadline:null,entries:[],role:null,request:null,info:null,mediumResults:[],divineResults:[],setting:null,talkHistory:[],whisperHistory:[],executedAgents:[],attackedAgents:[]});let l=null,A=null,G=null,Y=null;me.subscribe(b=>{A=b});function B(){l&&(l.close(),l=null,e(b=>({...b,status:"disconnected"}))),Y&&(Y.clear(),Y=null)}function te(){if(!A)return;l&&e(S=>({...S,status:"disconnected",deadline:null,entries:[],role:null,request:null,info:null,mediumResults:[],divineResults:[],setting:null,talkHistory:[],whisperHistory:[],executedAgents:[],attackedAgents:[]})),e(S=>({...S,status:"connecting"}));const b=new URL(A.connection.url);A.connection.token&&b.searchParams.set("token",A.connection.token),l=new WebSocket(b),l.onopen=()=>{e(S=>({...S,status:"connected"}))},l.onclose=()=>{B()},l.onerror=()=>{B()},l.onmessage=S=>{try{const K=Date.now(),u=JSON.parse(S.data);switch(e(j=>{const k=j.entries.slice();k.push(u);const g={...j,entries:k,request:u.request};if(u.info){if(g.info=u.info,u.info.medium_result){const O=u.info.medium_result;g.mediumResults.findIndex(q=>q.day===O.day&&q.agent===O.agent)<0&&g.mediumResults.push(u.info.medium_result)}if(u.info.divine_result){const O=u.info.divine_result;g.divineResults.findIndex(q=>q.day===O.day&&q.agent===O.agent)<0&&g.divineResults.push(u.info.divine_result)}u.info.executed_agent&&g.executedAgents.push(u.info.executed_agent),u.info.attacked_agent&&g.attackedAgents.push(u.info.attacked_agent)}return u.setting&&(g.setting=u.setting,G=u.setting.timeout.action),u.talk_history&&g.talkHistory.push(...u.talk_history),u.whisper_history&&g.whisperHistory.push(...u.whisper_history),u.request===ee.INITIALIZE&&g.info&&g.info.role_map&&g.info.agent&&(g.role=g.info.role_map[g.info.agent]),g}),u.request){case ee.NAME:N((A==null?void 0:A.team)||"viewer"+Math.floor(Math.random()*1e3));break;case ee.TALK:case ee.WHISPER:case ee.VOTE:case ee.DIVINE:case ee.GUARD:case ee.ATTACK:Y&&Y.clear(),Y=new pt(()=>{N("TIMEOUT")},new Date(K+(G??6e4))),e(j=>({...j,deadline:(Y==null?void 0:Y.deadline())??null}));break;case ee.FINISH:B();break}}catch(K){console.error("Failed to parse message:",K)}}}function N(b){if(Y&&(Y.clear(),Y=null,e(S=>({...S,deadline:null}))),l&&l.readyState===WebSocket.OPEN)try{l.send(b),e(S=>{const K=S.entries.slice();return K.push(b),{...S,entries:K}})}catch(S){console.error("Failed to send message:",S)}}return{subscribe:r,connect:te,disconnect:B,send:N}}const Te=bt();class pt{constructor(e,l){Pe(this,"timeout");Pe(this,"_deadline");this.timeout=setTimeout(e,l.getTime()-new Date().getTime()),this._deadline=l}deadline(){return this._deadline}clear(){clearTimeout(this.timeout)}}function $e(r,e,l,A){r.key==="Enter"&&(r.preventDefault(),(r.ctrlKey||r.metaKey)&&e.onSendMessage(l()))}var yt=f('<span aria-live="polite"> </span>m',1),ht=f('<span class="bg-primary text-primary-content w-full py-2 text-3xl font-bold text-nowrap text-center"> </span>'),kt=f('<span class="bg-primary text-primary-content w-full py-2 text-3xl font-bold text-nowrap text-center"> </span>'),wt=(r,e,l)=>e(l()),At=f('<button class="btn btn-xl"> </button>'),St=(r,e)=>e("Skip"),Ot=f('<button class="btn btn-xl" aria-label="Skip"><iconify-icon></iconify-icon> SKIP</button>',2),It=(r,e)=>e("Over"),Tt=f('<!> <button class="btn btn-xl" aria-label="Over"><iconify-icon></iconify-icon> OVER</button>',3),jt=f("<option></option>"),qt=f("<option></option>"),Rt=f("<!> <option></option>",1),Et=(r,e,l,A)=>e.onSendMessage(l()),Dt=f('<div class="flex gap-2 items-center px-4 pt-4 pb-4 overflow-x-auto"><span class="countdown font-mono text-3xl"><!> <span aria-live="polite"> </span>s</span> <!></div> <div class="flex gap-2 items-center px-4 pt-2 pb-4 overflow-x-auto"><!> <input type="text" class="input input-xl min-w-64 flex-1" list="suggests"> <datalist id="suggests"><!></datalist> <button class="btn btn-xl" aria-label="Send"><iconify-icon></iconify-icon> 送信</button></div> <div class="-mt-2 mx-4 mb-2"><progress class="progress" max="100"></progress></div>',3),Nt=f('<span aria-live="polite"> </span>m',1),Mt=(r,e,l)=>e(l()),Jt=f('<button class="btn"> </button>'),Vt=f('<span class="bg-primary text-primary-content text-lg font-bold text-nowrap"> </span> <!>',1),Ht=(r,e)=>e("Skip"),Pt=f('<button class="btn" aria-label="Skip"><iconify-icon></iconify-icon> SKIP</button>',2),Lt=(r,e)=>e("Over"),Kt=f('<span class="bg-primary text-primary-content text-lg font-bold text-nowrap"> </span> <!> <button class="btn" aria-label="Over"><iconify-icon></iconify-icon> OVER</button>',3),Ct=f("<option></option>"),Ut=f("<option></option>"),Ft=f("<!> <option></option>",1),Gt=(r,e,l,A)=>e.onSendMessage(l()),Wt=f('<div class="flex gap-2 items-center p-4 overflow-x-auto"><span class="countdown font-mono text-2xl"><!> <span aria-live="polite"> </span>s</span> <!> <input type="text" class="input min-w-64 flex-1" list="suggests"> <datalist id="suggests"><!></datalist> <button class="btn" aria-label="Send"><iconify-icon></iconify-icon> 送信</button></div> <div class="-mt-2 mx-4 mb-2"><progress class="progress" max="100"></progress></div>',3),Zt=f('<form class="flex-none bg-base-200" data-sveltekit-keepfocus=""><!></form>');function Bt(r,e){je(e,!0);const[l,A]=at(),G=()=>ce(B,"$message",l);let Y=he(void 0);De(()=>{const k=me.subscribe(g=>{be(Y,ke(g))});Re(k)});const B=ie("");function te(k){var g;Le(B,ke(k)),(g=y(N))==null||g.focus()}let N=he(null);function b(k){k.focus()}var S=Zt(),K=a(S);{var u=k=>{var g=Dt(),O=L(g),q=a(O),$=a(q);{var V=o=>{var s=yt(),v=L(s),h=a(v,!0);t(v),ve(),U((p,d)=>{ue(v,"style",`--value:${p??""};`),ue(v,"aria-label",d),m(h,p)},[()=>Math.floor(e.remain/6e4),()=>Math.floor(e.remain/6e4).toString()]),c(o,s)};R($,o=>{e.remain&&e.remain>6e4&&o(V)})}var T=n($,2),C=a(T,!0);t(T),ve(),t(q);var M=n(q,2);{var F=o=>{var s=ht(),v=a(s);t(s),U(()=>m(v,`${Se[e.request]??""}対象を選択してください`)),c(o,s)},E=o=>{var s=kt(),v=a(s);t(s),U(()=>m(v,`${Se[e.request??ee.INITIALIZE]??""}内容を入力してください`)),c(o,s)};R(M,o=>{e.request===ee.VOTE||e.request===ee.DIVINE||e.request===ee.GUARD||e.request===ee.ATTACK?o(F):o(E,!1)})}t(O);var I=n(O,2),H=a(I);{var X=o=>{var s=oe(),v=L(s);de(v,17,()=>{var h;return Object.entries(((h=e.info)==null?void 0:h.status_map)??{})},fe,(h,p)=>{let d=()=>y(p)[0],D=()=>y(p)[1];var Z=oe(),ne=L(Z);{var se=_e=>{var le=At();le.__click=[wt,te,d];var we=a(le,!0);t(le),U(()=>m(we,d())),c(_e,le)};R(ne,_e=>{var le;D()===Oe.ALIVE&&d()!==((le=e.info)==null?void 0:le.agent)&&_e(se)})}c(h,Z)}),c(o,s)},z=o=>{var s=Tt(),v=L(s);{var h=D=>{var Z=Ot();Z.__click=[St,te];var ne=a(Z);re(ne,"icon","mdi:arrow-u-down-right-bold"),ve(),t(Z),c(D,Z)};R(v,D=>{var Z;(((Z=e.info)==null?void 0:Z.remain_skip)??0)>0&&D(h)})}var p=n(v,2);p.__click=[It,te];var d=a(p);re(d,"icon","mdi:skip-forward"),ve(),t(p),c(o,s)};R(H,o=>{e.request===ee.VOTE||e.request===ee.DIVINE||e.request===ee.GUARD||e.request===ee.ATTACK?o(X):o(z,!1)})}var W=n(H,2);ye(W),W.__keydown=[$e,e,G,B],Ce(()=>ze(W,G,o=>Le(B,o))),Xe(W,o=>b==null?void 0:b(o)),Ge(W,o=>be(N,o),()=>y(N));var P=n(W,2),ae=a(P);{var Q=o=>{var s=oe(),v=L(s);de(v,17,()=>{var h;return Object.entries(((h=e.info)==null?void 0:h.status_map)??{})},fe,(h,p)=>{let d=()=>y(p)[0],D=()=>y(p)[1];var Z=oe(),ne=L(Z);{var se=_e=>{var le=jt(),we={};U(()=>{we!==(we=d())&&(le.value=(le.__value=d())==null?"":d())}),c(_e,le)};R(ne,_e=>{var le;D()===Oe.ALIVE&&d()!==((le=e.info)==null?void 0:le.agent)&&_e(se)})}c(h,Z)}),c(o,s)},J=o=>{var s=Rt(),v=L(s);{var h=d=>{var D=qt();D.value=(D.__value="Skip")==null?"":"Skip",c(d,D)};R(v,d=>{var D;(((D=e.info)==null?void 0:D.remain_skip)??0)>0&&d(h)})}var p=n(v,2);p.value=(p.__value="Over")==null?"":"Over",c(o,s)};R(ae,o=>{e.request===ee.VOTE||e.request===ee.DIVINE||e.request===ee.GUARD||e.request===ee.ATTACK?o(Q):o(J,!1)})}t(P);var i=n(P,2);i.__click=[Et,e,G,B];var _=a(i);re(_,"icon","mdi:send"),ve(),t(i),t(I);var x=n(I,2),w=a(x);t(x),U((o,s)=>{var v;ue(T,"style",`--value:${o??""};`),ue(T,"aria-label",s),m(C,o),Ee(w,e.remain!==null?e.remain/(((v=e.setting)==null?void 0:v.timeout.action)??6e4)*100:0)},[()=>Math.floor((e.remain?e.remain%6e4:0)/1e3),()=>Math.floor((e.remain?e.remain%6e4:0)/1e3).toString()]),c(k,g)},j=k=>{var g=Wt(),O=L(g),q=a(O),$=a(q);{var V=i=>{var _=Nt(),x=L(_),w=a(x,!0);t(x),ve(),U((o,s)=>{ue(x,"style",`--value:${o??""};`),ue(x,"aria-label",s),m(w,o)},[()=>Math.floor(e.remain/6e4),()=>Math.floor(e.remain/6e4).toString()]),c(i,_)};R($,i=>{e.remain&&e.remain>6e4&&i(V)})}var T=n($,2),C=a(T,!0);t(T),ve(),t(q);var M=n(q,2);{var F=i=>{var _=Vt(),x=L(_),w=a(x);t(x);var o=n(x,2);de(o,17,()=>{var s;return Object.entries(((s=e.info)==null?void 0:s.status_map)??{})},fe,(s,v)=>{let h=()=>y(v)[0],p=()=>y(v)[1];var d=oe(),D=L(d);{var Z=ne=>{var se=Jt();se.__click=[Mt,te,h];var _e=a(se,!0);t(se),U(()=>m(_e,h())),c(ne,se)};R(D,ne=>{var se;p()===Oe.ALIVE&&h()!==((se=e.info)==null?void 0:se.agent)&&ne(Z)})}c(s,d)}),U(()=>m(w,`${Se[e.request]??""}対象を選択してください`)),c(i,_)},E=i=>{var _=Kt(),x=L(_),w=a(x);t(x);var o=n(x,2);{var s=p=>{var d=Pt();d.__click=[Ht,te];var D=a(d);re(D,"icon","mdi:arrow-u-down-right-bold"),ve(),t(d),c(p,d)};R(o,p=>{var d;(((d=e.info)==null?void 0:d.remain_skip)??0)>0&&p(s)})}var v=n(o,2);v.__click=[Lt,te];var h=a(v);re(h,"icon","mdi:skip-forward"),ve(),t(v),U(()=>m(w,`${Se[e.request??ee.INITIALIZE]??""}内容を入力してください`)),c(i,_)};R(M,i=>{e.request===ee.VOTE||e.request===ee.DIVINE||e.request===ee.GUARD||e.request===ee.ATTACK?i(F):i(E,!1)})}var I=n(M,2);ye(I),I.__keydown=[$e,e,G,B],Ce(()=>ze(I,G,i=>Le(B,i))),Xe(I,i=>b==null?void 0:b(i)),Ge(I,i=>be(N,i),()=>y(N));var H=n(I,2),X=a(H);{var z=i=>{var _=oe(),x=L(_);de(x,17,()=>{var w;return Object.entries(((w=e.info)==null?void 0:w.status_map)??{})},fe,(w,o)=>{let s=()=>y(o)[0],v=()=>y(o)[1];var h=oe(),p=L(h);{var d=D=>{var Z=Ct(),ne={};U(()=>{ne!==(ne=s())&&(Z.value=(Z.__value=s())==null?"":s())}),c(D,Z)};R(p,D=>{var Z;v()===Oe.ALIVE&&s()!==((Z=e.info)==null?void 0:Z.agent)&&D(d)})}c(w,h)}),c(i,_)},W=i=>{var _=Ft(),x=L(_);{var w=s=>{var v=Ut();v.value=(v.__value="Skip")==null?"":"Skip",c(s,v)};R(x,s=>{var v;(((v=e.info)==null?void 0:v.remain_skip)??0)>0&&s(w)})}var o=n(x,2);o.value=(o.__value="Over")==null?"":"Over",c(i,_)};R(X,i=>{e.request===ee.VOTE||e.request===ee.DIVINE||e.request===ee.GUARD||e.request===ee.ATTACK?i(z):i(W,!1)})}t(H);var P=n(H,2);P.__click=[Gt,e,G,B];var ae=a(P);re(ae,"icon","mdi:send"),ve(),t(P),t(O);var Q=n(O,2),J=a(Q);t(Q),U((i,_)=>{var x;ue(T,"style",`--value:${i??""};`),ue(T,"aria-label",_),m(C,i),Ee(J,e.remain!==null?e.remain/(((x=e.setting)==null?void 0:x.timeout.action)??6e4)*100:0)},[()=>Math.floor((e.remain?e.remain%6e4:0)/1e3),()=>Math.floor((e.remain?e.remain%6e4:0)/1e3).toString()]),c(k,g)};R(K,k=>{var g;(g=y(Y))!=null&&g.display.largeScale?k(u):k(j,!1)})}t(S),c(r,S),qe(),A()}rt(["click","keydown"]);var zt=f('<pre class="bg-primary text-primary-content text-3xl font-bold text-center my-2"> </pre>'),Qt=f('<div class="bg-info text-success-content flex flex-row gap-2 px-2"><pre class="text-2xl font-bold"> </pre> <pre class="text-2xl"> </pre> <pre class="text-2xl font-bold ml-auto"> </pre></div>'),Xt=f('<div class="bg-error text-error-content flex flex-row gap-2 px-2"><pre class="text-2xl font-bold"> </pre> <pre class="text-2xl"> </pre> <pre class="text-2xl font-bold ml-auto"> </pre></div>'),Yt=f('<div class="bg-error text-error-content flex flex-row gap-2 px-2"><pre class="text-2xl font-bold"> </pre> <pre class="text-2xl"> </pre> <pre class="text-2xl font-bold ml-auto"> </pre></div>'),$t=f('<div class="bg-success text-info-content flex flex-row gap-2 px-2"><pre class="text-2xl font-bold"> </pre> <pre class="text-2xl"> </pre> <pre class="text-2xl font-bold ml-auto"> </pre></div>'),ea=f('<h2 class="text-2xl font-bold text-center my-2">霊能結果</h2> <!>',1),ta=f('<div class="bg-error text-error-content flex flex-row gap-2 px-2"><pre class="text-2xl font-bold"> </pre> <pre class="text-2xl"> </pre> <pre class="text-2xl font-bold ml-auto"> </pre></div>'),aa=f('<div class="bg-success text-info-content flex flex-row gap-2 px-2"><pre class="text-2xl font-bold"> </pre> <pre class="text-2xl"> </pre> <pre class="text-2xl font-bold ml-auto"> </pre></div>'),ra=f('<h2 class="text-2xl font-bold text-center my-2">占い結果</h2> <!>',1),na=f('<div class="grow overflow-y-auto pr-4"><pre class="text-5xl font-bold text-center"> </pre> <pre class="text-3xl text-center my-2"> </pre> <!> <!> <!> <!></div>'),sa=f('<pre class="text-lg text-center"> </pre>'),ia=f('<div class="bg-info text-info-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),oa=f('<div class="bg-error text-error-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),la=f('<div class="bg-error text-error-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),ca=f('<div class="bg-success text-info-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),va=f('<h2 class="text-lg font-bold pt-2">霊能結果</h2> <!>',1),ua=f('<div class="bg-error text-error-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),da=f('<div class="bg-success text-info-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),fa=f('<h2 class="text-lg font-bold pt-2">占い結果</h2> <!>',1),_a=f('<h2 class="text-xl font-bold pb-2">エージェント</h2> <div class="grow overflow-y-auto pr-4"><div class="flex justify-around"><div><h2 class="text-lg font-bold text-center">役職</h2> <pre class="text-lg text-center"> </pre></div> <div><h2 class="text-lg font-bold text-center">日数</h2> <pre class="text-lg text-center"> </pre></div> <div><h2 class="text-lg font-bold text-center">リクエスト</h2> <!></div></div> <h2 class="text-lg font-bold pt-2">ステータス</h2> <!> <!> <!></div>',1),ga=f('<div class="flex-[0_0_400px] rounded-lg bg-base-200"><div class="flex flex-col h-full p-4"><!></div></div>');function ma(r,e){je(e,!0);let l=he(void 0);De(()=>{const N=me.subscribe(b=>{be(l,ke(b))});Re(N)});var A=ga(),G=a(A),Y=a(G);{var B=N=>{var b=na(),S=a(b),K=a(S,!0);t(S);var u=n(S,2),j=a(u,!0);t(u);var k=n(u,2);{var g=C=>{var M=zt(),F=a(M,!0);t(M),U(()=>m(F,Se[e.request])),c(C,M)};R(k,C=>{e.request!==null&&C(g)})}var O=n(k,2);de(O,17,()=>Object.entries(e.info.status_map??{}),fe,(C,M)=>{let F=()=>y(M)[0],E=()=>y(M)[1];var I=oe(),H=L(I);{var X=W=>{var P=Qt(),ae=a(P),Q=a(ae,!0);t(ae);var J=n(ae,2),i=a(J,!0);t(J);var _=n(J,2),x=a(_,!0);t(_),t(P),U(()=>{m(Q,F()),m(i,Ae[(e.info.role_map??{})[F()]]??""),m(x,Ne[E()])}),c(W,P)},z=W=>{var P=Xt(),ae=a(P),Q=a(ae,!0);t(ae);var J=n(ae,2),i=a(J,!0);t(J);var _=n(J,2),x=a(_);t(_),t(P),U(w=>{m(Q,F()),m(i,Ae[(e.info.role_map??{})[F()]]??""),m(x,`${Ne[E()]??""}${w??""}`)},[()=>e.executedAgents.includes(F())?" (追放)":e.attackedAgents.includes(F())?" (襲撃)":""]),c(W,P)};R(H,W=>{E()===Oe.ALIVE?W(X):W(z,!1)})}c(C,I)});var q=n(O,2);{var $=C=>{var M=ea(),F=n(L(M),2);de(F,17,()=>e.mediumResults,fe,(E,I)=>{let H=()=>y(I).day,X=()=>y(I).target,z=()=>y(I).result;var W=oe(),P=L(W);{var ae=J=>{var i=Yt(),_=a(i),x=a(_,!0);t(_);var w=n(_,2),o=a(w);t(w);var s=n(w,2),v=a(s,!0);t(s),t(i),U(()=>{m(x,X()),m(o,`(${H()??""}日目)`),m(v,pe[z()])}),c(J,i)},Q=J=>{var i=$t(),_=a(i),x=a(_,!0);t(_);var w=n(_,2),o=a(w);t(w);var s=n(w,2),v=a(s,!0);t(s),t(i),U(()=>{m(x,X()),m(o,`(${H()??""}日目)`),m(v,pe[z()])}),c(J,i)};R(P,J=>{z()!==Me.HUMAN?J(ae):J(Q,!1)})}c(E,W)}),c(C,M)};R(q,C=>{e.mediumResults.length>0&&C($)})}var V=n(q,2);{var T=C=>{var M=ra(),F=n(L(M),2);de(F,17,()=>e.divineResults,fe,(E,I)=>{let H=()=>y(I).day,X=()=>y(I).target,z=()=>y(I).result;var W=oe(),P=L(W);{var ae=J=>{var i=ta(),_=a(i),x=a(_,!0);t(_);var w=n(_,2),o=a(w);t(w);var s=n(w,2),v=a(s,!0);t(s),t(i),U(()=>{m(x,X()),m(o,`(${H()??""}日目)`),m(v,pe[z()])}),c(J,i)},Q=J=>{var i=aa(),_=a(i),x=a(_,!0);t(_);var w=n(_,2),o=a(w);t(w);var s=n(w,2),v=a(s,!0);t(s),t(i),U(()=>{m(x,X()),m(o,`(${H()??""}日目)`),m(v,pe[z()])}),c(J,i)};R(P,J=>{z()!==Me.HUMAN?J(ae):J(Q,!1)})}c(E,W)}),c(C,M)};R(V,C=>{e.divineResults.length>0&&C(T)})}t(b),U(()=>{m(K,e.role!==null?Ae[e.role]:"ゲーム外"),m(j,e.info!==null?e.info.day+"日目":"ゲーム外")}),c(N,b)},te=N=>{var b=_a(),S=n(L(b),2),K=a(S),u=a(K),j=n(a(u),2),k=a(j,!0);t(j),t(u);var g=n(u,2),O=n(a(g),2),q=a(O,!0);t(O),t(g);var $=n(g,2),V=n(a($),2);{var T=H=>{var X=sa(),z=a(X,!0);t(X),U(()=>m(z,Se[e.request])),c(H,X)};R(V,H=>{e.request!==null&&H(T)})}t($),t(K);var C=n(K,4);de(C,17,()=>Object.entries(e.info.status_map??{}),fe,(H,X)=>{let z=()=>y(X)[0],W=()=>y(X)[1];var P=oe(),ae=L(P);{var Q=i=>{var _=ia(),x=a(_),w=a(x,!0);t(x);var o=n(x,2),s=a(o,!0);t(o);var v=n(o,2),h=a(v,!0);t(v),t(_),U(()=>{m(w,z()),m(s,Ae[(e.info.role_map??{})[z()]]??""),m(h,Ne[W()])}),c(i,_)},J=i=>{var _=oa(),x=a(_),w=a(x,!0);t(x);var o=n(x,2),s=a(o,!0);t(o);var v=n(o,2),h=a(v);t(v),t(_),U(p=>{m(w,z()),m(s,Ae[(e.info.role_map??{})[z()]]??""),m(h,`${Ne[W()]??""}${p??""}`)},[()=>e.executedAgents.includes(z())?" (追放)":e.attackedAgents.includes(z())?" (襲撃)":""]),c(i,_)};R(ae,i=>{W()===Oe.ALIVE?i(Q):i(J,!1)})}c(H,P)});var M=n(C,2);{var F=H=>{var X=va(),z=n(L(X),2);de(z,17,()=>e.mediumResults,fe,(W,P)=>{let ae=()=>y(P).day,Q=()=>y(P).target,J=()=>y(P).result;var i=oe(),_=L(i);{var x=o=>{var s=la(),v=a(s),h=a(v,!0);t(v);var p=n(v,2),d=a(p);t(p);var D=n(p,2),Z=a(D,!0);t(D),t(s),U(()=>{m(h,Q()),m(d,`(${ae()??""}日目)`),m(Z,pe[J()])}),c(o,s)},w=o=>{var s=ca(),v=a(s),h=a(v,!0);t(v);var p=n(v,2),d=a(p);t(p);var D=n(p,2),Z=a(D,!0);t(D),t(s),U(()=>{m(h,Q()),m(d,`(${ae()??""}日目)`),m(Z,pe[J()])}),c(o,s)};R(_,o=>{J()!==Me.HUMAN?o(x):o(w,!1)})}c(W,i)}),c(H,X)};R(M,H=>{e.mediumResults.length>0&&H(F)})}var E=n(M,2);{var I=H=>{var X=fa(),z=n(L(X),2);de(z,17,()=>e.divineResults,fe,(W,P)=>{let ae=()=>y(P).day,Q=()=>y(P).target,J=()=>y(P).result;var i=oe(),_=L(i);{var x=o=>{var s=ua(),v=a(s),h=a(v,!0);t(v);var p=n(v,2),d=a(p);t(p);var D=n(p,2),Z=a(D,!0);t(D),t(s),U(()=>{m(h,Q()),m(d,`(${ae()??""}日目)`),m(Z,pe[J()])}),c(o,s)},w=o=>{var s=da(),v=a(s),h=a(v,!0);t(v);var p=n(v,2),d=a(p);t(p);var D=n(p,2),Z=a(D,!0);t(D),t(s),U(()=>{m(h,Q()),m(d,`(${ae()??""}日目)`),m(Z,pe[J()])}),c(o,s)};R(_,o=>{J()!==Me.HUMAN?o(x):o(w,!1)})}c(W,i)}),c(H,X)};R(E,H=>{e.divineResults.length>0&&H(I)})}t(S),U(()=>{m(k,e.role!==null?Ae[e.role]:"ゲーム外"),m(q,e.info!==null?e.info.day+"日目":"ゲーム外")}),c(N,b)};R(Y,N=>{var b;(b=y(l))!=null&&b.display.largeScale?N(B):N(te,!1)})}t(G),t(A),c(r,A),qe()}function xa(){Te.connect()}function ba(){Te.disconnect()}var pa=f('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),ya=f('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),ha=f('<div class="status status-error"></div>'),ka=(r,e)=>e("connection.url",r.currentTarget.value),wa=(r,e)=>e("connection.token",r.currentTarget.value),Aa=(r,e)=>e("team",r.currentTarget.value),Sa=(r,e)=>e("display.largeScale",r.currentTarget.checked),Oa=f('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control my-2"><h3 class="text-lg font-bold">エージェント設定</h3> <h4 class="text-base font-bold mt-2">チーム名</h4> <label class="input min-w-3xs w-3xs my-2"><iconify-icon></iconify-icon> <input type="text" class="grow"></label> <h3 class="text-lg font-bold mt-4">表示設定</h3> <h4 class="text-base font-bold mt-2">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Ia(r,e){je(e,!0);let l=he(void 0),A=he(void 0);const G=me.subscribe(i=>{be(l,ke(i))}),Y=Te.subscribe(i=>{be(A,ke(i.status))});Re(()=>{G(),Y()});function B(i,_){me.update(x=>{const w=i.split("."),o=w.pop();let s=x;for(const v of w)v&&(s=s[v]);return s[o]=_,{...x}})}let te;var N=Oa(),b=n(a(N),2),S=a(b),K=a(S);{var u=i=>{var _=pa();ve(2),c(i,_)},j=i=>{var _=oe(),x=L(_);{var w=s=>{var v=ya();ve(2),c(s,v)},o=s=>{var v=ha();c(s,v)};R(x,s=>{y(A)==="connecting"?s(w):s(o,!1)},!0)}c(i,_)};R(K,i=>{y(A)==="connected"?i(u):i(j,!1)})}t(S),t(b);var k=n(b,2),g=a(k);re(g,"class","h-[1em] opacity-50"),re(g,"inline",!0),re(g,"icon","mdi:link");var O=n(g,2);ye(O),O.__input=[ka,B],t(k);var q=n(k,2),$=a(q);re($,"class","h-[1em] opacity-50"),re($,"inline",!0),re($,"icon","mdi:key");var V=n($,2);ye(V),V.__input=[wa,B],ve(2),t(q);var T=n(q,2);T.__click=[xa];var C=n(T,2);C.__click=[ba];var M=n(C,2);M.__click=()=>te.showModal();var F=n(M,2),E=a(F),I=a(E),H=n(a(I),4),X=a(H);re(X,"class","h-[1em] opacity-50"),re(X,"inline",!0),re(X,"icon","mdi:rename");var z=n(X,2);ye(z),z.__input=[Aa,B],t(H);var W=n(H,6),P=n(a(W),2);ye(P),P.__change=[Sa,B],t(W),t(I),t(E),ve(2),t(F),Ge(F,i=>te=i,()=>te);var ae=n(F,2),Q=a(ae);re(Q,"inline",!0),re(Q,"icon","mdi:white-balance-sunny");var J=n(Q,4);re(J,"inline",!0),re(J,"icon","mdi:moon-and-stars"),t(ae),t(N),U(()=>{var i,_,x,w;Ee(O,(i=y(l))==null?void 0:i.connection.url),Ee(V,(_=y(l))==null?void 0:_.connection.token),T.disabled=y(A)!=="disconnected",C.disabled=y(A)==="disconnected",Ee(z,(x=y(l))==null?void 0:x.team),Fe(P,(w=y(l))==null?void 0:w.display.largeScale)}),c(r,N),qe()}rt(["input","click","change"]);var Ta=f("<iconify-icon></iconify-icon>",2),ja=f("<iconify-icon></iconify-icon>",2),qa=f('<div class="chat-bubble bg-base-100 text-xl text-pretty break-all"> </div>'),Ra=f('<div class="chat-image avatar"><div class="w-20 rounded-full"><img></div></div> <pre class="chat-header text-lg"> </pre> <!> <pre class="chat-footer opacity-50 text-sm"> </pre>',1),Ea=f("<iconify-icon></iconify-icon>",2),Da=f("<iconify-icon></iconify-icon>",2),Na=f('<div class="chat-bubble bg-base-100 text-pretty break-all"> </div>'),Ma=f('<div class="chat-image avatar"><div class="w-10 rounded-full"><img></div></div> <pre class="chat-header"> </pre> <!> <pre class="chat-footer opacity-50"> </pre>',1),Ja=f('<div class="chat chat-start"><!></div>');function et(r,e){je(e,!0);let l=he(void 0);De(()=>{const te=me.subscribe(N=>{be(l,ke(N))});Re(te)});var A=Ja(),G=a(A);{var Y=te=>{var N=Ra(),b=L(N),S=a(b),K=a(S);t(S),t(b);var u=n(b,2),j=a(u,!0);t(u);var k=n(u,2);{var g=V=>{var T=Ta();re(T,"inline",!0),re(T,"icon","mdi:skip-forward"),c(V,T)},O=V=>{var T=oe(),C=L(T);{var M=E=>{var I=ja();re(I,"inline",!0),re(I,"icon","mdi:arrow-u-down-right-bold"),c(E,I)},F=E=>{var I=qa(),H=a(I,!0);t(I),U(()=>m(H,e.talk.text)),c(E,I)};R(C,E=>{e.talk.skip?E(M):E(F,!1)},!0)}c(V,T)};R(k,V=>{e.talk.over?V(g):V(O,!1)})}var q=n(k,2),$=a(q);t(q),U(()=>{ue(K,"src",e.isDefaultProfile?`${Qe}${Ue[e.talk.agent]}`:""),ue(K,"alt",e.talk.agent),m(j,e.talk.agent),m($,`Idx: ${e.talk.idx??""}`)}),c(te,N)},B=te=>{var N=Ma(),b=L(N),S=a(b),K=a(S);t(S),t(b);var u=n(b,2),j=a(u,!0);t(u);var k=n(u,2);{var g=V=>{var T=Ea();re(T,"inline",!0),re(T,"icon","mdi:skip-forward"),c(V,T)},O=V=>{var T=oe(),C=L(T);{var M=E=>{var I=Da();re(I,"inline",!0),re(I,"icon","mdi:arrow-u-down-right-bold"),c(E,I)},F=E=>{var I=Na(),H=a(I,!0);t(I),U(()=>m(H,e.talk.text)),c(E,I)};R(C,E=>{e.talk.skip?E(M):E(F,!1)},!0)}c(V,T)};R(k,V=>{e.talk.over?V(g):V(O,!1)})}var q=n(k,2),$=a(q);t(q),U(()=>{ue(K,"src",e.isDefaultProfile?`${Qe}${Ue[e.talk.agent]}`:""),ue(K,"alt",e.talk.agent),m(j,e.talk.agent),m($,`Idx: ${e.talk.idx??""}`)}),c(te,N)};R(G,te=>{var N;(N=y(l))!=null&&N.display.largeScale?te(Y):te(B,!1)})}t(A),c(r,A),qe()}var Va=f('<input type="radio" name="talk_days" class="tab text-lg font-bold"> <div class="tab-content my-4"></div>',1),Ha=f('<div class="tabs tabs-border"></div>'),Pa=f('<h2 class="text-3xl font-bold pb-2"> </h2> <div class="grow overflow-y-auto pr-4"><!></div>',1),La=f('<input type="radio" name="talk_days" class="tab"> <div class="tab-content my-4"></div>',1),Ka=f('<div class="tabs tabs-border"></div>'),Ca=f('<h2 class="text-xl font-bold pb-2"> </h2> <div class="grow overflow-y-auto pr-4"><!></div>',1),Ua=f('<div class="flex-[0_0_600px] rounded-lg bg-base-200"><div class="flex flex-col h-full p-4"><!></div></div>');function tt(r,e){je(e,!0);let l=he(void 0),A=e.agents.every(b=>Object.keys(Ue).includes(b));De(()=>{const b=me.subscribe(S=>{be(l,ke(S))});Re(b)});var G=Ua(),Y=a(G),B=a(Y);{var te=b=>{var S=Pa(),K=L(S),u=a(K,!0);t(K);var j=n(K,2),k=a(j);{var g=O=>{var q=Ha();const $=Ve(()=>[...new Set(e.talks.map(V=>V.day))].sort((V,T)=>T-V));de(q,21,()=>y($),fe,(V,T)=>{var C=Va(),M=L(C);ye(M);var F=n(M,2);de(F,21,()=>e.talks.filter(E=>E.day===y(T)),fe,(E,I)=>{et(E,{get talk(){return y(I)},get agents(){return e.agents},isDefaultProfile:A})}),t(F),U(()=>{Fe(M,y(T)===y($)[0]),ue(M,"aria-label",`${y(T)}日目`)}),c(V,C)}),t(q),c(O,q)};R(k,O=>{e.talks.length>0&&O(g)})}t(j),U(()=>m(u,e.header)),c(b,S)},N=b=>{var S=Ca(),K=L(S),u=a(K,!0);t(K);var j=n(K,2),k=a(j);{var g=O=>{var q=Ka();const $=Ve(()=>[...new Set(e.talks.map(V=>V.day))].sort((V,T)=>T-V));de(q,21,()=>y($),fe,(V,T)=>{var C=La(),M=L(C);ye(M);var F=n(M,2);de(F,21,()=>e.talks.filter(E=>E.day===y(T)),fe,(E,I)=>{et(E,{get talk(){return y(I)},get agents(){return e.agents},isDefaultProfile:A})}),t(F),U(()=>{Fe(M,y(T)===y($)[0]),ue(M,"aria-label",`${y(T)}日目`)}),c(V,C)}),t(q),c(O,q)};R(k,O=>{e.talks.length>0&&O(g)})}t(j),U(()=>m(u,e.header)),c(b,S)};R(B,b=>{var S;(S=y(l))!=null&&S.display.largeScale?b(te):b(N,!1)})}t(Y),t(G),c(r,G),qe()}var Fa=f('<div class="overflow-y-hidden flex grow overflox-x-auto gap-4 p-4"><!> <!> <!></div> <!>',1),Ga=f('<div class="flex items-center justify-center h-full"><pre class="base-content text-9xl font-bold opacity-70 select-none">未接続</pre></div>'),Wa=f('<div role="alert" class="alert m-4"><span class="text-lg font-bold">未接続</span></div>'),Za=f('<main class="h-screen flex flex-col bg-base-300"><!> <!></main>');function dr(r,e){je(e,!0);const[l,A]=at(),G=()=>ce($,"$deadline",l),Y=()=>ce(q,"$status",l),B=()=>ce(M,"$info",l),te=()=>ce(T,"$role",l),N=()=>ce(C,"$request",l),b=()=>ce(F,"$mediumResults",l),S=()=>ce(E,"$divineResults",l),K=()=>ce(z,"$executedAgents",l),u=()=>ce(W,"$attackedAgents",l),j=()=>ce(H,"$talkHistory",l),k=()=>ce(X,"$whisperHistory",l),g=()=>ce(P,"$remain",l),O=()=>ce(I,"$setting",l),q=ie(""),$=ie(null),V=ie([]),T=ie(null),C=ie(null),M=ie(null),F=ie([]),E=ie([]),I=ie(null),H=ie([]),X=ie([]),z=ie([]),W=ie([]),P=ie(null);let ae=he(void 0),Q;function J(){{const h=vt.url.searchParams,p=h.get("url"),d=h.get("token");p&&(me.update(D=>({...D,connection:{url:p??"",token:d??""}})),Te.connect())}}function i(){if(G()!==null){const h=Date.now(),p=Math.max(0,G()-h);P.set(p),p>0?Q=requestAnimationFrame(i):P.set(0)}return()=>{Q&&cancelAnimationFrame(Q)}}De(()=>{J();const h=Te.subscribe(d=>{q.set(d.status),d.deadline?($.set(d.deadline.getTime()),Q&&cancelAnimationFrame(Q),Q=requestAnimationFrame(i)):($.set(null),P.set(null)),V.set(d.entries),T.set(d.role),C.set(d.request),M.set(d.info),F.set(d.mediumResults),E.set(d.divineResults),I.set(d.setting),H.set(d.talkHistory),X.set(d.whisperHistory),z.set(d.executedAgents),W.set(d.attackedAgents)}),p=me.subscribe(d=>{be(ae,ke(d))});Re(()=>{h(),p(),Q&&cancelAnimationFrame(Q)}),window.addEventListener("beforeunload",d=>{Y()==="connected"&&d.preventDefault()}),window.addEventListener("popstate",d=>{Y()==="connected"&&d.preventDefault()})});function _(h){Te.send(h)}var x=Za();ct(h=>{lt.title="aiwolf-nlp-viewer"});var w=a(x);Ia(w,{});var o=n(w,2);{var s=h=>{var p=Fa(),d=L(p),D=a(d);ma(D,{get role(){return te()},get request(){return N()},get info(){return B()},get mediumResults(){return b()},get divineResults(){return S()},get executedAgents(){return K()},get attackedAgents(){return u()}});var Z=n(D,2);const ne=Ve(()=>{var ge;return Object.keys(((ge=B())==null?void 0:ge.status_map)??{})});tt(Z,{header:"トーク履歴",get talks(){return j()},get agents(){return y(ne)}});var se=n(Z,2);{var _e=ge=>{const nt=Ve(()=>{var Be;return Object.keys(((Be=B())==null?void 0:Be.status_map)??{})});tt(ge,{header:"囁き履歴",get talks(){return k()},get agents(){return y(nt)}})};R(se,ge=>{te()===ut.WEREWOLF&&ge(_e)})}t(d);var le=n(d,2);{var we=ge=>{Bt(ge,{get remain(){return g()},get setting(){return O()},get request(){return N()},get info(){return B()},onSendMessage:_})};R(le,ge=>{g()!==null&&ge(we)})}c(h,p)},v=h=>{var p=oe(),d=L(p);{var D=ne=>{var se=Ga();c(ne,se)},Z=ne=>{var se=Wa();c(ne,se)};R(d,ne=>{var se;(se=y(ae))!=null&&se.display.largeScale?ne(D):ne(Z,!1)},!0)}c(h,p)};R(o,h=>{B()!==null?h(s):h(v,!1)})}t(x),c(r,x),qe(),A()}export{dr as component};
