import{t as P,a as h,c as we,d as Qe}from"../chunks/56-FZzVf.js";import{p as He,s as ke,o as nt,j as H,a as We,aG as Ee,i,c as o,g as t,f as s,aI as Ce,y as rt,aw as be,$ as st}from"../chunks/gg5HwMBM.js";import{d as Ve,s as F}from"../chunks/DI_mLvlt.js";import{i as G}from"../chunks/cLcwwkPL.js";import{e as Be,i as ze}from"../chunks/DxQKEJWX.js";import{h as ot}from"../chunks/CSn9cF3y.js";import{s as je,a as se,r as ue,c as Ze,d as ve}from"../chunks/CGCW5UOo.js";import{p as Oe}from"../chunks/Rs7vqiH9.js";import{b as it}from"../chunks/Cx_x8te2.js";import{b as Ie}from"../chunks/DU60D4PS.js";import{s as Je,a as lt,b as ct}from"../chunks/yiHWBsU-.js";import{w as xe,d as ut}from"../chunks/5ZuRk7Ze.js";import{I as Ke,c as $e,d as dt}from"../chunks/DJtq_3y-.js";import{a as Ye,o as at}from"../chunks/CQE0SVbD.js";/* empty css                */import{s as et,t as Me}from"../chunks/C_Lgu1rS.js";import{b as ft}from"../chunks/2Ig0RKWb.js";function vt(a,e,n,m){var c=a.__styles??(a.__styles={});c[e]!==n&&(c[e]=n,n==null?a.style.removeProperty(e):a.style.setProperty(e,n,""))}class Ue{static fromJson(e){return pt(JSON.parse(e),ye("RealtimeSettings"))}static toJson(e){return JSON.stringify(_t(e,ye("RealtimeSettings")),null,2)}}function _e(a,e,n,m=""){const c=Xe(a),$=m?` on ${m}`:"",v=n?` for key "${n}"`:"";throw Error(`Invalid value${v}${$}. Expected ${c} but got ${JSON.stringify(e)}`)}function Xe(a){return Array.isArray(a)?a.length===2&&a[0]===void 0?`an optional ${Xe(a[1])}`:`one of [${a.map(e=>Xe(e)).join(", ")}]`:typeof a=="object"&&a.literal!==void 0?a.literal:typeof a}function bt(a){if(a.jsonToJS===void 0){const e={};a.props.forEach(n=>e[n.json]={key:n.js,typ:n.typ}),a.jsonToJS=e}return a.jsonToJS}function mt(a){if(a.jsToJSON===void 0){const e={};a.props.forEach(n=>e[n.js]={key:n.json,typ:n.typ}),a.jsToJSON=e}return a.jsToJSON}function Te(a,e,n,m="",c=""){function $(x,I){return typeof x==typeof I?I:_e(x,I,m,c)}function v(x,I){const T=x.length;for(let W=0;W<T;W++){const J=x[W];try{return Te(I,J,n)}catch{}}return _e(x,I,m,c)}function w(x,I){return x.indexOf(I)!==-1?I:_e(x.map(T=>Le(T)),I,m,c)}function O(x,I){return Array.isArray(I)?I.map(T=>Te(T,x,n)):_e(Le("array"),I,m,c)}function V(x){if(x===null)return null;const I=new Date(x);return isNaN(I.valueOf())?_e(Le("Date"),x,m,c):I}function K(x,I,T){if(T===null||typeof T!="object"||Array.isArray(T))return _e(Le(ie||"object"),T,m,c);const W={};return Object.getOwnPropertyNames(x).forEach(J=>{const ee=x[J],de=Object.prototype.hasOwnProperty.call(T,J)?T[J]:void 0;W[ee.key]=Te(de,ee.typ,n,J,ie)}),Object.getOwnPropertyNames(T).forEach(J=>{Object.prototype.hasOwnProperty.call(x,J)||(W[J]=Te(T[J],I,n,J,ie))}),W}if(e==="any")return a;if(e===null)return a===null?a:_e(e,a,m,c);if(e===!1)return _e(e,a,m,c);let ie;for(;typeof e=="object"&&e.ref!==void 0;)ie=e.ref,e=gt[e.ref];return Array.isArray(e)?w(e,a):typeof e=="object"?e.hasOwnProperty("unionMembers")?v(e.unionMembers,a):e.hasOwnProperty("arrayItems")?O(e.arrayItems,a):e.hasOwnProperty("props")?K(n(e),e.additional,a):_e(e,a,m,c):e===Date&&typeof a!="number"?V(a):$(e,a)}function pt(a,e){return Te(a,e,bt)}function _t(a,e){return Te(a,e,mt)}function Le(a){return{literal:a}}function Ne(a,e){return{props:a,additional:e}}function ye(a){return{ref:a}}const gt={RealtimeSettings:Ne([{json:"connection",js:"connection",typ:ye("Connection")},{json:"display",js:"display",typ:ye("Display")}],!1),Connection:Ne([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:Ne([{json:"canvas",js:"canvas",typ:ye("Agent")},{json:"bubble",js:"bubble",typ:ye("Agent")},{json:"text",js:"text",typ:ye("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:Ne([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},tt={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function ht(){const a=localStorage.getItem("realtime-settings");if(a)try{return Ue.fromJson(a)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",Ue.toJson(tt)),tt}const Ae=xe(ht());Ae.subscribe(a=>{localStorage.setItem("realtime-settings",Ue.toJson(a))});function xt(a){return Array.from({length:a},(e,n)=>({idx:n+1,team:"Undefined",name:Ke(n+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}function q(a,e,n){var c,$;if(n===void 0)return"該当なし";let m=[];return a!=null&&a.name&&m.push(Ke(n)),a!=null&&a.team&&m.push((c=e.agents.find(v=>v.idx===n))==null?void 0:c.team),a!=null&&a.role&&m.push(($=e.agents.find(v=>v.idx===n))==null?void 0:$.role),m.join(" ")}function Pe(a,e){return(a||e)&&!(a&&e)}function yt(){const{subscribe:a,update:e}=xe({status:"disconnected",entries:{}});let n=null,m=null;Ae.subscribe(v=>{m=v});function c(){if(!m)return;e(w=>({...w,status:"connecting"}));const v=new URL(m.connection.url);m.connection.token&&v.searchParams.set("token",m.connection.token),n=new WebSocket(v),n.onopen=()=>{e(w=>({...w,status:"connected"}))},n.onclose=()=>{e(w=>({...w,status:"disconnected"})),n=null},n.onerror=()=>{e(w=>({...w,status:"disconnected"})),n=null},n.onmessage=w=>{try{const O=JSON.parse(w.data);e(V=>{const K={...V.entries};return K[O.id]||(K[O.id]=[]),K[O.id].push(O),{...V,entries:K}})}catch(O){console.error("Failed to parse message:",O)}}}function $(){n&&(e(v=>({...v,status:"disconnected"})),n.close(),n=null)}return{subscribe:a,connect:c,disconnect:$,entries:{subscribe:v=>a(w=>v(w.entries))}}}const De=yt();var wt=P('<div role="alert" class="alert m-4"><p class="text-lg font-bold"> </p></div>'),kt=P('<p class="w-2/5 text-9xl font-black opacity-50 absolute top-0 left-0 -mt-4 ml-8"> </p>'),St=(a,e,n)=>{t(e)===t(n).idx?ke(e,void 0):ke(e,Oe(t(n).idx))},jt=P('<div class="absolute inset-0 flex items-center justify-center"><span class="text-9xl font-bold opacity-75"> </span></div>'),It=P("<span> </span>"),Tt=P('<span class="text-2xl mt-2"> </span>'),Et=P("<span> </span>"),Ot=P('<span class="text-2xl mt-2"> </span>'),At=P("<span> </span>"),Rt=P('<div class="absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-1m75ffo"><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"> <!></button></div></div> <!> <!> <!></div>'),Ct=P('<div class="h-full flex flex-col"><!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><p>イラスト : 石黒正数氏</p></aside></footer></div>');function Dt(a,e){He(e,!0);let n=Ee(void 0);const m=Ae.subscribe(d=>{ke(n,Oe(d))});Ye(m);let c=Ee(void 0),$=rt(()=>{var d,u,R,k,E,_,b,f,g,l,r,C,ae;switch(e.packet.event){case"未接続":return"未接続";case"トーク":case"囁き":return e.packet.message;case"襲撃投票":return Pe(t(c)===void 0,e.packet.fromIdx===t(c))?`${q((d=t(n))==null?void 0:d.display.bubble,e.packet,e.packet.fromIdx)} が ${q((u=t(n))==null?void 0:u.display.bubble,e.packet,e.packet.toIdx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return Pe(t(c)===void 0,e.packet.fromIdx===t(c))?`${q((R=t(n))==null?void 0:R.display.bubble,e.packet,e.packet.fromIdx)} が ${q((k=t(n))==null?void 0:k.display.bubble,e.packet,e.packet.toIdx)} に投票しました`:`${q((E=t(n))==null?void 0:E.display.bubble,e.packet,e.packet.fromIdx)} が投票しました`;case"追放":return e.packet.toIdx===void 0?"誰も追放されませんでした":`${q((_=t(n))==null?void 0:_.display.bubble,e.packet,e.packet.toIdx)} を追放しました`;case"襲撃":return e.packet.toIdx===void 0?"誰も襲撃されませんでした":e.packet.fromIdx===-1?`${q((b=t(n))==null?void 0:b.display.bubble,e.packet,e.packet.toIdx)} が襲撃されましたが、護衛されました`:`${q((f=t(n))==null?void 0:f.display.bubble,e.packet,e.packet.toIdx)} が襲撃されました`;case"占い":return Pe(t(c)===void 0,e.packet.fromIdx===t(c))?`${q((g=t(n))==null?void 0:g.display.bubble,e.packet,e.packet.fromIdx)} が ${q((l=t(n))==null?void 0:l.display.bubble,e.packet,e.packet.toIdx)} を占った結果、${dt((r=e.packet.agents.find(M=>M.idx===e.packet.toIdx))==null?void 0:r.role)} でした`:"占いました";case"護衛":return Pe(t(c)===void 0,e.packet.fromIdx===t(c))?`${q((C=t(n))==null?void 0:C.display.bubble,e.packet,e.packet.fromIdx)} が ${q((ae=t(n))==null?void 0:ae.display.bubble,e.packet,e.packet.toIdx)} を護衛対象にしました`:"護衛しました";default:return}}),v,w,O,V;at(()=>(window.addEventListener("resize",K),()=>{window.removeEventListener("resize",K)})),nt(()=>{K()});function K(){if(!w||!O||!v)return;const d=v.getBoundingClientRect();if([w,O].forEach(E=>{E.width=d.width,E.height=d.height;const _=E.getContext("2d");_&&(_.clearRect(0,0,E.width,E.height),_.globalAlpha=1,_.lineWidth=2)}),t(c)!==void 0&&(e.packet.event==="占い"&&e.packet.fromIdx!==t(c)||e.packet.event==="投票"&&e.packet.fromIdx!==t(c)||e.packet.event==="襲撃投票"&&e.packet.fromIdx!==t(c)))return;const u=w.getContext("2d"),R=O.getContext("2d");if(!u||!R)return;const k=O.getBoundingClientRect();if(e.packet.fromIdx!==void 0&&e.packet.toIdx!==void 0){const E=document.getElementById(`agent-${e.packet.fromIdx}`);if(!(E instanceof HTMLElement))return;const _=E.getBoundingClientRect(),b=_.left+_.width/2-k.left,f=_.top+_.height/2-k.top,g=document.getElementById(`agent-${e.packet.toIdx}`);if(!(g instanceof HTMLElement))return;const l=g.getBoundingClientRect();ie(R,b,f,l.left+l.width/2-k.left,l.top+l.height/2-k.top,!1,getComputedStyle(V).getPropertyValue("background-color"))}if(e.packet.bubbleIdx!==void 0){const E=document.getElementById(`agent-${e.packet.bubbleIdx}`);if(!(E instanceof HTMLElement))return;const _=E.getBoundingClientRect(),b=_.left+_.width/2-k.left,f=_.top+_.height/2-k.top;ie(u,k.width/2,k.height/2,b,f,!0,getComputedStyle(V).getPropertyValue("background-color"))}}function ie(d,u,R,k,E,_,b){const f=_?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];d.strokeStyle=d.fillStyle=b,d.beginPath();let g=k-u,l=E-R,r=Math.sqrt(g*g+l*l),C=l/r,ae=g/r,M=[];M.push(0,0);for(let A=0;A<f.length;A+=2){let z=f[A],y=f[A+1];M.push(z<0?r+z:z,y)}M.push(r,0);for(let A=f.length;A>0;A-=2){let z=f[A-2],y=f[A-1];M.push(z<0?r+z:z,-y)}M.push(0,0);for(let A=0;A<M.length;A+=2){let z=M[A]*ae-M[A+1]*C+u,y=M[A]*C+M[A+1]*ae+R;A===0?d.moveTo(z,y):d.lineTo(z,y)}d.fill()}var x=Ct(),I=o(x);{var T=d=>{var u=wt(),R=o(u),k=o(R);s(R),s(u),H(()=>F(k,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),h(d,u)};G(I,d=>{var u;(u=t(n))!=null&&u.display.largeScale||d(T)})}var W=i(I,2),J=o(W),ee=o(J);{var de=d=>{var u=kt(),R=o(u);s(u),H(()=>F(R,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),h(d,u)};G(ee,d=>{var u;(u=t(n))!=null&&u.display.largeScale&&d(de)})}var me=i(ee,2);Ie(me,d=>w=d,()=>w);var fe=i(me,2);Ie(fe,d=>O=d,()=>O);var le=i(fe,2),pe=o(le),oe=o(pe),Se=o(oe,!0);s(oe),s(pe),s(le),Ie(le,d=>V=d,()=>V);var ge=i(le,2);Be(ge,17,()=>e.packet.agents,ze,(d,u,R)=>{var k=Rt(),E=o(k),_=o(E),b=o(_);b.__click=[St,c,u];var f=o(b),g=i(f,2);{var l=y=>{var p=jt(),U=o(p),B=o(U,!0);s(U),s(p),H(()=>F(B,t(u).idx)),h(y,p)};G(g,y=>{var p,U;(p=t(n))!=null&&p.display.largeScale&&((U=t(n))!=null&&U.display.canvas.name)&&y(l)})}s(b),s(_),s(E);var r=i(E,2);{var C=y=>{var p=It(),U=o(p,!0);s(p),H(B=>F(U,B),[()=>Ke(t(u).idx)]),h(y,p)};G(r,y=>{var p,U;!((p=t(n))!=null&&p.display.largeScale)&&((U=t(n))!=null&&U.display.canvas.name)&&y(C)})}var ae=i(r,2);{var M=y=>{var p=we(),U=be(p);{var B=L=>{var S=Tt(),ne=o(S,!0);s(S),H(()=>F(ne,t(u).team)),h(L,S)},Y=L=>{var S=Et(),ne=o(S,!0);s(S),H(()=>F(ne,t(u).team)),h(L,S)};G(U,L=>{var S;(S=t(n))!=null&&S.display.largeScale?L(B):L(Y,!1)})}h(y,p)};G(ae,y=>{var p;(p=t(n))!=null&&p.display.canvas.team&&y(M)})}var A=i(ae,2);{var z=y=>{var p=we(),U=be(p);{var B=L=>{var S=Ot(),ne=o(S,!0);s(S),H(()=>F(ne,t(u).role)),h(L,S)},Y=L=>{var S=At(),ne=o(S,!0);s(S),H(()=>F(ne,t(u).role)),h(L,S)};G(U,L=>{var S;(S=t(n))!=null&&S.display.largeScale?L(B):L(Y,!1)})}h(y,p)};G(A,y=>{var p;(p=t(n))!=null&&p.display.canvas.role&&(t(u).idx===t(c)||t(c)===void 0)&&y(z)})}s(k),H(y=>{var p;je(k,"style",`--angle: ${R*(360/e.packet.agents.length)}`),je(k,"id",`agent-${t(u).idx??""}`),Me(k,"bg-base-100",t(u).idx===t(c)),et(_,$e((p=t(n))!=null&&p.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-1m75ffo"),Me(_,"ring-success",t(u).isAlive),Me(_,"ring-error",!t(u).isAlive),vt(_,"opacity",t(u).isAlive?1:.25),je(f,"src",`${ft??""}/images/male/${y??""}.png`),je(f,"alt",t(u).name)},[()=>t(u).idx.toString().padStart(2,"0")]),h(d,k)}),s(J),Ie(J,d=>v=d,()=>v),s(W),Ce(2),s(x),H(()=>{var d;le.hidden=!t($),et(oe,$e((d=t(n))!=null&&d.display.largeScale?"text-3xl font-bold text-pretty break-keep text-center":"text-lg text-pretty break-keep text-center"),"svelte-1m75ffo"),F(Se,t($))}),h(a,x),We()}Ve(["click"]);function Jt(){De.connect()}function Lt(){De.disconnect()}var Nt=P('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Pt=P('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Mt=P('<div class="status status-error"></div>'),Bt=(a,e)=>e("connection.url",a.currentTarget.value),zt=(a,e)=>e("connection.token",a.currentTarget.value),Ut=(a,e)=>e("display.canvas.name",a.currentTarget.checked),Xt=(a,e)=>e("display.canvas.team",a.currentTarget.checked),Ht=(a,e)=>e("display.canvas.role",a.currentTarget.checked),Wt=(a,e)=>e("display.bubble.name",a.currentTarget.checked),Vt=(a,e)=>e("display.bubble.team",a.currentTarget.checked),Kt=(a,e)=>e("display.bubble.role",a.currentTarget.checked),Yt=(a,e)=>e("display.text.name",a.currentTarget.checked),qt=(a,e)=>e("display.text.team",a.currentTarget.checked),Ft=(a,e)=>e("display.text.role",a.currentTarget.checked),Gt=(a,e)=>e("display.largeScale",a.currentTarget.checked),Qt=P('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">表示設定</h3> <h4 class="text-base font-bold mt-4">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Zt(a,e){He(e,!0);let n=Ee(void 0),m=Ee(void 0);const c=Ae.subscribe(j=>{ke(n,Oe(j))}),$=De.subscribe(j=>{ke(m,Oe(j.status))});Ye(()=>{c(),$()});function v(j,X){Ae.update(re=>{const N=j.split("."),Q=N.pop();let D=re;for(const Z of N)Z&&(D=D[Z]);return D[Q]=X,{...re}})}let w;var O=Qt(),V=i(o(O),2),K=o(V),ie=o(K);{var x=j=>{var X=Nt();Ce(2),h(j,X)},I=j=>{var X=we(),re=be(X);{var N=D=>{var Z=Pt();Ce(2),h(D,Z)},Q=D=>{var Z=Mt();h(D,Z)};G(re,D=>{t(m)==="connecting"?D(N):D(Q,!1)},!0)}h(j,X)};G(ie,j=>{t(m)==="connected"?j(x):j(I,!1)})}s(K),s(V);var T=i(V,2),W=o(T);se(W,"class","h-[1em] opacity-50"),se(W,"inline",!0),se(W,"icon","mdi:link");var J=i(W,2);ue(J),J.__input=[Bt,v],s(T);var ee=i(T,2),de=o(ee);se(de,"class","h-[1em] opacity-50"),se(de,"inline",!0),se(de,"icon","mdi:key");var me=i(de,2);ue(me),me.__input=[zt,v],Ce(2),s(ee);var fe=i(ee,2);fe.__click=[Jt];var le=i(fe,2);le.__click=[Lt];var pe=i(le,2);pe.__click=()=>w.showModal();var oe=i(pe,2),Se=o(oe),ge=o(Se),d=i(o(ge),4),u=o(d),R=i(o(u),2);ue(R),R.__change=[Ut,v],s(u);var k=i(u,2),E=i(o(k),2);ue(E),E.__change=[Xt,v],s(k);var _=i(k,2),b=i(o(_),2);ue(b),b.__change=[Ht,v],s(_),s(d);var f=i(d,4),g=o(f),l=i(o(g),2);ue(l),l.__change=[Wt,v],s(g);var r=i(g,2),C=i(o(r),2);ue(C),C.__change=[Vt,v],s(r);var ae=i(r,2),M=i(o(ae),2);ue(M),M.__change=[Kt,v],s(ae),s(f);var A=i(f,4),z=o(A),y=i(o(z),2);ue(y),y.__change=[Yt,v],s(z);var p=i(z,2),U=i(o(p),2);ue(U),U.__change=[qt,v],s(p);var B=i(p,2),Y=i(o(B),2);ue(Y),Y.__change=[Ft,v],s(B),s(A);var L=i(A,4),S=i(o(L),2);ue(S),S.__change=[Gt,v],s(L),s(ge),s(Se),Ce(2),s(oe),Ie(oe,j=>w=j,()=>w);var ne=i(oe,2),ce=o(ne);se(ce,"inline",!0),se(ce,"icon","mdi:white-balance-sunny");var te=i(ce,4);se(te,"inline",!0),se(te,"icon","mdi:moon-and-stars"),s(ne),s(O),H(()=>{var j,X,re,N,Q,D,Z,Re,he,qe,Fe,Ge;Ze(J,(j=t(n))==null?void 0:j.connection.url),Ze(me,(X=t(n))==null?void 0:X.connection.token),fe.disabled=t(m)!=="disconnected",le.disabled=t(m)==="disconnected",ve(R,(re=t(n))==null?void 0:re.display.canvas.name),ve(E,(N=t(n))==null?void 0:N.display.canvas.team),ve(b,(Q=t(n))==null?void 0:Q.display.canvas.role),ve(l,(D=t(n))==null?void 0:D.display.bubble.name),ve(C,(Z=t(n))==null?void 0:Z.display.bubble.team),ve(M,(Re=t(n))==null?void 0:Re.display.bubble.role),ve(y,(he=t(n))==null?void 0:he.display.text.name),ve(U,(qe=t(n))==null?void 0:qe.display.text.team),ve(Y,(Fe=t(n))==null?void 0:Fe.display.text.role),ve(S,(Ge=t(n))==null?void 0:Ge.display.largeScale)}),h(a,O),We()}Ve(["input","click","change"]);var $t=P("<option> </option>"),ea=P('<div class="divider"> </div>'),ta=P('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),aa=P('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),na=P('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),ra=P('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),sa=P('<!> <button class="btn"><!></button>',1),oa=P('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="overflow-y-auto pl-2 h-full"><div class="flex flex-col p-2"><select class="w-full select"></select> <ul class="list overflow-y-auto flex-1 my-2 px-2"><!></ul></div></div></div></main>');function Sa(a,e){He(e,!0);const[n,m]=lt(),c=()=>Je(O,"$selectedId",n),$=()=>Je(I,"$status",n),v=()=>Je(ie,"$currentPacket",n),w=()=>Je(x,"$entries",n),O=xe(null),V=xe(null),K={id:"",idx:-1,day:0,isDay:!0,agents:xt(5),event:"未接続",message:void 0,fromIdx:void 0,toIdx:void 0,bubbleIdx:void 0},ie=xe(K),x=xe({}),I=xe("");let T=Ee(void 0),W=Ee(80),J=!1,ee=null;function de(b){if(!J||!ee)return;const f=ee.getBoundingClientRect(),g=b-f.left,l=f.width;ke(W,Oe(Math.min(90,Math.max(10,g/l*100))))}function me(){J=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const b=g=>{const l=g instanceof MouseEvent?g.clientX:g.touches[0].clientX;de(l)},f=()=>{J=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",b),window.removeEventListener("touchmove",b),window.removeEventListener("mouseup",f),window.removeEventListener("touchend",f)};window.addEventListener("mousemove",b),window.addEventListener("touchmove",b),window.addEventListener("mouseup",f),window.addEventListener("touchend",f)}at(()=>{const b=De.entries.subscribe(l=>{x.set(l),O.update(r=>r||Object.keys(l)[0]),V.update(()=>{if(!c())return null;const r=l[c()];return r?r.length-1:null})}),f=De.subscribe(l=>{I.set(l.status)});O.subscribe(l=>{x.update(r=>{var C;return l&&((C=r[l])==null?void 0:C.length)>0&&V.set(r[l].length-1),r})});const g=Ae.subscribe(l=>{ke(T,Oe(l))});ut([O,V,x],([l,r,C])=>!l||!r?K:C[l]&&r>=0&&r<C[l].length?C[l][r]:K).subscribe(l=>{ie.set(l)}),Ye(()=>{b(),f(),g()}),window.addEventListener("beforeunload",l=>{$()==="connecting"&&l.preventDefault()})});var fe=oa();ot(b=>{st.title="aiwolf-nlp-viewer"});var le=o(fe);Zt(le,{});var pe=i(le,2),oe=o(pe),Se=o(oe);Dt(Se,{get packet(){return v()}}),s(oe);var ge=i(oe,2);ge.__mousedown=me,ge.__touchstart=me;var d=i(ge,2),u=o(d),R=o(u);Be(R,5,()=>Object.keys(w()),ze,(b,f)=>{var g=$t(),l={},r=o(g,!0);s(g),H(()=>{l!==(l=t(f))&&(g.value=(g.__value=t(f))==null?"":t(f)),F(r,t(f))}),h(b,g)}),s(R);var k=i(R,2),E=o(k);{var _=b=>{var f=we(),g=be(f);Be(g,1,()=>w()[c()]||[],ze,(l,r,C)=>{var ae=sa(),M=be(ae);{var A=B=>{var Y=ea(),L=o(Y);s(Y),H(()=>F(L,`${t(r).day??""}日目 ${(t(r).isDay?"昼":"夜")??""}`)),h(B,Y)};G(M,B=>{(C>0&&(t(r).day!==w()[c()][C-1].day||t(r).isDay!==w()[c()][C-1].isDay)||C===0)&&B(A)})}var z=i(M,2);z.__click=()=>V.set(C);var y=o(z);{var p=B=>{var Y=we(),L=be(Y);{var S=ce=>{var te=ta(),j=be(te),X=o(j,!0);s(j);var re=i(j,2);se(re,"inline",!0),se(re,"icon","mdi:skip-forward"),H(N=>F(X,N),[()=>{var N;return q((N=t(T))==null?void 0:N.display.text,t(r),t(r).bubbleIdx)}]),h(ce,te)},ne=ce=>{var te=we(),j=be(te);{var X=N=>{var Q=aa(),D=be(Q),Z=o(D,!0);s(D);var Re=i(D,2);se(Re,"inline",!0),se(Re,"icon","mdi:arrow-u-down-right-bold"),H(he=>F(Z,he),[()=>{var he;return q((he=t(T))==null?void 0:he.display.text,t(r),t(r).bubbleIdx)}]),h(N,Q)},re=N=>{var Q=na(),D=o(Q,!0);s(Q),H(Z=>F(D,Z),[()=>{var Z;return q((Z=t(T))==null?void 0:Z.display.text,t(r),t(r).bubbleIdx)+"<"+t(r).message}]),h(N,Q)};G(j,N=>{t(r).message==="Skip"?N(X):N(re,!1)},!0)}h(ce,te)};G(L,ce=>{t(r).message==="Over"?ce(S):ce(ne,!1)})}h(B,Y)},U=B=>{var Y=ra(),L=o(Y);{var S=te=>{var j=Qe();H(X=>F(j,X),[()=>{var X;return q((X=t(T))==null?void 0:X.display.text,t(r),t(r).fromIdx)}]),h(te,j)},ne=te=>{var j=we(),X=be(j);{var re=N=>{var Q=Qe();H(D=>F(Q,D),[()=>{var D;return q((D=t(T))==null?void 0:D.display.text,t(r),t(r).toIdx)}]),h(N,Q)};G(X,N=>{(t(r).event==="追放"||t(r).event==="襲撃")&&N(re)},!0)}h(te,j)};G(L,te=>{t(r).event==="投票"||t(r).event==="占い"?te(S):te(ne,!1)})}var ce=i(L);s(Y),H(()=>F(ce,` ${t(r).event??""}`)),h(B,Y)};G(y,B=>{t(r).event==="トーク"||t(r).event==="囁き"?B(p):B(U,!1)})}s(z),h(l,ae)}),h(b,f)};G(E,b=>{c()&&b(_)})}s(k),s(u),s(d),s(pe),Ie(pe,b=>ee=b,()=>ee),s(fe),H(()=>{je(oe,"style",`width: ${t(W)??""}%`),je(d,"style",`width: ${100-t(W)-.5}%;`)}),it(R,c,b=>ct(O,b)),h(a,fe),We(),m()}Ve(["mousedown","touchstart","click"]);export{Sa as component};
