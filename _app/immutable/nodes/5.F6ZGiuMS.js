import{t as P,a as S,c as He,d as et}from"../chunks/Dhw87SHn.js";import{p as Ye,aE as Le,d as Ie,aG as it,j as rt,t as z,a as Ge,c as i,s as o,g as n,r as s,aH as De,f as je,$ as ot}from"../chunks/BOtI2AQT.js";import{d as Qe,s as q}from"../chunks/rIR5awjR.js";import{i as Z}from"../chunks/DOjvVc5q.js";import{e as Xe,i as Fe}from"../chunks/DglHXIJX.js";import{h as lt}from"../chunks/uGJCHHHe.js";import{a as Ue,s as ue,r as ce,c as tt,d as ve}from"../chunks/bp46B8nJ.js";import{s as Je,c as nt}from"../chunks/BeOeQHln.js";import{S as ct,R as ut,s as Ve}from"../chunks/Cguwj11f.js";import{b as dt}from"../chunks/B1dQitit.js";import{b as we}from"../chunks/Dbazzlnb.js";import{p as ft,s as Ne,a as vt,b as bt}from"../chunks/Dy5eO49_.js";import{p as _t}from"../chunks/MifH9n0i.js";import{w as Ee,d as mt}from"../chunks/CVZ_vLBR.js";import{I as pt}from"../chunks/B66Uxdae.js";import{a as Ze,o as st}from"../chunks/BzesmMMy.js";/* empty css                */import{b as xt}from"../chunks/Ba7hT1Ku.js";class qe{static fromJson(e){return yt(JSON.parse(e),Te("RealtimeSettings"))}static toJson(e){return JSON.stringify(wt(e,Te("RealtimeSettings")),null,2)}}function xe(t,e,a,r=""){const j=Ke(t),U=r?` on ${r}`:"",p=a?` for key "${a}"`:"";throw Error(`Invalid value${p}${U}. Expected ${j} but got ${JSON.stringify(e)}`)}function Ke(t){return Array.isArray(t)?t.length===2&&t[0]===void 0?`an optional ${Ke(t[1])}`:`one of [${t.map(e=>Ke(e)).join(", ")}]`:typeof t=="object"&&t.literal!==void 0?t.literal:typeof t}function gt(t){if(t.jsonToJS===void 0){const e={};t.props.forEach(a=>e[a.json]={key:a.js,typ:a.typ}),t.jsonToJS=e}return t.jsonToJS}function ht(t){if(t.jsToJSON===void 0){const e={};t.props.forEach(a=>e[a.js]={key:a.json,typ:a.typ}),t.jsToJSON=e}return t.jsToJSON}function Ae(t,e,a,r="",j=""){function U(E,T){return typeof E==typeof T?T:xe(E,T,r,j)}function p(E,T){const O=E.length;for(let Y=0;Y<O;Y++){const C=E[Y];try{return Ae(T,C,a)}catch{}}return xe(E,T,r,j)}function x(E,T){return E.indexOf(T)!==-1?T:xe(E.map(O=>ze(O)),T,r,j)}function N(E,T){return Array.isArray(T)?T.map(O=>Ae(O,E,a)):xe(ze("array"),T,r,j)}function K(E){if(E===null)return null;const T=new Date(E);return isNaN(T.valueOf())?xe(ze("Date"),E,r,j):T}function X(E,T,O){if(O===null||typeof O!="object"||Array.isArray(O))return xe(ze(ee||"object"),O,r,j);const Y={};return Object.getOwnPropertyNames(E).forEach(C=>{const re=E[C],ne=Object.prototype.hasOwnProperty.call(O,C)?O[C]:void 0;Y[re.key]=Ae(ne,re.typ,a,C,ee)}),Object.getOwnPropertyNames(O).forEach(C=>{Object.prototype.hasOwnProperty.call(E,C)||(Y[C]=Ae(O[C],T,a,C,ee))}),Y}if(e==="any")return t;if(e===null)return t===null?t:xe(e,t,r,j);if(e===!1)return xe(e,t,r,j);let ee;for(;typeof e=="object"&&e.ref!==void 0;)ee=e.ref,e=kt[e.ref];return Array.isArray(e)?x(e,t):typeof e=="object"?e.hasOwnProperty("unionMembers")?p(e.unionMembers,t):e.hasOwnProperty("arrayItems")?N(e.arrayItems,t):e.hasOwnProperty("props")?X(a(e),e.additional,t):xe(e,t,r,j):e===Date&&typeof t!="number"?K(t):U(e,t)}function yt(t,e){return Ae(t,e,gt)}function wt(t,e){return Ae(t,e,ht)}function ze(t){return{literal:t}}function Be(t,e){return{props:t,additional:e}}function Te(t){return{ref:t}}const kt={RealtimeSettings:Be([{json:"connection",js:"connection",typ:Te("Connection")},{json:"display",js:"display",typ:Te("Display")}],!1),Connection:Be([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:Be([{json:"canvas",js:"canvas",typ:Te("Agent")},{json:"bubble",js:"bubble",typ:Te("Agent")},{json:"text",js:"text",typ:Te("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:Be([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},at={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function St(){const t=localStorage.getItem("realtime-settings");if(t)try{return qe.fromJson(t)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",qe.toJson(at)),at}const Oe=Ee(St());Oe.subscribe(t=>{localStorage.setItem("realtime-settings",qe.toJson(t))});function jt(t){return Array.from({length:t},(e,a)=>({idx:a+1,team:"Undefined",name:pt(a+1),profile:void 0,avatar:void 0,role:"Undefined",is_alive:!0}))}function $(t,e,a){var j,U,p;if(a===void 0)return"該当なし";let r=[];return t!=null&&t.name&&r.push((j=e.agents.find(x=>x.idx===a))==null?void 0:j.name),t!=null&&t.team&&r.push((U=e.agents.find(x=>x.idx===a))==null?void 0:U.team),t!=null&&t.role&&r.push((p=e.agents.find(x=>x.idx===a))==null?void 0:p.role),r.join(" ")}function Et(t){return t?ct[ut[t]]:""}function Me(t,e){return(t||e)&&!(t&&e)}function Tt(){const{subscribe:t,update:e}=Ee({status:"disconnected",entries:{}});let a=null,r=null;Oe.subscribe(p=>{r=p});function j(){if(!r)return;e(x=>({...x,status:"connecting"}));const p=new URL(r.connection.url);r.connection.token&&p.searchParams.set("token",r.connection.token),a=new WebSocket(p),a.onopen=()=>{e(x=>({...x,status:"connected"}))},a.onclose=()=>{e(x=>({...x,status:"disconnected"})),a=null},a.onerror=()=>{e(x=>({...x,status:"disconnected"})),a=null},a.onmessage=x=>{try{const N=JSON.parse(x.data);console.log("Received packet:",N),e(K=>{const X={...K.entries};return X[N.id]||(X[N.id]=[]),X[N.id].push(N),{...K,entries:X}})}catch(N){console.error("Failed to parse message:",N)}}}function U(){a&&(e(p=>({...p,status:"disconnected"})),a.close(),a=null)}return{subscribe:t,connect:j,disconnect:U,entries:{subscribe:p=>t(x=>p(x.entries))}}}const Pe=Tt();var Ot=P('<div role="alert" class="alert m-4"><span class="text-lg font-bold"> </span></div>'),Rt=P('<pre class="base-content w-2/5 text-5xl font-bold opacity-70 absolute top-0 left-0 -mt-4 ml-8 select-none"> <br> <br> </pre>'),Ct=(t,e,a)=>{e()===n(a).idx?e(void 0):e(n(a).idx)},At=P('<div class="absolute inset-0 flex items-center justify-center"><pre class="text-9xl font-bold opacity-75 select-none"> </pre></div>'),Lt=P('<pre class="base-content select-none"> </pre>'),It=P('<pre class="base-content text-2xl mt-2 select-none"> </pre>'),Jt=P('<pre class="base-content select-none"> </pre>'),Pt=P('<pre class="base-content text-2xl mt-2 select-none"> </pre>'),Nt=P('<pre class="base-content select-none"> </pre>'),Mt=P('<div><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"> <!></button></div></div> <!> <!> <!></div>'),Dt=P('<div class="h-full flex flex-col"><div class="bg-secondary"></div> <!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><span>イラスト : 石黒正数氏</span></aside></footer></div>');function Wt(t,e){Ye(e,!0);let a=ft(e,"focusIdx",15),r=Le(void 0);const j=Oe.subscribe(d=>{Ie(r,d,!0)});Ze(j);let U=it(()=>{var d,l,L,h,B,y,w,M,u,_,m,A,f,c;switch(e.packet.event){case"未接続":return"未接続";case"トーク":return e.packet.message;case"囁き":return Me(a()===void 0,((d=e.packet.agents.find(b=>b.idx===a()))==null?void 0:d.role)==="WEREWOLF")?e.packet.message:"囁きました";case"襲撃投票":return Me(a()===void 0,e.packet.from_idx===a())?`${$((l=n(r))==null?void 0:l.display.bubble,e.packet,e.packet.from_idx)} が ${$((L=n(r))==null?void 0:L.display.bubble,e.packet,e.packet.to_idx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return Me(a()===void 0,e.packet.from_idx===a())?`${$((h=n(r))==null?void 0:h.display.bubble,e.packet,e.packet.from_idx)} が ${$((B=n(r))==null?void 0:B.display.bubble,e.packet,e.packet.to_idx)} に投票しました`:`${$((y=n(r))==null?void 0:y.display.bubble,e.packet,e.packet.from_idx)} が投票しました`;case"追放":return e.packet.to_idx===void 0?"誰も追放されませんでした":`${$((w=n(r))==null?void 0:w.display.bubble,e.packet,e.packet.to_idx)} を追放しました`;case"襲撃":return e.packet.to_idx===void 0?"誰も襲撃されませんでした":e.packet.from_idx===-1?`${$((M=n(r))==null?void 0:M.display.bubble,e.packet,e.packet.to_idx)} が襲撃されましたが、護衛されました`:`${$((u=n(r))==null?void 0:u.display.bubble,e.packet,e.packet.to_idx)} が襲撃されました`;case"占い":return Me(a()===void 0,e.packet.from_idx===a())?`${$((_=n(r))==null?void 0:_.display.bubble,e.packet,e.packet.from_idx)} が ${$((m=n(r))==null?void 0:m.display.bubble,e.packet,e.packet.to_idx)} を占った結果、${Et((A=e.packet.agents.find(b=>b.idx===e.packet.to_idx))==null?void 0:A.role)} でした`:"占いました";case"護衛":return Me(a()===void 0,e.packet.from_idx===a())?`${$((f=n(r))==null?void 0:f.display.bubble,e.packet,e.packet.from_idx)} が ${$((c=n(r))==null?void 0:c.display.bubble,e.packet,e.packet.to_idx)} を護衛対象にしました`:"護衛しました";case"終了":return e.packet.message+" が勝利しました";default:return}}),p,x,N,K,X;st(()=>(window.addEventListener("resize",ee),()=>{window.removeEventListener("resize",ee)})),rt(()=>{ee()});function ee(){var B;if(!x||!N||!p)return;const d=p.getBoundingClientRect();if([x,N].forEach(y=>{y.width=d.width,y.height=d.height;const w=y.getContext("2d");w&&(w.clearRect(0,0,y.width,y.height),w.globalAlpha=1,w.lineWidth=2)}),a()!==void 0&&(e.packet.event==="囁き"&&((B=e.packet.agents.find(y=>y.idx===a()))==null?void 0:B.role)!=="WEREWOLF"||e.packet.event==="占い"&&e.packet.from_idx!==a()||e.packet.event==="投票"&&e.packet.from_idx!==a()||e.packet.event==="襲撃投票"&&e.packet.from_idx!==a()))return;const l=x.getContext("2d"),L=N.getContext("2d");if(!l||!L)return;const h=N.getBoundingClientRect();if(e.packet.from_idx!==void 0&&e.packet.to_idx!==void 0){const y=document.getElementById(`agent-${e.packet.from_idx}`);if(!(y instanceof HTMLElement))return;const w=y.getBoundingClientRect(),M=w.left+w.width/2-h.left,u=w.top+w.height/2-h.top,_=document.getElementById(`agent-${e.packet.to_idx}`);if(!(_ instanceof HTMLElement))return;const m=_.getBoundingClientRect();E(L,M,u,m.left+m.width/2-h.left,m.top+m.height/2-h.top,!1,getComputedStyle(X).getPropertyValue("background-color"))}if(e.packet.bubble_idx!==void 0){const y=document.getElementById(`agent-${e.packet.bubble_idx}`);if(!(y instanceof HTMLElement))return;const w=y.getBoundingClientRect(),M=w.left+w.width/2-h.left,u=w.top+w.height/2-h.top;E(l,h.width/2,h.height/2,M,u,!0,getComputedStyle(K).getPropertyValue("background-color"))}}function E(d,l,L,h,B,y,w){const M=y?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];d.strokeStyle=d.fillStyle=w,d.beginPath();let u=h-l,_=B-L,m=Math.sqrt(u*u+_*_),A=_/m,f=u/m,c=[];c.push(0,0);for(let b=0;b<M.length;b+=2){let D=M[b],G=M[b+1];c.push(D<0?m+D:D,G)}c.push(m,0);for(let b=M.length;b>0;b-=2){let D=M[b-2],G=M[b-1];c.push(D<0?m+D:D,-G)}c.push(0,0);for(let b=0;b<c.length;b+=2){let D=c[b]*f-c[b+1]*A+l,G=c[b]*A+c[b+1]*f+L;b===0?d.moveTo(D,G):d.lineTo(D,G)}d.fill()}var T=Dt(),O=i(T);we(O,d=>X=d,()=>X);var Y=o(O,2);{var C=d=>{var l=Ot(),L=i(l),h=i(L);s(L),s(l),z(()=>q(h,`${e.packet.day??""}日目 ${(e.packet.is_day?"昼":"夜")??""}
        ${e.packet.event??""}フェーズ`)),S(d,l)};Z(Y,d=>{var l;(l=n(r))!=null&&l.display.largeScale||d(C)})}var re=o(Y,2),ne=i(re),de=i(ne);{var ke=d=>{var l=Rt(),L=i(l),h=o(L,2,!0),B=o(h,2,!0);s(l),z(()=>{q(L,`${e.packet.day??""}日目`),q(h,e.packet.is_day?"昼":"夜"),q(B,e.packet.event)}),S(d,l)};Z(de,d=>{var l;(l=n(r))!=null&&l.display.largeScale&&d(ke)})}var ge=o(de,2);we(ge,d=>x=d,()=>x);var he=o(ge,2);we(he,d=>N=d,()=>N);var te=o(he,2),be=i(te),_e=i(be),me=i(_e,!0);s(_e),s(be),s(te),we(te,d=>K=d,()=>K);var fe=o(te,2);Xe(fe,17,()=>e.packet.agents,Fe,(d,l,L)=>{var h=Mt();let B;var y=i(h),w=i(y);let M,u;var _=i(w);_.__click=[Ct,a,l];var m=i(_),A=o(m,2);{var f=W=>{var g=At(),k=i(g),I=i(k,!0);s(k),s(g),z(()=>q(I,n(l).idx)),S(W,g)};Z(A,W=>{var g,k;(g=n(r))!=null&&g.display.largeScale&&((k=n(r))!=null&&k.display.canvas.name)&&W(f)})}s(_),s(w),s(y);var c=o(y,2);{var b=W=>{var g=Lt(),k=i(g,!0);s(g),z(()=>q(k,n(l).name)),S(W,g)};Z(c,W=>{var g,k;!((g=n(r))!=null&&g.display.largeScale)&&((k=n(r))!=null&&k.display.canvas.name)&&W(b)})}var D=o(c,2);{var G=W=>{var g=He(),k=je(g);{var I=F=>{var v=It(),R=i(v,!0);s(v),z(()=>q(R,n(l).team)),S(F,v)},oe=F=>{var v=Jt(),R=i(v,!0);s(v),z(()=>q(R,n(l).team)),S(F,v)};Z(k,F=>{var v;(v=n(r))!=null&&v.display.largeScale?F(I):F(oe,!1)})}S(W,g)};Z(D,W=>{var g;(g=n(r))!=null&&g.display.canvas.team&&W(G)})}var pe=o(D,2);{var Se=W=>{var g=He(),k=je(g);{var I=F=>{var v=Pt(),R=i(v,!0);s(v),z(()=>q(R,n(l).role)),S(F,v)},oe=F=>{var v=Nt(),R=i(v,!0);s(v),z(()=>q(R,n(l).role)),S(F,v)};Z(k,F=>{var v;(v=n(r))!=null&&v.display.largeScale?F(I):F(oe,!1)})}S(W,g)};Z(pe,W=>{var g;(g=n(r))!=null&&g.display.canvas.role&&(n(l).idx===a()||a()===void 0)&&W(Se)})}s(h),z((W,g,k)=>{var I;B=Je(h,1,"absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-1xlm15x",null,B,W),Ve(h,`--angle: ${L*(360/e.packet.agents.length)}`),Ue(h,"id",`agent-${n(l).idx??""}`),M=Je(w,1,nt((I=n(r))!=null&&I.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-1xlm15x",M,g),u=Ve(w,"",u,{opacity:n(l).is_alive?1:.25}),Ue(m,"src",k),Ue(m,"alt",n(l).name)},[()=>({"bg-focus":n(l).idx===a()}),()=>({"ring-info":n(l).is_alive,"ring-error":!n(l).is_alive}),()=>n(l).avatar===void 0?`${xt}/images/male/${n(l).idx.toString().padStart(2,"0")}.png`:n(l).avatar]),S(d,h)}),s(ne),we(ne,d=>p=d,()=>p),s(re),De(2),s(T),z(()=>{var d;te.hidden=!n(U),Je(_e,1,nt((d=n(r))!=null&&d.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center")),q(me,n(U))}),S(t,T),Ge()}Qe(["click"]);function zt(){Pe.connect()}function Bt(){Pe.disconnect()}var Ht=P('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Ut=P('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Xt=P('<div class="status status-error"></div>'),Ft=(t,e)=>e("connection.url",t.currentTarget.value),Vt=(t,e)=>e("connection.token",t.currentTarget.value),qt=(t,e)=>e("display.canvas.name",t.currentTarget.checked),Kt=(t,e)=>e("display.canvas.team",t.currentTarget.checked),Yt=(t,e)=>e("display.canvas.role",t.currentTarget.checked),Gt=(t,e)=>e("display.bubble.name",t.currentTarget.checked),Qt=(t,e)=>e("display.bubble.team",t.currentTarget.checked),Zt=(t,e)=>e("display.bubble.role",t.currentTarget.checked),$t=(t,e)=>e("display.text.name",t.currentTarget.checked),en=(t,e)=>e("display.text.team",t.currentTarget.checked),tn=(t,e)=>e("display.text.role",t.currentTarget.checked),nn=(t,e)=>e("display.largeScale",t.currentTarget.checked),an=P('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control my-2"><h3 class="text-lg font-bold">表示設定</h3> <h4 class="text-base font-bold mt-2">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-2">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function rn(t,e){Ye(e,!0);let a=Le(void 0),r=Le(void 0);const j=Oe.subscribe(v=>{Ie(a,v,!0)}),U=Pe.subscribe(v=>{Ie(r,v.status,!0)});Ze(()=>{j(),U()});function p(v,R){Oe.update(J=>{const Q=v.split("."),V=Q.pop();let H=J;for(const se of Q)se&&(H=H[se]);return H[V]=R,{...J}})}let x;var N=an(),K=o(i(N),2),X=i(K),ee=i(X);{var E=v=>{var R=Ht();De(2),S(v,R)},T=(v,R)=>{{var J=V=>{var H=Ut();De(2),S(V,H)},Q=V=>{var H=Xt();S(V,H)};Z(v,V=>{n(r)==="connecting"?V(J):V(Q,!1)},R)}};Z(ee,v=>{n(r)==="connected"?v(E):v(T,!1)})}s(X),s(K);var O=o(K,2),Y=i(O);Je(Y,1,"h-[1em] opacity-50"),ue(Y,"inline",!0),ue(Y,"icon","mdi:link");var C=o(Y,2);ce(C),C.__input=[Ft,p],s(O);var re=o(O,2),ne=i(re);Je(ne,1,"h-[1em] opacity-50"),ue(ne,"inline",!0),ue(ne,"icon","mdi:key");var de=o(ne,2);ce(de),de.__input=[Vt,p],De(2),s(re);var ke=o(re,2);ke.__click=[zt];var ge=o(ke,2);ge.__click=[Bt];var he=o(ge,2);he.__click=()=>x.showModal();var te=o(he,2),be=i(te),_e=i(be),me=o(i(_e),4),fe=i(me),d=o(i(fe),2);ce(d),d.__change=[qt,p],s(fe);var l=o(fe,2),L=o(i(l),2);ce(L),L.__change=[Kt,p],s(l);var h=o(l,2),B=o(i(h),2);ce(B),B.__change=[Yt,p],s(h),s(me);var y=o(me,4),w=i(y),M=o(i(w),2);ce(M),M.__change=[Gt,p],s(w);var u=o(w,2),_=o(i(u),2);ce(_),_.__change=[Qt,p],s(u);var m=o(u,2),A=o(i(m),2);ce(A),A.__change=[Zt,p],s(m),s(y);var f=o(y,4),c=i(f),b=o(i(c),2);ce(b),b.__change=[$t,p],s(c);var D=o(c,2),G=o(i(D),2);ce(G),G.__change=[en,p],s(D);var pe=o(D,2),Se=o(i(pe),2);ce(Se),Se.__change=[tn,p],s(pe),s(f);var W=o(f,4),g=o(i(W),2);ce(g),g.__change=[nn,p],s(W),s(_e),s(be),De(2),s(te),we(te,v=>x=v,()=>x);var k=o(te,2),I=i(k);ue(I,"inline",!0),ue(I,"icon","mdi:white-balance-sunny");var oe=o(I,2),F=o(oe,2);ue(F,"inline",!0),ue(F,"icon","mdi:moon-and-stars"),s(k),s(N),z(()=>{var v,R,J,Q,V,H,se,ie,Re,le,ae,ye;tt(C,(v=n(a))==null?void 0:v.connection.url),tt(de,(R=n(a))==null?void 0:R.connection.token),ke.disabled=n(r)!=="disconnected",ge.disabled=n(r)==="disconnected",ve(d,(J=n(a))==null?void 0:J.display.canvas.name),ve(L,(Q=n(a))==null?void 0:Q.display.canvas.team),ve(B,(V=n(a))==null?void 0:V.display.canvas.role),ve(M,(H=n(a))==null?void 0:H.display.bubble.name),ve(_,(se=n(a))==null?void 0:se.display.bubble.team),ve(A,(ie=n(a))==null?void 0:ie.display.bubble.role),ve(b,(Re=n(a))==null?void 0:Re.display.text.name),ve(G,(le=n(a))==null?void 0:le.display.text.team),ve(Se,(ae=n(a))==null?void 0:ae.display.text.role),ve(g,(ye=n(a))==null?void 0:ye.display.largeScale)}),S(t,N),Ge()}Qe(["input","click","change"]);var sn=P("<option> </option>"),on=P('<div class="divider"> </div>'),ln=P('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),cn=P('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),un=P('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),dn=P('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),fn=P('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),vn=P("<!> <button><!></button>",1),bn=P('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="flex-1 overflow-y-auto h-full pr-2"><div class="flex flex-col p-2"><select class="w-full select"></select> <div class="list overflow-y-auto flex-1 my-2"><!></div></div></div></div></main>');function In(t,e){Ye(e,!0);const[a,r]=vt(),j=()=>Ne(K,"$selectedId",a),U=()=>Ne(O,"$entries",a),p=()=>Ne(Y,"$status",a),x=()=>Ne(X,"$selectedIdx",a),N=()=>Ne(T,"$currentPacket",a),K=Ee(null),X=Ee(null);let ee=Le(void 0);const E={id:"",idx:-1,day:0,is_day:!0,agents:jt(5),event:"未接続",message:void 0,from_idx:void 0,to_idx:void 0,bubble_idx:void 0},T=Ee(E),O=Ee({}),Y=Ee("");let C=Le(void 0),re=Le(80),ne=!1,de=null;function ke(){{const u=_t.url.searchParams,_=u.get("url"),m=u.get("token");_&&(Oe.update(A=>({...A,connection:{url:_??"",token:m??""}})),Pe.connect())}}function ge(u){if(!ne||!de)return;const _=de.getBoundingClientRect(),m=u-_.left,A=_.width;Ie(re,Math.min(90,Math.max(10,m/A*100)),!0)}function he(){ne=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const u=m=>{const A=m instanceof MouseEvent?m.clientX:m.touches[0].clientX;ge(A)},_=()=>{ne=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",u),window.removeEventListener("touchmove",u),window.removeEventListener("mouseup",_),window.removeEventListener("touchend",_)};window.addEventListener("mousemove",u),window.addEventListener("touchmove",u),window.addEventListener("mouseup",_),window.addEventListener("touchend",_)}st(()=>{ke();const u=Pe.entries.subscribe(c=>{O.set(c),K.update(b=>b||Object.keys(c)[0]),X.update(()=>j()?c[j()].length-1:null)}),_=Pe.subscribe(c=>{Y.set(c.status)}),m=K.subscribe(c=>{var b;c&&((b=U()[c])==null?void 0:b.length)>0?X.set(U()[c].length-1):X.set(null)}),A=Oe.subscribe(c=>{Ie(C,c,!0)}),f=mt([K,X,O],([c,b,D])=>{if(!c||b===null)return E;const G=D[c];return!G||b<0||b>=G.length?E:G[b]}).subscribe(c=>{T.set(c)});Ze(()=>{u(),_(),A(),m(),f()}),window.addEventListener("beforeunload",c=>{p()==="connected"&&c.preventDefault()}),window.addEventListener("popstate",c=>{p()==="connected"&&c.preventDefault()})});let te=null;rt(()=>{if(te&&x()!==null){const u=te.querySelectorAll("button");x()>=0&&x()<u.length&&u[x()].scrollIntoView({behavior:"smooth",block:"center"})}});var be=bn();lt(u=>{ot.title="aiwolf-nlp-viewer"});var _e=i(be);rn(_e,{});var me=o(_e,2),fe=i(me),d=i(fe);Wt(d,{get packet(){return N()},get focusIdx(){return n(ee)},set focusIdx(u){Ie(ee,u,!0)}}),s(fe);var l=o(fe,2);l.__mousedown=he,l.__touchstart=he;var L=o(l,2),h=i(L),B=i(h);Xe(B,5,()=>Object.keys(U()),Fe,(u,_)=>{var m=sn(),A={},f=i(m,!0);s(m),z(()=>{A!==(A=n(_))&&(m.value=(m.__value=n(_))==null?"":n(_)),q(f,n(_))}),S(u,m)}),s(B);var y=o(B,2),w=i(y);{var M=u=>{var _=He(),m=je(_);Xe(m,1,()=>U()[j()]||[],Fe,(A,f,c)=>{var b=vn(),D=je(b);{var G=k=>{var I=on(),oe=i(I);s(I),z(()=>q(oe,`${n(f).day??""}日目 ${(n(f).is_day?"昼":"夜")??""}`)),S(k,I)};Z(D,k=>{(c>0&&(n(f).day!==U()[j()][c-1].day||n(f).is_day!==U()[j()][c-1].is_day)||c===0)&&k(G)})}var pe=o(D,2);pe.__click=()=>X.set(c);var Se=i(pe);{var W=k=>{var I=He(),oe=je(I);{var F=R=>{var J=ln(),Q=i(J,!0);s(J),z(()=>q(Q,n(f).event)),S(R,J)},v=(R,J)=>{{var Q=H=>{var se=cn(),ie=je(se),Re=i(ie,!0);s(ie);var le=o(ie,2);ue(le,"inline",!0),ue(le,"icon","mdi:skip-forward"),z(ae=>q(Re,ae),[()=>{var ae;return $((ae=n(C))==null?void 0:ae.display.text,n(f),n(f).bubble_idx)}]),S(H,se)},V=(H,se)=>{{var ie=le=>{var ae=un(),ye=je(ae),Ce=i(ye,!0);s(ye);var $e=o(ye,2);ue($e,"inline",!0),ue($e,"icon","mdi:arrow-u-down-right-bold"),z(We=>q(Ce,We),[()=>{var We;return $((We=n(C))==null?void 0:We.display.text,n(f),n(f).bubble_idx)}]),S(le,ae)},Re=le=>{var ae=dn(),ye=i(ae,!0);s(ae),z(Ce=>q(ye,Ce),[()=>{var Ce;return $((Ce=n(C))==null?void 0:Ce.display.text,n(f),n(f).bubble_idx)+"<"+n(f).message}]),S(le,ae)};Z(H,le=>{n(f).message==="Skip"?le(ie):le(Re,!1)},se)}};Z(R,H=>{n(f).message==="Over"?H(Q):H(V,!1)},J)}};Z(oe,R=>{var J;n(f).event==="囁き"&&n(ee)!==void 0&&((J=n(f).agents.find(Q=>Q.idx===n(ee)))==null?void 0:J.role)!=="WEREWOLF"?R(F):R(v,!1)})}S(k,I)},g=k=>{var I=fn(),oe=i(I);{var F=J=>{var Q=et();z(V=>q(Q,V),[()=>{var V;return $((V=n(C))==null?void 0:V.display.text,n(f),n(f).from_idx)}]),S(J,Q)},v=(J,Q)=>{{var V=H=>{var se=et();z(ie=>q(se,ie),[()=>{var ie;return $((ie=n(C))==null?void 0:ie.display.text,n(f),n(f).to_idx)}]),S(H,se)};Z(J,H=>{(n(f).event==="追放"||n(f).event==="襲撃")&&H(V)},Q)}};Z(oe,J=>{n(f).event==="投票"||n(f).event==="占い"?J(F):J(v,!1)})}var R=o(oe);s(I),z(()=>q(R,` ${n(f).event??""}`)),S(k,I)};Z(Se,k=>{n(f).event==="トーク"||n(f).event==="囁き"?k(W):k(g,!1)})}s(pe),z(()=>Je(pe,1,`btn ${(c===x()?"btn-primary":"")??""}`)),S(A,b)}),S(u,_)};Z(w,u=>{j()&&u(M)})}s(y),we(y,u=>te=u,()=>te),s(h),s(L),s(me),we(me,u=>de=u,()=>de),s(be),z(()=>Ve(fe,`width: ${n(re)??""}%`)),dt(B,j,u=>bt(K,u)),S(t,be),Ge(),r()}Qe(["mousedown","touchstart","click"]);export{In as component};
