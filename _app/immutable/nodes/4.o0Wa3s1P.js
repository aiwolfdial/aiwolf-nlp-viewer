import{t as E,a as S,d as _e}from"../chunks/CYHUnqUB.js";import{i as Ie}from"../chunks/Dsc93adF.js";import{p as Te,d as he,aq as Be,i as U,a as Ae,aG as ye,s as f,c,g as r,r as l,aI as ie,aA as ge,$ as Me,aJ as Le}from"../chunks/C6VFkXJ6.js";import{s as F}from"../chunks/CcTxLL8i.js";import{i as Y}from"../chunks/DbQD98kR.js";import{e as xe,i as we}from"../chunks/CDvNhuoa.js";import{d as ze,h as Ue,e as Ke}from"../chunks/BLcQzrmO.js";import{b as Ve}from"../chunks/sAJ58j3v.js";import{s as fe,a as We,b as qe}from"../chunks/COMcsTtA.js";import{a as ve,s as ee,r as re,b as Ee,c as me}from"../chunks/D4mFRh8Z.js";import{s as Je,c as $e,t as Ce,I as Re}from"../chunks/CYwAZ6XH.js";import{p as Se}from"../chunks/BZhcqTp8.js";import{b as le}from"../chunks/CbL9dJBF.js";import{a as De,o as Ne}from"../chunks/KQcy5SQk.js";import{b as He}from"../chunks/YiuyxhH0.js";import{w as se,d as Fe}from"../chunks/DtOi-0f6.js";/* empty css                */function Ge(t,e,a,m){var _=t.__styles??(t.__styles={});_[e]!==a&&(_[e]=a,a==null?t.style.removeProperty(e):t.style.setProperty(e,a,""))}class je{static fromJson(e){return Qe(JSON.parse(e),ce("RealtimeSettings"))}static toJson(e){return JSON.stringify(Ze(e,ce("RealtimeSettings")),null,2)}}function ae(t,e,a,m=""){const _=ke(t),M=m?` on ${m}`:"",v=a?` for key "${a}"`:"";throw Error(`Invalid value${v}${M}. Expected ${_} but got ${JSON.stringify(e)}`)}function ke(t){return Array.isArray(t)?t.length===2&&t[0]===void 0?`an optional ${ke(t[1])}`:`one of [${t.map(e=>ke(e)).join(", ")}]`:typeof t=="object"&&t.literal!==void 0?t.literal:typeof t}function Xe(t){if(t.jsonToJS===void 0){const e={};t.props.forEach(a=>e[a.json]={key:a.js,typ:a.typ}),t.jsonToJS=e}return t.jsonToJS}function Ye(t){if(t.jsToJSON===void 0){const e={};t.props.forEach(a=>e[a.js]={key:a.json,typ:a.typ}),t.jsToJSON=e}return t.jsToJSON}function oe(t,e,a,m="",_=""){function M(g,p){return typeof g==typeof p?p:ae(g,p,m,_)}function v(g,p){const h=g.length;for(let J=0;J<h;J++){const j=g[J];try{return oe(p,j,a)}catch{}}return ae(g,p,m,_)}function b(g,p){return g.indexOf(p)!==-1?p:ae(g.map(h=>be(h)),p,m,_)}function x(g,p){return Array.isArray(p)?p.map(h=>oe(h,g,a)):ae(be("array"),p,m,_)}function K(g){if(g===null)return null;const p=new Date(g);return isNaN(p.valueOf())?ae(be("Date"),g,m,_):p}function L(g,p,h){if(h===null||typeof h!="object"||Array.isArray(h))return ae(be(V||"object"),h,m,_);const J={};return Object.getOwnPropertyNames(g).forEach(j=>{const G=g[j],X=Object.prototype.hasOwnProperty.call(h,j)?h[j]:void 0;J[G.key]=oe(X,G.typ,a,j,V)}),Object.getOwnPropertyNames(h).forEach(j=>{Object.prototype.hasOwnProperty.call(g,j)||(J[j]=oe(h[j],p,a,j,V))}),J}if(e==="any")return t;if(e===null)return t===null?t:ae(e,t,m,_);if(e===!1)return ae(e,t,m,_);let V;for(;typeof e=="object"&&e.ref!==void 0;)V=e.ref,e=et[e.ref];return Array.isArray(e)?b(e,t):typeof e=="object"?e.hasOwnProperty("unionMembers")?v(e.unionMembers,t):e.hasOwnProperty("arrayItems")?x(e.arrayItems,t):e.hasOwnProperty("props")?L(a(e),e.additional,t):ae(e,t,m,_):e===Date&&typeof t!="number"?K(t):M(e,t)}function Qe(t,e){return oe(t,e,Xe)}function Ze(t,e){return oe(t,e,Ye)}function be(t){return{literal:t}}function pe(t,e){return{props:t,additional:e}}function ce(t){return{ref:t}}const et={RealtimeSettings:pe([{json:"connection",js:"connection",typ:ce("Connection")},{json:"display",js:"display",typ:ce("Display")}],!1),Connection:pe([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:pe([{json:"agent",js:"agent",typ:ce("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:pe([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},Oe={connection:{url:"ws://localhost:8080/realtime",token:""},display:{agent:{name:!0,team:!0,role:!0},largeScale:!1}};function tt(){const t=localStorage.getItem("realtime-settings");if(t)try{return je.fromJson(t)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",je.toJson(Oe)),Oe}const ue=se(tt());ue.subscribe(t=>{localStorage.setItem("realtime-settings",je.toJson(Oe))});var at=E('<div role="alert" class="alert m-4"><p class="text-lg font-bold"> </p></div>'),nt=E('<p class="text-9xl font-black opacity-50 absolute top-0 left-0 -mt-4 ml-8"> </p>'),st=E('<div class="absolute inset-0 flex items-center justify-center"><span class="text-9xl font-bold opacity-75"> </span></div>'),rt=E('<span class="badge mt-1"> </span>'),ot=E('<span class="text-2xl mt-2"> </span>'),it=E('<span class="badge mt-1"> </span>'),lt=E('<span class="text-2xl mt-2"> </span>'),ct=E('<span class="badge mt-1"> </span>'),ut=E('<div class="absolute origin-center text-center flex flex-col items-center transform-angle svelte-1m75ffo"><div class="avatar rounded-full bg-base-300"><div><img class="w-full h-full"> <!></div></div> <!> <!> <!></div>'),dt=E('<div class="h-full flex flex-col"><!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><p>イラスト : 石黒正数氏</p></aside></footer></div>');function ft(t,e){Te(e,!0);let a=ye(void 0);const m=ue.subscribe(n=>{he(a,Se(n))});De(m);let _,M,v,b;Ne(()=>(window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)})),Be(()=>{x()});function x(){if(!M||!v||!_)return;const n=M.getContext("2d"),s=v.getContext("2d");if(!n||!s)return;const $=_.getBoundingClientRect();[M,v].forEach(y=>{y.width=$.width,y.height=$.height;const C=y.getContext("2d");C&&(C.clearRect(0,0,y.width,y.height),C.globalAlpha=1,C.lineWidth=2)}),e.packet.agents.forEach(y=>{const{idx:C,targetIdxs:P=[],isAlive:H,isBubble:k}=y;if(!H)return;const T=document.getElementById(`agent-${C}`);if(!(T instanceof HTMLElement))return;const R=T.getBoundingClientRect(),N=v.getBoundingClientRect(),Q=R.left+R.width/2-N.left,Z=R.top+R.height/2-N.top;P.forEach(I=>{if(I===-1)return;const u=document.getElementById(`agent-${I}`);if(!(u instanceof HTMLElement))return;const o=u.getBoundingClientRect();K(s,Q,Z,o.left+o.width/2-N.left,o.top+o.height/2-N.top,!1,getComputedStyle(b).getPropertyValue("background-color"))}),k&&K(n,N.width/2,N.height/2,Q,Z,!0,getComputedStyle(b).getPropertyValue("background-color"))})}function K(n,s,$,y,C,P,H){const k=P?[0,0,0,0,0,15]:[0,5,-20,5,-20,15];n.strokeStyle=n.fillStyle=H,n.beginPath();let T=y-s,R=C-$,N=Math.sqrt(T*T+R*R),Q=R/N,Z=T/N,I=[];I.push(0,0);for(let u=0;u<k.length;u+=2){let o=k[u],i=k[u+1];I.push(o<0?N+o:o,i)}I.push(N,0);for(let u=k.length;u>0;u-=2){let o=k[u-2],i=k[u-1];I.push(o<0?N+o:o,-i)}I.push(0,0);for(let u=0;u<I.length;u+=2){let o=I[u]*Z-I[u+1]*Q+s,i=I[u]*Q+I[u+1]*Z+$;u===0?n.moveTo(o,i):n.lineTo(o,i)}n.fill()}var L=dt(),V=c(L);{var g=n=>{var s=at(),$=c(s),y=c($);l($),l(s),U(()=>F(y,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),S(n,s)};Y(V,n=>{var s;(s=r(a))!=null&&s.display.largeScale||n(g)})}var p=f(V,2),h=c(p),J=c(h);{var j=n=>{var s=nt(),$=c(s);l(s),U(()=>F($,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),S(n,s)};Y(J,n=>{var s;(s=r(a))!=null&&s.display.largeScale&&n(j)})}var G=f(J,2);le(G,n=>M=n,()=>M);var X=f(G,2);le(X,n=>v=n,()=>v);var W=f(X,2),te=c(W),z=c(te),D=c(z,!0);l(z),l(te),l(W),le(W,n=>b=n,()=>b);var d=f(W,2);xe(d,17,()=>e.packet.agents,we,(n,s,$)=>{var y=ut(),C=c(y),P=c(C),H=c(P),k=f(H,2);{var T=o=>{var i=st(),w=c(i),q=c(w,!0);l(w),l(i),U(()=>F(q,r(s).idx)),S(o,i)};Y(k,o=>{var i,w;(i=r(a))!=null&&i.display.largeScale&&((w=r(a))!=null&&w.display.agent.name)&&o(T)})}l(P),l(C);var R=f(C,2);{var N=o=>{var i=rt(),w=c(i,!0);l(i),U(q=>F(w,q),[()=>Re(r(s).idx)]),S(o,i)};Y(R,o=>{var i,w;!((i=r(a))!=null&&i.display.largeScale)&&((w=r(a))!=null&&w.display.agent.name)&&o(N)})}var Q=f(R,2);{var Z=o=>{var i=_e(),w=ge(i);{var q=A=>{var O=ot(),ne=c(O,!0);l(O),U(()=>F(ne,r(s).team)),S(A,O)},B=A=>{var O=it(),ne=c(O,!0);l(O),U(()=>F(ne,r(s).team)),S(A,O)};Y(w,A=>{var O;(O=r(a))!=null&&O.display.largeScale?A(q):A(B,!1)})}S(o,i)};Y(Q,o=>{var i;(i=r(a))!=null&&i.display.agent.team&&o(Z)})}var I=f(Q,2);{var u=o=>{var i=_e(),w=ge(i);{var q=A=>{var O=lt(),ne=c(O,!0);l(O),U(()=>F(ne,r(s).role)),S(A,O)},B=A=>{var O=ct(),ne=c(O,!0);l(O),U(()=>F(ne,r(s).role)),S(A,O)};Y(w,A=>{var O;(O=r(a))!=null&&O.display.largeScale?A(q):A(B,!1)})}S(o,i)};Y(I,o=>{var i;(i=r(a))!=null&&i.display.agent.role&&o(u)})}l(y),U(o=>{var i;ve(y,"style",`--angle: ${$*(360/e.packet.agents.length)}`),ve(y,"id",`agent-${r(s).idx??""}`),Je(P,$e((i=r(a))!=null&&i.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-1m75ffo"),Ce(P,"ring-success",r(s).isAlive),Ce(P,"ring-error",!r(s).isAlive),Ge(P,"opacity",r(s).isAlive?1:.25),ve(H,"src",`${He??""}/images/male/${o??""}.png`),ve(H,"alt",r(s).name)},[()=>r(s).idx.toString().padStart(2,"0")]),S(n,y)}),l(h),le(h,n=>_=n,()=>_),l(p),ie(2),l(L),U(()=>{var n;W.hidden=!e.packet.message,Je(z,$e((n=r(a))!=null&&n.display.largeScale?"text-3xl font-bold text-pretty text-center":"text-lg text-pretty text-center"),"svelte-1m75ffo"),F(D,e.packet.message)}),S(t,L),Ae()}function vt(){const{subscribe:t,update:e}=se({status:"disconnected",entries:{}});let a=null,m=null;ue.subscribe(v=>{m=v});function _(){if(!m)return;e(b=>({...b,status:"connecting"}));const v=new URL(m.connection.url);m.connection.token&&v.searchParams.set("token",m.connection.token),a=new WebSocket(v),a.onopen=()=>{e(b=>({...b,status:"connected"}))},a.onclose=()=>{e(b=>({...b,status:"disconnected"})),a=null},a.onerror=()=>{e(b=>({...b,status:"disconnected"})),a=null},a.onmessage=b=>{try{const x=JSON.parse(b.data);e(K=>{const L={...K.entries};return L[x.id]||(L[x.id]=[]),L[x.id].push(x),{...K,entries:L}})}catch(x){console.error("Failed to parse message:",x)}}}function M(){a&&(e(v=>({...v,status:"disconnected"})),a.close(),a=null)}return{subscribe:t,connect:_,disconnect:M,entries:{subscribe:v=>t(b=>v(b.entries))}}}const de=vt();function mt(){de.connect()}function bt(){de.disconnect()}var pt=E('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),gt=E('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),_t=E('<div class="status status-error"></div>'),ht=(t,e)=>e("connection.url",t.currentTarget.value),yt=(t,e)=>e("connection.token",t.currentTarget.value),xt=(t,e)=>e("display.agent.name",t.currentTarget.checked),wt=(t,e)=>e("display.agent.team",t.currentTarget.checked),St=(t,e)=>e("display.agent.role",t.currentTarget.checked),jt=(t,e)=>e("display.largeScale",t.currentTarget.checked),kt=E('<div class="navbar bg-base-100 flex justify-start"><h1 class="text-3xl font-bold truncate mx-4">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info mx-2">接続</button> <button class="btn btn-error mx-2">切断</button> <button class="btn mx-2">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">表示設定</h3> <h4 class="text-base font-bold mt-4">エージェント</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2 mx-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Ot(t,e){Te(e,!0);let a=ye(void 0),m=ye(void 0);const _=ue.subscribe(u=>{he(a,Se(u))}),M=de.subscribe(u=>{he(m,Se(u.status))});De(()=>{_(),M()});function v(u,o){ue.update(i=>{const w=u.split("."),q=w.pop();let B=i;for(const A of w)A&&(B=B[A]);return B[q]=o,{...i}})}let b;var x=kt(),K=f(c(x),2),L=c(K),V=c(L);{var g=u=>{var o=pt();ie(2),S(u,o)},p=u=>{var o=_e(),i=ge(o);{var w=B=>{var A=gt();ie(2),S(B,A)},q=B=>{var A=_t();S(B,A)};Y(i,B=>{r(m)==="connecting"?B(w):B(q,!1)},!0)}S(u,o)};Y(V,u=>{r(m)==="connected"?u(g):u(p,!1)})}l(L),l(K);var h=f(K,2),J=c(h);ee(J,"class","h-[1em] opacity-50"),ee(J,"inline",!0),ee(J,"icon","mdi:link");var j=f(J,2);re(j),j.__input=[ht,v],l(h);var G=f(h,2),X=c(G);ee(X,"class","h-[1em] opacity-50"),ee(X,"inline",!0),ee(X,"icon","mdi:key");var W=f(X,2);re(W),W.__input=[yt,v],ie(2),l(G);var te=f(G,2);te.__click=[mt];var z=f(te,2);z.__click=[bt];var D=f(z,2);D.__click=()=>b.showModal();var d=f(D,2),n=c(d),s=c(n),$=f(c(s),4),y=c($),C=f(c(y),2);re(C),C.__change=[xt,v],l(y);var P=f(y,2),H=f(c(P),2);re(H),H.__change=[wt,v],l(P);var k=f(P,2),T=f(c(k),2);re(T),T.__change=[St,v],l(k),l($);var R=f($,4),N=f(c(R),2);re(N),N.__change=[jt,v],l(R),l(s),l(n),ie(2),l(d),le(d,u=>b=u,()=>b);var Q=f(d,2),Z=c(Q);ee(Z,"inline",!0),ee(Z,"icon","mdi:white-balance-sunny");var I=f(Z,4);ee(I,"inline",!0),ee(I,"icon","mdi:moon-and-stars"),l(Q),l(x),U(()=>{var u,o,i,w,q,B;Ee(j,(u=r(a))==null?void 0:u.connection.url),Ee(W,(o=r(a))==null?void 0:o.connection.token),te.disabled=r(m)!=="disconnected",z.disabled=r(m)==="disconnected",me(C,(i=r(a))==null?void 0:i.display.agent.name),me(H,(w=r(a))==null?void 0:w.display.agent.team),me(T,(q=r(a))==null?void 0:q.display.agent.role),me(N,(B=r(a))==null?void 0:B.display.largeScale)}),S(t,x),Ae()}ze(["input","click","change"]);function Pe(t){return Array.from({length:t},(e,a)=>({idx:a+1,team:"Undefined",name:Re(a+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}var Tt=E("<option> </option>"),At=E('<div class="divider"> </div>'),Dt=E('<div class="divider"> </div>'),Et=E('<!> <!> <button class="btn"> </button>',1),Jt=E('<main class="h-screen flex flex-col"><!> <div class="flex flex-1 overflow-hidden w-full flex-col md:flex-row"><div class="flex-auto bg-base-300"><!></div> <div class="w-full md:w-64 max-md:h-32 flex flex-col bg-base-200 px-2"><select class="select"></select> <ul class="list overflow-y-auto flex-1"></ul></div></div></main>');function Gt(t,e){Te(e,!1);const[a,m]=We(),_=()=>fe(g,"$status",a),M=()=>fe(L,"$currentPacket",a),v=()=>fe(x,"$selectedId",a),b=()=>fe(V,"$entries",a),x=se(""),K=se(0),L=se({id:"",idx:-1,day:0,isDay:!0,agents:Pe(5),message:"未接続",summary:"未接続",isDivider:!1}),V=se({}),g=se("");Ne(()=>{const z=de.entries.subscribe(d=>{V.set(d),x.update(n=>n||Object.keys(d)[0]||"")}),D=de.subscribe(d=>{g.set(d.status)});x.subscribe(d=>{V.update(n=>{var s;return d&&((s=n[d])==null?void 0:s.length)>0&&K.set(n[d].length-1),n})}),Fe([x,K,V],([d,n,s])=>s[d]&&n>=0&&n<s[d].length?s[d][n]:{id:"",idx:-1,day:0,isDay:!0,agents:Pe(5),message:"未接続",summary:"未接続",isDivider:!1}).subscribe(d=>{L.set(d)}),De(()=>{z(),D()}),window.addEventListener("beforeunload",d=>{_()==="connecting"&&d.preventDefault()})}),Ie();var p=Jt();Ue(z=>{Me.title="aiwolf-nlp-viewer"});var h=c(p);Ot(h,{});var J=f(h,2),j=c(J),G=c(j);ft(G,{get packet(){return M()}}),l(j);var X=f(j,2),W=c(X);U(()=>{v(),Le(()=>{b()})}),xe(W,5,()=>Object.keys(b()),we,(z,D)=>{var d=Tt(),n={},s=c(d,!0);l(d),U(()=>{n!==(n=r(D))&&(d.value=(d.__value=r(D))==null?"":r(D)),F(s,r(D))}),S(z,d)}),l(W);var te=f(W,2);xe(te,5,()=>b()[v()]||[],we,(z,D,d)=>{var n=Et(),s=ge(n);{var $=k=>{var T=At(),R=c(T);l(T),U(()=>F(R,`${r(D).day??""}日目 ${(r(D).isDay?"昼":"夜")??""}`)),S(k,T)};Y(s,k=>{d>0&&(r(D).day!==b()[v()][d-1].day||r(D).isDay!==b()[v()][d-1].isDay)&&k($)})}var y=f(s,2);{var C=k=>{var T=Dt(),R=c(T);l(T),U(()=>F(R,`${r(D).day??""}日目 ${(r(D).isDay?"昼":"夜")??""}`)),S(k,T)};Y(y,k=>{d==0&&k(C)})}var P=f(y,2),H=c(P);l(P),U(()=>F(H,`${d+1}. ${r(D).summary??""}`)),Ke("click",P,()=>K.set(d)),S(z,n)}),l(te),l(X),l(J),l(p),Ve(W,v,z=>qe(x,z)),S(t,p),Ae(),m()}export{Gt as component};
