import{t as D,a as O,d as _e}from"../chunks/CYHUnqUB.js";import{i as Be}from"../chunks/Dsc93adF.js";import{p as Ae,d as he,aq as Me,i as K,a as Ee,aG as xe,s as f,c as u,g as c,r as i,aI as ie,aA as ye,$ as Le,aJ as ze}from"../chunks/C6VFkXJ6.js";import{s as Q}from"../chunks/CcTxLL8i.js";import{e as we,i as Se}from"../chunks/CDvNhuoa.js";import{d as Ne,h as Ue}from"../chunks/BLcQzrmO.js";import{b as Ke}from"../chunks/sAJ58j3v.js";import{s as fe,a as Ve,b as We}from"../chunks/COMcsTtA.js";import{i as ee}from"../chunks/DbQD98kR.js";import{a as ve,s as Z,r as re,b as Ce,c as me}from"../chunks/D4mFRh8Z.js";import{s as De,c as Pe,t as ge,I as Ie}from"../chunks/CYwAZ6XH.js";import{p as ke}from"../chunks/BZhcqTp8.js";import{b as le}from"../chunks/CbL9dJBF.js";import{a as Je,o as $e}from"../chunks/KQcy5SQk.js";import{b as qe}from"../chunks/CD-SOVic.js";import{w as se,d as He}from"../chunks/DtOi-0f6.js";/* empty css                */function Fe(t,e,a,m){var _=t.__styles??(t.__styles={});_[e]!==a&&(_[e]=a,a==null?t.style.removeProperty(e):t.style.setProperty(e,a,""))}class je{static fromJson(e){return Ye(JSON.parse(e),ce("RealtimeSettings"))}static toJson(e){return JSON.stringify(Qe(e,ce("RealtimeSettings")),null,2)}}function ae(t,e,a,m=""){const _=Oe(t),P=m?` on ${m}`:"",v=a?` for key "${a}"`:"";throw Error(`Invalid value${v}${P}. Expected ${_} but got ${JSON.stringify(e)}`)}function Oe(t){return Array.isArray(t)?t.length===2&&t[0]===void 0?`an optional ${Oe(t[1])}`:`one of [${t.map(e=>Oe(e)).join(", ")}]`:typeof t=="object"&&t.literal!==void 0?t.literal:typeof t}function Ge(t){if(t.jsonToJS===void 0){const e={};t.props.forEach(a=>e[a.json]={key:a.js,typ:a.typ}),t.jsonToJS=e}return t.jsonToJS}function Xe(t){if(t.jsToJSON===void 0){const e={};t.props.forEach(a=>e[a.js]={key:a.json,typ:a.typ}),t.jsToJSON=e}return t.jsToJSON}function oe(t,e,a,m="",_=""){function P(g,p){return typeof g==typeof p?p:ae(g,p,m,_)}function v(g,p){const h=g.length;for(let T=0;T<h;T++){const S=g[T];try{return oe(p,S,a)}catch{}}return ae(g,p,m,_)}function b(g,p){return g.indexOf(p)!==-1?p:ae(g.map(h=>pe(h)),p,m,_)}function y(g,p){return Array.isArray(p)?p.map(h=>oe(h,g,a)):ae(pe("array"),p,m,_)}function $(g){if(g===null)return null;const p=new Date(g);return isNaN(p.valueOf())?ae(pe("Date"),g,m,_):p}function R(g,p,h){if(h===null||typeof h!="object"||Array.isArray(h))return ae(pe(B||"object"),h,m,_);const T={};return Object.getOwnPropertyNames(g).forEach(S=>{const q=g[S],H=Object.prototype.hasOwnProperty.call(h,S)?h[S]:void 0;T[q.key]=oe(H,q.typ,a,S,B)}),Object.getOwnPropertyNames(h).forEach(S=>{Object.prototype.hasOwnProperty.call(g,S)||(T[S]=oe(h[S],p,a,S,B))}),T}if(e==="any")return t;if(e===null)return t===null?t:ae(e,t,m,_);if(e===!1)return ae(e,t,m,_);let B;for(;typeof e=="object"&&e.ref!==void 0;)B=e.ref,e=Ze[e.ref];return Array.isArray(e)?b(e,t):typeof e=="object"?e.hasOwnProperty("unionMembers")?v(e.unionMembers,t):e.hasOwnProperty("arrayItems")?y(e.arrayItems,t):e.hasOwnProperty("props")?R(a(e),e.additional,t):ae(e,t,m,_):e===Date&&typeof t!="number"?$(t):P(e,t)}function Ye(t,e){return oe(t,e,Ge)}function Qe(t,e){return oe(t,e,Xe)}function pe(t){return{literal:t}}function be(t,e){return{props:t,additional:e}}function ce(t){return{ref:t}}const Ze={RealtimeSettings:be([{json:"connection",js:"connection",typ:ce("Connection")},{json:"display",js:"display",typ:ce("Display")}],!1),Connection:be([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:be([{json:"agent",js:"agent",typ:ce("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:be([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},Te={connection:{url:"ws://localhost:8080/realtime",token:""},display:{agent:{name:!0,team:!0,role:!0},largeScale:!1}};function et(){const t=localStorage.getItem("realtime-settings");if(t)try{return je.fromJson(t)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",je.toJson(Te)),Te}const ue=se(et());ue.subscribe(t=>{localStorage.setItem("realtime-settings",je.toJson(Te))});var tt=D('<div role="alert" class="alert m-4"><p class="text-lg font-bold"> </p></div>'),at=D('<p class="text-9xl font-black opacity-50 absolute top-0 left-0 -mt-4 ml-8"> </p>'),nt=D('<div class="absolute inset-0 flex items-center justify-center"><span class="text-9xl font-bold opacity-75"> </span></div>'),st=D('<span class="badge mt-1"> </span>'),rt=D('<span class="text-2xl mt-2"> </span>'),ot=D('<span class="badge mt-1"> </span>'),it=D('<span class="text-2xl mt-2"> </span>'),lt=D('<span class="badge mt-1"> </span>'),ct=D('<div class="absolute origin-center text-center flex flex-col items-center transform-angle svelte-1m75ffo"><div class="avatar"><div><img class="w-full h-full"> <!></div></div> <!> <!> <!></div>'),ut=D('<div class="h-full flex flex-col"><!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><p>イラスト : 石黒正数氏</p></aside></footer></div>');function dt(t,e){Ae(e,!0);let a=xe(void 0);const m=ue.subscribe(n=>{he(a,ke(n))});Je(m);let _,P,v,b;$e(()=>(window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y)})),Me(()=>{y()});function y(){if(!P||!v||!_)return;const n=P.getContext("2d"),s=v.getContext("2d");if(!n||!s)return;const I=_.getBoundingClientRect();[P,v].forEach(w=>{w.width=I.width,w.height=I.height;const J=w.getContext("2d");J&&(J.clearRect(0,0,w.width,w.height),J.globalAlpha=1,J.lineWidth=2)}),e.packet.agents.forEach(w=>{const{idx:J,targetIdxs:L=[],isAlive:G,isBubble:W}=w;if(!G)return;const F=document.getElementById(`agent-${J}`);if(!(F instanceof HTMLElement))return;const z=F.getBoundingClientRect(),A=v.getBoundingClientRect(),X=z.left+z.width/2-A.left,Y=z.top+z.height/2-A.top;L.forEach(E=>{if(E===-1)return;const l=document.getElementById(`agent-${E}`);if(!(l instanceof HTMLElement))return;const r=l.getBoundingClientRect();$(s,X,Y,r.left+r.width/2-A.left,r.top+r.height/2-A.top,!1,getComputedStyle(b).getPropertyValue("background-color"))}),W&&$(n,A.width/2,A.height/2,X,Y,!0,getComputedStyle(b).getPropertyValue("background-color"))})}function $(n,s,I,w,J,L,G){const W=L?[0,0,0,0,0,15]:[0,5,-20,5,-20,15];n.strokeStyle=n.fillStyle=G,n.beginPath();let F=w-s,z=J-I,A=Math.sqrt(F*F+z*z),X=z/A,Y=F/A,E=[];E.push(0,0);for(let l=0;l<W.length;l+=2){let r=W[l],o=W[l+1];E.push(r<0?A+r:r,o)}E.push(A,0);for(let l=W.length;l>0;l-=2){let r=W[l-2],o=W[l-1];E.push(r<0?A+r:r,-o)}E.push(0,0);for(let l=0;l<E.length;l+=2){let r=E[l]*Y-E[l+1]*X+s,o=E[l]*X+E[l+1]*Y+I;l===0?n.moveTo(r,o):n.lineTo(r,o)}n.fill()}var R=ut(),B=u(R);{var g=n=>{var s=tt(),I=u(s),w=u(I);i(I),i(s),K(()=>Q(w,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),O(n,s)};ee(B,n=>{var s;(s=c(a))!=null&&s.display.largeScale||n(g)})}var p=f(B,2),h=u(p),T=u(h);{var S=n=>{var s=at(),I=u(s);i(s),K(()=>Q(I,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),O(n,s)};ee(T,n=>{var s;(s=c(a))!=null&&s.display.largeScale&&n(S)})}var q=f(T,2);le(q,n=>P=n,()=>P);var H=f(q,2);le(H,n=>v=n,()=>v);var M=f(H,2),te=u(M),N=u(te),V=u(N,!0);i(N),i(te),i(M),le(M,n=>b=n,()=>b);var d=f(M,2);we(d,17,()=>e.packet.agents,Se,(n,s,I)=>{var w=ct(),J=u(w),L=u(J),G=u(L),W=f(G,2);{var F=r=>{var o=nt(),x=u(o),U=u(x,!0);i(x),i(o),K(()=>Q(U,c(s).idx)),O(r,o)};ee(W,r=>{var o,x;(o=c(a))!=null&&o.display.largeScale&&((x=c(a))!=null&&x.display.agent.name)&&r(F)})}i(L),i(J);var z=f(J,2);{var A=r=>{var o=st(),x=u(o,!0);i(o),K(U=>Q(x,U),[()=>Ie(c(s).idx)]),O(r,o)};ee(z,r=>{var o,x;!((o=c(a))!=null&&o.display.largeScale)&&((x=c(a))!=null&&x.display.agent.name)&&r(A)})}var X=f(z,2);{var Y=r=>{var o=_e(),x=ye(o);{var U=j=>{var k=rt(),ne=u(k,!0);i(k),K(()=>Q(ne,c(s).team)),O(j,k)},C=j=>{var k=ot(),ne=u(k,!0);i(k),K(()=>Q(ne,c(s).team)),O(j,k)};ee(x,j=>{var k;(k=c(a))!=null&&k.display.largeScale?j(U):j(C,!1)})}O(r,o)};ee(X,r=>{var o;(o=c(a))!=null&&o.display.agent.team&&r(Y)})}var E=f(X,2);{var l=r=>{var o=_e(),x=ye(o);{var U=j=>{var k=it(),ne=u(k,!0);i(k),K(()=>Q(ne,c(s).role)),O(j,k)},C=j=>{var k=lt(),ne=u(k,!0);i(k),K(()=>Q(ne,c(s).role)),O(j,k)};ee(x,j=>{var k;(k=c(a))!=null&&k.display.largeScale?j(U):j(C,!1)})}O(r,o)};ee(E,r=>{var o;(o=c(a))!=null&&o.display.agent.role&&r(l)})}i(w),K(r=>{var o,x;ve(w,"style",`--angle: ${I*(360/e.packet.agents.length)}`),ve(w,"id",`agent-${c(s).idx??""}`),ge(J,"indicator",(o=c(a))==null?void 0:o.display.largeScale),De(L,Pe((x=c(a))!=null&&x.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-1m75ffo"),ge(L,"ring-success",c(s).isAlive),ge(L,"ring-error",!c(s).isAlive),Fe(L,"opacity",c(s).isAlive?1:.25),ve(G,"src",`${qe??""}/images/male/${r??""}.png`),ve(G,"alt",c(s).name)},[()=>c(s).idx.toString().padStart(2,"0")]),O(n,w)}),i(h),le(h,n=>_=n,()=>_),i(p),ie(2),i(R),K(()=>{var n;M.hidden=!e.packet.message,De(N,Pe((n=c(a))!=null&&n.display.largeScale?"text-3xl font-bold text-pretty text-center":"text-lg text-pretty text-center"),"svelte-1m75ffo"),Q(V,e.packet.message)}),O(t,R),Ee()}function ft(){const{subscribe:t,update:e}=se({status:"disconnected",entries:{}});let a=null,m=null;ue.subscribe(v=>{m=v});function _(){if(!m)return;e(b=>({...b,status:"connecting"}));const v=new URL(m.connection.url);m.connection.token&&v.searchParams.set("token",m.connection.token),a=new WebSocket(v),a.onopen=()=>{e(b=>({...b,status:"connected"}))},a.onclose=()=>{e(b=>({...b,status:"disconnected"})),a=null},a.onerror=()=>{e(b=>({...b,status:"disconnected"})),a=null},a.onmessage=b=>{try{const y=JSON.parse(b.data);e($=>{const R={...$.entries};return R[y.id]||(R[y.id]=[]),R[y.id].push(y),{...$,entries:R}})}catch(y){console.error("Failed to parse message:",y)}}}function P(){a&&(e(v=>({...v,status:"disconnected"})),a.close(),a=null)}return{subscribe:t,connect:_,disconnect:P,entries:{subscribe:v=>t(b=>v(b.entries))}}}const de=ft();function vt(){de.connect()}function mt(){de.disconnect()}var pt=D('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),bt=D('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),gt=D('<div class="status status-error"></div>'),_t=(t,e)=>e("connection.url",t.currentTarget.value),ht=(t,e)=>e("connection.token",t.currentTarget.value),xt=(t,e)=>e("display.agent.name",t.currentTarget.checked),yt=(t,e)=>e("display.agent.team",t.currentTarget.checked),wt=(t,e)=>e("display.agent.role",t.currentTarget.checked),St=(t,e)=>e("display.largeScale",t.currentTarget.checked),kt=D('<div class="navbar bg-base-100 flex justify-start"><h1 class="text-3xl font-bold truncate mx-4">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info mx-2">接続</button> <button class="btn btn-error mx-2">切断</button> <button class="btn mx-2">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">表示設定</h3> <h4 class="text-base font-bold mt-4">エージェント</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2 mx-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function jt(t,e){Ae(e,!0);let a=xe(void 0),m=xe(void 0);const _=ue.subscribe(l=>{he(a,ke(l))}),P=de.subscribe(l=>{he(m,ke(l.status))});Je(()=>{_(),P()});function v(l,r){ue.update(o=>{const x=l.split("."),U=x.pop();let C=o;for(const j of x)j&&(C=C[j]);return C[U]=r,{...o}})}let b;var y=kt(),$=f(u(y),2),R=u($),B=u(R);{var g=l=>{var r=pt();ie(2),O(l,r)},p=l=>{var r=_e(),o=ye(r);{var x=C=>{var j=bt();ie(2),O(C,j)},U=C=>{var j=gt();O(C,j)};ee(o,C=>{c(m)==="connecting"?C(x):C(U,!1)},!0)}O(l,r)};ee(B,l=>{c(m)==="connected"?l(g):l(p,!1)})}i(R),i($);var h=f($,2),T=u(h);Z(T,"class","h-[1em] opacity-50"),Z(T,"inline",!0),Z(T,"icon","mdi:link");var S=f(T,2);re(S),S.__input=[_t,v],i(h);var q=f(h,2),H=u(q);Z(H,"class","h-[1em] opacity-50"),Z(H,"inline",!0),Z(H,"icon","mdi:key");var M=f(H,2);re(M),M.__input=[ht,v],ie(2),i(q);var te=f(q,2);te.__click=[vt];var N=f(te,2);N.__click=[mt];var V=f(N,2);V.__click=()=>b.showModal();var d=f(V,2),n=u(d),s=u(n),I=f(u(s),4),w=u(I),J=f(u(w),2);re(J),J.__change=[xt,v],i(w);var L=f(w,2),G=f(u(L),2);re(G),G.__change=[yt,v],i(L);var W=f(L,2),F=f(u(W),2);re(F),F.__change=[wt,v],i(W),i(I);var z=f(I,4),A=f(u(z),2);re(A),A.__change=[St,v],i(z),i(s),i(n),ie(2),i(d),le(d,l=>b=l,()=>b);var X=f(d,2),Y=u(X);Z(Y,"inline",!0),Z(Y,"icon","mdi:white-balance-sunny");var E=f(Y,4);Z(E,"inline",!0),Z(E,"icon","mdi:moon-and-stars"),i(X),i(y),K(()=>{var l,r,o,x,U,C;Ce(S,(l=c(a))==null?void 0:l.connection.url),Ce(M,(r=c(a))==null?void 0:r.connection.token),te.disabled=c(m)!=="disconnected",N.disabled=c(m)==="disconnected",me(J,(o=c(a))==null?void 0:o.display.agent.name),me(G,(x=c(a))==null?void 0:x.display.agent.team),me(F,(U=c(a))==null?void 0:U.display.agent.role),me(A,(C=c(a))==null?void 0:C.display.largeScale)}),O(t,y),Ee()}Ne(["input","click","change"]);function Re(t){return Array.from({length:t},(e,a)=>({idx:a+1,team:"Undefined",name:Ie(a+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}var Ot=D("<option> </option>"),Tt=D('<button class="btn"> </button>'),At=D('<main class="h-screen flex flex-col"><!> <div class="flex flex-1 overflow-hidden w-full flex-col md:flex-row"><div class="flex-auto bg-base-300"><!></div> <div class="w-full md:w-64 max-md:h-32 flex flex-col bg-base-200 px-2"><select class="select"></select> <ul class="list overflow-y-auto flex-1"></ul></div></div></main>');function qt(t,e){Ae(e,!1);const[a,m]=Ve(),_=()=>fe(g,"$status",a),P=()=>fe(R,"$currentPacket",a),v=()=>fe(y,"$selectedId",a),b=()=>fe(B,"$entries",a),y=se(""),$=se(0),R=se({id:"",idx:-1,day:0,isDay:!0,agents:Re(5),message:"未接続",summary:"未接続",isDivider:!1}),B=se({}),g=se("");$e(()=>{const N=de.entries.subscribe(d=>{B.set(d),y.update(n=>n||Object.keys(d)[0]||"")}),V=de.subscribe(d=>{g.set(d.status)});y.subscribe(d=>{B.update(n=>{var s;return d&&((s=n[d])==null?void 0:s.length)>0&&$.set(n[d].length-1),n})}),He([y,$,B],([d,n,s])=>s[d]&&n>=0&&n<s[d].length?s[d][n]:{id:"",idx:-1,day:0,isDay:!0,agents:Re(5),message:"未接続",summary:"未接続",isDivider:!1}).subscribe(d=>{R.set(d)}),Je(()=>{N(),V()}),window.addEventListener("beforeunload",d=>{_()==="connecting"&&d.preventDefault()})}),Be();var p=At();Ue(N=>{Le.title="aiwolf-nlp-viewer"});var h=u(p);jt(h,{});var T=f(h,2),S=u(T),q=u(S);dt(q,{get packet(){return P()}}),i(S);var H=f(S,2),M=u(H);K(()=>{v(),ze(()=>{b()})}),we(M,5,()=>Object.keys(b()),Se,(N,V)=>{var d=Ot(),n={},s=u(d,!0);i(d),K(()=>{n!==(n=c(V))&&(d.value=(d.__value=c(V))==null?"":c(V)),Q(s,c(V))}),O(N,d)}),i(M);var te=f(M,2);we(te,5,()=>b()[v()]||[],Se,(N,V,d)=>{var n=Tt();n.__click=()=>$.set(d);var s=u(n);i(n),K(()=>Q(s,`${d+1}. ${c(V).summary??""}`)),O(N,n)}),i(te),i(H),i(T),i(p),Ke(M,v,N=>We(y,N)),O(t,p),Ee(),m()}Ne(["click"]);export{qt as component};
