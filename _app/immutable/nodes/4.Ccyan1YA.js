import{t as K,a as F}from"../chunks/hEf28_al.js";import{i as be}from"../chunks/NYQxgFJq.js";import{p as le,f as X,a9 as ye,t as q,a as ce,aF as _e,c as s,s as o,r as n,aH as oe,g as t,m as G,$ as ke}from"../chunks/BaJkMvzh.js";import{s as Y}from"../chunks/DB3GrP0H.js";import{e as pe,i as me}from"../chunks/CxiiFHbX.js";import{e as J,h as we}from"../chunks/BznZzeTG.js";import{a as de,o as Se}from"../chunks/-4Bip2as.js";import{i as ie}from"../chunks/2lBR0iQD.js";import{s as ne,a as H,r as Z,b as fe,c as re}from"../chunks/n0xSycqS.js";import{t as $,I as ge}from"../chunks/BUjHXMF0.js";import{p as Ce}from"../chunks/CYlRyKWv.js";import{b as ee}from"../chunks/CNI5WDRY.js";import{b as Ee}from"../chunks/BGv21vIa.js";import{w as he}from"../chunks/BMyaHLVp.js";/* empty css                */function Re(v,r,a,d){var w=v.__styles??(v.__styles={});w[r]!==a&&(w[r]=a,a==null?v.style.removeProperty(r):v.style.setProperty(r,a,""))}const Ae={connection:{url:"ws://localhost:8080/realtime",token:""},display:{agent:{name:!0,team:!0,role:!0}}};function Te(){const v=localStorage.getItem("realtime-settings");if(v)try{return JSON.parse(v)}catch(r){console.error(r)}return Ae}const ae=he(Te());ae.subscribe(v=>{localStorage.setItem("realtime-settings",JSON.stringify(v))});var Be=K('<span class="badge mt-1"> </span>'),Pe=K('<span class="badge mt-1"> </span>'),Le=K('<span class="badge mt-1"> </span>'),ze=K('<div class="absolute origin-center text-center flex flex-col items-center transform-angle svelte-1fcam1a"><div class="avatar"><div class="w-24 rounded-full ring-offset-base-100 ring ring-offset-2 svelte-1fcam1a"><img></div></div> <!> <!> <!></div>'),De=K('<div class="h-full flex flex-col"><div role="alert" class="alert m-4"><p class="text-lg font-bold"> </p></div> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><canvas class="w-full h-full absolute top-0 left-0"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-xs shadow-sm overflow-auto p-4 z-20"><div class="card-body"><p class="text-lg text-pretty text-center"> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><p>イラスト : 石黒正数氏</p></aside></footer></div>');function Ie(v,r){le(r,!0);let a=_e(void 0);const d=ae.subscribe(c=>{X(a,Ce(c))});de(d);let w,x,l,b;Se(()=>(window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)})),ye(()=>{S()});function S(){if(!x||!l||!w)return;const c=x.getContext("2d"),p=l.getContext("2d");if(!c||!p)return;const M=w.getBoundingClientRect();[x,l].forEach(m=>{m.width=M.width,m.height=M.height;const _=m.getContext("2d");_&&(_.clearRect(0,0,m.width,m.height),_.globalAlpha=1,_.lineWidth=2)}),r.packet.agents.forEach(m=>{const{idx:_,targetIdxs:E=[],isAlive:j,isBubble:k}=m;if(!j)return;const A=document.getElementById(`agent-${_}`);if(!(A instanceof HTMLElement))return;const C=A.getBoundingClientRect(),h=l.getBoundingClientRect(),N=C.left+C.width/2-h.left,P=C.top+C.height/2-h.top;E.forEach(i=>{if(i===-1)return;const e=document.getElementById(`agent-${i}`);if(!(e instanceof HTMLElement))return;const u=e.getBoundingClientRect();R(p,N,P,u.left+u.width/2-h.left,u.top+u.height/2-h.top,!1,getComputedStyle(b).getPropertyValue("background-color"))}),k&&R(c,h.width/2,h.height/2,N,P,!0,getComputedStyle(b).getPropertyValue("background-color"))})}function R(c,p,M,m,_,E,j){const k=E?[0,0,0,0,0,15]:[0,5,-20,5,-20,15];c.strokeStyle=c.fillStyle=j,c.beginPath();let A=m-p,C=_-M,h=Math.sqrt(A*A+C*C),N=C/h,P=A/h,i=[];i.push(0,0);for(let e=0;e<k.length;e+=2){let u=k[e],L=k[e+1];i.push(u<0?h+u:u,L)}i.push(h,0);for(let e=k.length;e>0;e-=2){let u=k[e-2],L=k[e-1];i.push(u<0?h+u:u,-L)}i.push(0,0);for(let e=0;e<i.length;e+=2){let u=i[e]*P-i[e+1]*N+p,L=i[e]*N+i[e+1]*P+M;e===0?c.moveTo(u,L):c.lineTo(u,L)}c.fill()}var y=De(),z=s(y),U=s(z),T=s(U);n(U),n(z);var W=o(z,2),D=s(W),I=s(D);ee(I,c=>x=c,()=>x);var f=o(I,2);ee(f,c=>l=c,()=>l);var g=o(f,2),O=s(g),B=s(O),V=s(B,!0);n(B),n(O),n(g),ee(g,c=>b=c,()=>b);var Q=o(g,2);pe(Q,17,()=>r.packet.agents,me,(c,p,M)=>{var m=ze(),_=s(m),E=s(_),j=s(E);n(E),n(_);var k=o(_,2);{var A=i=>{var e=Be(),u=s(e,!0);n(e),q(L=>Y(u,L),[()=>ge(t(p).idx)]),F(i,e)};ie(k,i=>{var e;(e=t(a))!=null&&e.display.agent.name&&i(A)})}var C=o(k,2);{var h=i=>{var e=Pe(),u=s(e,!0);n(e),q(()=>Y(u,t(p).team)),F(i,e)};ie(C,i=>{var e;(e=t(a))!=null&&e.display.agent.team&&i(h)})}var N=o(C,2);{var P=i=>{var e=Le(),u=s(e,!0);n(e),q(()=>Y(u,t(p).role)),F(i,e)};ie(N,i=>{var e;(e=t(a))!=null&&e.display.agent.role&&i(P)})}n(m),q(i=>{ne(m,"style",`--angle: ${M*(360/r.packet.agents.length)}`),ne(m,"id",`agent-${t(p).idx??""}`),$(E,"ring-success",t(p).isAlive),$(E,"ring-error",!t(p).isAlive),Re(E,"opacity",t(p).isAlive?1:.25),ne(j,"src",`${Ee??""}/images/male/${i??""}.png`),ne(j,"alt",t(p).name)},[()=>t(p).idx.toString().padStart(2,"0")]),F(c,m)}),n(D),ee(D,c=>w=c,()=>w),n(W),oe(2),n(y),q(()=>{Y(T,`${r.packet.day??""}日目 ${(r.packet.isDay?"昼":"夜")??""}`),g.hidden=!r.packet.message,Y(V,r.packet.message)}),F(v,y),ce()}function Oe(){const{subscribe:v,update:r}=he({status:"disconnected",entries:{}});let a=null,d=null;ae.subscribe(l=>{d=l});function w(){if(!d)return;r(b=>({...b,status:"connecting"}));const l=new URL(d.connection.url);d.connection.token&&l.searchParams.set("token",d.connection.token),a=new WebSocket(l),a.onopen=()=>{r(b=>({...b,status:"connected"}))},a.onclose=()=>{r(b=>({...b,status:"disconnected"})),a=null},a.onerror=()=>{r(b=>({...b,status:"disconnected"})),a=null},a.onmessage=b=>{try{const S=JSON.parse(b.data);r(R=>{const y={...R.entries};return y[S.id]||(y[S.id]=[]),y[S.id].push(S),{...R,entries:y}})}catch(S){console.error("Failed to parse message:",S)}}}function x(){a&&(r(l=>({...l,status:"disconnected"})),a.close(),a=null)}return{subscribe:v,connect:w,disconnect:x,entries:{subscribe:l=>v(b=>l(b.entries))}}}const te=Oe();var Me=K('<div class="navbar bg-base-100 flex justify-start"><h1 class="text-3xl font-bold truncate mx-4">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><div class="status"></div> <div class="status"></div></div></div> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info mx-2">接続</button> <button class="btn btn-error mx-2">切断</button> <button class="btn mx-2">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold my-2">表示設定</h3> <h4 class="text-base font-bold my-2">エージェント</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2 mx-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function je(v,r){le(r,!1);let a=G(),d=G();const w=ae.subscribe(e=>{X(a,e)}),x=te.subscribe(e=>{X(d,e.status)});de(()=>{w(),x()});function l(e,u){ae.update(L=>{const ue=e.split("."),xe=ue.pop();let se=L;for(const ve of ue)ve&&(se=se[ve]);return se[xe]=u,{...L}})}function b(){te.connect()}function S(){te.disconnect()}let R=G();be();var y=Me(),z=o(s(y),2),U=s(z),T=s(U),W=o(T,2);n(U),n(z);var D=o(z,2),I=s(D);H(I,"class","h-[1em] opacity-50"),H(I,"inline",!0),H(I,"icon","mdi:link");var f=o(I,2);Z(f),n(D);var g=o(D,2),O=s(g);H(O,"class","h-[1em] opacity-50"),H(O,"inline",!0),H(O,"icon","mdi:key");var B=o(O,2);Z(B),oe(2),n(g);var V=o(g,2),Q=o(V,2),c=o(Q,2),p=o(c,2),M=s(p),m=s(M),_=o(s(m),4),E=s(_),j=o(s(E),2);Z(j),n(E);var k=o(E,2),A=o(s(k),2);Z(A),n(k);var C=o(k,2),h=o(s(C),2);Z(h),n(C),n(_),n(m),n(M),oe(2),n(p),ee(p,e=>X(R,e),()=>t(R));var N=o(p,2),P=s(N);H(P,"inline",!0),H(P,"icon","mdi:white-balance-sunny");var i=o(P,4);H(i,"inline",!0),H(i,"icon","mdi:moon-and-stars"),n(N),n(y),q(()=>{$(T,"status-success",t(d)==="connected"),$(T,"status-warning",t(d)==="connecting"),$(T,"status-error",t(d)==="disconnected"),$(T,"animate-ping",t(d)==="connected"||t(d)==="connecting"),W.hidden=t(d)==="disconnected",$(W,"status-success",t(d)==="connected"),$(W,"status-warning",t(d)==="connecting"),fe(f,t(a).connection.url),fe(B,t(a).connection.token),V.disabled=t(d)!=="disconnected",Q.disabled=t(d)==="disconnected",re(j,t(a).display.agent.name),re(A,t(a).display.agent.team),re(h,t(a).display.agent.role)}),J("input",f,e=>l("connection.url",e.currentTarget.value)),J("input",B,e=>l("connection.token",e.currentTarget.value)),J("click",V,b),J("click",Q,S),J("click",c,()=>t(R).showModal()),J("change",j,e=>l("display.agent.name",e.currentTarget.checked)),J("change",A,e=>l("display.agent.team",e.currentTarget.checked)),J("change",h,e=>l("display.agent.role",e.currentTarget.checked)),F(v,y),ce()}function Ne(v){return Array.from({length:v},(r,a)=>({idx:a+1,team:"",name:ge(a+1),role:"",isAlive:!0,targetIdxs:[],isBubble:!1}))}var He=K('<button class="btn"> </button>'),Je=K('<main class="h-screen flex flex-col"><!> <div class="flex flex-1 overflow-hidden w-full flex-col md:flex-row"><div class="flex-auto bg-base-300"><!></div> <div class="w-full md:w-64 max-md:h-32 flex flex-col bg-base-200"><ul class="list overflow-y-auto flex-1 px-1"></ul></div></div></main>');function nt(v,r){le(r,!1);let a=G(""),d=-1,w=G({id:"",idx:-1,day:0,isDay:!0,agents:Ne(5),message:"未接続",summary:"未接続",isDivider:!1}),x=G(),l;const b=te.entries.subscribe(f=>{var g;X(x,f),t(a)===""&&Object.keys(f).length>0&&X(a,Object.keys(f)[0]),d=((g=t(x)[t(a)])==null?void 0:g.length)-1,R(t(a),d)}),S=te.subscribe(f=>{l=f.status});de(()=>{b(),S()});function R(f,g){t(x)[f]&&(g<0||g>=t(x)[f].length||X(w,t(x)[f][g]))}window.addEventListener("beforeunload",f=>{l==="connecting"&&f.preventDefault()}),be();var y=Je();we(f=>{ke.title="aiwolf-nlp-viewer"});var z=s(y);je(z,{});var U=o(z,2),T=s(U),W=s(T);Ie(W,{get packet(){return t(w)}}),n(T);var D=o(T,2),I=s(D);pe(I,5,()=>t(x)[t(a)]||[],me,(f,g,O)=>{var B=He(),V=s(B);n(B),q(()=>Y(V,`${O+1}. ${t(g).summary??""}`)),J("click",B,()=>R(t(a),O)),F(f,B)}),n(I),n(D),n(U),n(y),F(v,y),ce()}export{nt as component};
