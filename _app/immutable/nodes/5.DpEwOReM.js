import"../chunks/DsnmJJEf.js";import{d as Nn,o as Un,b as Bl,s as ye,e as qi}from"../chunks/ZvrJVx00.js";import{aG as Gl,p as Bn,j as Xt,au as cs,f as $e,t as tt,b as Ce,c as Gn,d as j,s as $,e as U,aK as ls,aH as Qr,r as q,aI as us,ar as Sr,a as Jt,aL as Ol}from"../chunks/DO4nmVCp.js";import{i as Tt}from"../chunks/DunjnO_o.js";import{e as fs,i as ds}from"../chunks/D2oUr6Do.js";import{c as Jh,s as ji,a as Ht,r as jt,L as Zh,b as Fl,d as cr}from"../chunks/BAzGqRan.js";import{s as $r,c as ec}from"../chunks/BVXqbbjT.js";import{I as tc,b as rc,s as hs}from"../chunks/DAC6Pxv6.js";import{i as ic,s as nc}from"../chunks/CYzPR3gv.js";import{b as Ar}from"../chunks/DY7VAR3I.js";import{s as Kn,a as Jr}from"../chunks/aJomyVap.js";import{p as ac}from"../chunks/DgW2uzQz.js";import{$ as Hn,b as sc}from"../chunks/IkSv0N2d.js";import{p as oc}from"../chunks/CbEPV457.js";import{b as lc}from"../chunks/Ch8yJVIF.js";import{b as uc}from"../chunks/VfUbFVkd.js";class Nl{static fromJson(w){return JSON.parse(w)}static toJson(w){return JSON.stringify(w,null,2)}}const ss={name:!0,team:!1,role:!1},fc={connection:{url:"http://localhost:8080",token:""},display:{canvas:ss,bubble:ss,text:ss,largeScale:!1}},pi=Jh({storageKey:"realtime-settings",defaultValue:fc,serialize:Nl.toJson,deserialize:Nl.fromJson});function dc(ie){return Array.from({length:ie},(w,Ne)=>hc(Ne+1))}function hc(ie){return{idx:ie,team:"Undefined",name:tc(ie),profile:void 0,avatar:void 0,role:"Undefined",is_alive:!0}}function Et(ie,w,Ne){if(Ne===void 0)return"該当なし";const qe=w.agents.find(ne=>ne.idx===Ne);if(!qe)return"該当なし";const K=[];return ie?.name&&K.push(qe.name),ie?.team&&K.push(qe.team),ie?.role&&K.push(qe.role),K.filter(Boolean).join(" ")}function Yi(ie,w){return(ie||w)&&!(ie&&w)}const sr={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected"},cc=()=>({status:sr.DISCONNECTED,entries:{},gameItems:[],currentGameId:null,selectedPacketIdx:null,isManualGameSelection:!1,isManualPacketSelection:!1,previousEntriesLengths:{}});function vc(){const{subscribe:ie,update:w}=Gl(cc());let Ne=null,qe={},K={},ne=null;pi.subscribe(G=>{ne=G});async function W(){if(!ne)return null;try{const G=await fetch(`${ne.connection.url}/realtime/games.json`);if(!G.ok)throw new Error("Failed to fetch game list");return await G.json()}catch(G){return console.error("Error fetching game list:",G),null}}async function je(G){if(!ne)return[];try{const J=await fetch(`${ne.connection.url}/realtime/${G}.jsonl`);if(!J.ok)throw new Error(`Failed to fetch game packets for ${G}`);const ee=await J.text();return gt(ee)}catch(J){return console.error(`Error fetching game packets for ${G}:`,J),[]}}function re(G,J,ee){if(qe[G])return;const he=async()=>{const ge=await W();if(ge===null)return;const be=ge.find(me=>me.id===G);if(be&&be.updated_at!==K[G]){const me=await je(J);me.length>0&&w(De=>{const St={...De.entries},_t=De.previousEntriesLengths[G]||0,H=me.length;St[G]=me;let de=De.selectedPacketIdx;return G===De.currentGameId&&H>_t&&(de=H-1),{...De,entries:St,selectedPacketIdx:de,previousEntriesLengths:{...De.previousEntriesLengths,[G]:H},isManualPacketSelection:!1}}),K[G]=be.updated_at}};(async()=>{const ge=await je(J);ge.length>0&&w(be=>{const me={...be.entries};me[G]=ge;let De=be.selectedPacketIdx;return G===be.currentGameId&&(De=ge.length-1),{...be,entries:me,selectedPacketIdx:De,previousEntriesLengths:{...be.previousEntriesLengths,[G]:ge.length}}}),K[G]=ee})(),qe[G]=setInterval(he,1e3)}function ut(G){qe[G]&&(clearInterval(qe[G]),delete qe[G],delete K[G])}function ae(){if(!ne)return;w(J=>({...J,status:sr.CONNECTING}));const G=async()=>{const J=await W();if(J===null){w(ee=>({...ee,status:sr.CONNECTING}));return}w(ee=>{const he=new Set(Object.keys(qe)),Le=new Set(J.map(me=>me.id));he.forEach(me=>{Le.has(me)||ut(me)}),J.forEach(me=>{he.has(me.id)||re(me.id,me.filename,me.updated_at)});let ge=ee.currentGameId;if(J.length>0){const me=J.reduce((De,St)=>new Date(St.updated_at)>new Date(De.updated_at)?St:De);(!ee.currentGameId||!ee.isManualGameSelection&&J.length>ee.gameItems.length)&&(ge=me.id)}const be=ge!==ee.currentGameId;return{...ee,status:sr.CONNECTED,gameItems:J,currentGameId:ge,selectedPacketIdx:be?null:ee.selectedPacketIdx,isManualGameSelection:be?!1:ee.isManualGameSelection,isManualPacketSelection:be?!1:ee.isManualPacketSelection}})};G(),Ne=setInterval(G,1e3)}function ct(){Ne&&(clearInterval(Ne),Ne=null),Object.keys(qe).forEach(G=>{ut(G)}),w(G=>({...G,status:sr.DISCONNECTED}))}function nt(G,J=!1){w(ee=>{const he=ee.entries[G],Le=he&&he.length>0?he.length-1:null;return{...ee,currentGameId:G,selectedPacketIdx:Le,isManualGameSelection:J,isManualPacketSelection:!1}})}function at(G,J=!1){w(ee=>({...ee,selectedPacketIdx:G,isManualPacketSelection:J}))}async function Ee(){try{const G=await navigator.clipboard.readText();if(!G.trim()){console.warn("Clipboard is empty");return}await vt(G)}catch(G){console.error("Failed to load JSONL from clipboard:",G)}}async function vt(G){if(!G.trim())return;const J=gt(G);if(J.length===0){console.error("No valid packets found");return}const ee=Xe(J);w(he=>{const Le=Object.keys(ee),ge=Le.length>0?Le[0]:null,be=ge?ee[ge]:null,me=be?be.length-1:null;return{...he,entries:ee,currentGameId:ge,selectedPacketIdx:me,gameItems:Le.map(De=>({id:De,filename:De,updated_at:new Date().toISOString()})),isManualGameSelection:!1,isManualPacketSelection:!1,previousEntriesLengths:Object.fromEntries(Le.map(De=>[De,ee[De].length]))}}),console.log(`JSONL data loaded: ${J.length} packets across ${Object.keys(ee).length} games`)}async function Rt(G){for(const J of Array.from(G)){const ee=new FileReader;ee.onload=async he=>{const Le=he.target?.result;await vt(Le)},ee.readAsText(J)}}function gt(G){const J=G.trim().split(`
`),ee=[];for(let he=0;he<J.length;he++){const Le=J[he].trim();if(Le)try{const ge=JSON.parse(Le);ee.push(ge)}catch{return console.error(`Line ${he+1} is not valid JSON:`,Le),[]}}return ee}function Xe(G){const J={};return G.forEach(ee=>{J[ee.id]||(J[ee.id]=[]),J[ee.id].push(ee)}),Object.keys(J).forEach(ee=>{J[ee].sort((he,Le)=>he.day!==Le.day?he.day-Le.day:he.is_day!==Le.is_day?he.is_day?-1:1:he.idx-Le.idx)}),J}return{subscribe:ie,connect:ae,disconnect:ct,switchToGame:nt,selectPacket:at,loadFromClipboard:Ee,loadFromFiles:Rt,entries:{subscribe:G=>ie(J=>G(J.entries))},gameList:{subscribe:G=>ie(J=>G(J.gameItems))},currentGameId:{subscribe:G=>ie(J=>G(J.currentGameId))},selectedPacketIdx:{subscribe:G=>ie(J=>G(J.selectedPacketIdx))},currentPacket:{subscribe:G=>ie(J=>{const{currentGameId:ee,selectedPacketIdx:he,entries:Le}=J;if(!ee||he===null){G(null);return}const ge=Le[ee];if(!ge||he<0||he>=ge.length){G(null);return}G(ge[he])})}}}const vr=vc();var gc=(ie,w,Ne)=>{w()===U(Ne).idx?w(void 0):w(U(Ne).idx)},mc=$e('<pre class="base-content text-2xl select-none"> </pre>'),pc=$e('<pre class="base-content select-none"> </pre>'),yc=$e('<pre class="base-content text-2xl select-none"> </pre>'),Ec=$e('<pre class="base-content select-none"> </pre>'),Tc=$e('<pre class="base-content text-2xl select-none"> </pre>'),Sc=$e('<pre class="base-content select-none"> </pre>'),Ac=$e('<div><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"/></button></div></div> <div class="mt-2"><!> <!> <!></div></div>'),xc=$e(`<div class="h-full flex flex-col"><div class="bg-secondary"></div> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><pre class="base-content w-2/5 text-5xl font-bold opacity-70 absolute top-0 left-0 -mt-4 ml-8 select-none"> <br/> <br/> </pre> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><span class="text-xs">イラスト:石黒正数氏, VOICEVOX:四国めたん,ずんだもん,春日部つむぎ,
        波音リツ,玄野武宏,白上虎太郎,青山龍星,冥鳴ひまり,九州そら,もち子(cv
        明日葉よもぎ),剣崎雌雄,WhiteCUL,後鬼,No.7,ちび式じい,
        櫻歌ミコ,小夜/SAYO,ナースロボ＿タイプＴ,†聖騎士 紅桜†,雀松朱司,
        麒ヶ島宗麟,春歌ナナ,猫使アル,猫使ビィ,中国うさぎ,栗田まろん,
        あいえるたん,満別花丸,琴詠ニア,Voidoll(CV:丹下桜),ぞん子,中部つるぎ</span></aside></footer></div>`);function Lc(ie,w){Bn(w,!0);const[Ne,qe]=Kn(),K=()=>Jr(Hn,"$_",Ne);let ne=oc(w,"focusIdx",15),W=Qr(void 0);const je=pi.subscribe(de=>{Xt(W,de,!0)});Un(je);let re=ls(()=>{switch(w.packet.event){case"未接続":return K()("realtime.events.disconnected");case"トーク":return w.packet.message;case"囁き":return Yi(ne()===void 0,w.packet.agents.find(de=>de.idx===ne())?.role==="WEREWOLF")?w.packet.message:K()("realtime.events.whispered");case"襲撃投票":return Yi(ne()===void 0,w.packet.from_idx===ne())?K()("realtime.events.attack_voted_with_target",{values:{from:Et(U(W)?.display.bubble,w.packet,w.packet.from_idx),to:Et(U(W)?.display.bubble,w.packet,w.packet.to_idx)}}):K()("realtime.events.attack_voted");case"投票":return Yi(ne()===void 0,w.packet.from_idx===ne())?K()("realtime.events.voted_with_target",{values:{from:Et(U(W)?.display.bubble,w.packet,w.packet.from_idx),to:Et(U(W)?.display.bubble,w.packet,w.packet.to_idx)}}):K()("realtime.events.voted",{values:{from:Et(U(W)?.display.bubble,w.packet,w.packet.from_idx)}});case"追放":return w.packet.to_idx===void 0?K()("realtime.events.no_execute"):K()("realtime.events.executed",{values:{target:Et(U(W)?.display.bubble,w.packet,w.packet.to_idx)}});case"襲撃":return w.packet.to_idx===void 0?K()("realtime.events.no_attack"):w.packet.from_idx===-1?K()("realtime.events.attacked_but_guarded",{values:{target:Et(U(W)?.display.bubble,w.packet,w.packet.to_idx)}}):K()("realtime.events.attacked",{values:{target:Et(U(W)?.display.bubble,w.packet,w.packet.to_idx)}});case"占い":if(Yi(ne()===void 0,w.packet.from_idx===ne())){const de=w.packet.agents.find(Y=>Y.idx===w.packet.to_idx)?.role,_e=de?rc[de]:void 0;return K()("realtime.events.divined_with_result",{values:{from:Et(U(W)?.display.bubble,w.packet,w.packet.from_idx),to:Et(U(W)?.display.bubble,w.packet,w.packet.to_idx),result:_e?K()(`game.species.${_e}`):""}})}return K()("realtime.events.divined");case"護衛":return Yi(ne()===void 0,w.packet.from_idx===ne())?K()("realtime.events.guarded_with_target",{values:{from:Et(U(W)?.display.bubble,w.packet,w.packet.from_idx),to:Et(U(W)?.display.bubble,w.packet,w.packet.to_idx)}}):K()("realtime.events.guarded");case"終了":return K()("realtime.events.game_ended",{values:{winner:w.packet.message}});default:return w.packet.message??K()("realtime.events.unknown")}}),ut,ae,ct,nt,at;Bl(()=>(window.addEventListener("resize",Ee),()=>{window.removeEventListener("resize",Ee)})),cs(()=>{Ee()});function Ee(){if(!ae||!ct||!ut)return;const de=ut.getBoundingClientRect();if([ae,ct].forEach(y=>{y.width=de.width,y.height=de.height;const N=y.getContext("2d");N&&(N.clearRect(0,0,y.width,y.height),N.globalAlpha=1,N.lineWidth=2)}),ne()!==void 0&&(w.packet.event==="囁き"&&w.packet.agents.find(y=>y.idx===ne())?.role!=="WEREWOLF"||w.packet.event==="占い"&&w.packet.from_idx!==ne()||w.packet.event==="投票"&&w.packet.from_idx!==ne()||w.packet.event==="襲撃投票"&&w.packet.from_idx!==ne()))return;const _e=ae.getContext("2d"),Y=ct.getContext("2d");if(!_e||!Y)return;const _=ct.getBoundingClientRect();if(w.packet.from_idx!==void 0&&w.packet.to_idx!==void 0){const y=document.getElementById(`agent-${w.packet.from_idx}`);if(!(y instanceof HTMLElement))return;const N=y.getBoundingClientRect(),F=N.left+N.width/2-_.left,fe=N.top+N.height/2-_.top,We=document.getElementById(`agent-${w.packet.to_idx}`);if(!(We instanceof HTMLElement))return;const Z=We.getBoundingClientRect();vt(Y,F,fe,Z.left+Z.width/2-_.left,Z.top+Z.height/2-_.top,!1,getComputedStyle(at).getPropertyValue("background-color"))}if(w.packet.bubble_idx!==void 0){const y=document.getElementById(`agent-${w.packet.bubble_idx}`);if(!(y instanceof HTMLElement))return;const N=y.getBoundingClientRect(),F=N.left+N.width/2-_.left,fe=N.top+N.height/2-_.top;vt(_e,_.width/2,_.height/2,F,fe,!0,getComputedStyle(nt).getPropertyValue("background-color"))}}function vt(de,_e,Y,_,y,N,F){const fe=N?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];de.strokeStyle=de.fillStyle=F,de.beginPath();let We=_-_e,Z=y-Y,Oe=Math.sqrt(We*We+Z*Z),Ct=Z/Oe,Pt=We/Oe,rt=[];rt.push(0,0);for(let Pe=0;Pe<fe.length;Pe+=2){let ze=fe[Pe],Dt=fe[Pe+1];rt.push(ze<0?Oe+ze:ze,Dt)}rt.push(Oe,0);for(let Pe=fe.length;Pe>0;Pe-=2){let ze=fe[Pe-2],Dt=fe[Pe-1];rt.push(ze<0?Oe+ze:ze,-Dt)}rt.push(0,0);for(let Pe=0;Pe<rt.length;Pe+=2){let ze=rt[Pe]*Pt-rt[Pe+1]*Ct+_e,Dt=rt[Pe]*Ct+rt[Pe+1]*Pt+Y;Pe===0?de.moveTo(ze,Dt):de.lineTo(ze,Dt)}de.fill()}var Rt=xc(),gt=j(Rt);Ar(gt,de=>at=de,()=>at);var Xe=$(gt,2),G=j(Xe),J=j(G),ee=j(J,!0),he=$(ee,2,!0),Le=$(he,2,!0);q(J);var ge=$(J,2);Ar(ge,de=>ae=de,()=>ae);var be=$(ge,2);Ar(be,de=>ct=de,()=>ct);var me=$(be,2),De=j(me),St=j(De),_t=j(St,!0);q(St),q(De),q(me),Ar(me,de=>nt=de,()=>nt);var H=$(me,2);fs(H,17,()=>w.packet.agents,ds,(de,_e,Y)=>{var _=Ac();let y;var N=j(_),F=j(N);let fe,We;var Z=j(F);Z.__click=[gc,ne,_e];var Oe=j(Z);q(Z),q(F),q(N);var Ct=$(N,2),Pt=j(Ct);{var rt=Ie=>{var Fe=Sr(),st=Jt(Fe);{var we=Re=>{var ce=mc(),se=j(ce,!0);q(ce),tt(()=>ye(se,U(_e).name)),Ce(Re,ce)},it=Re=>{var ce=pc(),se=j(ce,!0);q(ce),tt(()=>ye(se,U(_e).name)),Ce(Re,ce)};Tt(st,Re=>{U(W)?.display.largeScale?Re(we):Re(it,!1)})}Ce(Ie,Fe)};Tt(Pt,Ie=>{U(W)?.display.canvas.name&&Ie(rt)})}var Pe=$(Pt,2);{var ze=Ie=>{var Fe=Sr(),st=Jt(Fe);{var we=Re=>{var ce=yc(),se=j(ce,!0);q(ce),tt(()=>ye(se,U(_e).team)),Ce(Re,ce)},it=Re=>{var ce=Ec(),se=j(ce,!0);q(ce),tt(()=>ye(se,U(_e).team)),Ce(Re,ce)};Tt(st,Re=>{U(W)?.display.largeScale?Re(we):Re(it,!1)})}Ce(Ie,Fe)};Tt(Pe,Ie=>{U(W)?.display.canvas.team&&Ie(ze)})}var Dt=$(Pe,2);{var Se=Ie=>{var Fe=Sr(),st=Jt(Fe);{var we=Re=>{var ce=Tc(),se=j(ce,!0);q(ce),tt(()=>ye(se,U(_e).role)),Ce(Re,ce)},it=Re=>{var ce=Sc(),se=j(ce,!0);q(ce),tt(()=>ye(se,U(_e).role)),Ce(Re,ce)};Tt(st,Re=>{U(W)?.display.largeScale?Re(we):Re(it,!1)})}Ce(Ie,Fe)};Tt(Dt,Ie=>{U(W)?.display.canvas.role&&(U(_e).idx===ne()||ne()===void 0)&&Ie(Se)})}q(Ct),q(_),tt((Ie,Fe,st,we)=>{y=$r(_,1,"absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-104i6df",null,y,Ie),hs(_,`--angle: ${Y*(360/w.packet.agents.length)}`),ji(_,"id",`agent-${U(_e).idx??""}`),fe=$r(F,1,"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2 svelte-104i6df",null,fe,Fe),We=hs(F,"",We,st),ji(Oe,"src",we),ji(Oe,"alt",U(_e).name)},[()=>({"bg-focus":U(_e).idx===ne()}),()=>({"ring-info":U(_e).is_alive,"ring-error":!U(_e).is_alive}),()=>({opacity:U(_e).is_alive?1:.25}),()=>U(_e).avatar===void 0?`${lc}/images/male/${U(_e).idx.toString().padStart(2,"0")}.png`:U(_e).avatar]),Ce(de,_)}),q(G),Ar(G,de=>ut=de,()=>ut),q(Xe),us(2),q(Rt),tt((de,_e,Y)=>{ye(ee,de),ye(he,_e),ye(Le,Y),me.hidden=!U(re),$r(St,1,ec(U(W)?.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center")),ye(_t,U(re))},[()=>K()("realtime.day",{values:{day:w.packet.day}}),()=>w.packet.is_day?K()("realtime.daytime"):K()("realtime.nighttime"),()=>K()(`realtime.eventTypes.${w.packet.event}`,{default:w.packet.event})]),Ce(ie,Rt),Gn(),qe()}Nn(["click"]);var os={exports:{}},Ul;function Ic(){return Ul||(Ul=1,function(ie,w){(function Ne(qe){(function(K,ne){ie.exports=ne()})(this,function(){function K(s,o,n){if(nt())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,o);var e=new(s.bind.apply(s,r));return n&&vt(e,n.prototype),e}function ne(s,o){for(var n=0;n<o.length;n++){var r=o[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,gt(r.key),r)}}function W(s,o,n){return o&&ne(s.prototype,o),n&&ne(s,n),Object.defineProperty(s,"prototype",{writable:!1}),s}function je(s,o,n){return(o=gt(o))in s?Object.defineProperty(s,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[o]=n,s}function re(){return re=Object.assign?Object.assign.bind():function(s){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var r in n)({}).hasOwnProperty.call(n,r)&&(s[r]=n[r])}return s},re.apply(null,arguments)}function ut(s){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},ut(s)}function ae(s,o){s.prototype=Object.create(o.prototype),s.prototype.constructor=s,vt(s,o)}function ct(s){try{return Function.toString.call(s).indexOf("[native code]")!==-1}catch{return typeof s=="function"}}function nt(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nt=function(){return!!s})()}function at(s,o){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);o&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})),n.push.apply(n,r)}return n}function Ee(s){for(var o=1;o<arguments.length;o++){var n=arguments[o]!=null?arguments[o]:{};o%2?at(Object(n),!0).forEach(function(r){je(s,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(n,r))})}return s}function vt(s,o){return vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},vt(s,o)}function Rt(s,o){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var r=n.call(s,o);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}function gt(s){var o=Rt(s,"string");return typeof o=="symbol"?o:o+""}function Xe(s){var o=typeof Map=="function"?new Map:void 0;return Xe=function(n){if(n===null||!ct(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(n))return o.get(n);o.set(n,r)}function r(){return K(n,arguments,ut(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),vt(r,n)},Xe(s)}function G(){try{return crypto.randomUUID()}catch{try{var s=URL.createObjectURL(new Blob),o=s.toString();return URL.revokeObjectURL(s),o.slice(o.lastIndexOf("/")+1)}catch{var n=new Date().getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var a=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(i=="x"?a:a&3|8).toString(16)});return r}}}function J(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ee={exports:{}},he;function Le(){return he||(he=1,function(s){var o=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function e(l,u,f){this.fn=l,this.context=u,this.once=f||!1}function t(l,u,f,d,h){if(typeof f!="function")throw new TypeError("The listener must be a function");var c=new e(f,d||l,h),v=n?n+u:u;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],c]:l._events[v].push(c):(l._events[v]=c,l._eventsCount++),l}function i(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],f,d;if(this._eventsCount===0)return u;for(d in f=this._events)o.call(f,d)&&u.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},a.prototype.listeners=function(u){var f=n?n+u:u,d=this._events[f];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,c=d.length,v=new Array(c);h<c;h++)v[h]=d[h].fn;return v},a.prototype.listenerCount=function(u){var f=n?n+u:u,d=this._events[f];return d?d.fn?1:d.length:0},a.prototype.emit=function(u,f,d,h,c,v){var g=n?n+u:u;if(!this._events[g])return!1;var m=this._events[g],p=arguments.length,E,S;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),p){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,f),!0;case 3:return m.fn.call(m.context,f,d),!0;case 4:return m.fn.call(m.context,f,d,h),!0;case 5:return m.fn.call(m.context,f,d,h,c),!0;case 6:return m.fn.call(m.context,f,d,h,c,v),!0}for(S=1,E=new Array(p-1);S<p;S++)E[S-1]=arguments[S];m.fn.apply(m.context,E)}else{var T=m.length,A;for(S=0;S<T;S++)switch(m[S].once&&this.removeListener(u,m[S].fn,void 0,!0),p){case 1:m[S].fn.call(m[S].context);break;case 2:m[S].fn.call(m[S].context,f);break;case 3:m[S].fn.call(m[S].context,f,d);break;case 4:m[S].fn.call(m[S].context,f,d,h);break;default:if(!E)for(A=1,E=new Array(p-1);A<p;A++)E[A-1]=arguments[A];m[S].fn.apply(m[S].context,E)}}return!0},a.prototype.on=function(u,f,d){return t(this,u,f,d,!1)},a.prototype.once=function(u,f,d){return t(this,u,f,d,!0)},a.prototype.removeListener=function(u,f,d,h){var c=n?n+u:u;if(!this._events[c])return this;if(!f)return i(this,c),this;var v=this._events[c];if(v.fn)v.fn===f&&(!h||v.once)&&(!d||v.context===d)&&i(this,c);else{for(var g=0,m=[],p=v.length;g<p;g++)(v[g].fn!==f||h&&!v[g].once||d&&v[g].context!==d)&&m.push(v[g]);m.length?this._events[c]=m.length===1?m[0]:m:i(this,c)}return this},a.prototype.removeAllListeners=function(u){var f;return u?(f=n?n+u:u,this._events[f]&&i(this,f)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,s.exports=a}(ee)),ee.exports}var ge=Le(),be=J(ge),me={exports:{}},De;function St(){return De||(De=1,function(s,o){(function(n){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,e=/^(?=([^\/?#]*))\1([^]*)$/,t=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,f){if(f=f||{},l=l.trim(),u=u.trim(),!u){if(!f.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var h=a.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return f.alwaysNormalize?(h.path=a.normalizePath(h.path),a.buildURLFromParts(h)):u;var c=a.parseURL(l);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&c.path[0]!=="/"){var v=e.exec(c.path);c.netLoc=v[1],c.path=v[2]}c.netLoc&&!c.path&&(c.path="/");var g={scheme:c.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(g.netLoc=c.netLoc,h.path[0]!=="/"))if(!h.path)g.path=c.path,h.params||(g.params=c.params,h.query||(g.query=c.query));else{var m=c.path,p=m.substring(0,m.lastIndexOf("/")+1)+h.path;g.path=a.normalizePath(p)}return g.path===null&&(g.path=f.alwaysNormalize?a.normalizePath(h.path):h.path),a.buildURLFromParts(g)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(t,"");l.length!==(l=l.replace(i,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};s.exports=a})()}(me)),me.exports}var _t=St(),H=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},de=Number.isSafeInteger||function(s){return typeof s=="number"&&Math.abs(s)<=_e},_e=Number.MAX_SAFE_INTEGER||9007199254740991,Y=function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s}({}),_=function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",s.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",s.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.ASSET_LIST_LOAD_ERROR="assetListLoadError",s.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",s.ASSET_LIST_PARSING_ERROR="assetListParsingError",s.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.ATTACH_MEDIA_ERROR="attachMediaError",s.UNKNOWN="unknown",s}({}),y=function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.MEDIA_ENDED="hlsMediaEnded",s.STALL_RESOLVED="hlsStallResolved",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFERED_TO_END="hlsBufferedToEnd",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",s.ASSET_LIST_LOADING="hlsAssetListLoading",s.ASSET_LIST_LOADED="hlsAssetListLoaded",s.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",s.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",s.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",s.INTERSTITIAL_STARTED="hlsInterstitialStarted",s.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",s.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",s.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",s.INTERSTITIAL_ENDED="hlsInterstitialEnded",s.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",s.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",s.EVENT_CUE_ENTER="hlsEventCueEnter",s}({}),N={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},F={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},fe=function(){function s(n,r,e){r===void 0&&(r=0),e===void 0&&(e=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=n,this.alpha_=n?Math.exp(Math.log(.5)/n):0,this.estimate_=r,this.totalWeight_=e}var o=s.prototype;return o.sample=function(r,e){var t=Math.pow(this.alpha_,r);this.estimate_=e*(1-t)+t*this.estimate_,this.totalWeight_+=r},o.getTotalWeight=function(){return this.totalWeight_},o.getEstimate=function(){if(this.alpha_){var r=1-Math.pow(this.alpha_,this.totalWeight_);if(r)return this.estimate_/r}return this.estimate_},s}(),We=function(){function s(n,r,e,t){t===void 0&&(t=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new fe(n),this.fast_=new fe(r),this.defaultTTFB_=t,this.ttfb_=new fe(n)}var o=s.prototype;return o.update=function(r,e){var t=this.slow_,i=this.fast_,a=this.ttfb_;t.halfLife!==r&&(this.slow_=new fe(r,t.getEstimate(),t.getTotalWeight())),i.halfLife!==e&&(this.fast_=new fe(e,i.getEstimate(),i.getTotalWeight())),a.halfLife!==r&&(this.ttfb_=new fe(r,a.getEstimate(),a.getTotalWeight()))},o.sample=function(r,e){r=Math.max(r,this.minDelayMs_);var t=8*e,i=r/1e3,a=t/i;this.fast_.sample(i,a),this.slow_.sample(i,a)},o.sampleTTFB=function(r){var e=r/1e3,t=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(t,Math.max(r,5))},o.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},o.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},o.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},o.destroy=function(){},W(s,[{key:"defaultEstimate",get:function(){return this.defaultEstimate_}}])}(),Z=function(o,n){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;var r="["+o+"]:";this.trace=Oe,this.debug=n.debug.bind(null,r),this.log=n.log.bind(null,r),this.warn=n.warn.bind(null,r),this.info=n.info.bind(null,r),this.error=n.error.bind(null,r)},Oe=function(){},Ct={trace:Oe,debug:Oe,log:Oe,warn:Oe,info:Oe,error:Oe};function Pt(){return re({},Ct)}function rt(s,o){var n=self.console[s];return n?n.bind(self.console,(o?"["+o+"] ":"")+"["+s+"] >"):Oe}function Pe(s,o,n){return o[s]?o[s].bind(o):rt(s,n)}var ze=Pt();function Dt(s,o,n){var r=Pt();if(typeof console=="object"&&s===!0||typeof s=="object"){var e=["debug","log","info","warn","error"];e.forEach(function(t){r[t]=Pe(t,s,n)});try{r.log('Debug logs enabled for "'+o+'" in hls.js version 1.6.7')}catch{return Pt()}e.forEach(function(t){ze[t]=Pe(t,s)})}else re(ze,r);return r}var Se=ze;function Ie(s){if(s===void 0&&(s=!0),!(typeof self>"u")){var o=(s||!self.MediaSource)&&self.ManagedMediaSource;return o||self.MediaSource||self.WebKitMediaSource}}function Fe(s){return typeof self<"u"&&s===self.ManagedMediaSource}function st(s,o){var n=Object.keys(s),r=Object.keys(o),e=n.length,t=r.length;return!e||!t||e===t&&!n.some(function(i){return r.indexOf(i)===-1})}function we(s,o){if(o===void 0&&(o=!1),typeof TextDecoder<"u"){var n=new TextDecoder("utf-8"),r=n.decode(s);if(o){var e=r.indexOf("\0");return e!==-1?r.substring(0,e):r}return r.replace(/\0/g,"")}for(var t=s.length,i,a,l,u="",f=0;f<t;){if(i=s[f++],i===0&&o)return u;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(i);break;case 12:case 13:a=s[f++],u+=String.fromCharCode((i&31)<<6|a&63);break;case 14:a=s[f++],l=s[f++],u+=String.fromCharCode((i&15)<<12|(a&63)<<6|(l&63)<<0);break}}return u}var it={hexDump:function(o){for(var n="",r=0;r<o.length;r++){var e=o[r].toString(16);e.length<2&&(e="0"+e),n+=e}return n}};function Re(s){return Uint8Array.from(s.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var ce=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},se={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},wt=function(){function s(n){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof n=="string"&&(n={url:n}),this.base=n,Nr(this,"stats")}var o=s.prototype;return o.setByteRange=function(r,e){var t=r.split("@",2),i;t.length===1?i=e?.byteRangeEndOffset||0:i=parseInt(t[1]),this._byteRange=[i,parseInt(t[0])+i]},o.clearElementaryStreamInfo=function(){var r=this.elementaryStreams;r[se.AUDIO]=null,r[se.VIDEO]=null,r[se.AUDIOVIDEO]=null},W(s,[{key:"baseurl",get:function(){return this.base.url}},{key:"byteRange",get:function(){return this._byteRange===null?[]:this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"elementaryStreams",get:function(){if(this._streams===null){var r;this._streams=(r={},r[se.AUDIO]=null,r[se.VIDEO]=null,r[se.AUDIOVIDEO]=null,r)}return this._streams},set:function(r){this._streams=r}},{key:"hasStats",get:function(){return this._stats!==null}},{key:"hasStreams",get:function(){return this._streams!==null}},{key:"stats",get:function(){return this._stats===null&&(this._stats=new ce),this._stats},set:function(r){this._stats=r}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=_t.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(r){this._url=r}}])}();function Ue(s){return s.sn!=="initSegment"}var ft=function(s){function o(r,e){var t;return t=s.call(this,e)||this,t._decryptdata=null,t._programDateTime=null,t._ref=null,t._bitrate=void 0,t.rawProgramDateTime=null,t.tagList=[],t.duration=0,t.sn=0,t.levelkeys=void 0,t.type=void 0,t.loader=null,t.keyLoader=null,t.level=-1,t.cc=0,t.startPTS=void 0,t.endPTS=void 0,t.startDTS=void 0,t.endDTS=void 0,t.start=0,t.playlistOffset=0,t.deltaPTS=void 0,t.maxStartPTS=void 0,t.minEndPTS=void 0,t.data=void 0,t.bitrateTest=!1,t.title=null,t.initSegment=null,t.endList=void 0,t.gap=void 0,t.urlId=0,t.type=r,t}ae(o,s);var n=o.prototype;return n.addStart=function(e){this.setStart(this.start+e)},n.setStart=function(e){this.start=e,this._ref&&(this._ref.start=e)},n.setDuration=function(e){this.duration=e,this._ref&&(this._ref.duration=e)},n.setKeyFormat=function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}},n.abortRequests=function(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()},n.setElementaryStreamInfo=function(e,t,i,a,l,u){u===void 0&&(u=!1);var f=this.elementaryStreams,d=f[e];if(!d){f[e]={startPTS:t,endPTS:i,startDTS:a,endDTS:l,partial:u};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,i),d.startDTS=Math.min(d.startDTS,a),d.endDTS=Math.max(d.endDTS,l)},W(o,[{key:"byteLength",get:function(){if(this.hasStats){var e=this.stats.total;if(e)return e}if(this.byteRange){var t=this.byteRange[0],i=this.byteRange[1];if(H(t)&&H(i))return i-t}return null}},{key:"bitrate",get:function(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null},set:function(e){this._bitrate=e}},{key:"decryptdata",get:function(){var e=this.levelkeys;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null)return null;var e=H(this.duration)?this.duration:0;return this.programDateTime+e*1e3}},{key:"encrypted",get:function(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}},{key:"programDateTime",get:function(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime},set:function(e){if(!H(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}},{key:"ref",get:function(){return Ue(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}}])}(wt),Mt=function(s){function o(n,r,e,t,i){var a;a=s.call(this,e)||this,a.fragOffset=0,a.duration=0,a.gap=!1,a.independent=!1,a.relurl=void 0,a.fragment=void 0,a.index=void 0,a.duration=n.decimalFloatingPoint("DURATION"),a.gap=n.bool("GAP"),a.independent=n.bool("INDEPENDENT"),a.relurl=n.enumeratedString("URI"),a.fragment=r,a.index=t;var l=n.enumeratedString("BYTERANGE");return l&&a.setByteRange(l,i),i&&(a.fragOffset=i.fragOffset+i.duration),a}return ae(o,s),W(o,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var r=this.elementaryStreams;return!!(r.audio||r.video||r.audiovideo)}}])}(wt);function Ot(s,o){var n=Object.getPrototypeOf(s);if(n){var r=Object.getOwnPropertyDescriptor(n,o);return r||Ot(n,o)}}function Nr(s,o){var n=Ot(s,o);n&&(n.enumerable=!0,Object.defineProperty(s,o,n))}var Zt=Math.pow(2,32)-1,Ft=[].push,Vt={video:1,audio:2,id3:3,text:4};function Be(s){return String.fromCharCode.apply(null,s)}function or(s,o){var n=s[o]<<8|s[o+1];return n<0?65536+n:n}function oe(s,o){var n=Xi(s,o);return n<0?4294967296+n:n}function xr(s,o){var n=oe(s,o);return n*=Math.pow(2,32),n+=oe(s,o+4),n}function Xi(s,o){return s[o]<<24|s[o+1]<<16|s[o+2]<<8|s[o+3]}function yi(s){for(var o=s.byteLength,n=0;n<o;){var r=oe(s,n);if(r>8&&s[n+4]===109&&s[n+5]===111&&s[n+6]===111&&s[n+7]===102)return!0;n=r>1?n+r:o}return!1}function pe(s,o){var n=[];if(!o.length)return n;for(var r=s.byteLength,e=0;e<r;){var t=oe(s,e),i=Be(s.subarray(e+4,e+8)),a=t>1?e+t:r;if(i===o[0])if(o.length===1)n.push(s.subarray(e+8,a));else{var l=pe(s.subarray(e+8,a),o.slice(1));l.length&&Ft.apply(n,l)}e=a}return n}function Vn(s){var o=[],n=s[0],r=8,e=oe(s,r);r+=4;var t=0,i=0;n===0?(t=oe(s,r),i=oe(s,r+4),r+=8):(t=xr(s,r),i=xr(s,r+8),r+=16),r+=2;var a=s.length+i,l=or(s,r);r+=2;for(var u=0;u<l;u++){var f=r,d=oe(s,f);f+=4;var h=d&2147483647,c=(d&2147483648)>>>31;if(c===1)return Se.warn("SIDX has hierarchical references (not supported)"),null;var v=oe(s,f);f+=4,o.push({referenceSize:h,subsegmentDuration:v,info:{duration:v/e,start:a,end:a+h-1}}),a+=h,f+=4,r=f}return{earliestPresentationTime:t,timescale:e,version:n,referencesCount:l,references:o}}function Zr(s){for(var o=[],n=pe(s,["moov","trak"]),r=0;r<n.length;r++){var e=n[r],t=pe(e,["tkhd"])[0];if(t){var i=t[0],a=oe(t,i===0?12:20),l=pe(e,["mdia","mdhd"])[0];if(l){i=l[0];var u=oe(l,i===0?12:20),f=pe(e,["mdia","hdlr"])[0];if(f){var d=Be(f.subarray(8,12)),h={soun:se.AUDIO,vide:se.VIDEO}[d],c=pe(e,["mdia","minf","stbl","stsd"])[0],v=Ei(c);h?(o[a]={timescale:u,type:h,stsd:v},o[h]=Ee({timescale:u,id:a},v)):o[a]={timescale:u,type:d,stsd:v}}}}}var g=pe(s,["moov","mvex","trex"]);return g.forEach(function(m){var p=oe(m,4),E=o[p];E&&(E.default={duration:oe(m,12),flags:oe(m,20)})}),o}function Ei(s){var o=s.subarray(8),n=o.subarray(86),r=Be(o.subarray(4,8)),e=r,t,i=r==="enca"||r==="encv";if(i){var a=pe(o,[r])[0],l=a.subarray(r==="enca"?28:78),u=pe(l,["sinf"]);u.forEach(function(xe){var It=pe(xe,["schm"])[0];if(It){var pt=Be(It.subarray(4,8));if(pt==="cbcs"||pt==="cenc"){var Ye=pe(xe,["frma"])[0];Ye&&(e=Be(Ye))}}})}var f=e;switch(e){case"avc1":case"avc2":case"avc3":case"avc4":{var d=pe(n,["avcC"])[0];d&&d.length>3&&(e+="."+Ir(d[1])+Ir(d[2])+Ir(d[3]),t=Lr(f==="avc1"?"dva1":"dvav",n));break}case"mp4a":{var h=pe(o,[r])[0],c=pe(h.subarray(28),["esds"])[0];if(c&&c.length>7){var v=4;if(c[v++]!==3)break;v=Ur(c,v),v+=2;var g=c[v++];if(g&128&&(v+=2),g&64&&(v+=c[v++]),c[v++]!==4)break;v=Ur(c,v);var m=c[v++];if(m===64)e+="."+Ir(m);else break;if(v+=12,c[v++]!==5)break;v=Ur(c,v);var p=c[v++],E=(p&248)>>3;E===31&&(E+=1+((p&7)<<3)+((c[v]&224)>>5)),e+="."+E}break}case"hvc1":case"hev1":{var S=pe(n,["hvcC"])[0];if(S&&S.length>12){var T=S[1],A=["","A","B","C"][T>>6],x=T&31,I=oe(S,2),k=(T&32)>>5?"H":"L",D=S[12],b=S.subarray(6,12);e+="."+A+x,e+="."+Wn(I).toString(16).toUpperCase(),e+="."+k+D;for(var L="",R=b.length;R--;){var C=b[R];if(C||L){var B=C.toString(16).toUpperCase();L="."+B+L}}e+=L}t=Lr(f=="hev1"?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{e=Lr(e,n)||e;break}case"vp09":{var P=pe(n,["vpcC"])[0];if(P&&P.length>6){var O=P[4],V=P[5],X=P[6]>>4&15;e+="."+Nt(O)+"."+Nt(V)+"."+Nt(X)}break}case"av01":{var z=pe(n,["av1C"])[0];if(z&&z.length>2){var Q=z[1]>>>5,ue=z[1]&31,te=z[2]>>>7?"H":"M",le=(z[2]&64)>>6,ve=(z[2]&32)>>5,Te=Q===2&&le?ve?12:10:le?10:8,ke=(z[2]&16)>>4,Me=(z[2]&8)>>3,Ge=(z[2]&4)>>2,et=z[2]&3,He=1,Lt=1,Ve=1,lt=0;e+="."+Q+"."+Nt(ue)+te+"."+Nt(Te)+"."+ke+"."+Me+Ge+et+"."+Nt(He)+"."+Nt(Lt)+"."+Nt(Ve)+"."+lt,t=Lr("dav1",n)}break}}return{codec:e,encrypted:i,supplemental:t}}function Lr(s,o){var n=pe(o,["dvvC"]),r=n.length?n[0]:pe(o,["dvcC"])[0];if(r){var e=r[2]>>1&127,t=r[2]<<5&32|r[3]>>3&31;return s+"."+Nt(e)+"."+Nt(t)}}function Wn(s){for(var o=0,n=0;n<32;n++)o|=(s>>n&1)<<31-n;return o>>>0}function Ur(s,o){for(var n=o+5;s[o++]&128&&o<n;);return o}function Ir(s){return("0"+s.toString(16).toUpperCase()).slice(-2)}function Nt(s){return(s<10?"0":"")+s}function Yn(s,o){if(!s||!o)return s;var n=o.keyId;if(n&&o.isCommonEncryption){var r=pe(s,["moov","trak"]);r.forEach(function(e){var t=pe(e,["mdia","minf","stbl","stsd"])[0],i=t.subarray(8),a=pe(i,["enca"]),l=a.length>0;l||(a=pe(i,["encv"])),a.forEach(function(u){var f=l?u.subarray(28):u.subarray(78),d=pe(f,["sinf"]);d.forEach(function(h){var c=Ti(h);if(c){var v=c.subarray(8,24);v.some(function(g){return g!==0})||(Se.log("[eme] Patching keyId in 'enc"+(l?"a":"v")+">sinf>>tenc' box: "+it.hexDump(v)+" -> "+it.hexDump(n)),c.set(n,8))}})})})}return s}function Ti(s){var o=pe(s,["schm"])[0];if(o){var n=Be(o.subarray(4,8));if(n==="cbcs"||n==="cenc")return pe(s,["schi","tenc"])[0]}return null}function zi(s,o,n){for(var r={},e=pe(s,["moof","traf"]),t=0;t<e.length;t++){var i=e[t],a=pe(i,["tfhd"])[0],l=oe(a,4),u=o[l];if(u){var f=r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type}),d=pe(i,["tfdt"])[0];if(d){var h=d[0],c=oe(d,4);h===1&&(c===Zt?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(c*=Zt+1,c+=oe(d,8))),H(c)&&(!H(f.start)||c<f.start)&&(f.start=c)}var v=u.default,g=oe(a,0)|v?.flags,m=v?.duration||0;g&8&&(g&2?m=oe(a,12):m=oe(a,8));for(var p=pe(i,["trun"]),E=f.start||0,S=0,T=m,A=0;A<p.length;A++){var x=p[A],I=oe(x,4),k=f.sampleCount;f.sampleCount+=I;var D=x[3]&1,b=x[3]&4,L=x[2]&1,R=x[2]&2,C=x[2]&4,B=x[2]&8,P=8,O=I;if(D&&(P+=4),b&&I){var V=x[P+1]&1;!V&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=k),P+=4,L?(T=oe(x,P),P+=4):T=m,R&&(P+=4),B&&(P+=4),E+=T,S+=T,O--}for(;O--;){if(L?(T=oe(x,P),P+=4):T=m,R&&(P+=4),C){var X=x[P+1]&1;X||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(O+1),f.keyFrameStart=E),P+=4}B&&(P+=4),E+=T,S+=T}!S&&m&&(S+=m*I)}f.duration+=S}}if(!Object.keys(r).some(function(Te){return r[Te].duration})){for(var z=1/0,Q=0,ue=pe(s,["sidx"]),te=0;te<ue.length;te++){var le=Vn(ue[te]);if(le!=null&&le.references){z=Math.min(z,le.earliestPresentationTime/le.timescale);var ve=le.references.reduce(function(Te,ke){return Te+ke.info.duration||0},0);Q=Math.max(Q,ve+le.earliestPresentationTime/le.timescale)}}Q&&H(Q)&&Object.keys(r).forEach(function(Te){r[Te].duration||(r[Te].duration=Q*r[Te].timescale-r[Te].start)})}return r}function Si(s){var o={valid:null,remainder:null},n=pe(s,["moof"]);if(n.length<2)return o.remainder=s,o;var r=n[n.length-1];return o.valid=s.slice(0,r.byteOffset-8),o.remainder=s.slice(r.byteOffset-8),o}function Ut(s,o){var n=new Uint8Array(s.length+o.length);return n.set(s),n.set(o,s.length),n}function ei(s,o){var n=[],r=o.samples,e=o.timescale,t=o.id,i=!1,a=pe(r,["moof"]);return a.map(function(l){var u=l.byteOffset-8,f=pe(l,["traf"]);f.map(function(d){var h=pe(d,["tfdt"]).map(function(c){var v=c[0],g=oe(c,4);return v===1&&(g*=Math.pow(2,32),g+=oe(c,8)),g/e})[0];return h!==void 0&&(s=h),pe(d,["tfhd"]).map(function(c){var v=oe(c,4),g=oe(c,0)&16777215,m=(g&1)!==0,p=(g&2)!==0,E=(g&8)!==0,S=0,T=(g&16)!==0,A=0,x=(g&32)!==0,I=8;v===t&&(m&&(I+=8),p&&(I+=4),E&&(S=oe(c,I),I+=4),T&&(A=oe(c,I),I+=4),x&&(I+=4),o.type==="video"&&(i=br(o.codec)),pe(d,["trun"]).map(function(k){var D=k[0],b=oe(k,0)&16777215,L=(b&1)!==0,R=0,C=(b&4)!==0,B=(b&256)!==0,P=0,O=(b&512)!==0,V=0,X=(b&1024)!==0,z=(b&2048)!==0,Q=0,ue=oe(k,4),te=8;L&&(R=oe(k,te),te+=4),C&&(te+=4);for(var le=R+u,ve=0;ve<ue;ve++){if(B?(P=oe(k,te),te+=4):P=S,O?(V=oe(k,te),te+=4):V=A,X&&(te+=4),z&&(D===0?Q=oe(k,te):Q=Xi(k,te),te+=4),o.type===se.VIDEO)for(var Te=0;Te<V;){var ke=oe(r,le);if(le+=4,qn(i,r[le])){var Me=r.subarray(le,le+ke);Br(Me,i?2:1,s+Q/e,n)}le+=ke,Te+=ke+4}s+=P/e}}))})})}),n}function br(s){if(!s)return!1;var o=s.substring(0,4);return o==="hvc1"||o==="hev1"||o==="dvh1"||o==="dvhe"}function qn(s,o){if(s){var n=o>>1&63;return n===39||n===40}else{var r=o&31;return r===6}}function Br(s,o,n,r){var e=ti(s),t=0;t+=o;for(var i=0,a=0,l=0;t<e.length;){i=0;do{if(t>=e.length)break;l=e[t++],i+=l}while(l===255);a=0;do{if(t>=e.length)break;l=e[t++],a+=l}while(l===255);var u=e.length-t,f=t;if(a<u)t+=a;else if(a>u){Se.error("Malformed SEI payload. "+a+" is too small, only "+u+" bytes left to parse.");break}if(i===4){var d=e[f++];if(d===181){var h=or(e,f);if(f+=2,h===49){var c=oe(e,f);if(f+=4,c===1195456820){var v=e[f++];if(v===3){var g=e[f++],m=31&g,p=64&g,E=p?2+m*3:0,S=new Uint8Array(E);if(p){S[0]=g;for(var T=1;T<E;T++)S[T]=e[f++]}r.push({type:v,payloadType:i,pts:n,bytes:S})}}}}}else if(i===5&&a>16){for(var A=[],x=0;x<16;x++){var I=e[f++].toString(16);A.push(I.length==1?"0"+I:I),(x===3||x===5||x===7||x===9)&&A.push("-")}for(var k=a-16,D=new Uint8Array(k),b=0;b<k;b++)D[b]=e[f++];r.push({payloadType:i,pts:n,uuid:A.join(""),userData:we(D),userDataBytes:D})}}}function ti(s){for(var o=s.byteLength,n=[],r=1;r<o-2;)s[r]===0&&s[r+1]===0&&s[r+2]===3?(n.push(r+2),r+=2):r++;if(n.length===0)return s;var e=o-n.length,t=new Uint8Array(e),i=0;for(r=0;r<e;i++,r++)i===n[0]&&(i++,n.shift()),t[r]=s[i];return t}function jn(s){var o=s[0],n="",r="",e=0,t=0,i=0,a=0,l=0,u=0;if(o===0){for(;Be(s.subarray(u,u+1))!=="\0";)n+=Be(s.subarray(u,u+1)),u+=1;for(n+=Be(s.subarray(u,u+1)),u+=1;Be(s.subarray(u,u+1))!=="\0";)r+=Be(s.subarray(u,u+1)),u+=1;r+=Be(s.subarray(u,u+1)),u+=1,e=oe(s,12),t=oe(s,16),a=oe(s,20),l=oe(s,24),u=28}else if(o===1){u+=4,e=oe(s,u),u+=4;var f=oe(s,u);u+=4;var d=oe(s,u);for(u+=4,i=Math.pow(2,32)*f+d,de(i)||(i=Number.MAX_SAFE_INTEGER,Se.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=oe(s,u),u+=4,l=oe(s,u),u+=4;Be(s.subarray(u,u+1))!=="\0";)n+=Be(s.subarray(u,u+1)),u+=1;for(n+=Be(s.subarray(u,u+1)),u+=1;Be(s.subarray(u,u+1))!=="\0";)r+=Be(s.subarray(u,u+1)),u+=1;r+=Be(s.subarray(u,u+1)),u+=1}var h=s.subarray(u,s.byteLength);return{schemeIdUri:n,value:r,timeScale:e,presentationTime:i,presentationTimeDelta:t,eventDuration:a,id:l,payload:h}}function Ai(s){for(var o=arguments.length,n=new Array(o>1?o-1:0),r=1;r<o;r++)n[r-1]=arguments[r];for(var e=n.length,t=8,i=e;i--;)t+=n[i].byteLength;var a=new Uint8Array(t);for(a[0]=t>>24&255,a[1]=t>>16&255,a[2]=t>>8&255,a[3]=t&255,a.set(s,4),i=0,t=8;i<e;i++)a.set(n[i],t),t+=n[i].byteLength;return a}function xi(s,o,n){if(s.byteLength!==16)throw new RangeError("Invalid system id");var r,e;r=0,e=new Uint8Array;var t;r>0?(t=new Uint8Array(4),o.length>0&&new DataView(t.buffer).setUint32(0,o.length,!1)):t=new Uint8Array;var i=new Uint8Array(4);return n&&n.byteLength>0&&new DataView(i.buffer).setUint32(0,n.byteLength,!1),Ai([112,115,115,104],new Uint8Array([r,0,0,0]),s,t,e,i,n||new Uint8Array)}var Qi=function(){return/\(Windows.+Firefox\//i.test(navigator.userAgent)},gr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Li(s,o){var n=gr[o];return!!n&&!!n[s.slice(0,4)]}function ri(s,o,n){return n===void 0&&(n=!0),!s.split(",").some(function(r){return!ii(r,o,n)})}function ii(s,o,n){var r;n===void 0&&(n=!0);var e=Ie(n);return(r=e?.isTypeSupported(Gr(s,o)))!=null?r:!1}function Gr(s,o){return o+"/mp4;codecs="+s}function Ii(s){if(s){var o=s.substring(0,4);return gr.video[o]}return 2}function Rr(s){var o=Qi();return s.split(",").reduce(function(n,r){var e=o&&br(r),t=e?9:gr.video[r];return t?(t*2+n)/(n?3:2):(gr.audio[r]+n)/(n?2:1)},0)}var bi={};function $i(s,o){if(o===void 0&&(o=!0),bi[s])return bi[s];for(var n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[s],r=0;r<n.length;r++){var e;if(ii(n[r],"audio",o))return bi[s]=n[r],n[r];if(n[r]==="mp3"&&(e=Ie(o))!=null&&e.isTypeSupported("audio/mpeg"))return""}return s}var At=/flac|opus|mp4a\.40\.34/i;function Wt(s,o){return o===void 0&&(o=!0),s.replace(At,function(n){return $i(n.toLowerCase(),o)})}function _r(s,o){var n=[];if(s)for(var r=s.split(","),e=0;e<r.length;e++)Li(r[e],"video")||n.push(r[e]);return o&&n.push(o),n.join(",")}function er(s,o){if(s&&(s.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(s)!==-1)&&(Dr(s,"audio")||Dr(s,"video")))return s;if(o){var n=o.split(",");if(n.length>1){if(s){for(var r=n.length;r--;)if(n[r].substring(0,4)===s.substring(0,4))return n[r]}return n[0]}}return o||s}function Dr(s,o){return Li(s,o)&&ii(s,o)}function Bt(s){for(var o=s.split(","),n=0;n<o.length;n++){var r=o[n].split(".");r.length>2&&r[0]==="avc1"&&(o[n]="avc1."+parseInt(r[1]).toString(16)+("000"+parseInt(r[2]).toString(16)).slice(-4))}return o.join(",")}function lr(s){if(s.startsWith("av01.")){for(var o=s.split("."),n=["0","111","01","01","01","0"],r=o.length;r>4&&r<10;r++)o[r]=n[r-4];return o.join(".")}return s}function Ji(s){var o=Ie(s)||{isTypeSupported:function(){return!1}};return{mpeg:o.isTypeSupported("audio/mpeg"),mp3:o.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:o.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ri(s){return s.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var Zi={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function en(s,o){return{supported:!1,configurations:o,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:s}}function Xn(s,o,n,r,e,t){var i=s.videoCodec,a=s.audioCodec?s.audioGroups:null,l=t?.audioCodec,u=t?.channels,f=u?parseInt(u):l?1/0:2,d=null;if(a!=null&&a.length)try{a.length===1&&a[0]?d=o.groups[a[0]].channels:d=a.reduce(function(h,c){if(c){var v=o.groups[c];if(!v)throw new Error("Audio track group "+c+" not found");Object.keys(v.channels).forEach(function(g){h[g]=(h[g]||0)+v.channels[g]})}return h},{2:0})}catch{return!0}return i!==void 0&&(i.split(",").some(function(h){return br(h)})||s.width>1920&&s.height>1088||s.height>1920&&s.width>1088||s.frameRate>Math.max(r,30)||s.videoRange!=="SDR"&&s.videoRange!==n||s.bitrate>Math.max(e,8e6))||!!d&&H(f)&&Object.keys(d).some(function(h){return parseInt(h)>f})}function tn(s,o,n,r){r===void 0&&(r={});var e=s.videoCodec;if(!e&&!s.audioCodec||!n)return Promise.resolve(Zi);for(var t=[],i=zn(s),a=i.length,l=Qn(s,o,a>0),u=l.length,f=a||1*u||1;f--;){var d={type:"media-source"};if(a&&(d.video=i[f%a]),u){d.audio=l[f%u];var h=d.audio.bitrate;d.video&&h&&(d.video.bitrate-=h)}t.push(d)}if(e){var c=navigator.userAgent;if(e.split(",").some(function(v){return br(v)})&&Qi())return Promise.resolve(en(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: ("+c+")"),t))}return Promise.all(t.map(function(v){var g=Jn(v);return r[g]||(r[g]=n.decodingInfo(v))})).then(function(v){return{supported:!v.some(function(g){return!g.supported}),configurations:t,decodingInfoResults:v}}).catch(function(v){return{supported:!1,configurations:t,decodingInfoResults:[],error:v}})}function zn(s){var o,n=(o=s.videoCodec)==null?void 0:o.split(","),r=rn(s),e=s.width||640,t=s.height||480,i=s.frameRate||30,a=s.videoRange.toLowerCase();return n?n.map(function(l){var u={contentType:Gr(lr(l),"video"),width:e,height:t,bitrate:r,framerate:i};return a!=="sdr"&&(u.transferFunction=a),u}):[]}function Qn(s,o,n){var r,e=(r=s.audioCodec)==null?void 0:r.split(","),t=rn(s);return e&&s.audioGroups?s.audioGroups.reduce(function(i,a){var l,u=a?(l=o.groups[a])==null?void 0:l.tracks:null;return u?u.reduce(function(f,d){if(d.groupId===a){var h=parseFloat(d.channels||"");e.forEach(function(c){var v={contentType:Gr(c,"audio"),bitrate:n?$n(c,t):t};h&&(v.channels=""+h),f.push(v)})}return f},i):i},[]):[]}function $n(s,o){if(o<=1)return 1;var n=128e3;return s==="ec-3"?n=768e3:s==="ac-3"&&(n=64e4),Math.min(o/2,n)}function rn(s){return Math.ceil(Math.max(s.bitrate*.9,s.averageBitrate)/1e3)*1e3||1}function Jn(s){var o="",n=s.audio,r=s.video;if(r){var e=Ri(r.contentType);o+=e+"_r"+r.height+"x"+r.width+"f"+Math.ceil(r.framerate)+(r.transferFunction||"sd")+"_"+Math.ceil(r.bitrate/1e5)}if(n){var t=Ri(n.contentType);o+=(r?"_":"")+t+"_c"+n.channels}return o}var _i=["NONE","TYPE-0","TYPE-1",null];function Zn(s){return _i.indexOf(s)>-1}var ni=["SDR","PQ","HLG"];function ea(s){return!!s&&ni.indexOf(s)>-1}var ai={No:"",Yes:"YES",v2:"v2"};function nn(s){var o=s.canSkipUntil,n=s.canSkipDateRanges,r=s.age,e=r<o/2;return o&&e?n?ai.v2:ai.Yes:ai.No}var an=function(){function s(n,r,e){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=n,this.part=r,this.skip=e}var o=s.prototype;return o.addDirectives=function(r){var e=new self.URL(r);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},s}(),Di=function(){function s(n){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[n.url],this._attrs=[n.attrs],this.bitrate=n.bitrate,n.details&&(this.details=n.details),this.id=n.id||0,this.name=n.name,this.width=n.width||0,this.height=n.height||0,this.frameRate=n.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=n.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=n.audioCodec,this.videoCodec=n.videoCodec,this.codecSet=[n.videoCodec,n.audioCodec].filter(function(t){return!!t}).map(function(t){return t.substring(0,4)}).join(","),"supplemental"in n){var r;this.supplemental=n.supplemental;var e=(r=n.supplemental)==null?void 0:r.videoCodec;e&&e!==n.videoCodec&&(this.codecSet+=","+e.substring(0,4))}this.addGroupId("audio",n.attrs.AUDIO),this.addGroupId("text",n.attrs.SUBTITLES)}var o=s.prototype;return o.hasAudioGroup=function(r){return vs(this._audioGroups,r)},o.hasSubtitleGroup=function(r){return vs(this._subtitleGroups,r)},o.addGroupId=function(r,e){if(e){if(r==="audio"){var t=this._audioGroups;t||(t=this._audioGroups=[]),t.indexOf(e)===-1&&t.push(e)}else if(r==="text"){var i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(e)===-1&&i.push(e)}}},o.addFallback=function(){},W(s,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(r){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var r;return(r=this.audioGroups)==null?void 0:r[0]}},{key:"textGroupId",get:function(){var r;return(r=this.subtitleGroups)==null?void 0:r[0]}}])}();function vs(s,o){return!o||!s?!1:s.indexOf(o)!==-1}function Kl(){if(typeof matchMedia=="function"){var s=matchMedia("(dynamic-range: high)"),o=matchMedia("bad query");if(s.media!==o.media)return s.matches===!0}return!1}function Hl(s,o){var n=!1,r=[];if(s&&(n=s!=="SDR",r=[s]),o){r=o.allowedVideoRanges||ni.slice(0);var e=r.join("")!=="SDR"&&!o.videoCodec;n=o.preferHDR!==void 0?o.preferHDR:e&&Kl(),n||(r=["SDR"])}return{preferHDR:n,allowedVideoRanges:r}}var Vl=function(o){var n=new WeakSet;return function(r,e){if(o&&(e=o(r,e)),typeof e=="object"&&e!==null){if(n.has(e))return;n.add(e)}return e}},Ke=function(o,n){return JSON.stringify(o,Vl(n))};function Wl(s,o,n,r,e){for(var t=Object.keys(s),i=r?.channels,a=r?.audioCodec,l=e?.videoCodec,u=i&&parseInt(i)===2,f=!1,d=!1,h=1/0,c=1/0,v=1/0,g=1/0,m=0,p=[],E=Hl(o,e),S=E.preferHDR,T=E.allowedVideoRanges,A=function(){var R=s[t[x]];f||(f=R.channels[2]>0),h=Math.min(h,R.minHeight),c=Math.min(c,R.minFramerate),v=Math.min(v,R.minBitrate);var C=T.filter(function(B){return R.videoRanges[B]>0});C.length>0&&(d=!0)},x=t.length;x--;)A();h=H(h)?h:0,c=H(c)?c:0;var I=Math.max(1080,h),k=Math.max(30,c);v=H(v)?v:n,n=Math.max(v,n),d||(o=void 0);var D=t.length>1,b=t.reduce(function(L,R){var C=s[R];if(R===L)return L;if(p=d?T.filter(function(B){return C.videoRanges[B]>0}):[],D){if(C.minBitrate>n)return ur(R,"min bitrate of "+C.minBitrate+" > current estimate of "+n),L;if(!C.hasDefaultAudio)return ur(R,"no renditions with default or auto-select sound found"),L;if(a&&R.indexOf(a.substring(0,4))%5!==0)return ur(R,'audio codec preference "'+a+'" not found'),L;if(i&&!u){if(!C.channels[i])return ur(R,"no renditions with "+i+" channel sound found (channels options: "+Object.keys(C.channels)+")"),L}else if((!a||u)&&f&&C.channels[2]===0)return ur(R,"no renditions with stereo sound found"),L;if(C.minHeight>I)return ur(R,"min resolution of "+C.minHeight+" > maximum of "+I),L;if(C.minFramerate>k)return ur(R,"min framerate of "+C.minFramerate+" > maximum of "+k),L;if(!p.some(function(B){return C.videoRanges[B]>0}))return ur(R,"no variants with VIDEO-RANGE of "+Ke(p)+" found"),L;if(l&&R.indexOf(l.substring(0,4))%5!==0)return ur(R,'video codec preference "'+l+'" not found'),L;if(C.maxScore<m)return ur(R,"max score of "+C.maxScore+" < selected max of "+m),L}return L&&(Rr(R)>=Rr(L)||C.fragmentError>s[L].fragmentError)?L:(g=C.minIndex,m=C.maxScore,R)},void 0);return{codecSet:b,videoRanges:p,preferHDR:S,minFramerate:c,minBitrate:v,minIndex:g}}function ur(s,o){Se.log('[abr] start candidates with "'+s+'" ignored because '+o)}function gs(s){return s.reduce(function(o,n){var r=o.groups[n.groupId];r||(r=o.groups[n.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(n);var e=n.channels||"2";return r.channels[e]=(r.channels[e]||0)+1,r.hasDefault=r.hasDefault||n.default,r.hasAutoSelect=r.hasAutoSelect||n.autoselect,r.hasDefault&&(o.hasDefaultAudio=!0),r.hasAutoSelect&&(o.hasAutoSelectAudio=!0),o},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Yl(s,o,n,r){return s.slice(n,r+1).reduce(function(e,t,i){if(!t.codecSet)return e;var a=t.audioGroups,l=e[t.codecSet];l||(e[t.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,t.bitrate);var u=Math.min(t.height,t.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,t.frameRate),l.minIndex=Math.min(l.minIndex,i),l.maxScore=Math.max(l.maxScore,t.score),l.fragmentError+=t.fragmentError,l.videoRanges[t.videoRange]=(l.videoRanges[t.videoRange]||0)+1,a&&a.forEach(function(f){if(f){var d=o.groups[f];d&&(l.hasDefaultAudio=l.hasDefaultAudio||o.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!o.hasDefaultAudio&&!o.hasAutoSelectAudio,Object.keys(d.channels).forEach(function(h){l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}}),e},{})}function ms(s){if(!s)return s;var o=s,n=o.lang,r=o.assocLang,e=o.characteristics,t=o.channels,i=o.audioCodec;return{lang:n,assocLang:r,characteristics:e,channels:t,audioCodec:i}}function fr(s,o,n){if("attrs"in s){var r=o.indexOf(s);if(r!==-1)return r}for(var e=0;e<o.length;e++){var t=o[e];if(Kr(s,t,n))return e}return-1}function Kr(s,o,n){var r=s.groupId,e=s.name,t=s.lang,i=s.assocLang,a=s.default,l=s.forced;return(r===void 0||o.groupId===r)&&(e===void 0||o.name===e)&&(t===void 0||ql(t,o.lang))&&(t===void 0||o.assocLang===i)&&(a===void 0||o.default===a)&&(l===void 0||o.forced===l)&&(!("characteristics"in s)||jl(s.characteristics||"",o.characteristics))&&(n===void 0||n(s,o))}function ql(s,o){return o===void 0&&(o="--"),s.length===o.length?s===o:s.startsWith(o)||o.startsWith(s)}function jl(s,o){o===void 0&&(o="");var n=s.split(","),r=o.split(",");return n.length===r.length&&!n.some(function(e){return r.indexOf(e)===-1})}function Hr(s,o){var n=s.audioCodec,r=s.channels;return(n===void 0||(o.audioCodec||"").substring(0,4)===n.substring(0,4))&&(r===void 0||r===(o.channels||"2"))}function Xl(s,o,n,r,e){var t=o[r],i=o.reduce(function(h,c,v){var g=c.uri,m=h[g]||(h[g]=[]);return m.push(v),h},{}),a=i[t.uri];a.length>1&&(r=Math.max.apply(Math,a));var l=t.videoRange,u=t.frameRate,f=t.codecSet.substring(0,4),d=ps(o,r,function(h){if(h.videoRange!==l||h.frameRate!==u||h.codecSet.substring(0,4)!==f)return!1;var c=h.audioGroups,v=n.filter(function(g){return!c||c.indexOf(g.groupId)!==-1});return fr(s,v,e)>-1});return d>-1?d:ps(o,r,function(h){var c=h.audioGroups,v=n.filter(function(g){return!c||c.indexOf(g.groupId)!==-1});return fr(s,v,e)>-1})}function ps(s,o,n){for(var r=o;r>-1;r--)if(n(s[r]))return r;for(var e=o+1;e<s.length;e++)if(n(s[e]))return e;return-1}function sn(s,o){var n;return!!s&&s!==((n=o.loadLevelObj)==null?void 0:n.uri)}var zl=function(s){function o(r){var e;return e=s.call(this,"abr",r.logger)||this,e.hls=void 0,e.lastLevelLoadSec=0,e.lastLoadedFragLevel=-1,e.firstSelection=-1,e._nextAutoLevel=-1,e.nextAutoLevelKey="",e.audioTracksByGroup=null,e.codecTiers=null,e.timer=-1,e.fragCurrent=null,e.partCurrent=null,e.bitrateTestDelay=0,e.rebufferNotice=-1,e.supportedCache={},e.bwEstimator=void 0,e._abandonRulesCheck=function(t){var i,a=e,l=a.fragCurrent,u=a.partCurrent,f=a.hls,d=f.autoLevelEnabled,h=f.media;if(!(!l||!h)){var c=performance.now(),v=u?u.stats:l.stats,g=u?u.duration:l.duration,m=c-v.loading.start,p=f.minAutoLevel,E=l.level,S=e._nextAutoLevel;if(v.aborted||v.loaded&&v.loaded===v.total||E<=p){e.clearTimer(),e._nextAutoLevel=-1;return}if(d){var T=S>-1&&S!==E,A=!!t||T;if(!(!A&&(h.paused||!h.playbackRate||!h.readyState))){var x=f.mainForwardBufferInfo;if(!(!A&&x===null)){var I=e.bwEstimator.getEstimateTTFB(),k=Math.abs(h.playbackRate);if(!(m<=Math.max(I,1e3*(g/(k*2))))){var D=x?x.len/k:0,b=v.loading.first?v.loading.first-v.loading.start:-1,L=v.loaded&&b>-1,R=e.getBwEstimate(),C=f.levels,B=C[E],P=Math.max(v.loaded,Math.round(g*(l.bitrate||B.averageBitrate)/8)),O=L?m-b:m;O<1&&L&&(O=Math.min(m,v.loaded*8/R));var V=L?v.loaded*1e3/O:0,X=I/1e3,z=V?(P-v.loaded)/V:P*8/R+X;if(!(z<=D)){var Q=V?V*8:R,ue=((i=t?.details||e.hls.latestLevelDetails)==null?void 0:i.live)===!0,te=e.hls.config.abrBandWidthUpFactor,le=Number.POSITIVE_INFINITY,ve;for(ve=E-1;ve>p;ve--){var Te=C[ve].maxBitrate,ke=!C[ve].details||ue;if(le=e.getTimeToLoadFrag(X,Q,g*Te,ke),le<Math.min(D,g+X))break}if(!(le>=z)&&!(le>g*10)){L?e.bwEstimator.sample(m-Math.min(I,b),v.loaded):e.bwEstimator.sampleTTFB(m);var Me=C[ve].maxBitrate;e.getBwEstimate()*te>Me&&e.resetEstimator(Me);var Ge=e.findBestLevel(Me,p,ve,0,D,1,1);Ge>-1&&(ve=Ge),e.warn("Fragment "+l.sn+(u?" part "+u.index:"")+" of level "+E+` is loading too slowly;
      Fragment duration: `+l.duration.toFixed(3)+`
      Time to underbuffer: `+D.toFixed(3)+` s
      Estimated load time for current fragment: `+z.toFixed(3)+` s
      Estimated load time for down switch fragment: `+le.toFixed(3)+` s
      TTFB estimate: `+(b|0)+` ms
      Current BW estimate: `+(H(R)?R|0:"Unknown")+` bps
      New BW estimate: `+(e.getBwEstimate()|0)+` bps
      Switching to level `+ve+" @ "+(Me|0)+" bps"),f.nextLoadLevel=f.nextAutoLevel=ve,e.clearTimer();var et=function(){if(e.clearTimer(),e.fragCurrent===l&&e.hls.loadLevel===ve&&ve>0){var Lt=e.getStarvationDelay();if(e.warn("Aborting inflight request "+(ve>0?"and switching down":"")+`
      Fragment duration: `+l.duration.toFixed(3)+` s
      Time to underbuffer: `+Lt.toFixed(3)+" s"),l.abortRequests(),e.fragCurrent=e.partCurrent=null,ve>p){var Ve=e.findBestLevel(e.hls.levels[p].bitrate,p,ve,0,Lt,1,1);Ve===-1&&(Ve=p),e.hls.nextLoadLevel=e.hls.nextAutoLevel=Ve,e.resetEstimator(e.hls.levels[Ve].bitrate)}}};T||z>le*2?et():e.timer=self.setInterval(et,le*1e3),f.trigger(y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:u,stats:v})}}}}}}}},e.hls=r,e.bwEstimator=e.initEstimator(),e.registerListeners(),e}ae(o,s);var n=o.prototype;return n.resetEstimator=function(e){e&&(this.log("setting initial bwe to "+e),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},n.initEstimator=function(){var e=this.hls.config;return new We(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)},n.registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(y.ERROR,this.onError,this))},n.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null},n.onManifestLoading=function(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},n.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},n.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},n.onFragLoading=function(e,t){var i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var a;this.fragCurrent=i,this.partCurrent=(a=t.part)!=null?a:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}},n.onLevelSwitching=function(e,t){this.clearTimer()},n.onError=function(e,t){if(!t.fatal)switch(t.details){case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case _.FRAG_LOAD_TIMEOUT:{var i=t.frag,a=this.fragCurrent,l=this.partCurrent;if(i&&a&&i.sn===a.sn&&i.level===a.level){var u=performance.now(),f=l?l.stats:i.stats,d=u-f.loading.start,h=f.loading.first?f.loading.first-f.loading.start:-1,c=f.loaded&&h>-1;if(c){var v=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(v,h),f.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}},n.getTimeToLoadFrag=function(e,t,i,a){var l=e+i/t,u=a?e+this.lastLevelLoadSec:0;return l+u},n.onLevelLoaded=function(e,t){var i=this.hls.config,a=t.stats.loading,l=a.end-a.first;H(l)&&(this.lastLevelLoadSec=l/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)},n.onFragLoaded=function(e,t){var i=t.frag,a=t.part,l=a?a.stats:i.stats;if(i.type===F.MAIN&&this.bwEstimator.sampleTTFB(l.loading.first-l.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),i.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var u=a?a.duration:i.duration,f=this.hls.levels[i.level],d=(f.loaded?f.loaded.bytes:0)+l.loaded,h=(f.loaded?f.loaded.duration:0)+u;f.loaded={bytes:d,duration:h},f.realBitrate=Math.round(8*d/h)}if(i.bitrateTest){var c={stats:l,frag:i,part:a,id:i.type};this.onFragBuffered(y.FRAG_BUFFERED,c),i.bitrateTest=!1}else this.lastLoadedFragLevel=i.level}},n.onFragBuffered=function(e,t){var i=t.frag,a=t.part,l=a!=null&&a.stats.loaded?a.stats:i.stats;if(!l.aborted&&!this.ignoreFragment(i)){var u=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(u,l.loaded),l.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}},n.ignoreFragment=function(e){return e.type!==F.MAIN||e.sn==="initSegment"},n.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},n.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},n.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,i=this.hls;if(i.levels.length<=1)return i.loadLevel;var a=i.maxAutoLevel,l=i.config,u=i.minAutoLevel,f=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),h=this.getStarvationDelay(),c=l.abrBandWidthFactor,v=l.abrBandWidthUpFactor;if(h){var g=this.findBestLevel(d,u,a,h,0,c,v);if(g>=0)return this.rebufferNotice=-1,g}var m=f?Math.min(f,l.maxStarvationDelay):l.maxStarvationDelay;if(!h){var p=this.bitrateTestDelay;if(p){var E=f?Math.min(f,l.maxLoadingDelay):l.maxLoadingDelay;m=E-p,this.info("bitrate test took "+Math.round(1e3*p)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),c=v=1}}var S=this.findBestLevel(d,u,a,h,m,c,v);if(this.rebufferNotice!==S&&(this.rebufferNotice=S,this.info((h?"rebuffering expected":"buffer is empty")+", optimal quality level "+S)),S>-1)return S;var T=i.levels[u],A=i.loadLevelObj;return A&&T?.bitrate<A.bitrate?u:i.loadLevel},n.getStarvationDelay=function(){var e=this.hls,t=e.media;if(!t)return 1/0;var i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,a=e.mainForwardBufferInfo;return(a?a.len:0)/i},n.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},n.findBestLevel=function(e,t,i,a,l,u,f){var d,h=this,c=a+l,v=this.lastLoadedFragLevel,g=v===-1?this.hls.firstLevel:v,m=this.fragCurrent,p=this.partCurrent,E=this.hls,S=E.levels,T=E.allAudioTracks,A=E.loadLevel,x=E.config;if(S.length===1)return 0;var I=S[g],k=!!((d=this.hls.latestLevelDetails)!=null&&d.live),D=A===-1||v===-1,b,L="SDR",R=I?.frameRate||0,C=x.audioPreference,B=x.videoPreference,P=this.audioTracksByGroup||(this.audioTracksByGroup=gs(T)),O=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;var V=this.codecTiers||(this.codecTiers=Yl(S,P,t,i)),X=Wl(V,L,e,C,B),z=X.codecSet,Q=X.videoRanges,ue=X.minFramerate,te=X.minBitrate,le=X.minIndex,ve=X.preferHDR;O=le,b=z,L=ve?Q[Q.length-1]:Q[0],R=ue,e=Math.max(e,te),this.log("picked start tier "+Ke(X))}else b=I?.codecSet,L=I?.videoRange;for(var Te=p?p.duration:m?m.duration:0,ke=this.bwEstimator.getEstimateTTFB()/1e3,Me=[],Ge=function(){var Ve,lt,xe=S[He],It=He>g;if(!xe)return 0;if(x.useMediaCapabilities&&!xe.supportedResult&&!xe.supportedPromise){var pt=navigator.mediaCapabilities;typeof pt?.decodingInfo=="function"&&Xn(xe,P,L,R,e,C)?(xe.supportedPromise=tn(xe,P,pt,h.supportedCache),xe.supportedPromise.then(function(kt){if(h.hls){xe.supportedResult=kt;var Tr=h.hls.levels,ar=Tr.indexOf(xe);kt.error?h.warn('MediaCapabilities decodingInfo error: "'+kt.error+'" for level '+ar+" "+Ke(kt)):kt.supported?kt.decodingInfoResults.some(function(wr){return wr.smooth===!1||wr.powerEfficient===!1})&&h.log("MediaCapabilities decodingInfo for level "+ar+" not smooth or powerEfficient: "+Ke(kt)):(h.warn("Unsupported MediaCapabilities decodingInfo result for level "+ar+" "+Ke(kt)),ar>-1&&Tr.length>1&&(h.log("Removing unsupported level "+ar),h.hls.removeLevel(ar),h.hls.loadLevel===-1&&(h.hls.nextLoadLevel=0)))}})):xe.supportedResult=Zi}if((b&&xe.codecSet!==b||L&&xe.videoRange!==L||It&&R>xe.frameRate||!It&&R>0&&R<xe.frameRate||(Ve=xe.supportedResult)!=null&&(lt=Ve.decodingInfoResults)!=null&&lt.some(function(kt){return kt.smooth===!1}))&&(!D||He!==O))return Me.push(He),0;var Ye=xe.details,nr=(p?Ye?.partTarget:Ye?.averagetargetduration)||Te,ht;It?ht=f*e:ht=u*e;var bt=Te&&a>=Te*2&&l===0?xe.averageBitrate:xe.maxBitrate,Qe=h.getTimeToLoadFrag(ke,ht,bt*nr,Ye===void 0),yt=ht>=bt&&(He===v||xe.loadError===0&&xe.fragmentError===0)&&(Qe<=ke||!H(Qe)||k&&!h.bitrateTestDelay||Qe<c);if(yt){var qr=h.forcedAutoLevel;return He!==A&&(qr===-1||qr!==A)&&(Me.length&&h.trace("Skipped level(s) "+Me.join(",")+" of "+i+' max with CODECS and VIDEO-RANGE:"'+S[Me[0]].codecs+'" '+S[Me[0]].videoRange+'; not compatible with "'+b+'" '+L),h.info("switch candidate:"+g+"->"+He+" adjustedbw("+Math.round(ht)+")-bitrate="+Math.round(ht-bt)+" ttfb:"+ke.toFixed(1)+" avgDuration:"+nr.toFixed(1)+" maxFetchDuration:"+c.toFixed(1)+" fetchDuration:"+Qe.toFixed(1)+" firstSelection:"+D+" codecSet:"+xe.codecSet+" videoRange:"+xe.videoRange+" hls.loadLevel:"+A)),D&&(h.firstSelection=He),{v:He}}},et,He=i;He>=t;He--)if(et=Ge(),et!==0&&et)return et.v;return-1},n.deriveNextAutoLevel=function(e){var t=this.hls,i=t.maxAutoLevel,a=t.minAutoLevel;return Math.min(Math.max(e,a),i)},W(o,[{key:"firstAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.minAutoLevel,a=this.getBwEstimate(),l=this.hls.config.maxStarvationDelay,u=this.findBestLevel(a,i,t,0,l,1,1);if(u>-1)return u;var f=this.hls.firstLevel,d=Math.min(Math.max(f,i),t);return this.warn("Could not find best starting auto level. Defaulting to first in playlist "+f+" clamped to "+d),d}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var e=this.forcedAutoLevel,t=this.bwEstimator,i=t.canEstimate(),a=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!a||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;var l=i&&a?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){var u=this.hls.levels;if(u.length>Math.max(e,l)&&u[e].loadError<=u[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l},set:function(e){var t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}}])}(Z),ys={search:function(o,n){for(var r=0,e=o.length-1,t=null,i=null;r<=e;){t=(r+e)/2|0,i=o[t];var a=n(i);if(a>0)r=t+1;else if(a<0)e=t-1;else return i}return null}};function Ql(s,o,n){if(o===null||!Array.isArray(s)||!s.length||!H(o))return null;var r=s[0].programDateTime;if(o<(r||0))return null;var e=s[s.length-1].endProgramDateTime;if(o>=(e||0))return null;for(var t=0;t<s.length;++t){var i=s[t];if(Jl(o,n,i))return i}return null}function Vr(s,o,n,r,e){n===void 0&&(n=0),r===void 0&&(r=0),e===void 0&&(e=.005);var t=null;if(s){t=o[1+s.sn-o[0].sn]||null;var i=s.endDTS-n;i>0&&i<15e-7&&(n+=15e-7),t&&s.level!==t.level&&t.end<=s.end&&(t=o[2+s.sn-o[0].sn]||null)}else n===0&&o[0].start===0&&(t=o[0]);if(t&&((!s||s.level===t.level)&&Es(n,r,t)===0||$l(t,s,Math.min(e,r))))return t;var a=ys.search(o,Es.bind(null,n,r));return a&&(a!==s||!t)?a:t}function $l(s,o,n){if(o&&o.start===0&&o.level<s.level&&(o.endPTS||0)>0){var r=o.tagList.reduce(function(e,t){return t[0]==="INF"&&(e+=parseFloat(t[1])),e},n);return s.start<=r}return!1}function Es(s,o,n){if(s===void 0&&(s=0),o===void 0&&(o=0),n.start<=s&&n.start+n.duration>s)return 0;var r=Math.min(o,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=s?1:n.start-r>s&&n.start?-1:0}function Jl(s,o,n){var r=Math.min(o,n.duration+(n.deltaPTS?n.deltaPTS:0))*1e3,e=n.endProgramDateTime||0;return e-r>s}function Ts(s,o,n){if(s&&s.startCC<=o&&s.endCC>=o){var r=s.fragments,e=s.fragmentHint;e&&(r=r.concat(e));var t;return ys.search(r,function(i){return i.cc<o?1:i.cc>o?-1:(t=i,i.end<=n?1:i.start>n?-1:0)}),t||null}return null}function on(s){switch(s.details){case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_TIMEOUT:case _.LEVEL_LOAD_TIMEOUT:case _.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ss(s,o){var n=on(o);return s.default[(n?"timeout":"error")+"Retry"]}function ta(s,o){var n=s.backoff==="linear"?1:Math.pow(2,o);return Math.min(n*s.retryDelayMs,s.maxRetryDelayMs)}function As(s){return Ee(Ee({},s),{errorRetry:null,timeoutRetry:null})}function ln(s,o,n,r){if(!s)return!1;var e=r?.code,t=o<s.maxNumRetry&&(Zl(e)||!!n);return s.shouldRetry?s.shouldRetry(s,o,n,r,t):t}function Zl(s){return s===0&&navigator.onLine===!1||!!s&&(s<400||s>499)}var xt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},tr={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2},eu=function(s){function o(r){var e;return e=s.call(this,"error-controller",r.logger)||this,e.hls=void 0,e.playlistError=0,e.penalizedRenditions={},e.hls=r,e.registerListeners(),e}ae(o,s);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.ERROR,this.onError,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.ERROR,this.onError,this),e.off(y.ERROR,this.onErrorOut,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this))},n.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},n.startLoad=function(e){},n.stopLoad=function(){this.playlistError=0},n.getVariantLevelIndex=function(e){return e?.type===F.MAIN?e.level:this.hls.loadLevel},n.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},n.onLevelUpdated=function(){this.playlistError=0},n.onError=function(e,t){var i;if(!t.fatal){var a=this.hls,l=t.context;switch(t.details){case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case _.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=ki();return}case _.FRAG_GAP:case _.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=xt.SendAlternateToPenaltyBox;return}case _.LEVEL_EMPTY_ERROR:case _.LEVEL_PARSING_ERROR:{var u,f,d=t.parent===F.MAIN?t.level:a.loadLevel;t.details===_.LEVEL_EMPTY_ERROR&&((u=t.context)!=null&&(f=u.levelDetails)!=null&&f.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,d))}return;case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:typeof l?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l.level));return;case _.AUDIO_TRACK_LOAD_ERROR:case _.AUDIO_TRACK_LOAD_TIMEOUT:case _.SUBTITLE_LOAD_ERROR:case _.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){var h=a.loadLevelObj;if(h&&(l.type===N.AUDIO_TRACK&&h.hasAudioGroup(l.groupId)||l.type===N.SUBTITLE_TRACK&&h.hasSubtitleGroup(l.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.loadLevel),t.errorAction.action=xt.SendAlternateToPenaltyBox,t.errorAction.flags=tr.MoveAllAlternatesMatchingHost;return}}return;case _.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var c=a.loadLevelObj,v=c?.attrs["HDCP-LEVEL"];v?t.errorAction={action:xt.SendAlternateToPenaltyBox,flags:tr.MoveAllAlternatesMatchingHDCP,hdcpLevel:v}:this.keySystemError(t)}return;case _.BUFFER_ADD_CODEC_ERROR:case _.REMUX_ALLOC_ERROR:case _.BUFFER_APPEND_ERROR:if(!t.errorAction){var g;t.errorAction=this.getLevelSwitchAction(t,(g=t.level)!=null?g:a.loadLevel)}return;case _.INTERNAL_EXCEPTION:case _.BUFFER_APPENDING_ERROR:case _.BUFFER_FULL_ERROR:case _.LEVEL_SWITCH_ERROR:case _.BUFFER_STALLED_ERROR:case _.BUFFER_SEEK_OVER_HOLE:case _.BUFFER_NUDGE_ON_STALL:t.errorAction=ki();return}t.type===Y.KEY_SYSTEM_ERROR&&this.keySystemError(t)}},n.keySystemError=function(e){var t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)},n.getPlaylistRetryOrSwitchAction=function(e,t){var i=this.hls,a=Ss(i.config.playlistLoadPolicy,e),l=this.playlistError++,u=ln(a,l,on(e),e.response);if(u)return{action:xt.RetryRequest,flags:tr.None,retryConfig:a,retryCount:l};var f=this.getLevelSwitchAction(e,t);return a&&(f.retryConfig=a,f.retryCount=l),f},n.getFragRetryOrSwitchAction=function(e){var t=this.hls,i=this.getVariantLevelIndex(e.frag),a=t.levels[i],l=t.config,u=l.fragLoadPolicy,f=l.keyLoadPolicy,d=Ss(e.details.startsWith("key")?f:u,e),h=t.levels.reduce(function(g,m){return g+m.fragmentError},0);if(a){e.details!==_.FRAG_GAP&&a.fragmentError++;var c=ln(d,h,on(e),e.response);if(c)return{action:xt.RetryRequest,flags:tr.None,retryConfig:d,retryCount:h}}var v=this.getLevelSwitchAction(e,i);return d&&(v.retryConfig=d,v.retryCount=h),v},n.getLevelSwitchAction=function(e,t){var i=this.hls;t==null&&(t=i.loadLevel);var a=this.hls.levels[t];if(a){var l,u,f=e.details;a.loadError++,f===_.BUFFER_APPEND_ERROR&&a.fragmentError++;var d=-1,h=i.levels,c=i.loadLevel,v=i.minAutoLevel,g=i.maxAutoLevel;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);for(var m=(l=e.frag)==null?void 0:l.type,p=m===F.AUDIO&&f===_.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===_.BUFFER_ADD_CODEC_ERROR||f===_.BUFFER_APPEND_ERROR),E=p&&h.some(function(L){var R=L.audioCodec;return a.audioCodec!==R}),S=e.sourceBufferName==="video"&&(f===_.BUFFER_ADD_CODEC_ERROR||f===_.BUFFER_APPEND_ERROR),T=S&&h.some(function(L){var R=L.codecSet,C=L.audioCodec;return a.codecSet!==R&&a.audioCodec===C}),A=(u=e.context)!=null?u:{},x=A.type,I=A.groupId,k=function(){var R=(b+c)%h.length;if(R!==c&&R>=v&&R<=g&&h[R].loadError===0){var C,B,P=h[R];if(f===_.FRAG_GAP&&m===F.MAIN&&e.frag){var O=h[R].details;if(O){var V=Vr(e.frag,O.fragments,e.frag.start);if(V!=null&&V.gap)return 0}}else{if(x===N.AUDIO_TRACK&&P.hasAudioGroup(I)||x===N.SUBTITLE_TRACK&&P.hasSubtitleGroup(I))return 0;if(m===F.AUDIO&&(C=a.audioGroups)!=null&&C.some(function(X){return P.hasAudioGroup(X)})||m===F.SUBTITLE&&(B=a.subtitleGroups)!=null&&B.some(function(X){return P.hasSubtitleGroup(X)})||E&&a.audioCodec===P.audioCodec||!E&&a.audioCodec!==P.audioCodec||T&&a.codecSet===P.codecSet)return 0}return d=R,1}},D,b=h.length;b--&&(D=k(),!(D!==0&&D===1)););if(d>-1&&i.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:xt.SendAlternateToPenaltyBox,flags:tr.None,nextAutoLevel:d}}return{action:xt.SendAlternateToPenaltyBox,flags:tr.MoveAllAlternatesMatchingHost}},n.onErrorOut=function(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case xt.DoNothing:break;case xt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==_.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn('MediaSource ended after "'+t.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}},n.sendAlternateToPenaltyBox=function(e){var t=this.hls,i=e.errorAction;if(i){var a=i.flags,l=i.hdcpLevel,u=i.nextAutoLevel;switch(a){case tr.None:this.switchLevel(e,u);break;case tr.MoveAllAlternatesMatchingHDCP:l&&(t.maxHdcpLevel=_i[_i.indexOf(l)-1],i.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower');break}i.resolved||this.switchLevel(e,u)}},n.switchLevel=function(e,t){if(t!==void 0&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===_.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo"))for(var i=Ri(e.mimeType),a=this.hls.levels,l=a.length;l--;)a[l][e.sourceBufferName+"Codec"]===i&&this.hls.removeLevel(l)},o}(Z);function ki(s){var o={action:xt.DoNothing,flags:tr.None};return s&&(o.resolved=!0),o}var ot={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},tu=function(){function s(n){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=n,this._registerListeners()}var o=s.prototype;return o._registerListeners=function(){var r=this.hls;r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.BUFFER_APPENDED,this.onBufferAppended,this),r.on(y.FRAG_BUFFERED,this.onFragBuffered,this),r.on(y.FRAG_LOADED,this.onFragLoaded,this)},o._unregisterListeners=function(){var r=this.hls;r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.BUFFER_APPENDED,this.onBufferAppended,this),r.off(y.FRAG_BUFFERED,this.onFragBuffered,this),r.off(y.FRAG_LOADED,this.onFragLoaded,this)},o.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},o.getAppendedFrag=function(r,e){var t=this.activePartLists[e];if(t)for(var i=t.length;i--;){var a=t[i];if(!a)break;var l=a.end;if(a.start<=r&&l!==null&&r<=l)return a}return this.getBufferedFrag(r,e)},o.getBufferedFrag=function(r,e){return this.getFragAtPos(r,e,!0)},o.getFragAtPos=function(r,e,t){for(var i=this.fragments,a=Object.keys(i),l=a.length;l--;){var u=i[a[l]];if(u?.body.type===e&&(!t||u.buffered)){var f=u.body;if(f.start<=r&&r<=f.end)return f}}return null},o.detectEvictedFragments=function(r,e,t,i,a){var l=this;this.timeRanges&&(this.timeRanges[r]=e);var u=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(function(f){var d=l.fragments[f];if(d&&!(u>=d.body.sn)){if(!d.buffered&&(!d.loaded||a)){d.body.type===t&&l.removeFragment(d.body);return}var h=d.range[r];if(h){if(h.time.length===0){l.removeFragment(d.body);return}h.time.some(function(c){var v=!l.isTimeBuffered(c.startPTS,c.endPTS,e);return v&&l.removeFragment(d.body),v})}}})},o.detectPartialFragments=function(r){var e=this,t=this.timeRanges;if(!(!t||r.frag.sn==="initSegment")){var i=r.frag,a=si(i),l=this.fragments[a];if(!(!l||l.buffered&&i.gap)){var u=!i.relurl;if(Object.keys(t).forEach(function(d){var h=i.elementaryStreams[d];if(h){var c=t[d],v=u||h.partial===!0;l.range[d]=e.getBufferedTimes(i,r.part,v,c)}}),l.loaded=null,Object.keys(l.range).length){l.buffered=!0;var f=l.body.endList=i.endList||l.body.endList;f&&(this.endListFragments[l.body.type]=l),un(l)||this.removeParts(i.sn-1,i.type)}else this.removeFragment(l.body)}}},o.removeParts=function(r,e){var t=this.activePartLists[e];t&&(this.activePartLists[e]=xs(t,function(i){return i.fragment.sn>=r}))},o.fragBuffered=function(r,e){var t=si(r),i=this.fragments[t];!i&&e&&(i=this.fragments[t]={body:r,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},r.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},o.getBufferedTimes=function(r,e,t,i){for(var a={time:[],partial:t},l=r.start,u=r.end,f=r.minEndPTS||u,d=r.maxStartPTS||l,h=0;h<i.length;h++){var c=i.start(h)-this.bufferPadding,v=i.end(h)+this.bufferPadding;if(d>=c&&f<=v){a.time.push({startPTS:Math.max(l,i.start(h)),endPTS:Math.min(u,i.end(h))});break}else if(l<v&&u>c){var g=Math.max(l,i.start(h)),m=Math.min(u,i.end(h));m>g&&(a.partial=!0,a.time.push({startPTS:g,endPTS:m}))}else if(u<=c)break}return a},o.getPartialFragment=function(r){var e=null,t,i,a,l=0,u=this.bufferPadding,f=this.fragments;return Object.keys(f).forEach(function(d){var h=f[d];h&&un(h)&&(i=h.body.start-u,a=h.body.end+u,r>=i&&r<=a&&(t=Math.min(r-i,a-r),l<=t&&(e=h.body,l=t)))}),e},o.isEndListAppended=function(r){var e=this.endListFragments[r];return e!==void 0&&(e.buffered||un(e))},o.getState=function(r){var e=si(r),t=this.fragments[e];return t?t.buffered?un(t)?ot.PARTIAL:ot.OK:ot.APPENDING:ot.NOT_LOADED},o.isTimeBuffered=function(r,e,t){for(var i,a,l=0;l<t.length;l++){if(i=t.start(l)-this.bufferPadding,a=t.end(l)+this.bufferPadding,r>=i&&e<=a)return!0;if(e<=i)return!1}return!1},o.onManifestLoading=function(){this.removeAllFragments()},o.onFragLoaded=function(r,e){if(!(e.frag.sn==="initSegment"||e.frag.bitrateTest)){var t=e.frag,i=e.part?null:e,a=si(t);this.fragments[a]={body:t,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}},o.onBufferAppended=function(r,e){var t=e.frag,i=e.part,a=e.timeRanges,l=e.type;if(t.sn!=="initSegment"){var u=t.type;if(i){var f=this.activePartLists[u];f||(this.activePartLists[u]=f=[]),f.push(i)}this.timeRanges=a;var d=a[l];this.detectEvictedFragments(l,d,u,i)}},o.onFragBuffered=function(r,e){this.detectPartialFragments(e)},o.hasFragment=function(r){var e=si(r);return!!this.fragments[e]},o.hasFragments=function(r){var e=this.fragments,t=Object.keys(e);if(!r)return t.length>0;for(var i=t.length;i--;){var a=e[t[i]];if(a?.body.type===r)return!0}return!1},o.hasParts=function(r){var e;return!!((e=this.activePartLists[r])!=null&&e.length)},o.removeFragmentsInRange=function(r,e,t,i,a){var l=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach(function(u){var f=l.fragments[u];if(f){var d=f.body;d.type!==t||i&&!d.gap||d.start<e&&d.end>r&&(f.buffered||a)&&l.removeFragment(d)}})},o.removeFragment=function(r){var e=si(r);r.clearElementaryStreamInfo();var t=this.activePartLists[r.type];if(t){var i=r.sn;this.activePartLists[r.type]=xs(t,function(a){return a.fragment.sn!==i})}delete this.fragments[e],r.endList&&delete this.endListFragments[r.type]},o.removeAllFragments=function(){var r,e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;var t=(r=this.hls)==null||(e=r.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(function(i){return i.clearElementaryStreamInfo()})},s}();function un(s){var o,n,r;return s.buffered&&(s.body.gap||((o=s.range.video)==null?void 0:o.partial)||((n=s.range.audio)==null?void 0:n.partial)||((r=s.range.audiovideo)==null?void 0:r.partial))}function si(s){return s.type+"_"+s.level+"_"+s.sn}function xs(s,o){return s.filter(function(n){var r=o(n);return r||n.clearElementaryStreamInfo(),r})}var kr={cbc:0,ctr:1},ru=function(){function s(n,r,e){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=n,this.aesIV=r,this.aesMode=e}var o=s.prototype;return o.decrypt=function(r,e){switch(this.aesMode){case kr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,r);case kr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,r);default:throw new Error("[AESCrypto] invalid aes mode "+this.aesMode)}},s}();function iu(s){var o=s.byteLength,n=o&&new DataView(s.buffer).getUint8(o-1);return n?s.slice(0,o-n):s}var nu=function(){function s(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var o=s.prototype;return o.uint8ArrayToUint32Array_=function(r){for(var e=new DataView(r),t=new Uint32Array(4),i=0;i<4;i++)t[i]=e.getUint32(i*4);return t},o.initTable=function(){var r=this.sBox,e=this.invSBox,t=this.subMix,i=t[0],a=t[1],l=t[2],u=t[3],f=this.invSubMix,d=f[0],h=f[1],c=f[2],v=f[3],g=new Uint32Array(256),m=0,p=0,E=0;for(E=0;E<256;E++)E<128?g[E]=E<<1:g[E]=E<<1^283;for(E=0;E<256;E++){var S=p^p<<1^p<<2^p<<3^p<<4;S=S>>>8^S&255^99,r[m]=S,e[S]=m;var T=g[m],A=g[T],x=g[A],I=g[S]*257^S*16843008;i[m]=I<<24|I>>>8,a[m]=I<<16|I>>>16,l[m]=I<<8|I>>>24,u[m]=I,I=x*16843009^A*65537^T*257^m*16843008,d[S]=I<<24|I>>>8,h[S]=I<<16|I>>>16,c[S]=I<<8|I>>>24,v[S]=I,m?(m=T^g[g[g[x^T]]],p^=g[g[p]]):m=p=1}},o.expandKey=function(r){for(var e=this.uint8ArrayToUint32Array_(r),t=!0,i=0;i<e.length&&t;)t=e[i]===this.key[i],i++;if(!t){this.key=e;var a=this.keySize=e.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);var l=this.ksRows=(a+6+1)*4,u,f,d=this.keySchedule=new Uint32Array(l),h=this.invKeySchedule=new Uint32Array(l),c=this.sBox,v=this.rcon,g=this.invSubMix,m=g[0],p=g[1],E=g[2],S=g[3],T,A;for(u=0;u<l;u++){if(u<a){T=d[u]=e[u];continue}A=T,u%a===0?(A=A<<8|A>>>24,A=c[A>>>24]<<24|c[A>>>16&255]<<16|c[A>>>8&255]<<8|c[A&255],A^=v[u/a|0]<<24):a>6&&u%a===4&&(A=c[A>>>24]<<24|c[A>>>16&255]<<16|c[A>>>8&255]<<8|c[A&255]),d[u]=T=(d[u-a]^A)>>>0}for(f=0;f<l;f++)u=l-f,f&3?A=d[u]:A=d[u-4],f<4||u<=4?h[f]=A:h[f]=m[c[A>>>24]]^p[c[A>>>16&255]]^E[c[A>>>8&255]]^S[c[A&255]],h[f]=h[f]>>>0}},o.networkToHostOrderSwap=function(r){return r<<24|(r&65280)<<8|(r&16711680)>>8|r>>>24},o.decrypt=function(r,e,t){for(var i=this.keySize+6,a=this.invKeySchedule,l=this.invSBox,u=this.invSubMix,f=u[0],d=u[1],h=u[2],c=u[3],v=this.uint8ArrayToUint32Array_(t),g=v[0],m=v[1],p=v[2],E=v[3],S=new Int32Array(r),T=new Int32Array(S.length),A,x,I,k,D,b,L,R,C,B,P,O,V,X,z=this.networkToHostOrderSwap;e<S.length;){for(C=z(S[e]),B=z(S[e+1]),P=z(S[e+2]),O=z(S[e+3]),D=C^a[0],b=O^a[1],L=P^a[2],R=B^a[3],V=4,X=1;X<i;X++)A=f[D>>>24]^d[b>>16&255]^h[L>>8&255]^c[R&255]^a[V],x=f[b>>>24]^d[L>>16&255]^h[R>>8&255]^c[D&255]^a[V+1],I=f[L>>>24]^d[R>>16&255]^h[D>>8&255]^c[b&255]^a[V+2],k=f[R>>>24]^d[D>>16&255]^h[b>>8&255]^c[L&255]^a[V+3],D=A,b=x,L=I,R=k,V=V+4;A=l[D>>>24]<<24^l[b>>16&255]<<16^l[L>>8&255]<<8^l[R&255]^a[V],x=l[b>>>24]<<24^l[L>>16&255]<<16^l[R>>8&255]<<8^l[D&255]^a[V+1],I=l[L>>>24]<<24^l[R>>16&255]<<16^l[D>>8&255]<<8^l[b&255]^a[V+2],k=l[R>>>24]<<24^l[D>>16&255]<<16^l[b>>8&255]<<8^l[L&255]^a[V+3],T[e]=z(A^g),T[e+1]=z(k^m),T[e+2]=z(I^p),T[e+3]=z(x^E),g=C,m=B,p=P,E=O,e=e+4}return T.buffer},s}(),au=function(){function s(n,r,e){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=n,this.key=r,this.aesMode=e}var o=s.prototype;return o.expandKey=function(){var r=su(this.aesMode);return this.subtle.importKey("raw",this.key,{name:r},!1,["encrypt","decrypt"])},s}();function su(s){switch(s){case kr.cbc:return"AES-CBC";case kr.ctr:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode "+s)}}var ou=16,ra=function(){function s(n,r){var e=r===void 0?{}:r,t=e.removePKCS7Padding,i=t===void 0?!0:t;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=n.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var o=s.prototype;return o.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},o.isSync=function(){return this.useSoftware},o.flush=function(){var r=this.currentResult,e=this.remainderData;if(!r||e)return this.reset(),null;var t=new Uint8Array(r);return this.reset(),this.removePKCS7Padding?iu(t):t},o.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},o.decrypt=function(r,e,t,i){var a=this;return this.useSoftware?new Promise(function(l,u){var f=ArrayBuffer.isView(r)?r:new Uint8Array(r);a.softwareDecrypt(f,e,t,i);var d=a.flush();d?l(d.buffer):u(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(r),e,t,i)},o.softwareDecrypt=function(r,e,t,i){var a=this.currentIV,l=this.currentResult,u=this.remainderData;if(i!==kr.cbc||e.byteLength!==16)return Se.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(r=Ut(u,r),this.remainderData=null);var f=this.getValidChunk(r);if(!f.length)return null;a&&(t=a);var d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new nu),d.expandKey(e);var h=l;return this.currentResult=d.decrypt(f.buffer,0,t),this.currentIV=f.slice(-16).buffer,h||null},o.webCryptoDecrypt=function(r,e,t,i){var a=this;if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(r,e,t,i));this.key=e,this.fastAesKey=new au(this.subtle,e,i)}return this.fastAesKey.expandKey().then(function(l){if(!a.subtle)return Promise.reject(new Error("web crypto not initialized"));a.logOnce("WebCrypto AES decrypt");var u=new ru(a.subtle,new Uint8Array(t),i);return u.decrypt(r.buffer,l)}).catch(function(l){return Se.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+l.name+": "+l.message),a.onWebCryptoError(r,e,t,i)})},o.onWebCryptoError=function(r,e,t,i){var a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(r,e,t,i);var l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")},o.getValidChunk=function(r){var e=r,t=r.length-r.length%ou;return t!==r.length&&(e=r.slice(0,t),this.remainderData=r.slice(t)),e},o.logOnce=function(r){this.logEnabled&&(Se.log("[decrypter]: "+r),this.logEnabled=!1)},s}(),Ls=Math.pow(2,17),lu=function(){function s(n){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=n}var o=s.prototype;return o.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},o.abort=function(){this.loader&&this.loader.abort()},o.load=function(r,e){var t=this,i=r.url;if(!i)return Promise.reject(new mr({type:Y.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:r,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var a=this.config,l=a.fLoader,u=a.loader;return new Promise(function(f,d){if(t.loader&&t.loader.destroy(),r.gap)if(r.tagList.some(function(p){return p[0]==="GAP"})){d(bs(r));return}else r.gap=!1;var h=t.loader=l?new l(a):new u(a),c=Is(r);r.loader=h;var v=As(a.fragLoadPolicy.default),g={loadPolicy:v,timeout:v.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:r.sn==="initSegment"?1/0:Ls};r.stats=h.stats;var m={onSuccess:function(E,S,T,A){t.resetLoader(r,h);var x=E.data;T.resetIV&&r.decryptdata&&(r.decryptdata.iv=new Uint8Array(x.slice(0,16)),x=x.slice(16)),f({frag:r,part:null,payload:x,networkDetails:A})},onError:function(E,S,T,A){t.resetLoader(r,h),d(new mr({type:Y.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:Ee({url:i,data:void 0},E),error:new Error("HTTP Error "+E.code+" "+E.text),networkDetails:T,stats:A}))},onAbort:function(E,S,T){t.resetLoader(r,h),d(new mr({type:Y.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:r,error:new Error("Aborted"),networkDetails:T,stats:E}))},onTimeout:function(E,S,T){t.resetLoader(r,h),d(new mr({type:Y.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:T,stats:E}))}};e&&(m.onProgress=function(p,E,S,T){return e({frag:r,part:null,payload:S,networkDetails:T})}),h.load(c,g,m)})},o.loadPart=function(r,e,t){var i=this;this.abort();var a=this.config,l=a.fLoader,u=a.loader;return new Promise(function(f,d){if(i.loader&&i.loader.destroy(),r.gap||e.gap){d(bs(r,e));return}var h=i.loader=l?new l(a):new u(a),c=Is(r,e);r.loader=h;var v=As(a.fragLoadPolicy.default),g={loadPolicy:v,timeout:v.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ls};e.stats=h.stats,h.load(c,g,{onSuccess:function(p,E,S,T){i.resetLoader(r,h),i.updateStatsFromPart(r,e);var A={frag:r,part:e,payload:p.data,networkDetails:T};t(A),f(A)},onError:function(p,E,S,T){i.resetLoader(r,h),d(new mr({type:Y.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:e,response:Ee({url:c.url,data:void 0},p),error:new Error("HTTP Error "+p.code+" "+p.text),networkDetails:S,stats:T}))},onAbort:function(p,E,S){r.stats.aborted=e.stats.aborted,i.resetLoader(r,h),d(new mr({type:Y.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:r,part:e,error:new Error("Aborted"),networkDetails:S,stats:p}))},onTimeout:function(p,E,S){i.resetLoader(r,h),d(new mr({type:Y.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:e,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:S,stats:p}))}})})},o.updateStatsFromPart=function(r,e){var t=r.stats,i=e.stats,a=i.total;if(t.loaded+=i.loaded,a){var l=Math.round(r.duration/e.duration),u=Math.min(Math.round(t.loaded/a),l),f=l-u,d=f*Math.round(t.loaded/u);t.total=t.loaded+d}else t.total=Math.max(t.loaded,t.total);var h=t.loading,c=i.loading;h.start?h.first+=c.first-c.start:(h.start=c.start,h.first=c.first),h.end=c.end},o.resetLoader=function(r,e){r.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},s}();function Is(s,o){o===void 0&&(o=null);var n=o||s,r={frag:s,part:o,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},e=n.byteRangeStartOffset,t=n.byteRangeEndOffset;if(H(e)&&H(t)){var i,a=e,l=t;if(s.sn==="initSegment"&&uu((i=s.decryptdata)==null?void 0:i.method)){var u=t-e;u%16&&(l=t+(16-u%16)),e!==0&&(r.resetIV=!0,a=e-16)}r.rangeStart=a,r.rangeEnd=l}return r}function bs(s,o){var n=new Error("GAP "+(s.gap?"tag":"attribute")+" found"),r={type:Y.MEDIA_ERROR,details:_.FRAG_GAP,fatal:!1,frag:s,error:n,networkDetails:null};return o&&(r.part=o),(o||s).stats.aborted=!0,new mr(r)}function uu(s){return s==="AES-128"||s==="AES-256"}var mr=function(s){function o(n){var r;return r=s.call(this,n.error.message)||this,r.data=void 0,r.data=n,r}return ae(o,s),o}(Xe(Error)),Rs=function(s){function o(r,e){var t;return t=s.call(this,r,e)||this,t._boundTick=void 0,t._tickTimer=null,t._tickInterval=null,t._tickCallCount=0,t._boundTick=t.tick.bind(t),t}ae(o,s);var n=o.prototype;return n.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},n.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},n.onHandlerDestroyed=function(){},n.hasInterval=function(){return!!this._tickInterval},n.hasNextTick=function(){return!!this._tickTimer},n.setInterval=function(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},n.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},n.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},n.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},n.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},n.doTick=function(){},o}(Z),ia=function(o,n,r,e,t,i){e===void 0&&(e=0),t===void 0&&(t=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=fn(),this.buffering={audio:fn(),video:fn(),audiovideo:fn()},this.level=o,this.sn=n,this.id=r,this.size=e,this.part=t,this.partial=i};function fn(){return{start:0,executeStart:0,executeEnd:0,end:0}}var _s={length:0,start:function(){return 0},end:function(){return 0}},Ae=function(){function s(){}return s.isBuffered=function(n,r){if(n){for(var e=s.getBuffered(n),t=e.length;t--;)if(r>=e.start(t)&&r<=e.end(t))return!0}return!1},s.bufferedRanges=function(n){if(n){var r=s.getBuffered(n);return s.timeRangesToArray(r)}return[]},s.timeRangesToArray=function(n){for(var r=[],e=0;e<n.length;e++)r.push({start:n.start(e),end:n.end(e)});return r},s.bufferInfo=function(n,r,e){if(n){var t=s.bufferedRanges(n);if(t.length)return s.bufferedInfo(t,r,e)}return{len:0,start:r,end:r,bufferedIndex:-1}},s.bufferedInfo=function(n,r,e){r=Math.max(0,r),n.length>1&&n.sort(function(p,E){return p.start-E.start||E.end-p.end});var t=-1,i=[];if(e)for(var a=0;a<n.length;a++){r>=n[a].start&&r<=n[a].end&&(t=a);var l=i.length;if(l){var u=i[l-1].end;n[a].start-u<e?n[a].end>u&&(i[l-1].end=n[a].end):i.push(n[a])}else i.push(n[a])}else i=n;for(var f=0,d,h=r,c=r,v=0;v<i.length;v++){var g=i[v].start,m=i[v].end;if(t===-1&&r>=g&&r<=m&&(t=v),r+e>=g&&r<m)h=g,c=m,f=c-r;else if(r+e<g){d=g;break}}return{len:f,start:h||0,end:c||0,nextStart:d,buffered:n,bufferedIndex:t}},s.getBuffered=function(n){try{return n.buffered||_s}catch(r){return Se.log("failed to get media.buffered",r),_s}},s}(),Ds=/\{\$([a-zA-Z0-9-_]+)\}/g;function ks(s){return Ds.test(s)}function na(s,o){if(s.variableList!==null||s.hasVariableRefs){var n=s.variableList;return o.replace(Ds,function(r){var e=r.substring(2,r.length-1),t=n?.[e];return t===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+e+'"')),r):t})}return o}function Cs(s,o,n){var r=s.variableList;r||(s.variableList=r={});var e,t;if("QUERYPARAM"in o){e=o.QUERYPARAM;try{var i=new self.URL(n).searchParams;if(i.has(e))t=i.get(e);else throw new Error('"'+e+'" does not match any query parameter in URI: "'+n+'"')}catch(a){s.playlistParsingError||(s.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+a.message))}}else e=o.NAME,t=o.VALUE;e in r?s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+e+'"')):r[e]=t||""}function fu(s,o,n){var r=o.IMPORT;if(n&&r in n){var e=s.variableList;e||(s.variableList=e={}),e[r]=n[r]}else s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+r+'"'))}var du=/^(\d+)x(\d+)$/,Ps=/(.+?)=(".*?"|.*?)(?:,|$)/g,Je=function(){function s(n,r){typeof n=="string"&&(n=s.parseAttrList(n,r)),re(this,n)}var o=s.prototype;return o.decimalInteger=function(r){var e=parseInt(this[r],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},o.hexadecimalInteger=function(r){if(this[r]){var e=(this[r]||"0x").slice(2);e=(e.length&1?"0":"")+e;for(var t=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)t[i]=parseInt(e.slice(i*2,i*2+2),16);return t}return null},o.hexadecimalIntegerAsNumber=function(r){var e=parseInt(this[r],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},o.decimalFloatingPoint=function(r){return parseFloat(this[r])},o.optionalFloat=function(r,e){var t=this[r];return t?parseFloat(t):e},o.enumeratedString=function(r){return this[r]},o.enumeratedStringList=function(r,e){var t=this[r];return(t?t.split(/[ ,]+/):[]).reduce(function(i,a){return i[a.toLowerCase()]=!0,i},e)},o.bool=function(r){return this[r]==="YES"},o.decimalResolution=function(r){var e=du.exec(this[r]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},s.parseAttrList=function(r,e){var t,i={},a='"';for(Ps.lastIndex=0;(t=Ps.exec(r))!==null;){var l=t[1].trim(),u=t[2],f=u.indexOf(a)===0&&u.lastIndexOf(a)===u.length-1,d=!1;if(f)u=u.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(e&&(f||d))u=na(e,u);else if(!d&&!f)switch(l){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Se.warn(r+": attribute "+l+" is missing quotes")}i[l]=u}return i},W(s,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(r){return r.substring(0,2)==="X-"})}}])}(),hu="com.apple.hls.interstitial";function cu(s){return s!=="ID"&&s!=="CLASS"&&s!=="CUE"&&s!=="START-DATE"&&s!=="DURATION"&&s!=="END-DATE"&&s!=="END-ON-NEXT"}function vu(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"||s==="SCTE35-CMD"}var ws=function(){function s(o,n,r){var e;if(r===void 0&&(r=0),this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=n?.tagAnchor||null,this.tagOrder=(e=n?.tagOrder)!=null?e:r,n){var t=n.attr;for(var i in t)if(Object.prototype.hasOwnProperty.call(o,i)&&o[i]!==t[i]){Se.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+o.ID+'"'),this._badValueForSameId=i;break}o=re(new Je({}),t,o)}if(this.attr=o,n?(this._startDate=n._startDate,this._cue=n._cue,this._endDate=n._endDate,this._dateAtEnd=n._dateAtEnd):this._startDate=new Date(o["START-DATE"]),"END-DATE"in this.attr){var a=n?.endDate||new Date(this.attr["END-DATE"]);H(a.getTime())&&(this._endDate=a)}}return W(s,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"cue",get:function(){var n=this._cue;return n===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):n}},{key:"startTime",get:function(){var n=this.tagAnchor;return n===null||n.programDateTime===null?(Se.warn('Expected tagAnchor Fragment with PDT set for DateRange "'+this.id+'": '+n),NaN):n.start+(this.startDate.getTime()-n.programDateTime)/1e3}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var n=this._endDate||this._dateAtEnd;if(n)return n;var r=this.duration;return r!==null?this._dateAtEnd=new Date(this._startDate.getTime()+r*1e3):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var n=this.attr.decimalFloatingPoint("DURATION");if(H(n))return n}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isInterstitial",get:function(){return this.class===hu}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&H(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}])}(),gu=10,mu=function(){function s(n){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=n}var o=s.prototype;return o.reloaded=function(r){if(!r){this.advanced=!0,this.updated=!0;return}var e=this.lastPartSn-r.lastPartSn,t=this.lastPartIndex-r.lastPartIndex;this.updated=this.endSN!==r.endSN||!!t||!!e||!this.live,this.advanced=this.endSN>r.endSN||e>0||e===0&&t>0,this.updated||this.advanced?this.misses=Math.floor(r.misses*.6):this.misses=r.misses+1},W(s,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?H(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||gu}},{key:"drift",get:function(){var r=this.driftEndTime-this.driftStartTime;if(r>0){var e=this.driftEnd-this.driftStart;return e*1e3/r}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var r;return(r=this.fragments)!=null&&r.length?this.fragments[this.fragments.length-1].end:0}},{key:"fragmentStart",get:function(){var r;return(r=this.fragments)!=null&&r.length?this.fragments[0].start:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].index:-1}},{key:"maxPartIndex",get:function(){var r=this.partList;if(r){var e=this.lastPartIndex;if(e!==-1){for(var t=r.length;t--;)if(r[t].index>e)return r[t].index;return e}}return 0}},{key:"lastPartSn",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}},{key:"expired",get:function(){if(this.live&&this.age&&this.misses<3){var r=this.partEnd-this.fragmentStart;return this.age>Math.max(r,this.totalduration)+this.levelTargetDuration}return!1}}])}();function oi(s){return s==="AES-128"||s==="AES-256"||s==="AES-256-CTR"}function aa(s){switch(s){case"AES-128":case"AES-256":return kr.cbc;case"AES-256-CTR":return kr.ctr;default:throw new Error("invalid full segment method "+s)}}function Ms(s){return Uint8Array.from(atob(s),function(o){return o.charCodeAt(0)})}function sa(s){return Uint8Array.from(unescape(encodeURIComponent(s)),function(o){return o.charCodeAt(0)})}function pu(s){var o=sa(s).subarray(0,16),n=new Uint8Array(16);return n.set(o,16-o.length),n}function yu(s){var o=function(r,e,t){var i=r[e];r[e]=r[t],r[t]=i};o(s,0,3),o(s,1,2),o(s,4,5),o(s,6,7)}function Eu(s){var o=s.split(":"),n=null;if(o[0]==="data"&&o.length===2){var r=o[1].split(";"),e=r[r.length-1].split(",");if(e.length===2){var t=e[0]==="base64",i=e[1];t?(r.splice(-1,1),n=Ms(i)):n=pu(i)}}return n}var dn=typeof self<"u"?self:void 0,Ze={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Gt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function oa(s){switch(s){case Gt.FAIRPLAY:return Ze.FAIRPLAY;case Gt.PLAYREADY:return Ze.PLAYREADY;case Gt.WIDEVINE:return Ze.WIDEVINE;case Gt.CLEARKEY:return Ze.CLEARKEY}}function Os(s){switch(s){case Ze.FAIRPLAY:return Gt.FAIRPLAY;case Ze.PLAYREADY:return Gt.PLAYREADY;case Ze.WIDEVINE:return Gt.WIDEVINE;case Ze.CLEARKEY:return Gt.CLEARKEY}}function hn(s){var o=s.drmSystems,n=s.widevineLicenseUrl,r=o?[Ze.FAIRPLAY,Ze.WIDEVINE,Ze.PLAYREADY,Ze.CLEARKEY].filter(function(e){return!!o[e]}):[];return!r[Ze.WIDEVINE]&&n&&r.push(Ze.WIDEVINE),r}var Fs=function(s){return dn!=null&&(s=dn.navigator)!=null&&s.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Tu(s,o,n,r){var e;switch(s){case Ze.FAIRPLAY:e=["cenc","sinf"];break;case Ze.WIDEVINE:case Ze.PLAYREADY:e=["cenc"];break;case Ze.CLEARKEY:e=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+s)}return Su(e,o,n,r)}function Su(s,o,n,r){var e={initDataTypes:s,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:o.map(function(t){return{contentType:"audio/mp4; codecs="+t,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null}}),videoCapabilities:n.map(function(t){return{contentType:"video/mp4; codecs="+t,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}})};return[e]}function Au(s){var o;return s.sessionType==="persistent-license"||!!((o=s.sessionTypes)!=null&&o.some(function(n){return n==="persistent-license"}))}function xu(s){var o=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2),n=String.fromCharCode.apply(null,Array.from(o)),r=n.substring(n.indexOf("<"),n.length),e=new DOMParser,t=e.parseFromString(r,"text/xml"),i=t.getElementsByTagName("KID")[0];if(i){var a=i.childNodes[0]?i.childNodes[0].nodeValue:i.getAttribute("VALUE");if(a){var l=Ms(a).subarray(0,16);return yu(l),l}}return null}var cn={},Ns=function(){function s(n,r,e,t,i,a){t===void 0&&(t=[1]),i===void 0&&(i=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=n,this.uri=r,this.keyFormat=e,this.keyFormatVersions=t,this.iv=i,this.encrypted=n?n!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!oi(n),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(Re(a)))}s.clearKeyUriToKeyIdMap=function(){cn={}};var o=s.prototype;return o.matches=function(r){var e,t;return r.uri===this.uri&&r.method===this.method&&r.encrypted===this.encrypted&&r.keyFormat===this.keyFormat&&r.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((e=r.iv)==null?void 0:e.join(","))===((t=this.iv)==null?void 0:t.join(","))},o.isSupported=function(){if(this.method){if(oi(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Gt.FAIRPLAY:case Gt.WIDEVINE:case Gt.PLAYREADY:case Gt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},o.getDecryptData=function(r){if(!this.encrypted||!this.uri)return null;if(oi(this.method)&&this.uri&&!this.iv){typeof r!="number"&&(Se.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),r=0);var e=Lu(r),t=new s(this.method,this.uri,"identity",this.keyFormatVersions,e);return t}if(this.pssh&&this.keyId)return this;var i=Eu(this.uri);if(i)switch(this.keyFormat){case Gt.WIDEVINE:if(this.pssh=i,!this.keyId&&i.length>=22){var a=i.length-22;this.keyId=i.subarray(a,a+16)}break;case Gt.PLAYREADY:{var l=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=xi(l,null,i),this.keyId=xu(i);break}default:{var u=i.subarray(0,16);if(u.length!==16){var f=new Uint8Array(16);f.set(u,16-u.length),u=f}this.keyId=u;break}}if(!this.keyId||this.keyId.byteLength!==16){var d=cn[this.uri];if(!d){var h=Object.keys(cn).length%Number.MAX_SAFE_INTEGER;d=new Uint8Array(16);var c=new DataView(d.buffer,12,4);c.setUint32(0,h),cn[this.uri]=d}this.keyId=d}return this},s}();function Lu(s){for(var o=new Uint8Array(16),n=12;n<16;n++)o[n]=s>>8*(15-n)&255;return o}var Us=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Bs=/#EXT-X-MEDIA:(.*)/g,Iu=/^#EXT(?:INF|-X-TARGETDURATION):/m,la=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),bu=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Ci=function(){function s(){}return s.findGroup=function(n,r){for(var e=0;e<n.length;e++){var t=n[e];if(t.id===r)return t}},s.resolve=function(n,r){return _t.buildAbsoluteURL(r,n,{alwaysNormalize:!0})},s.isMediaPlaylist=function(n){return Iu.test(n)},s.parseMasterPlaylist=function(n,r){var e=ks(n),t={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:e},i=[];Us.lastIndex=0;for(var a;(a=Us.exec(n))!=null;)if(a[1]){var l,u=new Je(a[1],t),f=na(t,a[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:s.resolve(f,r)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),Vs(u.CODECS,d);var c=u["SUPPLEMENTAL-CODECS"];c&&(d.supplemental={},Vs(c,d.supplemental)),(l=d.unknownCodecs)!=null&&l.length||i.push(d),t.levels.push(d)}else if(a[3]){var v=a[3],g=a[4];switch(v){case"SESSION-DATA":{var m=new Je(g,t),p=m["DATA-ID"];p&&(t.sessionData===null&&(t.sessionData={}),t.sessionData[p]=m);break}case"SESSION-KEY":{var E=Ks(g,r,t);E.encrypted&&E.isSupported()?(t.sessionKeys===null&&(t.sessionKeys=[]),t.sessionKeys.push(E)):Se.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+g+'"');break}case"DEFINE":{{var S=new Je(g,t);Cs(t,S,r)}break}case"CONTENT-STEERING":{var T=new Je(g,t);t.contentSteering={uri:s.resolve(T["SERVER-URI"],r),pathwayId:T["PATHWAY-ID"]||"."};break}case"START":{t.startTimeOffset=Hs(g);break}}}var A=i.length>0&&i.length<t.levels.length;return t.levels=A?i:t.levels,t.levels.length===0&&(t.playlistParsingError=new Error("no levels found in manifest")),t},s.parseMasterPlaylistMedia=function(n,r,e){var t,i={},a=e.levels,l={AUDIO:a.map(function(A){return{id:A.attrs.AUDIO,audioCodec:A.audioCodec}}),SUBTITLES:a.map(function(A){return{id:A.attrs.SUBTITLES,textCodec:A.textCodec}}),"CLOSED-CAPTIONS":[]},u=0;for(Bs.lastIndex=0;(t=Bs.exec(n))!==null;){var f=new Je(t[1],e),d=f.TYPE;if(d){var h=l[d],c=i[d]||[];i[d]=c;var v=f.LANGUAGE,g=f["ASSOC-LANGUAGE"],m=f.CHANNELS,p=f.CHARACTERISTICS,E=f["INSTREAM-ID"],S={attrs:f,bitrate:0,id:u++,groupId:f["GROUP-ID"]||"",name:f.NAME||v||"",type:d,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:v,url:f.URI?s.resolve(f.URI,r):""};if(g&&(S.assocLang=g),m&&(S.channels=m),p&&(S.characteristics=p),E&&(S.instreamId=E),h!=null&&h.length){var T=s.findGroup(h,S.groupId)||h[0];Ws(S,T,"audioCodec"),Ws(S,T,"textCodec")}c.push(S)}}return i},s.parseLevelPlaylist=function(n,r,e,t,i,a){var l,u={url:r},f=new mu(r),d=f.fragments,h=[],c=null,v=0,g=0,m=0,p=0,E=0,S=null,T=new ft(t,u),A,x,I,k=-1,D=!1,b=null,L;if(la.lastIndex=0,f.m3u8=n,f.hasVariableRefs=ks(n),((l=la.exec(n))==null?void 0:l[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(A=la.exec(n))!==null;){D&&(D=!1,T=new ft(t,u),T.playlistOffset=m,T.start=m,T.sn=v,T.cc=p,E&&(T.bitrate=E),T.level=e,c&&(T.initSegment=c,c.rawProgramDateTime&&(T.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null),b&&(T.setByteRange(b),b=null)));var R=A[1];if(R){T.duration=parseFloat(R);var C=(" "+A[2]).slice(1);T.title=C||null,T.tagList.push(C?["INF",R,C]:["INF",R])}else if(A[3]){if(H(T.duration)){T.playlistOffset=m,T.start=m,I&&qs(T,I,f),T.sn=v,T.level=e,T.cc=p,d.push(T);var B=(" "+A[3]).slice(1);T.relurl=na(f,B),ua(T,S,h),S=T,m+=T.duration,v++,g=0,D=!0}}else{if(A=A[0].match(bu),!A){Se.warn("No matches on slow regex match for level playlist!");continue}for(x=1;x<A.length&&A[x]===void 0;x++);var P=(" "+A[x]).slice(1),O=(" "+A[x+1]).slice(1),V=A[x+2]?(" "+A[x+2]).slice(1):null;switch(P){case"BYTERANGE":S?T.setByteRange(O,S):T.setByteRange(O);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=O,T.tagList.push(["PROGRAM-DATE-TIME",O]),k===-1&&(k=d.length);break;case"PLAYLIST-TYPE":f.type&&pr(f,P,A),f.type=O.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?pr(f,P,A):d.length>0&&js(f,P,A),v=f.startSN=parseInt(O);break;case"SKIP":{f.skippedSegments&&pr(f,P,A);var X=new Je(O,f),z=X.decimalInteger("SKIPPED-SEGMENTS");if(H(z)){f.skippedSegments+=z;for(var Q=z;Q--;)d.push(null);v+=z}var ue=X.enumeratedString("RECENTLY-REMOVED-DATERANGES");ue&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(ue.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&pr(f,P,A),f.targetduration=Math.max(parseInt(O),1);break;case"VERSION":f.version!==null&&pr(f,P,A),f.version=parseInt(O);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||pr(f,P,A),f.live=!1;break;case"#":(O||V)&&T.tagList.push(V?[O,V]:[O]);break;case"DISCONTINUITY":p++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([P]);break;case"BITRATE":T.tagList.push([P,O]),E=parseInt(O)*1e3,H(E)?T.bitrate=E:E=0;break;case"DATERANGE":{var te=new Je(O,f),le=new ws(te,f.dateRanges[te.ID],f.dateRangeTagCount);f.dateRangeTagCount++,le.isValid||f.skippedSegments?f.dateRanges[le.id]=le:Se.warn('Ignoring invalid DATERANGE tag: "'+O+'"'),T.tagList.push(["EXT-X-DATERANGE",O]);break}case"DEFINE":{{var ve=new Je(O,f);"IMPORT"in ve?fu(f,ve,a):Cs(f,ve,r)}break}case"DISCONTINUITY-SEQUENCE":f.startCC!==0?pr(f,P,A):d.length>0&&js(f,P,A),f.startCC=p=parseInt(O);break;case"KEY":{var Te=Ks(O,r,f);if(Te.isSupported()){if(Te.method==="NONE"){I=void 0;break}I||(I={});var ke=I[Te.keyFormat];ke!=null&&ke.matches(Te)||(ke&&(I=re({},I)),I[Te.keyFormat]=Te)}else Se.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+O+'"');break}case"START":f.startTimeOffset=Hs(O);break;case"MAP":{var Me=new Je(O,f);if(T.duration){var Ge=new ft(t,u);Ys(Ge,Me,e,I),c=Ge,T.initSegment=c,c.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=c.rawProgramDateTime)}else{var et=T.byteRangeEndOffset;if(et){var He=T.byteRangeStartOffset;b=et-He+"@"+He}else b=null;Ys(T,Me,e,I),c=T,D=!0}c.cc=p;break}case"SERVER-CONTROL":{L&&pr(f,P,A),L=new Je(O),f.canBlockReload=L.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=L.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&L.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=L.optionalFloat("PART-HOLD-BACK",0),f.holdBack=L.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&pr(f,P,A);var Lt=new Je(O);f.partTarget=Lt.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Ve=f.partList;Ve||(Ve=f.partList=[]);var lt=g>0?Ve[Ve.length-1]:void 0,xe=g++,It=new Je(O,f),pt=new Mt(It,T,u,xe,lt);Ve.push(pt),T.duration+=pt.duration;break}case"PRELOAD-HINT":{var Ye=new Je(O,f);f.preloadHint=Ye;break}case"RENDITION-REPORT":{var nr=new Je(O,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(nr);break}default:Se.warn("line parsed but not handled: "+A);break}}}S&&!S.relurl?(d.pop(),m-=S.duration,f.partList&&(f.fragmentHint=S)):f.partList&&(ua(T,S,h),T.cc=p,f.fragmentHint=T,I&&qs(T,I,f)),f.targetduration||(f.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));var ht=d.length,bt=d[0],Qe=d[ht-1];if(m+=f.skippedSegments*f.targetduration,m>0&&ht&&Qe){f.averagetargetduration=m/ht;var yt=Qe.sn;f.endSN=yt!=="initSegment"?yt:0,f.live||(Qe.endList=!0),bt&&f.startCC===void 0&&(f.startCC=bt.cc),k>0&&(_u(d,k),bt&&h.unshift(bt))}else f.endSN=0,f.startCC=0;return f.fragmentHint&&(m+=f.fragmentHint.duration),f.totalduration=m,h.length&&f.dateRangeTagCount&&bt&&Gs(h,f),f.endCC=p,f},s}();function Gs(s,o){var n=s.length;if(n)for(var r=s[n-1],e=o.live?1/0:o.totalduration,t=Object.keys(o.dateRanges),i=t.length;i--;){var a=o.dateRanges[t[i]],l=a.startDate.getTime();a.tagAnchor=r.ref;for(var u=n;u--;){var f=Ru(o,l,s,u,e);if(f!==-1){a.tagAnchor=o.fragments[f].ref;break}}}}function Ru(s,o,n,r,e){var t=n[r];if(t){var i=t.programDateTime;if(o>=i||r===0){var a,l=(((a=n[r+1])==null?void 0:a.start)||e)-t.start;if(o<=i+l*1e3){var u=n[r].sn-s.startSN,f=s.fragments;if(f.length>n.length)for(var d=n[r+1]||f[f.length-1],h=d.sn-s.startSN,c=h;c>u;c--){var v=f[c].programDateTime;if(o>=v&&o<v+f[c].duration*1e3)return c}return u}}}return-1}function Ks(s,o,n){var r,e,t=new Je(s,n),i=(r=t.METHOD)!=null?r:"",a=t.URI,l=t.hexadecimalInteger("IV"),u=t.KEYFORMATVERSIONS,f=(e=t.KEYFORMAT)!=null?e:"identity";a&&t.IV&&!l&&Se.error("Invalid IV: "+t.IV);var d=a?Ci.resolve(a,o):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Ns(i,d,f,h,l,t.KEYID)}function Hs(s){var o=new Je(s),n=o.decimalFloatingPoint("TIME-OFFSET");return H(n)?n:null}function Vs(s,o){var n=(s||"").split(/[ ,]+/).filter(function(r){return r});["video","audio","text"].forEach(function(r){var e=n.filter(function(t){return Li(t,r)});e.length&&(o[r+"Codec"]=e.map(function(t){return t.split("/")[0]}).join(","),n=n.filter(function(t){return e.indexOf(t)===-1}))}),o.unknownCodecs=n}function Ws(s,o,n){var r=o[n];r&&(s[n]=r)}function _u(s,o){for(var n=s[o],r=o;r--;){var e=s[r];if(!e)return;e.programDateTime=n.programDateTime-e.duration*1e3,n=e}}function ua(s,o,n){s.rawProgramDateTime?n.push(s):o!=null&&o.programDateTime&&(s.programDateTime=o.endProgramDateTime)}function Ys(s,o,n,r){s.relurl=o.URI,o.BYTERANGE&&s.setByteRange(o.BYTERANGE),s.level=n,s.sn="initSegment",r&&(s.levelkeys=r),s.initSegment=null}function qs(s,o,n){s.levelkeys=o;var r=n.encryptedFragments;(!r.length||r[r.length-1].levelkeys!==o)&&Object.keys(o).some(function(e){return o[e].isCommonEncryption})&&r.push(s)}function pr(s,o,n){s.playlistParsingError=new Error("#EXT-X-"+o+" must not appear more than once ("+n[0]+")")}function js(s,o,n){s.playlistParsingError=new Error("#EXT-X-"+o+" must appear before the first Media Segment ("+n[0]+")")}function fa(s,o){var n=o.startPTS;if(H(n)){var r=0,e;o.sn>s.sn?(r=n-s.start,e=s):(r=s.start-n,e=o),e.duration!==r&&e.setDuration(r)}else if(o.sn>s.sn){var t=s.cc===o.cc;t&&s.minEndPTS?o.setStart(s.start+(s.minEndPTS-s.start)):o.setStart(s.start+s.duration)}else o.setStart(Math.max(s.start-o.duration,0))}function Xs(s,o,n,r,e,t){var i=r-n;i<=0&&(Se.warn("Fragment should have a positive duration",o),r=n+o.duration,t=e+o.duration);var a=n,l=r,u=o.startPTS,f=o.endPTS;if(H(u)){var d=Math.abs(u-n);H(o.deltaPTS)?o.deltaPTS=Math.max(d,o.deltaPTS):o.deltaPTS=d,a=Math.max(n,u),n=Math.min(n,u),e=Math.min(e,o.startDTS),l=Math.min(r,f),r=Math.max(r,f),t=Math.max(t,o.endDTS)}var h=n-o.start;o.start!==0&&o.setStart(n),o.setDuration(r-o.start),o.startPTS=n,o.maxStartPTS=a,o.startDTS=e,o.endPTS=r,o.minEndPTS=l,o.endDTS=t;var c=o.sn;if(!s||c<s.startSN||c>s.endSN)return 0;var v,g=c-s.startSN,m=s.fragments;for(m[g]=o,v=g;v>0;v--)fa(m[v],m[v-1]);for(v=g;v<m.length-1;v++)fa(m[v],m[v+1]);return s.fragmentHint&&fa(m[m.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,h}function Du(s,o){if(s!==o){for(var n=null,r=s.fragments,e=r.length-1;e>=0;e--){var t=r[e].initSegment;if(t){n=t;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;var i;Pu(s,o,function(m,p,E,S){if((!o.startCC||o.skippedSegments)&&p.cc!==m.cc){for(var T=m.cc-p.cc,A=E;A<S.length;A++)S[A].cc+=T;o.endCC=S[S.length-1].cc}H(m.startPTS)&&H(m.endPTS)&&(p.setStart(p.startPTS=m.startPTS),p.startDTS=m.startDTS,p.maxStartPTS=m.maxStartPTS,p.endPTS=m.endPTS,p.endDTS=m.endDTS,p.minEndPTS=m.minEndPTS,p.setDuration(m.endPTS-m.startPTS),p.duration&&(i=p),o.PTSKnown=o.alignedSliding=!0),m.hasStreams&&(p.elementaryStreams=m.elementaryStreams),p.loader=m.loader,m.hasStats&&(p.stats=m.stats),m.initSegment&&(p.initSegment=m.initSegment,n=m.initSegment)});var a=o.fragments,l=o.fragmentHint?a.concat(o.fragmentHint):a;if(n&&l.forEach(function(m){var p;m&&(!m.initSegment||m.initSegment.relurl===((p=n)==null?void 0:p.relurl))&&(m.initSegment=n)}),o.skippedSegments){if(o.deltaUpdateFailed=a.some(function(m){return!m}),o.deltaUpdateFailed){Se.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=o.skippedSegments;u--;)a.shift();o.startSN=a[0].sn}else{o.canSkipDateRanges&&(o.dateRanges=ku(s.dateRanges,o));var f=s.fragments.filter(function(m){return m.rawProgramDateTime});if(s.hasProgramDateTime&&!o.hasProgramDateTime)for(var d=1;d<l.length;d++)l[d].programDateTime===null&&ua(l[d],l[d-1],f);Gs(f,o)}o.endCC=a[a.length-1].cc}if(!o.startCC){var h,c=Js(s,o.startSN-1);o.startCC=(h=c?.cc)!=null?h:a[0].cc}Cu(s.partList,o.partList,function(m,p){p.elementaryStreams=m.elementaryStreams,p.stats=m.stats}),i?Xs(o,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):Qs(s,o),a.length&&(o.totalduration=o.edge-a[0].start),o.driftStartTime=s.driftStartTime,o.driftStart=s.driftStart;var v=o.advancedDateTime;if(o.advanced&&v){var g=o.edge;o.driftStart||(o.driftStartTime=v,o.driftStart=g),o.driftEndTime=v,o.driftEnd=g}else o.driftEndTime=s.driftEndTime,o.driftEnd=s.driftEnd,o.advancedDateTime=s.advancedDateTime;o.requestScheduled===-1&&(o.requestScheduled=s.requestScheduled)}}function ku(s,o){var n=o.dateRanges,r=o.recentlyRemovedDateranges,e=re({},s);r&&r.forEach(function(a){delete e[a]});var t=Object.keys(e),i=t.length;return i&&Object.keys(n).forEach(function(a){var l=e[a],u=new ws(n[a].attr,l);u.isValid?(e[a]=u,l||(u.tagOrder+=i)):Se.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+Ke(n[a].attr)+'"')}),e}function Cu(s,o,n){if(s&&o)for(var r=0,e=0,t=s.length;e<=t;e++){var i=s[e],a=o[e+r];i&&a&&i.index===a.index&&i.fragment.sn===a.fragment.sn?n(i,a):r--}}function Pu(s,o,n){for(var r=o.skippedSegments,e=Math.max(s.startSN,o.startSN)-o.startSN,t=(s.fragmentHint?1:0)+(r?o.endSN:Math.min(s.endSN,o.endSN))-o.startSN,i=o.startSN-s.startSN,a=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,l=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,u=e;u<=t;u++){var f=l[i+u],d=a[u];if(r&&!d&&f&&(d=o.fragments[u]=f),f&&d){if(n(f,d,u,a),f.url&&f.url!==d.url){o.playlistParsingError=zs("media sequence mismatch "+d.sn+":",s,o,f,d);return}else if(f.cc!==d.cc){o.playlistParsingError=zs("discontinuity sequence mismatch ("+f.cc+"!="+d.cc+")",s,o,f,d);return}}}}function zs(s,o,n,r,e){return new Error(s+" "+e.url+`
Playlist starting @`+o.startSN+`
`+o.m3u8+`

Playlist starting @`+n.startSN+`
`+n.m3u8)}function Qs(s,o,n){n===void 0&&(n=!0);var r=o.startSN+o.skippedSegments-s.startSN,e=s.fragments,t=r>=0,i=0;if(t&&r<e.length)i=e[r].start;else if(t&&o.startSN===s.endSN+1)i=s.fragmentEnd;else if(t&&n)i=s.fragmentStart+r*o.levelTargetDuration;else if(!o.skippedSegments&&o.fragmentStart===0)i=s.fragmentStart;else return;da(o,i)}function da(s,o){if(o){for(var n=s.fragments,r=s.skippedSegments;r<n.length;r++)n[r].addStart(o);s.fragmentHint&&s.fragmentHint.addStart(o)}}function $s(s,o){o===void 0&&(o=1/0);var n=1e3*s.targetduration;if(s.updated){var r=s.fragments,e=4;if(r.length&&n*e>o){var t=r[r.length-1].duration*1e3;t<n&&(n=t)}}else n/=2;return Math.round(n)}function Js(s,o,n){if(!s)return null;var r=s.fragments[o-s.startSN];return r||(r=s.fragmentHint,r&&r.sn===o)?r:o<s.startSN&&n&&n.sn===o?n:null}function Zs(s,o,n){return s?eo(s.partList,o,n):null}function eo(s,o,n){if(s)for(var r=s.length;r--;){var e=s[r];if(e.index===n&&e.fragment.sn===o)return e}return null}function to(s){s.forEach(function(o,n){var r;(r=o.details)==null||r.fragments.forEach(function(e){e.level=n,e.initSegment&&(e.initSegment.level=n)})})}function Pi(s,o){for(var n=0,r=s.length;n<r;n++){var e;if(((e=s[n])==null?void 0:e.cc)===o)return s[n]}return null}function wu(s,o){return!!(s&&o.startCC<s.endCC&&o.endCC>s.startCC)}function ro(s,o){if(s){var n=s.start+o;s.start=s.startPTS=n,s.endPTS=n+s.duration}}function io(s,o){for(var n=o.fragments,r=0,e=n.length;r<e;r++)ro(n[r],s);o.fragmentHint&&ro(o.fragmentHint,s),o.alignedSliding=!0}function Mu(s,o){s&&(no(o,s),!o.alignedSliding&&s&&vn(o,s),!o.alignedSliding&&s&&!o.skippedSegments&&Qs(s,o,!1))}function no(s,o){if(wu(o,s)){var n=Math.min(o.endCC,s.endCC),r=Pi(o.fragments,n),e=Pi(s.fragments,n);if(!(!r||!e)){Se.log("Aligning playlist at start of dicontinuity sequence "+n);var t=r.start-e.start;io(t,s)}}}function vn(s,o){if(!(!s.hasProgramDateTime||!o.hasProgramDateTime)){var n=s.fragments,r=o.fragments;if(!(!n.length||!r.length)){var e,t,i=Math.min(o.endCC,s.endCC);o.startCC<i&&s.startCC<i&&(e=Pi(r,i),t=Pi(n,i)),(!e||!t)&&(e=r[Math.floor(r.length/2)],t=Pi(n,e.cc)||n[Math.floor(n.length/2)]);var a=e.programDateTime,l=t.programDateTime;if(!(!a||!l)){var u=(l-a)/1e3-(t.start-e.start);io(u,s)}}}}var Ou={toString:function(o){for(var n="",r=o.length,e=0;e<r;e++)n+="["+o.start(e).toFixed(3)+"-"+o.end(e).toFixed(3)+"]";return n}},M={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},ha=function(s){function o(r,e,t,i,a){var l;return l=s.call(this,i,r.logger)||this,l.hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=M.STOPPED,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.buffering=!0,l.loadingParts=!1,l.loopSn=void 0,l.onMediaSeeking=function(){var u=l,f=u.config,d=u.fragCurrent,h=u.media,c=u.mediaBuffer,v=u.state,g=h?h.currentTime:0,m=Ae.bufferInfo(c||h,g,f.maxBufferHole),p=!m.len;if(l.log("Media seeking to "+(H(g)?g.toFixed(3):g)+", state: "+v+", "+(p?"out of":"in")+" buffer"),l.state===M.ENDED)l.resetLoadingState();else if(d){var E=f.maxFragLookUpTolerance,S=d.start-E,T=d.start+d.duration+E;if(p||T<m.start||S>m.end){var A=g>T;(g<S||A)&&(A&&d.loader&&(l.log("Cancelling fragment load for seek (sn: "+d.sn+")"),d.abortRequests(),l.resetLoadingState()),l.fragPrevious=null)}}if(h){l.fragmentTracker.removeFragmentsInRange(g,1/0,l.playlistType,!0);var x=l.lastCurrentTime;if(g>x&&(l.lastCurrentTime=g),!l.loadingParts){var I=Math.max(m.end,g),k=l.shouldLoadParts(l.getLevelDetails(),I);k&&(l.log("LL-Part loading ON after seeking to "+g.toFixed(2)+" with buffer @"+I.toFixed(2)),l.loadingParts=k)}}l.hls.hasEnoughToStart||(l.log("Setting "+(p?"startPosition":"nextLoadPosition")+" to "+g+" for seek without enough to start"),l.nextLoadPosition=g,p&&(l.startPosition=g)),l.tickImmediate()},l.onMediaEnded=function(){l.log("setting startPosition to 0 because media ended"),l.startPosition=l.lastCurrentTime=0},l.playlistType=a,l.hls=r,l.fragmentLoader=new lu(r.config),l.keyLoader=t,l.fragmentTracker=e,l.config=r.config,l.decrypter=new ra(r.config),l}ae(o,s);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.ERROR,this.onError,this)},n.doTick=function(){this.onTickEnd()},n.onTickEnd=function(){},n.startLoad=function(e){},n.stopLoad=function(){if(this.state!==M.STOPPED){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=M.STOPPED}},n.pauseBuffering=function(){this.buffering=!1},n.resumeBuffering=function(){this.buffering=!0},n._streamEnded=function(e,t){if(t.live||!this.media)return!1;var i=e.end||0,a=this.config.timelineOffset||0;if(i<=a)return!1;var l=e.buffered;this.config.maxBufferHole&&l&&l.length>1&&(e=Ae.bufferedInfo(l,e.start,0));var u=e.nextStart,f=u&&u>a&&u<t.edge;if(f||this.media.currentTime<e.start)return!1;var d=t.partList;if(d!=null&&d.length){var h=d[d.length-1],c=Ae.isBuffered(this.media,h.start+h.duration/2);return c}var v=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(v)},n.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}},n.onMediaAttached=function(e,t){var i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);var a=this.config;this.levels&&a.autoStartLoad&&this.state===M.STOPPED&&this.startLoad(a.startPosition)},n.onMediaDetaching=function(e,t){var i=!!t.transferMedia,a=this.media;if(a!==null){if(a.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a.removeEventListener("seeking",this.onMediaSeeking),a.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},n.onManifestLoading=function(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1},n.onError=function(e,t){},n.onManifestLoaded=function(e,t){this.startTimeOffset=t.startTimeOffset},n.onHandlerDestroying=function(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),s.prototype.onHandlerDestroying.call(this),this.hls=this.onMediaSeeking=this.onMediaEnded=null},n.onHandlerDestroyed=function(){this.state=M.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},n.loadFragment=function(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)},n._loadFragForPlayback=function(e,t,i){var a=this,l=function(f){var d=f.frag;if(a.fragContextChanged(d)){a.warn(d.type+" sn: "+d.sn+(f.part?" part: "+f.part.index:"")+" of "+a.fragInfo(d,!1,f.part)+") was dropped during download."),a.fragmentTracker.removeFragment(d);return}d.stats.chunkCount++,a._handleFragmentLoadProgress(f)};this._doFragLoad(e,t,i,l).then(function(u){if(u){var f=a.state,d=u.frag;if(a.fragContextChanged(d)){(f===M.FRAG_LOADING||!a.fragCurrent&&f===M.PARSING)&&(a.fragmentTracker.removeFragment(d),a.state=M.IDLE);return}"payload"in u&&(a.log("Loaded "+d.type+" sn: "+d.sn+" of "+a.playlistLabel()+" "+d.level),a.hls.trigger(y.FRAG_LOADED,u)),a._handleFragmentLoadComplete(u)}}).catch(function(u){a.state===M.STOPPED||a.state===M.ERROR||(a.warn("Frag error: "+(u?.message||u)),a.resetFragmentLoading(e))})},n.clearTrackerIfNeeded=function(e){var t,i=this.fragmentTracker,a=i.getState(e);if(a===ot.APPENDING){var l=e.type,u=this.getFwdBufferInfo(this.mediaBuffer,l),f=Math.max(e.duration,u?u.len:this.config.maxBufferLength),d=this.backtrackFragment,h=d?e.sn-d.sn:0;(h===1||this.reduceMaxBufferLength(f,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===ot.PARTIAL&&i.removeFragment(e))},n.checkLiveUpdate=function(e){if(e.updated&&!e.live){var t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)},n.waitForLive=function(e){var t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)},n.flushMainBuffer=function(e,t,i){if(i===void 0&&(i=null),!!(e-t)){var a={startOffset:e,endOffset:t,type:i};this.hls.trigger(y.BUFFER_FLUSHING,a)}},n._loadInitSegment=function(e,t){var i=this;this._doFragLoad(e,t).then(function(a){var l=a?.frag;if(!l||i.fragContextChanged(l)||!i.levels)throw new Error("init load aborted");return a}).then(function(a){var l=i.hls,u=a.frag,f=a.payload,d=u.decryptdata;if(f&&f.byteLength>0&&d!=null&&d.key&&d.iv&&oi(d.method)){var h=self.performance.now();return i.decrypter.decrypt(new Uint8Array(f),d.key.buffer,d.iv.buffer,aa(d.method)).catch(function(c){throw l.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:u}),c}).then(function(c){var v=self.performance.now();return l.trigger(y.FRAG_DECRYPTED,{frag:u,payload:c,stats:{tstart:h,tdecrypt:v}}),a.payload=c,i.completeInitSegmentLoad(a)})}return i.completeInitSegmentLoad(a)}).catch(function(a){i.state===M.STOPPED||i.state===M.ERROR||(i.warn(a),i.resetFragmentLoading(e))})},n.completeInitSegmentLoad=function(e){var t=this.levels;if(!t)throw new Error("init load aborted, missing levels");var i=e.frag.stats;this.state!==M.STOPPED&&(this.state=M.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()},n.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.sn!==t.sn||e.level!==t.level},n.fragBufferedComplete=function(e,t){var i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+this.fragInfo(e,!1,t)+" > buffer:"+(i?Ou.toString(Ae.getBuffered(i)):"(detached)")+")"),Ue(e)){var a;if(e.type!==F.SUBTITLE){var l=e.elementaryStreams;if(!Object.keys(l).some(function(f){return!!l[f]})){this.state=M.IDLE;return}}var u=(a=this.levels)==null?void 0:a[e.level];u!=null&&u.fragmentError&&(this.log("Resetting level fragment error count of "+u.fragmentError+" on frag buffered"),u.fragmentError=0)}this.state=M.IDLE},n._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var i=e.frag,a=e.part,l=e.partsLoaded,u=!l||l.length===0||l.some(function(d){return!d}),f=new ia(i.level,i.sn,i.stats.chunkCount+1,0,a?a.index:-1,!u);t.flush(f)}},n._handleFragmentLoadProgress=function(e){},n._doFragLoad=function(e,t,i,a){var l,u=this;i===void 0&&(i=null),this.fragCurrent=e;var f=t?.details;if(!this.levels||!f)throw new Error("frag load aborted, missing level"+(f?"":" detail")+"s");var d=null;e.encrypted&&!((l=e.decryptdata)!=null&&l.key)?(this.log("Loading key for "+e.sn+" of ["+f.startSN+"-"+f.endSN+"], "+this.playlistLabel()+" "+e.level),this.state=M.KEY_LOADING,this.fragCurrent=e,d=this.keyLoader.load(e).then(function(T){if(!u.fragContextChanged(T.frag))return u.hls.trigger(y.KEY_LOADED,T),u.state===M.KEY_LOADING&&(u.state=M.IDLE),T}),this.hls.trigger(y.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(d=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(d=this.keyLoader.loadClear(e,f.encryptedFragments,this.startFragRequested),d&&this.log("[eme] blocking frag load until media-keys acquired"));var h=this.fragPrevious;if(Ue(e)&&(!h||e.sn!==h.sn)){var c=this.shouldLoadParts(t.details,e.end);c!==this.loadingParts&&(this.log("LL-Part loading "+(c?"ON":"OFF")+" loading sn "+h?.sn+"->"+e.sn),this.loadingParts=c)}if(i=Math.max(e.start,i||0),this.loadingParts&&Ue(e)){var v=f.partList;if(v&&a){i>e.end&&f.fragmentHint&&(e=f.fragmentHint);var g=this.getNextPart(v,e,i);if(g>-1){var m=v[g];e=this.fragCurrent=m.fragment,this.log("Loading "+e.type+" sn: "+e.sn+" part: "+m.index+" ("+g+"/"+(v.length-1)+") of "+this.fragInfo(e,!1,m)+") cc: "+e.cc+" ["+f.startSN+"-"+f.endSN+"], target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=m.start+m.duration,this.state=M.FRAG_LOADING;var p;return d?p=d.then(function(T){return!T||u.fragContextChanged(T.frag)?null:u.doFragPartsLoad(e,m,t,a)}).catch(function(T){return u.handleFragLoadError(T)}):p=this.doFragPartsLoad(e,m,t,a).catch(function(T){return u.handleFragLoadError(T)}),this.hls.trigger(y.FRAG_LOADING,{frag:e,part:m,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(v,i))return Promise.resolve(null)}}if(Ue(e)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @"+i.toFixed(2)),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log("Loading "+e.type+" sn: "+e.sn+" of "+this.fragInfo(e,!1)+") cc: "+e.cc+" "+(f?"["+f.startSN+"-"+f.endSN+"]":"")+", target: "+parseFloat(i.toFixed(3))),H(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=M.FRAG_LOADING;var E=this.config.progressive,S;return E&&d?S=d.then(function(T){return!T||u.fragContextChanged(T?.frag)?null:u.fragmentLoader.load(e,a)}).catch(function(T){return u.handleFragLoadError(T)}):S=Promise.all([this.fragmentLoader.load(e,E?a:void 0),d]).then(function(T){var A=T[0];return!E&&A&&a&&a(A),A}).catch(function(T){return u.handleFragLoadError(T)}),this.hls.trigger(y.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):S},n.doFragPartsLoad=function(e,t,i,a){var l=this;return new Promise(function(u,f){var d,h=[],c=(d=i.details)==null?void 0:d.partList,v=function(m){l.fragmentLoader.loadPart(e,m,a).then(function(p){h[m.index]=p;var E=p.part;l.hls.trigger(y.FRAG_LOADED,p);var S=Zs(i.details,e.sn,m.index+1)||eo(c,e.sn,m.index+1);if(S)v(S);else return u({frag:e,part:E,partsLoaded:h})}).catch(f)};v(t)})},n.handleFragLoadError=function(e){if("data"in e){var t=e.data;e.data&&t.details===_.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(y.ERROR,t)}else this.hls.trigger(y.ERROR,{type:Y.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},n._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(!t||this.state!==M.PARSING){!this.fragCurrent&&this.state!==M.STOPPED&&this.state!==M.ERROR&&(this.state=M.IDLE);return}var i=t.frag,a=t.part,l=t.level,u=self.performance.now();i.stats.parsing.end=u,a&&(a.stats.parsing.end=u);var f=this.getLevelDetails(),d=f&&i.sn>f.endSN,h=d||this.shouldLoadParts(f,i.end);h!==this.loadingParts&&(this.log("LL-Part loading "+(h?"ON":"OFF")+" after parsing segment ending @"+i.end.toFixed(2)),this.loadingParts=h),this.updateLevelTiming(i,a,l,e.partial)},n.shouldLoadParts=function(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var i,a=e.partList[0],l=a.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=l){var u,f=this.hls.hasEnoughToStart?((u=this.media)==null?void 0:u.currentTime)||this.lastCurrentTime:this.getLoadPosition();if(f>a.start-a.fragment.duration)return!0}}}return!1},n.getCurrentContext=function(e){var t=this.levels,i=this.fragCurrent,a=e.level,l=e.sn,u=e.part;if(!(t!=null&&t[a]))return this.warn("Levels object was unset while buffering fragment "+l+" of "+this.playlistLabel()+" "+a+". The current chunk will not be buffered."),null;var f=t[a],d=f.details,h=u>-1?Zs(d,l,u):null,c=h?h.fragment:Js(d,l,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:h,level:f}):null},n.bufferFragmentData=function(e,t,i,a,l){var u;if(!(!e||this.state!==M.PARSING)){var f=e.data1,d=e.data2,h=f;if(f&&d&&(h=Ut(f,d)),!!((u=h)!=null&&u.length)){var c=this.initPTS[t.cc],v=c?-c.baseTime/c.timescale:void 0,g={type:e.type,frag:t,part:i,chunkMeta:a,offset:v,parent:t.type,data:h};if(this.hls.trigger(y.BUFFER_APPENDING,g),e.dropped&&e.independent&&!i){if(l)return;this.flushBufferGap(t)}}}},n.flushBufferGap=function(e){var t=this.media;if(t){if(!Ae.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}var i=t.currentTime,a=Ae.bufferInfo(t,i,0),l=e.duration,u=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),f=Math.max(Math.min(e.start-u,a.end-u),i+u);e.start-f>u&&this.flushMainBuffer(f,e.start)}},n.getFwdBufferInfo=function(e,t){var i,a=this.getLoadPosition();if(!H(a))return null;var l=this.lastCurrentTime>a,u=l||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,a,t,u)},n.getFwdBufferInfoAtPos=function(e,t,i,a){var l=Ae.bufferInfo(e,t,a);if(l.len===0&&l.nextStart!==void 0){var u=this.fragmentTracker.getBufferedFrag(t,i);if(u&&(l.nextStart<=u.end||u.gap)){var f=Math.max(Math.min(l.nextStart,u.end)-t,a);return Ae.bufferInfo(e,t,f)}}return l},n.getMaxBufferLength=function(e){var t=this.config,i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)},n.reduceMaxBufferLength=function(e,t){var i=this.config,a=Math.max(Math.min(e-t,i.maxBufferLength),t),l=Math.max(e-t*3,i.maxMaxBufferLength/2,a);return l>=a?(i.maxMaxBufferLength=l,this.warn("Reduce max buffer length to "+l+"s"),!0):!1},n.getAppendedFrag=function(e,t){var i;t===void 0&&(t=F.MAIN);var a=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(e,t);return a&&"fragment"in a?a.fragment:a},n.getNextFragment=function(e,t){var i=t.fragments,a=i.length;if(!a)return null;var l=this.config,u=i[0].start,f=l.lowLatencyMode&&!!t.partList,d=null;if(t.live){var h=l.initialLiveManifestSize;if(a<h)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+h+")"),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<u){var c;f&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t);var v=this.hls.startPosition,g=this.hls.liveSyncPosition,m=d?(v!==-1&&v>=u?v:g)||d.start:e;this.log("Setting startPosition to "+m+" to match start frag at live edge. mainStart: "+v+" liveSyncPosition: "+g+" frag.start: "+((c=d)==null?void 0:c.start)),this.startPosition=this.nextLoadPosition=m}}else e<=u&&(d=i[0]);if(!d){var p=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,p,t)}var E=this.filterReplacedPrimary(d,t);if(!E&&d){var S=d.sn-t.startSN;E=this.filterReplacedPrimary(i[S+1]||null,t)}return this.mapToInitFragWhenRequired(E)},n.isLoopLoading=function(e,t){var i=this.fragmentTracker.getState(e);return(i===ot.OK||i===ot.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t},n.getNextFragmentLoopLoading=function(e,t,i,a,l){var u=null;if(e.gap&&(u=this.getNextFragment(this.nextLoadPosition,t),u&&!u.gap&&i.nextStart)){var f=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,a,0);if(f!==null&&i.len+f.len>=l){var d=u.sn;return this.loopSn!==d&&(this.log('buffer full after gaps in "'+a+'" playlist starting at sn: '+d),this.loopSn=d),null}}return this.loopSn=void 0,u},n.filterReplacedPrimary=function(e,t){if(!e)return e;if(ao(this.hls.config)&&e.type!==F.SUBTITLE){var i=this.hls.interstitialsManager,a=i?.bufferingItem;if(a){var l=a.event;if(l){if(l.appendInPlace||Math.abs(e.start-a.start)>1||a.start===0)return null}else if(e.end<=a.start&&t?.live===!1||e.start>a.end&&a.nextEvent&&(a.nextEvent.appendInPlace||e.start-a.end>1))return null}var u=i?.playerQueue;if(u)for(var f=u.length;f--;){var d=u[f].interstitial;if(d.appendInPlace&&e.start>=d.startTime&&e.end<=d.resumeTime)return null}}return e},n.mapToInitFragWhenRequired=function(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e},n.getNextPart=function(e,t,i){for(var a=-1,l=!1,u=!0,f=0,d=e.length;f<d;f++){var h=e[f];if(u=u&&!h.independent,a>-1&&i<h.start)break;var c=h.loaded;c?a=-1:(l||h.independent||u)&&h.fragment===t&&(a=f),l=c}return a},n.loadedEndOfParts=function(e,t){var i=e[e.length-1];return i&&t>i.start&&i.loaded},n.getInitialLiveFragment=function(e){var t=e.fragments,i=this.fragPrevious,a=null;if(i){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),a=Ql(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){var l=i.sn+1;if(l>=e.startSN&&l<=e.endSN){var u=t[l-e.startSN];i.cc===u.cc&&(a=u,this.log("Live playlist, switching playlist, load frag with next SN: "+a.sn))}a||(a=Ts(e,i.cc,i.end),a&&this.log("Live playlist, switching playlist, load frag with same CC: "+a.sn))}}else{var f=this.hls.liveSyncPosition;f!==null&&(a=this.getFragmentAtPosition(f,this.bitrateTest?e.fragmentEnd:e.edge,e))}return a},n.getFragmentAtPosition=function(e,t,i){var a=this.config,l=this.fragPrevious,u=i.fragments,f=i.endSN,d=i.fragmentHint,h=a.maxFragLookUpTolerance,c=i.partList,v=!!(this.loadingParts&&c!=null&&c.length&&d);v&&d&&!this.bitrateTest&&c[c.length-1].fragment.sn===d.sn&&(u=u.concat(d),f=d.sn);var g;if(e<t){var m,p=e<this.lastCurrentTime,E=p||e>t-h||(m=this.media)!=null&&m.paused||!this.startFragRequested?0:h;g=Vr(l,u,e,E)}else g=u[u.length-1];if(g){var S=g.sn-i.startSN,T=this.fragmentTracker.getState(g);if((T===ot.OK||T===ot.PARTIAL&&g.gap)&&(l=g),l&&g.sn===l.sn&&(!v||c[0].fragment.sn>g.sn||!i.live&&!v)){var A=l&&g.level===l.level;if(A){var x=u[S+1];g.sn<f&&this.fragmentTracker.getState(x)!==ot.OK?g=x:g=null}}}return g},n.alignPlaylists=function(e,t,i){var a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;var l=e.fragmentStart,u=!t,f=e.alignedSliding&&H(l);if(u||!f&&!l){Mu(i,e);var d=e.fragmentStart;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" fragments: "+a),d}return l},n.waitForCdnTuneIn=function(e){var t=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*t)},n.setStartPosition=function(e,t){var i=this.startPosition;i<t&&(i=-1);var a=this.timelineOffset;if(i===-1){var l=this.startTimeOffset!==null,u=l?this.startTimeOffset:e.startTimeOffset;u!==null&&H(u)?(i=t+u,u<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log("Setting startPosition to "+i+" for start time offset "+u+" found in "+(l?"multivariant":"media")+" playlist"),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log("Setting startPosition to -1 to start at live edge "+i),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+a}this.nextLoadPosition=i+a},n.getLoadPosition=function(){var e,t=this.media,i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i},n.handleFragLoadAborted=function(e,t){this.transmuxer&&e.type===this.playlistType&&Ue(e)&&e.stats.aborted&&(this.log("Fragment "+e.sn+(t?" part "+t.index:"")+" of "+this.playlistLabel()+" "+e.level+" was aborted"),this.resetFragmentLoading(e))},n.resetFragmentLoading=function(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==M.FRAG_LOADING_WAITING_RETRY)&&(this.state=M.IDLE)},n.onFragmentOrKeyLoadError=function(e,t){if(t.chunkMeta&&!t.frag){var i=this.getCurrentContext(t.chunkMeta);i&&(t.frag=i.frag)}var a=t.frag;if(!(!a||a.type!==e||!this.levels)){if(this.fragContextChanged(a)){var l;this.warn("Frag load error must match current frag to retry "+a.url+" > "+((l=this.fragCurrent)==null?void 0:l.url));return}var u=t.details===_.FRAG_GAP;u&&this.fragmentTracker.fragBuffered(a,!0);var f=t.errorAction,d=f||{},h=d.action,c=d.flags,v=d.retryCount,g=v===void 0?0:v,m=d.retryConfig,p=!!f&&!!m,E=p&&h===xt.RetryRequest,S=p&&!f.resolved&&c===tr.MoveAllAlternatesMatchingHost;if(!E&&S&&Ue(a)&&!a.endList)this.resetFragmentErrors(e),this.treatAsGap(a),f.resolved=!0;else if((E||S)&&g<m.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);var T=ta(m,g);this.warn("Fragment "+a.sn+" of "+e+" "+a.level+" errored with "+t.details+", retrying loading "+(g+1)+"/"+m.maxNumRetry+" in "+T+"ms"),f.resolved=!0,this.retryDate=self.performance.now()+T,this.state=M.FRAG_LOADING_WAITING_RETRY}else if(m&&f)if(this.resetFragmentErrors(e),g<m.maxNumRetry)!u&&h!==xt.RemoveAlternatePermanently&&(f.resolved=!0);else{this.warn(t.details+" reached or exceeded max retry ("+g+")");return}else h===xt.SendAlternateToPenaltyBox?this.state=M.WAITING_LEVEL:this.state=M.ERROR;this.tickImmediate()}},n.reduceLengthAndFlushBuffer=function(e){if(this.state===M.PARSING||this.state===M.PARSED){var t=e.frag,i=e.parent,a=this.getFwdBufferInfo(this.mediaBuffer,i),l=a&&a.len>.5;l&&this.reduceMaxBufferLength(a.len,t?.duration||10);var u=!l;return u&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+i+" buffer"),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),u}return!1},n.resetFragmentErrors=function(e){e===F.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==M.STOPPED&&(this.state=M.IDLE)},n.afterBufferFlushed=function(e,t,i){if(e){var a=Ae.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,a,i),this.state===M.ENDED&&this.resetLoadingState()}},n.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==M.STOPPED&&(this.state=M.IDLE)},n.resetStartWhenNotLoaded=function(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;var t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},n.resetWhenMissingContext=function(e){this.warn("The loading context changed while buffering fragment "+e.sn+" of "+this.playlistLabel()+" "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},n.removeUnbufferedFrags=function(e){e===void 0&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},n.updateLevelTiming=function(e,t,i,a){var l=this,u=i.details;if(!u){this.warn("level.details undefined");return}var f=Object.keys(e.elementaryStreams).reduce(function(c,v){var g=e.elementaryStreams[v];if(g){var m=g.endPTS-g.startPTS;if(m<=0)return l.warn("Could not parse fragment "+e.sn+" "+v+" duration reliably ("+m+")"),c||!1;var p=a?0:Xs(u,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS);return l.hls.trigger(y.LEVEL_PTS_UPDATED,{details:u,level:i,drift:p,type:v,frag:e,start:g.startPTS,end:g.endPTS}),!0}return c},!1);if(!f){var d;if(i.fragmentError===0&&this.treatAsGap(e,i),((d=this.transmuxer)==null?void 0:d.error)===null){var h=new Error("Found no media in fragment "+e.sn+" of "+this.playlistLabel()+" "+e.level+" resetting transmuxer to fallback to playlist timing");if(this.warn(h.message),this.hls.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:e,reason:"Found no media in msn "+e.sn+" of "+this.playlistLabel()+' "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}}this.state=M.PARSED,this.log("Parsed "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+this.fragInfo(e,!1,t)+")"),this.hls.trigger(y.FRAG_PARSED,{frag:e,part:t})},n.playlistLabel=function(){return this.playlistType===F.MAIN?"level":"track"},n.fragInfo=function(e,t,i){var a,l;return t===void 0&&(t=!0),this.playlistLabel()+" "+e.level+" ("+(i?"part":"frag")+":["+((a=t&&!i?e.startPTS:(i||e).start)!=null?a:NaN).toFixed(3)+"-"+((l=t&&!i?e.endPTS:(i||e).end)!=null?l:NaN).toFixed(3)+"]"+(i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):"")},n.treatAsGap=function(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)},n.resetTransmuxer=function(){var e;(e=this.transmuxer)==null||e.reset()},n.recoverWorkerError=function(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},W(o,[{key:"startPositionValue",get:function(){var e=this.nextLoadPosition,t=this.startPosition;return t===-1&&e?e:t}},{key:"bufferingEnabled",get:function(){return this.buffering}},{key:"inFlightFrag",get:function(){return{frag:this.fragCurrent,state:this.state}}},{key:"timelineOffset",get:function(){var e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}},{key:"primaryPrefetch",get:function(){if(ao(this.hls.config)){var e,t,i=(e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event;if(i)return!0}return!1}},{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}])}(Rs);function ao(s){return!!s.interstitialsController&&s.enableInterstitialPlayback!==!1}var so=function(){function s(){this.chunks=[],this.dataLength=0}var o=s.prototype;return o.push=function(r){this.chunks.push(r),this.dataLength+=r.length},o.flush=function(){var r=this.chunks,e=this.dataLength,t;if(r.length)r.length===1?t=r[0]:t=Fu(r,e);else return new Uint8Array(0);return this.reset(),t},o.reset=function(){this.chunks.length=0,this.dataLength=0},s}();function Fu(s,o){for(var n=new Uint8Array(o),r=0,e=0;e<s.length;e++){var t=s[e];n.set(t,r),r+=t.length}return n}function oo(s,o){return o+10<=s.length&&s[o]===51&&s[o+1]===68&&s[o+2]===73&&s[o+3]<255&&s[o+4]<255&&s[o+6]<128&&s[o+7]<128&&s[o+8]<128&&s[o+9]<128}function ca(s,o){return o+10<=s.length&&s[o]===73&&s[o+1]===68&&s[o+2]===51&&s[o+3]<255&&s[o+4]<255&&s[o+6]<128&&s[o+7]<128&&s[o+8]<128&&s[o+9]<128}function gn(s,o){var n=0;return n=(s[o]&127)<<21,n|=(s[o+1]&127)<<14,n|=(s[o+2]&127)<<7,n|=s[o+3]&127,n}function wi(s,o){for(var n=o,r=0;ca(s,o);){r+=10;var e=gn(s,o+6);r+=e,oo(s,o+10)&&(r+=10),o+=r}if(r>0)return s.subarray(n,n+r)}function Nu(s,o,n,r){var e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],t=o[n+2],i=t>>2&15;if(i>12){var a=new Error("invalid ADTS sampling index:"+i);s.emit(y.ERROR,y.ERROR,{type:Y.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!0,error:a,reason:a.message});return}var l=(t>>6&3)+1,u=o[n+3]>>6&3|(t&1)<<2,f="mp4a.40."+l,d=e[i],h=i;(l===5||l===29)&&(h-=3);var c=[l<<3|(h&14)>>1,(h&1)<<7|u<<3];return Se.log("manifest codec:"+r+", parsed codec:"+f+", channels:"+u+", rate:"+d+" (ADTS object type:"+l+" sampling index:"+i+")"),{config:c,samplerate:d,channelCount:u,codec:f,parsedCodec:f,manifestCodec:r}}function lo(s,o){return s[o]===255&&(s[o+1]&246)===240}function uo(s,o){return s[o+1]&1?7:9}function va(s,o){return(s[o+3]&3)<<11|s[o+4]<<3|(s[o+5]&224)>>>5}function Uu(s,o){return o+5<s.length}function mn(s,o){return o+1<s.length&&lo(s,o)}function Bu(s,o){return Uu(s,o)&&lo(s,o)&&va(s,o)<=s.length-o}function Gu(s,o){if(mn(s,o)){var n=uo(s,o);if(o+n>=s.length)return!1;var r=va(s,o);if(r<=n)return!1;var e=o+r;return e===s.length||mn(s,e)}return!1}function fo(s,o,n,r,e){if(!s.samplerate){var t=Nu(o,n,r,e);if(!t)return;re(s,t)}}function ho(s){return 1024*9e4/s}function Ku(s,o){var n=uo(s,o);if(o+n<=s.length){var r=va(s,o)-n;if(r>0)return{headerLength:n,frameLength:r}}}function co(s,o,n,r,e){var t=ho(s.samplerate),i=r+e*t,a=Ku(o,n),l;if(a){var u=a.frameLength,f=a.headerLength,d=f+u,h=Math.max(0,n+d-o.length);h?(l=new Uint8Array(d-f),l.set(o.subarray(n+f,o.length),0)):l=o.subarray(n+f,n+d);var c={unit:l,pts:i};return h||s.samples.push(c),{sample:c,length:d,missing:h}}var v=o.length-n;l=new Uint8Array(v),l.set(o.subarray(n,o.length),0);var g={unit:l,pts:i};return{sample:g,length:v,missing:-1}}function Hu(s,o){return ca(s,o)&&gn(s,o+6)+10<=s.length-o}function Vu(s){return s instanceof ArrayBuffer?s:s.byteOffset==0&&s.byteLength==s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer}function ga(s,o,n){return o===void 0&&(o=0),n===void 0&&(n=1/0),Wu(s,o,n,Uint8Array)}function Wu(s,o,n,r){var e=Yu(s),t=1;"BYTES_PER_ELEMENT"in r&&(t=r.BYTES_PER_ELEMENT);var i=qu(s)?s.byteOffset:0,a=(i+s.byteLength)/t,l=(i+o)/t,u=Math.floor(Math.max(0,Math.min(l,a))),f=Math.floor(Math.min(u+Math.max(n,0),a));return new r(e,u,f-u)}function Yu(s){return s instanceof ArrayBuffer?s:s.buffer}function qu(s){return s&&s.buffer instanceof ArrayBuffer&&s.byteLength!==void 0&&s.byteOffset!==void 0}function ju(s){var o={key:s.type,description:"",data:"",mimeType:null,pictureType:null},n=3;if(!(s.size<2)){if(s.data[0]!==n){console.log("Ignore frame with unrecognized character encoding");return}var r=s.data.subarray(1).indexOf(0);if(r!==-1){var e=we(ga(s.data,1,r)),t=s.data[2+r],i=s.data.subarray(3+r).indexOf(0);if(i!==-1){var a=we(ga(s.data,3+r,i)),l;return e==="-->"?l=we(ga(s.data,4+r+i)):l=Vu(s.data.subarray(4+r+i)),o.mimeType=e,o.pictureType=t,o.description=a,o.data=l,o}}}}function Xu(s){if(!(s.size<2)){var o=we(s.data,!0),n=new Uint8Array(s.data.subarray(o.length+1));return{key:s.type,info:o,data:n.buffer}}}function zu(s){if(!(s.size<2)){if(s.type==="TXXX"){var o=1,n=we(s.data.subarray(o),!0);o+=n.length+1;var r=we(s.data.subarray(o));return{key:s.type,info:n,data:r}}var e=we(s.data.subarray(1));return{key:s.type,info:"",data:e}}}function Qu(s){if(s.type==="WXXX"){if(s.size<2)return;var o=1,n=we(s.data.subarray(o),!0);o+=n.length+1;var r=we(s.data.subarray(o));return{key:s.type,info:n,data:r}}var e=we(s.data);return{key:s.type,info:"",data:e}}function $u(s){return s.type==="PRIV"?Xu(s):s.type[0]==="W"?Qu(s):s.type==="APIC"?ju(s):zu(s)}function Ju(s){var o=String.fromCharCode(s[0],s[1],s[2],s[3]),n=gn(s,4),r=10;return{type:o,size:n,data:s.subarray(r,r+n)}}var pn=10,Zu=10;function vo(s){for(var o=0,n=[];ca(s,o);){var r=gn(s,o+6);s[o+5]>>6&1&&(o+=pn),o+=pn;for(var e=o+r;o+Zu<e;){var t=Ju(s.subarray(o)),i=$u(t);i&&n.push(i),o+=t.size+pn}oo(s,o)&&(o+=pn)}return n}function go(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"}function ef(s){if(s.data.byteLength===8){var o=new Uint8Array(s.data),n=o[3]&1,r=(o[4]<<23)+(o[5]<<15)+(o[6]<<7)+o[7];return r/=45,n&&(r+=4772185884e-2),Math.round(r)}}function ma(s){for(var o=vo(s),n=0;n<o.length;n++){var r=o[n];if(go(r))return ef(r)}}var Yt=function(s){return s.audioId3="org.id3",s.dateRange="com.apple.quicktime.HLS",s.emsg="https://aomedia.org/emsg/ID3",s.misbklv="urn:misb:KLV:bin:1910.1",s}({});function dr(s,o){return s===void 0&&(s=""),o===void 0&&(o=9e4),{type:s,id:-1,pid:-1,inputTimeScale:o,sequenceNumber:-1,samples:[],dropped:0}}var pa=function(){function s(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var o=s.prototype;return o.resetInitSegment=function(r,e,t,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},o.resetTimeStamp=function(r){this.initPTS=r,this.resetContiguity()},o.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},o.canParse=function(r,e){return!1},o.appendFrame=function(r,e,t){},o.demux=function(r,e){this.cachedData&&(r=Ut(this.cachedData,r),this.cachedData=null);var t=wi(r,0),i=t?t.length:0,a,l=this._audioTrack,u=this._id3Track,f=t?ma(t):void 0,d=r.length;for((this.basePTS===null||this.frameIndex===0&&H(f))&&(this.basePTS=tf(f,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),t&&t.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:t,type:Yt.audioId3,duration:Number.POSITIVE_INFINITY});i<d;){if(this.canParse(r,i)){var h=this.appendFrame(l,r,i);h?(this.frameIndex++,this.lastPTS=h.sample.pts,i+=h.length,a=i):i=d}else Hu(r,i)?(t=wi(r,i),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:t,type:Yt.audioId3,duration:Number.POSITIVE_INFINITY}),i+=t.length,a=i):i++;if(i===d&&a!==d){var c=r.slice(a);this.cachedData?this.cachedData=Ut(this.cachedData,c):this.cachedData=c}}return{audioTrack:l,videoTrack:dr(),id3Track:u,textTrack:dr()}},o.demuxSampleAes=function(r,e,t){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},o.flush=function(r){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:dr(),id3Track:this._id3Track,textTrack:dr()}},o.destroy=function(){this.cachedData=null,this._audioTrack=this._id3Track=void 0},s}(),tf=function(o,n,r){if(H(o))return o*90;var e=r?r.baseTime*9e4/r.timescale:0;return n*9e4+e},yn=null,rf=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],nf=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],af=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],sf=[0,1,1,4];function mo(s,o,n,r,e){if(!(n+24>o.length)){var t=po(o,n);if(t&&n+t.frameLength<=o.length){var i=t.samplesPerFrame*9e4/t.sampleRate,a=r+e*i,l={unit:o.subarray(n,n+t.frameLength),pts:a,dts:a};return s.config=[],s.channelCount=t.channelCount,s.samplerate=t.sampleRate,s.samples.push(l),{sample:l,length:t.frameLength,missing:0}}}}function po(s,o){var n=s[o+1]>>3&3,r=s[o+1]>>1&3,e=s[o+2]>>4&15,t=s[o+2]>>2&3;if(n!==1&&e!==0&&e!==15&&t!==3){var i=s[o+2]>>1&1,a=s[o+3]>>6,l=n===3?3-r:r===3?3:4,u=rf[l*14+e-1]*1e3,f=n===3?0:n===2?1:2,d=nf[f*3+t],h=a===3?1:2,c=af[n][r],v=sf[r],g=c*8*v,m=Math.floor(c*u/d+i)*v;if(yn===null){var p=navigator.userAgent||"",E=p.match(/Chrome\/(\d+)/i);yn=E?parseInt(E[1]):0}var S=!!yn&&yn<=87;return S&&r===2&&u>=224e3&&a===0&&(s[o+3]=s[o+3]|128),{sampleRate:d,channelCount:h,frameLength:m,samplesPerFrame:g}}}function ya(s,o){return s[o]===255&&(s[o+1]&224)===224&&(s[o+1]&6)!==0}function yo(s,o){return o+1<s.length&&ya(s,o)}function of(s,o){var n=4;return ya(s,o)&&n<=s.length-o}function Eo(s,o){if(o+1<s.length&&ya(s,o)){var n=4,r=po(s,o),e=n;r!=null&&r.frameLength&&(e=r.frameLength);var t=o+e;return t===s.length||yo(s,t)}return!1}var lf=function(s){function o(r,e){var t;return t=s.call(this)||this,t.observer=void 0,t.config=void 0,t.observer=r,t.config=e,t}ae(o,s);var n=o.prototype;return n.resetInitSegment=function(e,t,i,a){s.prototype.resetInitSegment.call(this,e,t,i,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}},o.probe=function(e,t){if(!e)return!1;var i=wi(e,0),a=i?.length||0;if(Eo(e,a))return!1;for(var l=e.length;a<l;a++)if(Gu(e,a))return t.log("ADTS sync word found !"),!0;return!1},n.canParse=function(e,t){return Bu(e,t)},n.appendFrame=function(e,t,i){fo(e,this.observer,t,i,e.manifestCodec);var a=co(e,t,i,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a},o}(pa),To=function(o,n){var r=0,e=5;n+=e;for(var t=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);e>0;){a[0]=o[n];var l=Math.min(e,8),u=8-l;i[0]=4278190080>>>24+u<<u,t[0]=(a[0]&i[0])>>u,r=r?r<<l|t[0]:t[0],n+=1,e-=l}return r},uf=function(s){function o(r){var e;return e=s.call(this)||this,e.observer=void 0,e.observer=r,e}ae(o,s);var n=o.prototype;return n.resetInitSegment=function(e,t,i,a){s.prototype.resetInitSegment.call(this,e,t,i,a),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}},n.canParse=function(e,t){return t+64<e.length},n.appendFrame=function(e,t,i){var a=So(e,t,i,this.basePTS,this.frameIndex);if(a!==-1){var l=e.samples[e.samples.length-1];return{sample:l,length:a,missing:0}}},o.probe=function(e){if(!e)return!1;var t=wi(e,0);if(!t)return!1;var i=t.length;return e[i]===11&&e[i+1]===119&&ma(t)!==void 0&&To(e,i)<16},o}(pa);function So(s,o,n,r,e){if(n+8>o.length||o[n]!==11||o[n+1]!==119)return-1;var t=o[n+4]>>6;if(t>=3)return-1;var i=[48e3,44100,32e3],a=i[t],l=o[n+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920],f=u[l*3+t]*2;if(n+f>o.length)return-1;var d=o[n+6]>>5,h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));var c=(o[n+6]<<8|o[n+7])>>12-h&1,v=[2,1,2,3,3,4,4,5],g=v[d]+c,m=o[n+5]>>3,p=o[n+5]&7,E=new Uint8Array([t<<6|m<<1|p>>2,(p&3)<<6|d<<3|c<<2|l>>4,l<<4&224]),S=1536/a*9e4,T=r+e*S,A=o.subarray(n,n+f);return s.config=E,s.channelCount=g,s.samplerate=a,s.samples.push({unit:A,pts:T}),f}var ff=function(s){function o(){return s.apply(this,arguments)||this}ae(o,s);var n=o.prototype;return n.resetInitSegment=function(e,t,i,a){s.prototype.resetInitSegment.call(this,e,t,i,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}},o.probe=function(e){if(!e)return!1;var t=wi(e,0),i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&ma(t)!==void 0&&To(e,i)<=16)return!1;for(var a=e.length;i<a;i++)if(Eo(e,i))return Se.log("MPEG Audio sync word found !"),!0;return!1},n.canParse=function(e,t){return of(e,t)},n.appendFrame=function(e,t,i){if(this.basePTS!==null)return mo(e,t,i,this.basePTS,this.frameIndex)},o}(pa),df=/\/emsg[-/]ID3/i,hf=function(){function s(n,r){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}var o=s.prototype;return o.resetTimeStamp=function(){},o.resetInitSegment=function(r,e,t,i){var a=this.videoTrack=dr("video",1),l=this.audioTrack=dr("audio",1),u=this.txtTrack=dr("text",1);if(this.id3Track=dr("id3",1),this.timeOffset=0,!!(r!=null&&r.byteLength)){var f=Zr(r);if(f.video){var d=f.video,h=d.id,c=d.timescale,v=d.codec,g=d.supplemental;a.id=h,a.timescale=u.timescale=c,a.codec=v,a.supplemental=g}if(f.audio){var m=f.audio,p=m.id,E=m.timescale,S=m.codec;l.id=p,l.timescale=E,l.codec=S}u.id=Vt.text,a.sampleDuration=0,a.duration=l.duration=i}},o.resetContiguity=function(){this.remainderData=null},s.probe=function(r){return yi(r)},o.demux=function(r,e){this.timeOffset=e;var t=r,i=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(t=Ut(this.remainderData,r));var l=Si(t);this.remainderData=l.remainder,i.samples=l.valid||new Uint8Array}else i.samples=t;var u=this.extractID3Track(i,e);return a.samples=ei(e,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:u,textTrack:this.txtTrack}},o.flush=function(){var r=this.timeOffset,e=this.videoTrack,t=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(e,this.timeOffset);return t.samples=ei(r,e),{videoTrack:e,audioTrack:dr(),id3Track:i,textTrack:dr()}},o.extractID3Track=function(r,e){var t=this,i=this.id3Track;if(r.samples.length){var a=pe(r.samples,["emsg"]);a&&a.forEach(function(l){var u=jn(l);if(df.test(u.schemeIdUri)){var f=Ao(u,e),d=u.eventDuration===4294967295?Number.POSITIVE_INFINITY:u.eventDuration/u.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var h=u.payload;i.samples.push({data:h,len:h.byteLength,dts:f,pts:f,type:Yt.emsg,duration:d})}else if(t.config.enableEmsgKLVMetadata&&u.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){var c=Ao(u,e);i.samples.push({data:u.payload,len:u.payload.byteLength,dts:c,pts:c,type:Yt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i},o.demuxSampleAes=function(r,e,t){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},o.destroy=function(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0},s}();function Ao(s,o){return H(s.presentationTime)?s.presentationTime/s.timeScale:o+s.presentationTimeDelta/s.timeScale}var cf=function(){function s(n,r,e){this.keyData=void 0,this.decrypter=void 0,this.keyData=e,this.decrypter=new ra(r,{removePKCS7Padding:!1})}var o=s.prototype;return o.decryptBuffer=function(r){return this.decrypter.decrypt(r,this.keyData.key.buffer,this.keyData.iv.buffer,kr.cbc)},o.decryptAacSample=function(r,e,t){var i=this,a=r[e].unit;if(!(a.length<=16)){var l=a.subarray(16,a.length-a.length%16),u=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(u).then(function(f){var d=new Uint8Array(f);a.set(d,16),i.decrypter.isSync()||i.decryptAacSamples(r,e+1,t)})}},o.decryptAacSamples=function(r,e,t){for(;;e++){if(e>=r.length){t();return}if(!(r[e].unit.length<32)&&(this.decryptAacSample(r,e,t),!this.decrypter.isSync()))return}},o.getAvcEncryptedData=function(r){for(var e=Math.floor((r.length-48)/160)*16+16,t=new Int8Array(e),i=0,a=32;a<r.length-16;a+=160,i+=16)t.set(r.subarray(a,a+16),i);return t},o.getAvcDecryptedUnit=function(r,e){for(var t=new Uint8Array(e),i=0,a=32;a<r.length-16;a+=160,i+=16)r.set(t.subarray(i,i+16),a);return r},o.decryptAvcSample=function(r,e,t,i,a){var l=this,u=ti(a.data),f=this.getAvcEncryptedData(u);this.decryptBuffer(f.buffer).then(function(d){a.data=l.getAvcDecryptedUnit(u,d),l.decrypter.isSync()||l.decryptAvcSamples(r,e,t+1,i)})},o.decryptAvcSamples=function(r,e,t,i){if(r instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,t=0){if(e>=r.length){i();return}for(var a=r[e].units;!(t>=a.length);t++){var l=a[t];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(r,e,t,i,l),!this.decrypter.isSync()))return}}},s}(),xo=function(){function s(){this.VideoSample=null}var o=s.prototype;return o.createVideoSample=function(r,e,t){return{key:r,frame:!1,pts:e,dts:t,units:[],length:0}},o.getLastNalUnit=function(r){var e,t=this.VideoSample,i;if((!t||t.units.length===0)&&(t=r[r.length-1]),(e=t)!=null&&e.units){var a=t.units;i=a[a.length-1]}return i},o.pushAccessUnit=function(r,e){if(r.units.length&&r.frame){if(r.pts===void 0){var t=e.samples,i=t.length;if(i){var a=t[i-1];r.pts=a.pts,r.dts=a.dts}else{e.dropped++;return}}e.samples.push(r)}},o.parseNALu=function(r,e,t){var i=e.byteLength,a=r.naluState||0,l=a,u=[],f=0,d,h,c,v=-1,g=0;for(a===-1&&(v=0,g=this.getNALuType(e,0),a=0,f=1);f<i;){if(d=e[f++],!a){a=d?0:1;continue}if(a===1){a=d?0:2;continue}if(!d)a=3;else if(d===1){if(h=f-a-1,v>=0){var m={data:e.subarray(v,h),type:g};u.push(m)}else{var p=this.getLastNalUnit(r.samples);p&&(l&&f<=4-l&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-l)),h>0&&(p.data=Ut(p.data,e.subarray(0,h)),p.state=0))}f<i?(c=this.getNALuType(e,f),v=f,g=c,a=0):a=-1}else a=0}if(v>=0&&a>=0){var E={data:e.subarray(v,i),type:g,state:a};u.push(E)}if(u.length===0){var S=this.getLastNalUnit(r.samples);S&&(S.data=Ut(S.data,e))}return r.naluState=a,u},s}(),Mi=function(){function s(n){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=n,this.bytesAvailable=n.byteLength,this.word=0,this.bitsAvailable=0}var o=s.prototype;return o.loadWord=function(){var r=this.data,e=this.bytesAvailable,t=r.byteLength-e,i=new Uint8Array(4),a=Math.min(4,e);if(a===0)throw new Error("no bytes available");i.set(r.subarray(t,t+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a},o.skipBits=function(r){var e;r=Math.min(r,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>r?(this.word<<=r,this.bitsAvailable-=r):(r-=this.bitsAvailable,e=r>>3,r-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=r,this.bitsAvailable-=r)},o.readBits=function(r){var e=Math.min(this.bitsAvailable,r),t=this.word>>>32-e;if(r>32&&Se.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=r-e,e>0&&this.bitsAvailable?t<<e|this.readBits(e):t},o.skipLZ=function(){var r;for(r=0;r<this.bitsAvailable;++r)if((this.word&2147483648>>>r)!==0)return this.word<<=r,this.bitsAvailable-=r,r;return this.loadWord(),r+this.skipLZ()},o.skipUEG=function(){this.skipBits(1+this.skipLZ())},o.skipEG=function(){this.skipBits(1+this.skipLZ())},o.readUEG=function(){var r=this.skipLZ();return this.readBits(r+1)-1},o.readEG=function(){var r=this.readUEG();return 1&r?1+r>>>1:-1*(r>>>1)},o.readBoolean=function(){return this.readBits(1)===1},o.readUByte=function(){return this.readBits(8)},o.readUShort=function(){return this.readBits(16)},o.readUInt=function(){return this.readBits(32)},s}(),Lo=function(s){function o(){return s.apply(this,arguments)||this}ae(o,s);var n=o.prototype;return n.parsePES=function(e,t,i,a){var l=this,u=this.parseNALu(e,i.data,a),f=this.VideoSample,d,h=!1;i.data=null,f&&u.length&&!e.audFound&&(this.pushAccessUnit(f,e),f=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(function(c){var v,g;switch(c.type){case 1:{var m=!1;d=!0;var p=c.data;if(h&&p.length>4){var E=l.readSliceType(p);(E===2||E===4||E===7||E===9)&&(m=!0)}if(m){var S;(S=f)!=null&&S.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null)}f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.frame=!0,f.key=m;break}case 5:d=!0,(v=f)!=null&&v.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null),f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0,f.frame=!0;break;case 6:{d=!0,Br(c.data,1,i.pts,t.samples);break}case 7:{var T,A;d=!0,h=!0;var x=c.data,I=l.readSPS(x);if(!e.sps||e.width!==I.width||e.height!==I.height||((T=e.pixelRatio)==null?void 0:T[0])!==I.pixelRatio[0]||((A=e.pixelRatio)==null?void 0:A[1])!==I.pixelRatio[1]){e.width=I.width,e.height=I.height,e.pixelRatio=I.pixelRatio,e.sps=[x];for(var k=x.subarray(1,4),D="avc1.",b=0;b<3;b++){var L=k[b].toString(16);L.length<2&&(L="0"+L),D+=L}e.codec=D}break}case 8:d=!0,e.pps=[c.data];break;case 9:d=!0,e.audFound=!0,(g=f)!=null&&g.frame&&(l.pushAccessUnit(f,e),f=null),f||(f=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;case 12:d=!0;break;default:d=!1;break}if(f&&d){var R=f.units;R.push(c)}}),a&&f&&(this.pushAccessUnit(f,e),this.VideoSample=null)},n.getNALuType=function(e,t){return e[t]&31},n.readSliceType=function(e){var t=new Mi(e);return t.readUByte(),t.readUEG(),t.readUEG()},n.skipScalingList=function(e,t){for(var i=8,a=8,l,u=0;u<e;u++)a!==0&&(l=t.readEG(),a=(i+l+256)%256),i=a===0?i:a},n.readSPS=function(e){var t=new Mi(e),i=0,a=0,l=0,u=0,f,d,h,c=t.readUByte.bind(t),v=t.readBits.bind(t),g=t.readUEG.bind(t),m=t.readBoolean.bind(t),p=t.skipBits.bind(t),E=t.skipEG.bind(t),S=t.skipUEG.bind(t),T=this.skipScalingList.bind(this);c();var A=c();if(v(5),p(3),c(),S(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){var x=g();if(x===3&&p(1),S(),S(),p(1),m())for(d=x!==3?8:12,h=0;h<d;h++)m()&&(h<6?T(16,t):T(64,t))}S();var I=g();if(I===0)g();else if(I===1)for(p(1),E(),E(),f=g(),h=0;h<f;h++)E();S(),p(1);var k=g(),D=g(),b=v(1);b===0&&p(1),p(1),m()&&(i=g(),a=g(),l=g(),u=g());var L=[1,1];if(m()&&m()){var R=c();switch(R){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:{L=[c()<<8|c(),c()<<8|c()];break}}}return{width:Math.ceil((k+1)*16-i*2-a*2),height:(2-b)*(D+1)*16-(b?2:4)*(l+u),pixelRatio:L}},o}(xo),Io=function(s){function o(){for(var r,e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r=s.call.apply(s,[this].concat(t))||this,r.initVPS=null,r}ae(o,s);var n=o.prototype;return n.parsePES=function(e,t,i,a){var l=this,u=this.parseNALu(e,i.data,a),f=this.VideoSample,d,h=!1;i.data=null,f&&u.length&&!e.audFound&&(this.pushAccessUnit(f,e),f=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(function(c){var v,g;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:f||(f=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts)),f.frame=!0,d=!0;break;case 16:case 17:case 18:case 21:if(d=!0,h){var m;(m=f)!=null&&m.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null)}f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0,f.frame=!0;break;case 19:case 20:d=!0,(v=f)!=null&&v.frame&&!f.key&&(l.pushAccessUnit(f,e),f=l.VideoSample=null),f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0,f.frame=!0;break;case 39:d=!0,Br(c.data,2,i.pts,t.samples);break;case 32:d=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=re(e.params,l.readVPS(c.data)),l.initVPS=c.data),e.vps=[c.data];break;case 33:if(d=!0,h=!0,e.vps!==void 0&&e.vps[0]!==l.initVPS&&e.sps!==void 0&&!l.matchSPS(e.sps[0],c.data)&&(l.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){var p=l.readSPS(c.data);e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.codec=p.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(var E in p.params)e.params[E]=p.params[E]}l.pushParameterSet(e.sps,c.data,e.vps),f||(f=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),f.key=!0;break;case 34:if(d=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];var S=l.readPPS(c.data);for(var T in S)e.params[T]=S[T]}l.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:d=!0,e.audFound=!0,(g=f)!=null&&g.frame&&(l.pushAccessUnit(f,e),f=null),f||(f=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;default:d=!1;break}if(f&&d){var A=f.units;A.push(c)}}),a&&f&&(this.pushAccessUnit(f,e),this.VideoSample=null)},n.pushParameterSet=function(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)},n.getNALuType=function(e,t){return(e[t]&126)>>>1},n.ebsp2rbsp=function(e){for(var t=new Uint8Array(e.byteLength),i=0,a=0;a<e.byteLength;a++)a>=2&&e[a]===3&&e[a-1]===0&&e[a-2]===0||(t[i]=e[a],i++);return new Uint8Array(t.buffer,0,i)},n.pushAccessUnit=function(e,t){s.prototype.pushAccessUnit.call(this,e,t),this.initVPS&&(this.initVPS=null)},n.readVPS=function(e){var t=new Mi(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);var i=t.readBits(3),a=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:a}},n.readSPS=function(e){var t=new Mi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);var i=t.readBits(3);t.readBoolean();for(var a=t.readBits(2),l=t.readBoolean(),u=t.readBits(5),f=t.readUByte(),d=t.readUByte(),h=t.readUByte(),c=t.readUByte(),v=t.readUByte(),g=t.readUByte(),m=t.readUByte(),p=t.readUByte(),E=t.readUByte(),S=t.readUByte(),T=t.readUByte(),A=[],x=[],I=0;I<i;I++)A.push(t.readBoolean()),x.push(t.readBoolean());if(i>0)for(var k=i;k<8;k++)t.readBits(2);for(var D=0;D<i;D++)A[D]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),x[D]&&t.readUByte();t.readUEG();var b=t.readUEG();b==3&&t.skipBits(1);var L=t.readUEG(),R=t.readUEG(),C=t.readBoolean(),B=0,P=0,O=0,V=0;C&&(B+=t.readUEG(),P+=t.readUEG(),O+=t.readUEG(),V+=t.readUEG());for(var X=t.readUEG(),z=t.readUEG(),Q=t.readUEG(),ue=t.readBoolean(),te=ue?0:i;te<=i;te++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();var le=t.readBoolean();if(le){var ve=t.readBoolean();if(ve)for(var Te=0;Te<4;Te++)for(var ke=0;ke<(Te===3?2:6);ke++){var Me=t.readBoolean();if(!Me)t.readUEG();else{var Ge=Math.min(64,1<<4+(Te<<1));Te>1&&t.readEG();for(var et=0;et<Ge;et++)t.readEG()}}}t.readBoolean(),t.readBoolean();var He=t.readBoolean();He&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());for(var Lt=t.readUEG(),Ve=0,lt=0;lt<Lt;lt++){var xe=!1;if(lt!==0&&(xe=t.readBoolean()),xe){lt===Lt&&t.readUEG(),t.readBoolean(),t.readUEG();for(var It=0,pt=0;pt<=Ve;pt++){var Ye=t.readBoolean(),nr=!1;Ye||(nr=t.readBoolean()),(Ye||nr)&&It++}Ve=It}else{var ht=t.readUEG(),bt=t.readUEG();Ve=ht+bt;for(var Qe=0;Qe<ht;Qe++)t.readUEG(),t.readBoolean();for(var yt=0;yt<bt;yt++)t.readUEG(),t.readBoolean()}}var qr=t.readBoolean();if(qr)for(var kt=t.readUEG(),Tr=0;Tr<kt;Tr++){for(var ar=0;ar<Q+4;ar++)t.readBits(1);t.readBits(1)}var wr=0,Gi=1,jr=1,Mr=!0,Ki=1,Xr=0;t.readBoolean(),t.readBoolean();var Hi=!1,Vi=t.readBoolean();if(Vi){var Qa=t.readBoolean();if(Qa){var Or=t.readUByte(),Wi=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],qt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Or>0&&Or<16?(Gi=Wi[Or-1],jr=qt[Or-1]):Or===255&&(Gi=t.readBits(16),jr=t.readBits(16))}var Cn=t.readBoolean();Cn&&t.readBoolean();var Pn=t.readBoolean();if(Pn){t.readBits(3),t.readBoolean();var $a=t.readBoolean();$a&&(t.readUByte(),t.readUByte(),t.readUByte())}var Ja=t.readBoolean();Ja&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Hi=t.readBoolean(),Hi&&(B+=t.readUEG(),P+=t.readUEG(),O+=t.readUEG(),V+=t.readUEG());var Za=t.readBoolean();if(Za){Ki=t.readBits(32),Xr=t.readBits(32);var es=t.readBoolean();es&&t.readUEG();var ts=t.readBoolean();if(ts){var wn=t.readBoolean(),zr=t.readBoolean(),Fr=!1;(wn||zr)&&(Fr=t.readBoolean(),Fr&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Fr&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(var Mn=0;Mn<=i;Mn++){Mr=t.readBoolean();var rs=Mr||t.readBoolean(),Dl=!1;rs?t.readEG():Dl=t.readBoolean();var kl=Dl?1:t.readUEG()+1;if(wn)for(var Cl=0;Cl<kl;Cl++)t.readUEG(),t.readUEG(),Fr&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(zr)for(var Pl=0;Pl<kl;Pl++)t.readUEG(),t.readUEG(),Fr&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}var Xh=t.readBoolean();Xh&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),wr=t.readUEG())}var wl=L,Ml=R;if(C||Hi){var On=1,is=1;b===1?On=is=2:b==2&&(On=2),wl=L-On*P-On*B,Ml=R-is*V-is*O}for(var zh=a?["A","B","C"][a]:"",Qh=f<<24|d<<16|h<<8|c,ns=0,Fn=0;Fn<32;Fn++)ns=(ns|(Qh>>Fn&1)<<31-Fn)>>>0;var as=ns.toString(16);u===1&&as==="2"&&(as="6");var $h=l?"H":"L";return{codecString:"hvc1."+zh+u+"."+as+"."+$h+T+".B0",params:{general_tier_flag:l,general_profile_idc:u,general_profile_space:a,general_profile_compatibility_flags:[f,d,h,c],general_constraint_indicator_flags:[v,g,m,p,E,S],general_level_idc:T,bit_depth:X+8,bit_depth_luma_minus8:X,bit_depth_chroma_minus8:z,min_spatial_segmentation_idc:wr,chroma_format_idc:b,frame_rate:{fixed:Mr,fps:Xr/Ki}},width:wl,height:Ml,pixelRatio:[Gi,jr]}},n.readPPS=function(e){var t=new Mi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);var i=t.readBoolean();i&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);var a=t.readBoolean(),l=t.readBoolean(),u=1;return l&&a?u=0:l?u=3:a&&(u=2),{parallelismType:u}},n.matchSPS=function(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)},o}(xo),dt=188,vf=function(){function s(n,r,e,t){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=n,this.config=r,this.typeSupported=e,this.logger=t,this.videoParser=null}s.probe=function(r,e){var t=s.syncOffset(r);return t>0&&e.warn("MPEG2-TS detected but first sync word found @ offset "+t),t!==-1},s.syncOffset=function(r){for(var e=r.length,t=Math.min(dt*5,e-dt)+1,i=0;i<t;){for(var a=!1,l=-1,u=0,f=i;f<e;f+=dt)if(r[f]===71&&(e-f===dt||r[f+dt]===71)){if(u++,l===-1&&(l=f,l!==0&&(t=Math.min(l+dt*99,r.length-dt)+1)),a||(a=Ea(r,f)===0),a&&u>1&&(l===0&&u>2||f+dt>t))return l}else{if(u)return-1;break}i++}return-1},s.createTrack=function(r,e){return{container:r==="video"||r==="audio"?"video/mp2t":void 0,type:r,id:Vt[r],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:r==="audio"?e:void 0}};var o=s.prototype;return o.resetInitSegment=function(r,e,t,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=s.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=s.createTrack("audio",i),this._id3Track=s.createTrack("id3"),this._txtTrack=s.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=t},o.resetTimeStamp=function(){},o.resetContiguity=function(){var r=this._audioTrack,e=this._videoTrack,t=this._id3Track;r&&(r.pesData=null),e&&(e.pesData=null),t&&(t.pesData=null),this.aacOverFlow=null,this.remainderData=null},o.demux=function(r,e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!1),t||(this.sampleAes=null);var a,l=this._videoTrack,u=this._audioTrack,f=this._id3Track,d=this._txtTrack,h=l.pid,c=l.pesData,v=u.pid,g=f.pid,m=u.pesData,p=f.pesData,E=null,S=this.pmtParsed,T=this._pmtId,A=r.length;if(this.remainderData&&(r=Ut(this.remainderData,r),A=r.length,this.remainderData=null),A<dt&&!i)return this.remainderData=r,{audioTrack:u,videoTrack:l,id3Track:f,textTrack:d};var x=Math.max(0,s.syncOffset(r));A-=(A-x)%dt,A<r.byteLength&&!i&&(this.remainderData=new Uint8Array(r.buffer,A,r.buffer.byteLength-A));for(var I=0,k=x;k<A;k+=dt)if(r[k]===71){var D=!!(r[k+1]&64),b=Ea(r,k),L=(r[k+3]&48)>>4,R=void 0;if(L>1){if(R=k+5+r[k+4],R===k+dt)continue}else R=k+4;switch(b){case h:if(D){if(c&&(a=li(c,this.logger))){if(this.videoParser===null)switch(l.segmentCodec){case"avc":this.videoParser=new Lo;break;case"hevc":this.videoParser=new Io;break}this.videoParser!==null&&this.videoParser.parsePES(l,d,a,!1)}c={data:[],size:0}}c&&(c.data.push(r.subarray(R,k+dt)),c.size+=k+dt-R);break;case v:if(D){if(m&&(a=li(m,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,a);break;case"mp3":this.parseMPEGPES(u,a);break;case"ac3":this.parseAC3PES(u,a);break}m={data:[],size:0}}m&&(m.data.push(r.subarray(R,k+dt)),m.size+=k+dt-R);break;case g:D&&(p&&(a=li(p,this.logger))&&this.parseID3PES(f,a),p={data:[],size:0}),p&&(p.data.push(r.subarray(R,k+dt)),p.size+=k+dt-R);break;case 0:D&&(R+=r[R]+1),T=this._pmtId=gf(r,R);break;case T:{D&&(R+=r[R]+1);var C=mf(r,R,this.typeSupported,t,this.observer,this.logger);h=C.videoPid,h>0&&(l.pid=h,l.segmentCodec=C.segmentVideoCodec),v=C.audioPid,v>0&&(u.pid=v,u.segmentCodec=C.segmentAudioCodec),g=C.id3Pid,g>0&&(f.pid=g),E!==null&&!S&&(this.logger.warn("MPEG-TS PMT found at "+k+" after unknown PID '"+E+"'. Backtracking to sync byte @"+x+" to parse all TS packets."),E=null,k=x-188),S=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=b;break}}else I++;I>0&&Ta(this.observer,new Error("Found "+I+" TS packet/s that do not start with 0x47"),void 0,this.logger),l.pesData=c,u.pesData=m,f.pesData=p;var B={audioTrack:u,videoTrack:l,id3Track:f,textTrack:d};return i&&this.extractRemainingSamples(B),B},o.flush=function(){var r=this.remainderData;this.remainderData=null;var e;return r?e=this.demux(r,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},o.extractRemainingSamples=function(r){var e=r.audioTrack,t=r.videoTrack,i=r.id3Track,a=r.textTrack,l=t.pesData,u=e.pesData,f=i.pesData,d;if(l&&(d=li(l,this.logger))){if(this.videoParser===null)switch(t.segmentCodec){case"avc":this.videoParser=new Lo;break;case"hevc":this.videoParser=new Io;break}this.videoParser!==null&&(this.videoParser.parsePES(t,a,d,!0),t.pesData=null)}else t.pesData=l;if(u&&(d=li(u,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,d);break;case"mp3":this.parseMPEGPES(e,d);break;case"ac3":this.parseAC3PES(e,d);break}e.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=u;f&&(d=li(f,this.logger))?(this.parseID3PES(i,d),i.pesData=null):i.pesData=f},o.demuxSampleAes=function(r,e,t){var i=this.demux(r,t,!0,!this.config.progressive),a=this.sampleAes=new cf(this.observer,this.config,e);return this.decrypt(i,a)},o.decrypt=function(r,e){return new Promise(function(t){var i=r.audioTrack,a=r.videoTrack;i.samples&&i.segmentCodec==="aac"?e.decryptAacSamples(i.samples,0,function(){a.samples?e.decryptAvcSamples(a.samples,0,0,function(){t(r)}):t(r)}):a.samples&&e.decryptAvcSamples(a.samples,0,0,function(){t(r)})})},o.destroy=function(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0},o.parseAACPES=function(r,e){var t=0,i=this.aacOverFlow,a=e.data;if(i){this.aacOverFlow=null;var l=i.missing,u=i.sample.unit.byteLength;if(l===-1)a=Ut(i.sample.unit,a);else{var f=u-l;i.sample.unit.set(a.subarray(0,l),f),r.samples.push(i.sample),t=i.missing}}var d,h;for(d=t,h=a.length;d<h-1&&!mn(a,d);d++);if(d!==t){var c,v=d<h-1;if(v?c="AAC PES did not start with ADTS header,offset:"+d:c="No ADTS header found in AAC PES",Ta(this.observer,new Error(c),v,this.logger),!v)return}fo(r,this.observer,a,d,this.audioCodec);var g;if(e.pts!==void 0)g=e.pts;else if(i){var m=ho(r.samplerate);g=i.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var p=0,E;d<h;)if(E=co(r,a,d,g,p),d+=E.length,E.missing){this.aacOverFlow=E;break}else for(p++;d<h-1&&!mn(a,d);d++);},o.parseMPEGPES=function(r,e){var t=e.data,i=t.length,a=0,l=0,u=e.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<i;)if(yo(t,l)){var f=mo(r,t,l,u,a);if(f)l+=f.length,a++;else break}else l++},o.parseAC3PES=function(r,e){{var t=e.data,i=e.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}for(var a=t.length,l=0,u=0,f;u<a&&(f=So(r,t,u,i,l++))>0;)u+=f}},o.parseID3PES=function(r,e){if(e.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var t=re({},e,{type:this._videoTrack?Yt.emsg:Yt.audioId3,duration:Number.POSITIVE_INFINITY});r.samples.push(t)},s}();function Ea(s,o){return((s[o+1]&31)<<8)+s[o+2]}function gf(s,o){return(s[o+10]&31)<<8|s[o+11]}function mf(s,o,n,r,e,t){var i={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(s[o+1]&15)<<8|s[o+2],l=o+3+a-4,u=(s[o+10]&15)<<8|s[o+11];for(o+=12+u;o<l;){var f=Ea(s,o),d=(s[o+3]&15)<<8|s[o+4];switch(s[o]){case 207:if(!r){Sa("ADTS AAC",t);break}case 15:i.audioPid===-1&&(i.audioPid=f);break;case 21:i.id3Pid===-1&&(i.id3Pid=f);break;case 219:if(!r){Sa("H.264",t);break}case 27:i.videoPid===-1&&(i.videoPid=f);break;case 3:case 4:!n.mpeg&&!n.mp3?t.log("MPEG audio found, not supported in this browser"):i.audioPid===-1&&(i.audioPid=f,i.segmentAudioCodec="mp3");break;case 193:if(!r){Sa("AC-3",t);break}case 129:n.ac3?i.audioPid===-1&&(i.audioPid=f,i.segmentAudioCodec="ac3"):t.log("AC-3 audio found, not supported in this browser");break;case 6:if(i.audioPid===-1&&d>0)for(var h=o+5,c=d;c>2;){var v=s[h];switch(v){case 106:n.ac3!==!0?t.log("AC-3 audio found, not supported in this browser for now"):(i.audioPid=f,i.segmentAudioCodec="ac3");break}var g=s[h+1]+2;h+=g,c-=g}break;case 194:case 135:return Ta(e,new Error("Unsupported EC-3 in M2TS found"),void 0,t),i;case 36:i.videoPid===-1&&(i.videoPid=f,i.segmentVideoCodec="hevc",t.log("HEVC in M2TS found"));break}o+=d+5}return i}function Ta(s,o,n,r){r.warn("parsing error: "+o.message),s.emit(y.ERROR,y.ERROR,{type:Y.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:o,reason:o.message})}function Sa(s,o){o.log(s+" with AES-128-CBC encryption found in unencrypted stream")}function li(s,o){var n=0,r,e,t,i,a,l=s.data;if(!s||s.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Ut(l[0],l[1]),l.splice(1,1);r=l[0];var u=(r[0]<<16)+(r[1]<<8)+r[2];if(u===1){if(e=(r[4]<<8)+r[5],e&&e>s.size-6)return null;var f=r[7];f&192&&(i=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,f&64?(a=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,i-a>60*9e4&&(o.warn(Math.round((i-a)/9e4)+"s delta between PTS and DTS, align them"),i=a)):a=i),t=r[8];var d=t+9;if(s.size<=d)return null;s.size-=d;for(var h=new Uint8Array(s.size),c=0,v=l.length;c<v;c++){r=l[c];var g=r.byteLength;if(d)if(d>g){d-=g;continue}else r=r.subarray(d),g-=d,d=0;h.set(r,n),n+=g}return e&&(e-=t+3),{data:h,pts:i,dts:a,len:e}}return null}var pf=function(){function s(){}return s.getSilentFrame=function(n,r){switch(n){case"mp4a.40.2":if(r===1)return new Uint8Array([0,200,0,128,35,128]);if(r===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(r===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(r===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(r===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(r===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(r===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},s}(),Cr=Math.pow(2,32)-1,mt=function(){function s(){}return s.init=function(){s.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var n;for(n in s.types)s.types.hasOwnProperty(n)&&(s.types[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);s.HDLR_TYPES={video:r,audio:e};var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);s.STTS=s.STSC=s.STCO=i,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);s.FTYP=s.box(s.types.ftyp,a,u,a,l),s.DINF=s.box(s.types.dinf,s.box(s.types.dref,t))},s.box=function(n){for(var r=8,e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];for(var a=t.length,l=a;a--;)r+=t[a].byteLength;var u=new Uint8Array(r);for(u[0]=r>>24&255,u[1]=r>>16&255,u[2]=r>>8&255,u[3]=r&255,u.set(n,4),a=0,r=8;a<l;a++)u.set(t[a],r),r+=t[a].byteLength;return u},s.hdlr=function(n){return s.box(s.types.hdlr,s.HDLR_TYPES[n])},s.mdat=function(n){return s.box(s.types.mdat,n)},s.mdhd=function(n,r){r*=n;var e=Math.floor(r/(Cr+1)),t=Math.floor(r%(Cr+1));return s.box(s.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255,t>>24,t>>16&255,t>>8&255,t&255,85,196,0,0]))},s.mdia=function(n){return s.box(s.types.mdia,s.mdhd(n.timescale||0,n.duration||0),s.hdlr(n.type),s.minf(n))},s.mfhd=function(n){return s.box(s.types.mfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255]))},s.minf=function(n){return n.type==="audio"?s.box(s.types.minf,s.box(s.types.smhd,s.SMHD),s.DINF,s.stbl(n)):s.box(s.types.minf,s.box(s.types.vmhd,s.VMHD),s.DINF,s.stbl(n))},s.moof=function(n,r,e){return s.box(s.types.moof,s.mfhd(n),s.traf(e,r))},s.moov=function(n){for(var r=n.length,e=[];r--;)e[r]=s.trak(n[r]);return s.box.apply(null,[s.types.moov,s.mvhd(n[0].timescale||0,n[0].duration||0)].concat(e).concat(s.mvex(n)))},s.mvex=function(n){for(var r=n.length,e=[];r--;)e[r]=s.trex(n[r]);return s.box.apply(null,[s.types.mvex].concat(e))},s.mvhd=function(n,r){r*=n;var e=Math.floor(r/(Cr+1)),t=Math.floor(r%(Cr+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255,t>>24,t>>16&255,t>>8&255,t&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.box(s.types.mvhd,i)},s.sdtp=function(n){var r=n.samples||[],e=new Uint8Array(4+r.length),t,i;for(t=0;t<r.length;t++)i=r[t].flags,e[t+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return s.box(s.types.sdtp,e)},s.stbl=function(n){return s.box(s.types.stbl,s.stsd(n),s.box(s.types.stts,s.STTS),s.box(s.types.stsc,s.STSC),s.box(s.types.stsz,s.STSZ),s.box(s.types.stco,s.STCO))},s.avc1=function(n){var r=[],e=[],t,i,a;for(t=0;t<n.sps.length;t++)i=n.sps[t],a=i.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(i));for(t=0;t<n.pps.length;t++)i=n.pps[t],a=i.byteLength,e.push(a>>>8&255),e.push(a&255),e=e.concat(Array.prototype.slice.call(i));var l=s.box(s.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|n.sps.length].concat(r).concat([n.pps.length]).concat(e))),u=n.width,f=n.height,d=n.pixelRatio[0],h=n.pixelRatio[1];return s.box(s.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,s.box(s.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),s.box(s.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,h>>24,h>>16&255,h>>8&255,h&255])))},s.esds=function(n){var r=n.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2].concat(r,[6,1,2]))},s.audioStsd=function(n){var r=n.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount||0,0,16,0,0,0,0,r>>8&255,r&255,0,0])},s.mp4a=function(n){return s.box(s.types.mp4a,s.audioStsd(n),s.box(s.types.esds,s.esds(n)))},s.mp3=function(n){return s.box(s.types[".mp3"],s.audioStsd(n))},s.ac3=function(n){return s.box(s.types["ac-3"],s.audioStsd(n),s.box(s.types.dac3,n.config))},s.stsd=function(n){var r=n.segmentCodec;if(n.type==="audio"){if(r==="aac")return s.box(s.types.stsd,s.STSD,s.mp4a(n));if(r==="ac3"&&n.config)return s.box(s.types.stsd,s.STSD,s.ac3(n));if(r==="mp3"&&n.codec==="mp3")return s.box(s.types.stsd,s.STSD,s.mp3(n))}else if(n.pps&&n.sps){if(r==="avc")return s.box(s.types.stsd,s.STSD,s.avc1(n));if(r==="hevc"&&n.vps)return s.box(s.types.stsd,s.STSD,s.hvc1(n))}else throw new Error("video track missing pps or sps");throw new Error("unsupported "+n.type+" segment codec ("+r+"/"+n.codec+")")},s.tkhd=function(n){var r=n.id,e=(n.duration||0)*(n.timescale||0),t=n.width||0,i=n.height||0,a=Math.floor(e/(Cr+1)),l=Math.floor(e%(Cr+1));return s.box(s.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,t>>8&255,t&255,0,0,i>>8&255,i&255,0,0]))},s.traf=function(n,r){var e=s.sdtp(n),t=n.id,i=Math.floor(r/(Cr+1)),a=Math.floor(r%(Cr+1));return s.box(s.types.traf,s.box(s.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255])),s.box(s.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,a>>24,a>>16&255,a>>8&255,a&255])),s.trun(n,e.length+16+20+8+16+8+8),e)},s.trak=function(n){return n.duration=n.duration||4294967295,s.box(s.types.trak,s.tkhd(n),s.mdia(n))},s.trex=function(n){var r=n.id;return s.box(s.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},s.trun=function(n,r){var e=n.samples||[],t=e.length,i=12+16*t,a=new Uint8Array(i),l,u,f,d,h,c;for(r+=8+i,a.set([n.type==="video"?1:0,0,15,1,t>>>24&255,t>>>16&255,t>>>8&255,t&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0),l=0;l<t;l++)u=e[l],f=u.duration,d=u.size,h=u.flags,c=u.cts,a.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,c>>>24&255,c>>>16&255,c>>>8&255,c&255],12+16*l);return s.box(s.types.trun,a)},s.initSegment=function(n){s.types||s.init();var r=s.moov(n),e=Ut(s.FTYP,r);return e},s.hvc1=function(n){for(var r=n.params,e=[n.vps,n.sps,n.pps],t=4,i=new Uint8Array([1,r.general_profile_space<<6|(r.general_tier_flag?32:0)|r.general_profile_idc,r.general_profile_compatibility_flags[0],r.general_profile_compatibility_flags[1],r.general_profile_compatibility_flags[2],r.general_profile_compatibility_flags[3],r.general_constraint_indicator_flags[0],r.general_constraint_indicator_flags[1],r.general_constraint_indicator_flags[2],r.general_constraint_indicator_flags[3],r.general_constraint_indicator_flags[4],r.general_constraint_indicator_flags[5],r.general_level_idc,240|r.min_spatial_segmentation_idc>>8,255&r.min_spatial_segmentation_idc,252|r.parallelismType,252|r.chroma_format_idc,248|r.bit_depth_luma_minus8,248|r.bit_depth_chroma_minus8,0,parseInt(r.frame_rate.fps),t-1|r.temporal_id_nested<<2|r.num_temporal_layers<<3|(r.frame_rate.fixed?64:0),e.length]),a=i.length,l=0;l<e.length;l+=1){a+=3;for(var u=0;u<e[l].length;u+=1)a+=2+e[l][u].length}var f=new Uint8Array(a);f.set(i,0),a=i.length;for(var d=e.length-1,h=0;h<e.length;h+=1){f.set(new Uint8Array([32+h|(h===d?128:0),0,e[h].length]),a),a+=3;for(var c=0;c<e[h].length;c+=1)f.set(new Uint8Array([e[h][c].length>>8,e[h][c].length&255]),a),a+=2,f.set(e[h][c],a),a+=e[h][c].length}var v=s.box(s.types.hvcC,f),g=n.width,m=n.height,p=n.pixelRatio[0],E=n.pixelRatio[1];return s.box(s.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),v,s.box(s.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),s.box(s.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,E>>24,E>>16&255,E>>8&255,E&255])))},s}();mt.types=void 0,mt.HDLR_TYPES=void 0,mt.STTS=void 0,mt.STSC=void 0,mt.STCO=void 0,mt.STSZ=void 0,mt.VMHD=void 0,mt.SMHD=void 0,mt.STSD=void 0,mt.FTYP=void 0,mt.DINF=void 0;var bo=9e4;function Aa(s,o,n,r){n===void 0&&(n=1),r===void 0&&(r=!1);var e=s*o*n;return r?Math.round(e):e}function yf(s,o,n,r){return n===void 0&&(n=1),r===void 0&&(r=!1),Aa(s,o,1/n,r)}function Oi(s,o){return Aa(s,1e3,1/bo,o)}function Ef(s,o){return o===void 0&&(o=1),Aa(s,bo,1/o)}var Tf=10*1e3,Sf=1024,Af=1152,xf=1536,ui=null,xa=null;function Ro(s,o,n,r){return{duration:o,size:n,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:s?2:1,isNonSync:s?0:1}}}var En=function(s){function o(r,e,t,i){var a;if(a=s.call(this,"mp4-remuxer",i)||this,a.observer=void 0,a.config=void 0,a.typeSupported=void 0,a.ISGenerated=!1,a._initPTS=null,a._initDTS=null,a.nextVideoTs=null,a.nextAudioTs=null,a.videoSampleDuration=null,a.isAudioContiguous=!1,a.isVideoContiguous=!1,a.videoTrackConfig=void 0,a.observer=r,a.config=e,a.typeSupported=t,a.ISGenerated=!1,ui===null){var l=navigator.userAgent||"",u=l.match(/Chrome\/(\d+)/i);ui=u?parseInt(u[1]):0}if(xa===null){var f=navigator.userAgent.match(/Safari\/(\d+)/i);xa=f?parseInt(f[1]):0}return a}ae(o,s);var n=o.prototype;return n.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},n.resetTimeStamp=function(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e},n.resetNextTimestamp=function(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},n.resetInitSegment=function(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},n.getVideoStartPts=function(e){var t=!1,i=e[0].pts,a=e.reduce(function(l,u){var f=u.pts,d=f-l;return d<-4294967296&&(t=!0,f=zt(f,i),d=f-l),d>0?l:f},i);return t&&this.debug("PTS rollover detected"),a},n.remux=function(e,t,i,a,l,u,f,d){var h,c,v,g,m,p,E=l,S=l,T=e.pid>-1,A=t.pid>-1,x=t.samples.length,I=e.samples.length>0,k=f&&x>0||x>1,D=(!T||I)&&(!A||k)||this.ISGenerated||f;if(D){if(this.ISGenerated){var b,L,R,C,B=this.videoTrackConfig;(B&&(t.width!==B.width||t.height!==B.height||((b=t.pixelRatio)==null?void 0:b[0])!==((L=B.pixelRatio)==null?void 0:L[0])||((R=t.pixelRatio)==null?void 0:R[1])!==((C=B.pixelRatio)==null?void 0:C[1]))||!B&&k||this.nextAudioTs===null&&I)&&this.resetInitSegment()}this.ISGenerated||(v=this.generateIS(e,t,l,u));var P=this.isVideoContiguous,O=-1,V;if(k&&(O=Lf(t.samples),!P&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,O>0){this.warn("Dropped "+O+" out of "+x+" video samples due to a missing keyframe");var X=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(O),t.dropped+=O,S+=(t.samples[0].pts-X)/t.inputTimeScale,V=S}else O===-1&&(this.warn("No keyframe found out of "+x+" video samples"),p=!1);if(this.ISGenerated){if(I&&k){var z=this.getVideoStartPts(t.samples),Q=zt(e.samples[0].pts,z)-z,ue=Q/t.inputTimeScale;E+=Math.max(0,ue),S+=Math.max(0,-ue)}if(I){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),v=this.generateIS(e,t,l,u)),c=this.remuxAudio(e,E,this.isAudioContiguous,u,A||k||d===F.AUDIO?S:void 0),k){var te=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),v=this.generateIS(e,t,l,u)),h=this.remuxVideo(t,S,P,te)}}else k&&(h=this.remuxVideo(t,S,P,0));h&&(h.firstKeyFrame=O,h.independent=O!==-1,h.firstKeyFramePTS=V)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(m=_o(i,l,this._initPTS,this._initDTS)),a.samples.length&&(g=Do(a,l,this._initPTS))),{audio:c,video:h,initSegment:v,independent:p,text:g,id3:m}},n.generateIS=function(e,t,i,a){var l=e.samples,u=t.samples,f=this.typeSupported,d={},h=this._initPTS,c=!h||a,v="audio/mp4",g,m,p,E;if(c&&(g=m=1/0),e.config&&l.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":f.mpeg?(v="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:v,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&f.mpeg?new Uint8Array(0):mt.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(E=e.id,p=e.inputTimeScale,!h||p!==h.timescale?g=m=l[0].pts-Math.round(p*i):c=!1)}if(t.sps&&t.pps&&u.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:mt.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(E=t.id,p=t.inputTimeScale,!h||p!==h.timescale){var S=this.getVideoStartPts(u),T=Math.round(p*i);m=Math.min(m,zt(u[0].dts,S)-T),g=Math.min(g,S-T)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:g,timescale:p},this._initDTS={baseTime:m,timescale:p}):g=p=void 0,{tracks:d,initPTS:g,timescale:p,trackId:E}},n.remuxVideo=function(e,t,i,a){var l=e.inputTimeScale,u=e.samples,f=[],d=u.length,h=this._initPTS,c=h.baseTime*l/h.timescale,v=this.nextVideoTs,g=8,m=this.videoSampleDuration,p,E,S=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,A=!1;if(!i||v===null){var x=c+t*l,I=u[0].pts-zt(u[0].dts,u[0].pts);ui&&v!==null&&Math.abs(x-I-(v+c))<15e3?i=!0:v=x-I-c}for(var k=v+c,D=0;D<d;D++){var b=u[D];b.pts=zt(b.pts,k),b.dts=zt(b.dts,k),b.dts<u[D>0?D-1:D].dts&&(A=!0)}A&&u.sort(function(zr,Fr){var Mn=zr.dts-Fr.dts,rs=zr.pts-Fr.pts;return Mn||rs}),p=u[0].dts,E=u[u.length-1].dts;var L=E-p,R=L?Math.round(L/(d-1)):m||e.inputTimeScale/30;if(i){var C=p-k,B=C>R,P=C<-1;if((B||P)&&(B?this.warn((e.segmentCodec||"").toUpperCase()+": "+Oi(C,!0)+" ms ("+C+"dts) hole between fragments detected at "+t.toFixed(3)):this.warn((e.segmentCodec||"").toUpperCase()+": "+Oi(-C,!0)+" ms ("+C+"dts) overlapping between fragments detected at "+t.toFixed(3)),!P||k>=u[0].pts||ui)){p=k;var O=u[0].pts-C;if(B)u[0].dts=p,u[0].pts=O;else for(var V=!0,X=0;X<u.length&&!(u[X].dts>O&&V);X++){var z=u[X].pts;if(u[X].dts-=C,u[X].pts-=C,X<u.length-1){var Q=u[X+1].pts,ue=u[X].pts,te=Q<=ue,le=Q<=z;V=te==le}}this.log("Video: Initial PTS/DTS adjusted: "+Oi(O,!0)+"/"+Oi(p,!0)+", delta: "+Oi(C,!0)+" ms")}}p=Math.max(0,p);for(var ve=0,Te=0,ke=p,Me=0;Me<d;Me++){for(var Ge=u[Me],et=Ge.units,He=et.length,Lt=0,Ve=0;Ve<He;Ve++)Lt+=et[Ve].data.length;Te+=Lt,ve+=He,Ge.length=Lt,Ge.dts<ke?(Ge.dts=ke,ke+=R/4|0||1):ke=Ge.dts,S=Math.min(Ge.pts,S),T=Math.max(Ge.pts,T)}E=u[d-1].dts;var lt=Te+4*ve+8,xe;try{xe=new Uint8Array(lt)}catch(zr){this.observer.emit(y.ERROR,y.ERROR,{type:Y.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:zr,bytes:lt,reason:"fail allocating video mdat "+lt});return}var It=new DataView(xe.buffer);It.setUint32(0,lt),xe.set(mt.types.mdat,4);for(var pt=!1,Ye=Number.POSITIVE_INFINITY,nr=Number.POSITIVE_INFINITY,ht=Number.NEGATIVE_INFINITY,bt=Number.NEGATIVE_INFINITY,Qe=0;Qe<d;Qe++){for(var yt=u[Qe],qr=yt.units,kt=0,Tr=0,ar=qr.length;Tr<ar;Tr++){var wr=qr[Tr],Gi=wr.data,jr=wr.data.byteLength;It.setUint32(g,jr),g+=4,xe.set(Gi,g),g+=jr,kt+=4+jr}var Mr=void 0;if(Qe<d-1)m=u[Qe+1].dts-yt.dts,Mr=u[Qe+1].pts-yt.pts;else{var Ki=this.config,Xr=Qe>0?yt.dts-u[Qe-1].dts:R;if(Mr=Qe>0?yt.pts-u[Qe-1].pts:R,Ki.stretchShortVideoTrack&&this.nextAudioTs!==null){var Hi=Math.floor(Ki.maxBufferHole*l),Vi=(a?S+a*l:this.nextAudioTs+c)-yt.pts;Vi>Hi?(m=Vi-Xr,m<0?m=Xr:pt=!0,this.log("It is approximately "+Vi/90+" ms to the next segment; using duration "+m/90+" ms for the last video frame.")):m=Xr}else m=Xr}var Qa=Math.round(yt.pts-yt.dts);Ye=Math.min(Ye,m),ht=Math.max(ht,m),nr=Math.min(nr,Mr),bt=Math.max(bt,Mr),f.push(Ro(yt.key,m,kt,Qa))}if(f.length){if(ui){if(ui<70){var Or=f[0].flags;Or.dependsOn=2,Or.isNonSync=0}}else if(xa&&bt-nr<ht-Ye&&R/ht<.025&&f[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Wi=p,qt=0,Cn=f.length;qt<Cn;qt++){var Pn=Wi+f[qt].duration,$a=Wi+f[qt].cts;if(qt<Cn-1){var Ja=Pn+f[qt+1].cts;f[qt].duration=Ja-$a}else f[qt].duration=qt?f[qt-1].duration:R;f[qt].cts=0,Wi=Pn}}}m=pt||!m?R:m;var Za=E+m;this.nextVideoTs=v=Za-c,this.videoSampleDuration=m,this.isVideoContiguous=!0;var es=mt.moof(e.sequenceNumber++,p,re(e,{samples:f})),ts="video",wn={data1:es,data2:xe,startPTS:(S-c)/l,endPTS:(T+m-c)/l,startDTS:(p-c)/l,endDTS:v/l,type:ts,hasAudio:!1,hasVideo:!0,nb:f.length,dropped:e.dropped};return e.samples=[],e.dropped=0,wn},n.getSamplesPerFrame=function(e){switch(e.segmentCodec){case"mp3":return Af;case"ac3":return xf;default:return Sf}},n.remuxAudio=function(e,t,i,a,l){var u=e.inputTimeScale,f=e.samplerate?e.samplerate:u,d=u/f,h=this.getSamplesPerFrame(e),c=h*d,v=this._initPTS,g=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,m=[],p=l!==void 0,E=e.samples,S=g?0:8,T=this.nextAudioTs||-1,A=v.baseTime*u/v.timescale,x=A+t*u;if(this.isAudioContiguous=i=i||E.length&&T>0&&(a&&Math.abs(x-(T+A))<9e3||Math.abs(zt(E[0].pts,x)-(T+A))<20*c),E.forEach(function(Ye){Ye.pts=zt(Ye.pts,x)}),!i||T<0){if(E=E.filter(function(Ye){return Ye.pts>=0}),!E.length)return;l===0?T=0:a&&!p?T=Math.max(0,x-A):T=E[0].pts-A}if(e.segmentCodec==="aac")for(var I=this.config.maxAudioFramesDrift,k=0,D=T+A;k<E.length;k++){var b=E[k],L=b.pts,R=L-D,C=Math.abs(1e3*R/u);if(R<=-I*c&&p)k===0&&(this.warn("Audio frame @ "+(L/u).toFixed(3)+"s overlaps marker by "+Math.round(1e3*R/u)+" ms."),this.nextAudioTs=T=L-A,D=L);else if(R>=I*c&&C<Tf&&p){var B=Math.round(R/c);for(D=L-B*c;D<0&&B&&c;)B--,D+=c;k===0&&(this.nextAudioTs=T=D-A),this.warn("Injecting "+B+" audio frames @ "+((D-A)/u).toFixed(3)+"s due to "+Math.round(1e3*R/u)+" ms gap.");for(var P=0;P<B;P++){var O=pf.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);O||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),O=b.unit.subarray()),E.splice(k,0,{unit:O,pts:D}),D+=c,k++}}b.pts=D,D+=c}for(var V=null,X=null,z,Q=0,ue=E.length;ue--;)Q+=E[ue].unit.byteLength;for(var te=0,le=E.length;te<le;te++){var ve=E[te],Te=ve.unit,ke=ve.pts;if(X!==null){var Me=m[te-1];Me.duration=Math.round((ke-X)/d)}else if(i&&e.segmentCodec==="aac"&&(ke=T+A),V=ke,Q>0){Q+=S;try{z=new Uint8Array(Q)}catch(Ye){this.observer.emit(y.ERROR,y.ERROR,{type:Y.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:Ye,bytes:Q,reason:"fail allocating audio mdat "+Q});return}if(!g){var Ge=new DataView(z.buffer);Ge.setUint32(0,Q),z.set(mt.types.mdat,4)}}else return;z.set(Te,S);var et=Te.byteLength;S+=et,m.push(Ro(!0,h,et,0)),X=ke}var He=m.length;if(He){var Lt=m[m.length-1];T=X-A,this.nextAudioTs=T+d*Lt.duration;var Ve=g?new Uint8Array(0):mt.moof(e.sequenceNumber++,V/d,re({},e,{samples:m}));e.samples=[];var lt=(V-A)/u,xe=T/u,It="audio",pt={data1:Ve,data2:z,startPTS:lt,endPTS:xe,startDTS:lt,endDTS:xe,type:It,hasAudio:!0,hasVideo:!1,nb:He};return this.isAudioContiguous=!0,pt}},o}(Z);function zt(s,o){var n;if(o===null)return s;for(o<s?n=-8589934592:n=8589934592;Math.abs(s-o)>4294967296;)s+=n;return s}function Lf(s){for(var o=0;o<s.length;o++)if(s[o].key)return o;return-1}function _o(s,o,n,r){var e=s.samples.length;if(e){for(var t=s.inputTimeScale,i=0;i<e;i++){var a=s.samples[i];a.pts=zt(a.pts-n.baseTime*t/n.timescale,o*t)/t,a.dts=zt(a.dts-r.baseTime*t/r.timescale,o*t)/t}var l=s.samples;return s.samples=[],{samples:l}}}function Do(s,o,n){var r=s.samples.length;if(r){for(var e=s.inputTimeScale,t=0;t<r;t++){var i=s.samples[t];i.pts=zt(i.pts-n.baseTime*e/n.timescale,o*e)/e}s.samples.sort(function(l,u){return l.pts-u.pts});var a=s.samples;return s.samples=[],{samples:a}}}var If=function(s){function o(r,e,t,i){var a;return a=s.call(this,"passthrough-remuxer",i)||this,a.emitInitSegment=!1,a.audioCodec=void 0,a.videoCodec=void 0,a.initData=void 0,a.initPTS=null,a.initTracks=void 0,a.lastEndTime=null,a.isVideoContiguous=!1,a}ae(o,s);var n=o.prototype;return n.destroy=function(){},n.resetTimeStamp=function(e){this.lastEndTime=null;var t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)},n.resetNextTimestamp=function(){this.isVideoContiguous=!1,this.lastEndTime=null},n.resetInitSegment=function(e,t,i,a){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(Yn(e,a)),this.emitInitSegment=!0},n.generateInitSegment=function(e){var t=this.audioCodec,i=this.videoCodec;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}var a=this.initData=Zr(e);a.audio&&(t=ko(a.audio,se.AUDIO,this)),a.video&&(i=ko(a.video,se.VIDEO,this));var l={};a.audio&&a.video?l.audiovideo={container:"video/mp4",codec:t+","+i,supplemental:a.video.supplemental,initSegment:e,id:"main"}:a.audio?l.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:a.video?l.video={container:"video/mp4",codec:i,supplemental:a.video.supplemental,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=l},n.remux=function(e,t,i,a,l,u){var f,d,h=this.initPTS,c=this.lastEndTime,v={audio:void 0,video:void 0,text:a,id3:i,initSegment:void 0};H(c)||(c=this.lastEndTime=l||0);var g=t.samples;if(!(g!=null&&g.length))return v;var m={initPTS:void 0,timescale:void 0,trackId:void 0},p=this.initData;if((f=p)!=null&&f.length||(this.generateInitSegment(g),p=this.initData),!((d=p)!=null&&d.length))return this.warn("Failed to generate initSegment."),v;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);var E=zi(g,p,this),S=p.audio?E[p.audio.id]:null,T=p.video?E[p.video.id]:null,A=Tn(T,1/0),x=Tn(S,1/0),I=Tn(T,0,!0),k=Tn(S,0,!0),D,b=l,L=0;if(S&&(!T||!h&&x<A||h&&h.trackId===p.audio.id)?(m.trackId=p.audio.id,D=S,L=k-x):T&&(m.trackId=p.video.id,D=T,L=I-A),D){var R=D.timescale;b=D.start/R,m.initPTS=D.start-l*R,m.timescale=R,h||(this.initPTS=h={baseTime:m.initPTS,timescale:R,trackId:m.trackId})}(u||!h)&&(bf(h,b,l,L)||m.timescale!==h.timescale)&&(m.initPTS=b-l,m.timescale=1,h&&h.timescale===1&&this.warn("Adjusting initPTS @"+l+" from "+h.baseTime/h.timescale+" to "+m.initPTS),this.initPTS=h={baseTime:m.initPTS,timescale:1});var C=e?b-h.baseTime/h.timescale:c,B=C+L;L>0?this.lastEndTime=B:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var P=!!p.audio,O=!!p.video,V="";P&&(V+="audio"),O&&(V+="video");var X={data1:g,startPTS:C,startDTS:C,endPTS:B,endDTS:B,type:V,hasAudio:P,hasVideo:O,nb:1,dropped:0};v.audio=P&&!O?X:void 0,v.video=O?X:void 0;var z=T?.sampleCount;if(z){var Q=T.keyFrameIndex,ue=Q!==-1;X.nb=z,X.dropped=Q===0||this.isVideoContiguous?0:ue?Q:z,X.independent=ue,X.firstKeyFrame=Q,ue&&T.keyFrameStart&&(X.firstKeyFramePTS=(T.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(v.independent=ue),this.isVideoContiguous||(this.isVideoContiguous=ue),X.dropped&&this.warn("fmp4 does not start with IDR: firstIDR "+Q+"/"+z+" dropped: "+X.dropped+" start: "+(X.firstKeyFramePTS||"NA"))}return v.initSegment=m,v.id3=_o(i,l,h,h),a.samples.length&&(v.text=Do(a,l,h)),v},o}(Z);function Tn(s,o,n){return n===void 0&&(n=!1),s?.start!==void 0?(s.start+(n?s.duration:0))/s.timescale:o}function bf(s,o,n,r){if(s===null)return!0;var e=Math.max(r,1),t=o-s.baseTime/s.timescale;return Math.abs(t-n)>e}function ko(s,o,n){var r=s?.codec;if(r&&r.length>4)return r;if(o===se.AUDIO){if(r==="ec-3"||r==="ac-3"||r==="alac")return r;if(r==="fLaC"||r==="Opus"){var e=!1;return Wt(r,e)}return n.warn('Unhandled audio codec "'+r+'" in mp4 MAP'),r||"mp4a"}return n.warn('Unhandled video codec "'+r+'" in mp4 MAP'),r||"avc1"}var yr;try{yr=self.performance.now.bind(self.performance)}catch{yr=Date.now}var Sn=[{demux:hf,remux:If},{demux:vf,remux:En},{demux:lf,remux:En},{demux:ff,remux:En}];Sn.splice(2,0,{demux:uf,remux:En});var La=function(){function s(n,r,e,t,i,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=n,this.typeSupported=r,this.config=e,this.id=i,this.logger=a}var o=s.prototype;return o.configure=function(r){this.transmuxConfig=r,this.decrypter&&this.decrypter.reset()},o.push=function(r,e,t,i){var a=this,l=t.transmuxing;l.executeStart=yr();var u=new Uint8Array(r),f=this.currentTransmuxState,d=this.transmuxConfig;i&&(this.currentTransmuxState=i);var h=i||f,c=h.contiguous,v=h.discontinuity,g=h.trackSwitch,m=h.accurateTimeOffset,p=h.timeOffset,E=h.initSegmentChange,S=d.audioCodec,T=d.videoCodec,A=d.defaultInitPts,x=d.duration,I=d.initSegmentData,k=Rf(u,e);if(k&&oi(k.method)){var D=this.getDecrypter(),b=aa(k.method);if(D.isSync()){var L=D.softwareDecrypt(u,k.key.buffer,k.iv.buffer,b),R=t.part>-1;if(R){var C=D.flush();L=C&&C.buffer}if(!L)return l.executeEnd=yr(),Ia(t);u=new Uint8Array(L)}else return this.asyncResult=!0,this.decryptionPromise=D.webCryptoDecrypt(u,k.key.buffer,k.iv.buffer,b).then(function(X){var z=a.push(X,null,t);return a.decryptionPromise=null,z}),this.decryptionPromise}var B=this.needsProbing(v,g);if(B){var P=this.configureTransmuxer(u);if(P)return this.logger.warn("[transmuxer] "+P.message),this.observer.emit(y.ERROR,y.ERROR,{type:Y.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:P,reason:P.message}),l.executeEnd=yr(),Ia(t)}(v||g||E||B)&&this.resetInitSegment(I,S,T,x,e),(v||E||B)&&this.resetInitialTimestamp(A),c||this.resetContiguity();var O=this.transmux(u,k,p,m,t);this.asyncResult=Wr(O);var V=this.currentTransmuxState;return V.contiguous=!0,V.discontinuity=!1,V.trackSwitch=!1,l.executeEnd=yr(),O},o.flush=function(r){var e=this,t=r.transmuxing;t.executeStart=yr();var i=this.decrypter,a=this.currentTransmuxState,l=this.decryptionPromise;if(l)return this.asyncResult=!0,l.then(function(){return e.flush(r)});var u=[],f=a.timeOffset;if(i){var d=i.flush();d&&u.push(this.push(d.buffer,null,r))}var h=this.demuxer,c=this.remuxer;if(!h||!c){t.executeEnd=yr();var v=[Ia(r)];return this.asyncResult?Promise.resolve(v):v}var g=h.flush(f);return Wr(g)?(this.asyncResult=!0,g.then(function(m){return e.flushRemux(u,m,r),u})):(this.flushRemux(u,g,r),this.asyncResult?Promise.resolve(u):u)},o.flushRemux=function(r,e,t){var i=e.audioTrack,a=e.videoTrack,l=e.id3Track,u=e.textTrack,f=this.currentTransmuxState,d=f.accurateTimeOffset,h=f.timeOffset;this.logger.log("[transmuxer.ts]: Flushed "+this.id+" sn: "+t.sn+(t.part>-1?" part: "+t.part:"")+" of "+(this.id===F.MAIN?"level":"track")+" "+t.level);var c=this.remuxer.remux(i,a,l,u,h,d,!0,this.id);r.push({remuxResult:c,chunkMeta:t}),t.transmuxing.executeEnd=yr()},o.resetInitialTimestamp=function(r){var e=this.demuxer,t=this.remuxer;!e||!t||(e.resetTimeStamp(r),t.resetTimeStamp(r))},o.resetContiguity=function(){var r=this.demuxer,e=this.remuxer;!r||!e||(r.resetContiguity(),e.resetNextTimestamp())},o.resetInitSegment=function(r,e,t,i,a){var l=this.demuxer,u=this.remuxer;!l||!u||(l.resetInitSegment(r,e,t,i),u.resetInitSegment(r,e,t,a))},o.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},o.transmux=function(r,e,t,i,a){var l;return e&&e.method==="SAMPLE-AES"?l=this.transmuxSampleAes(r,e,t,i,a):l=this.transmuxUnencrypted(r,t,i,a),l},o.transmuxUnencrypted=function(r,e,t,i){var a=this.demuxer.demux(r,e,!1,!this.config.progressive),l=a.audioTrack,u=a.videoTrack,f=a.id3Track,d=a.textTrack,h=this.remuxer.remux(l,u,f,d,e,t,!1,this.id);return{remuxResult:h,chunkMeta:i}},o.transmuxSampleAes=function(r,e,t,i,a){var l=this;return this.demuxer.demuxSampleAes(r,e,t).then(function(u){var f=l.remuxer.remux(u.audioTrack,u.videoTrack,u.id3Track,u.textTrack,t,i,!1,l.id);return{remuxResult:f,chunkMeta:a}})},o.configureTransmuxer=function(r){for(var e=this.config,t=this.observer,i=this.typeSupported,a,l=0,u=Sn.length;l<u;l++){var f;if((f=Sn[l].demux)!=null&&f.probe(r,this.logger)){a=Sn[l];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");var d=this.demuxer,h=this.remuxer,c=a.remux,v=a.demux;(!h||!(h instanceof c))&&(this.remuxer=new c(t,e,i,this.logger)),(!d||!(d instanceof v))&&(this.demuxer=new v(t,e,i,this.logger),this.probe=v.probe)},o.needsProbing=function(r,e){return!this.demuxer||!this.remuxer||r||e},o.getDecrypter=function(){var r=this.decrypter;return r||(r=this.decrypter=new ra(this.config)),r},s}();function Rf(s,o){var n=null;return s.byteLength>0&&o?.key!=null&&o.iv!==null&&o.method!=null&&(n=o),n}var Ia=function(o){return{remuxResult:{},chunkMeta:o}};function Wr(s){return"then"in s&&s.then instanceof Function}var _f=function(o,n,r,e,t){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=o,this.videoCodec=n,this.initSegmentData=r,this.duration=e,this.defaultInitPts=t||null},Df=function(o,n,r,e,t,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=o,this.contiguous=n,this.accurateTimeOffset=r,this.trackSwitch=e,this.timeOffset=t,this.initSegmentChange=i},ba=[];typeof qe<"u"&&qe&&kf();function kf(){self.addEventListener("message",function(s){var o=s.data,n=o.instanceNo;if(n!==void 0){var r=ba[n];if(o.cmd==="reset"&&(delete ba[o.resetNo],r&&r.destroy(),o.cmd="init"),o.cmd==="init"){var e=JSON.parse(o.config),t=new be;t.on(y.FRAG_DECRYPTED,fi),t.on(y.ERROR,fi);var i=Dt(e.debug,o.id);Cf(i,n),ba[n]=new La(t,o.typeSupported,e,"",o.id,i),fi("init",null,n);return}if(r)switch(o.cmd){case"configure":{r.configure(o.config);break}case"demux":{var a=r.push(o.data,o.decryptdata,o.chunkMeta,o.state);Wr(a)?a.then(function(f){Ra(self,f,n)}).catch(function(f){fi(y.ERROR,{instanceNo:n,type:Y.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:o.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker push error"},n)}):Ra(self,a,n);break}case"flush":{var l=o.chunkMeta,u=r.flush(l);Wr(u)?u.then(function(f){Po(self,f,l,n)}).catch(function(f){fi(y.ERROR,{type:Y.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:o.chunkMeta,fatal:!1,error:f,err:f,reason:"transmuxer-worker flush error"},n)}):Po(self,u,l,n);break}}}})}function Ra(s,o,n){if(Pf(o.remuxResult))return!1;var r=[],e=o.remuxResult,t=e.audio,i=e.video;return t&&Co(r,t),i&&Co(r,i),s.postMessage({event:"transmuxComplete",data:o,instanceNo:n},r),!0}function Co(s,o){o.data1&&s.push(o.data1.buffer),o.data2&&s.push(o.data2.buffer)}function Po(s,o,n,r){var e=o.reduce(function(t,i){return Ra(s,i,r)||t},!1);e||s.postMessage({event:"transmuxComplete",data:o[0],instanceNo:r}),s.postMessage({event:"flush",data:n,instanceNo:r})}function fi(s,o,n){self.postMessage({event:s,data:o,instanceNo:n})}function Cf(s,o){var n=function(t){s[t]=function(){var i=Array.prototype.join.call(arguments," ");fi("workerLog",{logType:t,message:i},o)}};for(var r in s)n(r)}function Pf(s){return!s.audio&&!s.video&&!s.text&&!s.id3&&!s.initSegment}var Fi="1.6.7",di={};function wf(){return typeof Ne=="function"}function Mf(){var s=di[Fi];if(s)return s.clientCount++,s;var o=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+Ne.toString()+")(true);"],{type:"text/javascript"}),n=self.URL.createObjectURL(o),r=new self.Worker(n),e={worker:r,objectURL:n,clientCount:1};return di[Fi]=e,e}function Of(s){var o=di[s];if(o)return o.clientCount++,o;var n=new self.URL(s,self.location.href).href,r=new self.Worker(n),e={worker:r,scriptURL:n,clientCount:1};return di[s]=e,e}function Ff(s){var o=di[s||Fi];if(o){var n=o.clientCount--;if(n===1){var r=o.worker,e=o.objectURL;delete di[s||Fi],e&&self.URL.revokeObjectURL(e),r.terminate()}}}var wo=0,Mo=function(){function s(n,r,e,t){var i=this;this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=wo++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=function(c){var v=c.data,g=i.hls;if(!(!g||!(v!=null&&v.event)||v.instanceNo!==i.instanceNo))switch(v.event){case"init":{var m,p=(m=i.workerContext)==null?void 0:m.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{i.handleTransmuxComplete(v.data);break}case"flush":{i.onFlush(v.data);break}case"workerLog":{g.logger[v.data.logType]&&g.logger[v.data.logType](v.data.message);break}default:{v.data=v.data||{},v.data.frag=i.frag,v.data.part=i.part,v.data.id=i.id,g.trigger(v.event,v.data);break}}},this.onWorkerError=function(c){if(i.hls){var v=new Error(c.message+"  ("+c.filename+":"+c.lineno+")");i.hls.config.enableWorker=!1,i.hls.logger.warn('Error in "'+i.id+'" Web Worker, fallback to inline'),i.hls.trigger(y.ERROR,{type:Y.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:v})}};var a=n.config;this.hls=n,this.id=r,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=e,this.onFlush=t;var l=function(v,g){g=g||{},g.frag=i.frag||void 0,v===y.ERROR&&(g=g,g.parent=i.id,g.part=i.part,i.error=g.error),i.hls.trigger(v,g)};this.observer=new be,this.observer.on(y.FRAG_DECRYPTED,l),this.observer.on(y.ERROR,l);var u=Ji(a.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){var f=this.hls.logger,d=a.workerPath||wf();if(d){try{a.workerPath?(f.log("loading Web Worker "+a.workerPath+' for "'+r+'"'),this.workerContext=Of(a.workerPath)):(f.log('injecting Web Worker for "'+r+'"'),this.workerContext=Mf());var h=this.workerContext.worker;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:r,config:Ke(a)})}catch(c){f.warn('Error setting up "'+r+'" Web Worker, fallback to inline',c),this.terminateWorker(),this.error=null,this.transmuxer=new La(this.observer,u,a,"",r,n.logger)}return}}this.transmuxer=new La(this.observer,u,a,"",r,n.logger)}var o=s.prototype;return o.reset=function(){if(this.frag=null,this.part=null,this.workerContext){var r=this.instanceNo;this.instanceNo=wo++;var e=this.hls.config,t=Ji(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:r,typeSupported:t,id:this.id,config:Ke(e)})}},o.terminateWorker=function(){if(this.workerContext){var r=this.workerContext.worker;this.workerContext=null,r.removeEventListener("message",this.onWorkerMessage),r.removeEventListener("error",this.onWorkerError),Ff(this.hls.config.workerPath)}},o.destroy=function(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{var r=this.transmuxer;r&&(r.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null},o.push=function(r,e,t,i,a,l,u,f,d,h){var c,v,g=this;d.transmuxing.start=self.performance.now();var m=this.instanceNo,p=this.transmuxer,E=l?l.start:a.start,S=a.decryptdata,T=this.frag,A=!(T&&a.cc===T.cc),x=!(T&&d.level===T.level),I=T?d.sn-T.sn:-1,k=this.part?d.part-this.part.index:-1,D=I===0&&d.id>1&&d.id===T?.stats.chunkCount,b=!x&&(I===1||I===0&&(k===1||D&&k<=0)),L=self.performance.now();(x||I||a.stats.parsing.start===0)&&(a.stats.parsing.start=L),l&&(k||!b)&&(l.stats.parsing.start=L);var R=!(T&&((c=a.initSegment)==null?void 0:c.url)===((v=T.initSegment)==null?void 0:v.url)),C=new Df(A,b,f,x,E,R);if(!b||A||R){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for "+a.type+" sn: "+d.sn+(d.part>-1?" part: "+d.part:"")+" "+(this.id===F.MAIN?"level":"track")+": "+d.level+" id: "+d.id+`
        discontinuity: `+A+`
        trackSwitch: `+x+`
        contiguous: `+b+`
        accurateTimeOffset: `+f+`
        timeOffset: `+E+`
        initSegmentChange: `+R);var B=new _f(t,i,e,u,h);this.configureTransmuxer(B)}if(this.frag=a,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:m,cmd:"demux",data:r,decryptdata:S,chunkMeta:d,state:C},r instanceof ArrayBuffer?[r]:[]);else if(p){var P=p.push(r,S,d,C);Wr(P)?P.then(function(O){g.handleTransmuxComplete(O)}).catch(function(O){g.transmuxerError(O,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(P)}},o.flush=function(r){var e=this;r.transmuxing.start=self.performance.now();var t=this.instanceNo,i=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:r});else if(i){var a=i.flush(r);Wr(a)?a.then(function(l){e.handleFlushResult(l,r)}).catch(function(l){e.transmuxerError(l,r,"transmuxer-interface flush error")}):this.handleFlushResult(a,r)}},o.transmuxerError=function(r,e,t){this.hls&&(this.error=r,this.hls.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:r,err:r,reason:t}))},o.handleFlushResult=function(r,e){var t=this;r.forEach(function(i){t.handleTransmuxComplete(i)}),this.onFlush(e)},o.configureTransmuxer=function(r){var e=this.instanceNo,t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:r}):t&&t.configure(r)},o.handleTransmuxComplete=function(r){r.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(r)},s}(),Oo=100,Nf=function(s){function o(r,e,t){var i;return i=s.call(this,r,e,t,"audio-stream-controller",F.AUDIO)||this,i.mainAnchor=null,i.mainFragLoading=null,i.audioOnly=!1,i.bufferedTrack=null,i.switchingTrack=null,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.flushing=!1,i.bufferFlushed=!1,i.cachedTrackLoadedData=null,i.registerListeners(),i}ae(o,s);var n=o.prototype;return n.onHandlerDestroying=function(){this.unregisterListeners(),s.prototype.onHandlerDestroying.call(this),this.resetItem()},n.resetItem=function(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null},n.registerListeners=function(){s.prototype.registerListeners.call(this);var e=this.hls;e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},n.unregisterListeners=function(){var e=this.hls;e&&(s.prototype.unregisterListeners.call(this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this))},n.onInitPtsFound=function(e,t){var i=t.frag,a=t.id,l=t.initPTS,u=t.timescale;if(a===F.MAIN){var f=i.cc,d=this.fragCurrent;if(this.initPTS[f]={baseTime:l,timescale:u},this.log("InitPTS for cc: "+f+" found from main: "+l+"/"+u),this.mainAnchor=i,this.state===M.WAITING_INIT_PTS){var h=this.waitingData;(!h&&!this.loadingParts||h&&h.frag.cc!==f)&&this.syncWithAnchor(i,h?.frag)}else!this.hls.hasEnoughToStart&&d&&d.cc!==f?(d.abortRequests(),this.syncWithAnchor(i,d)):this.state===M.IDLE&&this.tick()}},n.getLoadPosition=function(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:s.prototype.getLoadPosition.call(this)},n.syncWithAnchor=function(e,t){var i,a=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(!(t&&a?.cc===t.cc)){var l=(a||e).cc,u=this.getLevelDetails(),f=this.getLoadPosition(),d=Ts(u,l,f);d&&(this.log("Syncing with main frag at "+d.start+" cc "+d.cc),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===M.IDLE&&this.doTickIdle())}},n.startLoad=function(e,t){if(!this.levels){this.startPosition=e,this.state=M.STOPPED;return}var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(Oo),i>0&&e===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),e=i,this.state=M.IDLE):this.state=M.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()},n.doTick=function(){switch(this.state){case M.IDLE:this.doTickIdle();break;case M.WAITING_TRACK:{var e=this.levels,t=this.trackId,i=e?.[t],a=i?.details;if(a&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(a))break;this.state=M.WAITING_INIT_PTS}break}case M.FRAG_LOADING_WAITING_RETRY:{var l,u=performance.now(),f=this.retryDate;if(!f||u>=f||(l=this.media)!=null&&l.seeking){var d=this.levels,h=this.trackId;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(d?.[h]||null),this.state=M.IDLE}break}case M.WAITING_INIT_PTS:{var c=this.waitingData;if(c){var v=c.frag,g=c.part,m=c.cache,p=c.complete,E=this.mainAnchor;if(this.initPTS[v.cc]!==void 0){this.waitingData=null,this.state=M.FRAG_LOADING;var S=m.flush().buffer,T={frag:v,part:g,payload:S,networkDetails:null};this._handleFragmentLoadProgress(T),p&&s.prototype._handleFragmentLoadComplete.call(this,T)}else E&&E.cc!==c.frag.cc&&this.syncWithAnchor(E,c.frag)}else this.state=M.IDLE}}this.onTickEnd()},n.resetLoadingState=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),s.prototype.resetLoadingState.call(this)},n.onTickEnd=function(){var e=this.media;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)},n.doTickIdle=function(){var e,t=this.hls,i=this.levels,a=this.media,l=this.trackId,u=t.config;if(!(!this.buffering||!a&&!this.primaryPrefetch&&(this.startFragRequested||!u.startFragPrefetch)||!(i!=null&&i[l]))){var f=i[l],d=f.details;if(!d||this.waitForLive(f)||this.waitForCdnTuneIn(d)){this.state=M.WAITING_TRACK,this.startFragRequested=!1;return}var h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,se.AUDIO,F.AUDIO));var c=this.getFwdBufferInfo(h,F.AUDIO);if(c!==null){if(!this.switchingTrack&&this._streamEnded(c,d)){t.trigger(y.BUFFER_EOS,{type:"audio"}),this.state=M.ENDED;return}var v=c.len,g=t.maxBufferLength,m=d.fragments,p=m[0].start,E=this.getLoadPosition(),S=this.flushing?E:c.end;if(this.switchingTrack&&a){var T=E;d.PTSKnown&&T<p&&(c.end>p||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),a.currentTime=p+.05)}if(!(v>=g&&!this.switchingTrack&&S<m[m.length-1].start)){var A=this.getNextFragment(S,d);if(A&&this.isLoopLoading(A,S)&&(A=this.getNextFragmentLoopLoading(A,d,c,F.MAIN,g)),!A){this.bufferFlushed=!0;return}var x=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&x&&Ue(A)&&!A.endList&&(!d.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(x)===ot.OK&&(this.mainFragLoading=x=null),x&&Ue(x))){if(A.start>x.end){var I=this.fragmentTracker.getFragAtPos(S,F.MAIN);I&&I.end>x.end&&(x=I,this.mainFragLoading={frag:I,targetBufferTime:null})}var k=A.start>x.end;if(k)return}this.loadFragment(A,f,S)}}}},n.onMediaDetaching=function(e,t){this.bufferFlushed=this.flushing=!1,s.prototype.onMediaDetaching.call(this,e,t)},n.onAudioTracksUpdated=function(e,t){var i=t.audioTracks;this.resetTransmuxer(),this.levels=i.map(function(a){return new Di(a)})},n.onAudioTrackSwitching=function(e,t){var i=!!t.url;this.trackId=t.id;var a=this.fragCurrent;a&&(a.abortRequests(),this.removeUnbufferedFrags(a.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==M.STOPPED&&(this.setInterval(Oo),this.state=M.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())},n.onManifestLoading=function(){s.prototype.onManifestLoading.call(this),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1},n.onLevelLoaded=function(e,t){this.mainDetails=t.details;var i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(y.AUDIO_TRACK_LOADED,i))},n.onAudioTrackLoaded=function(e,t){var i,a=this.levels,l=t.details,u=t.id,f=t.groupId,d=t.track;if(!a){this.warn("Audio tracks reset while loading track "+u+' "'+d.name+'" of "'+f+'"');return}var h=this.mainDetails;if(!h||l.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=t,this.state!==M.STOPPED&&(this.state=M.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log("Audio track "+u+' "'+d.name+'" of "'+f+'" loaded ['+l.startSN+","+l.endSN+"]"+(l.lastPartSn?"[part-"+l.lastPartSn+"-"+l.lastPartIndex+"]":"")+",duration:"+l.totalduration);var c=a[u],v=0;if(l.live||(i=c.details)!=null&&i.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(c.details){var g;v=this.alignPlaylists(l,c.details,(g=this.levelLastLoaded)==null?void 0:g.details)}l.alignedSliding||(no(l,h),l.alignedSliding||vn(l,h),v=l.fragmentStart)}c.details=l,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(h,v),this.hls.trigger(y.AUDIO_TRACK_UPDATED,{details:l,id:u,groupId:t.groupId}),this.state===M.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=M.IDLE),this.tick()},n._handleFragmentLoadProgress=function(e){var t,i=e.frag,a=e.part,l=e.payload,u=this.config,f=this.trackId,d=this.levels;if(!d){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var h=d[f];if(!h){this.warn("Audio track is undefined on fragment load progress");return}var c=h.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}var v=u.defaultAudioCodec||h.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new Mo(this.hls,F.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var m=this.initPTS[i.cc],p=(t=i.initSegment)==null?void 0:t.data;if(m!==void 0){var E=!1,S=a?a.index:-1,T=S!==-1,A=new ia(i.level,i.sn,i.stats.chunkCount,l.byteLength,S,T);g.push(l,p,v,"",i,a,c.totalduration,E,A,m)}else{this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+f);var x=this.waitingData=this.waitingData||{frag:i,part:a,cache:new so,complete:!1},I=x.cache;I.push(new Uint8Array(l)),this.state!==M.STOPPED&&(this.state=M.WAITING_INIT_PTS)}},n._handleFragmentLoadComplete=function(e){if(this.waitingData){this.waitingData.complete=!0;return}s.prototype._handleFragmentLoadComplete.call(this,e)},n.onBufferReset=function(){this.mediaBuffer=null},n.onBufferCreated=function(e,t){this.bufferFlushed=this.flushing=!1;var i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)},n.onFragLoading=function(e,t){!this.audioOnly&&t.frag.type===F.MAIN&&Ue(t.frag)&&(this.mainFragLoading=t,this.state===M.IDLE&&this.tick())},n.onFragBuffered=function(e,t){var i=t.frag,a=t.part;if(i.type!==F.AUDIO){!this.audioOnly&&i.type===F.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(a?" p: "+a.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));return}if(Ue(i)){this.fragPrevious=i;var l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(y.AUDIO_TRACK_SWITCHED,Ee({},l)))}this.fragBufferedComplete(i,a),this.media&&this.tick()},n.onError=function(e,t){var i;if(t.fatal){this.state=M.ERROR;return}switch(t.details){case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.AUDIO,t);break;case _.AUDIO_TRACK_LOAD_ERROR:case _.AUDIO_TRACK_LOAD_TIMEOUT:case _.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===M.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===N.AUDIO_TRACK&&(this.state=M.IDLE);break;case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case _.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case _.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}},n.onBufferFlushing=function(e,t){var i=t.type;i!==se.VIDEO&&(this.flushing=!0)},n.onBufferFlushed=function(e,t){var i=t.type;if(i!==se.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===M.ENDED&&(this.state=M.IDLE);var a=this.mediaBuffer||this.media;a&&(this.afterBufferFlushed(a,i,F.AUDIO),this.tick())}},n._handleTransmuxComplete=function(e){var t,i="audio",a=this.hls,l=e.remuxResult,u=e.chunkMeta,f=this.getCurrentContext(u);if(!f){this.resetWhenMissingContext(u);return}var d=f.frag,h=f.part,c=f.level,v=c.details,g=l.audio,m=l.text,p=l.id3,E=l.initSegment;if(this.fragContextChanged(d)||!v){this.fragmentTracker.removeFragment(d);return}if(this.state=M.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){var S=d.initSegment||d;this._bufferInitSegment(c,E.tracks,S,u),a.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:i,tracks:E.tracks})}if(g){var T=g.startPTS,A=g.endPTS,x=g.startDTS,I=g.endDTS;h&&(h.elementaryStreams[se.AUDIO]={startPTS:T,endPTS:A,startDTS:x,endDTS:I}),d.setElementaryStreamInfo(se.AUDIO,T,A,x,I),this.bufferFragmentData(g,d,h,u)}if(p!=null&&(t=p.samples)!=null&&t.length){var k=re({id:i,frag:d,details:v},p);a.trigger(y.FRAG_PARSING_METADATA,k)}if(m){var D=re({id:i,frag:d,details:v},m);a.trigger(y.FRAG_PARSING_USERDATA,D)}},n._bufferInitSegment=function(e,t,i,a){if(this.state===M.PARSING&&(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!!t.audio)){var l=t.audio;l.id=F.AUDIO;var u=e.audioCodec;this.log("Init audio buffer, container:"+l.container+", codecs[level/parsed]=["+u+"/"+l.codec+"]"),u&&u.split(",").length===1&&(l.levelCodec=u),this.hls.trigger(y.BUFFER_CODECS,t);var f=l.initSegment;if(f!=null&&f.byteLength){var d={type:"audio",frag:i,part:null,chunkMeta:a,parent:i.type,data:f};this.hls.trigger(y.BUFFER_APPENDING,d)}this.tickImmediate()}},n.loadFragment=function(e,t,i){var a=this.fragmentTracker.getState(e);if(this.switchingTrack||a===ot.NOT_LOADED||a===ot.PARTIAL){var l;if(!Ue(e))this._loadInitSegment(e,t);else if((l=t.details)!=null&&l.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=M.WAITING_INIT_PTS;var u=this.mainDetails;u&&u.fragmentStart!==t.details.fragmentStart&&vn(t.details,u)}else s.prototype.loadFragment.call(this,e,t,i)}else this.clearTrackerIfNeeded(e)},n.flushAudioIfNeeded=function(e){if(this.media&&this.bufferedTrack){var t=this.bufferedTrack,i=t.name,a=t.lang,l=t.assocLang,u=t.characteristics,f=t.audioCodec,d=t.channels;Kr({name:i,lang:a,assocLang:l,characteristics:u,audioCodec:f,channels:d},e,Hr)||(sn(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}},n.completeAudioSwitch=function(e){var t=this.hls;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(y.AUDIO_TRACK_SWITCHED,Ee({},e))},o}(ha),_a=function(s){function o(r,e){var t;return t=s.call(this,e,r.logger)||this,t.hls=void 0,t.canLoad=!1,t.timer=-1,t.hls=r,t}ae(o,s);var n=o.prototype;return n.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},n.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},n.startLoad=function(){this.canLoad=!0,this.loadPlaylist()},n.stopLoad=function(){this.canLoad=!1,this.clearTimer()},n.switchParams=function(e,t,i){var a=t?.renditionReports;if(a){for(var l=-1,u=0;u<a.length;u++){var f=a[u],d=void 0;try{d=new self.URL(f.URI,t.url).href}catch(p){this.warn("Could not construct new URL for Rendition Report: "+p),d=f.URI||""}if(d===e){l=u;break}else d===e.substring(0,d.length)&&(l=u)}if(l!==-1){var h=a[l],c=parseInt(h["LAST-MSN"])||t?.lastPartSn,v=parseInt(h["LAST-PART"])||t?.lastPartIndex;if(this.hls.config.lowLatencyMode){var g=Math.min(t.age-t.partTarget,t.targetduration);v>=0&&g>t.partTarget&&(v+=1)}var m=i&&nn(i);return new an(c,v>=0?v:void 0,m)}}},n.loadPlaylist=function(e){this.clearTimer()},n.loadingPlaylist=function(e,t){this.clearTimer()},n.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},n.getUrlWithDirectives=function(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}return e},n.playlistLoaded=function(e,t,i){var a=t.details,l=t.stats,u=self.performance.now(),f=l.loading.first?Math.max(0,u-l.loading.first):0;a.advancedDateTime=Date.now()-f;var d=this.hls.config.timelineOffset;if(d!==a.appliedTimelineOffset){var h=Math.max(d||0,0);a.appliedTimelineOffset=h,a.fragments.forEach(function(Q){Q.start=Q.playlistOffset+h})}if(a.live||i!=null&&i.live){var c="levelInfo"in t?t.levelInfo:t.track;if(a.reloaded(i),i&&a.fragments.length>0){Du(i,a);var v=a.playlistParsingError;if(v){this.warn(v);var g=this.hls;if(!g.config.ignorePlaylistParsingErrors){var m,p=t.networkDetails;g.trigger(y.ERROR,{type:Y.NETWORK_ERROR,details:_.LEVEL_PARSING_ERROR,fatal:!1,url:a.url,error:v,reason:v.message,level:t.level||void 0,parent:(m=a.fragments[0])==null?void 0:m.type,networkDetails:p,stats:l});return}a.playlistParsingError=null}}a.requestScheduled===-1&&(a.requestScheduled=l.loading.start);var E=this.hls.mainForwardBufferInfo,S=E?E.end-E.len:0,T=(a.edge-S)*1e3,A=$s(a,T);if(a.requestScheduled+A<u?a.requestScheduled=u:a.requestScheduled+=A,this.log("live playlist "+e+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:a.updated?"UPDATED":"MISSED")),!this.canLoad||!a.live)return;var x,I=void 0,k=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var D=this.hls.config.lowLatencyMode,b=a.lastPartSn,L=a.endSN,R=a.lastPartIndex,C=R!==-1,B=b===L;C?B?(I=L+1,k=D?0:R):(I=b,k=D?R+1:a.maxPartIndex):I=L+1;var P=a.age,O=P+a.ageHeader,V=Math.min(O-a.partTarget,a.targetduration*1.5);if(V>0){if(O>a.targetduration*3)this.log("Playlist last advanced "+P.toFixed(2)+"s ago. Omitting segment and part directives."),I=void 0,k=void 0;else if(i!=null&&i.tuneInGoal&&O-a.partTarget>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+V+" with playlist age: "+a.age),V=0;else{var X=Math.floor(V/a.targetduration);if(I+=X,k!==void 0){var z=Math.round(V%a.targetduration/a.partTarget);k+=z}this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+P.toFixed(2)+"s goal: "+V+" skip sn "+X+" to part "+k)}a.tuneInGoal=V}if(x=this.getDeliveryDirectives(a,t.deliveryDirectives,I,k),D||!B){a.requestScheduled=u,this.loadingPlaylist(c,x);return}}else(a.canBlockReload||a.canSkipUntil)&&(x=this.getDeliveryDirectives(a,t.deliveryDirectives,I,k));x&&I!==void 0&&a.canBlockReload&&(a.requestScheduled=l.loading.first+Math.max(A-f*2,A/2)),this.scheduleLoading(c,x,a)}else this.clearTimer()},n.scheduleLoading=function(e,t,i){var a=this,l=i||e.details;if(!l){this.loadingPlaylist(e,t);return}var u=self.performance.now(),f=l.requestScheduled;if(u>=f){this.loadingPlaylist(e,t);return}var d=f-u;this.log("reload live playlist "+(e.name||e.bitrate+"bps")+" in "+Math.round(d)+" ms"),this.clearTimer(),this.timer=self.setTimeout(function(){return a.loadingPlaylist(e,t)},d)},n.getDeliveryDirectives=function(e,t,i,a){var l=nn(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,a=t.part,l=ai.No),new an(i,a,l)},n.checkRetry=function(e){var t=this,i=e.details,a=on(e),l=e.errorAction,u=l||{},f=u.action,d=u.retryCount,h=d===void 0?0:d,c=u.retryConfig,v=!!l&&!!c&&(f===xt.RetryRequest||!l.resolved&&f===xt.SendAlternateToPenaltyBox);if(v){var g;if(h>=c.maxNumRetry)return!1;if(a&&(g=e.context)!=null&&g.deliveryDirectives)this.warn("Retrying playlist loading "+(h+1)+"/"+c.maxNumRetry+' after "'+i+'" without delivery-directives'),this.loadPlaylist();else{var m=ta(c,h);this.clearTimer(),this.timer=self.setTimeout(function(){return t.loadPlaylist()},m),this.warn("Retrying playlist loading "+(h+1)+"/"+c.maxNumRetry+' after "'+i+'" in '+m+"ms")}e.levelRetry=!0,l.resolved=!0}return v},o}(Z);function Fo(s,o){if(s.length!==o.length)return!1;for(var n=0;n<s.length;n++)if(!Ni(s[n].attrs,o[n].attrs))return!1;return!0}function Ni(s,o,n){var r=s["STABLE-RENDITION-ID"];return r&&!n?r===o["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(function(e){return s[e]!==o[e]})}function Da(s,o){return o.label.toLowerCase()===s.name.toLowerCase()&&(!o.language||o.language.toLowerCase()===(s.lang||"").toLowerCase())}var Uf=function(s){function o(r){var e;return e=s.call(this,r,"audio-track-controller")||this,e.tracks=[],e.groupIds=null,e.tracksInGroup=[],e.trackId=-1,e.currentTrack=null,e.selectDefaultTrack=!0,e.registerListeners(),e}ae(o,s);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,s.prototype.destroy.call(this)},n.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(e,t){this.tracks=t.audioTracks||[]},n.onAudioTrackLoaded=function(e,t){var i=t.id,a=t.groupId,l=t.details,u=this.tracksInGroup[i];if(!u||u.groupId!==a){this.warn("Audio track with id:"+i+" and group:"+a+" not found in active group "+u?.groupId);return}var f=u.details;u.details=t.details,this.log("Audio track "+i+' "'+u.name+'" lang:'+u.lang+" group:"+a+" loaded ["+l.startSN+"-"+l.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,t,f)},n.onLevelLoading=function(e,t){this.switchLevel(t.level)},n.onLevelSwitching=function(e,t){this.switchLevel(t.level)},n.switchLevel=function(e){var t=this.hls.levels[e];if(t){var i=t.audioGroups||null,a=this.groupIds,l=this.currentTrack;if(!i||a?.length!==i?.length||i!=null&&i.some(function(E){return a?.indexOf(E)===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var u=this.tracks.filter(function(E){return!i||i.indexOf(E.groupId)!==-1});if(u.length)this.selectDefaultTrack&&!u.some(function(E){return E.default})&&(this.selectDefaultTrack=!1),u.forEach(function(E,S){E.id=S});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=u;var f=this.hls.config.audioPreference;if(!l&&f){var d=fr(f,u,Hr);if(d>-1)l=u[d];else{var h=fr(f,this.tracks);l=this.tracks[h]}}var c=this.findTrackId(l);c===-1&&l&&(c=this.findTrackId(null));var v={audioTracks:u};this.log("Updating audio tracks, "+u.length+" track(s) found in group(s): "+i?.join(",")),this.hls.trigger(y.AUDIO_TRACKS_UPDATED,v);var g=this.trackId;if(c!==-1&&g===-1)this.setAudioTrack(c);else if(u.length&&g===-1){var m,p=new Error("No audio track selected for current audio group-ID(s): "+((m=this.groupIds)==null?void 0:m.join(","))+" track count: "+u.length);this.warn(p.message),this.hls.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}}},n.onError=function(e,t){t.fatal||!t.context||t.context.type===N.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)},n.setAudioOption=function(e){var t=this.hls;if(t.config.audioPreference=e,e){var i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){var a=this.currentTrack;if(a&&Kr(e,a,Hr))return a;var l=fr(e,this.tracksInGroup,Hr);if(l>-1){var u=this.tracksInGroup[l];return this.setAudioTrack(l),u}else if(a){var f=t.loadLevel;f===-1&&(f=t.firstAutoLevel);var d=Xl(e,t.levels,i,f,Hr);if(d===-1)return null;t.nextLoadLevel=d}if(e.channels||e.audioCodec){var h=fr(e,i);if(h>-1)return i[h]}}}return null},n.setAudioTrack=function(e){var t=this.tracksInGroup;if(e<0||e>=t.length){this.warn("Invalid audio track id: "+e);return}this.selectDefaultTrack=!1;var i=this.currentTrack,a=t[e],l=a.details&&!a.details.live;if(!(e===this.trackId&&a===i&&l)&&(this.log("Switching to audio-track "+e+' "'+a.name+'" lang:'+a.lang+" group:"+a.groupId+" channels:"+a.channels),this.trackId=e,this.currentTrack=a,this.hls.trigger(y.AUDIO_TRACK_SWITCHING,Ee({},a)),!l)){var u=this.switchParams(a.url,i?.details,a.details);this.loadPlaylist(u)}},n.findTrackId=function(e){for(var t=this.tracksInGroup,i=0;i<t.length;i++){var a=t[i];if(!(this.selectDefaultTrack&&!a.default)&&(!e||Kr(e,a,Hr)))return i}if(e){for(var l=e.name,u=e.lang,f=e.assocLang,d=e.characteristics,h=e.audioCodec,c=e.channels,v=0;v<t.length;v++){var g=t[v];if(Kr({name:l,lang:u,assocLang:f,characteristics:d,audioCodec:h,channels:c},g,Hr))return v}for(var m=0;m<t.length;m++){var p=t[m];if(Ni(e.attrs,p.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return m}for(var E=0;E<t.length;E++){var S=t[E];if(Ni(e.attrs,S.attrs,["LANGUAGE"]))return E}}return-1},n.loadPlaylist=function(e){s.prototype.loadPlaylist.call(this);var t=this.currentTrack;this.shouldLoadPlaylist(t)&&sn(t.url,this.hls)&&this.scheduleLoading(t,e)},n.loadingPlaylist=function(e,t){s.prototype.loadingPlaylist.call(this,e,t);var i=e.id,a=e.groupId,l=this.getUrlWithDirectives(e.url,t),u=e.details,f=u?.age;this.log("Loading audio-track "+i+' "'+e.name+'" lang:'+e.lang+" group:"+a+(t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+l),this.hls.trigger(y.AUDIO_TRACK_LOADING,{url:l,id:i,groupId:a,deliveryDirectives:t||null,track:e})},W(o,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}])}(_a),Bf=function(){function s(n){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=n}var o=s.prototype;return o.destroy=function(){this.tracks=this.queues=null},o.append=function(r,e,t){if(!(this.queues===null||this.tracks===null)){var i=this.queues[e];i.push(r),i.length===1&&!t&&this.executeNext(e)}},o.appendBlocker=function(r){var e=this;return new Promise(function(t){var i={label:"async-blocker",execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};e.append(i,r)})},o.prependBlocker=function(r){var e=this;return new Promise(function(t){if(e.queues){var i={label:"async-blocker-prepend",execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};e.queues[r].unshift(i)}})},o.removeBlockers=function(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(function(r){var e,t=(e=r[0])==null?void 0:e.label;(t==="async-blocker"||t==="async-blocker-prepend")&&(r[0].execute(),r.splice(0,1))})},o.unblockAudio=function(r){if(this.queues!==null){var e=this.queues.audio;e[0]===r&&this.shiftAndExecuteNext("audio")}},o.executeNext=function(r){if(!(this.queues===null||this.tracks===null)){var e=this.queues[r];if(e.length){var t=e[0];try{t.execute()}catch(l){var i;if(t.onError(l),this.queues===null||this.tracks===null)return;var a=(i=this.tracks[r])==null?void 0:i.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(r)}}}},o.shiftAndExecuteNext=function(r){this.queues!==null&&(this.queues[r].shift(),this.executeNext(r))},o.current=function(r){var e;return((e=this.queues)==null?void 0:e[r][0])||null},o.toString=function(){var r=this.queues,e=this.tracks;return r===null||e===null?"<destroyed>":`
`+this.list("video")+`
`+this.list("audio")+`
`+this.list("audiovideo")+"}"},o.list=function(r){var e,t;return(e=this.queues)!=null&&e[r]||(t=this.tracks)!=null&&t[r]?r+": ("+this.listSbInfo(r)+") "+this.listOps(r):""},o.listSbInfo=function(r){var e,t=(e=this.tracks)==null?void 0:e[r],i=t?.buffer;return i?"SourceBuffer"+(i.updating?" updating":"")+(t.ended?" ended":"")+(t.ending?" ending":""):"none"},o.listOps=function(r){var e;return((e=this.queues)==null?void 0:e[r].map(function(t){return t.label}).join(", "))||""},s}(),No=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Uo="HlsJsTrackRemovedError",Gf=function(s){function o(n){var r;return r=s.call(this,n)||this,r.name=Uo,r}return ae(o,s),o}(Xe(Error)),Kf=function(s){function o(r,e){var t;return t=s.call(this,"buffer-controller",r.logger)||this,t.hls=void 0,t.fragmentTracker=void 0,t.details=null,t._objectUrl=null,t.operationQueue=null,t.bufferCodecEventsTotal=0,t.media=null,t.mediaSource=null,t.lastMpegAudioChunk=null,t.blockedAudioAppend=null,t.lastVideoAppendEnd=0,t.appendSource=void 0,t.transferData=void 0,t.overrides=void 0,t.appendErrors={audio:0,video:0,audiovideo:0},t.tracks={},t.sourceBuffers=[[null,null],[null,null]],t._onEndStreaming=function(i){var a;t.hls&&((a=t.mediaSource)==null?void 0:a.readyState)==="open"&&t.hls.pauseBuffering()},t._onStartStreaming=function(i){t.hls&&t.hls.resumeBuffering()},t._onMediaSourceOpen=function(i){var a=t,l=a.media,u=a.mediaSource;i&&t.log("Media source opened"),!(!l||!u)&&(u.removeEventListener("sourceopen",t._onMediaSourceOpen),l.removeEventListener("emptied",t._onMediaEmptied),t.updateDuration(),t.hls.trigger(y.MEDIA_ATTACHED,{media:l,mediaSource:u}),t.mediaSource!==null&&t.checkPendingTracks())},t._onMediaSourceClose=function(){t.log("Media source closed")},t._onMediaSourceEnded=function(){t.log("Media source ended")},t._onMediaEmptied=function(){var i=t,a=i.mediaSrc,l=i._objectUrl;a!==l&&t.error("Media element src was set while attaching MediaSource ("+l+" > "+a+")")},t.hls=r,t.fragmentTracker=e,t.appendSource=Fe(Ie(r.config.preferManagedMediaSource)),t.initTracks(),t.registerListeners(),t}ae(o,s);var n=o.prototype;return n.hasSourceTypes=function(){return Object.keys(this.tracks).length>0},n.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null},n.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_APPENDING,this.onBufferAppending,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.BUFFER_EOS,this.onBufferEos,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.FRAG_PARSED,this.onFragParsed,this),e.on(y.FRAG_CHANGED,this.onFragChanged,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_APPENDING,this.onBufferAppending,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_EOS,this.onBufferEos,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.FRAG_PARSED,this.onFragParsed,this),e.off(y.FRAG_CHANGED,this.onFragChanged,this),e.off(y.ERROR,this.onError,this)},n.transferMedia=function(){var e=this,t=this.media,i=this.mediaSource;if(!t)return null;var a={};if(this.operationQueue){var l=this.isUpdating();l||this.operationQueue.removeBlockers();var u=this.isQueued();(l||u)&&this.warn("Transfering MediaSource with"+(u?" operations in queue":"")+(l?" updating SourceBuffer(s)":"")+" "+this.operationQueue),this.operationQueue.destroy()}var f=this.transferData;return!this.sourceBufferCount&&f&&f.mediaSource===i?re(a,f.tracks):this.sourceBuffers.forEach(function(d){var h=d[0];h&&(a[h]=re({},e.tracks[h]),e.removeBuffer(h)),d[0]=d[1]=null}),{media:t,mediaSource:i,tracks:a}},n.initTracks=function(){var e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0},n.onManifestLoading=function(){this.bufferCodecEventsTotal=0,this.details=null},n.onManifestParsed=function(e,t){var i,a=2;(t.audio&&!t.video||!t.altAudio)&&(a=1),this.bufferCodecEventsTotal=a,this.log(a+" bufferCodec event(s) expected."),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&a&&this.bufferCreated()},n.onMediaAttaching=function(e,t){var i=this.media=t.media,a=Ie(this.appendSource);if(this.transferData=this.overrides=void 0,i&&a){var l=!!t.mediaSource;(l||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);var u=this.mediaSource=t.mediaSource||new a;if(this.assignMediaSource(u),l)this._objectUrl=i.src,this.attachTransferred();else{var f=this._objectUrl=self.URL.createObjectURL(u);if(this.appendSource)try{i.removeAttribute("src");var d=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||d&&u instanceof d,Bo(i),Hf(i,f),i.load()}catch{i.src=f}else i.src=f}i.addEventListener("emptied",this._onMediaEmptied)}},n.assignMediaSource=function(e){var t,i;this.log((((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created")+" media source: "+((i=e.constructor)==null?void 0:i.name)),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))},n.attachTransferred=function(){var e=this,t=this.media,i=this.transferData;if(!(!i||!t)){var a=this.tracks,l=i.tracks,u=l?Object.keys(l):null,f=u?u.length:0,d=function(){e.media&&e.mediaSourceOpenOrEnded&&e._onMediaSourceOpen()};if(l&&u&&f){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log("attachTransferred: (bufferCodecEventsTotal "+this.bufferCodecEventsTotal+`)
required tracks: `+Ke(a,function(g,m){return g==="initSegment"?void 0:m})+`;
transfer tracks: `+Ke(l,function(g,m){return g==="initSegment"?void 0:m})+"}"),!st(l,a)){i.mediaSource=null,i.tracks=void 0;var h=t.currentTime,c=this.details,v=Math.max(h,c?.fragments[0].start||0);if(v-h>1){this.log("attachTransferred: waiting for playback to reach new tracks start time "+h+" -> "+v);return}this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'+Object.keys(l)+'"->"'+Object.keys(a)+'") start time: '+v+" currentTime: "+h),this.onMediaDetaching(y.MEDIA_DETACHING,{}),this.onMediaAttaching(y.MEDIA_ATTACHING,i),t.currentTime=v;return}this.transferData=void 0,u.forEach(function(g){var m=g,p=l[m];if(p){var E=p.buffer;if(E){var S=e.fragmentTracker,T=p.id;if(S.hasFragments(T)||S.hasParts(T)){var A=Ae.getBuffered(E);S.detectEvictedFragments(m,A,T,null,!0)}var x=ka(m),I=[m,E];e.sourceBuffers[x]=I,E.updating&&e.operationQueue&&e.operationQueue.prependBlocker(m),e.trackSourceBuffer(m,p)}}}),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}},n.onMediaDetaching=function(e,t){var i=this,a=!!t.transferMedia;this.transferData=this.overrides=void 0;var l=this.media,u=this.mediaSource,f=this._objectUrl;if(u){if(this.log("media source "+(a?"transferring":"detaching")),a)this.sourceBuffers.forEach(function(v){var g=v[0];g&&i.removeBuffer(g)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){var d=u.readyState==="open";try{for(var h=u.sourceBuffers,c=h.length;c--;)d&&h[c].abort(),u.removeSourceBuffer(h[c]);d&&u.endOfStream()}catch(v){this.warn("onMediaDetaching: "+v.message+" while calling endOfStream")}}this.sourceBufferCount&&this.onBufferReset()}u.removeEventListener("sourceopen",this._onMediaSourceOpen),u.removeEventListener("sourceended",this._onMediaSourceEnded),u.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(u.removeEventListener("startstreaming",this._onStartStreaming),u.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}l&&(l.removeEventListener("emptied",this._onMediaEmptied),a||(f&&self.URL.revokeObjectURL(f),this.mediaSrc===f?(l.removeAttribute("src"),this.appendSource&&Bo(l),l.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(y.MEDIA_DETACHED,t)},n.onBufferReset=function(){var e=this;this.sourceBuffers.forEach(function(t){var i=t[0];i&&e.resetBuffer(i)}),this.initTracks()},n.resetBuffer=function(e){var t,i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var a;(a=this.mediaSource)!=null&&a.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(l){this.warn("onBufferReset "+e,l)}delete this.tracks[e]},n.removeBuffer=function(e){this.removeBufferListeners(e),this.sourceBuffers[ka(e)]=[null,null];var t=this.tracks[e];t&&(t.buffer=void 0)},n.resetQueue=function(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Bf(this.tracks)},n.onBufferCodecs=function(e,t){var i=this,a=this.tracks,l=Object.keys(t);this.log('BUFFER_CODECS: "'+l+'" (current SB count '+this.sourceBufferCount+")");var u="audiovideo"in t&&(a.audio||a.video)||a.audiovideo&&("audio"in t||"video"in t),f=!u&&this.sourceBufferCount&&this.media&&l.some(function(d){return!a[d]});if(u||f){this.warn('Unsupported transition between "'+Object.keys(a)+'" and "'+l+'" SourceBuffers');return}l.forEach(function(d){var h,c,v,g=t[d],m=g.id,p=g.codec,E=g.levelCodec,S=g.container,T=g.metadata,A=g.supplemental,x=a[d],I=(h=i.transferData)==null||(c=h.tracks)==null?void 0:c[d],k=I!=null&&I.buffer?I:x,D=k?.pendingCodec||k?.codec,b=k?.levelCodec;x||(x=a[d]={buffer:void 0,listeners:[],codec:p,supplemental:A,container:S,levelCodec:E,metadata:T,id:m});var L=er(D,b),R=L?.replace(No,"$1"),C=er(p,E),B=(v=C)==null?void 0:v.replace(No,"$1");C&&L&&R!==B&&(d.slice(0,5)==="audio"&&(C=Wt(C,i.appendSource)),i.log("switching codec "+D+" to "+C),C!==(x.pendingCodec||x.codec)&&(x.pendingCodec=C),x.container=S,i.appendChangeType(d,S,C))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()},n.appendChangeType=function(e,t,i){var a=this,l=t+";codecs="+i,u={label:"change-type="+l,execute:function(){var d=a.tracks[e];if(d){var h=d.buffer;h!=null&&h.changeType&&(a.log("changing "+e+" sourceBuffer type to "+l),h.changeType(l),d.codec=i,d.container=t)}a.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(d){a.warn("Failed to change "+e+" SourceBuffer type",d)}};this.append(u,e,this.isPending(this.tracks[e]))},n.blockAudio=function(e){var t,i=this,a=e.start,l=a+e.duration*.05,u=((t=this.fragmentTracker.getAppendedFrag(a,F.MAIN))==null?void 0:t.gap)===!0;if(!u){var f={label:"block-audio",execute:function(){var h,c=i.tracks.video;(i.lastVideoAppendEnd>l||c!=null&&c.buffer&&Ae.isBuffered(c.buffer,l)||((h=i.fragmentTracker.getAppendedFrag(l,F.MAIN))==null?void 0:h.gap)===!0)&&(i.blockedAudioAppend=null,i.shiftAndExecuteNext("audio"))},onStart:function(){},onComplete:function(){},onError:function(h){i.warn("Error executing block-audio operation",h)}};this.blockedAudioAppend={op:f,frag:e},this.append(f,"audio",!0)}},n.unblockAudio=function(){var e=this.blockedAudioAppend,t=this.operationQueue;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))},n.onBufferAppending=function(e,t){var i=this,a=this.tracks,l=t.data,u=t.type,f=t.parent,d=t.frag,h=t.part,c=t.chunkMeta,v=t.offset,g=c.buffering[u],m=d.sn,p=d.cc,E=self.performance.now();g.start=E;var S=d.stats.buffering,T=h?h.stats.buffering:null;S.start===0&&(S.start=E),T&&T.start===0&&(T.start=E);var A=a.audio,x=!1;u==="audio"&&A?.container==="audio/mpeg"&&(x=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var I=a.video,k=I?.buffer;if(k&&m!=="initSegment"){var D=h||d,b=this.blockedAudioAppend;if(u==="audio"&&f!=="main"&&!this.blockedAudioAppend){var L=D.start,R=L+D.duration*.05,C=k.buffered,B=this.currentOp("video");!C.length&&!B?this.blockAudio(D):!B&&!Ae.isBuffered(k,R)&&this.lastVideoAppendEnd<R&&this.blockAudio(D)}else if(u==="video"){var P=D.end;if(b){var O=b.frag.start;(P>O||P<this.lastVideoAppendEnd||Ae.isBuffered(k,O))&&this.unblockAudio()}this.lastVideoAppendEnd=P}}var V=(h||d).start,X={label:"append-"+u,execute:function(){var Q;g.executeStart=self.performance.now();var ue=(Q=i.tracks[u])==null?void 0:Q.buffer;ue&&(x?i.updateTimestampOffset(ue,V,.1,u,m,p):v!==void 0&&H(v)&&i.updateTimestampOffset(ue,v,1e-6,u,m,p)),i.appendExecutor(l,u)},onStart:function(){},onComplete:function(){var Q=self.performance.now();g.executeEnd=g.end=Q,S.first===0&&(S.first=Q),T&&T.first===0&&(T.first=Q);var ue={};i.sourceBuffers.forEach(function(te){var le=te[0],ve=te[1];le&&(ue[le]=Ae.getBuffered(ve))}),i.appendErrors[u]=0,u==="audio"||u==="video"?i.appendErrors.audiovideo=0:(i.appendErrors.audio=0,i.appendErrors.video=0),i.hls.trigger(y.BUFFER_APPENDED,{type:u,frag:d,part:h,chunkMeta:c,parent:d.type,timeRanges:ue})},onError:function(Q){var ue,te={type:Y.MEDIA_ERROR,parent:d.type,details:_.BUFFER_APPEND_ERROR,sourceBufferName:u,frag:d,part:h,chunkMeta:c,error:Q,err:Q,fatal:!1},le=(ue=i.media)==null?void 0:ue.error;if(Q.code===DOMException.QUOTA_EXCEEDED_ERR||Q.name=="QuotaExceededError"||"quota"in Q)te.details=_.BUFFER_FULL_ERROR;else if(Q.code===DOMException.INVALID_STATE_ERR&&i.mediaSourceOpenOrEnded&&!le)te.errorAction=ki(!0);else if(Q.name===Uo&&i.sourceBufferCount===0)te.errorAction=ki(!0);else{var ve=++i.appendErrors[u];i.warn("Failed "+ve+"/"+i.hls.config.appendErrorMaxRetry+' times to append segment in "'+u+'" sourceBuffer ('+(le||"no media error")+")"),(ve>=i.hls.config.appendErrorMaxRetry||le)&&(te.fatal=!0)}i.hls.trigger(y.ERROR,te)}};this.append(X,u,this.isPending(this.tracks[u]))},n.getFlushOp=function(e,t,i){var a=this;return this.log('queuing "'+e+'" remove '+t+"-"+i),{label:"remove",execute:function(){a.removeExecutor(e,t,i)},onStart:function(){},onComplete:function(){a.hls.trigger(y.BUFFER_FLUSHED,{type:e})},onError:function(u){a.warn("Failed to remove "+t+"-"+i+' from "'+e+'" SourceBuffer',u)}}},n.onBufferFlushing=function(e,t){var i=this,a=t.type,l=t.startOffset,u=t.endOffset;a?this.append(this.getFlushOp(a,l,u),a):this.sourceBuffers.forEach(function(f){var d=f[0];d&&i.append(i.getFlushOp(d,l,u),d)})},n.onFragParsed=function(e,t){var i=this,a=t.frag,l=t.part,u=[],f=l?l.elementaryStreams:a.elementaryStreams;f[se.AUDIOVIDEO]?u.push("audiovideo"):(f[se.AUDIO]&&u.push("audio"),f[se.VIDEO]&&u.push("video"));var d=function(){var c=self.performance.now();a.stats.buffering.end=c,l&&(l.stats.buffering.end=c);var v=l?l.stats:a.stats;i.hls.trigger(y.FRAG_BUFFERED,{frag:a,part:l,stats:v,id:a.type})};u.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+a.type+" level: "+a.level+" sn: "+a.sn),this.blockBuffers(d,u).catch(function(h){i.warn("Fragment buffered callback "+h),i.stepOperationQueue(i.sourceBufferTypes)})},n.onFragChanged=function(e,t){this.trimBuffers()},n.onBufferEos=function(e,t){var i=this,a;this.sourceBuffers.forEach(function(f){var d=f[0];if(d){var h=i.tracks[d];(!t.type||t.type===d)&&(h.ending=!0,h.ended||(h.ended=!0,i.log(d+" buffer reached EOS")))}});var l=((a=this.overrides)==null?void 0:a.endOfStream)!==!1,u=this.sourceBufferCount>0&&!this.sourceBuffers.some(function(f){var d,h=f[0];return h&&!((d=i.tracks[h])!=null&&d.ended)});u&&(l?(this.log("Queueing EOS"),this.blockUntilOpen(function(){i.tracksEnded();var f=i.mediaSource;if(!f||f.readyState!=="open"){f&&i.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+f.readyState);return}i.log("Calling mediaSource.endOfStream()"),f.endOfStream(),i.hls.trigger(y.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(y.BUFFERED_TO_END,void 0)))},n.tracksEnded=function(){var e=this;this.sourceBuffers.forEach(function(t){var i=t[0];if(i!==null){var a=e.tracks[i];a&&(a.ending=!1)}})},n.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.updateDuration())},n.updateDuration=function(){var e=this;this.blockUntilOpen(function(){var t=e.getDurationAndRange();t&&e.updateMediaSource(t)})},n.onError=function(e,t){if(t.details===_.BUFFER_APPEND_ERROR&&t.frag){var i,a=(i=t.errorAction)==null?void 0:i.nextAutoLevel;H(a)&&a!==t.frag.level&&this.resetAppendErrors()}},n.resetAppendErrors=function(){this.appendErrors={audio:0,video:0,audiovideo:0}},n.trimBuffers=function(){var e=this.hls,t=this.details,i=this.media;if(!(!i||t===null)&&this.sourceBufferCount){var a=e.config,l=i.currentTime,u=t.levelTargetDuration,f=t.live&&a.liveBackBufferLength!==null?a.liveBackBufferLength:a.backBufferLength;if(H(f)&&f>=0){var d=Math.max(f,u),h=Math.floor(l/u)*u-d;this.flushBackBuffer(l,u,h)}if(H(a.frontBufferFlushThreshold)&&a.frontBufferFlushThreshold>0){var c=Math.max(a.maxBufferLength,a.frontBufferFlushThreshold),v=Math.max(c,u),g=Math.floor(l/u)*u+v;this.flushFrontBuffer(l,u,g)}}},n.flushBackBuffer=function(e,t,i){var a=this;this.sourceBuffers.forEach(function(l){var u=l[0],f=l[1];if(f){var d=Ae.getBuffered(f);if(d.length>0&&i>d.start(0)){var h;a.hls.trigger(y.BACK_BUFFER_REACHED,{bufferEnd:i});var c=a.tracks[u];if((h=a.details)!=null&&h.live)a.hls.trigger(y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(c!=null&&c.ended){a.log("Cannot flush "+u+" back buffer while SourceBuffer is in ended state");return}a.hls.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:u})}}})},n.flushFrontBuffer=function(e,t,i){var a=this;this.sourceBuffers.forEach(function(l){var u=l[0],f=l[1];if(f){var d=Ae.getBuffered(f),h=d.length;if(h<2)return;var c=d.start(h-1),v=d.end(h-1);if(i>c||e>=c&&e<=v)return;a.hls.trigger(y.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:u})}})},n.getDurationAndRange=function(){var e,t=this.details,i=this.mediaSource;if(!t||!this.media||i?.readyState!=="open")return null;var a=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){var l=t.fragments.length;if(l&&t.live&&i.setLiveSeekableRange){var u=Math.max(0,t.fragmentStart),f=Math.max(u,a);return{duration:1/0,start:u,end:f}}return{duration:1/0}}var d=(e=this.overrides)==null?void 0:e.duration;if(d)return H(d)?{duration:d}:null;var h=this.media.duration,c=H(i.duration)?i.duration:0;return a>c&&a>h||!H(h)?{duration:a}:null},n.updateMediaSource=function(e){var t=e.duration,i=e.start,a=e.end,l=this.mediaSource;!this.media||!l||l.readyState!=="open"||(l.duration!==t&&(H(t)&&this.log("Updating MediaSource duration to "+t.toFixed(3)),l.duration=t),i!==void 0&&a!==void 0&&(this.log("MediaSource duration is set to "+l.duration+". Setting seekable range to "+i+"-"+a+"."),l.setLiveSeekableRange(i,a)))},n.checkPendingTracks=function(){var e=this.bufferCodecEventsTotal,t=this.pendingTrackCount,i=this.tracks;if(this.log("checkPendingTracks (pending: "+t+" codec events expected: "+e+") "+Ke(i)),this.tracksReady){var a,l=(a=this.transferData)==null?void 0:a.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}},n.bufferCreated=function(){var e=this;if(this.sourceBufferCount){var t={};this.sourceBuffers.forEach(function(a){var l=a[0],u=a[1];if(l){var f=e.tracks[l];t[l]={buffer:u,container:f.container,codec:f.codec,supplemental:f.supplemental,levelCodec:f.levelCodec,id:f.id,metadata:f.metadata}}}),this.hls.trigger(y.BUFFER_CREATED,{tracks:t}),this.log("SourceBuffers created. Running queue: "+this.operationQueue),this.sourceBuffers.forEach(function(a){var l=a[0];e.executeNext(l)})}else{var i=new Error("could not create source buffer for media codec(s)");this.hls.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:i,reason:i.message})}},n.createSourceBuffers=function(){var e=this.tracks,t=this.sourceBuffers,i=this.mediaSource;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(var a in e){var l=a,u=e[l];if(this.isPending(u)){var f=this.getTrackCodec(u,l),d=u.container+";codecs="+f;u.codec=f,this.log("creating sourceBuffer("+d+")"+(this.currentOp(l)?" Queued":"")+" "+Ke(u));try{var h=i.addSourceBuffer(d),c=ka(l),v=[l,h];t[c]=v,u.buffer=h}catch(m){var g;this.error("error while trying to add sourceBuffer: "+m.message),this.shiftAndExecuteNext(l),(g=this.operationQueue)==null||g.removeBlockers(),delete this.tracks[l],this.hls.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:l,mimeType:d,parent:u.id});return}this.trackSourceBuffer(l,u)}}this.bufferCreated()},n.getTrackCodec=function(e,t){var i=e.supplemental,a=e.codec;i&&(t==="video"||t==="audiovideo")&&ri(i,"video")&&(a=_r(a,i));var l=er(a,e.levelCodec);return l?t.slice(0,5)==="audio"?Wt(l,this.appendSource):l:""},n.trackSourceBuffer=function(e,t){var i=this,a=t.buffer;if(a){var l=this.getTrackCodec(t,e);this.tracks[e]={buffer:a,codec:l,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",function(u,f){var d=f.removedRanges;d!=null&&d.length&&i.hls.trigger(y.BUFFER_FLUSHED,{type:u})})}},n.onSBUpdateStart=function(e){var t=this.currentOp(e);t&&t.onStart()},n.onSBUpdateEnd=function(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}var i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))},n.onSBUpdateError=function(e,t){var i,a=new Error(e+" SourceBuffer error. MediaSource readyState: "+((i=this.mediaSource)==null?void 0:i.readyState));this.error(""+a,t),this.hls.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:a,fatal:!1});var l=this.currentOp(e);l&&l.onError(a)},n.updateTimestampOffset=function(e,t,i,a,l,u){var f=t-e.timestampOffset;Math.abs(f)>=i&&(this.log("Updating "+a+" SourceBuffer timestampOffset to "+t+" (sn: "+l+" cc: "+u+")"),e.timestampOffset=t)},n.removeExecutor=function(e,t,i){var a=this.media,l=this.mediaSource,u=this.tracks[e],f=u?.buffer;if(!a||!l||!f){this.warn("Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),this.shiftAndExecuteNext(e);return}var d=H(a.duration)?a.duration:1/0,h=H(l.duration)?l.duration:1/0,c=Math.max(0,t),v=Math.min(i,d,h);v>c&&(!u.ending||u.ended)?(u.ended=!1,this.log("Removing ["+c+","+v+"] from the "+e+" SourceBuffer"),f.remove(c,v)):this.shiftAndExecuteNext(e)},n.appendExecutor=function(e,t){var i=this.tracks[t],a=i?.buffer;if(!a)throw new Gf("Attempting to append to the "+t+" SourceBuffer, but it does not exist");i.ending=!1,i.ended=!1,a.appendBuffer(e)},n.blockUntilOpen=function(e){var t=this;if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(function(i){t.warn("SourceBuffer blocked callback "+i),t.stepOperationQueue(t.sourceBufferTypes)});else try{e()}catch(i){this.warn("Callback run without blocking "+this.operationQueue+" "+i)}},n.isUpdating=function(){return this.sourceBuffers.some(function(e){var t=e[0],i=e[1];return t&&i.updating})},n.isQueued=function(){var e=this;return this.sourceBuffers.some(function(t){var i=t[0];return i&&!!e.currentOp(i)})},n.isPending=function(e){return!!e&&!e.buffer},n.blockBuffers=function(e,t){var i=this;if(t===void 0&&(t=this.sourceBufferTypes),!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);var a=this.operationQueue,l=t.map(function(f){return i.appendBlocker(f)}),u=t.length>1&&!!this.blockedAudioAppend;return u&&this.unblockAudio(),Promise.all(l).then(function(f){a===i.operationQueue&&(e(),i.stepOperationQueue(i.sourceBufferTypes))})},n.stepOperationQueue=function(e){var t=this;e.forEach(function(i){var a,l=(a=t.tracks[i])==null?void 0:a.buffer;!l||l.updating||t.shiftAndExecuteNext(i)})},n.append=function(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)},n.appendBlocker=function(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)},n.currentOp=function(e){return this.operationQueue?this.operationQueue.current(e):null},n.executeNext=function(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)},n.shiftAndExecuteNext=function(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)},n.addBufferListener=function(e,t,i){var a=this.tracks[e];if(a){var l=a.buffer;if(l){var u=i.bind(this,e);a.listeners.push({event:t,listener:u}),l.addEventListener(t,u)}}},n.removeBufferListeners=function(e){var t=this.tracks[e];if(t){var i=t.buffer;i&&(t.listeners.forEach(function(a){i.removeEventListener(a.event,a.listener)}),t.listeners.length=0)}},W(o,[{key:"mediaSourceOpenOrEnded",get:function(){var e,t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}},{key:"sourceBufferTracks",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(t,i){var a=e.tracks[i];return t[i]={id:a.id,container:a.container,codec:a.codec,levelCodec:a.levelCodec},t},{})}},{key:"bufferedToEnd",get:function(){var e=this;return this.sourceBufferCount>0&&!this.sourceBuffers.some(function(t){var i,a,l=t[0];return l&&(!((i=e.tracks[l])!=null&&i.ended)||((a=e.tracks[l])==null?void 0:a.ending))})}},{key:"tracksReady",get:function(){var e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}},{key:"mediaSrc",get:function(){var e,t,i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}},{key:"pendingTrackCount",get:function(){var e=this;return Object.keys(this.tracks).reduce(function(t,i){return t+(e.isPending(e.tracks[i])?1:0)},0)}},{key:"sourceBufferCount",get:function(){return this.sourceBuffers.reduce(function(e,t){var i=t[0];return e+(i?1:0)},0)}},{key:"sourceBufferTypes",get:function(){return this.sourceBuffers.map(function(e){var t=e[0];return t}).filter(function(e){return!!e})}}])}(Z);function Bo(s){var o=s.querySelectorAll("source");[].slice.call(o).forEach(function(n){s.removeChild(n)})}function Hf(s,o){var n=self.document.createElement("source");n.type="video/mp4",n.src=o,s.appendChild(n)}function ka(s){return s==="audio"?1:0}var Vf=function(){function s(n){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=n,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var o=s.prototype;return o.setStreamController=function(r){this.streamController=r},o.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},o.registerListeners=function(){var r=this.hls;r.on(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(y.MANIFEST_PARSED,this.onManifestParsed,this),r.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(y.BUFFER_CODECS,this.onBufferCodecs,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)},o.unregisterListener=function(){var r=this.hls;r.off(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(y.MANIFEST_PARSED,this.onManifestParsed,this),r.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(y.BUFFER_CODECS,this.onBufferCodecs,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)},o.onFpsDropLevelCapping=function(r,e){var t=this.hls.levels[e.droppedLevel];this.isLevelAllowed(t)&&this.restrictedLevels.push({bitrate:t.bitrate,height:t.height,width:t.width})},o.onMediaAttaching=function(r,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},o.onManifestParsed=function(r,e){var t=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onLevelsUpdated=function(r,e){this.timer&&H(this.autoLevelCapping)&&this.detectPlayerSize()},o.onBufferCodecs=function(r,e){var t=this.hls;t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onMediaDetaching=function(){this.stopCapping(),this.media=null},o.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}var r=this.hls.levels;if(r.length){var e=this.hls,t=this.getMaxLevel(r.length-1);t!==this.autoLevelCapping&&e.logger.log("Setting autoLevelCapping to "+t+": "+r[t].height+"p@"+r[t].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),e.autoLevelCapping=t,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},o.getMaxLevel=function(r){var e=this,t=this.hls.levels;if(!t.length)return-1;var i=t.filter(function(a,l){return e.isLevelAllowed(a)&&l<=r});return this.clientRect=null,s.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},o.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},o.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},o.getDimensions=function(){if(this.clientRect)return this.clientRect;var r=this.media,e={width:0,height:0};if(r){var t=r.getBoundingClientRect();e.width=t.width,e.height=t.height,!e.width&&!e.height&&(e.width=t.right-t.left||r.width||0,e.height=t.bottom-t.top||r.height||0)}return this.clientRect=e,e},o.isLevelAllowed=function(r){var e=this.restrictedLevels;return!e.some(function(t){return r.bitrate===t.bitrate&&r.width===t.width&&r.height===t.height})},s.getMaxLevelByMediaSize=function(r,e,t){if(!(r!=null&&r.length))return-1;for(var i=function(h,c){return c?h.width!==c.width||h.height!==c.height:!0},a=r.length-1,l=Math.max(e,t),u=0;u<r.length;u+=1){var f=r[u];if((f.width>=l||f.height>=l)&&i(f,r[u+1])){a=u;break}}return a},W(s,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var r=1;if(!this.hls.config.ignoreDevicePixelRatio)try{r=self.devicePixelRatio}catch{}return Math.min(r,this.hls.config.maxDevicePixelRatio)}}])}(),Wf={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Kt=Wf,Yf={HLS:"h"},qf=Yf,jf="CMCD-Object",Xf="CMCD-Request",zf="CMCD-Session",Qf="CMCD-Status",Ui={OBJECT:jf,REQUEST:Xf,SESSION:zf,STATUS:Qf},hi,$f=(hi={},hi[Ui.OBJECT]=["br","ab","d","ot","tb","tpb","lb","tab","lab","url"],hi[Ui.REQUEST]=["pb","bl","tbl","dl","ltc","mtp","nor","nrr","rc","sn","sta","su","ttfb","ttfbb","ttlb","cmsdd","cmsds","smrt","df","cs"],hi[Ui.SESSION]=["cid","pr","sf","sid","st","v","msd"],hi[Ui.STATUS]=["bs","bsd","cdn","rtp","bg","pt","ec","e"],hi),Ca=function s(o,n){Array.isArray(o)&&(o=o.map(function(r){return r instanceof s?r:new s(r)})),this.value=o,this.params=n},Jf="Dict";function Zf(s){return Array.isArray(s)?JSON.stringify(s):s instanceof Map?"Map{}":s instanceof Set?"Set{}":typeof s=="object"?JSON.stringify(s):String(s)}function ed(s,o,n,r){return new Error("failed to "+s+' "'+Zf(o)+'" as '+n,{cause:r})}function hr(s,o,n){return ed("serialize",s,o,n)}var Go=function(o){this.description=o},Ko="Bare Item",td="Boolean";function rd(s){if(typeof s!="boolean")throw hr(s,td);return s?"?1":"?0"}function id(s){return btoa(String.fromCharCode.apply(String,s))}var nd="Byte Sequence";function ad(s){if(ArrayBuffer.isView(s)===!1)throw hr(s,nd);return":"+id(s)+":"}var sd="Integer";function od(s){return s<-999999999999999||999999999999999<s}function Ho(s){if(od(s))throw hr(s,sd);return s.toString()}function ld(s){return"@"+Ho(s.getTime()/1e3)}function Vo(s,o){if(s<0)return-Vo(-s,o);var n=Math.pow(10,o),r=Math.abs(s*n%1-.5)<Number.EPSILON;if(r){var e=Math.floor(s*n);return(e%2===0?e:e+1)/n}else return Math.round(s*n)/n}var ud="Decimal";function fd(s){var o=Vo(s,3);if(Math.floor(Math.abs(o)).toString().length>12)throw hr(s,ud);var n=o.toString();return n.includes(".")?n:n+".0"}var dd="String",hd=/[\x00-\x1f\x7f]+/;function cd(s){if(hd.test(s))throw hr(s,dd);return'"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function vd(s){return s.description||s.toString().slice(7,-1)}var gd="Token";function Wo(s){var o=vd(s);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(o)===!1)throw hr(o,gd);return o}function Pa(s){switch(typeof s){case"number":if(!H(s))throw hr(s,Ko);return Number.isInteger(s)?Ho(s):fd(s);case"string":return cd(s);case"symbol":return Wo(s);case"boolean":return rd(s);case"object":if(s instanceof Date)return ld(s);if(s instanceof Uint8Array)return ad(s);if(s instanceof Go)return Wo(s);default:throw hr(s,Ko)}}var md="Key";function wa(s){if(/^[a-z*][a-z0-9\-_.*]*$/.test(s)===!1)throw hr(s,md);return s}function Ma(s){return s==null?"":Object.entries(s).map(function(o){var n=o[0],r=o[1];return r===!0?";"+wa(n):";"+wa(n)+"="+Pa(r)}).join("")}function Yo(s){return s instanceof Ca?""+Pa(s.value)+Ma(s.params):Pa(s)}function pd(s){return"("+s.value.map(Yo).join(" ")+")"+Ma(s.params)}function yd(s,o){if(o===void 0&&(o={whitespace:!0}),typeof s!="object")throw hr(s,Jf);var n=s instanceof Map?s.entries():Object.entries(s),r=o?.whitespace?" ":"";return Array.from(n).map(function(e){var t=e[0],i=e[1];i instanceof Ca||(i=new Ca(i));var a=wa(t);return i.value===!0?a+=Ma(i.params):(a+="=",Array.isArray(i.value)?a+=pd(i):a+=Yo(i)),a}).join(","+r)}function Ed(s,o){return yd(s,o)}function Td(s){return["ot","sf","st","e","sta"].includes(s)}function Sd(s){return typeof s=="number"?H(s):s!=null&&s!==""&&s!==!1}function Ad(s,o){var n=new URL(s),r=new URL(o);if(n.origin!==r.origin)return s;for(var e=n.pathname.split("/").slice(1),t=r.pathname.split("/").slice(1,-1);e[0]===t[0];)e.shift(),t.shift();for(;t.length;)t.shift(),e.unshift("..");return e.join("/")}var An=function(o){return Math.round(o)},xd=function(o,n){return n?.baseUrl&&(o=Ad(o,n.baseUrl)),encodeURIComponent(o)},xn=function(o){return An(o/100)*100},Ld={br:An,d:An,bl:xn,dl:xn,mtp:xn,nor:xd,rtp:xn,tb:An};function Id(s,o){var n={};if(s==null||typeof s!="object")return n;var r=Object.keys(s).sort(),e=re({},Ld,o?.formatters),t=o?.filter;return r.forEach(function(i){if(t?.(i)!==!1){var a=s[i],l=e[i];l&&(a=l(a,o)),!(i==="v"&&a===1)&&(i=="pr"&&a===1||Sd(a)&&(Td(i)&&typeof a=="string"&&(a=new Go(a)),n[i]=a))}}),n}function qo(s,o){return o===void 0&&(o={}),s?Ed(Id(s,o),re({whitespace:!1},o)):""}function bd(s,o){o===void 0&&(o={});var n={};if(!s)return n;var r=Object.entries(s),e=Object.entries($f).concat(Object.entries(o?.customHeaderMap||{})),t=r.reduce(function(i,a){var l,u,f=a[0],d=a[1],h=((l=e.find(function(c){return c[1].includes(f)}))===null||l===void 0?void 0:l[0])||Ui.REQUEST;return(u=i[h])!==null&&u!==void 0||(i[h]={}),i[h][f]=d,i},{});return Object.entries(t).reduce(function(i,a){var l=a[0],u=a[1];return i[l]=qo(u,o),i},n)}function Rd(s,o,n){return re(s,bd(o,n))}var _d="CMCD";function Dd(s,o){if(o===void 0&&(o={}),!s)return"";var n=qo(s,o);return _d+"="+encodeURIComponent(n)}var jo=/CMCD=[^&#]+/;function kd(s,o,n){var r=Dd(o,n);if(!r)return s;if(jo.test(s))return s.replace(jo,r);var e=s.includes("?")?"&":"?";return""+s+e+r}var Cd=function(){function s(n){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(i){try{r.apply(i,{ot:Kt.MANIFEST,su:!r.initialized})}catch(a){r.hls.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=function(i){try{var a=i.frag,l=i.part,u=r.hls.levels[a.level],f=r.getObjectType(a),d={d:(l||a).duration*1e3,ot:f};(f===Kt.VIDEO||f===Kt.AUDIO||f==Kt.MUXED)&&(d.br=u.bitrate/1e3,d.tb=r.getTopBandwidth(f)/1e3,d.bl=r.getBufferLength(f));var h=l?r.getNextPart(l):r.getNextFrag(a);h!=null&&h.url&&h.url!==a.url&&(d.nor=h.url),r.apply(i,d)}catch(c){r.hls.logger.warn("Could not generate segment CMCD data.",c)}},this.hls=n;var e=this.config=n.config,t=e.cmcd;t!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=t.sessionId||n.sessionId,this.cid=t.contentId,this.useHeaders=t.useHeaders===!0,this.includeKeys=t.includeKeys,this.registerListeners())}var o=s.prototype;return o.registerListeners=function(){var r=this.hls;r.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(y.MEDIA_DETACHED,this.onMediaDetached,this),r.on(y.BUFFER_CREATED,this.onBufferCreated,this)},o.unregisterListeners=function(){var r=this.hls;r.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(y.MEDIA_DETACHED,this.onMediaDetached,this),r.off(y.BUFFER_CREATED,this.onBufferCreated,this)},o.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null},o.onMediaAttached=function(r,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},o.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},o.onBufferCreated=function(r,e){var t,i;this.audioBuffer=(t=e.tracks.audio)==null?void 0:t.buffer,this.videoBuffer=(i=e.tracks.video)==null?void 0:i.buffer},o.createData=function(){var r;return{v:1,sf:qf.HLS,sid:this.sid,cid:this.cid,pr:(r=this.media)==null?void 0:r.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},o.apply=function(r,e){e===void 0&&(e={}),re(e,this.createData());var t=e.ot===Kt.INIT||e.ot===Kt.VIDEO||e.ot===Kt.MUXED;this.starved&&t&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering);var i=this.includeKeys;i&&(e=Object.keys(e).reduce(function(l,u){return i.includes(u)&&(l[u]=e[u]),l},{}));var a={baseUrl:r.url};this.useHeaders?(r.headers||(r.headers={}),Rd(r.headers,e,a)):r.url=kd(r.url,e,a)},o.getNextFrag=function(r){var e,t=(e=this.hls.levels[r.level])==null?void 0:e.details;if(t){var i=r.sn-t.startSN;return t.fragments[i+1]}},o.getNextPart=function(r){var e,t,i=r.index,a=r.fragment,l=(e=this.hls.levels[a.level])==null||(t=e.details)==null?void 0:t.partList;if(l)for(var u=a.sn,f=l.length-1;f>=0;f--){var d=l[f];if(d.index===i&&d.fragment.sn===u)return l[f+1]}},o.getObjectType=function(r){var e=r.type;if(e==="subtitle")return Kt.TIMED_TEXT;if(r.sn==="initSegment")return Kt.INIT;if(e==="audio")return Kt.AUDIO;if(e==="main")return this.hls.audioTracks.length?Kt.VIDEO:Kt.MUXED},o.getTopBandwidth=function(r){var e=0,t,i=this.hls;if(r===Kt.AUDIO)t=i.audioTracks;else{var a=i.maxAutoLevel,l=a>-1?a+1:i.levels.length;t=i.levels.slice(0,l)}return t.forEach(function(u){u.bitrate>e&&(e=u.bitrate)}),e>0?e:NaN},o.getBufferLength=function(r){var e=this.media,t=r===Kt.AUDIO?this.audioBuffer:this.videoBuffer;if(!t||!e)return NaN;var i=Ae.bufferInfo(t,e.currentTime,this.config.maxBufferHole);return i.len*1e3},o.createPlaylistLoader=function(){var r=this.config.pLoader,e=this.applyPlaylistData,t=r||this.config.loader;return function(){function i(l){this.loader=void 0,this.loader=new t(l)}var a=i.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(u,f,d){e(u),this.loader.load(u,f,d)},W(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])}()},o.createFragmentLoader=function(){var r=this.config.fLoader,e=this.applyFragmentData,t=r||this.config.loader;return function(){function i(l){this.loader=void 0,this.loader=new t(l)}var a=i.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(u,f,d){e(u),this.loader.load(u,f,d)},W(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])}()},s}(),Pd=3e5,wd=function(s){function o(r){var e;return e=s.call(this,"content-steering",r.logger)||this,e.hls=void 0,e.loader=null,e.uri=null,e.pathwayId=".",e._pathwayPriority=null,e.timeToLoad=300,e.reloadTimer=-1,e.updated=0,e.started=!1,e.enabled=!0,e.levels=null,e.audioTracks=null,e.subtitleTracks=null,e.penalizedPathways={},e.hls=r,e.registerListeners(),e}ae(o,s);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.ERROR,this.onError,this))},n.pathways=function(){return(this.levels||[]).reduce(function(e,t){return e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e},[])},n.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}},n.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},n.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},n.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},n.removeLevel=function(e){var t=this.levels;t&&(this.levels=t.filter(function(i){return i!==e}))},n.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},n.onManifestLoaded=function(e,t){var i=t.contentSteering;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())},n.onManifestParsed=function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks},n.onError=function(e,t){var i=t.errorAction;if(i?.action===xt.SendAlternateToPenaltyBox&&i.flags===tr.MoveAllAlternatesMatchingHost){var a=this.levels,l=this._pathwayPriority,u=this.pathwayId;if(t.context){var f=t.context,d=f.groupId,h=f.pathwayId,c=f.type;d&&a?u=this.getPathwayForGroupId(d,c,u):h&&(u=h)}u in this.penalizedPathways||(this.penalizedPathways[u]=performance.now()),!l&&a&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),i.resolved=this.pathwayId!==u),t.details===_.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn("Could not resolve "+t.details+' ("'+t.error.message+'") with content-steering for Pathway: '+u+" levels: "+(a&&a.length)+" priorities: "+Ke(l)+" penalized: "+Ke(this.penalizedPathways))}},n.filterParsedLevels=function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){var i=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+i+'"'),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log("Found "+t.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),t},n.getLevelsForPathway=function(e){return this.levels===null?[]:this.levels.filter(function(t){return e===t.pathwayId})},n.updatePathwayPriority=function(e){this._pathwayPriority=e;var t,i=this.penalizedPathways,a=performance.now();Object.keys(i).forEach(function(c){a-i[c]>Pd&&delete i[c]});for(var l=0;l<e.length;l++){var u=e[l];if(!(u in i)){if(u===this.pathwayId)return;var f=this.hls.nextLoadLevel,d=this.hls.levels[f];if(t=this.getLevelsForPathway(u),t.length>0){this.log('Setting Pathway to "'+u+'"'),this.pathwayId=u,to(t),this.hls.trigger(y.LEVELS_UPDATED,{levels:t});var h=this.hls.levels[f];d&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==d.bitrate&&this.log("Unstable Pathways change from bitrate "+d.bitrate+" to "+h.bitrate),this.hls.nextLoadLevel=f);break}}}},n.getPathwayForGroupId=function(e,t,i){for(var a=this.getLevelsForPathway(i).concat(this.levels||[]),l=0;l<a.length;l++)if(t===N.AUDIO_TRACK&&a[l].hasAudioGroup(e)||t===N.SUBTITLE_TRACK&&a[l].hasSubtitleGroup(e))return a[l].pathwayId;return i},n.clonePathways=function(e){var t=this,i=this.levels;if(i){var a={},l={};e.forEach(function(u){var f=u.ID,d=u["BASE-ID"],h=u["URI-REPLACEMENT"];if(!i.some(function(v){return v.pathwayId===f})){var c=t.getLevelsForPathway(d).map(function(v){var g=new Je(v.attrs);g["PATHWAY-ID"]=f;var m=g.AUDIO&&g.AUDIO+"_clone_"+f,p=g.SUBTITLES&&g.SUBTITLES+"_clone_"+f;m&&(a[g.AUDIO]=m,g.AUDIO=m),p&&(l[g.SUBTITLES]=p,g.SUBTITLES=p);var E=zo(v.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),S=new Di({attrs:g,audioCodec:v.audioCodec,bitrate:v.bitrate,height:v.height,name:v.name,url:E,videoCodec:v.videoCodec,width:v.width});if(v.audioGroups)for(var T=1;T<v.audioGroups.length;T++)S.addGroupId("audio",v.audioGroups[T]+"_clone_"+f);if(v.subtitleGroups)for(var A=1;A<v.subtitleGroups.length;A++)S.addGroupId("text",v.subtitleGroups[A]+"_clone_"+f);return S});i.push.apply(i,c),Xo(t.audioTracks,a,h,f),Xo(t.subtitleTracks,l,h,f)}})}},n.loadSteeringManifest=function(e){var t=this,i=this.hls.config,a=i.loader;this.loader&&this.loader.destroy(),this.loader=new a(i);var l;try{l=new self.URL(e)}catch{this.enabled=!1,this.log("Failed to parse Steering Manifest URI: "+e);return}if(l.protocol!=="data:"){var u=(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate)|0;l.searchParams.set("_HLS_pathway",this.pathwayId),l.searchParams.set("_HLS_throughput",""+u)}var f={responseType:"json",url:l.href},d=i.steeringManifestLoadPolicy.default,h=d.errorRetry||d.timeoutRetry||{},c={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},v={onSuccess:function(m,p,E,S){t.log('Loaded steering manifest: "'+l+'"');var T=m.data;if(T?.VERSION!==1){t.log("Steering VERSION "+T.VERSION+" not supported!");return}t.updated=performance.now(),t.timeToLoad=T.TTL;var A=T["RELOAD-URI"],x=T["PATHWAY-CLONES"],I=T["PATHWAY-PRIORITY"];if(A)try{t.uri=new self.URL(A,l).href}catch{t.enabled=!1,t.log("Failed to parse Steering Manifest RELOAD-URI: "+A);return}t.scheduleRefresh(t.uri||E.url),x&&t.clonePathways(x);var k={steeringManifest:T,url:l.toString()};t.hls.trigger(y.STEERING_MANIFEST_LOADED,k),I&&t.updatePathwayPriority(I)},onError:function(m,p,E,S){if(t.log("Error loading steering manifest: "+m.code+" "+m.text+" ("+p.url+")"),t.stopLoad(),m.code===410){t.enabled=!1,t.log("Steering manifest "+p.url+" no longer available");return}var T=t.timeToLoad*1e3;if(m.code===429){var A=t.loader;if(typeof A?.getResponseHeader=="function"){var x=A.getResponseHeader("Retry-After");x&&(T=parseFloat(x)*1e3)}t.log("Steering manifest "+p.url+" rate limited");return}t.scheduleRefresh(t.uri||p.url,T)},onTimeout:function(m,p,E){t.log("Timeout loading steering manifest ("+p.url+")"),t.scheduleRefresh(t.uri||p.url)}};this.log("Requesting steering manifest: "+l),this.loader.load(f,c,v)},n.scheduleRefresh=function(e,t){var i=this;t===void 0&&(t=this.timeToLoad*1e3),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var a,l=(a=i.hls)==null?void 0:a.media;if(l&&!l.ended){i.loadSteeringManifest(e);return}i.scheduleRefresh(e,i.timeToLoad*1e3)},t)},W(o,[{key:"pathwayPriority",get:function(){return this._pathwayPriority},set:function(e){this.updatePathwayPriority(e)}}])}(Z);function Xo(s,o,n,r){s&&Object.keys(o).forEach(function(e){var t=s.filter(function(i){return i.groupId===e}).map(function(i){var a=re({},i);return a.details=void 0,a.attrs=new Je(a.attrs),a.url=a.attrs.URI=zo(i.url,i.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),a.groupId=a.attrs["GROUP-ID"]=o[e],a.attrs["PATHWAY-ID"]=r,a});s.push.apply(s,t)})}function zo(s,o,n,r){var e=r.HOST,t=r.PARAMS,i=r[n],a;o&&(a=i?.[o],a&&(s=a));var l=new self.URL(s);return e&&!a&&(l.host=e),t&&Object.keys(t).sort().forEach(function(u){u&&l.searchParams.set(u,t[u])}),l.href}function Qt(s,o,n){rr(s,o,n),s.addEventListener(o,n)}function rr(s,o,n){s.removeEventListener(o,n)}var Qo=function(s){function o(r){var e;return e=s.call(this,"eme",r.logger)||this,e.hls=void 0,e.config=void 0,e.media=null,e.keyFormatPromise=null,e.keySystemAccessPromises={},e._requestLicenseFailureCount=0,e.mediaKeySessions=[],e.keyIdToKeySessionPromise={},e.mediaKeys=null,e.setMediaKeysQueue=o.CDMCleanupPromise?[o.CDMCleanupPromise]:[],e.onWaitingForKey=function(t){e.log('"'+t.type+'" event')},e.hls=r,e.config=r.config,e.registerListeners(),e}ae(o,s);var n=o.prototype;return n.destroy=function(){this.onDestroying(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onWaitingForKey=null},n.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(y.DESTROYING,this.onDestroying,this)},n.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(y.DESTROYING,this.onDestroying,this)},n.getLicenseServerUrl=function(e){var t=this.config,i=t.drmSystems,a=t.widevineLicenseUrl,l=i[e];if(l)return l.licenseUrl;if(e===Ze.WIDEVINE&&a)return a},n.getLicenseServerUrlOrThrow=function(e){var t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error('no license server URL configured for key-system "'+e+'"');return t},n.getServerCertificateUrl=function(e){var t=this.config.drmSystems,i=t[e];if(i)return i.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},n.attemptKeySystemAccess=function(e){var t=this,i=this.hls.levels,a=function(d,h,c){return!!d&&c.indexOf(d)===h},l=i.map(function(f){return f.audioCodec}).filter(a),u=i.map(function(f){return f.videoCodec}).filter(a);return l.length+u.length===0&&u.push("avc1.42e01e"),new Promise(function(f,d){var h=function(v){var g=v.shift();t.getMediaKeysPromise(g,l,u).then(function(m){return f({keySystem:g,mediaKeys:m})}).catch(function(m){v.length?h(v):m instanceof $t?d(m):d(new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};h(e)})},n.requestMediaKeySystemAccess=function(e,t){var i=this.config.requestMediaKeySystemAccessFunc;if(typeof i!="function"){var a="Configured requestMediaKeySystemAccess is not a function "+i;return Fs===null&&self.location.protocol==="http:"&&(a="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(a))}return i(e,t)},n.getMediaKeysPromise=function(e,t,i){var a=this,l=Tu(e,t,i,this.config.drmSystemOptions),u=this.keySystemAccessPromises[e],f=u?.keySystemAccess;if(!f){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+Ke(l)),f=this.requestMediaKeySystemAccess(e,l);var d=this.keySystemAccessPromises[e]={keySystemAccess:f};return f.catch(function(h){a.log('Failed to obtain access to key-system "'+e+'": '+h)}),f.then(function(h){a.log('Access for key-system "'+h.keySystem+'" obtained');var c=a.fetchServerCertificate(e);return a.log('Create media-keys for "'+e+'"'),d.mediaKeys=h.createMediaKeys().then(function(v){return a.log('Media-keys created for "'+e+'"'),d.hasMediaKeys=!0,c.then(function(g){return g?a.setMediaKeysServerCertificate(v,e,g):v})}),d.mediaKeys.catch(function(v){a.error('Failed to create media-keys for "'+e+'"}: '+v)}),d.mediaKeys})}return f.then(function(){return u.mediaKeys})},n.createMediaKeySessionContext=function(e){var t=e.decryptdata,i=e.keySystem,a=e.mediaKeys;this.log('Creating key-system session "'+i+'" keyId: '+it.hexDump(t.keyId||[]));var l=a.createSession(),u={decryptdata:t,keySystem:i,mediaKeys:a,mediaKeysSession:l,keyStatus:"status-pending"};return this.mediaKeySessions.push(u),u},n.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var i=this.createMediaKeySessionContext(e),a=this.getKeyIdString(t),l="cenc";this.keyIdToKeySessionPromise[a]=this.generateRequestWithPreferredKeySession(i,l,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},n.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return it.hexDump(e.keyId)},n.updateKeySession=function(e,t){var i,a=e.mediaKeysSession;return this.log('Updating key-session "'+a.sessionId+'" for keyID '+it.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])+`
      } (data length: `+(t&&t.byteLength)+")"),a.update(t)},n.getSelectedKeySystemFormats=function(){var e=this;return Object.keys(this.keySystemAccessPromises).map(function(t){return{keySystem:t,hasMediaKeys:e.keySystemAccessPromises[t].hasMediaKeys}}).filter(function(t){var i=t.hasMediaKeys;return!!i}).map(function(t){var i=t.keySystem;return Os(i)}).filter(function(t){return!!t})},n.getKeySystemAccess=function(e){var t=this;return this.getKeySystemSelectionPromise(e).then(function(i){var a=i.keySystem,l=i.mediaKeys;return t.attemptSetMediaKeys(a,l)})},n.selectKeySystem=function(e){var t=this;return new Promise(function(i,a){return t.getKeySystemSelectionPromise(e).then(function(l){var u=l.keySystem,f=Os(u);f?i(f):a(new Error('Unable to find format for key-system "'+u+'"'))}).catch(a)})},n.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},n.getKeyFormatPromise=function(e){var t=hn(this.config),i=e.map(oa).filter(function(a){return!!a&&t.indexOf(a)!==-1});return this.selectKeySystem(i)},n.loadKey=function(e){var t=this,i=e.keyInfo.decryptdata,a=this.getKeyIdString(i),l="(keyId: "+a+' format: "'+i.keyFormat+'" method: '+i.method+" uri: "+i.uri+")";this.log("Starting session for key "+l);var u=this.keyIdToKeySessionPromise[a];if(!u){u=this.getKeySystemForKeyPromise(i).then(function(d){var h=d.keySystem,c=d.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+l),t.attemptSetMediaKeys(h,c).then(function(){return t.throwIfDestroyed(),t.createMediaKeySessionContext({keySystem:h,mediaKeys:c,decryptdata:i})})});var f=this.keyIdToKeySessionPromise[a]=u.then(function(d){var h="cenc",c=i.pssh?i.pssh.buffer:null;return t.generateRequestWithPreferredKeySession(d,h,c,"playlist-key")});f.catch(function(d){return t.handleError(d)})}return u},n.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},n.handleError=function(e){this.hls&&(this.error(e.message),e instanceof $t?this.hls.trigger(y.ERROR,e.data):this.hls.trigger(y.ERROR,{type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},n.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){var a=oa(e.keyFormat),l=a?[a]:hn(this.config);return this.attemptKeySystemAccess(l)}return i},n.getKeySystemSelectionPromise=function(e){if(e.length||(e=hn(this.config)),e.length===0)throw new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+Ke({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},n.attemptSetMediaKeys=function(e,t){var i=this;if(this.mediaKeys===t)return Promise.resolve();var a=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var l=Promise.all(a).then(function(){if(!i.media)throw i.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return i.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(l),l.then(function(){i.log('Media-keys set for "'+e+'"'),a.push(l),i.setMediaKeysQueue=i.setMediaKeysQueue.filter(function(u){return a.indexOf(u)===-1})})},n.generateRequestWithPreferredKeySession=function(e,t,i,a){var l,u,f=this,d=(l=this.config.drmSystems)==null||(u=l[e.keySystem])==null?void 0:u.generateRequest;if(d)try{var h=d.call(this.hls,t,i,e);if(!h)throw new Error("Invalid response from configured generateRequest filter");t=h.initDataType,i=h.initData?h.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(S){var c;if(this.warn(S.message),(c=this.hls)!=null&&c.config.debug)throw S}if(i===null)return this.log('Skipping key-session request for "'+a+'" (no initData)'),Promise.resolve(e);var v=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+a+'": '+v+" (init data type: "+t+" length: "+(i?i.byteLength:null)+")");var g=new be,m=e._onmessage=function(S){var T=e.mediaKeysSession;if(!T){g.emit("error",new Error("invalid state"));return}var A=S.messageType,x=S.message;f.log('"'+A+'" message event for session "'+T.sessionId+'" message size: '+x.byteLength),A==="license-request"||A==="license-renewal"?f.renewLicense(e,x).catch(function(I){g.eventNames().length?g.emit("error",I):f.handleError(I)}):A==="license-release"?e.keySystem===Ze.FAIRPLAY&&(f.updateKeySession(e,sa("acknowledged")),f.removeSession(e)):f.warn('unhandled media key message type "'+A+'"')},p=e._onkeystatuseschange=function(S){var T=e.mediaKeysSession;if(!T){g.emit("error",new Error("invalid state"));return}f.onKeyStatusChange(e);var A=e.keyStatus;g.emit("keyStatus",A),A==="expired"&&(f.warn(e.keySystem+" expired for key "+v),f.renewKeySession(e))};Qt(e.mediaKeysSession,"message",m),Qt(e.mediaKeysSession,"keystatuseschange",p);var E=new Promise(function(S,T){g.on("error",T),g.on("keyStatus",function(A){A.startsWith("usable")?S():A==="output-restricted"?T(new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):A==="internal-error"?T(new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+A+'"')):A==="expired"?T(new Error("key expired while generating request")):f.warn('unhandled key status change "'+A+'"')})});return e.mediaKeysSession.generateRequest(t,i).then(function(){var S;f.log('Request generated for key-session "'+((S=e.mediaKeysSession)==null?void 0:S.sessionId)+'" keyId: '+v)}).catch(function(S){throw new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_SESSION,error:S,fatal:!1},"Error generating key-session request: "+S)}).then(function(){return E}).catch(function(S){throw g.removeAllListeners(),f.removeSession(e),S}).then(function(){return g.removeAllListeners(),e})},n.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach(function(i,a){if(typeof a=="string"&&typeof i=="object"){var l=a;a=i,i=l}t.log('key status change "'+i+'" for keyStatuses keyId: '+it.hexDump("buffer"in a?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a))+" session keyId: "+it.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=i})},n.fetchServerCertificate=function(e){var t=this.config,i=t.loader,a=new i(t),l=this.getServerCertificateUrl(e);return l?(this.log('Fetching server certificate for "'+e+'"'),new Promise(function(u,f){var d={responseType:"arraybuffer",url:l},h=t.certLoadPolicy.default,c={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},v={onSuccess:function(m,p,E,S){u(m.data)},onError:function(m,p,E,S){f(new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:Ee({url:d.url,data:void 0},m)},'"'+e+'" certificate request failed ('+l+"). Status: "+m.code+" ("+m.text+")"))},onTimeout:function(m,p,E){f(new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:d.url,data:void 0}},'"'+e+'" certificate request timed out ('+l+")"))},onAbort:function(m,p,E){f(new Error("aborted"))}};a.load(d,c,v)})):Promise.resolve()},n.setMediaKeysServerCertificate=function(e,t,i){var a=this;return new Promise(function(l,u){e.setServerCertificate(i).then(function(f){a.log("setServerCertificate "+(f?"success":"not supported by CDM")+" ("+i?.byteLength+') on "'+t+'"'),l(e)}).catch(function(f){u(new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:f,fatal:!0},f.message))})})},n.renewLicense=function(e,t){var i=this;return this.requestLicense(e,new Uint8Array(t)).then(function(a){return i.updateKeySession(e,new Uint8Array(a)).catch(function(l){throw new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:l,fatal:!0},l.message)})})},n.unpackPlayReadyKeyMessage=function(e,t){var i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;var a=new DOMParser().parseFromString(i,"application/xml"),l=a.querySelectorAll("HttpHeader");if(l.length>0)for(var u,f=0,d=l.length;f<d;f++){var h,c;u=l[f];var v=(h=u.querySelector("name"))==null?void 0:h.textContent,g=(c=u.querySelector("value"))==null?void 0:c.textContent;v&&g&&e.setRequestHeader(v,g)}var m=a.querySelector("Challenge"),p=m?.textContent;if(!p)throw new Error("Cannot find <Challenge> in key message");return sa(atob(p))},n.setupLicenseXHR=function(e,t,i,a){var l=this,u=this.config.licenseXhrSetup;return u?Promise.resolve().then(function(){if(!i.decryptdata)throw new Error("Key removed");return u.call(l.hls,e,t,i,a)}).catch(function(f){if(!i.decryptdata)throw f;return e.open("POST",t,!0),u.call(l.hls,e,t,i,a)}).then(function(f){e.readyState||e.open("POST",t,!0);var d=f||a;return{xhr:e,licenseChallenge:d}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:a}))},n.requestLicense=function(e,t){var i=this,a=this.config.keyLoadPolicy.default;return new Promise(function(l,u){var f=i.getLicenseServerUrlOrThrow(e.keySystem);i.log("Sending license request to URL: "+f);var d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=function(){if(!i.hls||!e.mediaKeysSession)return u(new Error("invalid state"));if(d.readyState===4)if(d.status===200){i._requestLicenseFailureCount=0;var h=d.response;i.log("License received "+(h instanceof ArrayBuffer?h.byteLength:h));var c=i.config.licenseResponseCallback;if(c)try{h=c.call(i.hls,d,f,e)}catch(p){i.error(p)}l(h)}else{var v=a.errorRetry,g=v?v.maxNumRetry:0;if(i._requestLicenseFailureCount++,i._requestLicenseFailureCount>g||d.status>=400&&d.status<500)u(new $t({type:Y.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:d,response:{url:f,data:void 0,code:d.status,text:d.statusText}},"License Request XHR failed ("+f+"). Status: "+d.status+" ("+d.statusText+")"));else{var m=g-i._requestLicenseFailureCount+1;i.warn("Retrying license request, "+m+" attempts left"),i.requestLicense(e,t).then(l,u)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=d,i.setupLicenseXHR(d,f,e,t).then(function(h){var c=h.xhr,v=h.licenseChallenge;e.keySystem==Ze.PLAYREADY&&(v=i.unpackPlayReadyKeyMessage(c,v)),c.send(v)})})},n.onDestroying=function(){this.unregisterListeners(),this._clear()},n.onMediaAttached=function(e,t){if(this.config.emeEnabled){var i=t.media;this.media=i,Qt(i,"waitingforkey",this.onWaitingForKey)}},n.onMediaDetached=function(){var e=this.media;e&&(rr(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)},n._clear=function(){var e=this,t;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!(!this.mediaKeys&&!this.mediaKeySessions.length)){var i=this.media,a=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ns.clearKeyUriToKeyIdMap();var l=a.length;o.CDMCleanupPromise=Promise.all(a.map(function(u){return e.removeSession(u)}).concat(i==null||(t=i.setMediaKeys(null))==null?void 0:t.catch(function(u){var f;e.log("Could not clear media keys: "+u),(f=e.hls)==null||f.trigger(y.ERROR,{type:Y.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: "+u)})}))).catch(function(u){var f;e.log("Could not close sessions and clear media keys: "+u),(f=e.hls)==null||f.trigger(y.ERROR,{type:Y.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: "+u)})}).then(function(){l&&e.log("finished closing key sessions and clearing media keys")})}},n.onManifestLoading=function(){this.keyFormatPromise=null},n.onManifestLoaded=function(e,t){var i=t.sessionKeys;if(!(!i||!this.config.emeEnabled)&&!this.keyFormatPromise){var a=i.reduce(function(l,u){return l.indexOf(u.keyFormat)===-1&&l.push(u.keyFormat),l},[]);this.log("Selecting key-system from session-keys "+a.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(a)}},n.removeSession=function(e){var t=this,i=e.mediaKeysSession,a=e.licenseXhr;if(i){this.log("Remove licenses and keys and close session "+i.sessionId),e._onmessage&&(i.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),a&&a.readyState!==XMLHttpRequest.DONE&&a.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var l=this.mediaKeySessions.indexOf(e);l>-1&&this.mediaKeySessions.splice(l,1);var u=this.config.drmSystemOptions,f=Au(u)?new Promise(function(d,h){self.setTimeout(function(){return h(new Error("MediaKeySession.remove() timeout"))},8e3),i.remove().then(d)}):Promise.resolve();return f.catch(function(d){var h;t.log("Could not remove session: "+d),(h=t.hls)==null||h.trigger(y.ERROR,{type:Y.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: "+d)})}).then(function(){return i.close()}).catch(function(d){var h;t.log("Could not close session: "+d),(h=t.hls)==null||h.trigger(y.ERROR,{type:Y.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: "+d)})})}},o}(Z);Qo.CDMCleanupPromise=void 0;var $t=function(s){function o(n,r){var e;return e=s.call(this,r)||this,e.data=void 0,n.error||(n.error=new Error(r)),e.data=n,n.err=n.error,e}return ae(o,s),o}(Xe(Error)),Md=function(){function s(n){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=n,this.registerListeners()}var o=s.prototype;return o.setStreamController=function(r){this.streamController=r},o.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)},o.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)},o.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},o.onMediaAttaching=function(r,e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var i=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},o.onMediaDetaching=function(){this.media=null},o.checkFPS=function(r,e,t){var i=performance.now();if(e){if(this.lastTime){var a=i-this.lastTime,l=t-this.lastDroppedFrames,u=e-this.lastDecodedFrames,f=1e3*l/a,d=this.hls;if(d.trigger(y.FPS_DROP,{currentDropped:l,currentDecoded:u,totalDroppedFrames:t}),f>0&&l>d.config.fpsDroppedMonitoringThreshold*u){var h=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=h)&&(h=h-1,d.trigger(y.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=t,this.lastDecodedFrames=e}},o.checkFPSInterval=function(){var r=this.media;if(r)if(this.isVideoPlaybackQualityAvailable){var e=r.getVideoPlaybackQuality();this.checkFPS(r,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(r,r.webkitDecodedFrameCount,r.webkitDroppedFrameCount)},s}();function Bi(s){for(var o=5381,n=s.length;n;)o=o*33^s.charCodeAt(--n);return(o>>>0).toString()}var ci=.025,Ln=function(s){return s[s.Point=0]="Point",s[s.Range=1]="Range",s}({});function Od(s,o,n){return s.identifier+"-"+(n+1)+"-"+Bi(o)}var Fd=function(){function s(n,r){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=r,this.dateRange=n,this.setDateRange(n)}var o=s.prototype;return o.setDateRange=function(r){this.dateRange=r,this.resumeOffset=r.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=r.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=r.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=r.attr.enumeratedStringList("X-SNAP",this.snapOptions)},o.reset=function(){var r;this.appendInPlaceStarted=!1,(r=this.assetListLoader)==null||r.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)},o.isAssetPastPlayoutLimit=function(r){var e;if(r>0&&r>=this.assetList.length)return!0;var t=this.playoutLimit;if(r<=0||isNaN(t))return!1;if(t===0)return!0;var i=((e=this.assetList[r])==null?void 0:e.startOffset)||0;return i>t},o.findAssetIndex=function(r){var e=this.assetList.indexOf(r);return e},o.toString=function(){return Nd(this)},W(s,[{key:"identifier",get:function(){return this.dateRange.id}},{key:"startDate",get:function(){return this.dateRange.startDate}},{key:"startTime",get:function(){var r=this.dateRange.startTime;if(this.snapOptions.out){var e=this.dateRange.tagAnchor;if(e)return Oa(r,e)}return r}},{key:"startOffset",get:function(){return this.cue.pre?0:this.startTime}},{key:"startIsAligned",get:function(){if(this.startTime===0||this.snapOptions.out)return!0;var r=this.dateRange.tagAnchor;if(r){var e=this.dateRange.startTime,t=Oa(e,r);return e-t<.1}return!1}},{key:"resumptionOffset",get:function(){var r=this.resumeOffset,e=H(r)?r:this.duration;return this.cumulativeDuration+e}},{key:"resumeTime",get:function(){var r=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){var e=this.resumeAnchor;if(e)return Oa(r,e)}return r}},{key:"appendInPlace",get:function(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ci))},set:function(r){if(this.appendInPlaceStarted){this.resetOnResume=!r;return}this.appendInPlaceDisabled=!r}},{key:"timelineStart",get:function(){return this._timelineStart!==null?this._timelineStart:this.startTime},set:function(r){this._timelineStart=r}},{key:"duration",get:function(){var r=this.playoutLimit,e;return this._duration!==null?e=this._duration:this.dateRange.duration?e=this.dateRange.duration:e=this.dateRange.plannedDuration||0,!isNaN(r)&&r<e&&(e=r),e},set:function(r){this._duration=r}},{key:"cue",get:function(){return this.dateRange.cue}},{key:"timelineOccupancy",get:function(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Ln.Range:Ln.Point}},{key:"supplementsPrimary",get:function(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}},{key:"contentMayVary",get:function(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}},{key:"assetUrl",get:function(){return this.dateRange.attr["X-ASSET-URI"]}},{key:"assetListUrl",get:function(){return this.dateRange.attr["X-ASSET-LIST"]}},{key:"baseUrl",get:function(){return this.base.url}},{key:"assetListLoaded",get:function(){return this.assetList.length>0||this.assetListResponse!==null}}])}();function Oa(s,o){return s-o.start<o.duration/2&&!(Math.abs(s-(o.start+o.duration))<ci)?o.start:o.start+o.duration}function $o(s,o,n){var r=new self.URL(s,n);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",o),r}function Fa(s,o){for(;(n=s.assetList[++o])!=null&&n.error;)var n;return o}function Nd(s){return'["'+s.identifier+'" '+(s.cue.pre?"<pre>":s.cue.post?"<post>":"")+s.timelineStart.toFixed(2)+"-"+s.resumeTime.toFixed(2)+"]"}function vi(s){var o=s.timelineStart,n=s.duration||0;return'["'+s.identifier+'" '+o.toFixed(2)+"-"+(o+n).toFixed(2)+"]"}var Ud=function(){function s(n,r,e,t){var i=this;this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=function(){i.reachedPlayout(i.currentTime)&&i.hls.trigger(y.PLAYOUT_LIMIT_REACHED,{})};var a=this.hls=new n(r);this.interstitial=e,this.assetItem=t;var l=t.uri;try{l=$o(l,r.primarySessionId).href}catch{}a.loadSource(l);var u=function(){i.hasDetails=!0};a.once(y.LEVEL_LOADED,u),a.once(y.AUDIO_TRACK_LOADED,u),a.once(y.SUBTITLE_TRACK_LOADED,u),a.on(y.MEDIA_ATTACHING,function(f,d){var h=d.media;i.removeMediaListeners(),i.mediaAttached=h;var c=i.interstitial;c.playoutLimit&&(h.addEventListener("timeupdate",i.checkPlayout),i.appendInPlace&&a.on(y.BUFFER_APPENDED,function(){var v=i.bufferedEnd;i.reachedPlayout(v)&&(i._bufferedEosTime=v,a.trigger(y.BUFFERED_TO_END,void 0))}))})}var o=s.prototype;return o.bufferedInPlaceToEnd=function(r){var e;if(!this.appendInPlace)return!1;if((e=this.hls)!=null&&e.bufferedToEnd)return!0;if(!r||!this._bufferedEosTime)return!1;var t=this.timelineOffset,i=Ae.bufferInfo(r,t,0),a=this.getAssetTime(i.end);return a>=this._bufferedEosTime-.02},o.reachedPlayout=function(r){var e=this.interstitial,t=e.playoutLimit;return this.startOffset+r>=t},o.getAssetTime=function(r){var e=this.timelineOffset,t=this.duration;return Math.min(Math.max(0,r-e),t)},o.removeMediaListeners=function(){var r=this.mediaAttached;r&&(this._currentTime=r.currentTime,this.bufferSnapShot(),r.removeEventListener("timeupdate",this.checkPlayout))},o.bufferSnapShot=function(){if(this.mediaAttached){var r;(r=this.hls)!=null&&r.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}},o.destroy=function(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null},o.attachMedia=function(r){this.hls.attachMedia(r)},o.detachMedia=function(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()},o.resumeBuffering=function(){this.hls.resumeBuffering()},o.pauseBuffering=function(){this.hls.pauseBuffering()},o.transferMedia=function(){return this.bufferSnapShot(),this.hls.transferMedia()},o.resetDetails=function(){var r=this.hls;if(this.hasDetails){r.stopLoad();var e=function(i){return delete i.details};r.levels.forEach(e),r.allAudioTracks.forEach(e),r.allSubtitleTracks.forEach(e),this.hasDetails=!1}},o.on=function(r,e,t){this.hls.on(r,e)},o.once=function(r,e,t){this.hls.once(r,e)},o.off=function(r,e,t){this.hls.off(r,e)},o.toString=function(){var r;return"HlsAssetPlayer: "+vi(this.assetItem)+" "+((r=this.hls)==null?void 0:r.sessionId)+" "+(this.appendInPlace?"append-in-place":"")},W(s,[{key:"appendInPlace",get:function(){var r;return((r=this.interstitial)==null?void 0:r.appendInPlace)||!1}},{key:"destroyed",get:function(){var r;return!((r=this.hls)!=null&&r.userConfig)}},{key:"assetId",get:function(){return this.assetItem.identifier}},{key:"interstitialId",get:function(){return this.assetItem.parentIdentifier}},{key:"media",get:function(){var r;return((r=this.hls)==null?void 0:r.media)||null}},{key:"bufferedEnd",get:function(){var r=this.media||this.mediaAttached;if(!r)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;var e=Ae.bufferInfo(r,r.currentTime,.001);return this.getAssetTime(e.end)}},{key:"currentTime",get:function(){var r=this.media||this.mediaAttached;return r?this.getAssetTime(r.currentTime):this._currentTime||0}},{key:"duration",get:function(){var r=this.assetItem.duration;return r||0}},{key:"remaining",get:function(){var r=this.duration;return r?Math.max(0,r-this.currentTime):0}},{key:"startOffset",get:function(){return this.assetItem.startOffset}},{key:"timelineOffset",get:function(){var r;return((r=this.hls)==null?void 0:r.config.timelineOffset)||0},set:function(r){var e=this.timelineOffset;if(r!==e){var t=r-e;if(Math.abs(t)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=r}}}}])}(),Jo=.033,Bd=function(s){function o(r,e){var t;return t=s.call(this,"interstitials-sched",e)||this,t.onScheduleUpdate=void 0,t.eventMap={},t.events=null,t.items=null,t.durations={primary:0,playout:0,integrated:0},t.onScheduleUpdate=r,t}ae(o,s);var n=o.prototype;return n.destroy=function(){this.reset(),this.onScheduleUpdate=null},n.reset=function(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(function(e){return e.reset()}),this.events=this.items=null},n.resetErrorsInRange=function(e,t){return this.events?this.events.reduce(function(i,a){return e<=a.startOffset&&t>a.startOffset?(delete a.error,i+1):i},0):0},n.getEvent=function(e){return e&&this.eventMap[e]||null},n.hasEvent=function(e){return e in this.eventMap},n.findItemIndex=function(e,t){if(e.event)return this.findEventIndex(e.event.identifier);var i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);var a=this.items;if(a)for(a[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(l=a[i])!=null&&l.event;){var l;i--}return i},n.findItemIndexAtTime=function(e,t){var i=this.items;if(i)for(var a=0;a<i.length;a++){var l=i[a];if(t&&t!=="primary"&&(l=l[t]),e===l.start||e>l.start&&e<l.end)return a}return-1},n.findJumpRestrictedIndex=function(e,t){var i=this.items;if(i)for(var a=e;a<=t&&i[a];a++){var l=i[a].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return a}return-1},n.findEventIndex=function(e){var t=this.items;if(t)for(var i=t.length;i--;){var a;if(((a=t[i].event)==null?void 0:a.identifier)===e)return i}return-1},n.findAssetIndex=function(e,t){var i=e.assetList,a=i.length;if(a>1)for(var l=0;l<a;l++){var u=i[l];if(!u.error){var f=u.timelineStart;if(t===f||t>f&&t<f+(u.duration||0))return l}}return 0},n.parseInterstitialDateRanges=function(e,t){var i=this,a=e.main.details,l=a.dateRanges,u=this.events,f=this.parseDateRanges(l,{url:a.url},t),d=Object.keys(l),h=u?u.filter(function(c){return!d.includes(c.identifier)}):[];f.length&&f.sort(function(c,v){var g=c.cue.pre,m=c.cue.post,p=v.cue.pre,E=v.cue.post;if(g&&!p)return-1;if(p&&!g||m&&!E)return 1;if(E&&!m)return-1;if(!g&&!p&&!m&&!E){var S=c.startTime,T=v.startTime;if(S!==T)return S-T}return c.dateRange.tagOrder-v.dateRange.tagOrder}),this.events=f,h.forEach(function(c){i.removeEvent(c)}),this.updateSchedule(e,h)},n.updateSchedule=function(e,t){t===void 0&&(t=[]);var i=this.events||[];if(i.length||t.length||this.length<2){var a=this.items,l=this.parseSchedule(i,e),u=t.length||a?.length!==l.length||l.some(function(f,d){return Math.abs(f.playout.start-a[d].playout.start)>.005||Math.abs(f.playout.end-a[d].playout.end)>.005});u&&(this.items=l,this.onScheduleUpdate(t,a))}},n.parseDateRanges=function(e,t,i){for(var a=[],l=Object.keys(e),u=0;u<l.length;u++){var f=l[u],d=e[f];if(d.isInterstitial){var h=this.eventMap[f];h?h.setDateRange(d):(h=new Fd(d,t),this.eventMap[f]=h,i===!1&&(h.appendInPlace=i)),a.push(h)}}return a},n.parseSchedule=function(e,t){var i=[],a=t.main.details,l=a.live?1/0:a.edge,u=0;if(e=e.filter(function(E){return!E.error&&!(E.cue.once&&E.hasPlayed)}),e.length){this.resolveOffsets(e,t);var f=0,d=0;if(e.forEach(function(E,S){var T=E.cue.pre,A=E.cue.post,x=e[S-1]||null,I=E.appendInPlace,k=A?l:E.startOffset,D=E.duration,b=E.timelineOccupancy===Ln.Range?D:0,L=E.resumptionOffset,R=x?.startTime===k,C=k+E.cumulativeDuration,B=I?C+D:k+L;if(T||!A&&k<=0){var P=d;d+=b,E.timelineStart=C;var O=u;u+=D,i.push({event:E,start:C,end:B,playout:{start:O,end:u},integrated:{start:P,end:d}})}else if(k<=l){if(!R){var V=k-f;if(V>Jo){var X=f,z=d;d+=V;var Q=u;u+=V;var ue={previousEvent:e[S-1]||null,nextEvent:E,start:X,end:X+V,playout:{start:Q,end:u},integrated:{start:z,end:d}};i.push(ue)}else V>0&&x&&(x.cumulativeDuration+=V,i[i.length-1].end=k)}A&&(B=C),E.timelineStart=C;var te=d;d+=b;var le=u;u+=D,i.push({event:E,start:C,end:B,playout:{start:le,end:u},integrated:{start:te,end:d}})}else return;var ve=E.resumeTime;A||ve>l?f=l:f=ve}),f<l){var h,c=f,v=d,g=l-f;d+=g;var m=u;u+=g,i.push({previousEvent:((h=i[i.length-1])==null?void 0:h.event)||null,nextEvent:null,start:f,end:c+g,playout:{start:m,end:u},integrated:{start:v,end:d}})}this.setDurations(l,u,d)}else{var p=0;i.push({previousEvent:null,nextEvent:null,start:p,end:l,playout:{start:p,end:l},integrated:{start:p,end:l}}),this.setDurations(l,l,l)}return i},n.setDurations=function(e,t,i){this.durations={primary:e,playout:t,integrated:i}},n.resolveOffsets=function(e,t){var i=this,a=t.main.details,l=a.live?1/0:a.edge,u=0,f=-1;e.forEach(function(d,h){var c=d.cue.pre,v=d.cue.post,g=c?0:v?l:d.startTime;i.updateAssetDurations(d);var m=f===g;if(m?d.cumulativeDuration=u:(u=0,f=g),!v&&d.snapOptions.in&&(d.resumeAnchor=Vr(null,a.fragments,d.startOffset+d.resumptionOffset,0,0)||void 0),d.appendInPlace&&!d.appendInPlaceStarted){var p=i.primaryCanResumeInPlaceAt(d,t);p||(d.appendInPlace=!1)}if(!d.appendInPlace&&h+1<e.length){var E=e[h+1].startTime-e[h].resumeTime;E<Jo&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&i.warn("Could not change append strategy for abutting event "+d))}var S=H(d.resumeOffset)?d.resumeOffset:d.duration;u+=S})},n.primaryCanResumeInPlaceAt=function(e,t){var i=this,a=e.resumeTime,l=e.startTime+e.resumptionOffset;if(Math.abs(a-l)>ci)return this.log('"'+e.identifier+'" resumption '+a+" not aligned with estimated timeline end "+l),!1;if(!t)return this.log('"'+e.identifier+'" resumption '+a+" can not be aligned with media (none selected)"),!1;var u=Object.keys(t);return!u.some(function(f){var d=t[f].details,h=d.edge;if(a>=h)return i.log('"'+e.identifier+'" resumption '+a+" past "+f+" playlist end "+h),!1;var c=Vr(null,d.fragments,a);if(!c)return i.log('"'+e.identifier+'" resumption '+a+" does not align with any fragments in "+f+" playlist ("+d.fragStart+"-"+d.fragmentEnd+")"),!0;var v=f==="audio"?.175:0,g=Math.abs(c.start-a)<ci+v||Math.abs(c.end-a)<ci+v;return g?!1:(i.log('"'+e.identifier+'" resumption '+a+" not aligned with "+f+" fragment bounds ("+c.start+"-"+c.end+" sn: "+c.sn+" cc: "+c.cc+")"),!0)})},n.updateAssetDurations=function(e){if(e.assetListLoaded){var t=e.timelineStart,i=0,a=!1,l=!1;e.assetList.forEach(function(u,f){var d=t+i;u.startOffset=i,u.timelineStart=d,a||(a=u.duration===null),l||(l=!!u.error);var h=u.error?0:u.duration||0;i+=h}),a&&!l?e.duration=Math.max(i,e.duration):e.duration=i}},n.removeEvent=function(e){e.reset(),delete this.eventMap[e.identifier]},W(o,[{key:"duration",get:function(){var e=this.items;return e?e[e.length-1].end:0}},{key:"length",get:function(){return this.items?this.items.length:0}},{key:"assetIdAtEnd",get:function(){var e,t,i=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(i){var a=i.assetList,l=a[a.length-1];if(l)return l.identifier}return null}}])}(Z);function Pr(s){return"["+(s.event?'"'+s.event.identifier+'"':"primary")+": "+s.start.toFixed(2)+"-"+s.end.toFixed(2)+"]"}var Gd=function(){function s(n){this.hls=void 0,this.hls=n}var o=s.prototype;return o.destroy=function(){this.hls=null},o.loadAssetList=function(r,e){var t=this,i=r.assetListUrl,a;try{a=$o(i,this.hls.sessionId,r.baseUrl)}catch(m){var l=this.assignAssetListError(r,_.ASSET_LIST_LOAD_ERROR,m,i);this.hls.trigger(y.ERROR,l);return}e&&a.protocol!=="data:"&&a.searchParams.set("_HLS_start_offset",""+e);var u=this.hls.config,f=u.loader,d=new f(u),h={responseType:"json",url:a.href},c=u.interstitialAssetListLoadPolicy.default,v={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:function(p,E,S,T){var A=p.data,x=A?.ASSETS;if(!Array.isArray(x)){var I=t.assignAssetListError(r,_.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,E,T);t.hls.trigger(y.ERROR,I);return}r.assetListResponse=A,t.hls.trigger(y.ASSET_LIST_LOADED,{event:r,assetListResponse:A,networkDetails:T})},onError:function(p,E,S,T){var A=t.assignAssetListError(r,_.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status "+p.code+" "+p.text+" ("+E.url+")"),E.url,T,S);t.hls.trigger(y.ERROR,A)},onTimeout:function(p,E,S){var T=t.assignAssetListError(r,_.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST ("+E.url+")"),E.url,p,S);t.hls.trigger(y.ERROR,T)}};return d.load(h,v,g),this.hls.trigger(y.ASSET_LIST_LOADING,{event:r}),d},o.assignAssetListError=function(r,e,t,i,a,l){return r.error=t,{type:Y.NETWORK_ERROR,details:e,fatal:!1,interstitial:r,url:i,error:t,networkDetails:l,stats:a}},s}();function Zo(s){s?.play().catch(function(){})}var Kd=function(s){function o(r,e){var t;return t=s.call(this,"interstitials",r.logger)||this,t.HlsPlayerClass=void 0,t.hls=void 0,t.assetListLoader=void 0,t.mediaSelection=null,t.altSelection=null,t.media=null,t.detachedData=null,t.requiredTracks=null,t.manager=null,t.playerQueue=[],t.bufferedPos=-1,t.timelinePos=-1,t.schedule=void 0,t.playingItem=null,t.bufferingItem=null,t.waitingItem=null,t.endedItem=null,t.playingAsset=null,t.endedAsset=null,t.bufferingAsset=null,t.shouldPlay=!1,t.onPlay=function(){t.shouldPlay=!0},t.onPause=function(){t.shouldPlay=!1},t.onSeeking=function(){var i=t.currentTime;if(!(i===void 0||t.playbackDisabled)){var a=i-t.timelinePos,l=Math.abs(a)<1/7056e5;if(!l){var u=a<=-.01;t.timelinePos=i,t.bufferedPos=i;var f=t.playingItem;if(!f){t.checkBuffer();return}if(u){var d=t.schedule.resetErrorsInRange(i,i-a);d&&t.updateSchedule()}if(t.checkBuffer(),u&&i<f.start||i>=f.end){var h,c=t.schedule.findItemIndexAtTime(t.timelinePos);if(!t.isInterstitial(f)&&(h=t.media)!=null&&h.paused&&(t.shouldPlay=!1),!u){var v=t.findItemIndex(f);if(c>v){var g=t.schedule.findJumpRestrictedIndex(v+1,c);if(g>v){t.setSchedulePosition(g);return}}}t.setSchedulePosition(c);return}var m=t.playingAsset;if(!m){if(t.playingLastItem&&t.isInterstitial(f)){var p=f.event.assetList[0];p&&(t.endedItem=t.playingItem,t.playingItem=null,t.setScheduleToAssetAtTime(i,p))}return}var E=m.timelineStart,S=m.duration||0;(u&&i<E||i>=E+S)&&t.setScheduleToAssetAtTime(i,m)}}},t.onTimeupdate=function(){var i=t.currentTime;if(!(i===void 0||t.playbackDisabled)){if(i>t.timelinePos)t.timelinePos=i,i>t.bufferedPos&&t.checkBuffer();else return;var a=t.playingItem;if(!(!a||t.playingLastItem)){if(i>=a.end){t.timelinePos=a.end;var l=t.findItemIndex(a);t.setSchedulePosition(l+1)}var u=t.playingAsset;if(u){var f=u.timelineStart+(u.duration||0);i>=f&&t.setScheduleToAssetAtTime(i,u)}}}},t.onScheduleUpdate=function(i,a){var l=t.schedule,u=t.playingItem,f=l.events||[],d=l.items||[],h=l.durations,c=i.map(function(S){return S.identifier}),v=!!(f.length||c.length);(v||a)&&t.log("INTERSTITIALS_UPDATED ("+f.length+"): "+f+`
Schedule: `+d.map(function(S){return Pr(S)})+" pos: "+t.timelinePos),c.length&&t.log("Removed events "+c),t.playerQueue.forEach(function(S){if(S.interstitial.appendInPlace){var T=S.assetItem.timelineStart,A=S.timelineOffset-T;if(A)try{S.timelineOffset=T}catch(x){Math.abs(A)>ci&&t.warn(x+' ("'+S.assetId+'" '+S.timelineOffset+"->"+T+")")}}});var g=null;if(u){var m=t.updateItem(u,t.timelinePos);t.itemsMatch(u,m)&&(t.playingItem=m,t.waitingItem=t.endedItem=null,g=function(){return t.trimInPlace(m,u)})}else t.waitingItem=t.updateItem(t.waitingItem),t.endedItem=t.updateItem(t.endedItem);var p=t.bufferingItem;if(p){var E=t.updateItem(p,t.bufferedPos);t.itemsMatch(p,E)?(t.bufferingItem=E,g||(g=function(){return t.trimInPlace(E,p)})):p.event&&(t.bufferingItem=t.playingItem,t.clearInterstitial(p.event,null))}if(i.forEach(function(S){S.assetList.forEach(function(T){t.clearAssetPlayer(T.identifier,null)})}),v||a){if(t.hls.trigger(y.INTERSTITIALS_UPDATED,{events:f.slice(0),schedule:d.slice(0),durations:h,removedIds:c}),t.isInterstitial(u)&&c.includes(u.event.identifier)){t.warn('Interstitial "'+u.event.identifier+'" removed while playing'),t.primaryFallback(u.event);return}g&&g(),t.checkBuffer()}},t.hls=r,t.HlsPlayerClass=e,t.assetListLoader=new Gd(r),t.schedule=new Bd(t.onScheduleUpdate,r.logger),t.registerListeners(),t}ae(o,s);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(y.MEDIA_ENDED,this.onMediaEnded,this),e.on(y.ERROR,this.onError,this),e.on(y.DESTROYING,this.onDestroying,this)},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(y.MEDIA_ENDED,this.onMediaEnded,this),e.off(y.ERROR,this.onError,this),e.off(y.DESTROYING,this.onDestroying,this))},n.startLoad=function(){this.resumeBuffering()},n.stopLoad=function(){this.pauseBuffering()},n.resumeBuffering=function(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()},n.pauseBuffering=function(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()},n.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null},n.onDestroying=function(){var e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)},n.removeMediaListeners=function(e){rr(e,"play",this.onPlay),rr(e,"pause",this.onPause),rr(e,"seeking",this.onSeeking),rr(e,"timeupdate",this.onTimeupdate)},n.onMediaAttaching=function(e,t){var i=this.media=t.media;Qt(i,"seeking",this.onSeeking),Qt(i,"timeupdate",this.onTimeupdate),Qt(i,"play",this.onPlay),Qt(i,"pause",this.onPause)},n.onMediaAttached=function(e,t){var i=this.effectivePlayingItem,a=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!a){this.clearScheduleState();var l=this.findItemIndex(i);this.setSchedulePosition(l)}},n.clearScheduleState=function(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null},n.onMediaDetaching=function(e,t){var i=!!t.transferMedia,a=this.media;if(this.media=null,!i&&(a&&this.removeMediaListeners(a),this.detachedData)){var l=this.getBufferingPlayer();l&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}},n.isInterstitial=function(e){return!!(e!=null&&e.event)},n.retreiveMediaSource=function(e,t){var i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)},n.transferMediaFromPlayer=function(e,t){var i=e.interstitial.appendInPlace,a=e.media;if(i&&a===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&a){this.detachedData={media:a};return}var l=e.transferMedia();this.log("transfer MediaSource from "+e+" "+Ke(l)),this.detachedData=l}else t&&a&&(this.shouldPlay||(this.shouldPlay=!a.paused))},n.transferMediaTo=function(e,t){var i,a=this,l;if(e.media!==t){var u=null,f=this.hls,d=e!==f,h=d&&e.interstitial.appendInPlace,c=(i=this.detachedData)==null?void 0:i.mediaSource,v;if(f.media)h&&(u=f.transferMedia(),this.detachedData=u),v="Primary";else if(c){var g=this.getBufferingPlayer();g?(u=g.transferMedia(),v=""+g):v="detached MediaSource"}else v="detached media";if(!u){if(c)u=this.detachedData,this.log("using detachedData: MediaSource "+Ke(u));else if(!this.detachedData||f.media===t){var m=this.playerQueue;m.length>1&&m.forEach(function(T){if(d&&T.interstitial.appendInPlace!==h){var A=T.interstitial;a.clearInterstitial(T.interstitial,null),A.appendInPlace=!1,A.appendInPlace&&a.warn("Could not change append strategy for queued assets "+A)}}),this.hls.detachMedia(),this.detachedData={media:t}}}var p=u&&"mediaSource"in u&&((l=u.mediaSource)==null?void 0:l.readyState)!=="closed",E=p&&u?u:t;if(this.log((p?"transfering MediaSource":"attaching media")+" to "+(d?e:"Primary")+" from "+v),E===u){var S=d&&e.assetId===this.schedule.assetIdAtEnd;E.overrides={duration:this.schedule.duration,endOfStream:!d||S,cueRemoval:!d}}e.attachMedia(E)}},n.onInterstitialCueEnter=function(){this.onTimeupdate()},n.checkStart=function(){var e=this.schedule,t=e.events;if(!(!t||this.playbackDisabled||!this.media)){this.bufferedPos===-1&&(this.bufferedPos=0);var i=this.timelinePos,a=this.effectivePlayingItem;if(i===-1){var l=this.hls.startPosition;if(this.timelinePos=l,t.length&&t[0].cue.pre){var u=e.findEventIndex(t[0].identifier);this.setSchedulePosition(u)}else if(l>=0||!this.primaryLive){var f=this.timelinePos=l>0?l:0,d=e.findItemIndexAtTime(f);this.setSchedulePosition(d)}}else if(a&&!this.playingItem){var h=e.findItemIndex(a);this.setSchedulePosition(h)}}},n.advanceAfterAssetEnded=function(e,t,i){var a=Fa(e,i);if(!e.isAssetPastPlayoutLimit(a))this.setSchedulePosition(t,a);else{var l=this.schedule.items;if(l){var u=t+1,f=l.length;if(u>=f){this.setSchedulePosition(-1);return}var d=e.resumeTime;this.timelinePos<d&&(this.timelinePos=d,this.checkBuffer()),this.setSchedulePosition(u)}}},n.setScheduleToAssetAtTime=function(e,t){var i=this.schedule,a=t.parentIdentifier,l=i.getEvent(a);if(l){var u=i.findEventIndex(a),f=i.findAssetIndex(l,e);this.advanceAfterAssetEnded(l,u,f-1)}},n.setSchedulePosition=function(e,t){var i=this.schedule.items;if(!(!i||this.playbackDisabled)){this.log("setSchedulePosition "+e+", "+t);var a=e>=0?i[e]:null,l=this.playingItem,u=this.playingLastItem;if(this.isInterstitial(l)){var f,d=l.event,h=this.playingAsset,c=h?.identifier,v=c?this.getAssetPlayer(c):null;if(v&&c&&(!this.eventItemsMatch(l,a)||t!==void 0&&c!==((f=d.assetList)==null?void 0:f[t].identifier))){var g,m=d.findAssetIndex(h);if(this.log("INTERSTITIAL_ASSET_ENDED "+(m+1)+"/"+d.assetList.length+" "+vi(h)),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(y.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:m,event:d,schedule:i.slice(0),scheduleIndex:e,player:v}),l!==this.playingItem){this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(d,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(c,a),v.media&&!((g=this.detachedData)!=null&&g.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(l,a)&&(this.endedItem=l,this.playingItem=null,this.log("INTERSTITIAL_ENDED "+d+" "+Pr(l)),d.hasPlayed=!0,this.hls.trigger(y.INTERSTITIAL_ENDED,{event:d,schedule:i.slice(0),scheduleIndex:e}),d.cue.once)){this.updateSchedule();var p=this.schedule.items;if(a&&p){var E=this.findItemIndex(a);this.advanceSchedule(E,p,t,l,u)}return}}this.advanceSchedule(e,i,t,l,u)}},n.advanceSchedule=function(e,t,i,a,l){var u=this,f=e>=0?t[e]:null,d=this.primaryMedia,h=this.playerQueue;if(h.length&&h.forEach(function(A){var x=A.interstitial,I=u.schedule.findEventIndex(x.identifier);(I<e||I>e+1)&&u.clearInterstitial(x,f)}),this.isInterstitial(f)){this.timelinePos=Math.min(Math.max(this.timelinePos,f.start),f.end);var c=f.event;if(i===void 0){i=this.schedule.findAssetIndex(c,this.timelinePos);var v=Fa(c,i-1);if(c.isAssetPastPlayoutLimit(v)){this.advanceAfterAssetEnded(c,e,i);return}i=v}var g=this.waitingItem;this.assetsBuffered(f,d)||this.setBufferingItem(f);var m=this.preloadAssets(c,i);if(this.eventItemsMatch(f,g||a)||(this.waitingItem=f,this.log("INTERSTITIAL_STARTED "+Pr(f)+" "+(c.appendInPlace?"append in place":"")),this.hls.trigger(y.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log("Waiting for ASSET-LIST to complete loading "+c);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!d){this.log("Waiting for attachMedia to start Interstitial "+c);return}this.waitingItem=this.endedItem=null,this.playingItem=f;var p=c.assetList[i];if(!p){var E=t[e+1],S=this.media;E&&S&&!this.isInterstitial(E)&&S.currentTime<E.start&&(S.currentTime=this.timelinePos=E.start),this.advanceAfterAssetEnded(c,e,i||0);return}if(m||(m=this.getAssetPlayer(p.identifier)),m===null||m.destroyed){var T=c.assetList.length;this.warn("asset "+(i+1)+"/"+T+" player destroyed "+c),m=this.createAssetPlayer(c,p,i)}if(!this.eventItemsMatch(f,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(p))return;this.startAssetPlayer(m,i,t,e,d),this.shouldPlay&&Zo(m.media)}else f!==null?(this.resumePrimary(f,e,a),this.shouldPlay&&Zo(this.hls.media)):l&&this.isInterstitial(a)&&(this.endedItem=null,this.playingItem=a,a.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))},n.resumePrimary=function(e,t,i){var a;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log("resuming "+Pr(e)),!((a=this.detachedData)!=null&&a.mediaSource)){var l=this.timelinePos;(l<e.start||l>=e.end)&&(l=this.getPrimaryResumption(e,t),this.timelinePos=l),this.attachPrimary(l,e)}if(i){var u=this.schedule.items;u&&(this.log("INTERSTITIALS_PRIMARY_RESUMED "+Pr(e)),this.hls.trigger(y.INTERSTITIALS_PRIMARY_RESUMED,{schedule:u.slice(0),scheduleIndex:t}),this.checkBuffer())}},n.getPrimaryResumption=function(e,t){var i=e.start;if(this.primaryLive){var a=this.primaryDetails;if(t===0)return this.hls.startPosition;if(a&&(i<a.fragmentStart||i>a.edge))return this.hls.liveSyncPosition||-1}return i},n.isAssetBuffered=function(e){var t=this.getAssetPlayer(e.identifier);if(t!=null&&t.hls)return t.hls.bufferedToEnd;var i=Ae.bufferInfo(this.primaryMedia,this.timelinePos,0);return i.end+1>=e.timelineStart+(e.duration||0)},n.attachPrimary=function(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;var a=this.primaryMedia;if(a){var l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,a),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}},n.startLoadingPrimaryAt=function(e,t){var i,a=this.hls;!a.loadingEnabled||!a.media||Math.abs((((i=a.mainForwardBufferInfo)==null?void 0:i.start)||a.media.currentTime)-e)>.5?a.startLoad(e,t):a.bufferingEnabled||a.resumeBuffering()},n.onManifestLoading=function(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(y.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(y.BUFFER_CODECS,this.onBufferCodecs,this)},n.onLevelUpdated=function(e,t){if(t.level!==-1){var i=this.hls.levels[t.level],a=Ee(Ee({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=a,this.schedule.parseInterstitialDateRanges(a,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}},n.onAudioTrackUpdated=function(e,t){var i=this.hls.audioTracks[t.id],a=this.mediaSelection;if(!a){this.altSelection=Ee(Ee({},this.altSelection),{},{audio:i});return}var l=Ee(Ee({},a),{},{audio:i});this.mediaSelection=l},n.onSubtitleTrackUpdated=function(e,t){var i=this.hls.subtitleTracks[t.id],a=this.mediaSelection;if(!a){this.altSelection=Ee(Ee({},this.altSelection),{},{subtitles:i});return}var l=Ee(Ee({},a),{},{subtitles:i});this.mediaSelection=l},n.onAudioTrackSwitching=function(e,t){var i=ms(t);this.playerQueue.forEach(function(a){return a.hls.setAudioOption(t)||a.hls.setAudioOption(i)})},n.onSubtitleTrackSwitch=function(e,t){var i=ms(t);this.playerQueue.forEach(function(a){return a.hls.setSubtitleOption(t)||t.id!==-1&&a.hls.setSubtitleOption(i)})},n.onBufferCodecs=function(e,t){var i=t.tracks;i&&(this.requiredTracks=i)},n.onBufferAppended=function(e,t){this.checkBuffer()},n.onBufferFlushed=function(e,t){var i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){var a=this.timelinePos;this.bufferedPos=a,this.checkBuffer()}},n.onBufferedToEnd=function(e){var t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(var i=0;i<t.length;i++){var a=t[i];if(a.cue.post){var l,u=this.schedule.findEventIndex(a.identifier),f=(l=this.schedule.items)==null?void 0:l[u];this.isInterstitial(f)&&this.eventItemsMatch(f,this.bufferingItem)&&this.bufferedToItem(f,0);break}}this.bufferedPos=Number.MAX_VALUE}},n.onMediaEnded=function(e){var t=this.playingItem;if(!this.playingLastItem&&t){var i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1},n.updateItem=function(e,t){var i=this.schedule.items;if(e&&i){var a=this.findItemIndex(e,t);return i[a]||null}return null},n.trimInPlace=function(e,t){var i=this;if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach(function(u,f){e.event.isAssetPastPlayoutLimit(f)&&i.clearAssetPlayer(u.identifier,null)});var a=e.end+.25,l=Ae.bufferInfo(this.primaryMedia,a,0);(l.end>a||(l.nextStart||0)>a)&&(this.attachPrimary(a,null),this.flushFrontBuffer(a))}},n.itemsMatch=function(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))},n.eventItemsMatch=function(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))},n.findItemIndex=function(e,t){return e?this.schedule.findItemIndex(e,t):-1},n.updateSchedule=function(){var e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])},n.checkBuffer=function(e){var t=this.schedule.items;if(t){var i=Ae.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,t,e)}},n.updateBufferedPos=function(e,t,i){var a=this.schedule,l=this.bufferingItem;if(!(this.bufferedPos>e)){if(t.length===1&&this.itemsMatch(t[0],l)){this.bufferedPos=e;return}var u=this.playingItem,f=this.findItemIndex(u),d=a.findItemIndexAtTime(e);if(this.bufferedPos<e){var h,c,v=this.findItemIndex(l),g=Math.min(v+1,t.length-1),m=t[g];if((d===-1&&l&&e>=l.end||(h=m.event)!=null&&h.appendInPlace&&e+.01>=m.start)&&(d=g),g-f>1&&(l==null||(c=l.event)==null?void 0:c.appendInPlace)===!1)return;if(this.bufferedPos=e,d>v&&d>f)this.bufferedToItem(m);else{var p=this.primaryDetails;this.primaryLive&&p&&e>p.edge-p.targetduration&&m.start<p.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(m)&&this.preloadAssets(m.event,0)}}else i&&u&&!this.itemsMatch(u,l)&&(d===f?this.bufferedToItem(u):d===f+1&&this.bufferedToItem(t[d]))}},n.assetsBuffered=function(e,t){var i=this,a=e.event.assetList;return a.length===0?!1:!e.event.assetList.some(function(l){var u=i.getAssetPlayer(l.identifier);return!(u!=null&&u.bufferedInPlaceToEnd(t))})},n.setBufferingItem=function(e){var t=this,i=this.bufferingItem,a=this.schedule;if(this.itemsMatch(e,i))this.bufferingItem!==e&&(this.bufferingItem=e);else{var l=a.items,u=a.events;if(!l||!u)return i;var f=this.isInterstitial(e),d=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));var h=d?d.remaining:i?i.end-this.timelinePos:0;this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY "+Pr(e)+(i?" ("+h.toFixed(2)+" remaining)":"")),this.playbackDisabled||(f?e.event.assetList.forEach(function(c){var v=t.getAssetPlayer(c.identifier);v&&v.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(function(c){return c.pauseBuffering()}))),this.hls.trigger(y.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:u.slice(0),schedule:l.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return i},n.bufferedToItem=function(e,t){t===void 0&&(t=0);var i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;var a=this.detachedData;if(a)if(a.mediaSource){var l=!0;this.attachPrimary(e.start,e,l)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}},n.preloadPrimary=function(e){var t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)},n.bufferedToEvent=function(e,t){var i=e.event,a=i.assetList.length===0&&!i.assetListLoader,l=i.cue.once;if(a||!l){var u=this.preloadAssets(i,t);if(u!=null&&u.interstitial.appendInPlace){var f=i.assetList[t],d=this.primaryMedia;f&&d&&this.bufferAssetPlayer(u,d)}}},n.preloadAssets=function(e,t){var i=e.assetUrl,a=e.assetList.length,l=a===0&&!e.assetListLoader,u=e.cue.once;if(l){var f=e.timelineStart;if(e.appendInPlace){var d,h=this.playingItem;!this.isInterstitial(h)&&(h==null||(d=h.nextEvent)==null?void 0:d.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}var c,v=0;if(!this.playingItem&&this.primaryLive&&(v=this.hls.startPosition,v===-1&&(v=this.hls.liveSyncPosition||0)),v&&!(e.cue.pre||e.cue.post)){var g=v-f;g>0&&(c=Math.round(g*1e3)/1e3)}if(this.log("Load interstitial asset "+(t+1)+"/"+(i?1:a)+" "+e+(c?" live-start: "+v+" start-offset: "+c:"")),i)return this.createAsset(e,0,0,f,e.duration,i);var m=this.assetListLoader.loadAssetList(e,c);m&&(e.assetListLoader=m)}else if(!u&&a){for(var p=t;p<a;p++){var E=e.assetList[p],S=this.getAssetPlayerQueueIndex(E.identifier);(S===-1||this.playerQueue[S].destroyed)&&!E.error&&this.createAssetPlayer(e,E,p)}return this.getAssetPlayer(e.assetList[t].identifier)}return null},n.flushFrontBuffer=function(e){var t=this,i=this.requiredTracks;if(i){this.log("Removing front buffer starting at "+e);var a=Object.keys(i);a.forEach(function(l){t.hls.trigger(y.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:l})})}},n.getAssetPlayerQueueIndex=function(e){for(var t=this.playerQueue,i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1},n.getAssetPlayer=function(e){var t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null},n.getBufferingPlayer=function(){var e=this.playerQueue,t=this.primaryMedia;if(t){for(var i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null},n.createAsset=function(e,t,i,a,l,u){var f={parentIdentifier:e.identifier,identifier:Od(e,u,t),duration:l,startOffset:i,timelineStart:a,uri:u};return this.createAssetPlayer(e,f,t)},n.createAssetPlayer=function(e,t,i){var a=this,l=this.hls,u=l.userConfig,f=u.videoPreference,d=l.loadLevelObj||l.levels[l.currentLevel];(f||d)&&(f=re({},f),d.videoCodec&&(f.videoCodec=d.videoCodec),d.videoRange&&(f.allowedVideoRanges=[d.videoRange]));var h=l.audioTracks[l.audioTrack],c=l.subtitleTracks[l.subtitleTrack],v=0;if(this.primaryLive||e.appendInPlace){var g=this.timelinePos-t.timelineStart;if(g>1){var m=t.duration;m&&g<m&&(v=g)}}var p=t.identifier,E=Ee(Ee({},u),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:l.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:l.bandwidthEstimate,interstitialsController:void 0,startPosition:v,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:f,audioPreference:h||u.audioPreference,subtitlePreference:c||u.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(E.timelineOffset=t.timelineStart));var S=E.cmcd;S!=null&&S.sessionId&&S.contentId&&(E.cmcd=re({},S,{contentId:Bi(t.uri)})),this.getAssetPlayer(p)&&this.warn("Duplicate date range identifier "+e+" and asset "+p);var T=new Ud(this.HlsPlayerClass,E,e,t);this.playerQueue.push(T),e.assetList[i]=t;var A=function(b){if(b.live){var L=new Error("Interstitials MUST be VOD assets "+e),R={fatal:!0,type:Y.OTHER_ERROR,details:_.INTERSTITIAL_ASSET_ITEM_ERROR,error:L};a.handleAssetItemError(R,e,a.schedule.findEventIndex(e.identifier),i,L.message);return}var C=b.edge-b.fragmentStart,B=t.duration;(B===null||C>B)&&(a.log('Interstitial asset "'+p+'" duration change '+B+" > "+C),t.duration=C,a.updateSchedule())};T.on(y.LEVEL_UPDATED,function(D,b){var L=b.details;return A(L)}),T.on(y.LEVEL_PTS_UPDATED,function(D,b){var L=b.details;return A(L)});var x=function(b,L){var R=a.getAssetPlayer(p);if(R&&L.tracks){R.off(y.BUFFER_CODECS,x),R.tracks=L.tracks;var C=a.primaryMedia;a.bufferingAsset===R.assetItem&&C&&!R.media&&a.bufferAssetPlayer(R,C)}};T.on(y.BUFFER_CODECS,x);var I=function(){var b,L=a.getAssetPlayer(p);if(a.log("buffered to end of asset "+L),!!L){var R=a.schedule.findEventIndex(e.identifier),C=(b=a.schedule.items)==null?void 0:b[R];if(a.isInterstitial(C)){var B=e.findAssetIndex(t),P=Fa(e,B);if(!e.isAssetPastPlayoutLimit(P))a.bufferedToItem(C,P);else{var O,V=(O=a.schedule.items)==null?void 0:O[R+1];V&&a.bufferedToItem(V)}}}};T.on(y.BUFFERED_TO_END,I);var k=function(b){return function(){var L=a.getAssetPlayer(p);if(L){a.shouldPlay=!0;var R=a.schedule.findEventIndex(e.identifier);a.advanceAfterAssetEnded(e,R,b)}}};return T.once(y.MEDIA_ENDED,k(i)),T.once(y.PLAYOUT_LIMIT_REACHED,k(1/0)),T.on(y.ERROR,function(D,b){var L=a.getAssetPlayer(p);if(b.details===_.BUFFER_STALLED_ERROR){if(L!=null&&L.media){var R=L.currentTime,C=L.duration-R;R&&e.appendInPlace&&C/L.media.playbackRate<.5?(a.log("Advancing buffer past end of asset "+p+" "+e+" at "+L.media.currentTime),I()):(a.warn("Stalled at "+R+" of "+(R+C)+" in asset "+p+" "+e),a.onTimeupdate(),a.checkBuffer(!0))}return}a.handleAssetItemError(b,e,a.schedule.findEventIndex(e.identifier),i,"Asset player error "+b.error+" "+e)}),T.on(y.DESTROYING,function(){var D=a.getAssetPlayer(p);if(D){var b=new Error("Asset player destroyed unexpectedly "+p),L={fatal:!0,type:Y.OTHER_ERROR,details:_.INTERSTITIAL_ASSET_ITEM_ERROR,error:b};a.handleAssetItemError(L,e,a.schedule.findEventIndex(e.identifier),i,b.message)}}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED "+vi(t)),this.hls.trigger(y.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:T}),T},n.clearInterstitial=function(e,t){var i=this;e.assetList.forEach(function(a){i.clearAssetPlayer(a.identifier,t)}),e.reset()},n.resetAssetPlayer=function(e){var t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log('reset asset player "'+e+'" after error');var i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}},n.clearAssetPlayer=function(e,t){var i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log('clear asset player "'+e+'" toSegment: '+(t&&Pr(t)));var a=this.playerQueue[i];this.transferMediaFromPlayer(a,t),this.playerQueue.splice(i,1),a.destroy()}},n.emptyPlayerQueue=function(){for(var e;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]},n.startAssetPlayer=function(e,t,i,a,l){var u=e.interstitial,f=e.assetItem,d=e.assetId,h=u.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=f,(!c||c.identifier!==d)&&(c&&(this.clearAssetPlayer(c.identifier,i[a]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED "+(t+1)+"/"+h+" "+vi(f)),this.hls.trigger(y.INTERSTITIAL_ASSET_STARTED,{asset:f,assetListIndex:t,event:u,schedule:i.slice(0),scheduleIndex:a,player:e})),this.bufferAssetPlayer(e,l)},n.bufferAssetPlayer=function(e,t){var i,a,l=e.interstitial,u=e.assetItem,f=this.schedule.findEventIndex(l.identifier),d=(i=this.schedule.items)==null?void 0:i[f];if(d){this.setBufferingItem(d),this.bufferingAsset=u;var h=this.getBufferingPlayer();if(h!==e){var c=l.appendInPlace;if(!(c&&h?.interstitial.appendInPlace===!1)){var v=h?.tracks||((a=this.detachedData)==null?void 0:a.tracks)||this.requiredTracks;if(c&&u!==this.playingAsset){if(!e.tracks)return;if(v&&!st(v,e.tracks)){var g=new Error("Asset "+vi(u)+" SourceBuffer tracks ('"+Object.keys(e.tracks)+"') are not compatible with primary content tracks ('"+Object.keys(v)+"')"),m={fatal:!0,type:Y.OTHER_ERROR,details:_.INTERSTITIAL_ASSET_ITEM_ERROR,error:g},p=l.findAssetIndex(u);this.handleAssetItemError(m,l,f,p,g.message);return}}this.transferMediaTo(e,t)}}}},n.handleAssetItemError=function(e,t,i,a,l){if(e.details!==_.BUFFER_STALLED_ERROR){var u=t.assetList[a];this.warn("INTERSTITIAL_ASSET_ERROR "+(u&&vi(u))+" "+e.error);var f=u?.identifier,d=this.getAssetPlayerQueueIndex(f),h=this.playerQueue[d]||null,c=this.schedule.items,v=re({},e,{fatal:!1,errorAction:ki(!0),asset:u,assetListIndex:a,event:t,schedule:c,scheduleIndex:i,player:h});if(this.hls.trigger(y.INTERSTITIAL_ASSET_ERROR,v),!!e.fatal){var g=this.playingAsset,m=new Error(l);if(u&&(this.clearAssetPlayer(f,null),u.error=m),!t.assetList.some(function(E){return!E.error}))t.error=m;else{for(var p=a;p<t.assetList.length;p++)this.resetAssetPlayer(t.assetList[p].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):g&&g.identifier===f&&this.advanceAfterAssetEnded(t,i,a)}}},n.primaryFallback=function(e){var t=e.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log('Fallback to primary from event "'+e.identifier+'" start: '+t+" pos: "+this.timelinePos+" playing: "+(i?Pr(i):"<none>")+" error: "+e.error);var a=this.timelinePos;a===-1&&(a=this.hls.startPosition);var l=this.updateItem(i,a);this.itemsMatch(i,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));var u=this.schedule.findItemIndexAtTime(a);this.setSchedulePosition(u)}else this.checkStart()},n.onAssetListLoaded=function(e,t){var i=this,a,l=t.event,u=l.identifier,f=t.assetListResponse.ASSETS;if(this.schedule.hasEvent(u)){var d=l.timelineStart,h=l.duration,c=0;f.forEach(function(k,D){var b=parseFloat(k.DURATION);i.createAsset(l,D,c,d+c,b,k.URI),c+=b}),l.duration=c,this.log("Loaded asset-list with duration: "+c+" (was: "+h+") "+l);var v=this.waitingItem,g=v?.event.identifier===u;this.updateSchedule();var m=(a=this.bufferingItem)==null?void 0:a.event;if(g){var p,E=this.schedule.findEventIndex(u),S=(p=this.schedule.items)==null?void 0:p[E];if(S){if(!this.playingItem&&this.timelinePos>S.end){var T=this.schedule.findItemIndexAtTime(this.timelinePos);if(T!==E){l.error=new Error("Interstitial no longer within playback range "+this.timelinePos+" "+l),this.primaryFallback(l);return}}this.setBufferingItem(S)}this.setSchedulePosition(E)}else if(m?.identifier===u&&m.appendInPlace){var A=l.assetList[0],x=this.getAssetPlayer(A.identifier),I=this.primaryMedia;A&&x&&I&&this.bufferAssetPlayer(x,I)}}},n.onError=function(e,t){switch(t.details){case _.ASSET_LIST_PARSING_ERROR:case _.ASSET_LIST_LOAD_ERROR:case _.ASSET_LIST_LOAD_TIMEOUT:{var i=t.interstitial;i&&this.primaryFallback(i);break}case _.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}},W(o,[{key:"interstitialsManager",get:function(){if(!this.manager){if(!this.hls)return null;var e=this,t=function(){return e.bufferingItem||e.waitingItem},i=function(g){return g&&e.getAssetPlayer(g.identifier)},a=function(g,m,p,E,S){if(g){var T=g[m].start,A=g.event;if(A){if(m==="playout"||A.timelineOccupancy!==Ln.Point){var x=i(p);x?.interstitial===A&&(T+=x.assetItem.startOffset+x[S])}}else{var I=E==="bufferedPos"?u():e[E];T+=I-g.start}return T}return 0},l=function(g,m){if(g!==0&&m!=="primary"&&e.schedule.length){var p,E=e.schedule.findItemIndexAtTime(g),S=(p=e.schedule.items)==null?void 0:p[E];if(S){var T=S[m].start-S.start;return g+T}}return g},u=function(){var g=e.bufferedPos;return g===Number.MAX_VALUE?f("primary"):Math.max(g,0)},f=function(g){var m;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:e.schedule.durations[g]},d=function(g,m){var p,E,S=e.effectivePlayingItem;if(!(S!=null&&(p=S.event)!=null&&p.restrictions.skip)){e.log("seek to "+g+' "'+m+'"');var T=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(g,m),x=(E=e.schedule.items)==null?void 0:E[A],I=e.getBufferingPlayer(),k=I?.interstitial,D=k?.appendInPlace,b=T&&e.itemsMatch(T,x);if(T&&(D||b)){var L=i(e.playingAsset),R=L?.media||e.primaryMedia;if(R){var C=m==="primary"?R.currentTime:a(T,m,e.playingAsset,"timelinePos","currentTime"),B=g-C,P=(D?C:R.currentTime)+B;if(P>=0&&(!L||D||P<=L.duration)){R.currentTime=P;return}}}if(x){var O=g;if(m!=="primary"){var V=x[m].start,X=g-V;O=x.start+X}var z=!e.isInterstitial(x);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(z||x.event.appendInPlace)){var Q=e.media||(D?I?.media:null);Q&&(Q.currentTime=O)}else if(T){var ue=e.findItemIndex(T);if(A>ue){var te=e.schedule.findJumpRestrictedIndex(ue+1,A);if(te>ue){e.setSchedulePosition(te);return}}var le=0;if(z)e.timelinePos=O,e.checkBuffer();else{var ve,Te=x==null||(ve=x.event)==null?void 0:ve.assetList;if(Te)for(var ke=g-(x[m]||x).start,Me=Te.length;Me--;){var Ge=Te[Me];if(Ge.duration&&ke>=Ge.startOffset&&ke<Ge.startOffset+Ge.duration){le=Me;break}}}e.setSchedulePosition(A,le)}}}},h=function(){var g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;var m=t();return e.isInterstitial(m)?m:null},c={get currentTime(){var v=h(),g=e.effectivePlayingItem;return g&&g===v?a(g,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-g.playout.start:0},set currentTime(v){var g=h(),m=e.effectivePlayingItem;m&&m===g&&d(v+m.playout.start,"playout")},get duration(){var v=h();return v?v.playout.end-v.playout.start:0},get assetPlayers(){var v,g=(v=h())==null?void 0:v.event.assetList;return g?g.map(function(m){return e.getAssetPlayer(m.identifier)}):[]},get playingIndex(){var v,g=(v=h())==null?void 0:v.event;return g&&e.effectivePlayingAsset?g.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return h()}};this.manager={get events(){var v,g;return((v=e.schedule)==null||(g=v.events)==null?void 0:g.slice(0))||[]},get schedule(){var v,g;return((v=e.schedule)==null||(g=v.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return h()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){var v=t();return e.findItemIndex(v)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){var v=e.effectivePlayingItem;return e.findItemIndex(v)},primary:{get bufferedEnd(){return u()},get currentTime(){var v=e.timelinePos;return v>0?v:0},set currentTime(v){d(v,"primary")},get duration(){return f("primary")},get seekableStart(){var v;return((v=e.primaryDetails)==null?void 0:v.fragmentStart)||0}},integrated:{get bufferedEnd(){return a(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return a(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(v){d(v,"integrated")},get duration(){return f("integrated")},get seekableStart(){var v;return l(((v=e.primaryDetails)==null?void 0:v.fragmentStart)||0,"integrated")}},skip:function(){var g=e.effectivePlayingItem,m=g?.event;if(m&&!m.restrictions.skip){var p=e.findItemIndex(g);if(m.appendInPlace){var E=g.playout.start+g.event.duration;d(E+.001,"playout")}else e.advanceAfterAssetEnded(m,p,1/0)}}}}return this.manager}},{key:"effectivePlayingItem",get:function(){return this.waitingItem||this.playingItem||this.endedItem}},{key:"effectivePlayingAsset",get:function(){return this.playingAsset||this.endedAsset}},{key:"playingLastItem",get:function(){var e,t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}},{key:"playbackStarted",get:function(){return this.effectivePlayingItem!==null}},{key:"currentTime",get:function(){var e,t,i;if(this.mediaSelection!==null){var a=this.waitingItem||this.playingItem;if(!(this.isInterstitial(a)&&!a.event.appendInPlace)){var l=this.media;!l&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(l=this.primaryMedia);var u=(i=l)==null?void 0:i.currentTime;if(!(u===void 0||!H(u)))return u}}}},{key:"primaryMedia",get:function(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}},{key:"playbackDisabled",get:function(){return this.hls.config.enableInterstitialPlayback===!1}},{key:"primaryDetails",get:function(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}},{key:"primaryLive",get:function(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}}])}(Z),el=500,Hd=function(s){function o(r,e,t){var i;return i=s.call(this,r,e,t,"subtitle-stream-controller",F.SUBTITLE)||this,i.currentTrackId=-1,i.tracksBuffered=[],i.mainDetails=null,i.registerListeners(),i}ae(o,s);var n=o.prototype;return n.onHandlerDestroying=function(){this.unregisterListeners(),s.prototype.onHandlerDestroying.call(this),this.mainDetails=null},n.registerListeners=function(){s.prototype.registerListeners.call(this);var e=this.hls;e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)},n.unregisterListeners=function(){s.prototype.unregisterListeners.call(this);var e=this.hls;e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this)},n.startLoad=function(e,t){this.stopLoad(),this.state=M.IDLE,this.setInterval(el),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()},n.onManifestLoading=function(){s.prototype.onManifestLoading.call(this),this.mainDetails=null},n.onMediaDetaching=function(e,t){this.tracksBuffered=[],s.prototype.onMediaDetaching.call(this,e,t)},n.onLevelLoaded=function(e,t){this.mainDetails=t.details},n.onSubtitleFragProcessed=function(e,t){var i=t.frag,a=t.success;if(this.fragContextChanged(i)||(Ue(i)&&(this.fragPrevious=i),this.state=M.IDLE),!!a){var l=this.tracksBuffered[this.currentTrackId];if(l){for(var u,f=i.start,d=0;d<l.length;d++)if(f>=l[d].start&&f<=l[d].end){u=l[d];break}var h=i.start+i.duration;u?u.end=h:(u={start:f,end:h},l.push(u)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}}},n.onBufferFlushing=function(e,t){var i=t.startOffset,a=t.endOffset;if(i===0&&a!==Number.POSITIVE_INFINITY){var l=a-1;if(l<=0)return;t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(function(u){for(var f=0;f<u.length;){if(u[f].end<=l){u.shift();continue}else if(u[f].start<l)u[f].start=l;else break;f++}}),this.fragmentTracker.removeFragmentsInRange(i,l,F.SUBTITLE)}},n.onError=function(e,t){var i=t.frag;i?.type===F.SUBTITLE&&(t.details===_.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==M.STOPPED&&(this.state=M.IDLE))},n.onSubtitleTracksUpdated=function(e,t){var i=this,a=t.subtitleTracks;if(this.levels&&Fo(this.levels,a)){this.levels=a.map(function(l){return new Di(l)});return}this.tracksBuffered=[],this.levels=a.map(function(l){var u=new Di(l);return i.tracksBuffered[u.id]=[],u}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,F.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null},n.onSubtitleTrackSwitch=function(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}var a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.state!==M.STOPPED&&this.setInterval(el)},n.onSubtitleTrackLoaded=function(e,t){var i,a=this.currentTrackId,l=this.levels,u=t.details,f=t.id;if(!l){this.warn("Subtitle tracks were reset while loading level "+f);return}var d=l[f];if(!(f>=l.length||!d)){this.log("Subtitle track "+f+" loaded ["+u.startSN+","+u.endSN+"]"+(u.lastPartSn?"[part-"+u.lastPartSn+"-"+u.lastPartIndex+"]":"")+",duration:"+u.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges;var h=0;if(u.live||(i=d.details)!=null&&i.live){if(u.deltaUpdateFailed)return;var c=this.mainDetails;if(!c){this.startFragRequested=!1;return}var v=c.fragments[0];if(!d.details)u.hasProgramDateTime&&c.hasProgramDateTime?(vn(u,c),h=u.fragmentStart):v&&(h=v.start,da(u,h));else{var g;h=this.alignPlaylists(u,d.details,(g=this.levelLastLoaded)==null?void 0:g.details),h===0&&v&&(h=v.start,da(u,h))}c&&!this.startFragRequested&&this.setStartPosition(c,h)}if(d.details=u,this.levelLastLoaded=d,f===a&&(this.hls.trigger(y.SUBTITLE_TRACK_UPDATED,{details:u,id:f,groupId:t.groupId}),this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===M.IDLE)){var m=Vr(null,u.fragments,this.media.currentTime,0);m||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)}}},n._handleFragmentLoadComplete=function(e){var t=this,i=e.frag,a=e.payload,l=i.decryptdata,u=this.hls;if(!this.fragContextChanged(i)&&a&&a.byteLength>0&&l!=null&&l.key&&l.iv&&oi(l.method)){var f=performance.now();this.decrypter.decrypt(new Uint8Array(a),l.key.buffer,l.iv.buffer,aa(l.method)).catch(function(d){throw u.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:i}),d}).then(function(d){var h=performance.now();u.trigger(y.FRAG_DECRYPTED,{frag:i,payload:d,stats:{tstart:f,tdecrypt:h}})}).catch(function(d){t.warn(d.name+": "+d.message),t.state=M.IDLE})}},n.doTick=function(){if(!this.media){this.state=M.IDLE;return}if(this.state===M.IDLE){var e=this.currentTrackId,t=this.levels,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;var a=this.config,l=this.getLoadPosition(),u=Ae.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,a.maxBufferHole),f=u.end,d=u.len,h=i.details,c=this.hls.maxBufferLength+h.levelTargetDuration;if(d>c)return;var v=h.fragments,g=v.length,m=h.edge,p=null,E=this.fragPrevious;if(f<m){var S=a.maxFragLookUpTolerance,T=f>m-S?0:S;p=Vr(E,v,Math.max(v[0].start,f),T),!p&&E&&E.start<v[0].start&&(p=v[0])}else p=v[g-1];if(p=this.filterReplacedPrimary(p,i.details),!p)return;var A=p.sn-h.startSN,x=v[A-1];if(x&&x.cc===p.cc&&this.fragmentTracker.getState(x)===ot.NOT_LOADED&&(p=x),this.fragmentTracker.getState(p)===ot.NOT_LOADED){var I=this.mapToInitFragWhenRequired(p);I&&this.loadFragment(I,i,f)}}},n.loadFragment=function(e,t,i){Ue(e)?s.prototype.loadFragment.call(this,e,t,i):this._loadInitSegment(e,t)},W(o,[{key:"mediaBufferTimeRanges",get:function(){return new Vd(this.tracksBuffered[this.currentTrackId]||[])}}])}(ha),Vd=function(o){this.buffered=void 0;var n=function(e,t,i){if(t=t>>>0,t>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+i+")");return o[t][e]};this.buffered={get length(){return o.length},end:function(e){return n("end",e,o.length)},start:function(e){return n("start",e,o.length)}}};function tl(s,o){var n;try{n=new Event("addtrack")}catch{n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=s,o.dispatchEvent(n)}function rl(s,o){var n=s.mode;if(n==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(o.id))try{if(s.addCue(o),!s.cues.getCueById(o.id))throw new Error("addCue is failed for: "+o)}catch(e){Se.debug("[texttrack-utils]: "+e);try{var r=new self.TextTrackCue(o.startTime,o.endTime,o.text);r.id=o.id,s.addCue(r)}catch(t){Se.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+t)}}n==="disabled"&&(s.mode=n)}function gi(s,o){var n=s.mode;if(n==="disabled"&&(s.mode="hidden"),s.cues)for(var r=s.cues.length;r--;)o&&s.cues[r].removeEventListener("enter",o),s.removeCue(s.cues[r]);n==="disabled"&&(s.mode=n)}function Na(s,o,n,r){var e=s.mode;if(e==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0)for(var t=Yd(s.cues,o,n),i=0;i<t.length;i++)(!r||r(t[i]))&&s.removeCue(t[i]);e==="disabled"&&(s.mode=e)}function Wd(s,o){if(o<=s[0].startTime)return 0;var n=s.length-1;if(o>s[n].endTime)return-1;for(var r=0,e=n,t;r<=e;)if(t=Math.floor((e+r)/2),o<s[t].startTime)e=t-1;else if(o>s[t].startTime&&r<n)r=t+1;else return t;return s[r].startTime-o<o-s[e].startTime?r:e}function Yd(s,o,n){var r=[],e=Wd(s,o);if(e>-1)for(var t=e,i=s.length;t<i;t++){var a=s[t];if(a.startTime>=o&&a.endTime<=n)r.push(a);else if(a.startTime>n)return r}return r}function In(s){for(var o=[],n=0;n<s.length;n++){var r=s[n];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&o.push(s[n])}return o}var qd=function(s){function o(r){var e;return e=s.call(this,r,"subtitle-track-controller")||this,e.media=null,e.tracks=[],e.groupIds=null,e.tracksInGroup=[],e.trackId=-1,e.currentTrack=null,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.onTextTracksChanged=function(){if(e.useTextTrackPolling||self.clearInterval(e.subtitlePollingInterval),!(!e.media||!e.hls.config.renderTextTracksNatively)){for(var t=null,i=In(e.media.textTracks),a=0;a<i.length;a++)if(i[a].mode==="hidden")t=i[a];else if(i[a].mode==="showing"){t=i[a];break}var l=e.findTrackForTextTrack(t);e.subtitleTrack!==l&&e.setSubtitleTrack(l)}},e.registerListeners(),e}ae(o,s);var n=o.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,s.prototype.destroy.call(this)},n.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.ERROR,this.onError,this)},n.onMediaAttached=function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)},n.onMediaDetaching=function(e,t){var i=this.media;if(i){var a=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,!a){var l=In(i.textTracks);l.forEach(function(u){gi(u)})}}},n.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},n.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},n.onSubtitleTrackLoaded=function(e,t){var i=t.id,a=t.groupId,l=t.details,u=this.tracksInGroup[i];if(!u||u.groupId!==a){this.warn("Subtitle track with id:"+i+" and group:"+a+" not found in active group "+u?.groupId);return}var f=u.details;u.details=t.details,this.log("Subtitle track "+i+' "'+u.name+'" lang:'+u.lang+" group:"+a+" loaded ["+l.startSN+"-"+l.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,t,f)},n.onLevelLoading=function(e,t){this.switchLevel(t.level)},n.onLevelSwitching=function(e,t){this.switchLevel(t.level)},n.switchLevel=function(e){var t=this.hls.levels[e];if(t){var i=t.subtitleGroups||null,a=this.groupIds,l=this.currentTrack;if(!i||a?.length!==i?.length||i!=null&&i.some(function(g){return a?.indexOf(g)===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var u=this.tracks.filter(function(g){return!i||i.indexOf(g.groupId)!==-1});if(u.length)this.selectDefaultTrack&&!u.some(function(g){return g.default})&&(this.selectDefaultTrack=!1),u.forEach(function(g,m){g.id=m});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=u;var f=this.hls.config.subtitlePreference;if(!l&&f){this.selectDefaultTrack=!1;var d=fr(f,u);if(d>-1)l=u[d];else{var h=fr(f,this.tracks);l=this.tracks[h]}}var c=this.findTrackId(l);c===-1&&l&&(c=this.findTrackId(null));var v={subtitleTracks:u};this.log("Updating subtitle tracks, "+u.length+' track(s) found in "'+i?.join(",")+'" group-id'),this.hls.trigger(y.SUBTITLE_TRACKS_UPDATED,v),c!==-1&&this.trackId===-1&&this.setSubtitleTrack(c)}}},n.findTrackId=function(e){for(var t=this.tracksInGroup,i=this.selectDefaultTrack,a=0;a<t.length;a++){var l=t[a];if(!(i&&!l.default||!i&&!e)&&(!e||Kr(l,e)))return a}if(e){for(var u=0;u<t.length;u++){var f=t[u];if(Ni(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(var d=0;d<t.length;d++){var h=t[d];if(Ni(e.attrs,h.attrs,["LANGUAGE"]))return d}}return-1},n.findTrackForTextTrack=function(e){if(e)for(var t=this.tracksInGroup,i=0;i<t.length;i++){var a=t[i];if(Da(a,e))return i}return-1},n.onError=function(e,t){t.fatal||!t.context||t.context.type===N.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)},n.setSubtitleOption=function(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;var t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){var i=this.currentTrack;if(i&&Kr(e,i))return i;var a=fr(e,this.tracksInGroup);if(a>-1){var l=this.tracksInGroup[a];return this.setSubtitleTrack(a),l}else{if(i)return null;var u=fr(e,t);if(u>-1)return t[u]}}}return null},n.loadPlaylist=function(e){s.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)},n.loadingPlaylist=function(e,t){s.prototype.loadingPlaylist.call(this,e,t);var i=e.id,a=e.groupId,l=this.getUrlWithDirectives(e.url,t),u=e.details,f=u?.age;this.log("Loading subtitle "+i+' "'+e.name+'" lang:'+e.lang+" group:"+a+(t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+l),this.hls.trigger(y.SUBTITLE_TRACK_LOADING,{url:l,id:i,groupId:a,deliveryDirectives:t||null,track:e})},n.toggleTrackModes=function(){var e=this.media;if(e){var t=In(e.textTracks),i=this.currentTrack,a;if(i&&(a=t.filter(function(u){return Da(i,u)})[0],a||this.warn('Unable to find subtitle TextTrack with name "'+i.name+'" and language "'+i.lang+'"')),[].slice.call(t).forEach(function(u){u.mode!=="disabled"&&u!==a&&(u.mode="disabled")}),a){var l=this.subtitleDisplay?"showing":"hidden";a.mode!==l&&(a.mode=l)}}},n.setSubtitleTrack=function(e){var t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!H(e)){this.warn("Invalid subtitle track id: "+e);return}this.selectDefaultTrack=!1;var i=this.currentTrack,a=t[e]||null;if(this.trackId=e,this.currentTrack=a,this.toggleTrackModes(),!a){this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:e});return}var l=!!a.details&&!a.details.live;if(!(e===this.trackId&&a===i&&l)){this.log("Switching to subtitle-track "+e+(a?' "'+a.name+'" lang:'+a.lang+" group:"+a.groupId:""));var u=a.id,f=a.groupId,d=f===void 0?"":f,h=a.name,c=a.type,v=a.url;this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:u,groupId:d,name:h,type:c,url:v});var g=this.switchParams(a.url,i?.details,a.details);this.loadPlaylist(g)}},W(o,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}}])}(_a),jd={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},il=function(o){return String.fromCharCode(jd[o]||o)},ir=15,Er=100,Xd={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},zd={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Qd={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},$d={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Jd=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Zd=function(){function s(){this.time=null,this.verboseLevel=0}var o=s.prototype;return o.log=function(r,e){if(this.verboseLevel>=r){var t=typeof e=="function"?e():e;Se.log(this.time+" ["+r+"] "+t)}},s}(),Yr=function(o){for(var n=[],r=0;r<o.length;r++)n.push(o[r].toString(16));return n},nl=function(){function s(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var o=s.prototype;return o.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},o.setStyles=function(r){for(var e=["foreground","underline","italics","background","flash"],t=0;t<e.length;t++){var i=e[t];r.hasOwnProperty(i)&&(this[i]=r[i])}},o.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},o.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},o.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},o.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},s}(),eh=function(){function s(){this.uchar=" ",this.penState=new nl}var o=s.prototype;return o.reset=function(){this.uchar=" ",this.penState.reset()},o.setChar=function(r,e){this.uchar=r,this.penState.copy(e)},o.setPenState=function(r){this.penState.copy(r)},o.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},o.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},o.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},s}(),th=function(){function s(n){this.chars=[],this.pos=0,this.currPenState=new nl,this.cueStartTime=null,this.logger=void 0;for(var r=0;r<Er;r++)this.chars.push(new eh);this.logger=n}var o=s.prototype;return o.equals=function(r){for(var e=0;e<Er;e++)if(!this.chars[e].equals(r.chars[e]))return!1;return!0},o.copy=function(r){for(var e=0;e<Er;e++)this.chars[e].copy(r.chars[e])},o.isEmpty=function(){for(var r=!0,e=0;e<Er;e++)if(!this.chars[e].isEmpty()){r=!1;break}return r},o.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Er&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Er)},o.moveCursor=function(r){var e=this.pos+r;if(r>1)for(var t=this.pos+1;t<e+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(e)},o.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},o.insertChar=function(r){var e=this;r>=144&&this.backSpace();var t=il(r);if(this.pos>=Er){this.logger.log(0,function(){return"Cannot insert "+r.toString(16)+" ("+t+") at position "+e.pos+". Skipping it!"});return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)},o.clearFromPos=function(r){var e;for(e=r;e<Er;e++)this.chars[e].reset()},o.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},o.clearToEndOfRow=function(){this.clearFromPos(this.pos)},o.getTextString=function(){for(var r=[],e=!0,t=0;t<Er;t++){var i=this.chars[t].uchar;i!==" "&&(e=!1),r.push(i)}return e?"":r.join("")},o.setPenStyles=function(r){this.currPenState.setStyles(r);var e=this.chars[this.pos];e.setPenState(this.currPenState)},s}(),Ua=function(){function s(n){this.rows=[],this.currRow=ir-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var r=0;r<ir;r++)this.rows.push(new th(n));this.logger=n}var o=s.prototype;return o.reset=function(){for(var r=0;r<ir;r++)this.rows[r].clear();this.currRow=ir-1},o.equals=function(r){for(var e=!0,t=0;t<ir;t++)if(!this.rows[t].equals(r.rows[t])){e=!1;break}return e},o.copy=function(r){for(var e=0;e<ir;e++)this.rows[e].copy(r.rows[e])},o.isEmpty=function(){for(var r=!0,e=0;e<ir;e++)if(!this.rows[e].isEmpty()){r=!1;break}return r},o.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},o.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},o.insertChar=function(r){var e=this.rows[this.currRow];e.insertChar(r)},o.setPen=function(r){var e=this.rows[this.currRow];e.setPenStyles(r)},o.moveCursor=function(r){var e=this.rows[this.currRow];e.moveCursor(r)},o.setCursor=function(r){this.logger.log(2,"setCursor: "+r);var e=this.rows[this.currRow];e.setCursor(r)},o.setPAC=function(r){this.logger.log(2,function(){return"pacData = "+Ke(r)});var e=r.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var t=0;t<ir;t++)this.rows[t].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var l=a.rows[i].cueStartTime,u=this.logger.time;if(l!==null&&u!==null&&l<u)for(var f=0;f<this.nrRollUpRows;f++)this.rows[e-this.nrRollUpRows+f+1].copy(a.rows[i+f])}}this.currRow=e;var d=this.rows[this.currRow];if(r.indent!==null){var h=r.indent,c=Math.max(h-1,0);d.setCursor(r.indent),r.color=d.chars[c].penState.foreground}var v={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(v)},o.setBkgData=function(r){this.logger.log(2,function(){return"bkgData = "+Ke(r)}),this.backSpace(),this.setPen(r),this.insertChar(32)},o.setRollUpRows=function(r){this.nrRollUpRows=r},o.rollUp=function(){var r=this;if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,function(){return r.getDisplayText()});var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")},o.getDisplayText=function(r){r=r||!1;for(var e=[],t="",i=-1,a=0;a<ir;a++){var l=this.rows[a].getTextString();l&&(i=a+1,r?e.push("Row "+i+": '"+l+"'"):e.push(l.trim()))}return e.length>0&&(r?t="["+e.join(" | ")+"]":t=e.join(`
`)),t},o.getTextAndFormat=function(){return this.rows},s}(),al=function(){function s(n,r,e){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new Ua(e),this.nonDisplayedMemory=new Ua(e),this.lastOutputScreen=new Ua(e),this.currRollUpRow=this.displayedMemory.rows[ir-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=e}var o=s.prototype;return o.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[ir-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},o.getHandler=function(){return this.outputFilter},o.setHandler=function(r){this.outputFilter=r},o.setPAC=function(r){this.writeScreen.setPAC(r)},o.setBkgData=function(r){this.writeScreen.setBkgData(r)},o.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(2,function(){return"MODE="+r}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},o.insertChars=function(r){for(var e=this,t=0;t<r.length;t++)this.writeScreen.insertChar(r[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+e.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,function(){return"DISPLAYED: "+e.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},o.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},o.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},o.ccAOF=function(){},o.ccAON=function(){},o.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},o.ccRU=function(r){this.logger.log(2,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},o.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},o.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},o.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},o.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},o.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},o.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},o.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},o.ccEOC=function(){var r=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+r.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},o.ccTO=function(r){this.logger.log(2,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},o.ccMIDROW=function(r){var e={flash:!1};if(e.underline=r%2===1,e.italics=r>=46,e.italics)e.foreground="white";else{var t=Math.floor(r/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=i[t]}this.logger.log(2,"MIDROW: "+Ke(e)),this.writeScreen.setPen(e)},o.outputDataUpdate=function(r){r===void 0&&(r=!1);var e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))},o.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},s}(),sl=function(){function s(n,r,e){this.channels=void 0,this.currentChannel=0,this.cmdHistory=ih(),this.logger=void 0;var t=this.logger=new Zd;this.channels=[null,new al(n,r,t),new al(n+1,e,t)]}var o=s.prototype;return o.getHandler=function(r){return this.channels[r].getHandler()},o.setHandler=function(r,e){this.channels[r].setHandler(e)},o.addData=function(r,e){var t=this;this.logger.time=r;for(var i=function(f){var d=e[f]&127,h=e[f+1]&127,c=!1,v=null;if(d===0&&h===0)return 0;t.logger.log(3,function(){return"["+Yr([e[f],e[f+1]])+"] -> ("+Yr([d,h])+")"});var g=t.cmdHistory,m=d>=16&&d<=31;if(m){if(rh(d,h,g))return bn(null,null,g),t.logger.log(3,function(){return"Repeated command ("+Yr([d,h])+") is dropped"}),0;bn(d,h,t.cmdHistory),c=t.parseCmd(d,h),c||(c=t.parseMidrow(d,h)),c||(c=t.parsePAC(d,h)),c||(c=t.parseBackgroundAttributes(d,h))}else bn(null,null,g);if(!c&&(v=t.parseChars(d,h),v)){var p=t.currentChannel;if(p&&p>0){var E=t.channels[p];E.insertChars(v)}else t.logger.log(2,"No channel found yet. TEXT-MODE?")}!c&&!v&&t.logger.log(2,function(){return"Couldn't parse cleaned data "+Yr([d,h])+" orig: "+Yr([e[f],e[f+1]])})},a,l=0;l<e.length;l+=2)a=i(l)},o.parseCmd=function(r,e){var t=(r===20||r===28||r===21||r===29)&&e>=32&&e<=47,i=(r===23||r===31)&&e>=33&&e<=35;if(!(t||i))return!1;var a=r===20||r===21||r===23?1:2,l=this.channels[a];return r===20||r===21||r===28||r===29?e===32?l.ccRCL():e===33?l.ccBS():e===34?l.ccAOF():e===35?l.ccAON():e===36?l.ccDER():e===37?l.ccRU(2):e===38?l.ccRU(3):e===39?l.ccRU(4):e===40?l.ccFON():e===41?l.ccRDC():e===42?l.ccTR():e===43?l.ccRTD():e===44?l.ccEDM():e===45?l.ccCR():e===46?l.ccENM():e===47&&l.ccEOC():l.ccTO(e-32),this.currentChannel=a,!0},o.parseMidrow=function(r,e){var t=0;if((r===17||r===25)&&e>=32&&e<=47){if(r===17?t=1:t=2,t!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[t];return i?(i.ccMIDROW(e),this.logger.log(3,function(){return"MIDROW ("+Yr([r,e])+")"}),!0):!1}return!1},o.parsePAC=function(r,e){var t,i=(r>=17&&r<=23||r>=25&&r<=31)&&e>=64&&e<=127,a=(r===16||r===24)&&e>=64&&e<=95;if(!(i||a))return!1;var l=r<=23?1:2;e>=64&&e<=95?t=l===1?Xd[r]:Qd[r]:t=l===1?zd[r]:$d[r];var u=this.channels[l];return u?(u.setPAC(this.interpretPAC(t,e)),this.currentChannel=l,!0):!1},o.interpretPAC=function(r,e){var t,i={color:null,italics:!1,indent:null,underline:!1,row:r};return e>95?t=e-96:t=e-64,i.underline=(t&1)===1,t<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(t/2)]:t<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((t-16)/2)*4,i},o.parseChars=function(r,e){var t,i=null,a=null;if(r>=25?(t=2,a=r-8):(t=1,a=r),a>=17&&a<=19){var l;a===17?l=e+80:a===18?l=e+112:l=e+144,this.logger.log(2,function(){return"Special char '"+il(l)+"' in channel "+t}),i=[l]}else r>=32&&r<=127&&(i=e===0?[r]:[r,e]);return i&&this.logger.log(3,function(){return"Char codes =  "+Yr(i).join(",")}),i},o.parseBackgroundAttributes=function(r,e){var t=(r===16||r===24)&&e>=32&&e<=47,i=(r===23||r===31)&&e>=45&&e<=47;if(!(t||i))return!1;var a,l={};r===16||r===24?(a=Math.floor((e-32)/2),l.background=Jd[a],e%2===1&&(l.background=l.background+"_semi")):e===45?l.background="transparent":(l.foreground="black",e===47&&(l.underline=!0));var u=r<=23?1:2,f=this.channels[u];return f.setBkgData(l),!0},o.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var e=this.channels[r];e&&e.reset()}bn(null,null,this.cmdHistory)},o.cueSplitAtTime=function(r){for(var e=0;e<this.channels.length;e++){var t=this.channels[e];t&&t.cueSplitAtTime(r)}},s}();function bn(s,o,n){n.a=s,n.b=o}function rh(s,o,n){return n.a===s&&n.b===o}function ih(){return{a:null,b:null}}var Ba=function(){if(dn!=null&&dn.VTTCue)return self.VTTCue;var s=["","lr","rl"],o=["start","middle","end","left","right"];function n(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;var u=l.toLowerCase();return~a.indexOf(u)?u:!1}function r(a){return n(s,a)}function e(a){return n(o,a)}function t(a){for(var l=arguments.length,u=new Array(l>1?l-1:0),f=1;f<l;f++)u[f-1]=arguments[f];for(var d=1;d<arguments.length;d++){var h=arguments[d];for(var c in h)a[c]=h[c]}return a}function i(a,l,u){var f=this,d={enumerable:!0};f.hasBeenReset=!1;var h="",c=!1,v=a,g=l,m=u,p=null,E="",S=!0,T="auto",A="start",x=50,I="middle",k=50,D="middle";Object.defineProperty(f,"id",t({},d,{get:function(){return h},set:function(L){h=""+L}})),Object.defineProperty(f,"pauseOnExit",t({},d,{get:function(){return c},set:function(L){c=!!L}})),Object.defineProperty(f,"startTime",t({},d,{get:function(){return v},set:function(L){if(typeof L!="number")throw new TypeError("Start time must be set to a number.");v=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",t({},d,{get:function(){return g},set:function(L){if(typeof L!="number")throw new TypeError("End time must be set to a number.");g=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",t({},d,{get:function(){return m},set:function(L){m=""+L,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",t({},d,{get:function(){return p},set:function(L){p=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",t({},d,{get:function(){return E},set:function(L){var R=r(L);if(R===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=R,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",t({},d,{get:function(){return S},set:function(L){S=!!L,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",t({},d,{get:function(){return T},set:function(L){if(typeof L!="number"&&L!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",t({},d,{get:function(){return A},set:function(L){var R=e(L);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");A=R,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",t({},d,{get:function(){return x},set:function(L){if(L<0||L>100)throw new Error("Position must be between 0 and 100.");x=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",t({},d,{get:function(){return I},set:function(L){var R=e(L);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");I=R,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",t({},d,{get:function(){return k},set:function(L){if(L<0||L>100)throw new Error("Size must be between 0 and 100.");k=L,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",t({},d,{get:function(){return D},set:function(L){var R=e(L);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");D=R,this.hasBeenReset=!0}})),f.displayState=void 0}return i.prototype.getCueAsHTML=function(){var a=self.WebVTT;return a.convertCueToDOMTree(self,this.text)},i}(),nh=function(){function s(){}var o=s.prototype;return o.decode=function(r,e){if(!r)return"";if(typeof r!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(r))},s}();function ol(s){function o(r,e,t,i){return(r|0)*3600+(e|0)*60+(t|0)+parseFloat(i||0)}var n=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?o(n[2],n[3],0,n[4]):o(n[1],n[2],n[3],n[4]):null}var ah=function(){function s(){this.values=Object.create(null)}var o=s.prototype;return o.set=function(r,e){!this.get(r)&&e!==""&&(this.values[r]=e)},o.get=function(r,e,t){return t?this.has(r)?this.values[r]:e[t]:this.has(r)?this.values[r]:e},o.has=function(r){return r in this.values},o.alt=function(r,e,t){for(var i=0;i<t.length;++i)if(e===t[i]){this.set(r,e);break}},o.integer=function(r,e){/^-?\d+$/.test(e)&&this.set(r,parseInt(e,10))},o.percent=function(r,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var t=parseFloat(e);if(t>=0&&t<=100)return this.set(r,t),!0}return!1},s}();function ll(s,o,n,r){var e=r?s.split(r):[s];for(var t in e)if(typeof e[t]=="string"){var i=e[t].split(n);if(i.length===2){var a=i[0],l=i[1];o(a,l)}}}var Ga=new Ba(0,0,""),Rn=Ga.align==="middle"?"middle":"center";function sh(s,o,n){var r=s;function e(){var a=ol(s);if(a===null)throw new Error("Malformed timestamp: "+r);return s=s.replace(/^[^\sa-zA-Z-]+/,""),a}function t(a,l){var u=new ah;ll(a,function(h,c){var v;switch(h){case"region":for(var g=n.length-1;g>=0;g--)if(n[g].id===c){u.set(h,n[g].region);break}break;case"vertical":u.alt(h,c,["rl","lr"]);break;case"line":v=c.split(","),u.integer(h,v[0]),u.percent(h,v[0])&&u.set("snapToLines",!1),u.alt(h,v[0],["auto"]),v.length===2&&u.alt("lineAlign",v[1],["start",Rn,"end"]);break;case"position":v=c.split(","),u.percent(h,v[0]),v.length===2&&u.alt("positionAlign",v[1],["start",Rn,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,c);break;case"align":u.alt(h,c,["start",Rn,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");var f=u.get("line","auto");f==="auto"&&Ga.line===-1&&(f=-1),l.line=f,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Rn);var d=u.get("position","auto");d==="auto"&&Ga.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function i(){s=s.replace(/^\s+/,"")}if(i(),o.startTime=e(),i(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);s=s.slice(3),i(),o.endTime=e(),i(),t(s,o)}function ul(s){return s.replace(/<br(?: \/)?>/gi,`
`)}var oh=function(){function s(){this.state="INITIAL",this.buffer="",this.decoder=new nh,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var o=s.prototype;return o.parse=function(r){var e=this;r&&(e.buffer+=e.decoder.decode(r,{stream:!0}));function t(){var d=e.buffer,h=0;for(d=ul(d);h<d.length&&d[h]!=="\r"&&d[h]!==`
`;)++h;var c=d.slice(0,h);return d[h]==="\r"&&++h,d[h]===`
`&&++h,e.buffer=d.slice(h),c}function i(d){ll(d,function(h,c){},/:/)}try{var a="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;a=t();var l=a.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(l!=null&&l[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var u=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(u?u=!1:a=t(),e.state){case"HEADER":/:/.test(a)?i(a):a||(e.state="ID");continue;case"NOTE":a||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){e.state="NOTE";break}if(!a)continue;if(e.cue=new Ba(0,0,""),e.state="CUE",a.indexOf("-->")===-1){e.cue.id=a;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{sh(a,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var f=a.indexOf("-->")!==-1;if(!a||f&&(u=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=a}continue;case"BADCUE":a||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},o.flush=function(){var r=this;try{if((r.cue||r.state==="HEADER")&&(r.buffer+=`

`,r.parse()),r.state==="INITIAL"||r.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){r.onparsingerror&&r.onparsingerror(e)}return r.onflush&&r.onflush(),this},s}(),lh=/\r\n|\n\r|\n|\r/g,Ka=function(o,n,r){return r===void 0&&(r=0),o.slice(r,r+n.length)===n},uh=function(o){var n=parseInt(o.slice(-3)),r=parseInt(o.slice(-6,-4)),e=parseInt(o.slice(-9,-7)),t=o.length>9?parseInt(o.substring(0,o.indexOf(":"))):0;if(!H(n)||!H(r)||!H(e)||!H(t))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+o);return n+=1e3*r,n+=60*1e3*e,n+=3600*1e3*t,n};function Ha(s,o,n){return Bi(s.toString())+Bi(o.toString())+Bi(n)}var fh=function(o,n,r){var e=o[n],t=o[e.prevCC];if(!t||!t.new&&e.new){o.ccOffset=o.presentationOffset=e.start,e.new=!1;return}for(;(i=t)!=null&&i.new;){var i;o.ccOffset+=e.start-t.start,e.new=!1,e=t,t=o[e.prevCC]}o.presentationOffset=r};function dh(s,o,n,r,e,t,i){var a=new oh,l=we(new Uint8Array(s)).trim().replace(lh,`
`).split(`
`),u=[],f=o?Ef(o.baseTime,o.timescale):0,d="00:00.000",h=0,c=0,v,g=!0;a.oncue=function(m){var p=n[r],E=n.ccOffset,S=(h-f)/9e4;if(p!=null&&p.new&&(c!==void 0?E=n.ccOffset=p.start:fh(n,r,S)),S){if(!o){v=new Error("Missing initPTS for VTT MPEGTS");return}E=S-n.presentationOffset}var T=m.endTime-m.startTime,A=zt((m.startTime+E-c)*9e4,e*9e4)/9e4;m.startTime=Math.max(A,0),m.endTime=Math.max(A+T,0);var x=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(x)),m.id||(m.id=Ha(m.startTime,m.endTime,x)),m.endTime>0&&u.push(m)},a.onparsingerror=function(m){v=m},a.onflush=function(){if(v){i(v);return}t(u)},l.forEach(function(m){if(g)if(Ka(m,"X-TIMESTAMP-MAP=")){g=!1,m.slice(16).split(",").forEach(function(p){Ka(p,"LOCAL:")?d=p.slice(6):Ka(p,"MPEGTS:")&&(h=parseInt(p.slice(7)))});try{c=uh(d)/1e3}catch(p){v=p}return}else m===""&&(g=!1);a.parse(m+`
`)}),a.flush()}var Va="stpp.ttml.im1t",fl=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,dl=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,hh={left:"start",center:"center",right:"end",start:"start",end:"end"};function hl(s,o,n,r){var e=pe(new Uint8Array(s),["mdat"]);if(e.length===0){r(new Error("Could not parse IMSC1 mdat"));return}var t=e.map(function(a){return we(a)}),i=yf(o.baseTime,1,o.timescale);try{t.forEach(function(a){return n(ch(a,i))})}catch(a){r(a)}}function ch(s,o){var n=new DOMParser,r=n.parseFromString(s,"text/xml"),e=r.getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");var t={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(t).reduce(function(d,h){return d[h]=e.getAttribute("ttp:"+h)||t[h],d},{}),a=e.getAttribute("xml:space")!=="preserve",l=cl(Wa(e,"styling","style")),u=cl(Wa(e,"layout","region")),f=Wa(e,"body","[begin]");return[].map.call(f,function(d){var h=vl(d,a);if(!h||!d.hasAttribute("begin"))return null;var c=qa(d.getAttribute("begin"),i),v=qa(d.getAttribute("dur"),i),g=qa(d.getAttribute("end"),i);if(c===null)throw gl(d);if(g===null){if(v===null)throw gl(d);g=c+v}var m=new Ba(c-o,g-o,h);m.id=Ha(m.startTime,m.endTime,m.text);var p=u[d.getAttribute("region")],E=l[d.getAttribute("style")],S=vh(p,E,l),T=S.textAlign;if(T){var A=hh[T];A&&(m.lineAlign=A),m.align=T}return re(m,S),m}).filter(function(d){return d!==null})}function Wa(s,o,n){var r=s.getElementsByTagName(o)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function cl(s){return s.reduce(function(o,n){var r=n.getAttribute("xml:id");return r&&(o[r]=n),o},{})}function vl(s,o){return[].slice.call(s.childNodes).reduce(function(n,r,e){var t;return r.nodeName==="br"&&e?n+`
`:(t=r.childNodes)!=null&&t.length?vl(r,o):o?n+r.textContent.trim().replace(/\s+/g," "):n+r.textContent},"")}function vh(s,o,n){var r="http://www.w3.org/ns/ttml#styling",e=null,t=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],i=s!=null&&s.hasAttribute("style")?s.getAttribute("style"):null;return i&&n.hasOwnProperty(i)&&(e=n[i]),t.reduce(function(a,l){var u=Ya(o,r,l)||Ya(s,r,l)||Ya(e,r,l);return u&&(a[l]=u),a},{})}function Ya(s,o,n){return s&&s.hasAttributeNS(o,n)?s.getAttributeNS(o,n):null}function gl(s){return new Error("Could not parse ttml timestamp "+s)}function qa(s,o){if(!s)return null;var n=ol(s);return n===null&&(fl.test(s)?n=gh(s,o):dl.test(s)&&(n=mh(s,o))),n}function gh(s,o){var n=fl.exec(s),r=(n[4]|0)+(n[5]|0)/o.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+r/o.frameRate}function mh(s,o){var n=dl.exec(s),r=Number(n[1]),e=n[2];switch(e){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/o.frameRate;case"t":return r/o.tickRate}return r}var _n=function(){function s(n,r){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=n,this.trackName=r}var o=s.prototype;return o.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},o.newCue=function(r,e,t){(this.startTime===null||this.startTime>r)&&(this.startTime=r),this.endTime=e,this.screen=t,this.timelineController.createCaptionsTrack(this.trackName)},o.reset=function(){this.cueRanges=[],this.startTime=null},s}(),ph=function(){function s(n){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=yl(),this.captionsProperties=void 0,this.hls=n,this.config=n.config,this.Cues=n.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},n.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(y.MANIFEST_LOADING,this.onManifestLoading,this),n.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),n.on(y.FRAG_LOADING,this.onFragLoading,this),n.on(y.FRAG_LOADED,this.onFragLoaded,this),n.on(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),n.on(y.FRAG_DECRYPTED,this.onFragDecrypted,this),n.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),n.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}var o=s.prototype;return o.destroy=function(){var r=this.hls;r.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(y.FRAG_LOADING,this.onFragLoading,this),r.off(y.FRAG_LOADED,this.onFragLoaded,this),r.off(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.off(y.FRAG_DECRYPTED,this.onFragDecrypted,this),r.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0},o.initCea608Parsers=function(){var r=new _n(this,"textTrack1"),e=new _n(this,"textTrack2"),t=new _n(this,"textTrack3"),i=new _n(this,"textTrack4");this.cea608Parser1=new sl(1,r,e),this.cea608Parser2=new sl(3,t,i)},o.addCues=function(r,e,t,i,a){for(var l=!1,u=a.length;u--;){var f=a[u],d=yh(f[0],f[1],e,t);if(d>=0&&(f[0]=Math.min(f[0],e),f[1]=Math.max(f[1],t),l=!0,d/(t-e)>.5))return}if(l||a.push([e,t]),this.config.renderTextTracksNatively){var h=this.captionsTracks[r];this.Cues.newCue(h,e,t,i)}else{var c=this.Cues.newCue(null,e,t,i);this.hls.trigger(y.CUES_PARSED,{type:"captions",cues:c,track:r})}},o.onInitPtsFound=function(r,e){var t=this,i=e.frag,a=e.id,l=e.initPTS,u=e.timescale,f=this.unparsedVttFrags;a===F.MAIN&&(this.initPTS[i.cc]={baseTime:l,timescale:u}),f.length&&(this.unparsedVttFrags=[],f.forEach(function(d){t.initPTS[d.frag.cc]?t.onFragLoaded(y.FRAG_LOADED,d):t.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))},o.getExistingTrack=function(r,e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var a=t.textTracks[i];if(pl(a,{name:r,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null},o.createCaptionsTrack=function(r){this.config.renderTextTracksNatively?this.createNativeTrack(r):this.createNonNativeTrack(r)},o.createNativeTrack=function(r){if(!this.captionsTracks[r]){var e=this.captionsProperties,t=this.captionsTracks,i=this.media,a=e[r],l=a.label,u=a.languageCode,f=this.getExistingTrack(l,u);if(f)t[r]=f,gi(t[r]),tl(t[r],i);else{var d=this.createTextTrack("captions",l,u);d&&(d[r]=!0,t[r]=d)}}},o.createNonNativeTrack=function(r){if(!this.nonNativeCaptionsTracks[r]){var e=this.captionsProperties[r];if(e){var t=e.label,i={_id:r,label:t,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[r]=i,this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},o.createTextTrack=function(r,e,t){var i=this.media;if(i)return i.addTextTrack(r,e,t)},o.onMediaAttaching=function(r,e){this.media=e.media,e.mediaSource||this._cleanTracks()},o.onMediaDetaching=function(r,e){var t=!!e.transferMedia;if(this.media=null,!t){var i=this.captionsTracks;Object.keys(i).forEach(function(a){gi(i[a]),delete i[a]}),this.nonNativeCaptionsTracks={}}},o.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=yl(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},o._cleanTracks=function(){var r=this.media;if(r){var e=r.textTracks;if(e)for(var t=0;t<e.length;t++)gi(e[t])}},o.onSubtitleTracksUpdated=function(r,e){var t=this,i=e.subtitleTracks||[],a=i.some(function(c){return c.textCodec===Va});if(this.config.enableWebVTT||a&&this.config.enableIMSC1){var l=Fo(this.tracks,i);if(l){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var u=this.media,f=u?In(u.textTracks):null;if(this.tracks.forEach(function(c,v){var g;if(f){for(var m=null,p=0;p<f.length;p++)if(f[p]&&pl(f[p],c)){m=f[p],f[p]=null;break}m&&(g=m)}if(g)gi(g);else{var E=ml(c);g=t.createTextTrack(E,c.name,c.lang),g&&(g.mode="disabled")}g&&t.textTracks.push(g)}),f!=null&&f.length){var d=f.filter(function(c){return c!==null}).map(function(c){return c.label});d.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: "+d.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var h=this.tracks.map(function(c){return{label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}});this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:h})}}},o.onManifestLoaded=function(r,e){var t=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(i){var a=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(a){var l="textTrack"+a[1],u=t.captionsProperties[l];u&&(u.label=i.name,i.lang&&(u.languageCode=i.lang),u.media=i)}})},o.closedCaptionsForLevel=function(r){var e=this.hls.levels[r.level];return e?.attrs["CLOSED-CAPTIONS"]},o.onFragLoading=function(r,e){if(this.enabled&&e.frag.type===F.MAIN){var t,i,a=this.cea608Parser1,l=this.cea608Parser2,u=this.lastSn,f=e.frag,d=f.cc,h=f.sn,c=(t=(i=e.part)==null?void 0:i.index)!=null?t:-1;a&&l&&(h!==u+1||h===u&&c!==this.lastPartIndex+1||d!==this.lastCc)&&(a.reset(),l.reset()),this.lastCc=d,this.lastSn=h,this.lastPartIndex=c}},o.onFragLoaded=function(r,e){var t=e.frag,i=e.payload;if(t.type===F.SUBTITLE)if(i.byteLength){var a=t.decryptdata,l="stats"in e;if(a==null||!a.encrypted||l){var u=this.tracks[t.level],f=this.vttCCs;f[t.cc]||(f[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),u&&u.textCodec===Va?this._parseIMSC1(t,i):this._parseVTTs(e)}}else this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},o._parseIMSC1=function(r,e){var t=this,i=this.hls;hl(e,this.initPTS[r.cc],function(a){t._appendCues(a,r.level),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},function(a){i.logger.log("Failed to parse IMSC1: "+a),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:a})})},o._parseVTTs=function(r){var e,t=this,i=r.frag,a=r.payload,l=this.initPTS,u=this.unparsedVttFrags,f=l.length-1;if(!l[i.cc]&&f===-1){u.push(r);return}var d=this.hls,h=(e=i.initSegment)!=null&&e.data?Ut(i.initSegment.data,new Uint8Array(a)).buffer:a;dh(h,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,function(c){t._appendCues(c,i.level),d.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},function(c){var v=c.message==="Missing initPTS for VTT MPEGTS";v?u.push(r):t._fallbackToIMSC1(i,a),d.logger.log("Failed to parse VTT cue: "+c),!(v&&f>i.cc)&&d.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:c})})},o._fallbackToIMSC1=function(r,e){var t=this,i=this.tracks[r.level];i.textCodec||hl(e,this.initPTS[r.cc],function(){i.textCodec=Va,t._parseIMSC1(r,e)},function(){i.textCodec="wvtt"})},o._appendCues=function(r,e){var t=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[e];if(!i||i.mode==="disabled")return;r.forEach(function(u){return rl(i,u)})}else{var a=this.tracks[e];if(!a)return;var l=a.default?"default":"subtitles"+e;t.trigger(y.CUES_PARSED,{type:"subtitles",cues:r,track:l})}},o.onFragDecrypted=function(r,e){var t=e.frag;t.type===F.SUBTITLE&&this.onFragLoaded(y.FRAG_LOADED,e)},o.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},o.onFragParsingUserdata=function(r,e){if(!(!this.enabled||!this.config.enableCEA708Captions)){var t=e.frag,i=e.samples;if(!(t.type===F.MAIN&&this.closedCaptionsForLevel(t)==="NONE"))for(var a=0;a<i.length;a++){var l=i[a].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();var u=this.extractCea608Data(l);this.cea608Parser1.addData(i[a].pts,u[0]),this.cea608Parser2.addData(i[a].pts,u[1])}}}},o.onBufferFlushing=function(r,e){var t=e.startOffset,i=e.endOffset,a=e.endOffsetSubtitles,l=e.type,u=this.media;if(!(!u||u.currentTime<i)){if(!l||l==="video"){var f=this.captionsTracks;Object.keys(f).forEach(function(h){return Na(f[h],t,i)})}if(this.config.renderTextTracksNatively&&t===0&&a!==void 0){var d=this.textTracks;Object.keys(d).forEach(function(h){return Na(d[h],t,a)})}}},o.extractCea608Data=function(r){for(var e=[[],[]],t=r[0]&31,i=2,a=0;a<t;a++){var l=r[i++],u=127&r[i++],f=127&r[i++];if(!(u===0&&f===0)){var d=(4&l)!==0;if(d){var h=3&l;(h===0||h===1)&&(e[h].push(u),e[h].push(f))}}}return e},s}();function ml(s){return s.characteristics&&/transcribes-spoken-dialog/gi.test(s.characteristics)&&/describes-music-and-sound/gi.test(s.characteristics)?"captions":"subtitles"}function pl(s,o){return!!s&&s.kind===ml(o)&&Da(o,s)}function yh(s,o,n,r){return Math.min(o,r)-Math.max(s,n)}function yl(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var Eh=/\s/,Th={newCue:function(o,n,r,e){for(var t=[],i,a,l,u,f,d=self.VTTCue||self.TextTrackCue,h=0;h<e.rows.length;h++)if(i=e.rows[h],l=!0,u=0,f="",!i.isEmpty()){for(var c,v=0;v<i.chars.length;v++)Eh.test(i.chars[v].uchar)&&l?u++:(f+=i.chars[v].uchar,l=!1);i.cueStartTime=n,n===r&&(r+=1e-4),u>=16?u--:u++;var g=ul(f.trim()),m=Ha(n,r,g);o!=null&&(c=o.cues)!=null&&c.getCueById(m)||(a=new d(n,r,g),a.id=m,a.line=h+1,a.align="left",a.position=10+Math.min(80,Math.floor(u*8/32)*10),t.push(a))}return o&&t.length&&(t.sort(function(p,E){return p.line==="auto"||E.line==="auto"?0:p.line>8&&E.line>8?E.line-p.line:p.line-E.line}),t.forEach(function(p){return rl(o,p)})),t}};function Sh(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var Ah=/(\d+)-(\d+)\/(\d+)/,El=function(){function s(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||bh,this.controller=new self.AbortController,this.stats=new ce}var o=s.prototype;return o.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},o.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},o.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},o.load=function(r,e,t){var i=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var l=xh(r,this.controller.signal),u=r.responseType==="arraybuffer",f=u?"byteLength":"length",d=e.loadPolicy,h=d.maxTimeToFirstByteMs,c=d.maxLoadTimeMs;this.context=r,this.config=e,this.callbacks=t,this.request=this.fetchSetup(r,l),self.clearTimeout(this.requestTimeout),e.timeout=h&&H(h)?h:c,this.requestTimeout=self.setTimeout(function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(a,r,i.response))},e.timeout);var v=Wr(this.request)?this.request.then(self.fetch):self.fetch(this.request);v.then(function(g){var m;i.response=i.loader=g;var p=Math.max(self.performance.now(),a.loading.start);if(self.clearTimeout(i.requestTimeout),e.timeout=c,i.requestTimeout=self.setTimeout(function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(a,r,i.response))},c-(p-a.loading.start)),!g.ok){var E=g.status,S=g.statusText;throw new Rh(S||"fetch, bad network response",E,g)}a.loading.first=p,a.total=Ih(g.headers)||a.total;var T=(m=i.callbacks)==null?void 0:m.onProgress;return T&&H(e.highWaterMark)?i.loadProgressively(g,a,r,e.highWaterMark,T):u?g.arrayBuffer():r.responseType==="json"?g.json():g.text()}).then(function(g){var m,p,E=i.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(i.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);var S=g[f];S&&(a.loaded=a.total=S);var T={url:E.url,data:g,code:E.status},A=(m=i.callbacks)==null?void 0:m.onProgress;A&&!H(e.highWaterMark)&&A(a,r,g,E),(p=i.callbacks)==null||p.onSuccess(T,a,r,E)}).catch(function(g){var m;if(self.clearTimeout(i.requestTimeout),!a.aborted){var p=g&&g.code||0,E=g?g.message:null;(m=i.callbacks)==null||m.onError({code:p,text:E},r,g?g.details:null,a)}})},o.getCacheAge=function(){var r=null;if(this.response){var e=this.response.headers.get("age");r=e?parseFloat(e):null}return r},o.getResponseHeader=function(r){return this.response?this.response.headers.get(r):null},o.loadProgressively=function(r,e,t,i,a){i===void 0&&(i=0);var l=new so,u=r.body.getReader(),f=function(){return u.read().then(function(h){if(h.done)return l.dataLength&&a(e,t,l.flush().buffer,r),Promise.resolve(new ArrayBuffer(0));var c=h.value,v=c.length;return e.loaded+=v,v<i||l.dataLength?(l.push(c),l.dataLength>=i&&a(e,t,l.flush().buffer,r)):a(e,t,c.buffer,r),f()}).catch(function(){return Promise.reject()})};return f()},s}();function xh(s,o){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:o,headers:new self.Headers(re({},s.headers))};return s.rangeEnd&&n.headers.set("Range","bytes="+s.rangeStart+"-"+String(s.rangeEnd-1)),n}function Lh(s){var o=Ah.exec(s);if(o)return parseInt(o[2])-parseInt(o[1])+1}function Ih(s){var o=s.get("Content-Range");if(o){var n=Lh(o);if(H(n))return n}var r=s.get("Content-Length");if(r)return parseInt(r)}function bh(s,o){return new self.Request(s.url,o)}var Rh=function(s){function o(n,r,e){var t;return t=s.call(this,n)||this,t.code=void 0,t.details=void 0,t.code=r,t.details=e,t}return ae(o,s),o}(Xe(Error)),_h=/^age:\s*[\d.]+\s*$/im,Tl=function(){function s(n){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=n&&n.xhrSetup||null,this.stats=new ce,this.retryDelay=0}var o=s.prototype;return o.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},o.abortInternal=function(){var r=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),r&&(r.onreadystatechange=null,r.onprogress=null,r.readyState!==4&&(this.stats.aborted=!0,r.abort()))},o.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},o.load=function(r,e,t){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=r,this.config=e,this.callbacks=t,this.loadInternal()},o.loadInternal=function(){var r=this,e=this.config,t=this.context;if(!(!e||!t)){var i=this.loader=new self.XMLHttpRequest,a=this.stats;a.loading.first=0,a.loaded=0,a.aborted=!1;var l=this.xhrSetup;l?Promise.resolve().then(function(){if(!(r.loader!==i||r.stats.aborted))return l(i,t.url)}).catch(function(u){if(!(r.loader!==i||r.stats.aborted))return i.open("GET",t.url,!0),l(i,t.url)}).then(function(){r.loader!==i||r.stats.aborted||r.openAndSendXhr(i,t,e)}).catch(function(u){var f;(f=r.callbacks)==null||f.onError({code:i.status,text:u.message},t,i,a)}):this.openAndSendXhr(i,t,e)}},o.openAndSendXhr=function(r,e,t){r.readyState||r.open("GET",e.url,!0);var i=e.headers,a=t.loadPolicy,l=a.maxTimeToFirstByteMs,u=a.maxLoadTimeMs;if(i)for(var f in i)r.setRequestHeader(f,i[f]);e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,self.clearTimeout(this.requestTimeout),t.timeout=l&&H(l)?l:u,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),r.send()},o.readystatechange=function(){var r=this.context,e=this.loader,t=this.stats;if(!(!r||!e)){var i=e.readyState,a=this.config;if(!t.aborted&&i>=2&&(t.loading.first===0&&(t.loading.first=Math.max(self.performance.now(),t.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(t.loading.first-t.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;var l=e.status,u=e.responseType==="text"?e.responseText:null;if(l>=200&&l<300){var f=u??e.response;if(f!=null){var d,h;t.loading.end=Math.max(self.performance.now(),t.loading.first);var c=e.responseType==="arraybuffer"?f.byteLength:f.length;t.loaded=t.total=c,t.bwEstimate=t.total*8e3/(t.loading.end-t.loading.first);var v=(d=this.callbacks)==null?void 0:d.onProgress;v&&v(t,r,f,e);var g={url:e.responseURL,data:f,code:l};(h=this.callbacks)==null||h.onSuccess(g,t,r,e);return}}var m=a.loadPolicy.errorRetry,p=t.retry,E={url:r.url,data:void 0,code:l};if(ln(m,p,!1,E))this.retry(m);else{var S;Se.error(l+" while loading "+r.url),(S=this.callbacks)==null||S.onError({code:l,text:e.statusText},r,e,t)}}}},o.loadtimeout=function(){if(this.config){var r=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(ln(r,e,!0))this.retry(r);else{var t;Se.warn("timeout while loading "+((t=this.context)==null?void 0:t.url));var i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}},o.retry=function(r){var e=this.context,t=this.stats;this.retryDelay=ta(r,t.retry),t.retry++,Se.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+e?.url+", retrying "+t.retry+"/"+r.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},o.loadprogress=function(r){var e=this.stats;e.loaded=r.loaded,r.lengthComputable&&(e.total=r.total)},o.getCacheAge=function(){var r=null;if(this.loader&&_h.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");r=e?parseFloat(e):null}return r},o.getResponseHeader=function(r){return this.loader&&new RegExp("^"+r+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(r):null},s}(),Dh={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},kh=Ee(Ee({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Tl,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:zl,bufferController:Kf,capLevelController:Vf,errorController:eu,fpsController:Md,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Fs,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:Dh},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Ch()),{},{subtitleStreamController:Hd,subtitleTrackController:qd,timelineController:ph,audioStreamController:Nf,audioTrackController:Uf,emeController:Qo,cmcdController:Cd,contentSteeringController:wd,interstitialsController:Kd});function Ch(){return{cueHandler:Th,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Ph(s,o,n){if((o.liveSyncDurationCount||o.liveMaxLatencyDurationCount)&&(o.liveSyncDuration||o.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(o.liveMaxLatencyDurationCount!==void 0&&(o.liveSyncDurationCount===void 0||o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(o.liveMaxLatencyDuration!==void 0&&(o.liveSyncDuration===void 0||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var r=ja(s),e=["manifest","level","frag"],t=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return e.forEach(function(i){var a=(i==="level"?"playlist":i)+"LoadPolicy",l=o[a]===void 0,u=[];t.forEach(function(f){var d=i+"Loading"+f,h=o[d];if(h!==void 0&&l){u.push(d);var c=r[a].default;switch(o[a]={default:c},f){case"TimeOut":c.maxLoadTimeMs=h,c.maxTimeToFirstByteMs=h;break;case"MaxRetry":c.errorRetry.maxNumRetry=h,c.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":c.errorRetry.retryDelayMs=h,c.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":c.errorRetry.maxRetryDelayMs=h,c.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&n.warn('hls.js config: "'+u.join('", "')+'" setting(s) are deprecated, use "'+a+'": '+Ke(o[a]))}),Ee(Ee({},r),o)}function ja(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(ja):Object.keys(s).reduce(function(o,n){return o[n]=ja(s[n]),o},{}):s}function wh(s,o){var n=s.loader;if(n!==El&&n!==Tl)o.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1;else{var r=Sh();r&&(s.loader=El,s.progressive=!0,s.enableSoftwareAES=!0,o.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var Dn=2,Mh=.1,Oh=.05,Fh=100,Nh=function(s){function o(r,e){var t;return t=s.call(this,"gap-controller",r.logger)||this,t.hls=null,t.fragmentTracker=null,t.media=null,t.mediaSource=void 0,t.nudgeRetry=0,t.stallReported=!1,t.stalled=null,t.moved=!1,t.seeking=!1,t.buffered={},t.lastCurrentTime=0,t.ended=0,t.waiting=0,t.onMediaPlaying=function(){t.ended=0,t.waiting=0},t.onMediaWaiting=function(){var i;(i=t.media)!=null&&i.seeking||(t.waiting=self.performance.now(),t.tick())},t.onMediaEnded=function(){if(t.hls){var i;t.ended=((i=t.media)==null?void 0:i.currentTime)||1,t.hls.trigger(y.MEDIA_ENDED,{stalled:!1})}},t.hls=r,t.fragmentTracker=e,t.registerListeners(),t}ae(o,s);var n=o.prototype;return n.registerListeners=function(){var e=this.hls;e&&(e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this))},n.unregisterListeners=function(){var e=this.hls;e&&(e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this))},n.destroy=function(){s.prototype.destroy.call(this),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0},n.onMediaAttached=function(e,t){this.setInterval(Fh),this.mediaSource=t.mediaSource;var i=this.media=t.media;Qt(i,"playing",this.onMediaPlaying),Qt(i,"waiting",this.onMediaWaiting),Qt(i,"ended",this.onMediaEnded)},n.onMediaDetaching=function(e,t){this.clearInterval();var i=this.media;i&&(rr(i,"playing",this.onMediaPlaying),rr(i,"waiting",this.onMediaWaiting),rr(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0},n.onBufferAppended=function(e,t){this.buffered=t.timeRanges},n.tick=function(){var e;if(!(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)){var t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}},n.poll=function(e,t){var i,a,l=(i=this.hls)==null?void 0:i.config;if(l){var u=this.media;if(u){var f=u.seeking,d=this.seeking&&!f,h=!this.seeking&&f,c=u.paused&&!f||u.ended||u.playbackRate===0;if(this.seeking=f,e!==t){t&&(this.ended=0),this.moved=!0,f||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(h||d){d&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&u.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!1}));return}if(!Ae.getBuffered(u).length){this.nudgeRetry=0;return}var v=Ae.bufferInfo(u,e,0),g=v.nextStart||0,m=this.fragmentTracker;if(f&&m&&this.hls){var p=Sl(this.hls.inFlightFragments,e),E=v.len>Dn,S=!g||p||g-e>Dn&&!m.getPartialFragment(e);if(E||S)return;this.moved=!1}var T=(a=this.hls)==null?void 0:a.latestLevelDetails;if(!this.moved&&this.stalled!==null&&m){var A=v.len>0;if(!A&&!g)return;var x=Math.max(g,v.start||0)-e,I=!!(T!=null&&T.live),k=I?T.targetduration*2:Dn,D=m.getPartialFragment(e);if(x>0&&(x<=k||D)){u.paused||this._trySkipBufferHole(D);return}}var b=l.detectStallWithCurrentTimeMs,L=self.performance.now(),R=this.waiting,C=this.stalled;if(C===null)if(R>0&&L-R<b)C=this.stalled=R;else{this.stalled=L;return}var B=L-C;if(!f&&(B>=b||R)&&this.hls){var P;if(((P=this.mediaSource)==null?void 0:P.readyState)==="ended"&&!(T!=null&&T.live)&&Math.abs(e-(T?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(v),!this.media||!this.hls)return}var O=Ae.bufferInfo(u,e,l.maxBufferHole);this._tryFixBufferStall(O,B,e)}}},n.stallResolved=function(e){var t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){var i=self.performance.now()-t;this.log("playback not stuck anymore @"+e+", after "+Math.round(i)+"ms"),this.stallReported=!1,this.waiting=0,this.hls.trigger(y.STALL_RESOLVED,{})}},n.nudgeOnVideoHole=function(e,t){var i,a=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&a&&a.length>1&&e>a.end(0)){var l=Ae.bufferedInfo(Ae.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&t>=l.start){var u=Ae.timeRangesToArray(a),f=Ae.bufferedInfo(u,t,0).bufferedIndex;if(f>-1&&f<u.length-1){var d=Ae.bufferedInfo(u,e,0).bufferedIndex,h=u[f].end,c=u[f+1].start;if((d===-1||d>f)&&c-h<1&&e-h<2){var v=new Error("nudging playhead to flush pipeline after video hole. currentTime: "+e+" hole: "+h+" -> "+c+" buffered index: "+d);this.warn(v.message),this.media.currentTime+=1e-6;var g=this.fragmentTracker.getPartialFragment(e)||void 0,m=Ae.bufferInfo(this.media,e,0);this.hls.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,frag:g,buffer:m.len,bufferInfo:m})}}}}},n._tryFixBufferStall=function(e,t,i){var a,l,u=this.fragmentTracker,f=this.media,d=(a=this.hls)==null?void 0:a.config;if(!(!f||!u||!d)){var h=(l=this.hls)==null?void 0:l.latestLevelDetails,c=u.getPartialFragment(i);if(c||h!=null&&h.live&&i<h.fragmentStart){var v=this._trySkipBufferHole(c);if(v||!this.media)return}var g=e.buffered,m=this.adjacentTraversal(e,i);(g&&g.length>1&&e.len>d.maxBufferHole||e.nextStart&&(e.nextStart-i<d.maxBufferHole||m))&&(t>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}},n.adjacentTraversal=function(e,t){var i=this.fragmentTracker,a=e.nextStart;if(i&&a){var l=i.getFragAtPos(t,F.MAIN),u=i.getFragAtPos(a,F.MAIN);if(l&&u)return u.sn-l.sn<2}return!1},n._reportStall=function(e){var t=this.hls,i=this.media,a=this.stallReported,l=this.stalled;if(!a&&l!==null&&i&&t){this.stallReported=!0;var u=new Error("Playback stalling at @"+i.currentTime+" due to low buffer ("+Ke(e)+")");this.warn(u.message),t.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,fatal:!1,error:u,buffer:e.len,bufferInfo:e,stalled:{start:l}})}},n._trySkipBufferHole=function(e){var t,i=this.fragmentTracker,a=this.media,l=(t=this.hls)==null?void 0:t.config;if(!a||!i||!l)return 0;var u=a.currentTime,f=Ae.bufferInfo(a,u,0),d=u<f.start?f.start:f.nextStart;if(d&&this.hls){var h=f.len<=l.maxBufferHole,c=f.len>0&&f.len<1&&a.readyState<3,v=d-u;if(v>0&&(h||c)){if(v>l.maxBufferHole){var g=!1;if(u===0){var m=i.getAppendedFrag(0,F.MAIN);m&&d<m.end&&(g=!0)}if(!g){var p=e||i.getAppendedFrag(u,F.MAIN);if(p){var E;if(!((E=this.hls.loadLevelObj)!=null&&E.details))return 0;var S=Sl(this.hls.inFlightFragments,d);if(S)return 0;for(var T=!1,A=p.end;A<d;){var x=i.getAppendedFrag(A,F.MAIN)||i.getPartialFragment(A);if(x)A+=x.duration;else{T=!0;break}}if(T)return 0}}}var I=Math.max(d+Oh,u+Mh);if(this.warn("skipping hole, adjusting currentTime from "+u+" to "+I),this.moved=!0,a.currentTime=I,!(e!=null&&e.gap)){var k=new Error("fragment loaded with buffer holes, seeking from "+u+" to "+I);this.hls.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:k,reason:k.message,frag:e||void 0,buffer:f.len,bufferInfo:f})}return I}}return 0},n._tryNudgeBuffer=function(e){var t=this.hls,i=this.media,a=this.nudgeRetry,l=t?.config;if(!i||!l)return 0;var u=i.currentTime;if(this.nudgeRetry++,a<l.nudgeMaxRetry){var f=u+(a+1)*l.nudgeOffset,d=new Error("Nudging 'currentTime' from "+u+" to "+f);this.warn(d.message),i.currentTime=f,t.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{var h=new Error("Playhead still not moving while enough data buffered @"+u+" after "+l.nudgeMaxRetry+" nudges");this.error(h.message),t.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,error:h,fatal:!0,buffer:e.len,bufferInfo:e})}},W(o,[{key:"hasBuffered",get:function(){return Object.keys(this.buffered).length>0}}])}(Rs);function Sl(s,o){var n=Al(s.main);if(n&&n.start<=o)return n;var r=Al(s.audio);return r&&r.start<=o?r:null}function Al(s){if(!s)return null;switch(s.state){case M.IDLE:case M.STOPPED:case M.ENDED:case M.ERROR:return null}return s.frag}var Uh=.25;function Xa(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function xl(s,o,n,r,e){var t=new s(o,n,"");try{t.value=r,e&&(t.type=e)}catch{t=new s(o,n,Ke(e?Ee({type:e},r):r))}return t}var kn=function(){var s=Xa();try{s&&new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}(),Bh=function(){function s(n){var r=this;this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=function(){r.hls&&r.hls.trigger(y.EVENT_CUE_ENTER,{})},this.hls=n,this._registerListeners()}var o=s.prototype;return o.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null},o._registerListeners=function(){var r=this.hls;r.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},o._unregisterListeners=function(){var r=this.hls;r.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},o.onMediaAttaching=function(r,e){var t;this.media=e.media,((t=e.overrides)==null?void 0:t.cueRemoval)===!1&&(this.removeCues=!1)},o.onMediaAttached=function(){var r=this.hls.latestLevelDetails;r&&this.updateDateRangeCues(r)},o.onMediaDetaching=function(r,e){this.media=null;var t=!!e.transferMedia;t||(this.id3Track&&(this.removeCues&&gi(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})},o.onManifestLoading=function(){this.dateRangeCuesAppended={}},o.createTrack=function(r){var e=this.getID3Track(r.textTracks);return e.mode="hidden",e},o.getID3Track=function(r){if(this.media){for(var e=0;e<r.length;e++){var t=r[e];if(t.kind==="metadata"&&t.label==="id3")return tl(t,this.media),t}return this.media.addTextTrack("metadata","id3")}},o.onFragParsingMetadata=function(r,e){if(this.media){var t=this.hls.config,i=t.enableEmsgMetadataCues,a=t.enableID3MetadataCues;if(!(!i&&!a)){var l=e.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var u=Xa();if(u)for(var f=0;f<l.length;f++){var d=l[f].type;if(!(d===Yt.emsg&&!i||!a)){var h=vo(l[f].data);if(h){var c=l[f].pts,v=c+l[f].duration;v>kn&&(v=kn);var g=v-c;g<=0&&(v=c+Uh);for(var m=0;m<h.length;m++){var p=h[m];if(!go(p)){this.updateId3CueEnds(c,d);var E=xl(u,c,v,p,d);E&&this.id3Track.addCue(E)}}}}}}}},o.updateId3CueEnds=function(r,e){var t,i=(t=this.id3Track)==null?void 0:t.cues;if(i)for(var a=i.length;a--;){var l=i[a];l.type===e&&l.startTime<r&&l.endTime===kn&&(l.endTime=r)}},o.onBufferFlushing=function(r,e){var t=e.startOffset,i=e.endOffset,a=e.type,l=this.id3Track,u=this.hls;if(u){var f=u.config,d=f.enableEmsgMetadataCues,h=f.enableID3MetadataCues;if(l&&(d||h)){var c;a==="audio"?c=function(g){return g.type===Yt.audioId3&&h}:a==="video"?c=function(g){return g.type===Yt.emsg&&d}:c=function(g){return g.type===Yt.audioId3&&h||g.type===Yt.emsg&&d},Na(l,t,i,c)}}},o.onLevelUpdated=function(r,e){var t=e.details;this.updateDateRangeCues(t,!0)},o.onLevelPtsUpdated=function(r,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)},o.updateDateRangeCues=function(r,e){var t=this;if(!(!this.media||!r.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var i=this.id3Track,a=r.dateRanges,l=Object.keys(a),u=this.dateRangeCuesAppended;if(i&&e){var f;if((f=i.cues)!=null&&f.length)for(var d=Object.keys(u).filter(function(E){return!l.includes(E)}),h=function(){var S=d[c],T=u[S].cues;delete u[S],Object.keys(T).forEach(function(A){try{var x=T[A];x.removeEventListener("enter",t.onEventCueEnter),i.removeCue(x)}catch{}})},c=d.length;c--;)h();else u=this.dateRangeCuesAppended={}}var v=r.fragments[r.fragments.length-1];if(!(l.length===0||!H(v?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=Xa(),m=function(){var S=l[p],T=a[S],A=T.startTime,x=u[S],I=x?.cues||{},k=x?.durationKnown||!1,D=kn,b=T.duration,L=T.endDate;if(L&&b!==null)D=A+b,k=!0;else if(T.endOnNext&&!k){var R=l.reduce(function(Q,ue){if(ue!==T.id){var te=a[ue];if(te.class===T.class&&te.startDate>T.startDate&&(!Q||T.startDate<Q.startDate))return te}return Q},null);R&&(D=R.startTime,k=!0)}for(var C=Object.keys(T.attr),B=0;B<C.length;B++){var P=C[B];if(cu(P)){var O=I[P];if(O)k&&!x.durationKnown?O.endTime=D:Math.abs(O.startTime-A)>.01&&(O.startTime=A,O.endTime=D);else if(g){var V=T.attr[P];vu(P)&&(V=Re(V));var X={key:P,data:V},z=xl(g,A,D,X,Yt.dateRange);z&&(z.id=S,t.id3Track.addCue(z),I[P]=z,t.hls.config.interstitialsController&&(P==="X-ASSET-LIST"||P==="X-ASSET-URL")&&z.addEventListener("enter",t.onEventCueEnter))}}}u[S]={cues:I,dateRange:T,durationKnown:k}},p=0;p<l.length;p++)m()}}},s}(),Gh=function(){function s(n){var r=this;this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=function(){var e=r.media,t=r.levelDetails;if(!(!e||!t)){r.currentTime=e.currentTime;var i=r.computeLatency();if(i!==null){r._latency=i;var a=r.config,l=a.lowLatencyMode,u=a.maxLiveSyncPlaybackRate;if(!(!l||u===1||!t.live)){var f=r.targetLatency;if(f!==null){var d=i-f,h=Math.min(r.maxLatency,f+t.targetduration),c=d<h;if(c&&d>.05&&r.forwardBufferLength>1){var v=Math.min(2,Math.max(1,u)),g=Math.round(2/(1+Math.exp(-.75*d-r.edgeStalled))*20)/20,m=Math.min(v,Math.max(1,g));r.changeMediaPlaybackRate(e,m)}else e.playbackRate!==1&&e.playbackRate!==0&&r.changeMediaPlaybackRate(e,1)}}}}},this.hls=n,this.config=n.config,this.registerListeners()}var o=s.prototype;return o.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null},o.registerListeners=function(){var r=this.hls;r&&(r.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(y.ERROR,this.onError,this))},o.unregisterListeners=function(){var r=this.hls;r&&(r.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(y.ERROR,this.onError,this))},o.onMediaAttached=function(r,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)},o.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)},o.onManifestLoading=function(){this._latency=null,this.stallCount=0},o.onLevelUpdated=function(r,e){var t=e.details;t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)},o.onError=function(r,e){var t;e.details===_.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(t=this.levelDetails)!=null&&t.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))},o.changeMediaPlaybackRate=function(r,e){var t,i;r.playbackRate!==e&&((t=this.hls)==null||t.logger.debug("[latency-controller]: latency="+this.latency.toFixed(3)+", targetLatency="+((i=this.targetLatency)==null?void 0:i.toFixed(3))+", forwardBufferLength="+this.forwardBufferLength.toFixed(3)+": adjusting playback rate from "+r.playbackRate+" to "+e),r.playbackRate=e)},o.estimateLiveEdge=function(){var r=this.levelDetails;return r===null?null:r.edge+r.age},o.computeLatency=function(){var r=this.estimateLiveEdge();return r===null?null:r-this.currentTime},W(s,[{key:"levelDetails",get:function(){var r;return((r=this.hls)==null?void 0:r.latestLevelDetails)||null}},{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var r=this.config;if(r.liveMaxLatencyDuration!==void 0)return r.liveMaxLatencyDuration;var e=this.levelDetails;return e?r.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var r=this.levelDetails;if(r===null||this.hls===null)return null;var e=r.holdBack,t=r.partHoldBack,i=r.targetduration,a=this.config,l=a.liveSyncDuration,u=a.liveSyncDurationCount,f=a.lowLatencyMode,d=this.hls.userConfig,h=f&&t||e;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=l!==void 0?l:u*i);var c=i;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)},set:function(r){this.stallCount=0,this.config.liveSyncDuration=r,this._targetLatencyUpdated=!0}},{key:"liveSyncPosition",get:function(){var r=this.estimateLiveEdge(),e=this.targetLatency;if(r===null||e===null)return null;var t=this.levelDetails;if(t===null)return null;var i=t.edge,a=r-e-this.edgeStalled,l=i-t.totalduration,u=i-(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.min(Math.max(l,a),u)}},{key:"drift",get:function(){var r=this.levelDetails;return r===null?1:r.drift}},{key:"edgeStalled",get:function(){var r=this.levelDetails;if(r===null)return 0;var e=(this.config.lowLatencyMode&&r.partTarget||r.targetduration)*3;return Math.max(r.age-e,0)}},{key:"forwardBufferLength",get:function(){var r=this.media,e=this.levelDetails;if(!r||!e)return 0;var t=r.buffered.length;return(t?r.buffered.end(t-1):e.edge)-this.currentTime}}])}(),Kh=function(s){function o(r,e){var t;return t=s.call(this,r,"level-controller")||this,t._levels=[],t._firstLevel=-1,t._maxAutoLevel=-1,t._startLevel=void 0,t.currentLevel=null,t.currentLevelIndex=-1,t.manualLevelIndex=-1,t.steering=void 0,t.onParsedComplete=void 0,t.steering=e,t._registerListeners(),t}ae(o,s);var n=o.prototype;return n._registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.ERROR,this.onError,this)},n._unregisterListeners=function(){var e=this.hls;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),s.prototype.destroy.call(this)},n.stopLoad=function(){var e=this._levels;e.forEach(function(t){t.loadError=0,t.fragmentError=0}),s.prototype.stopLoad.call(this)},n.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},n.onManifestLoading=function(e,t){this.resetLevels()},n.onManifestLoaded=function(e,t){var i=this,a=this.hls.config.preferManagedMediaSource,l=[],u={},f={},d=!1,h=!1,c=!1;t.levels.forEach(function(v){var g=v.attrs,m=v.audioCodec,p=v.videoCodec;m&&(v.audioCodec=m=Wt(m,a)||void 0),p&&(p=v.videoCodec=Bt(p));var E=v.width,S=v.height,T=v.unknownCodecs,A=T?T.length:0;if(T)for(var x=A;x--;){var I=T[x];i.isAudioSupported(I)?(v.audioCodec=m=m?m+","+I:I,A--,gr.audio[m.substring(0,4)]=2):i.isVideoSupported(I)&&(v.videoCodec=p=p?p+","+I:I,A--,gr.video[p.substring(0,4)]=2)}if(d||(d=!!(E&&S)),h||(h=!!p),c||(c=!!m),A||m&&!i.isAudioSupported(m)||p&&!i.isVideoSupported(p)){i.log('Some or all CODECS not supported "'+g.CODECS+'"');return}var k=g.CODECS,D=g["FRAME-RATE"],b=g["HDCP-LEVEL"],L=g["PATHWAY-ID"],R=g.RESOLUTION,C=g["VIDEO-RANGE"],B=(L||".")+"-",P=""+B+v.bitrate+"-"+R+"-"+D+"-"+k+"-"+C+"-"+b;if(u[P])if(u[P].uri!==v.url&&!v.attrs["PATHWAY-ID"]){var V=f[P]+=1;v.attrs["PATHWAY-ID"]=new Array(V+1).join(".");var X=i.createLevel(v);u[P]=X,l.push(X)}else u[P].addGroupId("audio",g.AUDIO),u[P].addGroupId("text",g.SUBTITLES);else{var O=i.createLevel(v);u[P]=O,f[P]=1,l.push(O)}}),this.filterAndSortMediaOptions(l,t,d,h,c)},n.createLevel=function(e){var t=new Di(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){var a=new Error('SUPPLEMENTAL-CODECS not supported "'+i.videoCodec+'"');this.log(a.message),t.supportedResult=en(a,[])}return t},n.isAudioSupported=function(e){return ri(e,"audio",this.hls.config.preferManagedMediaSource)},n.isVideoSupported=function(e){return ri(e,"video",this.hls.config.preferManagedMediaSource)},n.filterAndSortMediaOptions=function(e,t,i,a,l){var u=this,f=[],d=[],h=e;if((i||a)&&l&&(h=h.filter(function(D){var b=D.videoCodec,L=D.videoRange,R=D.width,C=D.height;return(!!b||!!(R&&C))&&ea(L)})),h.length===0){Promise.resolve().then(function(){if(u.hls){var D="no level with compatible codecs found in manifest",b=D;t.levels.length&&(b="one or more CODECS in variant not supported: "+Ke(t.levels.map(function(R){return R.attrs.CODECS}).filter(function(R,C,B){return B.indexOf(R)===C})),u.warn(b),D+=" ("+b+")");var L=new Error(D);u.hls.trigger(y.ERROR,{type:Y.MEDIA_ERROR,details:_.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:L,reason:b})}});return}t.audioTracks&&(f=t.audioTracks.filter(function(D){return!D.audioCodec||u.isAudioSupported(D.audioCodec)}),Ll(f)),t.subtitles&&(d=t.subtitles,Ll(d));var c=h.slice(0);h.sort(function(D,b){if(D.attrs["HDCP-LEVEL"]!==b.attrs["HDCP-LEVEL"])return(D.attrs["HDCP-LEVEL"]||"")>(b.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&D.height!==b.height)return D.height-b.height;if(D.frameRate!==b.frameRate)return D.frameRate-b.frameRate;if(D.videoRange!==b.videoRange)return ni.indexOf(D.videoRange)-ni.indexOf(b.videoRange);if(D.videoCodec!==b.videoCodec){var L=Ii(D.videoCodec),R=Ii(b.videoCodec);if(L!==R)return R-L}if(D.uri===b.uri&&D.codecSet!==b.codecSet){var C=Rr(D.codecSet),B=Rr(b.codecSet);if(C!==B)return B-C}return D.averageBitrate!==b.averageBitrate?D.averageBitrate-b.averageBitrate:0});var v=c[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==c.length)){for(var g=0;g<c.length;g++)if(c[g].pathwayId===h[0].pathwayId){v=c[g];break}}this._levels=h;for(var m=0;m<h.length;m++)if(h[m]===v){var p;this._firstLevel=m;var E=v.bitrate,S=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+h.length+" level(s) found, first bitrate: "+E),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){var T=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);T>S&&S===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}var A=l&&!a,x=this.hls.config,I=!!(x.audioStreamController&&x.audioTrackController),k={levels:h,audioTracks:f,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:a,altAudio:I&&!A&&f.some(function(D){return!!D.url})};this.hls.trigger(y.MANIFEST_PARSED,k)},n.onError=function(e,t){t.fatal||!t.context||t.context.type===N.LEVEL&&t.context.level===this.level&&this.checkRetry(t)},n.onFragBuffered=function(e,t){var i=t.frag;if(i!==void 0&&i.type===F.MAIN){var a=i.elementaryStreams;if(!Object.keys(a).some(function(u){return!!a[u]}))return;var l=this._levels[i.level];l!=null&&l.loadError&&(this.log("Resetting level error count of "+l.loadError+" on frag buffered"),l.loadError=0)}},n.onLevelLoaded=function(e,t){var i,a=t.level,l=t.details,u=t.levelInfo;if(!u){var f;this.warn("Invalid level index "+a),(f=t.deliveryDirectives)!=null&&f.skip&&(l.deltaUpdateFailed=!0);return}if(u===this.currentLevel||t.withoutMultiVariant){u.fragmentError===0&&(u.loadError=0);var d=u.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(a,t,d)}else(i=t.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)},n.loadPlaylist=function(e){s.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)},n.loadingPlaylist=function(e,t){s.prototype.loadingPlaylist.call(this,e,t);var i=this.getUrlWithDirectives(e.uri,t),a=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],u=e.details,f=u?.age;this.log("Loading level index "+a+(t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:"")+(l?" Pathway "+l:"")+(f&&u.live?" age "+f.toFixed(1)+(u.type&&" "+u.type||""):"")+" "+i),this.hls.trigger(y.LEVEL_LOADING,{url:i,level:a,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})},n.removeLevel=function(e){var t=this,i;if(this._levels.length!==1){var a=this._levels.filter(function(u,f){return f!==e?!0:(t.steering&&t.steering.removeLevel(u),u===t.currentLevel&&(t.currentLevel=null,t.currentLevelIndex=-1,u.details&&u.details.fragments.forEach(function(d){return d.level=-1})),!1)});to(a),this._levels=a,this.currentLevelIndex>-1&&(i=this.currentLevel)!=null&&i.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);var l=a.length-1;this._firstLevel=Math.min(this._firstLevel,l),this._startLevel&&(this._startLevel=Math.min(this._startLevel,l)),this.hls.trigger(y.LEVELS_UPDATED,{levels:a})}},n.onLevelsUpdated=function(e,t){var i=t.levels;this._levels=i},n.checkMaxAutoUpdated=function(){var e=this.hls,t=e.autoLevelCapping,i=e.maxAutoLevel,a=e.maxHdcpLevel;this._maxAutoLevel!==i&&(this._maxAutoLevel=i,this.hls.trigger(y.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:i,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:a}))},W(o,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"loadLevelObj",get:function(){return this.currentLevel}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(t.length!==0){if(e<0||e>=t.length){var i=new Error("invalid level idx"),a=e<0;if(this.hls.trigger(y.ERROR,{type:Y.OTHER_ERROR,details:_.LEVEL_SWITCH_ERROR,level:e,fatal:a,error:i,reason:i.message}),a)return;e=Math.min(e,t.length-1)}var l=this.currentLevelIndex,u=this.currentLevel,f=u?u.attrs["PATHWAY-ID"]:void 0,d=t[e],h=d.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=d,!(l===e&&u&&f===h)){this.log("Switching to level "+e+" ("+(d.height?d.height+"p ":"")+(d.videoRange?d.videoRange+" ":"")+(d.codecSet?d.codecSet+" ":"")+"@"+d.bitrate+")"+(h?" with Pathway "+h:"")+" from level "+l+(f?" with Pathway "+f:""));var c={level:e,attrs:d.attrs,details:d.details,bitrate:d.bitrate,averageBitrate:d.averageBitrate,maxBitrate:d.maxBitrate,realBitrate:d.realBitrate,width:d.width,height:d.height,codecSet:d.codecSet,audioCodec:d.audioCodec,videoCodec:d.videoCodec,audioGroups:d.audioGroups,subtitleGroups:d.subtitleGroups,loaded:d.loaded,loadError:d.loadError,fragmentError:d.fragmentError,name:d.name,id:d.id,uri:d.uri,url:d.url,urlId:0,audioGroupIds:d.audioGroupIds,textGroupIds:d.textGroupIds};this.hls.trigger(y.LEVEL_SWITCHING,c);var v=d.details;if(!v||v.live){var g=this.switchParams(d.uri,u?.details,v);this.loadPlaylist(g)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"pathways",get:function(){return this.steering?this.steering.pathways():[]}},{key:"pathwayPriority",get:function(){return this.steering?this.steering.pathwayPriority:null},set:function(e){if(this.steering){var t=this.steering.pathways(),i=e.filter(function(a){return t.indexOf(a)!==-1});if(e.length<1){this.warn("pathwayPriority "+e+" should contain at least one pathway from list: "+t);return}this.steering.pathwayPriority=i}}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}])}(_a);function Ll(s){var o={};s.forEach(function(n){var r=n.groupId||"";n.id=o[r]=o[r]||0,o[r]++})}function Il(){return self.SourceBuffer||self.WebKitSourceBuffer}function bl(){var s=Ie();if(!s)return!1;var o=Il();return!o||o.prototype&&typeof o.prototype.appendBuffer=="function"&&typeof o.prototype.remove=="function"}function Hh(){if(!bl())return!1;var s=Ie();return typeof s?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(o){return s.isTypeSupported(Gr(o,"video"))})||["mp4a.40.2","fLaC"].some(function(o){return s.isTypeSupported(Gr(o,"audio"))}))}function Vh(){var s,o=Il();return typeof(o==null||(s=o.prototype)==null?void 0:s.changeType)=="function"}var Wh=100,Yh=function(s){function o(r,e,t){var i;return i=s.call(this,r,e,t,"stream-controller",F.MAIN)||this,i.audioCodecSwap=!1,i.level=-1,i._forceStartLoad=!1,i._hasEnoughToStart=!1,i.altAudio=0,i.audioOnly=!1,i.fragPlaying=null,i.fragLastKbps=0,i.couldBacktrack=!1,i.backtrackFragment=null,i.audioCodecSwitch=!1,i.videoBuffer=null,i.onMediaPlaying=function(){i.tick()},i.onMediaSeeked=function(){var a=i.media,l=a?a.currentTime:null;if(!(l===null||!H(l))&&(i.log("Media seeked to "+l.toFixed(3)),!!i.getBufferedFrag(l))){var u=i.getFwdBufferInfoAtPos(a,l,F.MAIN,0);if(u===null||u.len===0){i.warn("Main forward buffer length at "+l+' on "seeked" event '+(u?u.len:"empty")+")");return}i.tick()}},i.registerListeners(),i}ae(o,s);var n=o.prototype;return n.registerListeners=function(){s.prototype.registerListeners.call(this);var e=this.hls;e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},n.unregisterListeners=function(){s.prototype.unregisterListeners.call(this);var e=this.hls;e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)},n.onHandlerDestroying=function(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),s.prototype.onHandlerDestroying.call(this)},n.startLoad=function(e,t){if(this.levels){var i=this.lastCurrentTime,a=this.hls;if(this.stopLoad(),this.setInterval(Wh),this.level=-1,!this.startFragRequested){var l=a.startLevel;l===-1&&(a.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=a.firstAutoLevel),a.nextLoadLevel=l,this.level=a.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),e=i),this.state=M.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=M.STOPPED},n.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},n.doTick=function(){switch(this.state){case M.WAITING_LEVEL:{var e=this.levels,t=this.level,i=e?.[t],a=i?.details;if(a&&(!a.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(a))break;this.state=M.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=M.IDLE;break}break}case M.FRAG_LOADING_WAITING_RETRY:{var l,u=self.performance.now(),f=this.retryDate;if(!f||u>=f||(l=this.media)!=null&&l.seeking){var d=this.levels,h=this.level,c=d?.[h];this.resetStartWhenNotLoaded(c||null),this.state=M.IDLE}}break}this.state===M.IDLE&&this.doTickIdle(),this.onTickEnd()},n.onTickEnd=function(){var e;s.prototype.onTickEnd.call(this),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()},n.doTickIdle=function(){var e=this.hls,t=this.levelLastLoaded,i=this.levels,a=this.media;if(!(t===null||!a&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)){var l=this.buffering?e.nextLoadLevel:e.loadLevel;if(i!=null&&i[l]){var u=i[l],f=this.getMainFwdBufferInfo();if(f!==null){var d=this.getLevelDetails();if(d&&this._streamEnded(f,d)){var h={};this.altAudio===2&&(h.type="video"),this.hls.trigger(y.BUFFER_EOS,h),this.state=M.ENDED;return}if(this.buffering){e.loadLevel!==l&&e.manualLevel===-1&&this.log("Adapting to level "+l+" from level "+this.level),this.level=e.nextLoadLevel=l;var c=u.details;if(!c||this.state===M.WAITING_LEVEL||this.waitForLive(u)){this.level=l,this.state=M.WAITING_LEVEL,this.startFragRequested=!1;return}var v=f.len,g=this.getMaxBufferLength(u.maxBitrate);if(!(v>=g)){this.backtrackFragment&&this.backtrackFragment.start>f.end&&(this.backtrackFragment=null);var m=this.backtrackFragment?this.backtrackFragment.start:f.end,p=this.getNextFragment(m,c);if(this.couldBacktrack&&!this.fragPrevious&&p&&Ue(p)&&this.fragmentTracker.getState(p)!==ot.OK){var E,S=((E=this.backtrackFragment)!=null?E:p).sn,T=S-c.startSN,A=c.fragments[T-1];A&&p.cc===A.cc&&(p=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&f.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,m)){var x=p.gap;if(!x){var I=this.audioOnly&&!this.altAudio?se.AUDIO:se.VIDEO,k=(I===se.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;k&&this.afterBufferFlushed(k,I,F.MAIN)}p=this.getNextFragmentLoopLoading(p,c,f,F.MAIN,g)}p&&(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,u,m))}}}}}},n.loadFragment=function(e,t,i){var a=this.fragmentTracker.getState(e);a===ot.NOT_LOADED||a===ot.PARTIAL?Ue(e)?this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e,t)):s.prototype.loadFragment.call(this,e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)},n.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,F.MAIN)},n.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},n.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},n.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(t!=null&&t.readyState){var i,a=this.getAppendedFrag(t.currentTime);a&&a.start>1&&this.flushMainBuffer(0,a.start-1);var l=this.getLevelDetails();if(l!=null&&l.live){var u=this.getMainFwdBufferInfo();if(!u||u.len<l.targetduration*2)return}if(!t.paused&&e){var f=this.hls.nextLoadLevel,d=e[f],h=this.fragLastKbps;h&&this.fragCurrent?i=this.fragCurrent.duration*d.maxBitrate/(1e3*h)+1:i=0}else i=0;var c=this.getBufferedFrag(t.currentTime+i);if(c){var v=this.followingBufferedFrag(c);if(v){this.abortCurrentFrag();var g=v.maxStartPTS?v.maxStartPTS:v.start,m=v.duration,p=Math.max(c.end,g+Math.min(Math.max(m-this.config.maxFragLookUpTolerance,m*(this.couldBacktrack?.5:.125)),m*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(p,Number.POSITIVE_INFINITY)}}}},n.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case M.KEY_LOADING:case M.FRAG_LOADING:case M.FRAG_LOADING_WAITING_RETRY:case M.PARSING:case M.PARSED:this.state=M.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},n.flushMainBuffer=function(e,t){s.prototype.flushMainBuffer.call(this,e,t,this.altAudio===2?"video":null)},n.onMediaAttached=function(e,t){s.prototype.onMediaAttached.call(this,e,t);var i=t.media;Qt(i,"playing",this.onMediaPlaying),Qt(i,"seeked",this.onMediaSeeked)},n.onMediaDetaching=function(e,t){var i=this.media;i&&(rr(i,"playing",this.onMediaPlaying),rr(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,s.prototype.onMediaDetaching.call(this,e,t);var a=!!t.transferMedia;a||(this._hasEnoughToStart=!1)},n.onManifestLoading=function(){s.prototype.onManifestLoading.call(this),this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1},n.onManifestParsed=function(e,t){var i=!1,a=!1;t.levels.forEach(function(l){var u=l.audioCodec;u&&(i=i||u.indexOf("mp4a.40.2")!==-1,a=a||u.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&a&&!Vh(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},n.onLevelLoading=function(e,t){var i=this.levels;if(!(!i||this.state!==M.IDLE)){var a=t.levelInfo;(!a.details||a.details.live&&(this.levelLastLoaded!==a||a.details.expired)||this.waitForCdnTuneIn(a.details))&&(this.state=M.WAITING_LEVEL)}},n.onLevelLoaded=function(e,t){var i,a=this.levels,l=this.startFragRequested,u=t.level,f=t.details,d=f.totalduration;if(!a){this.warn("Levels were reset while loading level "+u);return}this.log("Level "+u+" loaded ["+f.startSN+","+f.endSN+"]"+(f.lastPartSn?"[part-"+f.lastPartSn+"-"+f.lastPartIndex+"]":"")+", cc ["+f.startCC+", "+f.endCC+"] duration:"+d);var h=t.levelInfo,c=this.fragCurrent;c&&(this.state===M.FRAG_LOADING||this.state===M.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();var v=0;if(f.live||(i=h.details)!=null&&i.live){var g;if(this.checkLiveUpdate(f),f.deltaUpdateFailed)return;v=this.alignPlaylists(f,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(h.details=f,this.levelLastLoaded=h,l||this.setStartPosition(f,v),this.hls.trigger(y.LEVEL_UPDATED,{details:f,level:u}),this.state===M.WAITING_LEVEL){if(this.waitForCdnTuneIn(f))return;this.state=M.IDLE}l&&f.live&&this.synchronizeToLiveEdge(f),this.tick()},n.synchronizeToLiveEdge=function(e){var t=this.config,i=this.media;if(i){var a=this.hls.liveSyncPosition,l=this.getLoadPosition(),u=e.fragmentStart,f=e.edge,d=l>=u-t.maxFragLookUpTolerance&&l<=f;if(a!==null&&i.duration>a&&(l<a||!d)){var h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!d&&i.readyState<4||l<f-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=a),i.readyState))if(this.warn("Playback: "+l.toFixed(3)+" is located too far from the end of live sliding playlist: "+f+", reset currentTime to : "+a.toFixed(3)),this.config.liveSyncMode==="buffered"){var c,v=Ae.bufferInfo(i,a,0);if(!(v!=null&&(c=v.buffered)!=null&&c.length)){i.currentTime=a;return}var g=v.start<=l;if(g){i.currentTime=a;return}var m=Ae.bufferedInfo(v.buffered,l,0),p=m.nextStart;p&&(i.currentTime=p)}else i.currentTime=a}}},n._handleFragmentLoadProgress=function(e){var t,i=e.frag,a=e.part,l=e.payload,u=this.levels;if(!u){this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var f=u[i.level];if(!f){this.warn("Level "+i.level+" not found on progress");return}var d=f.details;if(!d){this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),this.fragmentTracker.removeFragment(i);return}var h=f.videoCodec,c=d.PTSKnown||!d.live,v=(t=i.initSegment)==null?void 0:t.data,g=this._getAudioCodec(f),m=this.transmuxer=this.transmuxer||new Mo(this.hls,F.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=a?a.index:-1,E=p!==-1,S=new ia(i.level,i.sn,i.stats.chunkCount,l.byteLength,p,E),T=this.initPTS[i.cc];m.push(l,v,g,h,i,a,d.totalduration,c,S,T)},n.onAudioTrackSwitching=function(e,t){var i=this,a=this.hls,l=this.altAudio===2,u=sn(t.url,a);if(u)this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var f=this.fragCurrent;f&&(this.log("Switching to main audio track, cancel main fragment load"),f.abortRequests(),this.fragmentTracker.removeFragment(f)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(l){this.fragmentTracker.removeAllFragments(),a.once(y.BUFFER_FLUSHED,function(){var d;(d=i.hls)==null||d.trigger(y.AUDIO_TRACK_SWITCHED,t)}),a.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}a.trigger(y.AUDIO_TRACK_SWITCHED,t)}},n.onAudioTrackSwitched=function(e,t){var i=sn(t.url,this.hls);if(i){var a=this.videoBuffer;a&&this.mediaBuffer!==a&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=a)}this.altAudio=i?2:0,this.tick()},n.onBufferCreated=function(e,t){var i=t.tracks,a,l,u=!1;for(var f in i){var d=i[f];if(d.id==="main"){if(l=f,a=d,f==="video"){var h=i[f];h&&(this.videoBuffer=h.buffer)}}else u=!0}u&&a?(this.log("Alternate track found, use "+l+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media},n.onFragBuffered=function(e,t){var i=t.frag,a=t.part,l=i.type===F.MAIN;if(l){if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(a?" p: "+a.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),this.state===M.PARSED&&(this.state=M.IDLE);return}var u=a?a.stats:i.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),Ue(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,a)}var f=this.media;f&&(!this._hasEnoughToStart&&Ae.getBuffered(f).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())},n.onError=function(e,t){var i;if(t.fatal){this.state=M.ERROR;return}switch(t.details){case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(F.MAIN,t);break;case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:case _.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===M.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===N.LEVEL&&(this.state=M.IDLE);break;case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case _.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case _.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}},n.onFragLoadEmergencyAborted=function(){this.state=M.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()},n.onBufferFlushed=function(e,t){var i=t.type;if(i!==se.AUDIO||!this.altAudio){var a=(i===se.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;a&&(this.afterBufferFlushed(a,i,F.MAIN),this.tick())}},n.onLevelsUpdated=function(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels},n.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},n.seekToStartPos=function(){var e=this.media;if(e){var t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log("could not seek to "+i+", already seeking at "+t);return}var a=this.timelineOffset;a&&i&&(i+=a);var l=this.getLevelDetails(),u=Ae.getBuffered(e),f=u.length?u.start(0):0,d=f-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<h||this.loadingParts&&d<2*(l?.partTarget||0)))&&(this.log("adjusting start position by "+d+" to match buffer start"),i+=d,this.startPosition=i),t<i&&(this.log("seek to target start position "+i+" from current time "+t+" buffer start "+f),e.currentTime=i)}}},n._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t},n._loadBitrateTestFrag=function(e,t){var i=this;e.bitrateTest=!0,this._doFragLoad(e,t).then(function(a){var l=i.hls,u=a?.frag;if(!(!u||i.fragContextChanged(u))){t.fragmentError=0,i.state=M.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var f=u.stats;f.parsing.start=f.parsing.end=f.buffering.start=f.buffering.end=self.performance.now(),l.trigger(y.FRAG_LOADED,a),u.bitrateTest=!1}})},n._handleTransmuxComplete=function(e){var t,i=this.playlistType,a=this.hls,l=e.remuxResult,u=e.chunkMeta,f=this.getCurrentContext(u);if(!f){this.resetWhenMissingContext(u);return}var d=f.frag,h=f.part,c=f.level,v=l.video,g=l.text,m=l.id3,p=l.initSegment,E=c.details,S=this.altAudio?void 0:l.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=M.PARSING,p){if(p!=null&&p.tracks){var T=d.initSegment||d;this._bufferInitSegment(c,p.tracks,T,u),a.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:p.tracks})}var A=p.initPTS,x=p.timescale,I=this.initPTS[d.cc];H(A)&&(!I||I.baseTime!==A||I.timescale!==x)&&(this.initPTS[d.cc]={baseTime:A,timescale:x},a.trigger(y.INIT_PTS_FOUND,{frag:d,id:i,initPTS:A,timescale:x}))}if(v&&E){S&&v.type==="audiovideo"&&this.logMuxedErr(d);var k=E.fragments[d.sn-1-E.startSN],D=d.sn===E.startSN,b=!k||d.cc>k.cc;if(l.independent!==!1){var L=v.startPTS,R=v.endPTS,C=v.startDTS,B=v.endDTS;if(h)h.elementaryStreams[v.type]={startPTS:L,endPTS:R,startDTS:C,endDTS:B};else if(v.firstKeyFrame&&v.independent&&u.id===1&&!b&&(this.couldBacktrack=!0),v.dropped&&v.independent){var P=this.getMainFwdBufferInfo(),O=(P?P.end:this.getLoadPosition())+this.config.maxBufferHole,V=v.firstKeyFramePTS?v.firstKeyFramePTS:L;if(!D&&O<V-this.config.maxBufferHole&&!b){this.backtrack(d);return}else b&&(d.gap=!0);d.setElementaryStreamInfo(v.type,d.start,R,d.start,B,!0)}else D&&L-(E.appliedTimelineOffset||0)>Dn&&(d.gap=!0);d.setElementaryStreamInfo(v.type,L,R,C,B),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(v,d,h,u,D||b)}else if(D||b)d.gap=!0;else{this.backtrack(d);return}}if(S){var X=S.startPTS,z=S.endPTS,Q=S.startDTS,ue=S.endDTS;h&&(h.elementaryStreams[se.AUDIO]={startPTS:X,endPTS:z,startDTS:Q,endDTS:ue}),d.setElementaryStreamInfo(se.AUDIO,X,z,Q,ue),this.bufferFragmentData(S,d,h,u)}if(E&&m!=null&&(t=m.samples)!=null&&t.length){var te={id:i,frag:d,details:E,samples:m.samples};a.trigger(y.FRAG_PARSING_METADATA,te)}if(E&&g){var le={id:i,frag:d,details:E,samples:g.samples};a.trigger(y.FRAG_PARSING_USERDATA,le)}},n.logMuxedErr=function(e){this.warn((Ue(e)?"Media":"Init")+" segment with muxed audiovideo where only video expected: "+e.url)},n._bufferInitSegment=function(e,t,i,a){var l=this;if(this.state===M.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));var u=t.audio,f=t.video,d=t.audiovideo;if(u){var h=e.audioCodec,c=er(u.codec,h);c==="mp4a"&&(c="mp4a.40.5");var v=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");var g=u.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&v.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&v.indexOf("android")!==-1&&u.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log("Android: force audio codec to "+c)),h&&h!==c&&this.log('Swapping manifest audio codec "'+h+'" for "'+c+'"'),u.levelCodec=c,u.id=F.MAIN,this.log("Init audio buffer, container:"+u.container+", codecs[selected/level/parsed]=["+(c||"")+"/"+(h||"")+"/"+u.codec+"]"),delete t.audiovideo}if(f){f.levelCodec=e.videoCodec,f.id=F.MAIN;var m=f.codec;if(m?.length===4)switch(m){case"hvc1":case"hev1":f.codec="hvc1.1.6.L120.90";break;case"av01":f.codec="av01.0.04M.08";break;case"avc1":f.codec="avc1.42e01e";break}this.log("Init video buffer, container:"+f.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+m+"]"+(f.codec!==m?" parsed-corrected="+f.codec:"")+(f.supplemental?" supplemental="+f.supplemental:"")),delete t.audiovideo}d&&(this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+e.codecs+"/"+d.codec+"]"),delete t.video,delete t.audio);var p=Object.keys(t);if(p.length){if(this.hls.trigger(y.BUFFER_CODECS,t),!this.hls)return;p.forEach(function(E){var S=t[E],T=S.initSegment;T!=null&&T.byteLength&&l.hls.trigger(y.BUFFER_APPENDING,{type:E,data:T,frag:i,part:null,chunkMeta:a,parent:i.type})})}this.tickImmediate()}},n.getMainFwdBufferInfo=function(){var e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,F.MAIN)},n.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=M.IDLE},n.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&e.seeking===!1){var i=e.currentTime;if(Ae.isBuffered(e,i)?t=this.getAppendedFrag(i):Ae.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;var a=this.fragPlaying,l=t.level;(!a||t.sn!==a.sn||a.level!==l)&&(this.fragPlaying=t,this.hls.trigger(y.FRAG_CHANGED,{frag:t}),(!a||a.level!==l)&&this.hls.trigger(y.LEVEL_SWITCHED,{level:l}))}}},W(o,[{key:"hasEnoughToStart",get:function(){return this._hasEnoughToStart}},{key:"maxBufferLength",get:function(){var e=this.levels,t=this.level,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e;if(this.fragPlaying)return this.fragPlaying;var t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return H(t)?this.getAppendedFrag(t):null}},{key:"currentProgramDateTime",get:function(){var e,t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(H(t)){var i=this.getLevelDetails(),a=this.currentFrag||(i?Vr(null,i.fragments,t):null);if(a){var l=a.programDateTime;if(l!==null){var u=l+(t-a.start)*1e3;return new Date(u)}}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])}(ha),qh=function(){function s(n){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=n}var o=s.prototype;return o.abort=function(r){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;if(t){var i;if(r&&r!==((i=t.context)==null?void 0:i.frag.type))return;t.abort()}}},o.detach=function(){for(var r in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[r];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[r]}},o.destroy=function(){this.detach();for(var r in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[r].loader;e&&e.destroy()}this.keyUriToKeyInfo={}},o.createKeyLoadError=function(r,e,t,i,a){return e===void 0&&(e=_.KEY_LOAD_ERROR),new mr({type:Y.NETWORK_ERROR,details:e,fatal:!1,frag:r,response:a,error:t,networkDetails:i})},o.loadClear=function(r,e,t){var i=this;if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length){for(var a=function(){var c=e[u];if(r.cc<=c.cc&&(!Ue(r)||!Ue(c)||r.sn<c.sn)||!t&&u==f-1)return{v:i.emeController.selectKeySystemFormat(c).then(function(v){if(i.emeController){c.setKeyFormat(v);var g=oa(v);if(g)return i.emeController.getKeySystemAccess([g])}})}},l,u=0,f=e.length;u<f;u++)if(l=a(),l)return l.v}if(this.config.requireKeySystemAccessOnStart){var d=hn(this.config);if(d.length)return this.emeController.getKeySystemAccess(d)}}return null},o.load=function(r){var e=this;return!r.decryptdata&&r.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(r).then(function(t){return e.loadInternal(r,t)}):this.loadInternal(r)},o.loadInternal=function(r,e){var t,i;e&&r.setKeyFormat(e);var a=r.decryptdata;if(!a){var l=new Error(e?"Expected frag.decryptdata to be defined after setting format "+e:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(r,_.KEY_LOAD_ERROR,l))}var u=a.uri;if(!u)return Promise.reject(this.createKeyLoadError(r,_.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+u+'"')));var f=this.keyUriToKeyInfo[u];if((t=f)!=null&&t.decryptdata.key)return a.key=f.decryptdata.key,Promise.resolve({frag:r,keyInfo:f});if((i=f)!=null&&i.keyLoadPromise){var d;switch((d=f.mediaKeySessionContext)==null?void 0:d.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return f.keyLoadPromise.then(function(h){return a.key=h.keyInfo.decryptdata.key,{frag:r,keyInfo:f}})}}switch(f=this.keyUriToKeyInfo[u]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(f,r):this.loadKeyEME(f,r);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(f,r);default:return Promise.reject(this.createKeyLoadError(r,_.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+a.method+'"')))}},o.loadKeyEME=function(r,e){var t={frag:e,keyInfo:r};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(t);if(i)return(r.keyLoadPromise=i.then(function(a){return r.mediaKeySessionContext=a,t})).catch(function(a){throw r.keyLoadPromise=null,a})}return Promise.resolve(t)},o.loadKeyHTTP=function(r,e){var t=this,i=this.config,a=i.loader,l=new a(i);return e.keyLoader=r.loader=l,r.keyLoadPromise=new Promise(function(u,f){var d={keyInfo:r,frag:e,responseType:"arraybuffer",url:r.decryptdata.uri},h=i.keyLoadPolicy.default,c={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},v={onSuccess:function(m,p,E,S){var T=E.frag,A=E.keyInfo,x=E.url;if(!T.decryptdata||A!==t.keyUriToKeyInfo[x])return f(t.createKeyLoadError(T,_.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));A.decryptdata.key=T.decryptdata.key=new Uint8Array(m.data),T.keyLoader=null,A.loader=null,u({frag:T,keyInfo:A})},onError:function(m,p,E,S){t.resetLoader(p),f(t.createKeyLoadError(e,_.KEY_LOAD_ERROR,new Error("HTTP Error "+m.code+" loading key "+m.text),E,Ee({url:d.url,data:void 0},m)))},onTimeout:function(m,p,E){t.resetLoader(p),f(t.createKeyLoadError(e,_.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:function(m,p,E){t.resetLoader(p),f(t.createKeyLoadError(e,_.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};l.load(d,c,v)})},o.resetLoader=function(r){var e=r.frag,t=r.keyInfo,i=r.url,a=t.loader;e.keyLoader===a&&(e.keyLoader=null,t.loader=null),delete this.keyUriToKeyInfo[i],a&&a.destroy()},s}();function Rl(s){var o=s.type;switch(o){case N.AUDIO_TRACK:return F.AUDIO;case N.SUBTITLE_TRACK:return F.SUBTITLE;default:return F.MAIN}}function za(s,o){var n=s.url;return(n===void 0||n.indexOf("data:")===0)&&(n=o.url),n}var jh=function(){function s(n){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=n,this.registerListeners()}var o=s.prototype;return o.startLoad=function(r){},o.stopLoad=function(){this.destroyInternalLoaders()},o.registerListeners=function(){var r=this.hls;r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.LEVEL_LOADING,this.onLevelLoading,this),r.on(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this)},o.unregisterListeners=function(){var r=this.hls;r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.LEVEL_LOADING,this.onLevelLoading,this),r.off(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this)},o.createInternalLoader=function(r){var e=this.hls.config,t=e.pLoader,i=e.loader,a=t||i,l=new a(e);return this.loaders[r.type]=l,l},o.getInternalLoader=function(r){return this.loaders[r.type]},o.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},o.destroyInternalLoaders=function(){for(var r in this.loaders){var e=this.loaders[r];e&&e.destroy(),this.resetInternalLoader(r)}},o.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},o.onManifestLoading=function(r,e){var t=e.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:N.MANIFEST,url:t,deliveryDirectives:null,levelOrTrack:null})},o.onLevelLoading=function(r,e){var t=e.id,i=e.level,a=e.pathwayId,l=e.url,u=e.deliveryDirectives,f=e.levelInfo;this.load({id:t,level:i,pathwayId:a,responseType:"text",type:N.LEVEL,url:l,deliveryDirectives:u,levelOrTrack:f})},o.onAudioTrackLoading=function(r,e){var t=e.id,i=e.groupId,a=e.url,l=e.deliveryDirectives,u=e.track;this.load({id:t,groupId:i,level:null,responseType:"text",type:N.AUDIO_TRACK,url:a,deliveryDirectives:l,levelOrTrack:u})},o.onSubtitleTrackLoading=function(r,e){var t=e.id,i=e.groupId,a=e.url,l=e.deliveryDirectives,u=e.track;this.load({id:t,groupId:i,level:null,responseType:"text",type:N.SUBTITLE_TRACK,url:a,deliveryDirectives:l,levelOrTrack:u})},o.onLevelsUpdated=function(r,e){var t=this.loaders[N.LEVEL];if(t){var i=t.context;i&&!e.levels.some(function(a){return a===i.levelOrTrack})&&(t.abort(),delete this.loaders[N.LEVEL])}},o.load=function(r){var e,t=this,i=this.hls.config,a=this.getInternalLoader(r);if(a){var l=this.hls.logger,u=a.context;if(u&&u.levelOrTrack===r.levelOrTrack&&(u.url===r.url||u.deliveryDirectives&&!r.deliveryDirectives)){u.url===r.url?l.log("[playlist-loader]: ignore "+r.url+" ongoing request"):l.log("[playlist-loader]: ignore "+r.url+" in favor of "+u.url);return}l.log("[playlist-loader]: aborting previous loader for type: "+r.type),a.abort()}var f;if(r.type===N.MANIFEST?f=i.manifestLoadPolicy.default:f=re({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(r),H((e=r.deliveryDirectives)==null?void 0:e.part)){var d;if(r.type===N.LEVEL&&r.level!==null?d=this.hls.levels[r.level].details:r.type===N.AUDIO_TRACK&&r.id!==null?d=this.hls.audioTracks[r.id].details:r.type===N.SUBTITLE_TRACK&&r.id!==null&&(d=this.hls.subtitleTracks[r.id].details),d){var h=d.partTarget,c=d.targetduration;if(h&&c){var v=Math.max(h*3,c*.8)*1e3;f=re({},f,{maxTimeToFirstByteMs:Math.min(v,f.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,f.maxTimeToFirstByteMs)})}}}var g=f.errorRetry||f.timeoutRetry||{},m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:g.maxNumRetry||0,retryDelay:g.retryDelayMs||0,maxRetryDelay:g.maxRetryDelayMs||0},p={onSuccess:function(S,T,A,x){var I=t.getInternalLoader(A);t.resetInternalLoader(A.type);var k=S.data;if(k.indexOf("#EXTM3U")!==0){t.handleManifestParsingError(S,A,new Error("no EXTM3U delimiter"),x||null,T);return}T.parsing.start=performance.now(),Ci.isMediaPlaylist(k)||A.type!==N.MANIFEST?t.handleTrackOrLevelPlaylist(S,T,A,x||null,I):t.handleMasterPlaylist(S,T,A,x)},onError:function(S,T,A,x){t.handleNetworkError(T,A,!1,S,x)},onTimeout:function(S,T,A){t.handleNetworkError(T,A,!0,void 0,S)}};a.load(r,m,p)},o.checkAutostartLoad=function(){if(this.hls){var r=this.hls,e=r.config,t=e.autoStartLoad,i=e.startPosition,a=r.forceStartLoad;(t||a)&&(this.hls.logger.log((t?"auto":"force")+" startLoad with configured startPosition "+i),this.hls.startLoad(i))}},o.handleMasterPlaylist=function(r,e,t,i){var a=this.hls,l=r.data,u=za(r,t),f=Ci.parseMasterPlaylist(l,u);if(f.playlistParsingError){this.handleManifestParsingError(r,t,f.playlistParsingError,i,e);return}var d=f.contentSteering,h=f.levels,c=f.sessionData,v=f.sessionKeys,g=f.startTimeOffset,m=f.variableList;this.variableList=m;var p=Ci.parseMasterPlaylistMedia(l,u,f),E=p.AUDIO,S=E===void 0?[]:E,T=p.SUBTITLES,A=p["CLOSED-CAPTIONS"];if(S.length){var x=S.some(function(I){return!I.url});!x&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Je({}),bitrate:0,url:""}))}a.trigger(y.MANIFEST_LOADED,{levels:h,audioTracks:S,subtitles:T,captions:A,contentSteering:d,url:u,stats:e,networkDetails:i,sessionData:c,sessionKeys:v,startTimeOffset:g,variableList:m})},o.handleTrackOrLevelPlaylist=function(r,e,t,i,a){var l=this.hls,u=t.id,f=t.level,d=t.type,h=za(r,t),c=H(f)?f:H(u)?u:0,v=Rl(t),g=Ci.parseLevelPlaylist(r.data,h,c,v,0,this.variableList);if(d===N.MANIFEST){var m={attrs:new Je({}),bitrate:0,details:g,name:"",url:h};g.requestScheduled=e.loading.start+$s(g,0),l.trigger(y.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:h,stats:e,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),t.levelDetails=g,this.handlePlaylistLoaded(g,r,e,t,i,a)},o.handleManifestParsingError=function(r,e,t,i,a){this.hls.trigger(y.ERROR,{type:Y.NETWORK_ERROR,details:_.MANIFEST_PARSING_ERROR,fatal:e.type===N.MANIFEST,url:r.url,err:t,error:t,reason:t.message,response:r,context:e,networkDetails:i,stats:a})},o.handleNetworkError=function(r,e,t,i,a){t===void 0&&(t=!1);var l="A network "+(t?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+r.type;r.type===N.LEVEL?l+=": "+r.level+" id: "+r.id:(r.type===N.AUDIO_TRACK||r.type===N.SUBTITLE_TRACK)&&(l+=" id: "+r.id+' group-id: "'+r.groupId+'"');var u=new Error(l);this.hls.logger.warn("[playlist-loader]: "+l);var f=_.UNKNOWN,d=!1,h=this.getInternalLoader(r);switch(r.type){case N.MANIFEST:f=t?_.MANIFEST_LOAD_TIMEOUT:_.MANIFEST_LOAD_ERROR,d=!0;break;case N.LEVEL:f=t?_.LEVEL_LOAD_TIMEOUT:_.LEVEL_LOAD_ERROR,d=!1;break;case N.AUDIO_TRACK:f=t?_.AUDIO_TRACK_LOAD_TIMEOUT:_.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case N.SUBTITLE_TRACK:f=t?_.SUBTITLE_TRACK_LOAD_TIMEOUT:_.SUBTITLE_LOAD_ERROR,d=!1;break}h&&this.resetInternalLoader(r.type);var c={type:Y.NETWORK_ERROR,details:f,fatal:d,url:r.url,loader:h,context:r,error:u,networkDetails:e,stats:a};if(i){var v=e?.url||r.url;c.response=Ee({url:v,data:void 0},i)}this.hls.trigger(y.ERROR,c)},o.handlePlaylistLoaded=function(r,e,t,i,a,l){var u=this.hls,f=i.type,d=i.level,h=i.id,c=i.groupId,v=i.deliveryDirectives,g=za(e,i),m=Rl(i),p=typeof i.level=="number"&&m===F.MAIN?d:void 0;if(!r.fragments.length){var E=r.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(y.ERROR,{type:Y.NETWORK_ERROR,details:_.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:E,reason:E.message,response:e,context:i,level:p,parent:m,networkDetails:a,stats:t});return}r.targetduration||(r.playlistParsingError=new Error("Missing Target Duration"));var S=r.playlistParsingError;if(S){if(this.hls.logger.warn(S),!u.config.ignorePlaylistParsingErrors){u.trigger(y.ERROR,{type:Y.NETWORK_ERROR,details:_.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:S,reason:S.message,response:e,context:i,level:p,parent:m,networkDetails:a,stats:t});return}r.playlistParsingError=null}switch(r.live&&l&&(l.getCacheAge&&(r.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(r.ageHeader))&&(r.ageHeader=0)),f){case N.MANIFEST:case N.LEVEL:u.trigger(y.LEVEL_LOADED,{details:r,levelInfo:i.levelOrTrack||u.levels[0],level:p||0,id:h||0,stats:t,networkDetails:a,deliveryDirectives:v,withoutMultiVariant:f===N.MANIFEST});break;case N.AUDIO_TRACK:u.trigger(y.AUDIO_TRACK_LOADED,{details:r,track:i.levelOrTrack,id:h||0,groupId:c||"",stats:t,networkDetails:a,deliveryDirectives:v});break;case N.SUBTITLE_TRACK:u.trigger(y.SUBTITLE_TRACK_LOADED,{details:r,track:i.levelOrTrack,id:h||0,groupId:c||"",stats:t,networkDetails:a,deliveryDirectives:v});break}},s}(),_l=function(){function s(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new be,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;var r=this.logger=Dt(n.debug||!1,"Hls instance",n.assetPlayerId),e=this.config=Ph(s.DefaultConfig,n,r);this.userConfig=n,e.progressive&&wh(e,r);var t=e.abrController,i=e.bufferController,a=e.capLevelController,l=e.errorController,u=e.fpsController,f=new l(this),d=this.abrController=new t(this),h=new tu(this),c=e.interstitialsController,v=c?this.interstitialsController=new c(this,s):null,g=this.bufferController=new i(this,h),m=this.capLevelController=new a(this),p=new u(this),E=new jh(this),S=e.contentSteeringController,T=S?new S(this):null,A=this.levelController=new Kh(this,T),x=new Bh(this),I=new qh(this.config),k=this.streamController=new Yh(this,h,I),D=this.gapController=new Nh(this,h);m.setStreamController(k),p.setStreamController(k);var b=[E,A,k];v&&b.splice(1,0,v),T&&b.splice(1,0,T),this.networkControllers=b;var L=[d,g,D,m,p,x,h];this.audioTrackController=this.createController(e.audioTrackController,b);var R=e.audioStreamController;R&&b.push(this.audioStreamController=new R(this,h,I)),this.subtitleTrackController=this.createController(e.subtitleTrackController,b);var C=e.subtitleStreamController;C&&b.push(this.subtititleStreamController=new C(this,h,I)),this.createController(e.timelineController,L),I.emeController=this.emeController=this.createController(e.emeController,L),this.cmcdController=this.createController(e.cmcdController,L),this.latencyController=this.createController(Gh,L),this.coreComponents=L,b.push(f);var B=f.onErrorOut;typeof B=="function"&&this.on(y.ERROR,B,f),this.on(y.MANIFEST_LOADED,E.onManifestLoaded,E)}s.isMSESupported=function(){return bl()},s.isSupported=function(){return Hh()},s.getMediaSource=function(){return Ie()};var o=s.prototype;return o.createController=function(r,e){if(r){var t=new r(this);return e&&e.push(t),t}return null},o.on=function(r,e,t){t===void 0&&(t=this),this._emitter.on(r,e,t)},o.once=function(r,e,t){t===void 0&&(t=this),this._emitter.once(r,e,t)},o.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},o.off=function(r,e,t,i){t===void 0&&(t=this),this._emitter.off(r,e,t,i)},o.listeners=function(r){return this._emitter.listeners(r)},o.emit=function(r,e,t){return this._emitter.emit(r,e,t)},o.trigger=function(r,e){if(this.config.debug)return this.emit(r,r,e);try{return this.emit(r,r,e)}catch(i){if(this.logger.error("An internal error happened while handling event "+r+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;var t=r===y.ERROR;this.trigger(y.ERROR,{type:Y.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:t,event:r,error:i}),this.triggeringException=!1}}return!1},o.listenerCount=function(r){return this._emitter.listenerCount(r)},o.destroy=function(){this.logger.log("destroy"),this.trigger(y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0;var r=this.config;r.xhrSetup=r.fetchSetup=void 0,this.userConfig=null},o.attachMedia=function(r){if(!r||"media"in r&&!r.media){var e=new Error("attachMedia failed: invalid argument ("+r+")");this.trigger(y.ERROR,{type:Y.OTHER_ERROR,details:_.ATTACH_MEDIA_ERROR,fatal:!0,error:e});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());var t="media"in r,i=t?r.media:r,a=t?r:{media:i};this._media=i,this.trigger(y.MEDIA_ATTACHING,a)},o.detachMedia=function(){this.logger.log("detachMedia"),this.trigger(y.MEDIA_DETACHING,{}),this._media=null},o.transferMedia=function(){this._media=null;var r=this.bufferController.transferMedia();return this.trigger(y.MEDIA_DETACHING,{transferMedia:r}),r},o.loadSource=function(r){this.stopLoad();var e=this.media,t=this._url,i=this._url=_t.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:"+i),e&&t&&(t!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(y.MANIFEST_LOADING,{url:r})},o.startLoad=function(r,e){r===void 0&&(r=-1),this.logger.log("startLoad("+(r+(e?", <skip seek to start>":""))+")"),this.started=!0,this.resumeBuffering();for(var t=0;t<this.networkControllers.length&&(this.networkControllers[t].startLoad(r,e),!(!this.started||!this.networkControllers));t++);},o.stopLoad=function(){this.logger.log("stopLoad"),this.started=!1;for(var r=0;r<this.networkControllers.length&&(this.networkControllers[r].stopLoad(),!(this.started||!this.networkControllers));r++);},o.resumeBuffering=function(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(function(r){r.resumeBuffering&&r.resumeBuffering()}))},o.pauseBuffering=function(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(function(r){r.pauseBuffering&&r.pauseBuffering()}))},o.swapAudioCodec=function(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},o.recoverMediaError=function(){this.logger.log("recoverMediaError");var r=this._media,e=r?.currentTime;this.detachMedia(),r&&(this.attachMedia(r),e&&this.startLoad(e))},o.removeLevel=function(r){this.levelController.removeLevel(r)},o.setAudioOption=function(r){var e;return((e=this.audioTrackController)==null?void 0:e.setAudioOption(r))||null},o.setSubtitleOption=function(r){var e;return((e=this.subtitleTrackController)==null?void 0:e.setSubtitleOption(r))||null},o.getMediaDecodingInfo=function(r,e){e===void 0&&(e=this.allAudioTracks);var t=gs(e);return tn(r,t,navigator.mediaCapabilities)},W(s,[{key:"url",get:function(){return this._url}},{key:"hasEnoughToStart",get:function(){return this.streamController.hasEnoughToStart}},{key:"startPosition",get:function(){return this.streamController.startPositionValue}},{key:"loadingEnabled",get:function(){return this.started}},{key:"bufferingEnabled",get:function(){return this.streamController.bufferingEnabled}},{key:"inFlightFragments",get:function(){var r,e=(r={},r[F.MAIN]=this.streamController.inFlightFrag,r);return this.audioStreamController&&(e[F.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[F.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}},{key:"sessionId",get:function(){var r=this._sessionId;return r||(r=this._sessionId=G()),r}},{key:"levels",get:function(){var r=this.levelController.levels;return r||[]}},{key:"latestLevelDetails",get:function(){return this.streamController.getLevelDetails()||null}},{key:"loadLevelObj",get:function(){return this.levelController.loadLevelObj}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){this.logger.log("set currentLevel:"+r),this.levelController.manualLevel=r,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){this.logger.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){this.logger.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){this.logger.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){var r=this.levelController.startLevel;return r===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:r},set:function(r){this.logger.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var e=!!r;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(this.logger.log("set autoLevelCapping:"+r),this._autoLevelCapping=r,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN},set:function(r){this.abrController.resetEstimator(r)}},{key:"abrEwmaDefaultEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.defaultEstimate:NaN}},{key:"ttfbEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(r){Zn(r)&&this._maxHdcpLevel!==r&&(this._maxHdcpLevel=r,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,e=this.config.minAutoBitrate;if(!r)return 0;for(var t=r.length,i=0;i<t;i++)if(r[i].maxBitrate>=e)return i;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,e=this.autoLevelCapping,t=this.maxHdcpLevel,i;if(e===-1&&r!=null&&r.length?i=r.length-1:i=e,t)for(var a=i;a--;){var l=r[a].attrs["HDCP-LEVEL"];if(l&&l<=t)return a}return i}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(r){this.abrController.nextAutoLevel=r}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"maxBufferLength",get:function(){return this.streamController.maxBufferLength}},{key:"allAudioTracks",get:function(){var r=this.audioTrackController;return r?r.allAudioTracks:[]}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var e=this.audioTrackController;e&&(e.audioTrack=r)}},{key:"allSubtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var e=this.subtitleTrackController;e&&(e.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return r?r.subtitleDisplay:!1},set:function(r){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency},set:function(r){this.latencyController.targetLatency=r}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}},{key:"pathways",get:function(){return this.levelController.pathways}},{key:"pathwayPriority",get:function(){return this.levelController.pathwayPriority},set:function(r){this.levelController.pathwayPriority=r}},{key:"bufferedToEnd",get:function(){var r;return!!((r=this.bufferController)!=null&&r.bufferedToEnd)}},{key:"interstitialsManager",get:function(){var r;return((r=this.interstitialsController)==null?void 0:r.interstitialsManager)||null}}],[{key:"version",get:function(){return Fi}},{key:"Events",get:function(){return y}},{key:"MetadataSchema",get:function(){return Yt}},{key:"ErrorTypes",get:function(){return Y}},{key:"ErrorDetails",get:function(){return _}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:kh},set:function(r){s.defaultConfig=r}}])}();return _l.defaultConfig=void 0,_l})})(!1)}(os)),os.exports}var bc=Ic();const mi=sc(bc);var Rc=$e('<div class="flex w-full items-center gap-4 py-2"><audio preload="none" class="hidden"></audio> <button> </button> <iconify-icon></iconify-icon> <input type="range" min="0" max="1" step="0.01" class="range range-xs w-full"/></div>',2);function _c(ie,w){Bn(w,!0);const[Ne,qe]=Kn(),K=()=>Jr(Hn,"$_",Ne);let ne,W=null,je=Qr(!1),re=Qr(.7);cs(()=>{w.gameId&&ut(w.gameId)});async function ut(ge){if(!ne)return;W&&(W.destroy(),W=null);const be=`${w.url}/tts/${ge}/playlist.m3u8`;mi.isSupported()?(W=new mi({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,xhrSetup(me){me.setRequestHeader("ngrok-skip-browser-warning","true")}}),W.loadSource(be),W.attachMedia(ne),W.on(mi.Events.MANIFEST_PARSED,()=>{console.log("Received HLS manifest"),ae()}),W.on(mi.Events.ERROR,(me,De)=>{if(console.error("HLS error:",De),De.fatal)switch(De.type){case mi.ErrorTypes.NETWORK_ERROR:console.log("Network error, trying to recover..."),W?.startLoad();break;case mi.ErrorTypes.MEDIA_ERROR:console.log("Media error, trying to recover..."),W?.recoverMediaError();break;default:console.log("Fatal error, destroying HLS instance"),W?.destroy(),W=null;break}})):ne.canPlayType("application/vnd.apple.mpegurl")?(ne.src=be,ae()):console.error("HLS is not supported in this browser")}function ae(){ne&&ne.play().then(()=>{Xt(je,!0),console.log("Audio playback started")}).catch(ge=>{console.error("Failed to play audio:",ge),Xt(je,!1)})}function ct(){ne&&(ne.pause(),Xt(je,!1),console.log("Audio playback paused"))}function nt(){U(je)?ct():ae()}function at(ge){ne&&(Xt(re,Math.max(0,Math.min(1,ge)),!0),ne.volume=U(re))}function Ee(){Xt(je,!0)}function vt(){Xt(je,!1)}function Rt(){Xt(je,!1)}Un(()=>{W&&(W.destroy(),W=null)});var gt=Rc(),Xe=j(gt);Ar(Xe,ge=>ne=ge,()=>ne);var G=$(Xe,2);G.__click=nt;var J=j(G,!0);q(G);var ee=$(G,2);Ht(ee,"inline",!0),Ht(ee,"icon","mdi:volume");var he=$(ee,2);jt(he),q(gt),tt(ge=>{$r(G,1,`btn btn-sm ${U(je)?"btn-error":"btn-success"}`),G.disabled=!w.gameId,ye(J,ge)},[()=>U(je)?K()("audio.stop"):K()("audio.play")]),qi("play",Xe,Ee),qi("pause",Xe,vt),qi("ended",Xe,Rt),uc(he,()=>U(re),ge=>Xt(re,ge)),Ce(ie,gt);var Le=Gn({toggleAudio:nt,updateVolume:at});return qe(),Le}Nn(["click"]);var Dc=$e('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),kc=$e('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Cc=$e('<div class="status status-error"></div>'),Pc=(ie,w)=>w("connection.url",ie.currentTarget.value),wc=(ie,w)=>w("connection.token",ie.currentTarget.value),Mc=(ie,w)=>w("display.canvas.name",ie.currentTarget.checked),Oc=(ie,w)=>w("display.canvas.team",ie.currentTarget.checked),Fc=(ie,w)=>w("display.canvas.role",ie.currentTarget.checked),Nc=(ie,w)=>w("display.bubble.name",ie.currentTarget.checked),Uc=(ie,w)=>w("display.bubble.team",ie.currentTarget.checked),Bc=(ie,w)=>w("display.bubble.role",ie.currentTarget.checked),Gc=(ie,w)=>w("display.text.name",ie.currentTarget.checked),Kc=(ie,w)=>w("display.text.team",ie.currentTarget.checked),Hc=(ie,w)=>w("display.text.role",ie.currentTarget.checked),Vc=(ie,w)=>w("display.largeScale",ie.currentTarget.checked),Wc=$e('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><a class="text-3xl font-bold text-nowrap ml-2" href="./"> </a> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow"/></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow"/> <span class="badge badge-neutral badge-xs"> </span></label> <button class="btn btn-info"> </button> <button class="btn btn-error"> </button> <button class="btn"> </button> <button class="btn"> </button> <dialog class="modal"><div class="modal-box"><div class="form-control my-2"><h3 class="text-lg font-bold"> </h3> <h4 class="text-base font-bold mt-2"> </h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label></div> <h4 class="text-base font-bold mt-2"> </h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label></div> <h4 class="text-base font-bold mt-2"> </h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <label class="label cursor-pointer"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label></div> <h4 class="text-base font-bold mt-2"> </h4> <label class="label cursor-pointer my-2"><span class="label-text"> </span> <input type="checkbox" class="checkbox"/></label> <h4 class="text-base font-bold mt-2"> </h4> <div class="my-2"><!></div></div></div> <form method="dialog" class="modal-backdrop"><button> </button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"/> <iconify-icon></iconify-icon></label></div>',2);function Yc(ie,w){Bn(w,!0);const[Ne,qe]=Kn(),K=()=>Jr(Hn,"$_",Ne),ne=()=>Jr(vr,"$realtimeSocketState",Ne);let W=Qr(void 0);const je=pi.subscribe(At=>{Xt(W,At,!0)});Un(()=>{je()});function re(At,Wt){pi.update(_r=>{const er=At.split("."),Dr=er.pop();let Bt=_r;for(const lr of er)lr&&(Bt=Bt[lr]);return Bt[Dr]=Wt,{..._r}})}function ut(){vr.connect()}function ae(){vr.disconnect()}async function ct(){await vr.loadFromClipboard()}let nt;var at=Wc(),Ee=j(at),vt=j(Ee,!0);q(Ee);var Rt=$(Ee,2),gt=j(Rt),Xe=j(gt);{var G=At=>{var Wt=Dc();us(2),Ce(At,Wt)},J=At=>{var Wt=Sr(),_r=Jt(Wt);{var er=Bt=>{var lr=kc();us(2),Ce(Bt,lr)},Dr=Bt=>{var lr=Cc();Ce(Bt,lr)};Tt(_r,Bt=>{ne().status===sr.CONNECTING?Bt(er):Bt(Dr,!1)},!0)}Ce(At,Wt)};Tt(Xe,At=>{ne().status===sr.CONNECTED?At(G):At(J,!1)})}q(gt),q(Rt);var ee=$(Rt,2),he=j(ee);$r(he,1,"h-[1em] opacity-50"),Ht(he,"inline",!0),Ht(he,"icon","mdi:link");var Le=$(he,2);jt(Le),Le.__input=[Pc,re],q(ee);var ge=$(ee,2),be=j(ge);$r(be,1,"h-[1em] opacity-50"),Ht(be,"inline",!0),Ht(be,"icon","mdi:key");var me=$(be,2);jt(me),me.__input=[wc,re];var De=$(me,2),St=j(De,!0);q(De),q(ge);var _t=$(ge,2);_t.__click=ut;var H=j(_t,!0);q(_t);var de=$(_t,2);de.__click=ae;var _e=j(de,!0);q(de);var Y=$(de,2);Y.__click=ct;var _=j(Y,!0);q(Y);var y=$(Y,2);y.__click=()=>nt.showModal();var N=j(y,!0);q(y);var F=$(y,2),fe=j(F),We=j(fe),Z=j(We),Oe=j(Z,!0);q(Z);var Ct=$(Z,2),Pt=j(Ct,!0);q(Ct);var rt=$(Ct,2),Pe=j(rt),ze=j(Pe),Dt=j(ze,!0);q(ze);var Se=$(ze,2);jt(Se),Se.__change=[Mc,re],q(Pe);var Ie=$(Pe,2),Fe=j(Ie),st=j(Fe,!0);q(Fe);var we=$(Fe,2);jt(we),we.__change=[Oc,re],q(Ie);var it=$(Ie,2),Re=j(it),ce=j(Re,!0);q(Re);var se=$(Re,2);jt(se),se.__change=[Fc,re],q(it),q(rt);var wt=$(rt,2),Ue=j(wt,!0);q(wt);var ft=$(wt,2),Mt=j(ft),Ot=j(Mt),Nr=j(Ot,!0);q(Ot);var Zt=$(Ot,2);jt(Zt),Zt.__change=[Nc,re],q(Mt);var Ft=$(Mt,2),Vt=j(Ft),Be=j(Vt,!0);q(Vt);var or=$(Vt,2);jt(or),or.__change=[Uc,re],q(Ft);var oe=$(Ft,2),xr=j(oe),Xi=j(xr,!0);q(xr);var yi=$(xr,2);jt(yi),yi.__change=[Bc,re],q(oe),q(ft);var pe=$(ft,2),Vn=j(pe,!0);q(pe);var Zr=$(pe,2),Ei=j(Zr),Lr=j(Ei),Wn=j(Lr,!0);q(Lr);var Ur=$(Lr,2);jt(Ur),Ur.__change=[Gc,re],q(Ei);var Ir=$(Ei,2),Nt=j(Ir),Yn=j(Nt,!0);q(Nt);var Ti=$(Nt,2);jt(Ti),Ti.__change=[Kc,re],q(Ir);var zi=$(Ir,2),Si=j(zi),Ut=j(Si,!0);q(Si);var ei=$(Si,2);jt(ei),ei.__change=[Hc,re],q(zi),q(Zr);var br=$(Zr,2),qn=j(br,!0);q(br);var Br=$(br,2),ti=j(Br),jn=j(ti,!0);q(ti);var Ai=$(ti,2);jt(Ai),Ai.__change=[Vc,re],q(Br);var xi=$(Br,2),Qi=j(xi,!0);q(xi);var gr=$(xi,2),Li=j(gr);Zh(Li,{}),q(gr),q(We),q(fe);var ri=$(fe,2),ii=j(ri),Gr=j(ii,!0);q(ii),q(ri),q(F),Ar(F,At=>nt=At,()=>nt);var Ii=$(F,2),Rr=j(Ii);Ht(Rr,"inline",!0),Ht(Rr,"icon","mdi:white-balance-sunny");var bi=$(Rr,2),$i=$(bi,2);Ht($i,"inline",!0),Ht($i,"icon","mdi:moon-and-stars"),q(Ii),q(at),tt((At,Wt,_r,er,Dr,Bt,lr,Ji,Ri,Zi,en,Xn,tn,zn,Qn,$n,rn,Jn,_i,Zn,ni,ea,ai,nn,an)=>{ye(vt,At),ji(Le,"placeholder",Wt),Fl(Le,U(W)?.connection.url),ji(me,"placeholder",_r),Fl(me,U(W)?.connection.token),ye(St,er),_t.disabled=ne().status!==sr.DISCONNECTED,ye(H,Dr),de.disabled=ne().status===sr.DISCONNECTED,ye(_e,Bt),ye(_,lr),ye(N,Ji),ye(Oe,Ri),ye(Pt,Zi),ye(Dt,en),cr(Se,U(W)?.display.canvas.name),ye(st,Xn),cr(we,U(W)?.display.canvas.team),ye(ce,tn),cr(se,U(W)?.display.canvas.role),ye(Ue,zn),ye(Nr,Qn),cr(Zt,U(W)?.display.bubble.name),ye(Be,$n),cr(or,U(W)?.display.bubble.team),ye(Xi,rn),cr(yi,U(W)?.display.bubble.role),ye(Vn,Jn),ye(Wn,_i),cr(Ur,U(W)?.display.text.name),ye(Yn,Zn),cr(Ti,U(W)?.display.text.team),ye(Ut,ni),cr(ei,U(W)?.display.text.role),ye(qn,ea),ye(jn,ai),cr(Ai,U(W)?.display.largeScale),ye(Qi,nn),ye(Gr,an)},[()=>K()("appName"),()=>K()("realtime.websocketUrl"),()=>K()("realtime.authKey"),()=>K()("realtime.optional"),()=>K()("realtime.connect"),()=>K()("realtime.disconnect"),()=>K()("realtime.pasteFromClipboard"),()=>K()("realtime.settings"),()=>K()("realtime.displaySettings"),()=>K()("realtime.canvasAgentInfo"),()=>K()("realtime.name"),()=>K()("realtime.teamName"),()=>K()("realtime.role"),()=>K()("realtime.messageBoxAgentInfo"),()=>K()("realtime.name"),()=>K()("realtime.teamName"),()=>K()("realtime.role"),()=>K()("realtime.listAgentInfo"),()=>K()("realtime.name"),()=>K()("realtime.teamName"),()=>K()("realtime.role"),()=>K()("realtime.largeScreen"),()=>K()("realtime.enable"),()=>K()("common.language"),()=>K()("common.close")]),Ce(ie,at),Gn(),qe()}Nn(["input","click","change"]);var qc=$e("<option> </option>"),jc=$e('<div class="divider"> </div>'),Xc=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),zc=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),Qc=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),$c=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),Jc=$e('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),Zc=$e("<!> <button><!></button>",1),ev=$e('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full" role="region"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="flex-1 overflow-y-auto h-full pr-2"><div class="flex flex-col p-2"><!> <div class="mb-2"><select class="w-full select"></select></div> <div class="list overflow-y-auto flex-1 my-2"><!></div></div></div></div></main>');function pv(ie,w){Bn(w,!0);const[Ne,qe]=Kn(),K=()=>Jr(vr,"$realtimeSocketState",Ne),ne=()=>Jr(ut,"$currentPacket",Ne),W=()=>Jr(Hn,"$_",Ne);let je=Qr(void 0);const re={id:"",idx:-1,day:0,is_day:!0,agents:dc(13),event:"未接続",message:void 0,from_idx:void 0,to_idx:void 0,bubble_idx:void 0},ut=Gl(re);let ae=Qr(void 0),ct=Qr(80),nt=!1,at=null;function Ee(){{const N=ac.url.searchParams,F=N.get("url"),fe=N.get("token");F&&(pi.update(We=>({...We,connection:{url:F??"",token:fe??""}})),vr.connect())}}function vt(N){N.preventDefault(),N.stopPropagation(),N.dataTransfer&&(N.dataTransfer.dropEffect="copy")}function Rt(N){N.preventDefault(),N.stopPropagation();const F=N.dataTransfer?.files;!F||F.length===0||vr.loadFromFiles(F)}function gt(N){if(!nt||!at)return;const F=at.getBoundingClientRect(),fe=N-F.left,We=F.width;Xt(ct,Math.min(90,Math.max(10,fe/We*100)),!0)}function Xe(){nt=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const N=fe=>{const We=fe instanceof MouseEvent?fe.clientX:fe.touches[0].clientX;gt(We)},F=()=>{nt=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",N),window.removeEventListener("touchmove",N),window.removeEventListener("mouseup",F),window.removeEventListener("touchend",F)};window.addEventListener("mousemove",N),window.addEventListener("touchmove",N),window.addEventListener("mouseup",F),window.addEventListener("touchend",F)}Bl(()=>{Ee();const N=vr.currentPacket.subscribe(fe=>{ut.set(fe||re)}),F=pi.subscribe(fe=>{Xt(ae,fe,!0)});Un(()=>{N(),F()}),window.addEventListener("beforeunload",fe=>{K().status===sr.CONNECTED&&fe.preventDefault()}),window.addEventListener("popstate",fe=>{K().status===sr.CONNECTED&&fe.preventDefault()})});let G=null;cs(()=>{if(G&&K().selectedPacketIdx!==null){const N=G.querySelectorAll("button");K().selectedPacketIdx>=0&&K().selectedPacketIdx<N.length&&N[K().selectedPacketIdx].scrollIntoView({behavior:"smooth",block:"center"})}});var J=ev(),ee=j(J);Yc(ee,{});var he=$(ee,2),Le=j(he),ge=j(Le);Lc(ge,{get packet(){return ne()},get focusIdx(){return U(je)},set focusIdx(N){Xt(je,N,!0)}}),q(Le);var be=$(Le,2);be.__mousedown=Xe,be.__touchstart=Xe;var me=$(be,2),De=j(me),St=j(De);{var _t=N=>{{let F=ls(()=>U(ae)?.connection.url??"http://localhost:8080/tts"),fe=ls(()=>K().currentGameId??"");_c(N,{get url(){return U(F)},get gameId(){return U(fe)}})}};Tt(St,N=>{N(_t)})}var H=$(St,2),de=j(H);de.__change=N=>{const F=N.currentTarget.value;vr.switchToGame(F,!0)},fs(de,5,()=>K().gameItems,ds,(N,F)=>{var fe=qc(),We=j(fe);q(fe);var Z={};tt(Oe=>{ye(We,`${(U(F).filename||U(F).id)??""}
                (${Oe??""})`),Z!==(Z=U(F).id)&&(fe.value=(fe.__value=U(F).id)??"")},[()=>new Date(U(F).updated_at).toLocaleTimeString()]),Ce(N,fe)}),q(de);var _e;ic(de),q(H);var Y=$(H,2),_=j(Y);{var y=N=>{var F=Sr(),fe=Jt(F);fs(fe,1,()=>K().entries[K().currentGameId]||[],ds,(We,Z,Oe)=>{var Ct=Zc(),Pt=Jt(Ct);{var rt=Ie=>{var Fe=jc(),st=j(Fe);q(Fe),tt(()=>ye(st,`${U(Z).day??""}日目 ${U(Z).is_day?"昼":"夜"}`)),Ce(Ie,Fe)};Tt(Pt,Ie=>{(Oe>0&&(U(Z).day!==K().entries[K().currentGameId][Oe-1].day||U(Z).is_day!==K().entries[K().currentGameId][Oe-1].is_day)||Oe===0)&&Ie(rt)})}var Pe=$(Pt,2);Pe.__click=()=>{vr.selectPacket(Oe,!0)};var ze=j(Pe);{var Dt=Ie=>{var Fe=Sr(),st=Jt(Fe);{var we=Re=>{var ce=Xc(),se=j(ce,!0);q(ce),tt(wt=>ye(se,wt),[()=>W()(`realtime.eventTypes.${U(Z).event}`,{default:U(Z).event})]),Ce(Re,ce)},it=Re=>{var ce=Sr(),se=Jt(ce);{var wt=ft=>{var Mt=zc(),Ot=Jt(Mt),Nr=j(Ot,!0);q(Ot);var Zt=$(Ot,2);Ht(Zt,"inline",!0),Ht(Zt,"icon","mdi:skip-forward"),tt(Ft=>ye(Nr,Ft),[()=>Et(U(ae)?.display.text,U(Z),U(Z).bubble_idx)]),Ce(ft,Mt)},Ue=ft=>{var Mt=Sr(),Ot=Jt(Mt);{var Nr=Ft=>{var Vt=Qc(),Be=Jt(Vt),or=j(Be,!0);q(Be);var oe=$(Be,2);Ht(oe,"inline",!0),Ht(oe,"icon","mdi:arrow-u-down-right-bold"),tt(xr=>ye(or,xr),[()=>Et(U(ae)?.display.text,U(Z),U(Z).bubble_idx)]),Ce(Ft,Vt)},Zt=Ft=>{var Vt=$c(),Be=j(Vt,!0);q(Vt),tt(or=>ye(Be,or),[()=>Et(U(ae)?.display.text,U(Z),U(Z).bubble_idx)+"<"+U(Z).message]),Ce(Ft,Vt)};Tt(Ot,Ft=>{U(Z).message==="Skip"?Ft(Nr):Ft(Zt,!1)},!0)}Ce(ft,Mt)};Tt(se,ft=>{U(Z).message==="Over"?ft(wt):ft(Ue,!1)},!0)}Ce(Re,ce)};Tt(st,Re=>{U(Z).event==="囁き"&&U(je)!==void 0&&U(Z).agents.find(ce=>ce.idx===U(je))?.role!=="WEREWOLF"?Re(we):Re(it,!1)})}Ce(Ie,Fe)},Se=Ie=>{var Fe=Jc(),st=j(Fe);{var we=ce=>{var se=Ol();tt(wt=>ye(se,wt),[()=>Et(U(ae)?.display.text,U(Z),U(Z).from_idx)]),Ce(ce,se)},it=ce=>{var se=Sr(),wt=Jt(se);{var Ue=ft=>{var Mt=Ol();tt(Ot=>ye(Mt,Ot),[()=>Et(U(ae)?.display.text,U(Z),U(Z).to_idx)]),Ce(ft,Mt)};Tt(wt,ft=>{(U(Z).event==="追放"||U(Z).event==="襲撃")&&ft(Ue)},!0)}Ce(ce,se)};Tt(st,ce=>{U(Z).event==="投票"||U(Z).event==="占い"?ce(we):ce(it,!1)})}var Re=$(st);q(Fe),tt(ce=>ye(Re,` ${ce??""}`),[()=>W()(`realtime.eventTypes.${U(Z).event}`,{default:U(Z).event})]),Ce(Ie,Fe)};Tt(ze,Ie=>{U(Z).event==="トーク"||U(Z).event==="囁き"?Ie(Dt):Ie(Se,!1)})}q(Pe),tt(()=>$r(Pe,1,`btn ${Oe===K().selectedPacketIdx?"btn-primary":""}`)),Ce(We,Ct)}),Ce(N,F)};Tt(_,N=>{K().currentGameId&&K().entries[K().currentGameId]&&N(y)})}q(Y),Ar(Y,N=>G=N,()=>G),q(De),q(me),q(he),Ar(he,N=>at=N,()=>at),q(J),tt(()=>{hs(Le,`width: ${U(ct)??""}%`),_e!==(_e=K().currentGameId)&&(de.value=(de.__value=K().currentGameId)??"",nc(de,K().currentGameId))}),qi("dragover",he,vt),qi("drop",he,Rt),Ce(ie,J),Gn(),qe()}Nn(["mousedown","touchstart","change","click"]);export{pv as component};
