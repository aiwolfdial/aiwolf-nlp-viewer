import{b as ae,d as Ee,a as L,t as N}from"../chunks/disclose-version.0HFg1qD0.js";import{i as fe}from"../chunks/legacy.C6KCpk-9.js";import{v as M,L as J,a5 as de,a4 as Te,I as j,m as _e,H as he,am as pe,J as Le,K as re,M as P,w as Y,ai as Ne,ao as U,N as ge,n as te,O as $e,D as se,ap as De,aq as Re,al as Oe,ar as Ce,q as me,a9 as Me,a3 as Ve,z as ne,as as He,at as Se,au as Fe,af as be,aj as qe,ah as ze,G as Ye,av as Be,p as xe,c as x,r as g,s as I,t as C,h as b,a as ye,a1 as Q,aw as Ke,ax as ie,ay as Ge,f as Je,az as le,B as q}from"../chunks/runtime.BQMbqn8H.js";import{a as V,h as Ue,e as z}from"../chunks/store.BFak2Tfs.js";import{p as Z,i as S}from"../chunks/props.E7He8GK1.js";import{b as We}from"../chunks/paths.DKxnExx7.js";function W(a,e){return e}function Xe(a,e,t,r){for(var o=[],s=e.length,n=0;n<s;n++)Re(e[n].e,o,!0);var u=s>0&&o.length===0&&t!==null;if(u){var d=t.parentNode;Oe(d),d.append(t),r.clear(),F(a,e[0].prev,e[s-1].next)}Ce(o,()=>{for(var k=0;k<s;k++){var v=e[k];u||(r.delete(v.k),F(a,v.prev,v.next)),me(v.e,!u)}})}function X(a,e,t,r,o,s=null){var n=a,u={flags:e,items:new Map,first:null};{var d=a;n=M?J(de(d)):d.appendChild(Te())}M&&j();var k=null,v=!1;_e(()=>{var y=t(),l=he(y)?y:y==null?[]:pe(y),i=l.length;if(v&&i===0)return;v=i===0;let m=!1;if(M){var w=n.data===Le;w!==(i===0)&&(n=re(),J(n),P(!1),m=!0)}if(M){for(var A=null,_,c=0;c<i;c++){if(Y.nodeType===8&&Y.data===Ne){n=Y,m=!0,P(!1);break}var h=l[c],f=r(h,c);_=ke(Y,u,A,null,h,f,c,o,e),u.items.set(f,_),A=_}i>0&&J(re())}if(!M){var p=Me;Pe(l,u,n,o,e,(p.f&U)!==0,r)}s!==null&&(i===0?k?ge(k):k=te(()=>s(n)):k!==null&&$e(k,()=>{k=null})),m&&P(!0),t()}),M&&(n=Y)}function Pe(a,e,t,r,o,s,n){var u=a.length,d=e.items,k=e.first,v=k,y,l=null,i=[],m=[],w,A,_,c;for(c=0;c<u;c+=1){if(w=a[c],A=n(w,c),_=d.get(A),_===void 0){var h=v?v.e.nodes_start:t;l=ke(h,e,l,l===null?e.first:l.next,w,A,c,r,o),d.set(A,l),i=[],m=[],v=l.next;continue}if(Qe(_,w,c),_.e.f&U&&ge(_.e),_!==v){if(y!==void 0&&y.has(_)){if(i.length<m.length){var f=m[0],p;l=f.prev;var T=i[0],D=i[i.length-1];for(p=0;p<i.length;p+=1)oe(i[p],f,t);for(p=0;p<m.length;p+=1)y.delete(m[p]);F(e,T.prev,D.next),F(e,l,T),F(e,D,f),v=f,l=D,c-=1,i=[],m=[]}else y.delete(_),oe(_,v,t),F(e,_.prev,_.next),F(e,_,l===null?e.first:l.next),F(e,l,_),l=_;continue}for(i=[],m=[];v!==null&&v.k!==A;)(s||!(v.e.f&U))&&(y??(y=new Set)).add(v),m.push(v),v=v.next;if(v===null)continue;_=v}i.push(_),l=_,v=_.next}if(v!==null||y!==void 0){for(var R=y===void 0?[]:pe(y);v!==null;)(s||!(v.e.f&U))&&R.push(v),v=v.next;var H=R.length;if(H>0){var E=u===0?t:null;Xe(e,R,E,d)}}se.first=e.first&&e.first.e,se.last=l&&l.e}function Qe(a,e,t,r){De(a.v,e),a.i=t}function ke(a,e,t,r,o,s,n,u,d){var k=(d&Se)!==0,v=(d&Fe)===0,y=k?v?Ve(o):ne(o):o,l=d&He?ne(n):n,i={i:l,v:y,k:s,a:null,e:null,prev:t,next:r};try{return i.e=te(()=>u(a,y,l),M),i.e.prev=t&&t.e,i.e.next=r&&r.e,t===null?e.first=i:(t.next=i,t.e.next=i.e),r!==null&&(r.prev=i,r.e.prev=i.e),i}finally{}}function oe(a,e,t){for(var r=a.next?a.next.e.nodes_start:t,o=e?e.e.nodes_start:t,s=a.e.nodes_start;s!==r;){var n=be(s);o.before(s),s=n}}function F(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ze(a,e,t,r,o){var s=a,n="",u;_e(()=>{if(n===(n=e()??"")){M&&j();return}u!==void 0&&(me(u),u=void 0),n!==""&&(u=te(()=>{if(M){Y.data;for(var d=j(),k=d;d!==null&&(d.nodeType!==8||d.data!=="");)k=d,d=be(d);if(d===null)throw qe(),ze;ae(Y,k),s=J(d);return}var v=n+"",y=Ee(v);ae(de(y),y.lastChild),s.before(y)}))})}function je(a,e,t,r){var o=a.__attributes??(a.__attributes={});M&&(o[e]=a.getAttribute(e),a.nodeName==="LINK")||o[e]!==(o[e]=t)&&(t==null?a.removeAttribute(e):typeof t!="string"&&et(a).includes(e)?a[e]=t:a.setAttribute(e,t))}var ve=new Map;function et(a){var e=ve.get(a.nodeName);if(e)return e;ve.set(a.nodeName,e=[]);for(var t,r=a,o=Element.prototype;o!==r;){t=Be(r);for(var s in t)t[s].set&&e.push(s);r=Ye(r)}return e}function ee(a,e,t){if(t){if(a.classList.contains(e))return;a.classList.add(e)}else{if(!a.classList.contains(e))return;a.classList.remove(e)}}function G(a){return function(...e){var t=e[0];return t.preventDefault(),a==null?void 0:a.apply(this,e)}}function ce(a,e){var s;var t=(s=a.$$events)==null?void 0:s[e.type],r=he(t)?t.slice():t==null?[]:[t];for(var o of r)o.call(this,e)}function ue(a){const e={};return a.forEach(t=>{const[r,o,...s]=t.split(",");e[r]||(e[r]=tt()),at(e[r],o,s)}),e}function tt(){return{status:{},talks:[],votes:[],execution:null,divine:null,attackVotes:[],attack:null,result:null}}function at(a,e,t){const o={status:([s,n,u,d])=>{a.status[s]={role:n,status:u,name:d}},talk:([s,n,u,d])=>{a.talks.push({talkIdx:s,turn:n,agentIdx:u,text:d})},vote:([s,n])=>{a.votes.push({voteAgentIdx:s,targetAgentIdx:n})},execute:([s,n])=>{a.execution={agentIdx:s,role:n}},divine:([s,n,u])=>{a.divine={agentIdx:s,targetAgentIdx:n,result:u}},attackVote:([s,n])=>{a.attackVotes.push({voteAgentIdx:s,targetAgentIdx:n})},attack:([s,n])=>{a.attack={agentIdx:s,isSuccessful:n==="true"}},result:([s,n,u])=>{a.result={villagers:s,werewolves:n,winSide:u}}}[e];o&&o(t)}function B(a,e,t){var o;const r=(o=a[e])==null?void 0:o.status[t];return r?`Agent[${t}] (${r.name})`:`Agent[${t}]`}function rt(a){const e=a.match(/>>Agent\[\d+\]/);return e?a.replace(e[0],`<strong>${e[0]}</strong>`).trim():a.trim()}var st=N("<li><strong> </strong> </li>"),nt=N('<section class="status-section"><h3>エージェント</h3> <ul></ul></section>'),it=N('<div class="divine-section"><h3>占い結果</h3> <p> </p></div>'),lt=N('<div class="attack-section"><h3>襲撃結果</h3> <p> </p></div>'),ot=N('<div class="execution-section"><h3>追放結果</h3> <p> </p></div>'),vt=N('<section class="game-events"><!> <!> <!></section>'),ct=N('<div class="talk"><strong> </strong> <!></div>'),ut=N('<section class="game-result-section"><h3>ゲーム結果</h3> <p> </p></section>'),ft=N('<div class="day-column"><div class="day-section"><h2> </h2> <div class="scrollable-content"><!> <!> <section class="talks-section"><h3>会話ログ</h3> <div class="talks"></div></section> <!></div></div></div>');function dt(a,e){xe(e,!1);let t=Z(e,"day",8),r=Z(e,"dayLog",8),o=Z(e,"processedLogs",8);fe();var s=ft(),n=x(s),u=x(n),d=x(u);g(u);var k=I(u,2),v=x(k);{var y=c=>{var h=nt(),f=I(x(h),2);X(f,5,()=>Object.entries(r().status),W,(p,T)=>{let D=()=>b(T)[0],R=()=>b(T)[1];var H=st(),E=x(H),$=x(E,!0);C(()=>V($,B(o(),t(),D()))),g(E);var O=I(E);g(H),C(()=>{ee(H,"over",R().status!=="ALIVE"),V(O,` ${R().role??""} -
                ${(R().status==="ALIVE"?"生存":"死亡")??""}`)}),L(p,H)}),g(f),g(h),L(c,h)};S(v,c=>{Object.keys(r().status).length>0&&c(y)})}var l=I(v,2);{var i=c=>{var h=vt(),f=x(h);{var p=E=>{var $=it(),O=I(x($),2);const K=Q(()=>B(o(),t(),r().divine.agentIdx)??""),Ae=Q(()=>B(o(),t(),r().divine.targetAgentIdx)??""),we=Q(()=>r().divine.result??"");var Ie=x(O);C(()=>V(Ie,`${b(K)} が
                ${b(Ae)}
                を占った結果:
                ${b(we)}`)),g(O),g($),L(E,$)};S(f,E=>{r().divine&&E(p)})}var T=I(f,2);{var D=E=>{var $=lt(),O=I(x($),2),K=x(O);C(()=>V(K,`${B(o(),t(),r().attack.agentIdx)??""} への襲撃:
                ${(r().attack.isSuccessful?"成功":"失敗")??""}`)),g(O),g($),L(E,$)};S(T,E=>{r().attack&&E(D)})}var R=I(T,2);{var H=E=>{var $=ot(),O=I(x($),2),K=x(O);C(()=>V(K,`${B(o(),t(),r().execution.agentIdx)??""} が追放されました
                (役職: ${r().execution.role??""})`)),g(O),g($),L(E,$)};S(R,E=>{r().execution&&E(H)})}g(h),L(c,h)};S(l,c=>{(r().divine||r().attack||r().execution)&&c(i)})}var m=I(l,2),w=I(x(m),2);X(w,5,()=>r().talks,W,(c,h)=>{var f=ct(),p=x(f),T=x(p,!0);C(()=>V(T,B(o(),t(),b(h).agentIdx))),g(p);var D=I(p,2);Ze(D,()=>rt(b(h).text)),g(f),C(()=>ee(f,"over",b(h).text==="Over")),L(c,f)}),g(w),g(m);var A=I(m,2);{var _=c=>{var h=ut(),f=I(x(h),2),p=x(f);g(f),g(h),C(()=>V(p,`村人: ${r().result.villagers??""}人 人狼: ${r().result.werewolves??""}人
            勝利陣営: ${r().result.winSide??""}`)),L(c,h)};S(A,c=>{r().result&&c(_)})}g(k),g(n),g(s),C(()=>V(d,`Day ${t()??""}`)),L(a,s),ye()}var _t=N('<link rel="stylesheet">'),ht=N('<div tabindex="0" class="file-input-container" role="button"><label class="file-input-label"><input type="file" accept=".log" multiple> <span>ファイルを選択もしくはドラッグアンドドロップしてください</span></label></div>'),pt=N('<div class="tab-wrapper"><button class="tab-button"> </button> <button class="close-button" aria-label="Close tab">✕</button></div>'),gt=N('<div class="tabs-container"><div class="tabs"></div></div> <div class="werewolf-log-viewer"><div class="days-container"></div></div>',1),mt=N('<main><pre class="title">aiwolf-nlp-server</pre> <!> <!></main>');function It(a,e){xe(e,!1);let t=le([]),r=le(0);function o(l){const i=l.target;Array.from(i.files||[]).forEach(w=>{const A=new FileReader;A.onload=_=>{var f;const h=(((f=_.target)==null?void 0:f.result)??"").split(`
`).filter(p=>p.trim());q(t,[...b(t),{name:w.name,data:h,processed:ue(h)}]),q(r,b(t).length-1)},A.readAsText(w)})}function s(l){var m;Array.from(((m=l.dataTransfer)==null?void 0:m.files)||[]).forEach(w=>{const A=new FileReader;A.onload=_=>{var f;const h=(((f=_.target)==null?void 0:f.result)??"").split(`
`).filter(p=>p.trim());q(t,[...b(t),{name:w.name,data:h,processed:ue(h)}]),q(r,b(t).length-1)},A.readAsText(w)})}function n(l){q(t,b(t).filter((i,m)=>m!==l)),b(r)>=b(t).length&&q(r,b(t).length-1)}fe();var u=mt();Ue(l=>{var i=_t();Ke.title="AIWolf Log Viewer",je(i,"href",`${We??""}/global.css`),L(l,i)}),z("dragover",ie,G(function(l){ce.call(this,e,l)})),z("drop",ie,G(s));var d=I(x(u),2);{var k=l=>{var i=ht(),m=x(i),w=x(m);Ge(2),g(m),g(i),z("change",w,o),z("dragover",i,G(function(A){ce.call(this,e,A)})),z("drop",i,G(s)),L(l,i)};S(d,l=>{b(t).length===0&&l(k)})}var v=I(d,2);{var y=l=>{var i=gt(),m=Je(i),w=x(m);X(w,5,()=>b(t),W,(c,h,f)=>{var p=pt(),T=x(p),D=x(T,!0);g(T);var R=I(T,2);g(p),C(()=>{ee(p,"active",b(r)===f),V(D,b(h).name)}),z("click",T,()=>q(r,f)),z("click",R,()=>n(f)),L(c,p)}),g(w),g(m);var A=I(m,2),_=x(A);X(_,5,()=>Object.entries(b(t)[b(r)].processed),W,(c,h)=>{let f=()=>b(h)[0],p=()=>b(h)[1];dt(c,{get day(){return f()},get dayLog(){return p()},get processedLogs(){return b(t)[b(r)].processed}})}),g(_),g(A),L(l,i)};S(v,l=>{b(t).length>0&&l(y)})}g(u),L(a,u),ye()}export{It as component};
