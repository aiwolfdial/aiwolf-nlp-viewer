import{t as M,a as I,d as Je}from"../chunks/CYHUnqUB.js";import{i as $e}from"../chunks/Dsc93adF.js";import{p as xe,d as ve,aq as Ce,i as G,a as we,aG as me,s as m,c,r as i,aI as ne,g,aA as Pe,$ as Re,aJ as De}from"../chunks/C6VFkXJ6.js";import{s as X}from"../chunks/CcTxLL8i.js";import{e as be,i as ge}from"../chunks/CDvNhuoa.js";import{d as Ae,h as Ne}from"../chunks/BLcQzrmO.js";import{b as Ie}from"../chunks/sAJ58j3v.js";import{s as ce,a as Be,b as Me}from"../chunks/COMcsTtA.js";import{i as re}from"../chunks/DbQD98kR.js";import{a as le,s as q,r as te,b as ke,c as fe}from"../chunks/D4mFRh8Z.js";import{t as Se,I as Te}from"../chunks/DjS1rb8r.js";import{p as pe}from"../chunks/BZhcqTp8.js";import{b as se}from"../chunks/CbL9dJBF.js";import{a as je,o as Ee}from"../chunks/KQcy5SQk.js";import{b as Le}from"../chunks/DeauuXp6.js";import{w as Y,d as ze}from"../chunks/DtOi-0f6.js";/* empty css                */function Ue(t,e,n,l){var p=t.__styles??(t.__styles={});p[e]!==n&&(p[e]=n,n==null?t.style.removeProperty(e):t.style.setProperty(e,n,""))}class _e{static fromJson(e){return We(JSON.parse(e),ae("RealtimeSettings"))}static toJson(e){return JSON.stringify(qe(e,ae("RealtimeSettings")),null,2)}}function F(t,e,n,l=""){const p=he(t),S=l?` on ${l}`:"",u=n?` for key "${n}"`:"";throw Error(`Invalid value${u}${S}. Expected ${p} but got ${JSON.stringify(e)}`)}function he(t){return Array.isArray(t)?t.length===2&&t[0]===void 0?`an optional ${he(t[1])}`:`one of [${t.map(e=>he(e)).join(", ")}]`:typeof t=="object"&&t.literal!==void 0?t.literal:typeof t}function Ke(t){if(t.jsonToJS===void 0){const e={};t.props.forEach(n=>e[n.json]={key:n.js,typ:n.typ}),t.jsonToJS=e}return t.jsonToJS}function Ve(t){if(t.jsToJSON===void 0){const e={};t.props.forEach(n=>e[n.js]={key:n.json,typ:n.typ}),t.jsToJSON=e}return t.jsToJSON}function ee(t,e,n,l="",p=""){function S(f,v){return typeof f==typeof v?v:F(f,v,l,p)}function u(f,v){const _=f.length;for(let w=0;w<_;w++){const y=f[w];try{return ee(v,y,n)}catch{}}return F(f,v,l,p)}function b(f,v){return f.indexOf(v)!==-1?v:F(f.map(_=>ue(_)),v,l,p)}function h(f,v){return Array.isArray(v)?v.map(_=>ee(_,f,n)):F(ue("array"),v,l,p)}function E(f){if(f===null)return null;const v=new Date(f);return isNaN(v.valueOf())?F(ue("Date"),f,l,p):v}function O(f,v,_){if(_===null||typeof _!="object"||Array.isArray(_))return F(ue(J||"object"),_,l,p);const w={};return Object.getOwnPropertyNames(f).forEach(y=>{const B=f[y],$=Object.prototype.hasOwnProperty.call(_,y)?_[y]:void 0;w[B.key]=ee($,B.typ,n,y,J)}),Object.getOwnPropertyNames(_).forEach(y=>{Object.prototype.hasOwnProperty.call(f,y)||(w[y]=ee(_[y],v,n,y,J))}),w}if(e==="any")return t;if(e===null)return t===null?t:F(e,t,l,p);if(e===!1)return F(e,t,l,p);let J;for(;typeof e=="object"&&e.ref!==void 0;)J=e.ref,e=He[e.ref];return Array.isArray(e)?b(e,t):typeof e=="object"?e.hasOwnProperty("unionMembers")?u(e.unionMembers,t):e.hasOwnProperty("arrayItems")?h(e.arrayItems,t):e.hasOwnProperty("props")?O(n(e),e.additional,t):F(e,t,l,p):e===Date&&typeof t!="number"?E(t):S(e,t)}function We(t,e){return ee(t,e,Ke)}function qe(t,e){return ee(t,e,Ve)}function ue(t){return{literal:t}}function de(t,e){return{props:t,additional:e}}function ae(t){return{ref:t}}const He={RealtimeSettings:de([{json:"connection",js:"connection",typ:ae("Connection")},{json:"display",js:"display",typ:ae("Display")}],!1),Connection:de([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:de([{json:"agent",js:"agent",typ:ae("Agent")}],!1),Agent:de([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},ye={connection:{url:"ws://localhost:8080/realtime",token:""},display:{agent:{name:!0,team:!0,role:!0}}};function Fe(){const t=localStorage.getItem("realtime-settings");if(t)try{return _e.fromJson(t)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",_e.toJson(ye)),ye}const oe=Y(Fe());oe.subscribe(t=>{localStorage.setItem("realtime-settings",_e.toJson(ye))});var Ge=M('<span class="badge mt-1"> </span>'),Xe=M('<span class="badge mt-1"> </span>'),Ye=M('<span class="badge mt-1"> </span>'),Qe=M('<div class="absolute origin-center text-center flex flex-col items-center transform-angle svelte-1fcam1a"><div class="avatar"><div class="w-24 rounded-full ring-offset-base-100 ring ring-offset-2 svelte-1fcam1a"><img></div></div> <!> <!> <!></div>'),Ze=M('<div class="h-full flex flex-col"><div role="alert" class="alert m-4"><p class="text-lg font-bold"> </p></div> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><canvas class="w-full h-full absolute top-0 left-0"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-xs shadow-sm overflow-auto p-4 z-20"><div class="card-body"><p class="text-lg text-pretty text-center"> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><p>イラスト : 石黒正数氏</p></aside></footer></div>');function et(t,e){xe(e,!0);let n=me(void 0);const l=oe.subscribe(s=>{ve(n,pe(s))});je(l);let p,S,u,b;Ee(()=>(window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)})),Ce(()=>{h()});function h(){if(!S||!u||!p)return;const s=S.getContext("2d"),o=u.getContext("2d");if(!s||!o)return;const x=p.getBoundingClientRect();[S,u].forEach(j=>{j.width=x.width,j.height=x.height;const A=j.getContext("2d");A&&(A.clearRect(0,0,j.width,j.height),A.globalAlpha=1,A.lineWidth=2)}),e.packet.agents.forEach(j=>{const{idx:A,targetIdxs:N=[],isAlive:K,isBubble:C}=j;if(!K)return;const z=document.getElementById(`agent-${A}`);if(!(z instanceof HTMLElement))return;const P=z.getBoundingClientRect(),k=u.getBoundingClientRect(),U=P.left+P.width/2-k.left,V=P.top+P.height/2-k.top;N.forEach(a=>{if(a===-1)return;const r=document.getElementById(`agent-${a}`);if(!(r instanceof HTMLElement))return;const d=r.getBoundingClientRect();E(o,U,V,d.left+d.width/2-k.left,d.top+d.height/2-k.top,!1,getComputedStyle(b).getPropertyValue("background-color"))}),C&&E(s,k.width/2,k.height/2,U,V,!0,getComputedStyle(b).getPropertyValue("background-color"))})}function E(s,o,x,j,A,N,K){const C=N?[0,0,0,0,0,15]:[0,5,-20,5,-20,15];s.strokeStyle=s.fillStyle=K,s.beginPath();let z=j-o,P=A-x,k=Math.sqrt(z*z+P*P),U=P/k,V=z/k,a=[];a.push(0,0);for(let r=0;r<C.length;r+=2){let d=C[r],T=C[r+1];a.push(d<0?k+d:d,T)}a.push(k,0);for(let r=C.length;r>0;r-=2){let d=C[r-2],T=C[r-1];a.push(d<0?k+d:d,-T)}a.push(0,0);for(let r=0;r<a.length;r+=2){let d=a[r]*V-a[r+1]*U+o,T=a[r]*U+a[r+1]*V+x;r===0?s.moveTo(d,T):s.lineTo(d,T)}s.fill()}var O=Ze(),J=c(O),f=c(J),v=c(f);i(f),i(J);var _=m(J,2),w=c(_),y=c(w);se(y,s=>S=s,()=>S);var B=m(y,2);se(B,s=>u=s,()=>u);var $=m(B,2),L=c($),H=c(L),R=c(H,!0);i(H),i(L),i($),se($,s=>b=s,()=>b);var D=m($,2);be(D,17,()=>e.packet.agents,ge,(s,o,x)=>{var j=Qe(),A=c(j),N=c(A),K=c(N);i(N),i(A);var C=m(A,2);{var z=a=>{var r=Ge(),d=c(r,!0);i(r),G(T=>X(d,T),[()=>Te(g(o).idx)]),I(a,r)};re(C,a=>{var r;(r=g(n))!=null&&r.display.agent.name&&a(z)})}var P=m(C,2);{var k=a=>{var r=Xe(),d=c(r,!0);i(r),G(()=>X(d,g(o).team)),I(a,r)};re(P,a=>{var r;(r=g(n))!=null&&r.display.agent.team&&a(k)})}var U=m(P,2);{var V=a=>{var r=Ye(),d=c(r,!0);i(r),G(()=>X(d,g(o).role)),I(a,r)};re(U,a=>{var r;(r=g(n))!=null&&r.display.agent.role&&a(V)})}i(j),G(a=>{le(j,"style",`--angle: ${x*(360/e.packet.agents.length)}`),le(j,"id",`agent-${g(o).idx??""}`),Se(N,"ring-success",g(o).isAlive),Se(N,"ring-error",!g(o).isAlive),Ue(N,"opacity",g(o).isAlive?1:.25),le(K,"src",`${Le??""}/images/male/${a??""}.png`),le(K,"alt",g(o).name)},[()=>g(o).idx.toString().padStart(2,"0")]),I(s,j)}),i(w),se(w,s=>p=s,()=>p),i(_),ne(2),i(O),G(()=>{X(v,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`),$.hidden=!e.packet.message,X(R,e.packet.message)}),I(t,O),we()}function tt(){const{subscribe:t,update:e}=Y({status:"disconnected",entries:{}});let n=null,l=null;oe.subscribe(u=>{l=u});function p(){if(!l)return;e(b=>({...b,status:"connecting"}));const u=new URL(l.connection.url);l.connection.token&&u.searchParams.set("token",l.connection.token),n=new WebSocket(u),n.onopen=()=>{e(b=>({...b,status:"connected"}))},n.onclose=()=>{e(b=>({...b,status:"disconnected"})),n=null},n.onerror=()=>{e(b=>({...b,status:"disconnected"})),n=null},n.onmessage=b=>{try{const h=JSON.parse(b.data);e(E=>{const O={...E.entries};return O[h.id]||(O[h.id]=[]),O[h.id].push(h),{...E,entries:O}})}catch(h){console.error("Failed to parse message:",h)}}}function S(){n&&(e(u=>({...u,status:"disconnected"})),n.close(),n=null)}return{subscribe:t,connect:p,disconnect:S,entries:{subscribe:u=>t(b=>u(b.entries))}}}const ie=tt();function nt(){ie.connect()}function st(){ie.disconnect()}var rt=M('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),at=M('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),ot=M('<div class="status status-error"></div>'),it=(t,e)=>e("connection.url",t.currentTarget.value),ct=(t,e)=>e("connection.token",t.currentTarget.value),lt=(t,e)=>e("display.agent.name",t.currentTarget.checked),ut=(t,e)=>e("display.agent.team",t.currentTarget.checked),dt=(t,e)=>e("display.agent.role",t.currentTarget.checked),ft=M('<div class="navbar bg-base-100 flex justify-start"><h1 class="text-3xl font-bold truncate mx-4">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input mx-2"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info mx-2">接続</button> <button class="btn btn-error mx-2">切断</button> <button class="btn mx-2">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold my-2">表示設定</h3> <h4 class="text-base font-bold my-2">エージェント</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2 mx-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function vt(t,e){xe(e,!0);let n=me(void 0),l=me(void 0);const p=oe.subscribe(a=>{ve(n,pe(a))}),S=ie.subscribe(a=>{ve(l,pe(a.status))});je(()=>{p(),S()});function u(a,r){oe.update(d=>{const T=a.split("."),Q=T.pop();let W=d;for(const Z of T)Z&&(W=W[Z]);return W[Q]=r,{...d}})}let b;var h=ft(),E=m(c(h),2),O=c(E),J=c(O);{var f=a=>{var r=rt();ne(2),I(a,r)},v=a=>{var r=Je(),d=Pe(r);{var T=W=>{var Z=at();ne(2),I(W,Z)},Q=W=>{var Z=ot();I(W,Z)};re(d,W=>{g(l)==="connecting"?W(T):W(Q,!1)},!0)}I(a,r)};re(J,a=>{g(l)==="connected"?a(f):a(v,!1)})}i(O),i(E);var _=m(E,2),w=c(_);q(w,"class","h-[1em] opacity-50"),q(w,"inline",!0),q(w,"icon","mdi:link");var y=m(w,2);te(y),y.__input=[it,u],i(_);var B=m(_,2),$=c(B);q($,"class","h-[1em] opacity-50"),q($,"inline",!0),q($,"icon","mdi:key");var L=m($,2);te(L),L.__input=[ct,u],ne(2),i(B);var H=m(B,2);H.__click=[nt];var R=m(H,2);R.__click=[st];var D=m(R,2);D.__click=()=>b.showModal();var s=m(D,2),o=c(s),x=c(o),j=m(c(x),4),A=c(j),N=m(c(A),2);te(N),N.__change=[lt,u],i(A);var K=m(A,2),C=m(c(K),2);te(C),C.__change=[ut,u],i(K);var z=m(K,2),P=m(c(z),2);te(P),P.__change=[dt,u],i(z),i(j),i(x),i(o),ne(2),i(s),se(s,a=>b=a,()=>b);var k=m(s,2),U=c(k);q(U,"inline",!0),q(U,"icon","mdi:white-balance-sunny");var V=m(U,4);q(V,"inline",!0),q(V,"icon","mdi:moon-and-stars"),i(k),i(h),G(()=>{var a,r,d,T,Q;ke(y,(a=g(n))==null?void 0:a.connection.url),ke(L,(r=g(n))==null?void 0:r.connection.token),H.disabled=g(l)!=="disconnected",R.disabled=g(l)==="disconnected",fe(N,(d=g(n))==null?void 0:d.display.agent.name),fe(C,(T=g(n))==null?void 0:T.display.agent.team),fe(P,(Q=g(n))==null?void 0:Q.display.agent.role)}),I(t,h),we()}Ae(["input","click","change"]);function Oe(t){return Array.from({length:t},(e,n)=>({idx:n+1,team:"Undefined",name:Te(n+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}var mt=M("<option> </option>"),bt=M('<button class="btn"> </button>'),gt=M('<main class="h-screen flex flex-col"><!> <div class="flex flex-1 overflow-hidden w-full flex-col md:flex-row"><div class="flex-auto bg-base-300"><!></div> <div class="w-full md:w-64 max-md:h-32 flex flex-col bg-base-200 px-2"><select class="select"></select> <ul class="list overflow-y-auto flex-1"></ul></div></div></main>');function Rt(t,e){xe(e,!1);const[n,l]=Be(),p=()=>ce(f,"$status",n),S=()=>ce(O,"$currentPacket",n),u=()=>ce(h,"$selectedId",n),b=()=>ce(J,"$entries",n),h=Y(""),E=Y(0),O=Y({id:"",idx:-1,day:0,isDay:!0,agents:Oe(5),message:"未接続",summary:"未接続",isDivider:!1}),J=Y({}),f=Y("");Ee(()=>{const R=ie.entries.subscribe(s=>{J.set(s),h.update(o=>o||Object.keys(s)[0]||"")}),D=ie.subscribe(s=>{f.set(s.status)});h.subscribe(s=>{J.update(o=>{var x;return s&&((x=o[s])==null?void 0:x.length)>0&&E.set(o[s].length-1),o})}),ze([h,E,J],([s,o,x])=>x[s]&&o>=0&&o<x[s].length?x[s][o]:{id:"",idx:-1,day:0,isDay:!0,agents:Oe(5),message:"未接続",summary:"未接続",isDivider:!1}).subscribe(s=>{O.set(s)}),je(()=>{R(),D()}),window.addEventListener("beforeunload",s=>{p()==="connecting"&&s.preventDefault()})}),$e();var v=gt();Ne(R=>{Re.title="aiwolf-nlp-viewer"});var _=c(v);vt(_,{});var w=m(_,2),y=c(w),B=c(y);et(B,{get packet(){return S()}}),i(y);var $=m(y,2),L=c($);G(()=>{u(),De(()=>{b()})}),be(L,5,()=>Object.keys(b()),ge,(R,D)=>{var s=mt(),o={},x=c(s,!0);i(s),G(()=>{o!==(o=g(D))&&(s.value=(s.__value=g(D))==null?"":g(D)),X(x,g(D))}),I(R,s)}),i(L);var H=m(L,2);be(H,5,()=>b()[u()]||[],ge,(R,D,s)=>{var o=bt();o.__click=()=>E.set(s);var x=c(o);i(o),G(()=>X(x,`${s+1}. ${g(D).summary??""}`)),I(R,o)}),i(H),i($),i(w),i(v),Ie(L,u,R=>Me(h,R)),I(t,v),we(),l()}Ae(["click"]);export{Rt as component};
