var Zt=Object.defineProperty;var Bt=(e,t,n)=>t in e?Zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var It=(e,t,n)=>Bt(e,typeof t!="symbol"?t+"":t,n);import{t as k,a as g,c as it}from"../chunks/CQIKem6B.js";import{e as Ft,u as zt,p as ft,c as s,s as o,r as a,aI as at,t as Y,a as _t,f as $,g as M,h as wt,aG as Et,y as Qt,$ as Xt}from"../chunks/DJzILnW5.js";import{h as $t}from"../chunks/74kPUpG4.js";import{i as U}from"../chunks/bGcRSTrU.js";import{p as At}from"../chunks/BaREKndI.js";import{s as nt,b as Lt,a as Wt}from"../chunks/CmdMf11p.js";import{p as te}from"../chunks/DgrBRmGB.js";import{w as z}from"../chunks/B7xs7M_3.js";import{a as Jt,o as ee}from"../chunks/CSRI-F4q.js";/* empty css                */import{d as Ut,s as S}from"../chunks/bj5TrsLi.js";import{e as lt,i as ct}from"../chunks/n8ULSs76.js";import{r as mt,s as K,a as gt,c as ht,d as ne}from"../chunks/GM4Wqstv.js";import{b as re}from"../chunks/D44jfrx6.js";import{b as Pt}from"../chunks/D1AgY69q.js";function ae(e,t,n){Ft(()=>{var u=zt(()=>t(e,n==null?void 0:n())||{});if(u!=null&&u.destroy)return()=>u.destroy()})}class St{static fromJson(t){return oe(JSON.parse(t),Ot("AgentSettings"))}static toJson(t){return JSON.stringify(le(t,Ot("AgentSettings")),null,2)}}function rt(e,t,n,u=""){const y=Tt(e),m=u?` on ${u}`:"",T=n?` for key "${n}"`:"";throw Error(`Invalid value${T}${m}. Expected ${y} but got ${JSON.stringify(t)}`)}function Tt(e){return Array.isArray(e)?e.length===2&&e[0]===void 0?`an optional ${Tt(e[1])}`:`one of [${e.map(t=>Tt(t)).join(", ")}]`:typeof e=="object"&&e.literal!==void 0?e.literal:typeof e}function se(e){if(e.jsonToJS===void 0){const t={};e.props.forEach(n=>t[n.json]={key:n.js,typ:n.typ}),e.jsonToJS=t}return e.jsonToJS}function ie(e){if(e.jsToJSON===void 0){const t={};e.props.forEach(n=>t[n.js]={key:n.json,typ:n.typ}),e.jsToJSON=t}return e.jsToJSON}function ut(e,t,n,u="",y=""){function m(r,v){return typeof r==typeof v?v:rt(r,v,u,y)}function T(r,v){const x=r.length;for(let f=0;f<x;f++){const p=r[f];try{return ut(v,p,n)}catch{}}return rt(r,v,u,y)}function F(r,v){return r.indexOf(v)!==-1?v:rt(r.map(x=>xt(x)),v,u,y)}function W(r,v){return Array.isArray(v)?v.map(x=>ut(x,r,n)):rt(xt("array"),v,u,y)}function w(r){if(r===null)return null;const v=new Date(r);return isNaN(v.valueOf())?rt(xt("Date"),r,u,y):v}function b(r,v,x){if(x===null||typeof x!="object"||Array.isArray(x))return rt(xt(N||"object"),x,u,y);const f={};return Object.getOwnPropertyNames(r).forEach(p=>{const E=r[p],j=Object.prototype.hasOwnProperty.call(x,p)?x[p]:void 0;f[E.key]=ut(j,E.typ,n,p,N)}),Object.getOwnPropertyNames(x).forEach(p=>{Object.prototype.hasOwnProperty.call(r,p)||(f[p]=ut(x[p],v,n,p,N))}),f}if(t==="any")return e;if(t===null)return e===null?e:rt(t,e,u,y);if(t===!1)return rt(t,e,u,y);let N;for(;typeof t=="object"&&t.ref!==void 0;)N=t.ref,t=ce[t.ref];return Array.isArray(t)?F(t,e):typeof t=="object"?t.hasOwnProperty("unionMembers")?T(t.unionMembers,e):t.hasOwnProperty("arrayItems")?W(t.arrayItems,e):t.hasOwnProperty("props")?b(n(t),t.additional,e):rt(t,e,u,y):t===Date&&typeof e!="number"?w(e):m(t,e)}function oe(e,t){return ut(e,t,se)}function le(e,t){return ut(e,t,ie)}function xt(e){return{literal:e}}function Mt(e,t){return{props:e,additional:t}}function Ot(e){return{ref:e}}const ce={AgentSettings:Mt([{json:"connection",js:"connection",typ:Ot("Connection")},{json:"team",js:"team",typ:""}],!1),Connection:Mt([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1)},jt={connection:{url:"ws://localhost:8080/ws",token:""},team:"aiwolf-nlp-viewer"};function ue(){const e=localStorage.getItem("agent-settings");if(e)try{return St.fromJson(e)}catch(t){console.error(t)}return localStorage.setItem("agent-settings",St.toJson(jt)),jt}const vt=z(ue());vt.subscribe(e=>{localStorage.setItem("agent-settings",St.toJson(e))});var G=(e=>(e.NAME="NAME",e.TALK="TALK",e.WHISPER="WHISPER",e.VOTE="VOTE",e.DIVINE="DIVINE",e.GUARD="GUARD",e.ATTACK="ATTACK",e.INITIALIZE="INITIALIZE",e.DAILY_INITIALIZE="DAILY_INITIALIZE",e.DAILY_FINISH="DAILY_FINISH",e.FINISH="FINISH",e))(G||{});const Dt={NAME:"名前",TALK:"トーク",WHISPER:"囁き",VOTE:"投票",DIVINE:"占い",GUARD:"護衛",ATTACK:"襲撃",INITIALIZE:"ゲーム開始",DAILY_INITIALIZE:"昼開始",DAILY_FINISH:"昼終了",FINISH:"ゲーム終了"};var Nt=(e=>(e.HUMAN="HUMAN",e.WEREWOLF="WEREWOLF",e))(Nt||{});const pt={HUMAN:"人間",WEREWOLF:"人狼"};var yt=(e=>(e.ALIVE="ALIVE",e.DEAD="DEAD",e))(yt||{});const Ht={ALIVE:"生存",DEAD:"死亡"};var qt=(e=>(e.WEREWOLF="WEREWOLF",e.POSSESSED="POSSESSED",e.SEER="SEER",e.BODYGUARD="BODYGUARD",e.VILLAGER="VILLAGER",e.MEDIUM="MEDIUM",e))(qt||{});const kt={WEREWOLF:"人狼",POSSESSED:"狂人",SEER:"占い師",BODYGUARD:"騎士",VILLAGER:"村人",MEDIUM:"霊媒師"};function de(){const{subscribe:e,update:t}=z({status:"disconnected",deadline:null,entries:[],role:null,request:null,info:null,mediumResults:[],divineResults:[],setting:null,talkHistory:[],whisperHistory:[],executedAgents:[],attackedAgents:[]});let n=null,u=null,y=null,m=null;vt.subscribe(w=>{u=w});function T(){n&&(n.close(),n=null,t(w=>({...w,status:"disconnected"}))),m&&(m.clear(),m=null)}function F(){if(!u)return;n&&t(b=>({...b,status:"disconnected",deadline:null,entries:[],role:null,request:null,info:null,mediumResults:[],divineResults:[],setting:null,talkHistory:[],whisperHistory:[],executedAgents:[],attackedAgents:[]})),t(b=>({...b,status:"connecting"}));const w=new URL(u.connection.url);u.connection.token&&w.searchParams.set("token",u.connection.token),n=new WebSocket(w),n.onopen=()=>{t(b=>({...b,status:"connected"}))},n.onclose=()=>{T()},n.onerror=()=>{T()},n.onmessage=b=>{try{const N=Date.now(),r=JSON.parse(b.data);switch(t(v=>{const x=v.entries.slice();x.push(r);const f={...v,entries:x,request:r.request};if(r.info){if(f.info=r.info,r.info.mediumResult){const p=r.info.mediumResult;f.mediumResults.findIndex(E=>E.day===p.day&&E.agent===p.agent)<0&&f.mediumResults.push(r.info.mediumResult)}if(r.info.divineResult){const p=r.info.divineResult;f.divineResults.findIndex(E=>E.day===p.day&&E.agent===p.agent)<0&&f.divineResults.push(r.info.divineResult)}r.info.executedAgent&&f.executedAgents.push(r.info.executedAgent),r.info.attackedAgent&&f.attackedAgents.push(r.info.attackedAgent)}return r.setting&&(f.setting=r.setting,y=r.setting.actionTimeout),r.talkHistory&&f.talkHistory.push(...r.talkHistory),r.whisperHistory&&f.whisperHistory.push(...r.whisperHistory),r.request===G.INITIALIZE&&f.info&&f.info.roleMap&&f.info.agent&&(f.role=f.info.roleMap[f.info.agent]),f}),r.request){case G.NAME:W((u==null?void 0:u.team)||"viewer"+Math.floor(Math.random()*1e3));break;case G.TALK:case G.WHISPER:case G.VOTE:case G.DIVINE:case G.GUARD:case G.ATTACK:m&&m.clear(),m=new ve(()=>{W("TIMEOUT")},new Date(N+(y??6e4))),t(v=>({...v,deadline:(m==null?void 0:m.deadline())??null}));break;case G.FINISH:T();break}}catch(N){console.error("Failed to parse message:",N)}}}function W(w){if(m&&(m.clear(),m=null,t(b=>({...b,deadline:null}))),n&&n.readyState===WebSocket.OPEN)try{n.send(w),t(b=>{const N=b.entries.slice();return N.push(w),{...b,entries:N}})}catch(b){console.error("Failed to send message:",b)}}return{subscribe:e,connect:F,disconnect:T,send:W}}const dt=de();class ve{constructor(t,n){It(this,"timeout");It(this,"_deadline");this.timeout=setTimeout(t,n.getTime()-new Date().getTime()),this._deadline=n}deadline(){return this._deadline}clear(){clearTimeout(this.timeout)}}function fe(e,t,n,u){e.key==="Enter"&&(e.preventDefault(),(e.ctrlKey||e.metaKey)&&t.onSendMessage(n()))}var _e=k('<span aria-live="polite"> </span>m',1),ge=(e,t,n)=>t(n()),me=k('<button class="btn"> </button>'),be=k('<span class="bg-primary text-primary-content text-lg font-bold"> </span> <!>',1),xe=(e,t)=>t("Skip"),pe=k('<button class="btn" aria-label="Skip"><iconify-icon></iconify-icon> SKIP</button>',2),he=(e,t)=>t("Over"),Ae=k('<span class="bg-primary text-primary-content text-lg font-bold"> </span> <!> <button class="btn" aria-label="Over"><iconify-icon></iconify-icon> OVER</button>',3),ye=k("<option></option>"),Ie=k("<option></option>"),ke=k("<!> <option></option>",1),we=(e,t,n,u)=>t.onSendMessage(n()),Ee=k('<form class="flex-none bg-base-200" data-sveltekit-keepfocus=""><div class="flex gap-2 items-center mx-4 mt-4"><span class="countdown font-mono text-2xl"><!> <span aria-live="polite"> </span>s</span> <!> <input type="text" class="input flex-1" list="suggests"> <datalist id="suggests"><!></datalist> <button class="btn" aria-label="Send"><iconify-icon></iconify-icon> 送信</button></div> <div class="mx-4 mb-2"><progress class="progress" max="100"></progress></div></form>',2);function Se(e,t){ft(t,!0);const[n,u]=Wt(),y=()=>nt(m,"$message",n),m=z("");function T(l){Lt(m,At(l)),F.focus()}let F;function W(l){l.focus()}var w=Ee(),b=s(w),N=s(b),r=s(N);{var v=l=>{var h=_e(),_=$(h),L=s(_,!0);a(_),at(),Y((i,c)=>{gt(_,"style",`--value:${i??""};`),gt(_,"aria-label",c),S(L,i)},[()=>Math.floor(t.remain/6e4),()=>Math.floor(t.remain/6e4).toString()]),g(l,h)};U(r,l=>{t.remain&&t.remain>6e4&&l(v)})}var x=o(r,2),f=s(x,!0);a(x),at(),a(N);var p=o(N,2);{var E=l=>{var h=be(),_=$(h),L=s(_);a(_);var i=o(_,2);lt(i,17,()=>{var c;return Object.entries(((c=t.info)==null?void 0:c.statusMap)??{})},ct,(c,d)=>{let D=()=>M(d)[0],I=()=>M(d)[1];var A=it(),O=$(A);{var Z=st=>{var V=me();V.__click=[ge,T,D];var et=s(V,!0);a(V),Y(()=>S(et,D())),g(st,V)};U(O,st=>{var V;I()===yt.ALIVE&&D()!==((V=t.info)==null?void 0:V.agent)&&st(Z)})}g(c,A)}),Y(()=>S(L,`${Dt[t.request]??""}対象を選択してください`)),g(l,h)},j=l=>{var h=Ae(),_=$(h),L=s(_);a(_);var i=o(_,2);{var c=I=>{var A=pe();A.__click=[xe,T];var O=s(A);K(O,"icon","mdi:arrow-u-down-right-bold"),at(),a(A),g(I,A)};U(i,I=>{var A;(((A=t.setting)==null?void 0:A.maxSkip)??0)>0&&I(c)})}var d=o(i,2);d.__click=[he,T];var D=s(d);K(D,"icon","mdi:skip-forward"),at(),a(d),Y(()=>S(L,`${Dt[t.request??G.INITIALIZE]??""}内容を入力してください`)),g(l,h)};U(p,l=>{t.request===G.VOTE||t.request===G.DIVINE||t.request===G.GUARD||t.request===G.ATTACK?l(E):l(j,!1)})}var Q=o(p,2);mt(Q),Q.__keydown=[fe,t,y,m],Ft(()=>re(Q,y,l=>Lt(m,l))),ae(Q,l=>W==null?void 0:W(l)),Pt(Q,l=>F=l,()=>F);var H=o(Q,2),J=s(H);{var P=l=>{var h=it(),_=$(h);lt(_,17,()=>{var L;return Object.entries(((L=t.info)==null?void 0:L.statusMap)??{})},ct,(L,i)=>{let c=()=>M(i)[0],d=()=>M(i)[1];var D=it(),I=$(D);{var A=O=>{var Z=ye(),st={};Y(()=>{st!==(st=c())&&(Z.value=(Z.__value=c())==null?"":c())}),g(O,Z)};U(I,O=>{var Z;d()===yt.ALIVE&&c()!==((Z=t.info)==null?void 0:Z.agent)&&O(A)})}g(L,D)}),g(l,h)},B=l=>{var h=ke(),_=$(h);{var L=c=>{var d=Ie();d.value=(d.__value="Skip")==null?"":"Skip",g(c,d)};U(_,c=>{var d;(((d=t.setting)==null?void 0:d.maxSkip)??0)>0&&c(L)})}var i=o(_,2);i.value=(i.__value="Over")==null?"":"Over",g(l,h)};U(J,l=>{t.request===G.VOTE||t.request===G.DIVINE||t.request===G.GUARD||t.request===G.ATTACK?l(P):l(B,!1)})}a(H);var q=o(H,2);q.__click=[we,t,y,m];var tt=s(q);K(tt,"icon","mdi:send"),at(),a(q),a(b);var X=o(b,2),C=s(X);a(X),a(w),Y((l,h)=>{var _;gt(x,"style",`--value:${l??""};`),gt(x,"aria-label",h),S(f,l),ht(C,t.remain!==null?t.remain/(((_=t.setting)==null?void 0:_.actionTimeout)??6e4)*100:0)},[()=>Math.floor((t.remain?t.remain%6e4:0)/1e3),()=>Math.floor((t.remain?t.remain%6e4:0)/1e3).toString()]),g(e,w),_t(),u()}Ut(["click","keydown"]);var Te=k('<pre class="text-lg text-center"> </pre>'),Oe=k('<div class="bg-info text-info-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),De=k('<div class="bg-error text-error-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),Ne=k('<div class="bg-error text-error-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),Re=k('<div class="bg-success text-success-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),Le=k('<h2 class="text-lg font-bold pt-2">霊能結果</h2> <!>',1),Me=k('<div class="bg-error text-error-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),je=k('<div class="bg-success text-success-content flex flex-row gap-2"><pre class="text-lg"> </pre> <pre class="text-lg"> </pre> <pre class="text-lg ml-auto"> </pre></div>'),He=k('<h2 class="font-bold text-lg pt-2">占い結果</h2> <!>',1),Ve=k('<div class="flex-[0_0_400px] rounded-lg bg-base-200"><div class="flex flex-col h-full p-4"><h2 class="text-xl font-bold pb-2">エージェント</h2> <div class="grow overflow-y-auto pr-4"><div class="flex justify-around"><div><h2 class="text-lg font-bold text-center">役職</h2> <pre class="text-lg text-center"> </pre></div> <div><h2 class="text-lg font-bold text-center">日数</h2> <pre class="text-lg text-center"> </pre></div> <div><h2 class="text-lg font-bold text-center">リクエスト</h2> <!></div></div> <h2 class="text-lg font-bold pt-2">ステータス</h2> <!> <!> <!></div></div></div>');function Fe(e,t){ft(t,!0);var n=Ve(),u=s(n),y=o(s(u),2),m=s(y),T=s(m),F=o(s(T),2),W=s(F,!0);a(F),a(T);var w=o(T,2),b=o(s(w),2),N=s(b,!0);a(b),a(w);var r=o(w,2),v=o(s(r),2);{var x=H=>{var J=Te(),P=s(J,!0);a(J),Y(()=>S(P,Dt[t.request])),g(H,J)};U(v,H=>{t.request!==null&&H(x)})}a(r),a(m);var f=o(m,4);lt(f,17,()=>Object.entries(t.info.statusMap??{}),ct,(H,J)=>{let P=()=>M(J)[0],B=()=>M(J)[1];var q=it(),tt=$(q);{var X=l=>{var h=Oe(),_=s(h),L=s(_,!0);a(_);var i=o(_,2),c=s(i,!0);a(i);var d=o(i,2),D=s(d,!0);a(d),a(h),Y(()=>{S(L,P()),S(c,kt[(t.info.roleMap??{})[P()]]??""),S(D,Ht[B()])}),g(l,h)},C=l=>{var h=De(),_=s(h),L=s(_,!0);a(_);var i=o(_,2),c=s(i,!0);a(i);var d=o(i,2),D=s(d);a(d),a(h),Y(I=>{S(L,P()),S(c,kt[(t.info.roleMap??{})[P()]]??""),S(D,`${Ht[B()]??""}${I??""}`)},[()=>t.executedAgents.includes(P())?" (追放)":t.attackedAgents.includes(P())?" (襲撃)":""]),g(l,h)};U(tt,l=>{B()===yt.ALIVE?l(X):l(C,!1)})}g(H,q)});var p=o(f,2);{var E=H=>{var J=Le(),P=o($(J),2);lt(P,17,()=>t.mediumResults,ct,(B,q)=>{let tt=()=>M(q).day,X=()=>M(q).target,C=()=>M(q).result;var l=it(),h=$(l);{var _=i=>{var c=Ne(),d=s(c),D=s(d,!0);a(d);var I=o(d,2),A=s(I);a(I);var O=o(I,2),Z=s(O,!0);a(O),a(c),Y(()=>{S(D,X()),S(A,`(${tt()??""}日目)`),S(Z,pt[C()])}),g(i,c)},L=i=>{var c=Re(),d=s(c),D=s(d,!0);a(d);var I=o(d,2),A=s(I);a(I);var O=o(I,2),Z=s(O,!0);a(O),a(c),Y(()=>{S(D,X()),S(A,`(${tt()??""}日目)`),S(Z,pt[C()])}),g(i,c)};U(h,i=>{C()!==Nt.HUMAN?i(_):i(L,!1)})}g(B,l)}),g(H,J)};U(p,H=>{t.mediumResults.length>0&&H(E)})}var j=o(p,2);{var Q=H=>{var J=He(),P=o($(J),2);lt(P,17,()=>t.divineResults,ct,(B,q)=>{let tt=()=>M(q).day,X=()=>M(q).target,C=()=>M(q).result;var l=it(),h=$(l);{var _=i=>{var c=Me(),d=s(c),D=s(d,!0);a(d);var I=o(d,2),A=s(I);a(I);var O=o(I,2),Z=s(O,!0);a(O),a(c),Y(()=>{S(D,X()),S(A,`(${tt()??""}日目)`),S(Z,pt[C()])}),g(i,c)},L=i=>{var c=je(),d=s(c),D=s(d,!0);a(d);var I=o(d,2),A=s(I);a(I);var O=o(I,2),Z=s(O,!0);a(O),a(c),Y(()=>{S(D,X()),S(A,`(${tt()??""}日目)`),S(Z,pt[C()])}),g(i,c)};U(h,i=>{C()!==Nt.HUMAN?i(_):i(L,!1)})}g(B,l)}),g(H,J)};U(j,H=>{t.divineResults.length>0&&H(Q)})}a(y),a(u),a(n),Y(()=>{S(W,t.role!==null?kt[t.role]:"ゲーム外"),S(N,t.info!==null?t.info.day+"日目":"ゲーム外")}),g(e,n),_t()}function We(){dt.connect()}function Je(){dt.disconnect()}var Ue=k('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Pe=k('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),qe=k('<div class="status status-error"></div>'),Ke=(e,t)=>t("connection.url",e.currentTarget.value),Ce=(e,t)=>t("connection.token",e.currentTarget.value),Ge=(e,t)=>t("team",e.currentTarget.value),Ye=k('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">エージェント設定</h3> <h4 class="text-base font-bold mt-4">チーム名</h4> <label class="input min-w-3xs w-3xs my-2"><iconify-icon></iconify-icon> <input type="text" class="grow"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Ze(e,t){ft(t,!0);let n=Et(void 0),u=Et(void 0);const y=vt.subscribe(i=>{wt(n,At(i))}),m=dt.subscribe(i=>{wt(u,At(i.status))});Jt(()=>{y(),m()});function T(i,c){vt.update(d=>{const D=i.split("."),I=D.pop();let A=d;for(const O of D)O&&(A=A[O]);return A[I]=c,{...d}})}let F;var W=Ye(),w=o(s(W),2),b=s(w),N=s(b);{var r=i=>{var c=Ue();at(2),g(i,c)},v=i=>{var c=it(),d=$(c);{var D=A=>{var O=Pe();at(2),g(A,O)},I=A=>{var O=qe();g(A,O)};U(d,A=>{M(u)==="connecting"?A(D):A(I,!1)},!0)}g(i,c)};U(N,i=>{M(u)==="connected"?i(r):i(v,!1)})}a(b),a(w);var x=o(w,2),f=s(x);K(f,"class","h-[1em] opacity-50"),K(f,"inline",!0),K(f,"icon","mdi:link");var p=o(f,2);mt(p),p.__input=[Ke,T],a(x);var E=o(x,2),j=s(E);K(j,"class","h-[1em] opacity-50"),K(j,"inline",!0),K(j,"icon","mdi:key");var Q=o(j,2);mt(Q),Q.__input=[Ce,T],at(2),a(E);var H=o(E,2);H.__click=[We];var J=o(H,2);J.__click=[Je];var P=o(J,2);P.__click=()=>F.showModal();var B=o(P,2),q=s(B),tt=s(q),X=o(s(tt),4),C=s(X);K(C,"class","h-[1em] opacity-50"),K(C,"inline",!0),K(C,"icon","mdi:rename");var l=o(C,2);mt(l),l.__input=[Ge,T],a(X),a(tt),a(q),at(2),a(B),Pt(B,i=>F=i,()=>F);var h=o(B,2),_=s(h);K(_,"inline",!0),K(_,"icon","mdi:white-balance-sunny");var L=o(_,4);K(L,"inline",!0),K(L,"icon","mdi:moon-and-stars"),a(h),a(W),Y(()=>{var i,c,d;ht(p,(i=M(n))==null?void 0:i.connection.url),ht(Q,(c=M(n))==null?void 0:c.connection.token),H.disabled=M(u)!=="disconnected",J.disabled=M(u)==="disconnected",ht(l,(d=M(n))==null?void 0:d.team)}),g(e,W),_t()}Ut(["input","click"]);var Be=k("<iconify-icon></iconify-icon>",2),ze=k("<iconify-icon></iconify-icon>",2),Qe=k('<div class="chat-bubble bg-base-100 text-pretty break-all"> </div>'),Xe=k('<div class="chat chat-start"><div class="chat-image avatar avatar-placeholder"><div class="bg-neutral text-neutral-content w-12 rounded-full"><span class="text-2xl"> </span></div></div> <div class="chat-header"></div> <!> <pre class="chat-footer opacity-50"> </pre></div>');function $e(e,t){ft(t,!0);var n=Xe(),u=s(n),y=s(u),m=s(y),T=s(m,!0);a(m),a(y),a(u);var F=o(u,4);{var W=r=>{var v=Be();K(v,"inline",!0),K(v,"icon","mdi:skip-forward"),g(r,v)},w=r=>{var v=it(),x=$(v);{var f=E=>{var j=ze();K(j,"inline",!0),K(j,"icon","mdi:arrow-u-down-right-bold"),g(E,j)},p=E=>{var j=Qe(),Q=s(j,!0);a(j),Y(()=>S(Q,t.talk.text)),g(E,j)};U(x,E=>{t.talk.skip?E(f):E(p,!1)},!0)}g(r,v)};U(F,r=>{t.talk.over?r(W):r(w,!1)})}var b=o(F,2),N=s(b,!0);a(b),a(n),Y(r=>{S(T,r),S(N,t.talk.idx)},[()=>{var r;return Number((r=t.talk.agent.match(/Agent\[(\d+)\]/))==null?void 0:r[1])??""}]),g(e,n),_t()}var tn=k('<input type="radio" name="talk_days" class="tab"> <div class="tab-content my-4"></div>',1),en=k('<div class="tabs tabs-border"></div>'),nn=k('<div class="flex-[0_0_600px] rounded-lg bg-base-200"><div class="flex flex-col h-full p-4"><h2 class="text-xl font-bold pb-2"> </h2> <div class="grow overflow-y-auto pr-4"><!></div></div></div>');function Vt(e,t){ft(t,!0);var n=nn(),u=s(n),y=s(u),m=s(y,!0);a(y);var T=o(y,2),F=s(T);{var W=w=>{var b=en();const N=Qt(()=>[...new Set(t.talks.map(r=>r.day))].sort((r,v)=>v-r));lt(b,21,()=>M(N),ct,(r,v)=>{var x=tn(),f=$(x);mt(f);var p=o(f,2);lt(p,21,()=>t.talks.filter(E=>E.day===M(v)),ct,(E,j)=>{$e(E,{get talk(){return M(j)}})}),a(p),Y(()=>{ne(f,M(v)===M(N)[0]),gt(f,"aria-label",`${M(v)}日目`)}),g(r,x)}),a(b),g(w,b)};U(F,w=>{t.talks.length>0&&w(W)})}a(T),a(u),a(n),Y(()=>S(m,t.header)),g(e,n),_t()}var rn=k('<div class="overflow-y-hidden flex grow overflox-x-auto gap-4 p-4"><!> <!> <!></div> <!>',1),an=k('<pre class="base-content w-2/5 text-5xl font-bold opacity-70 mt-4 ml-8 select-none">未接続</pre>'),sn=k('<main class="h-screen flex flex-col bg-base-300"><!> <!></main>');function In(e,t){ft(t,!0);const[n,u]=Wt(),y=()=>nt(j,"$deadline",n),m=()=>nt(E,"$status",n),T=()=>nt(P,"$info",n),F=()=>nt(H,"$role",n),W=()=>nt(J,"$request",n),w=()=>nt(B,"$mediumResults",n),b=()=>nt(q,"$divineResults",n),N=()=>nt(l,"$executedAgents",n),r=()=>nt(h,"$attackedAgents",n),v=()=>nt(X,"$talkHistory",n),x=()=>nt(C,"$whisperHistory",n),f=()=>nt(_,"$remain",n),p=()=>nt(tt,"$setting",n),E=z(""),j=z(null),Q=z([]),H=z(null),J=z(null),P=z(null),B=z([]),q=z([]),tt=z(null),X=z([]),C=z([]),l=z([]),h=z([]),_=z(null);let L=Et(void 0),i;function c(){{const V=te.url.searchParams,et=V.get("url"),R=V.get("token");et&&(vt.update(bt=>({...bt,connection:{url:et??"",token:R??""}})),dt.connect())}}function d(){if(y()!==null){const V=Date.now(),et=Math.max(0,y()-V);_.set(et),et>0?i=requestAnimationFrame(d):_.set(0)}return()=>{i&&cancelAnimationFrame(i)}}ee(()=>{c();const V=dt.subscribe(R=>{E.set(R.status),R.deadline?(j.set(R.deadline.getTime()),i&&cancelAnimationFrame(i),i=requestAnimationFrame(d)):(j.set(null),_.set(null)),Q.set(R.entries),H.set(R.role),J.set(R.request),P.set(R.info),B.set(R.mediumResults),q.set(R.divineResults),tt.set(R.setting),X.set(R.talkHistory),C.set(R.whisperHistory),l.set(R.executedAgents),h.set(R.attackedAgents)}),et=vt.subscribe(R=>{wt(L,At(R))});Jt(()=>{V(),et(),i&&cancelAnimationFrame(i)}),window.addEventListener("beforeunload",R=>{m()==="connected"&&R.preventDefault()}),window.addEventListener("popstate",R=>{m()==="connected"&&R.preventDefault()})});function D(V){dt.send(V)}var I=sn();$t(V=>{Xt.title="aiwolf-nlp-viewer"});var A=s(I);Ze(A,{});var O=o(A,2);{var Z=V=>{var et=rn(),R=$(et),bt=s(R);Fe(bt,{get role(){return F()},get request(){return W()},get info(){return T()},get mediumResults(){return w()},get divineResults(){return b()},get executedAgents(){return N()},get attackedAgents(){return r()}});var Rt=o(bt,2);Vt(Rt,{header:"トーク履歴",get talks(){return v()}});var Kt=o(Rt,2);{var Ct=ot=>{Vt(ot,{header:"囁き履歴",get talks(){return x()}})};U(Kt,ot=>{F()===qt.WEREWOLF&&ot(Ct)})}a(R);var Gt=o(R,2);{var Yt=ot=>{Se(ot,{get remain(){return f()},get setting(){return p()},get request(){return W()},get info(){return T()},onSendMessage:D})};U(Gt,ot=>{f()!==null&&ot(Yt)})}g(V,et)},st=V=>{var et=an();g(V,et)};U(O,V=>{T()!==null?V(Z):V(st,!1)})}a(I),g(e,I),_t(),u()}export{In as component};
