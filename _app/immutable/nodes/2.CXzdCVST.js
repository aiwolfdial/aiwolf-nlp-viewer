import{b as vt,e as Tt,a as D,t as N}from"../chunks/disclose-version.Ct-FvCKp.js";import{i as ht}from"../chunks/legacy.BokLizl8.js";import{v as G,L as j,a8 as xt,a7 as Rt,I as it,m as It,H as bt,ao as mt,J as St,K as ct,M as rt,w as P,ak as Dt,at as tt,N as kt,n as lt,O as Nt,D as ut,au as Mt,av as Ot,an as Vt,aw as Ct,q as yt,ac as Ht,a6 as Ft,z as dt,ax as Ut,ay as Wt,az as Bt,ah as Et,al as Gt,aj as Yt,G as zt,aA as Kt,p as At,c as u,r as l,s as b,t as V,a as wt,h as p,aB as Z,aC as $t,f as qt,aD as st,B as z}from"../chunks/runtime.DyTRy9Ed.js";import{a as C,d as Jt,e as J}from"../chunks/store.C-9DoPpG.js";import{p as nt,i as W,b as Pt}from"../chunks/props.C2WdFMCW.js";import{b as Xt}from"../chunks/paths.Cq3_8iQs.js";function X(a,t){return t}function Qt(a,t,e,r){for(var o=[],s=t.length,n=0;n<s;n++)Ot(t[n].e,o,!0);var d=s>0&&o.length===0&&e!==null;if(d){var f=e.parentNode;Vt(f),f.append(e),r.clear(),K(a,t[0].prev,t[s-1].next)}Ct(o,()=>{for(var A=0;A<s;A++){var c=t[A];d||(r.delete(c.k),K(a,c.prev,c.next)),yt(c.e,!d)}})}function Q(a,t,e,r,o,s=null){var n=a,d={flags:t,items:new Map,first:null};{var f=a;n=G?j(xt(f)):f.appendChild(Rt())}G&&it();var A=null,c=!1;It(()=>{var E=e(),x=bt(E)?E:E==null?[]:mt(E),i=x.length;if(c&&i===0)return;c=i===0;let h=!1;if(G){var L=n.data===St;L!==(i===0)&&(n=ct(),j(n),rt(!1),h=!0)}if(G){for(var m=null,v,I=0;I<i;I++){if(P.nodeType===8&&P.data===Dt){n=P,h=!0,rt(!1);break}var U=x[I],T=r(U,I);v=Lt(P,d,m,null,U,T,I,o,t),d.items.set(T,v),m=v}i>0&&j(ct())}if(!G){var k=Ht;Zt(x,d,n,o,t,(k.f&tt)!==0,r)}s!==null&&(i===0?A?kt(A):A=lt(()=>s(n)):A!==null&&Nt(A,()=>{A=null})),h&&rt(!0),e()}),G&&(n=P)}function Zt(a,t,e,r,o,s,n){var d=a.length,f=t.items,A=t.first,c=A,E,x=null,i=[],h=[],L,m,v,I;for(I=0;I<d;I+=1){if(L=a[I],m=n(L,I),v=f.get(m),v===void 0){var U=c?c.e.nodes_start:e;x=Lt(U,t,x,x===null?t.first:x.next,L,m,I,r,o),f.set(m,x),i=[],h=[],c=x.next;continue}if(jt(v,L,I),v.e.f&tt&&kt(v.e),v!==c){if(E!==void 0&&E.has(v)){if(i.length<h.length){var T=h[0],k;x=T.prev;var F=i[0],$=i[i.length-1];for(k=0;k<i.length;k+=1)ft(i[k],T,e);for(k=0;k<h.length;k+=1)E.delete(h[k]);K(t,F.prev,$.next),K(t,x,F),K(t,$,T),c=T,x=$,I-=1,i=[],h=[]}else E.delete(v),ft(v,c,e),K(t,v.prev,v.next),K(t,v,x===null?t.first:x.next),K(t,x,v),x=v;continue}for(i=[],h=[];c!==null&&c.k!==m;)(s||!(c.e.f&tt))&&(E??(E=new Set)).add(c),h.push(c),c=c.next;if(c===null)continue;v=c}i.push(v),x=v,c=v.next}if(c!==null||E!==void 0){for(var q=E===void 0?[]:mt(E);c!==null;)(s||!(c.e.f&tt))&&q.push(c),c=c.next;var et=q.length;if(et>0){var _=d===0?e:null;Qt(t,q,_,f)}}ut.first=t.first&&t.first.e,ut.last=x&&x.e}function jt(a,t,e,r){Mt(a.v,t),a.i=e}function Lt(a,t,e,r,o,s,n,d,f){var A=(f&Wt)!==0,c=(f&Bt)===0,E=A?c?Ft(o):dt(o):o,x=f&Ut?dt(n):n,i={i:x,v:E,k:s,a:null,e:null,prev:e,next:r};try{return i.e=lt(()=>d(a,E,x),G),i.e.prev=e&&e.e,i.e.next=r&&r.e,e===null?t.first=i:(e.next=i,e.e.next=i.e),r!==null&&(r.prev=i,r.e.prev=i.e),i}finally{}}function ft(a,t,e){for(var r=a.next?a.next.e.nodes_start:e,o=t?t.e.nodes_start:e,s=a.e.nodes_start;s!==r;){var n=Et(s);o.before(s),s=n}}function K(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function te(a,t,e,r,o){var s=a,n="",d;It(()=>{if(n===(n=t()??"")){G&&it();return}d!==void 0&&(yt(d),d=void 0),n!==""&&(d=lt(()=>{if(G){P.data;for(var f=it(),A=f;f!==null&&(f.nodeType!==8||f.data!=="");)A=f,f=Et(f);if(f===null)throw Gt(),Yt;vt(P,A),s=j(f);return}var c=n+"",E=Tt(c);vt(xt(E),E.lastChild),s.before(E)}))})}function ee(a,t,e,r){var o=a.__attributes??(a.__attributes={});G&&(o[t]=a.getAttribute(t),a.nodeName==="LINK")||o[t]!==(o[t]=e)&&(e==null?a.removeAttribute(t):typeof e!="string"&&ae(a).includes(t)?a[t]=e:a.setAttribute(t,e))}var _t=new Map;function ae(a){var t=_t.get(a.nodeName);if(t)return t;_t.set(a.nodeName,t=[]);for(var e,r=a,o=Element.prototype;o!==r;){e=Kt(r);for(var s in e)e[s].set&&t.push(s);r=zt(r)}return t}function ot(a,t,e){if(e){if(a.classList.contains(t))return;a.classList.add(t)}else{if(!a.classList.contains(t))return;a.classList.remove(t)}}function gt(a){return function(...t){var e=t[0];return e.preventDefault(),a==null?void 0:a.apply(this,t)}}function re(a,t){var s;var e=(s=a.$$events)==null?void 0:s[t.type],r=bt(e)?e.slice():e==null?[]:[e];for(var o of r)o.call(this,t)}const se={VILLAGER:"村人",SEER:"占い師",MEDIUM:"霊能者",BODYGUARD:"騎士",WEREWOLF:"人狼",POSSESSED:"狂人"},ne={ALIVE:"生存",DEAD:"死亡"},ie={HUMAN:"人間",WEREWOLF:"人狼"},oe={VILLAGER:"村人陣営",WEREWOLF:"人狼陣営"};function pt(a){const t={};return a.forEach(e=>{const[r,o,...s]=e.split(",");t[r]||(t[r]=le()),ve(t[r],o,s)}),t}function le(){return{agents:{},talks:[],votes:[],execution:null,divine:null,attackVotes:[],attack:null,result:null}}function ve(a,t,e){const o={status:([s,n,d,f])=>{a.agents[s]={role:n,status:d,name:f}},talk:([s,n,d,f])=>{a.talks.push({talkIdx:s,turnIdx:n,agentIdx:d,text:f})},vote:([s,n])=>{a.votes.push({agentIdx:s,targetIdx:n})},execute:([s,n])=>{a.execution={agentIdx:s,role:n}},divine:([s,n,d])=>{a.divine={agentIdx:s,targetIdx:n,result:d}},attackVote:([s,n])=>{a.attackVotes.push({agentIdx:s,targetIdx:n})},attack:([s,n])=>{a.attack={targetIdx:s,isSuccessful:n==="true"}},result:([s,n,d])=>{a.result={villagers:s,werewolves:n,winSide:d}}}[t];o&&o(e)}function B(a,t,e){var o;const r=(o=a[t])==null?void 0:o.agents[e];return`Agent[${e}]`}function ce(a){const t=a.match(/>>Agent\[\d+\]/);return t?a.replace(t[0],`<strong>${t[0]}</strong>`).trim():a.trim()}var ue=N("<li><strong> </strong> </li>"),de=N('<section class="agent-section"><h3>エージェント</h3> <ul></ul></section>'),fe=N('<div class="talk"><strong> </strong> <!></div>'),_e=N('<section class="talks-section"><h3>会話</h3> <div class="talks"></div></section>'),ge=N("<li><strong> </strong> が <strong> </strong> に投票</li>"),pe=N('<section class="votes-section"><h3>投票</h3> <ul></ul></section>'),he=N('<section class="execution-section"><h3>追放</h3> <p><strong> </strong> を追放</p></section>'),xe=N("<li><strong> </strong> が <strong> </strong> に投票</li>"),Ie=N('<section class="attack-votes-section"><h3>襲撃投票</h3> <ul></ul></section>'),be=N("<p><strong> </strong> を襲撃: <strong> </strong></p>"),me=N("<p>襲撃対象なし</p>"),ke=N('<section class="attack-section"><h3>襲撃</h3> <!></section>'),ye=N('<section class="divine-section"><h3>占い</h3> <p><strong> </strong> が <strong> </strong> を占い: <strong> </strong></p></section>'),Ee=N('<section class="result-section"><h3>結果</h3> <p><strong> </strong> が勝利</p></section>'),Ae=N('<div class="day-column"><div class="day-section"><h2> </h2> <div class="scrollable-content"><!> <!> <!> <!> <!> <!> <!> <!></div></div></div>');function we(a,t){At(t,!1);let e=nt(t,"dayIdx",8),r=nt(t,"dayStatus",8),o=nt(t,"dayStatuses",8);ht();var s=Ae(),n=u(s),d=u(n),f=u(d);l(d);var A=b(d,2),c=u(A);{var E=_=>{var g=de(),R=b(u(g),2);Q(R,5,()=>Object.entries(r().agents),X,(M,S)=>{let y=()=>p(S)[0],w=()=>p(S)[1];var O=ue(),H=u(O),Y=u(H,!0);V(()=>C(Y,B(o(),e(),y()))),l(H);var at=b(H);l(O),V(()=>{ot(O,"over",w().status!=="ALIVE"),C(at,` ${se[w().role]??"NULL"??""} -
                ${ne[w().status]??"NULL"??""}`)}),D(M,O)}),l(R),l(g),D(_,g)};W(c,_=>{Object.keys(r().agents).length>0&&_(E)})}var x=b(c,2);{var i=_=>{var g=_e(),R=b(u(g),2);Q(R,5,()=>r().talks,X,(M,S)=>{var y=fe(),w=u(y),O=u(w,!0);V(()=>C(O,B(o(),e(),p(S).agentIdx))),l(w);var H=b(w,2);te(H,()=>ce(p(S).text)),l(y),V(()=>ot(y,"over",p(S).text==="Over")),D(M,y)}),l(R),l(g),D(_,g)};W(x,_=>{r().talks.length>0&&_(i)})}var h=b(x,2);{var L=_=>{var g=pe(),R=b(u(g),2);Q(R,5,()=>r().votes,X,(M,S)=>{var y=ge(),w=u(y),O=u(w,!0);V(()=>C(O,B(o(),e(),p(S).agentIdx))),l(w);var H=b(w,2),Y=u(H,!0);V(()=>C(Y,B(o(),e(),p(S).targetIdx))),l(H),Z(),l(y),D(M,y)}),l(R),l(g),D(_,g)};W(h,_=>{r().votes.length>0&&_(L)})}var m=b(h,2);{var v=_=>{var g=he(),R=b(u(g),2),M=u(R),S=u(M,!0);V(()=>C(S,B(o(),e(),r().execution.agentIdx))),l(M),Z(),l(R),l(g),D(_,g)};W(m,_=>{r().execution&&_(v)})}var I=b(m,2);{var U=_=>{var g=Ie(),R=b(u(g),2);Q(R,5,()=>r().attackVotes,X,(M,S)=>{var y=xe(),w=u(y),O=u(w,!0);V(()=>C(O,B(o(),e(),p(S).agentIdx))),l(w);var H=b(w,2),Y=u(H,!0);V(()=>C(Y,B(o(),e(),p(S).targetIdx))),l(H),Z(),l(y),D(M,y)}),l(R),l(g),D(_,g)};W(I,_=>{r().attackVotes.length>0&&_(U)})}var T=b(I,2);{var k=_=>{var g=ke(),R=b(u(g),2);{var M=y=>{var w=be(),O=u(w),H=u(O,!0);V(()=>C(H,B(o(),e(),r().attack.targetIdx))),l(O);var Y=b(O,2),at=u(Y,!0);l(Y),l(w),V(()=>C(at,r().attack.isSuccessful?"成功":"失敗")),D(y,w)},S=y=>{var w=me();D(y,w)};W(R,y=>{r().attack.targetIdx!=="-1"?y(M):y(S,!1)})}l(g),D(_,g)};W(T,_=>{r().attack&&_(k)})}var F=b(T,2);{var $=_=>{var g=ye(),R=b(u(g),2),M=u(R),S=u(M,!0);V(()=>C(S,B(o(),e(),r().divine.agentIdx))),l(M);var y=b(M,2),w=u(y,!0);V(()=>C(w,B(o(),e(),r().divine.targetIdx))),l(y);var O=b(y,2),H=u(O,!0);l(O),l(R),l(g),V(()=>C(H,ie[r().divine.result]??"NULL")),D(_,g)};W(F,_=>{r().divine&&_($)})}var q=b(F,2);{var et=_=>{var g=Ee(),R=b(u(g),2),M=u(R),S=u(M,!0);l(M),Z(),l(R),l(g),V(()=>C(S,oe[r().result.winSide])),D(_,g)};W(q,_=>{r().result&&_(et)})}l(A),l(n),l(s),V(()=>C(f,`Day ${e()??""}`)),D(a,s),wt()}var Le=N('<link rel="stylesheet">'),Te=N('<input id="fileInput" type="file" accept=".log" multiple hidden> <div tabindex="0" class="file-input-container" role="button"><div class="file-input-label"><span>ファイルを選択もしくはドラッグアンドドロップしてください</span></div></div>',1),Re=N('<div class="tab-wrapper"><button class="tab-button"> </button> <button class="close-button" aria-label="Close tab">✕</button></div>'),Se=N('<div class="log-container"><div class="tabs-container"><div class="tabs"></div></div> <div class="days-container"></div></div>'),De=N('<main><pre class="title">aiwolf-nlp-viewer</pre> <!> <!></main>');function Fe(a,t){At(t,!1);let e=st([]),r=st(0);function o(i){const h=i.target;Array.from(h.files||[]).forEach(m=>{const v=new FileReader;v.onload=I=>{var k;const T=(((k=I.target)==null?void 0:k.result)??"").split(`
`).filter(F=>F.trim());z(e,[...p(e),{name:m.name,data:T,processed:pt(T)}]),z(r,p(e).length-1)},v.readAsText(m)})}function s(i){var L;Array.from(((L=i.dataTransfer)==null?void 0:L.files)||[]).forEach(m=>{const v=new FileReader;v.onload=I=>{var k;const T=(((k=I.target)==null?void 0:k.result)??"").split(`
`).filter(F=>F.trim());z(e,[...p(e),{name:m.name,data:T,processed:pt(T)}]),z(r,p(e).length-1)},v.readAsText(m)})}function n(i){z(e,p(e).filter((h,L)=>L!==i)),p(r)>=p(e).length&&z(r,p(e).length-1)}let d=st(null);ht();var f=De();Jt(i=>{var h=Le();$t.title="aiwolf-nlp-viewer",ee(h,"href",`${Xt??""}/global.css`),D(i,h)});var A=b(u(f),2);{var c=i=>{var h=Te(),L=qt(h);Pt(L,v=>z(d,v),()=>p(d));var m=b(L,2);J("change",L,o),J("dragover",m,gt(function(v){re.call(this,t,v)})),J("drop",m,gt(s)),J("click",m,()=>{var v;return(v=p(d))==null?void 0:v.click()}),J("keydown",m,v=>{var I;v.key==="Enter"&&((I=p(d))==null||I.click())}),D(i,h)};W(A,i=>{p(e).length===0&&i(c)})}var E=b(A,2);{var x=i=>{var h=Se(),L=u(h),m=u(L);Q(m,5,()=>p(e),X,(I,U,T)=>{var k=Re(),F=u(k),$=u(F,!0);l(F);var q=b(F,2);l(k),V(()=>{ot(k,"active",p(r)===T),C($,p(U).name)}),J("click",F,()=>z(r,T)),J("click",q,()=>n(T)),D(I,k)}),l(m),l(L);var v=b(L,2);Q(v,5,()=>Object.entries(p(e)[p(r)].processed),X,(I,U)=>{let T=()=>p(U)[0],k=()=>p(U)[1];we(I,{get dayIdx(){return T()},get dayStatus(){return k()},get dayStatuses(){return p(e)[p(r)].processed}})}),l(v),l(h),D(i,h)};W(E,i=>{p(e).length>0&&i(x)})}l(f),D(a,f),wt()}export{Fe as component};
