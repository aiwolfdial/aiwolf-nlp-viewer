import"../chunks/Bg9kRutz.js";import{p as Ue,s as we,l as nt,i as M,a as Ke,aD as Te,h as o,c as l,g as t,f as i,aF as je,x as rt,aw as fe,$ as st}from"../chunks/sDBeb3T2.js";import{d as He,s as K}from"../chunks/CEqd99YM.js";import{i as q}from"../chunks/Cs_QwUJL.js";import{e as Pe,i as Be}from"../chunks/DDcytoOe.js";import{t as J,a as g,c as ke,b as Ze}from"../chunks/CS_i3HMU.js";import{h as it}from"../chunks/CzlQwNva.js";import{a as Ee,s as ee,r as ie,b as $e,c as le}from"../chunks/zR9ABBex.js";import{p as Oe}from"../chunks/BazZ8WVp.js";import{b as lt}from"../chunks/DbY9yHFC.js";import{s as Ce,a as ot,b as ct}from"../chunks/oWv3mMVZ.js";import{w as xe,d as ut}from"../chunks/D2af0L_b.js";import{I as Ve,s as et,c as tt,d as dt,t as Ne}from"../chunks/BsZDHtIb.js";import{a as We,o as at}from"../chunks/DFSbNnlX.js";/* empty css                */import{b as Ie}from"../chunks/BeIoTrLr.js";import{b as ft}from"../chunks/VHEfhAve.js";function vt(a,e,n,b){var u=a.__styles??(a.__styles={});u[e]!==n&&(u[e]=n,n==null?a.style.removeProperty(e):a.style.setProperty(e,n,""))}class Me{static fromJson(e){return pt(JSON.parse(e),ge("RealtimeSettings"))}static toJson(e){return JSON.stringify(_t(e,ge("RealtimeSettings")),null,2)}}function de(a,e,n,b=""){const u=Le(a),Q=b?` on ${b}`:"",f=n?` for key "${n}"`:"";throw Error(`Invalid value${f}${Q}. Expected ${u} but got ${JSON.stringify(e)}`)}function Le(a){return Array.isArray(a)?a.length===2&&a[0]===void 0?`an optional ${Le(a[1])}`:`one of [${a.map(e=>Le(e)).join(", ")}]`:typeof a=="object"&&a.literal!==void 0?a.literal:typeof a}function bt(a){if(a.jsonToJS===void 0){const e={};a.props.forEach(n=>e[n.json]={key:n.js,typ:n.typ}),a.jsonToJS=e}return a.jsonToJS}function mt(a){if(a.jsToJSON===void 0){const e={};a.props.forEach(n=>e[n.js]={key:n.json,typ:n.typ}),a.jsToJSON=e}return a.jsToJSON}function ye(a,e,n,b="",u=""){function Q(h,I){return typeof h==typeof I?I:de(h,I,b,u)}function f(h,I){const T=h.length;for(let L=0;L<T;L++){const N=h[L];try{return ye(I,N,n)}catch{}}return de(h,I,b,u)}function k(h,I){return h.indexOf(I)!==-1?I:de(h.map(T=>Re(T)),I,b,u)}function C(h,I){return Array.isArray(I)?I.map(T=>ye(T,h,n)):de(Re("array"),I,b,u)}function H(h){if(h===null)return null;const I=new Date(h);return isNaN(I.valueOf())?de(Re("Date"),h,b,u):I}function G(h,I,T){if(T===null||typeof T!="object"||Array.isArray(T))return de(Re(re||"object"),T,b,u);const L={};return Object.getOwnPropertyNames(h).forEach(N=>{const te=h[N],se=Object.prototype.hasOwnProperty.call(T,N)?T[N]:void 0;L[te.key]=ye(se,te.typ,n,N,re)}),Object.getOwnPropertyNames(T).forEach(N=>{Object.prototype.hasOwnProperty.call(h,N)||(L[N]=ye(T[N],I,n,N,re))}),L}if(e==="any")return a;if(e===null)return a===null?a:de(e,a,b,u);if(e===!1)return de(e,a,b,u);let re;for(;typeof e=="object"&&e.ref!==void 0;)re=e.ref,e=xt[e.ref];return Array.isArray(e)?k(e,a):typeof e=="object"?e.hasOwnProperty("unionMembers")?f(e.unionMembers,a):e.hasOwnProperty("arrayItems")?C(e.arrayItems,a):e.hasOwnProperty("props")?G(n(e),e.additional,a):de(e,a,b,u):e===Date&&typeof a!="number"?H(a):Q(e,a)}function pt(a,e){return ye(a,e,bt)}function _t(a,e){return ye(a,e,mt)}function Re(a){return{literal:a}}function De(a,e){return{props:a,additional:e}}function ge(a){return{ref:a}}const xt={RealtimeSettings:De([{json:"connection",js:"connection",typ:ge("Connection")},{json:"display",js:"display",typ:ge("Display")}],!1),Connection:De([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:De([{json:"canvas",js:"canvas",typ:ge("Agent")},{json:"bubble",js:"bubble",typ:ge("Agent")},{json:"text",js:"text",typ:ge("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:De([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},ze={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function gt(){const a=localStorage.getItem("realtime-settings");if(a)try{return Me.fromJson(a)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",Me.toJson(ze)),ze}const Se=xe(gt());Se.subscribe(a=>{localStorage.setItem("realtime-settings",Me.toJson(ze))});function ht(a){return Array.from({length:a},(e,n)=>({idx:n+1,team:"Undefined",name:Ve(n+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}function Y(a,e,n){var u,Q;if(n===void 0)return"該当なし";let b=[];return a!=null&&a.name&&b.push(Ve(n)),a!=null&&a.team&&b.push((u=e.agents.find(f=>f.idx===n))==null?void 0:u.team),a!=null&&a.role&&b.push((Q=e.agents.find(f=>f.idx===n))==null?void 0:Q.role),b.join(" ")}function Je(a,e){return(a||e)&&!(a&&e)}function yt(){const{subscribe:a,update:e}=xe({status:"disconnected",entries:{}});let n=null,b=null;Se.subscribe(f=>{b=f});function u(){if(!b)return;e(k=>({...k,status:"connecting"}));const f=new URL(b.connection.url);b.connection.token&&f.searchParams.set("token",b.connection.token),n=new WebSocket(f),n.onopen=()=>{e(k=>({...k,status:"connected"}))},n.onclose=()=>{e(k=>({...k,status:"disconnected"})),n=null},n.onerror=()=>{e(k=>({...k,status:"disconnected"})),n=null},n.onmessage=k=>{try{const C=JSON.parse(k.data);e(H=>{const G={...H.entries};return G[C.id]||(G[C.id]=[]),G[C.id].push(C),{...H,entries:G}})}catch(C){console.error("Failed to parse message:",C)}}}function Q(){n&&(e(f=>({...f,status:"disconnected"})),n.close(),n=null)}return{subscribe:a,connect:u,disconnect:Q,entries:{subscribe:f=>a(k=>f(k.entries))}}}const Ae=yt();var kt=J('<div role="alert" class="alert m-4"><p class="text-lg font-bold"> </p></div>'),wt=J('<p class="w-2/5 text-9xl font-black opacity-50 absolute top-0 left-0 -mt-4 ml-8"> </p>'),St=(a,e,n)=>{t(e)===t(n).idx?we(e,void 0):we(e,Oe(t(n).idx))},jt=J('<div class="absolute inset-0 flex items-center justify-center"><span class="text-9xl font-bold opacity-75"> </span></div>'),It=J("<span> </span>"),Tt=J('<span class="text-2xl mt-2"> </span>'),Ot=J("<span> </span>"),At=J('<span class="text-2xl mt-2"> </span>'),Et=J("<span> </span>"),Ct=J('<div class="absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-1m75ffo"><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"> <!></button></div></div> <!> <!> <!></div>'),Rt=J('<div class="h-full flex flex-col"><!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><p>イラスト : 石黒正数氏</p></aside></footer></div>');function Dt(a,e){Ue(e,!0);let n=Te(void 0);const b=Se.subscribe(r=>{we(n,Oe(r))});We(b);let u=Te(void 0),Q=rt(()=>{var r,s,w,S,O,m,U,D,W,p,y,B,Z;switch(e.packet.event){case"未接続":return"未接続";case"トーク":case"囁き":return e.packet.message;case"襲撃投票":return Je(t(u)===void 0,e.packet.fromIdx===t(u))?`${Y((r=t(n))==null?void 0:r.display.bubble,e.packet,e.packet.fromIdx)} が ${Y((s=t(n))==null?void 0:s.display.bubble,e.packet,e.packet.toIdx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return Je(t(u)===void 0,e.packet.fromIdx===t(u))?`${Y((w=t(n))==null?void 0:w.display.bubble,e.packet,e.packet.fromIdx)} が ${Y((S=t(n))==null?void 0:S.display.bubble,e.packet,e.packet.toIdx)} に投票しました`:`${Y((O=t(n))==null?void 0:O.display.bubble,e.packet,e.packet.fromIdx)} が投票しました`;case"追放":return e.packet.toIdx===void 0?"誰も追放されませんでした":`${Y((m=t(n))==null?void 0:m.display.bubble,e.packet,e.packet.toIdx)} を追放しました`;case"襲撃":return e.packet.toIdx===void 0?"誰も襲撃されませんでした":e.packet.fromIdx===-1?`${Y((U=t(n))==null?void 0:U.display.bubble,e.packet,e.packet.toIdx)} が襲撃されましたが、護衛されました`:`${Y((D=t(n))==null?void 0:D.display.bubble,e.packet,e.packet.toIdx)} が襲撃されました`;case"占い":return Je(t(u)===void 0,e.packet.fromIdx===t(u))?`${Y((W=t(n))==null?void 0:W.display.bubble,e.packet,e.packet.fromIdx)} が ${Y((p=t(n))==null?void 0:p.display.bubble,e.packet,e.packet.toIdx)} を占った結果、${dt((y=e.packet.agents.find(P=>P.idx===e.packet.toIdx))==null?void 0:y.role)} でした`:"占いました";case"護衛":return Je(t(u)===void 0,e.packet.fromIdx===t(u))?`${Y((B=t(n))==null?void 0:B.display.bubble,e.packet,e.packet.fromIdx)} が ${Y((Z=t(n))==null?void 0:Z.display.bubble,e.packet,e.packet.toIdx)} を護衛対象にしました`:"護衛しました";default:return}}),f,k,C,H;at(()=>(window.addEventListener("resize",G),()=>{window.removeEventListener("resize",G)})),nt(()=>{G()});function G(){if(!k||!C||!f)return;const r=f.getBoundingClientRect();if([k,C].forEach(O=>{O.width=r.width,O.height=r.height;const m=O.getContext("2d");m&&(m.clearRect(0,0,O.width,O.height),m.globalAlpha=1,m.lineWidth=2)}),t(u)!==void 0&&(e.packet.event==="占い"&&e.packet.fromIdx!==t(u)||e.packet.event==="投票"&&e.packet.fromIdx!==t(u)||e.packet.event==="襲撃投票"&&e.packet.fromIdx!==t(u)))return;const s=k.getContext("2d"),w=C.getContext("2d");if(!s||!w)return;const S=C.getBoundingClientRect();if(e.packet.fromIdx!==void 0&&e.packet.toIdx!==void 0){const O=document.getElementById(`agent-${e.packet.fromIdx}`);if(!(O instanceof HTMLElement))return;const m=O.getBoundingClientRect(),U=m.left+m.width/2-S.left,D=m.top+m.height/2-S.top,W=document.getElementById(`agent-${e.packet.toIdx}`);if(!(W instanceof HTMLElement))return;const p=W.getBoundingClientRect();re(w,U,D,p.left+p.width/2-S.left,p.top+p.height/2-S.top,!1,getComputedStyle(H).getPropertyValue("background-color"))}if(e.packet.bubbleIdx!==void 0){const O=document.getElementById(`agent-${e.packet.bubbleIdx}`);if(!(O instanceof HTMLElement))return;const m=O.getBoundingClientRect(),U=m.left+m.width/2-S.left,D=m.top+m.height/2-S.top;re(s,S.width/2,S.height/2,U,D,!0,getComputedStyle(H).getPropertyValue("background-color"))}}function re(r,s,w,S,O,m,U){const D=m?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];r.strokeStyle=r.fillStyle=U,r.beginPath();let W=S-s,p=O-w,y=Math.sqrt(W*W+p*p),B=p/y,Z=W/y,P=[];P.push(0,0);for(let _=0;_<D.length;_+=2){let j=D[_],d=D[_+1];P.push(j<0?y+j:j,d)}P.push(y,0);for(let _=D.length;_>0;_-=2){let j=D[_-2],d=D[_-1];P.push(j<0?y+j:j,-d)}P.push(0,0);for(let _=0;_<P.length;_+=2){let j=P[_]*Z-P[_+1]*B+s,d=P[_]*B+P[_+1]*Z+w;_===0?r.moveTo(j,d):r.lineTo(j,d)}r.fill()}var h=Rt(),I=l(h);{var T=r=>{var s=kt(),w=l(s),S=l(w);i(w),i(s),M(()=>K(S,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),g(r,s)};q(I,r=>{var s;(s=t(n))!=null&&s.display.largeScale||r(T)})}var L=o(I,2),N=l(L),te=l(N);{var se=r=>{var s=wt(),w=l(s);i(s),M(()=>K(w,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),g(r,s)};q(te,r=>{var s;(s=t(n))!=null&&s.display.largeScale&&r(se)})}var ve=o(te,2);Ie(ve,r=>k=r,()=>k);var oe=o(ve,2);Ie(oe,r=>C=r,()=>C);var $=o(oe,2),be=l($),V=l(be),v=l(V,!0);i(V),i(be),i($),Ie($,r=>H=r,()=>H);var z=o($,2);Pe(z,17,()=>e.packet.agents,Be,(r,s,w)=>{var S=Ct(),O=l(S),m=l(O),U=l(m);U.__click=[St,u,s];var D=l(U),W=o(D,2);{var p=d=>{var c=jt(),R=l(c),E=l(R,!0);i(R),i(c),M(()=>K(E,t(s).idx)),g(d,c)};q(W,d=>{var c,R;(c=t(n))!=null&&c.display.largeScale&&((R=t(n))!=null&&R.display.canvas.name)&&d(p)})}i(U),i(m),i(O);var y=o(O,2);{var B=d=>{var c=It(),R=l(c,!0);i(c),M(E=>K(R,E),[()=>Ve(t(s).idx)]),g(d,c)};q(y,d=>{var c,R;!((c=t(n))!=null&&c.display.largeScale)&&((R=t(n))!=null&&R.display.canvas.name)&&d(B)})}var Z=o(y,2);{var P=d=>{var c=ke(),R=fe(c);{var E=A=>{var x=Tt(),ae=l(x,!0);i(x),M(()=>K(ae,t(s).team)),g(A,x)},F=A=>{var x=Ot(),ae=l(x,!0);i(x),M(()=>K(ae,t(s).team)),g(A,x)};q(R,A=>{var x;(x=t(n))!=null&&x.display.largeScale?A(E):A(F,!1)})}g(d,c)};q(Z,d=>{var c;(c=t(n))!=null&&c.display.canvas.team&&d(P)})}var _=o(Z,2);{var j=d=>{var c=ke(),R=fe(c);{var E=A=>{var x=At(),ae=l(x,!0);i(x),M(()=>K(ae,t(s).role)),g(A,x)},F=A=>{var x=Et(),ae=l(x,!0);i(x),M(()=>K(ae,t(s).role)),g(A,x)};q(R,A=>{var x;(x=t(n))!=null&&x.display.largeScale?A(E):A(F,!1)})}g(d,c)};q(_,d=>{var c;(c=t(n))!=null&&c.display.canvas.role&&(t(s).idx===t(u)||t(u)===void 0)&&d(j)})}i(S),M(d=>{var c;Ee(S,"style",`--angle: ${w*(360/e.packet.agents.length)}`),Ee(S,"id",`agent-${t(s).idx??""}`),Ne(S,"bg-base-100",t(s).idx===t(u)),et(m,tt((c=t(n))!=null&&c.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-1m75ffo"),Ne(m,"ring-success",t(s).isAlive),Ne(m,"ring-error",!t(s).isAlive),vt(m,"opacity",t(s).isAlive?1:.25),Ee(D,"src",`${ft??""}/images/male/${d??""}.png`),Ee(D,"alt",t(s).name)},[()=>t(s).idx.toString().padStart(2,"0")]),g(r,S)}),i(N),Ie(N,r=>f=r,()=>f),i(L),je(2),i(h),M(()=>{var r;$.hidden=!t(Q),et(V,tt((r=t(n))!=null&&r.display.largeScale?"text-3xl font-bold text-pretty break-keep text-center":"text-lg text-pretty break-keep text-center"),"svelte-1m75ffo"),K(v,t(Q))}),g(a,h),Ke()}He(["click"]);function Jt(){Ae.connect()}function Nt(){Ae.disconnect()}var Pt=J('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Bt=J('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Mt=J('<div class="status status-error"></div>'),Lt=(a,e)=>e("connection.url",a.currentTarget.value),zt=(a,e)=>e("connection.token",a.currentTarget.value),Ut=(a,e)=>e("display.canvas.name",a.currentTarget.checked),Kt=(a,e)=>e("display.canvas.team",a.currentTarget.checked),Ht=(a,e)=>e("display.canvas.role",a.currentTarget.checked),Vt=(a,e)=>e("display.bubble.name",a.currentTarget.checked),Wt=(a,e)=>e("display.bubble.team",a.currentTarget.checked),Ft=(a,e)=>e("display.bubble.role",a.currentTarget.checked),Xt=(a,e)=>e("display.text.name",a.currentTarget.checked),Yt=(a,e)=>e("display.text.team",a.currentTarget.checked),qt=(a,e)=>e("display.text.role",a.currentTarget.checked),Gt=(a,e)=>e("display.largeScale",a.currentTarget.checked),Qt=J('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">表示設定</h3> <h4 class="text-base font-bold mt-4">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Zt(a,e){Ue(e,!0);let n=Te(void 0),b=Te(void 0);const u=Se.subscribe(X=>{we(n,Oe(X))}),Q=Ae.subscribe(X=>{we(b,Oe(X.status))});We(()=>{u(),Q()});function f(X,ce){Se.update(pe=>{const _e=X.split("."),he=_e.pop();let ne=pe;for(const ue of _e)ue&&(ne=ne[ue]);return ne[he]=ce,{...pe}})}let k;var C=Qt(),H=o(l(C),2),G=l(H),re=l(G);{var h=X=>{var ce=Pt();je(2),g(X,ce)},I=X=>{var ce=ke(),pe=fe(ce);{var _e=ne=>{var ue=Bt();je(2),g(ne,ue)},he=ne=>{var ue=Mt();g(ne,ue)};q(pe,ne=>{t(b)==="connecting"?ne(_e):ne(he,!1)},!0)}g(X,ce)};q(re,X=>{t(b)==="connected"?X(h):X(I,!1)})}i(G),i(H);var T=o(H,2),L=l(T);ee(L,"class","h-[1em] opacity-50"),ee(L,"inline",!0),ee(L,"icon","mdi:link");var N=o(L,2);ie(N),N.__input=[Lt,f],i(T);var te=o(T,2),se=l(te);ee(se,"class","h-[1em] opacity-50"),ee(se,"inline",!0),ee(se,"icon","mdi:key");var ve=o(se,2);ie(ve),ve.__input=[zt,f],je(2),i(te);var oe=o(te,2);oe.__click=[Jt];var $=o(oe,2);$.__click=[Nt];var be=o($,2);be.__click=()=>k.showModal();var V=o(be,2),v=l(V),z=l(v),r=o(l(z),4),s=l(r),w=o(l(s),2);ie(w),w.__change=[Ut,f],i(s);var S=o(s,2),O=o(l(S),2);ie(O),O.__change=[Kt,f],i(S);var m=o(S,2),U=o(l(m),2);ie(U),U.__change=[Ht,f],i(m),i(r);var D=o(r,4),W=l(D),p=o(l(W),2);ie(p),p.__change=[Vt,f],i(W);var y=o(W,2),B=o(l(y),2);ie(B),B.__change=[Wt,f],i(y);var Z=o(y,2),P=o(l(Z),2);ie(P),P.__change=[Ft,f],i(Z),i(D);var _=o(D,4),j=l(_),d=o(l(j),2);ie(d),d.__change=[Xt,f],i(j);var c=o(j,2),R=o(l(c),2);ie(R),R.__change=[Yt,f],i(c);var E=o(c,2),F=o(l(E),2);ie(F),F.__change=[qt,f],i(E),i(_);var A=o(_,4),x=o(l(A),2);ie(x),x.__change=[Gt,f],i(A),i(z),i(v),je(2),i(V),Ie(V,X=>k=X,()=>k);var ae=o(V,2),me=l(ae);ee(me,"inline",!0),ee(me,"icon","mdi:white-balance-sunny");var Fe=o(me,4);ee(Fe,"inline",!0),ee(Fe,"icon","mdi:moon-and-stars"),i(ae),i(C),M(()=>{var X,ce,pe,_e,he,ne,ue,Xe,Ye,qe,Ge,Qe;$e(N,(X=t(n))==null?void 0:X.connection.url),$e(ve,(ce=t(n))==null?void 0:ce.connection.token),oe.disabled=t(b)!=="disconnected",$.disabled=t(b)==="disconnected",le(w,(pe=t(n))==null?void 0:pe.display.canvas.name),le(O,(_e=t(n))==null?void 0:_e.display.canvas.team),le(U,(he=t(n))==null?void 0:he.display.canvas.role),le(p,(ne=t(n))==null?void 0:ne.display.bubble.name),le(B,(ue=t(n))==null?void 0:ue.display.bubble.team),le(P,(Xe=t(n))==null?void 0:Xe.display.bubble.role),le(d,(Ye=t(n))==null?void 0:Ye.display.text.name),le(R,(qe=t(n))==null?void 0:qe.display.text.team),le(F,(Ge=t(n))==null?void 0:Ge.display.text.role),le(x,(Qe=t(n))==null?void 0:Qe.display.largeScale)}),g(a,C),Ke()}He(["input","click","change"]);var $t=J("<option> </option>"),ea=J('<div class="divider"> </div>'),ta=J('<div class="divider"> </div>'),aa=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),na=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),ra=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),sa=J('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),ia=J('<!> <!> <button class="btn"><!></button>',1),la=J('<main class="h-screen flex flex-col"><!> <div class="flex flex-1 overflow-hidden w-full flex-col md:flex-row"><div class="flex-auto bg-base-300"><!></div> <div class="w-full md:w-64 max-md:h-32 flex flex-col bg-base-200 p-2"><select class="w-full select"></select> <ul class="list overflow-y-auto flex-1 my-2 px-2"></ul></div></div></main>');function ja(a,e){Ue(e,!0);const[n,b]=ot(),u=()=>Ce(I,"$status",n),Q=()=>Ce(re,"$currentPacket",n),f=()=>Ce(C,"$selectedId",n),k=()=>Ce(h,"$entries",n),C=xe(""),H=xe(0),G={id:"",idx:-1,day:0,isDay:!0,agents:ht(5),event:"未接続",message:void 0,fromIdx:void 0,toIdx:void 0,bubbleIdx:void 0},re=xe(G),h=xe({}),I=xe("");let T=Te(void 0);at(()=>{const V=Ae.entries.subscribe(r=>{h.set(r),C.update(s=>s||Object.keys(r)[0]||"")}),v=Ae.subscribe(r=>{I.set(r.status)});C.subscribe(r=>{h.update(s=>{var w;return r&&((w=s[r])==null?void 0:w.length)>0&&H.set(s[r].length-1),s})});const z=Se.subscribe(r=>{we(T,Oe(r))});ut([C,H,h],([r,s,w])=>w[r]&&s>=0&&s<w[r].length?w[r][s]:G).subscribe(r=>{re.set(r)}),We(()=>{V(),v(),z()}),window.addEventListener("beforeunload",r=>{u()==="connecting"&&r.preventDefault()})});var L=la();it(V=>{st.title="aiwolf-nlp-viewer"});var N=l(L);Zt(N,{});var te=o(N,2),se=l(te),ve=l(se);Dt(ve,{get packet(){return Q()}}),i(se);var oe=o(se,2),$=l(oe);Pe($,5,()=>Object.keys(k()),Be,(V,v)=>{var z=$t(),r={},s=l(z,!0);i(z),M(()=>{r!==(r=t(v))&&(z.value=(z.__value=t(v))==null?"":t(v)),K(s,t(v))}),g(V,z)}),i($);var be=o($,2);Pe(be,5,()=>k()[f()]||[],Be,(V,v,z)=>{var r=ia(),s=fe(r);{var w=p=>{var y=ea(),B=l(y);i(y),M(()=>K(B,`${t(v).day??""}日目 ${(t(v).isDay?"昼":"夜")??""}`)),g(p,y)};q(s,p=>{z>0&&(t(v).day!==k()[f()][z-1].day||t(v).isDay!==k()[f()][z-1].isDay)&&p(w)})}var S=o(s,2);{var O=p=>{var y=ta(),B=l(y);i(y),M(()=>K(B,`${t(v).day??""}日目 ${(t(v).isDay?"昼":"夜")??""}`)),g(p,y)};q(S,p=>{z==0&&p(O)})}var m=o(S,2);m.__click=()=>H.set(z);var U=l(m);{var D=p=>{var y=ke(),B=fe(y);{var Z=_=>{var j=aa(),d=fe(j),c=l(d,!0);i(d);var R=o(d,2);ee(R,"inline",!0),ee(R,"icon","mdi:skip-forward"),M(E=>K(c,E),[()=>{var E;return Y((E=t(T))==null?void 0:E.display.text,t(v),t(v).bubbleIdx)}]),g(_,j)},P=_=>{var j=ke(),d=fe(j);{var c=E=>{var F=na(),A=fe(F),x=l(A,!0);i(A);var ae=o(A,2);ee(ae,"inline",!0),ee(ae,"icon","mdi:arrow-u-down-right-bold"),M(me=>K(x,me),[()=>{var me;return Y((me=t(T))==null?void 0:me.display.text,t(v),t(v).bubbleIdx)}]),g(E,F)},R=E=>{var F=ra(),A=l(F,!0);i(F),M(x=>K(A,x),[()=>{var x;return Y((x=t(T))==null?void 0:x.display.text,t(v),t(v).bubbleIdx)+"<"+t(v).message}]),g(E,F)};q(d,E=>{t(v).message==="Skip"?E(c):E(R,!1)},!0)}g(_,j)};q(B,_=>{t(v).message==="Over"?_(Z):_(P,!1)})}g(p,y)},W=p=>{var y=sa(),B=l(y);{var Z=j=>{var d=Ze();M(c=>K(d,c),[()=>{var c;return Y((c=t(T))==null?void 0:c.display.text,t(v),t(v).fromIdx)}]),g(j,d)},P=j=>{var d=ke(),c=fe(d);{var R=E=>{var F=Ze();M(A=>K(F,A),[()=>{var A;return Y((A=t(T))==null?void 0:A.display.text,t(v),t(v).toIdx)}]),g(E,F)};q(c,E=>{(t(v).event==="追放"||t(v).event==="襲撃")&&E(R)},!0)}g(j,d)};q(B,j=>{t(v).event==="投票"||t(v).event==="占い"?j(Z):j(P,!1)})}var _=o(B);i(y),M(()=>K(_,` ${t(v).event??""}`)),g(p,y)};q(U,p=>{t(v).event==="トーク"||t(v).event==="囁き"?p(D):p(W,!1)})}i(m),g(V,r)}),i(be),i(oe),i(te),i(L),lt($,f,V=>ct(C,V)),g(a,L),Ke(),b()}He(["click"]);export{ja as component};
