import{t as L,a as w,c as Ie,d as Qe}from"../chunks/56-FZzVf.js";import{p as Ue,s as he,o as nt,j as M,a as Xe,aG as Te,i as l,c as o,g as t,f as s,aI as Ae,y as rt,aw as pe,$ as st}from"../chunks/gg5HwMBM.js";import{d as He,s as V}from"../chunks/DI_mLvlt.js";import{i as F}from"../chunks/cLcwwkPL.js";import{e as Pe,i as Me}from"../chunks/DxQKEJWX.js";import{h as ot}from"../chunks/CSn9cF3y.js";import{s as ke,a as Z,r as ie,c as Ze,d as de}from"../chunks/CGCW5UOo.js";import{p as Ee}from"../chunks/Rs7vqiH9.js";import{b as it}from"../chunks/Cx_x8te2.js";import{b as Se}from"../chunks/DU60D4PS.js";import{s as Ce,a as lt,b as ct}from"../chunks/yiHWBsU-.js";import{w as xe,d as ut}from"../chunks/5ZuRk7Ze.js";import{I as Ke,c as $e,d as dt}from"../chunks/DJtq_3y-.js";import{a as We,o as at}from"../chunks/CQE0SVbD.js";/* empty css                */import{s as et,t as Ne}from"../chunks/C_Lgu1rS.js";import{b as ft}from"../chunks/Deq2XxX4.js";function vt(a,e,n,x){var f=a.__styles??(a.__styles={});f[e]!==n&&(f[e]=n,n==null?a.style.removeProperty(e):a.style.setProperty(e,n,""))}class Be{static fromJson(e){return pt(JSON.parse(e),ge("RealtimeSettings"))}static toJson(e){return JSON.stringify(_t(e,ge("RealtimeSettings")),null,2)}}function me(a,e,n,x=""){const f=ze(a),G=x?` on ${x}`:"",v=n?` for key "${n}"`:"";throw Error(`Invalid value${v}${G}. Expected ${f} but got ${JSON.stringify(e)}`)}function ze(a){return Array.isArray(a)?a.length===2&&a[0]===void 0?`an optional ${ze(a[1])}`:`one of [${a.map(e=>ze(e)).join(", ")}]`:typeof a=="object"&&a.literal!==void 0?a.literal:typeof a}function bt(a){if(a.jsonToJS===void 0){const e={};a.props.forEach(n=>e[n.json]={key:n.js,typ:n.typ}),a.jsonToJS=e}return a.jsonToJS}function mt(a){if(a.jsToJSON===void 0){const e={};a.props.forEach(n=>e[n.js]={key:n.json,typ:n.typ}),a.jsToJSON=e}return a.jsToJSON}function je(a,e,n,x="",f=""){function G(y,T){return typeof y==typeof T?T:me(y,T,x,f)}function v(y,T){const E=y.length;for(let B=0;B<E;B++){const D=y[B];try{return je(T,D,n)}catch{}}return me(y,T,x,f)}function k(y,T){return y.indexOf(T)!==-1?T:me(y.map(E=>De(E)),T,x,f)}function R(y,T){return Array.isArray(T)?T.map(E=>je(E,y,n)):me(De("array"),T,x,f)}function H(y){if(y===null)return null;const T=new Date(y);return isNaN(T.valueOf())?me(De("Date"),y,x,f):T}function Y(y,T,E){if(E===null||typeof E!="object"||Array.isArray(E))return me(De(ne||"object"),E,x,f);const B={};return Object.getOwnPropertyNames(y).forEach(D=>{const Q=y[D],le=Object.prototype.hasOwnProperty.call(E,D)?E[D]:void 0;B[Q.key]=je(le,Q.typ,n,D,ne)}),Object.getOwnPropertyNames(E).forEach(D=>{Object.prototype.hasOwnProperty.call(y,D)||(B[D]=je(E[D],T,n,D,ne))}),B}if(e==="any")return a;if(e===null)return a===null?a:me(e,a,x,f);if(e===!1)return me(e,a,x,f);let ne;for(;typeof e=="object"&&e.ref!==void 0;)ne=e.ref,e=xt[e.ref];return Array.isArray(e)?k(e,a):typeof e=="object"?e.hasOwnProperty("unionMembers")?v(e.unionMembers,a):e.hasOwnProperty("arrayItems")?R(e.arrayItems,a):e.hasOwnProperty("props")?Y(n(e),e.additional,a):me(e,a,x,f):e===Date&&typeof a!="number"?H(a):G(e,a)}function pt(a,e){return je(a,e,bt)}function _t(a,e){return je(a,e,mt)}function De(a){return{literal:a}}function Je(a,e){return{props:a,additional:e}}function ge(a){return{ref:a}}const xt={RealtimeSettings:Je([{json:"connection",js:"connection",typ:ge("Connection")},{json:"display",js:"display",typ:ge("Display")}],!1),Connection:Je([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:Je([{json:"canvas",js:"canvas",typ:ge("Agent")},{json:"bubble",js:"bubble",typ:ge("Agent")},{json:"text",js:"text",typ:ge("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:Je([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},tt={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function gt(){const a=localStorage.getItem("realtime-settings");if(a)try{return Be.fromJson(a)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",Be.toJson(tt)),tt}const Oe=xe(gt());Oe.subscribe(a=>{localStorage.setItem("realtime-settings",Be.toJson(a))});function ht(a){return Array.from({length:a},(e,n)=>({idx:n+1,team:"Undefined",name:Ke(n+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}function W(a,e,n){var f,G;if(n===void 0)return"該当なし";let x=[];return a!=null&&a.name&&x.push(Ke(n)),a!=null&&a.team&&x.push((f=e.agents.find(v=>v.idx===n))==null?void 0:f.team),a!=null&&a.role&&x.push((G=e.agents.find(v=>v.idx===n))==null?void 0:G.role),x.join(" ")}function Le(a,e){return(a||e)&&!(a&&e)}function yt(){const{subscribe:a,update:e}=xe({status:"disconnected",entries:{}});let n=null,x=null;Oe.subscribe(v=>{x=v});function f(){if(!x)return;e(k=>({...k,status:"connecting"}));const v=new URL(x.connection.url);x.connection.token&&v.searchParams.set("token",x.connection.token),n=new WebSocket(v),n.onopen=()=>{e(k=>({...k,status:"connected"}))},n.onclose=()=>{e(k=>({...k,status:"disconnected"})),n=null},n.onerror=()=>{e(k=>({...k,status:"disconnected"})),n=null},n.onmessage=k=>{try{const R=JSON.parse(k.data);e(H=>{const Y={...H.entries};return Y[R.id]||(Y[R.id]=[]),Y[R.id].push(R),{...H,entries:Y}})}catch(R){console.error("Failed to parse message:",R)}}}function G(){n&&(e(v=>({...v,status:"disconnected"})),n.close(),n=null)}return{subscribe:a,connect:f,disconnect:G,entries:{subscribe:v=>a(k=>v(k.entries))}}}const Re=yt();var wt=L('<div role="alert" class="alert m-4"><p class="text-lg font-bold"> </p></div>'),kt=L('<p class="w-2/5 text-9xl font-black opacity-50 absolute top-0 left-0 -mt-4 ml-8"> </p>'),St=(a,e,n)=>{t(e)===t(n).idx?he(e,void 0):he(e,Ee(t(n).idx))},jt=L('<div class="absolute inset-0 flex items-center justify-center"><span class="text-9xl font-bold opacity-75"> </span></div>'),It=L("<span> </span>"),Tt=L('<span class="text-2xl mt-2"> </span>'),Et=L("<span> </span>"),Ot=L('<span class="text-2xl mt-2"> </span>'),At=L("<span> </span>"),Rt=L('<div class="absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-1m75ffo"><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"> <!></button></div></div> <!> <!> <!></div>'),Ct=L('<div class="h-full flex flex-col"><!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><p>イラスト : 石黒正数氏</p></aside></footer></div>');function Dt(a,e){Ue(e,!0);let n=Te(void 0);const x=Oe.subscribe(u=>{he(n,Ee(u))});We(x);let f=Te(void 0),G=rt(()=>{var u,c,C,S,d,r,b,i,h,O,z,ee,te;switch(e.packet.event){case"未接続":return"未接続";case"トーク":case"囁き":return e.packet.message;case"襲撃投票":return Le(t(f)===void 0,e.packet.fromIdx===t(f))?`${W((u=t(n))==null?void 0:u.display.bubble,e.packet,e.packet.fromIdx)} が ${W((c=t(n))==null?void 0:c.display.bubble,e.packet,e.packet.toIdx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return Le(t(f)===void 0,e.packet.fromIdx===t(f))?`${W((C=t(n))==null?void 0:C.display.bubble,e.packet,e.packet.fromIdx)} が ${W((S=t(n))==null?void 0:S.display.bubble,e.packet,e.packet.toIdx)} に投票しました`:`${W((d=t(n))==null?void 0:d.display.bubble,e.packet,e.packet.fromIdx)} が投票しました`;case"追放":return e.packet.toIdx===void 0?"誰も追放されませんでした":`${W((r=t(n))==null?void 0:r.display.bubble,e.packet,e.packet.toIdx)} を追放しました`;case"襲撃":return e.packet.toIdx===void 0?"誰も襲撃されませんでした":e.packet.fromIdx===-1?`${W((b=t(n))==null?void 0:b.display.bubble,e.packet,e.packet.toIdx)} が襲撃されましたが、護衛されました`:`${W((i=t(n))==null?void 0:i.display.bubble,e.packet,e.packet.toIdx)} が襲撃されました`;case"占い":return Le(t(f)===void 0,e.packet.fromIdx===t(f))?`${W((h=t(n))==null?void 0:h.display.bubble,e.packet,e.packet.fromIdx)} が ${W((O=t(n))==null?void 0:O.display.bubble,e.packet,e.packet.toIdx)} を占った結果、${dt((z=e.packet.agents.find(N=>N.idx===e.packet.toIdx))==null?void 0:z.role)} でした`:"占いました";case"護衛":return Le(t(f)===void 0,e.packet.fromIdx===t(f))?`${W((ee=t(n))==null?void 0:ee.display.bubble,e.packet,e.packet.fromIdx)} が ${W((te=t(n))==null?void 0:te.display.bubble,e.packet,e.packet.toIdx)} を護衛対象にしました`:"護衛しました";default:return}}),v,k,R,H;at(()=>(window.addEventListener("resize",Y),()=>{window.removeEventListener("resize",Y)})),nt(()=>{Y()});function Y(){if(!k||!R||!v)return;const u=v.getBoundingClientRect();if([k,R].forEach(d=>{d.width=u.width,d.height=u.height;const r=d.getContext("2d");r&&(r.clearRect(0,0,d.width,d.height),r.globalAlpha=1,r.lineWidth=2)}),t(f)!==void 0&&(e.packet.event==="占い"&&e.packet.fromIdx!==t(f)||e.packet.event==="投票"&&e.packet.fromIdx!==t(f)||e.packet.event==="襲撃投票"&&e.packet.fromIdx!==t(f)))return;const c=k.getContext("2d"),C=R.getContext("2d");if(!c||!C)return;const S=R.getBoundingClientRect();if(e.packet.fromIdx!==void 0&&e.packet.toIdx!==void 0){const d=document.getElementById(`agent-${e.packet.fromIdx}`);if(!(d instanceof HTMLElement))return;const r=d.getBoundingClientRect(),b=r.left+r.width/2-S.left,i=r.top+r.height/2-S.top,h=document.getElementById(`agent-${e.packet.toIdx}`);if(!(h instanceof HTMLElement))return;const O=h.getBoundingClientRect();ne(C,b,i,O.left+O.width/2-S.left,O.top+O.height/2-S.top,!1,getComputedStyle(H).getPropertyValue("background-color"))}if(e.packet.bubbleIdx!==void 0){const d=document.getElementById(`agent-${e.packet.bubbleIdx}`);if(!(d instanceof HTMLElement))return;const r=d.getBoundingClientRect(),b=r.left+r.width/2-S.left,i=r.top+r.height/2-S.top;ne(c,S.width/2,S.height/2,b,i,!0,getComputedStyle(H).getPropertyValue("background-color"))}}function ne(u,c,C,S,d,r,b){const i=r?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];u.strokeStyle=u.fillStyle=b,u.beginPath();let h=S-c,O=d-C,z=Math.sqrt(h*h+O*O),ee=O/z,te=h/z,N=[];N.push(0,0);for(let g=0;g<i.length;g+=2){let A=i[g],_=i[g+1];N.push(A<0?z+A:A,_)}N.push(z,0);for(let g=i.length;g>0;g-=2){let A=i[g-2],_=i[g-1];N.push(A<0?z+A:A,-_)}N.push(0,0);for(let g=0;g<N.length;g+=2){let A=N[g]*te-N[g+1]*ee+c,_=N[g]*ee+N[g+1]*te+C;g===0?u.moveTo(A,_):u.lineTo(A,_)}u.fill()}var y=Ct(),T=o(y);{var E=u=>{var c=wt(),C=o(c),S=o(C);s(C),s(c),M(()=>V(S,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),w(u,c)};F(T,u=>{var c;(c=t(n))!=null&&c.display.largeScale||u(E)})}var B=l(T,2),D=o(B),Q=o(D);{var le=u=>{var c=kt(),C=o(c);s(c),M(()=>V(C,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),w(u,c)};F(Q,u=>{var c;(c=t(n))!=null&&c.display.largeScale&&u(le)})}var fe=l(Q,2);Se(fe,u=>k=u,()=>k);var ce=l(fe,2);Se(ce,u=>R=u,()=>R);var re=l(ce,2),ve=o(re),$=o(ve),ye=o($,!0);s($),s(ve),s(re),Se(re,u=>H=u,()=>H);var _e=l(re,2);Pe(_e,17,()=>e.packet.agents,Me,(u,c,C)=>{var S=Rt(),d=o(S),r=o(d),b=o(r);b.__click=[St,f,c];var i=o(b),h=l(i,2);{var O=_=>{var m=jt(),J=o(m),U=o(J,!0);s(J),s(m),M(()=>V(U,t(c).idx)),w(_,m)};F(h,_=>{var m,J;(m=t(n))!=null&&m.display.largeScale&&((J=t(n))!=null&&J.display.canvas.name)&&_(O)})}s(b),s(r),s(d);var z=l(d,2);{var ee=_=>{var m=It(),J=o(m,!0);s(m),M(U=>V(J,U),[()=>Ke(t(c).idx)]),w(_,m)};F(z,_=>{var m,J;!((m=t(n))!=null&&m.display.largeScale)&&((J=t(n))!=null&&J.display.canvas.name)&&_(ee)})}var te=l(z,2);{var N=_=>{var m=Ie(),J=pe(m);{var U=j=>{var p=Tt(),K=o(p,!0);s(p),M(()=>V(K,t(c).team)),w(j,p)},P=j=>{var p=Et(),K=o(p,!0);s(p),M(()=>V(K,t(c).team)),w(j,p)};F(J,j=>{var p;(p=t(n))!=null&&p.display.largeScale?j(U):j(P,!1)})}w(_,m)};F(te,_=>{var m;(m=t(n))!=null&&m.display.canvas.team&&_(N)})}var g=l(te,2);{var A=_=>{var m=Ie(),J=pe(m);{var U=j=>{var p=Ot(),K=o(p,!0);s(p),M(()=>V(K,t(c).role)),w(j,p)},P=j=>{var p=At(),K=o(p,!0);s(p),M(()=>V(K,t(c).role)),w(j,p)};F(J,j=>{var p;(p=t(n))!=null&&p.display.largeScale?j(U):j(P,!1)})}w(_,m)};F(g,_=>{var m;(m=t(n))!=null&&m.display.canvas.role&&(t(c).idx===t(f)||t(f)===void 0)&&_(A)})}s(S),M(_=>{var m;ke(S,"style",`--angle: ${C*(360/e.packet.agents.length)}`),ke(S,"id",`agent-${t(c).idx??""}`),Ne(S,"bg-base-100",t(c).idx===t(f)),et(r,$e((m=t(n))!=null&&m.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-1m75ffo"),Ne(r,"ring-success",t(c).isAlive),Ne(r,"ring-error",!t(c).isAlive),vt(r,"opacity",t(c).isAlive?1:.25),ke(i,"src",`${ft??""}/images/male/${_??""}.png`),ke(i,"alt",t(c).name)},[()=>t(c).idx.toString().padStart(2,"0")]),w(u,S)}),s(D),Se(D,u=>v=u,()=>v),s(B),Ae(2),s(y),M(()=>{var u;re.hidden=!t(G),et($,$e((u=t(n))!=null&&u.display.largeScale?"text-3xl font-bold text-pretty break-keep text-center":"text-lg text-pretty break-keep text-center"),"svelte-1m75ffo"),V(ye,t(G))}),w(a,y),Xe()}He(["click"]);function Jt(){Re.connect()}function Lt(){Re.disconnect()}var Nt=L('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Pt=L('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Mt=L('<div class="status status-error"></div>'),Bt=(a,e)=>e("connection.url",a.currentTarget.value),zt=(a,e)=>e("connection.token",a.currentTarget.value),Ut=(a,e)=>e("display.canvas.name",a.currentTarget.checked),Xt=(a,e)=>e("display.canvas.team",a.currentTarget.checked),Ht=(a,e)=>e("display.canvas.role",a.currentTarget.checked),Kt=(a,e)=>e("display.bubble.name",a.currentTarget.checked),Wt=(a,e)=>e("display.bubble.team",a.currentTarget.checked),Vt=(a,e)=>e("display.bubble.role",a.currentTarget.checked),Yt=(a,e)=>e("display.text.name",a.currentTarget.checked),qt=(a,e)=>e("display.text.team",a.currentTarget.checked),Ft=(a,e)=>e("display.text.role",a.currentTarget.checked),Gt=(a,e)=>e("display.largeScale",a.currentTarget.checked),Qt=L('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">表示設定</h3> <h4 class="text-base font-bold mt-4">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Zt(a,e){Ue(e,!0);let n=Te(void 0),x=Te(void 0);const f=Oe.subscribe(I=>{he(n,Ee(I))}),G=Re.subscribe(I=>{he(x,Ee(I.status))});We(()=>{f(),G()});function v(I,q){Oe.update(ue=>{const oe=I.split("."),we=oe.pop();let ae=ue;for(const be of oe)be&&(ae=ae[be]);return ae[we]=q,{...ue}})}let k;var R=Qt(),H=l(o(R),2),Y=o(H),ne=o(Y);{var y=I=>{var q=Nt();Ae(2),w(I,q)},T=I=>{var q=Ie(),ue=pe(q);{var oe=ae=>{var be=Pt();Ae(2),w(ae,be)},we=ae=>{var be=Mt();w(ae,be)};F(ue,ae=>{t(x)==="connecting"?ae(oe):ae(we,!1)},!0)}w(I,q)};F(ne,I=>{t(x)==="connected"?I(y):I(T,!1)})}s(Y),s(H);var E=l(H,2),B=o(E);Z(B,"class","h-[1em] opacity-50"),Z(B,"inline",!0),Z(B,"icon","mdi:link");var D=l(B,2);ie(D),D.__input=[Bt,v],s(E);var Q=l(E,2),le=o(Q);Z(le,"class","h-[1em] opacity-50"),Z(le,"inline",!0),Z(le,"icon","mdi:key");var fe=l(le,2);ie(fe),fe.__input=[zt,v],Ae(2),s(Q);var ce=l(Q,2);ce.__click=[Jt];var re=l(ce,2);re.__click=[Lt];var ve=l(re,2);ve.__click=()=>k.showModal();var $=l(ve,2),ye=o($),_e=o(ye),u=l(o(_e),4),c=o(u),C=l(o(c),2);ie(C),C.__change=[Ut,v],s(c);var S=l(c,2),d=l(o(S),2);ie(d),d.__change=[Xt,v],s(S);var r=l(S,2),b=l(o(r),2);ie(b),b.__change=[Ht,v],s(r),s(u);var i=l(u,4),h=o(i),O=l(o(h),2);ie(O),O.__change=[Kt,v],s(h);var z=l(h,2),ee=l(o(z),2);ie(ee),ee.__change=[Wt,v],s(z);var te=l(z,2),N=l(o(te),2);ie(N),N.__change=[Vt,v],s(te),s(i);var g=l(i,4),A=o(g),_=l(o(A),2);ie(_),_.__change=[Yt,v],s(A);var m=l(A,2),J=l(o(m),2);ie(J),J.__change=[qt,v],s(m);var U=l(m,2),P=l(o(U),2);ie(P),P.__change=[Ft,v],s(U),s(g);var j=l(g,4),p=l(o(j),2);ie(p),p.__change=[Gt,v],s(j),s(_e),s(ye),Ae(2),s($),Se($,I=>k=I,()=>k);var K=l($,2),X=o(K);Z(X,"inline",!0),Z(X,"icon","mdi:white-balance-sunny");var se=l(X,4);Z(se,"inline",!0),Z(se,"icon","mdi:moon-and-stars"),s(K),s(R),M(()=>{var I,q,ue,oe,we,ae,be,Ve,Ye,qe,Fe,Ge;Ze(D,(I=t(n))==null?void 0:I.connection.url),Ze(fe,(q=t(n))==null?void 0:q.connection.token),ce.disabled=t(x)!=="disconnected",re.disabled=t(x)==="disconnected",de(C,(ue=t(n))==null?void 0:ue.display.canvas.name),de(d,(oe=t(n))==null?void 0:oe.display.canvas.team),de(b,(we=t(n))==null?void 0:we.display.canvas.role),de(O,(ae=t(n))==null?void 0:ae.display.bubble.name),de(ee,(be=t(n))==null?void 0:be.display.bubble.team),de(N,(Ve=t(n))==null?void 0:Ve.display.bubble.role),de(_,(Ye=t(n))==null?void 0:Ye.display.text.name),de(J,(qe=t(n))==null?void 0:qe.display.text.team),de(P,(Fe=t(n))==null?void 0:Fe.display.text.role),de(p,(Ge=t(n))==null?void 0:Ge.display.largeScale)}),w(a,R),Xe()}He(["input","click","change"]);var $t=L("<option> </option>"),ea=L('<div class="divider"> </div>'),ta=L('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),aa=L('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),na=L('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),ra=L('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),sa=L('<!> <button class="btn"><!></button>',1),oa=L('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="overflow-y-auto pl-2 h-full"><div class="flex flex-col p-2"><select class="w-full select"></select> <ul class="list overflow-y-auto flex-1 my-2 px-2"></ul></div></div></div></main>');function Sa(a,e){Ue(e,!0);const[n,x]=lt(),f=()=>Ce(T,"$status",n),G=()=>Ce(ne,"$currentPacket",n),v=()=>Ce(R,"$selectedId",n),k=()=>Ce(y,"$entries",n),R=xe(""),H=xe(0),Y={id:"",idx:-1,day:0,isDay:!0,agents:ht(5),event:"未接続",message:void 0,fromIdx:void 0,toIdx:void 0,bubbleIdx:void 0},ne=xe(Y),y=xe({}),T=xe("");let E=Te(void 0),B=Te(80),D=!1,Q=null;function le(d){if(!D||!Q)return;const r=Q.getBoundingClientRect(),b=d-r.left,i=r.width;he(B,Ee(Math.min(90,Math.max(10,b/i*100))))}function fe(){D=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const d=b=>{const i=b instanceof MouseEvent?b.clientX:b.touches[0].clientX;le(i)},r=()=>{D=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",d),window.removeEventListener("touchmove",d),window.removeEventListener("mouseup",r),window.removeEventListener("touchend",r)};window.addEventListener("mousemove",d),window.addEventListener("touchmove",d),window.addEventListener("mouseup",r),window.addEventListener("touchend",r)}at(()=>{const d=Re.entries.subscribe(i=>{y.set(i),R.update(h=>h||Object.keys(i)[0]||"")}),r=Re.subscribe(i=>{T.set(i.status)});R.subscribe(i=>{y.update(h=>{var O;return i&&((O=h[i])==null?void 0:O.length)>0&&H.set(h[i].length-1),h})});const b=Oe.subscribe(i=>{he(E,Ee(i))});ut([R,H,y],([i,h,O])=>O[i]&&h>=0&&h<O[i].length?O[i][h]:Y).subscribe(i=>{ne.set(i)}),We(()=>{d(),r(),b()}),window.addEventListener("beforeunload",i=>{f()==="connecting"&&i.preventDefault()})});var ce=oa();ot(d=>{st.title="aiwolf-nlp-viewer"});var re=o(ce);Zt(re,{});var ve=l(re,2),$=o(ve),ye=o($);Dt(ye,{get packet(){return G()}}),s($);var _e=l($,2);_e.__mousedown=fe,_e.__touchstart=fe;var u=l(_e,2),c=o(u),C=o(c);Pe(C,5,()=>Object.keys(k()),Me,(d,r)=>{var b=$t(),i={},h=o(b,!0);s(b),M(()=>{i!==(i=t(r))&&(b.value=(b.__value=t(r))==null?"":t(r)),V(h,t(r))}),w(d,b)}),s(C);var S=l(C,2);Pe(S,5,()=>k()[v()]||[],Me,(d,r,b)=>{var i=sa(),h=pe(i);{var O=g=>{var A=ea(),_=o(A);s(A),M(()=>V(_,`${t(r).day??""}日目 ${(t(r).isDay?"昼":"夜")??""}`)),w(g,A)};F(h,g=>{(b>0&&(t(r).day!==k()[v()][b-1].day||t(r).isDay!==k()[v()][b-1].isDay)||b===0)&&g(O)})}var z=l(h,2);z.__click=()=>H.set(b);var ee=o(z);{var te=g=>{var A=Ie(),_=pe(A);{var m=U=>{var P=ta(),j=pe(P),p=o(j,!0);s(j);var K=l(j,2);Z(K,"inline",!0),Z(K,"icon","mdi:skip-forward"),M(X=>V(p,X),[()=>{var X;return W((X=t(E))==null?void 0:X.display.text,t(r),t(r).bubbleIdx)}]),w(U,P)},J=U=>{var P=Ie(),j=pe(P);{var p=X=>{var se=aa(),I=pe(se),q=o(I,!0);s(I);var ue=l(I,2);Z(ue,"inline",!0),Z(ue,"icon","mdi:arrow-u-down-right-bold"),M(oe=>V(q,oe),[()=>{var oe;return W((oe=t(E))==null?void 0:oe.display.text,t(r),t(r).bubbleIdx)}]),w(X,se)},K=X=>{var se=na(),I=o(se,!0);s(se),M(q=>V(I,q),[()=>{var q;return W((q=t(E))==null?void 0:q.display.text,t(r),t(r).bubbleIdx)+"<"+t(r).message}]),w(X,se)};F(j,X=>{t(r).message==="Skip"?X(p):X(K,!1)},!0)}w(U,P)};F(_,U=>{t(r).message==="Over"?U(m):U(J,!1)})}w(g,A)},N=g=>{var A=ra(),_=o(A);{var m=P=>{var j=Qe();M(p=>V(j,p),[()=>{var p;return W((p=t(E))==null?void 0:p.display.text,t(r),t(r).fromIdx)}]),w(P,j)},J=P=>{var j=Ie(),p=pe(j);{var K=X=>{var se=Qe();M(I=>V(se,I),[()=>{var I;return W((I=t(E))==null?void 0:I.display.text,t(r),t(r).toIdx)}]),w(X,se)};F(p,X=>{(t(r).event==="追放"||t(r).event==="襲撃")&&X(K)},!0)}w(P,j)};F(_,P=>{t(r).event==="投票"||t(r).event==="占い"?P(m):P(J,!1)})}var U=l(_);s(A),M(()=>V(U,` ${t(r).event??""}`)),w(g,A)};F(ee,g=>{t(r).event==="トーク"||t(r).event==="囁き"?g(te):g(N,!1)})}s(z),w(d,i)}),s(S),s(c),s(u),s(ve),Se(ve,d=>Q=d,()=>Q),s(ce),M(()=>{ke($,"style",`width: ${t(B)??""}%`),ke(u,"style",`width: ${100-t(B)-.5}%;`)}),it(C,v,d=>ct(R,d)),w(a,ce),Xe(),x()}He(["mousedown","touchstart","click"]);export{Sa as component};
