import{t as N,a as g,c as Ie,d as Ze}from"../chunks/HViqgMOa.js";import{p as Ve,s as je,l as at,i as X,a as Ke,aG as Oe,c as r,h as l,g as t,f as s,aI as Je,x as st,aw as fe,$ as rt}from"../chunks/DVw0lqtx.js";import{d as Ye,s as $}from"../chunks/D2z9SdKz.js";import{i as ee}from"../chunks/Iz7RvOh6.js";import{e as ze,i as Ue}from"../chunks/UHQ7A5qY.js";import{h as ot}from"../chunks/CmhqFjS7.js";import{s as Te,a as le,r as ie,c as $e,d as de}from"../chunks/EUBOkeHQ.js";import{I as qe,s as Xe,c as et,d as lt,t as Be}from"../chunks/CBeeWJwe.js";import{p as Ae}from"../chunks/CS0_dE9u.js";import{b as it}from"../chunks/CiU6qsmI.js";import{b as we}from"../chunks/xYCJa3Tf.js";import{a as De,s as ct,b as ut}from"../chunks/BKjCbnh7.js";import{w as ke,d as dt}from"../chunks/vxh45KTb.js";import{a as Fe,o as nt}from"../chunks/CBQtZvgM.js";/* empty css                */import{b as ft}from"../chunks/CbXI2TiS.js";function vt(n,e,a,m){var c=n.__styles??(n.__styles={});c[e]!==a&&(c[e]=a,a==null?n.style.removeProperty(e):n.style.setProperty(e,a,""))}class He{static fromJson(e){return pt(JSON.parse(e),Se("RealtimeSettings"))}static toJson(e){return JSON.stringify(_t(e,Se("RealtimeSettings")),null,2)}}function pe(n,e,a,m=""){const c=We(n),H=m?` on ${m}`:"",b=a?` for key "${a}"`:"";throw Error(`Invalid value${b}${H}. Expected ${c} but got ${JSON.stringify(e)}`)}function We(n){return Array.isArray(n)?n.length===2&&n[0]===void 0?`an optional ${We(n[1])}`:`one of [${n.map(e=>We(e)).join(", ")}]`:typeof n=="object"&&n.literal!==void 0?n.literal:typeof n}function bt(n){if(n.jsonToJS===void 0){const e={};n.props.forEach(a=>e[a.json]={key:a.js,typ:a.typ}),n.jsonToJS=e}return n.jsonToJS}function mt(n){if(n.jsToJSON===void 0){const e={};n.props.forEach(a=>e[a.js]={key:a.json,typ:a.typ}),n.jsToJSON=e}return n.jsToJSON}function Ee(n,e,a,m="",c=""){function H(I,y){return typeof I==typeof y?y:pe(I,y,m,c)}function b(I,y){const C=I.length;for(let J=0;J<C;J++){const B=I[J];try{return Ee(y,B,a)}catch{}}return pe(I,y,m,c)}function E(I,y){return I.indexOf(y)!==-1?y:pe(I.map(C=>Le(C)),y,m,c)}function M(I,y){return Array.isArray(y)?y.map(C=>Ee(C,I,a)):pe(Le("array"),y,m,c)}function q(I){if(I===null)return null;const y=new Date(I);return isNaN(y.valueOf())?pe(Le("Date"),I,m,c):y}function W(I,y,C){if(C===null||typeof C!="object"||Array.isArray(C))return pe(Le(ne||"object"),C,m,c);const J={};return Object.getOwnPropertyNames(I).forEach(B=>{const ae=I[B],te=Object.prototype.hasOwnProperty.call(C,B)?C[B]:void 0;J[ae.key]=Ee(te,ae.typ,a,B,ne)}),Object.getOwnPropertyNames(C).forEach(B=>{Object.prototype.hasOwnProperty.call(I,B)||(J[B]=Ee(C[B],y,a,B,ne))}),J}if(e==="any")return n;if(e===null)return n===null?n:pe(e,n,m,c);if(e===!1)return pe(e,n,m,c);let ne;for(;typeof e=="object"&&e.ref!==void 0;)ne=e.ref,e=gt[e.ref];return Array.isArray(e)?E(e,n):typeof e=="object"?e.hasOwnProperty("unionMembers")?b(e.unionMembers,n):e.hasOwnProperty("arrayItems")?M(e.arrayItems,n):e.hasOwnProperty("props")?W(a(e),e.additional,n):pe(e,n,m,c):e===Date&&typeof n!="number"?q(n):H(e,n)}function pt(n,e){return Ee(n,e,bt)}function _t(n,e){return Ee(n,e,mt)}function Le(n){return{literal:n}}function Ne(n,e){return{props:n,additional:e}}function Se(n){return{ref:n}}const gt={RealtimeSettings:Ne([{json:"connection",js:"connection",typ:Se("Connection")},{json:"display",js:"display",typ:Se("Display")}],!1),Connection:Ne([{json:"url",js:"url",typ:""},{json:"token",js:"token",typ:""}],!1),Display:Ne([{json:"canvas",js:"canvas",typ:Se("Agent")},{json:"bubble",js:"bubble",typ:Se("Agent")},{json:"text",js:"text",typ:Se("Agent")},{json:"largeScale",js:"largeScale",typ:!0}],!1),Agent:Ne([{json:"name",js:"name",typ:!0},{json:"team",js:"team",typ:!0},{json:"role",js:"role",typ:!0}],!1)},tt={connection:{url:"ws://localhost:8080/realtime",token:""},display:{canvas:{name:!0,team:!0,role:!0},bubble:{name:!0,team:!1,role:!1},text:{name:!0,team:!1,role:!1},largeScale:!1}};function xt(){const n=localStorage.getItem("realtime-settings");if(n)try{return He.fromJson(n)}catch(e){console.error(e)}return localStorage.setItem("realtime-settings",He.toJson(tt)),tt}const Ce=ke(xt());Ce.subscribe(n=>{localStorage.setItem("realtime-settings",He.toJson(n))});function ht(n){return Array.from({length:n},(e,a)=>({idx:a+1,team:"Undefined",name:qe(a+1),role:"Undefined",isAlive:!0,targetIdxs:[],isBubble:!1}))}function Z(n,e,a){var c,H;if(a===void 0)return"該当なし";let m=[];return n!=null&&n.name&&m.push(qe(a)),n!=null&&n.team&&m.push((c=e.agents.find(b=>b.idx===a))==null?void 0:c.team),n!=null&&n.role&&m.push((H=e.agents.find(b=>b.idx===a))==null?void 0:H.role),m.join(" ")}function Me(n,e){return(n||e)&&!(n&&e)}function yt(){const{subscribe:n,update:e}=ke({status:"disconnected",entries:{}});let a=null,m=null;Ce.subscribe(b=>{m=b});function c(){if(!m)return;e(E=>({...E,status:"connecting"}));const b=new URL(m.connection.url);m.connection.token&&b.searchParams.set("token",m.connection.token),a=new WebSocket(b),a.onopen=()=>{e(E=>({...E,status:"connected"}))},a.onclose=()=>{e(E=>({...E,status:"disconnected"})),a=null},a.onerror=()=>{e(E=>({...E,status:"disconnected"})),a=null},a.onmessage=E=>{try{const M=JSON.parse(E.data);e(q=>{const W={...q.entries};return W[M.id]||(W[M.id]=[]),W[M.id].push(M),{...q,entries:W}})}catch(M){console.error("Failed to parse message:",M)}}}function H(){a&&(e(b=>({...b,status:"disconnected"})),a.close(),a=null)}return{subscribe:n,connect:c,disconnect:H,entries:{subscribe:b=>n(E=>b(E.entries))}}}const Pe=yt();var wt=N('<div role="alert" class="alert m-4"><span class="text-lg font-bold"> </span></div>'),kt=N('<span class="base-content w-2/5 text-9xl font-black opacity-50 absolute top-0 left-0 -mt-4 ml-8 select-none"> </span>'),St=(n,e,a)=>{t(e)===t(a).idx?je(e,void 0):je(e,Ae(t(a).idx))},It=N('<div class="absolute inset-0 flex items-center justify-center"><span class="text-9xl font-bold opacity-75 select-none"> </span></div>'),jt=N('<span class="base-content select-none"> </span>'),Tt=N('<span class="base-content text-2xl mt-2 select-none"> </span>'),Et=N('<span class="base-content select-none"> </span>'),Ot=N('<span class="base-content text-2xl mt-2 select-none"> </span>'),At=N('<span class="base-content select-none"> </span>'),Ct=N('<div class="absolute origin-center text-center flex flex-col items-center transform-angle rounded-xl p-2 svelte-1d36lc1"><div class="avatar rounded-full bg-base-300"><div><button class="cursor-pointer"><img class="w-full h-full"> <!></button></div></div> <!> <!> <!></div>'),Rt=N('<div class="h-full flex flex-col"><div class="bg-secondary"></div> <!> <div class="w-full flex-1 mt-8"><div class="h-full flex items-center justify-center relative rounded-1/2 box-border"><!> <canvas class="w-full h-full absolute top-0 left-0 pointer-events-none"></canvas> <canvas class="w-full h-full absolute top-0 left-0 z-10 pointer-events-none"></canvas> <div class="w-1/2 h-fit max-h-1/3 card bg-base-100 card-md shadow-md overflow-auto z-20"><div class="card-body"><p> </p></div></div> <!></div></div> <footer class="footer footer-center text-base-content p-2"><aside><p>イラスト : 石黒正数氏</p></aside></footer></div>');function Dt(n,e){Ve(e,!0);let a=Oe(void 0);const m=Ce.subscribe(d=>{je(a,Ae(d))});Fe(m);let c=Oe(void 0),H=st(()=>{var d,i,P,j,T,o,p,v,O,u,f,A,Q;switch(e.packet.event){case"未接続":return"未接続";case"トーク":case"囁き":return e.packet.message;case"襲撃投票":return Me(t(c)===void 0,e.packet.fromIdx===t(c))?`${Z((d=t(a))==null?void 0:d.display.bubble,e.packet,e.packet.fromIdx)} が ${Z((i=t(a))==null?void 0:i.display.bubble,e.packet,e.packet.toIdx)} に襲撃投票しました`:"襲撃投票しました";case"投票":return Me(t(c)===void 0,e.packet.fromIdx===t(c))?`${Z((P=t(a))==null?void 0:P.display.bubble,e.packet,e.packet.fromIdx)} が ${Z((j=t(a))==null?void 0:j.display.bubble,e.packet,e.packet.toIdx)} に投票しました`:`${Z((T=t(a))==null?void 0:T.display.bubble,e.packet,e.packet.fromIdx)} が投票しました`;case"追放":return e.packet.toIdx===void 0?"誰も追放されませんでした":`${Z((o=t(a))==null?void 0:o.display.bubble,e.packet,e.packet.toIdx)} を追放しました`;case"襲撃":return e.packet.toIdx===void 0?"誰も襲撃されませんでした":e.packet.fromIdx===-1?`${Z((p=t(a))==null?void 0:p.display.bubble,e.packet,e.packet.toIdx)} が襲撃されましたが、護衛されました`:`${Z((v=t(a))==null?void 0:v.display.bubble,e.packet,e.packet.toIdx)} が襲撃されました`;case"占い":return Me(t(c)===void 0,e.packet.fromIdx===t(c))?`${Z((O=t(a))==null?void 0:O.display.bubble,e.packet,e.packet.fromIdx)} が ${Z((u=t(a))==null?void 0:u.display.bubble,e.packet,e.packet.toIdx)} を占った結果、${lt((f=e.packet.agents.find(R=>R.idx===e.packet.toIdx))==null?void 0:f.role)} でした`:"占いました";case"護衛":return Me(t(c)===void 0,e.packet.fromIdx===t(c))?`${Z((A=t(a))==null?void 0:A.display.bubble,e.packet,e.packet.fromIdx)} が ${Z((Q=t(a))==null?void 0:Q.display.bubble,e.packet,e.packet.toIdx)} を護衛対象にしました`:"護衛しました";case"終了":return e.packet.message+" が勝利しました";default:return}}),b,E,M,q,W;nt(()=>(window.addEventListener("resize",ne),()=>{window.removeEventListener("resize",ne)})),at(()=>{ne()});function ne(){if(!E||!M||!b)return;const d=b.getBoundingClientRect();if([E,M].forEach(T=>{T.width=d.width,T.height=d.height;const o=T.getContext("2d");o&&(o.clearRect(0,0,T.width,T.height),o.globalAlpha=1,o.lineWidth=2)}),t(c)!==void 0&&(e.packet.event==="占い"&&e.packet.fromIdx!==t(c)||e.packet.event==="投票"&&e.packet.fromIdx!==t(c)||e.packet.event==="襲撃投票"&&e.packet.fromIdx!==t(c)))return;const i=E.getContext("2d"),P=M.getContext("2d");if(!i||!P)return;const j=M.getBoundingClientRect();if(e.packet.fromIdx!==void 0&&e.packet.toIdx!==void 0){const T=document.getElementById(`agent-${e.packet.fromIdx}`);if(!(T instanceof HTMLElement))return;const o=T.getBoundingClientRect(),p=o.left+o.width/2-j.left,v=o.top+o.height/2-j.top,O=document.getElementById(`agent-${e.packet.toIdx}`);if(!(O instanceof HTMLElement))return;const u=O.getBoundingClientRect();I(P,p,v,u.left+u.width/2-j.left,u.top+u.height/2-j.top,!1,getComputedStyle(W).getPropertyValue("background-color"))}if(e.packet.bubbleIdx!==void 0){const T=document.getElementById(`agent-${e.packet.bubbleIdx}`);if(!(T instanceof HTMLElement))return;const o=T.getBoundingClientRect(),p=o.left+o.width/2-j.left,v=o.top+o.height/2-j.top;I(i,j.width/2,j.height/2,p,v,!0,getComputedStyle(q).getPropertyValue("background-color"))}}function I(d,i,P,j,T,o,p){const v=o?[0,0,0,0,0,30]:[0,5,-20,5,-20,15];d.strokeStyle=d.fillStyle=p,d.beginPath();let O=j-i,u=T-P,f=Math.sqrt(O*O+u*u),A=u/f,Q=O/f,R=[];R.push(0,0);for(let S=0;S<v.length;S+=2){let F=v[S],x=v[S+1];R.push(F<0?f+F:F,x)}R.push(f,0);for(let S=v.length;S>0;S-=2){let F=v[S-2],x=v[S-1];R.push(F<0?f+F:F,-x)}R.push(0,0);for(let S=0;S<R.length;S+=2){let F=R[S]*Q-R[S+1]*A+i,x=R[S]*A+R[S+1]*Q+P;S===0?d.moveTo(F,x):d.lineTo(F,x)}d.fill()}var y=Rt(),C=r(y);we(C,d=>W=d,()=>W);var J=l(C,2);{var B=d=>{var i=wt(),P=r(i),j=r(P);s(P),s(i),X(()=>$(j,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}
        ${e.packet.event??""}フェーズ`)),g(d,i)};ee(J,d=>{var i;(i=t(a))!=null&&i.display.largeScale||d(B)})}var ae=l(J,2),te=r(ae),_e=r(te);{var ge=d=>{var i=kt(),P=r(i);s(i),X(()=>$(P,`${e.packet.day??""}日目 ${(e.packet.isDay?"昼":"夜")??""}`)),g(d,i)};ee(_e,d=>{var i;(i=t(a))!=null&&i.display.largeScale&&d(ge)})}var ce=l(_e,2);we(ce,d=>E=d,()=>E);var xe=l(ce,2);we(xe,d=>M=d,()=>M);var se=l(xe,2),ue=r(se),he=r(ue),ve=r(he,!0);s(he),s(ue),s(se),we(se,d=>q=d,()=>q);var be=l(se,2);ze(be,17,()=>e.packet.agents,Ue,(d,i,P)=>{var j=Ct(),T=r(j),o=r(T),p=r(o);p.__click=[St,c,i];var v=r(p),O=l(v,2);{var u=x=>{var _=It(),w=r(_),z=r(w,!0);s(w),s(_),X(()=>$(z,t(i).idx)),g(x,_)};ee(O,x=>{var _,w;(_=t(a))!=null&&_.display.largeScale&&((w=t(a))!=null&&w.display.canvas.name)&&x(u)})}s(p),s(o),s(T);var f=l(T,2);{var A=x=>{var _=jt(),w=r(_,!0);s(_),X(z=>$(w,z),[()=>qe(t(i).idx)]),g(x,_)};ee(f,x=>{var _,w;!((_=t(a))!=null&&_.display.largeScale)&&((w=t(a))!=null&&w.display.canvas.name)&&x(A)})}var Q=l(f,2);{var R=x=>{var _=Ie(),w=fe(_);{var z=V=>{var k=Tt(),Y=r(k,!0);s(k),X(()=>$(Y,t(i).team)),g(V,k)},re=V=>{var k=Et(),Y=r(k,!0);s(k),X(()=>$(Y,t(i).team)),g(V,k)};ee(w,V=>{var k;(k=t(a))!=null&&k.display.largeScale?V(z):V(re,!1)})}g(x,_)};ee(Q,x=>{var _;(_=t(a))!=null&&_.display.canvas.team&&x(R)})}var S=l(Q,2);{var F=x=>{var _=Ie(),w=fe(_);{var z=V=>{var k=Ot(),Y=r(k,!0);s(k),X(()=>$(Y,t(i).role)),g(V,k)},re=V=>{var k=At(),Y=r(k,!0);s(k),X(()=>$(Y,t(i).role)),g(V,k)};ee(w,V=>{var k;(k=t(a))!=null&&k.display.largeScale?V(z):V(re,!1)})}g(x,_)};ee(S,x=>{var _;(_=t(a))!=null&&_.display.canvas.role&&(t(i).idx===t(c)||t(c)===void 0)&&x(F)})}s(j),X(x=>{var _;Te(j,"style",`--angle: ${P*(360/e.packet.agents.length)}`),Te(j,"id",`agent-${t(i).idx??""}`),Be(j,"bg-focus",t(i).idx===t(c)),Xe(o,et((_=t(a))!=null&&_.display.largeScale?"relative w-48 rounded-full ring-offset-base-100 ring ring-offset-2":"relative w-24 rounded-full ring-offset-base-100 ring ring-offset-2"),"svelte-1d36lc1"),Be(o,"ring-success",t(i).isAlive),Be(o,"ring-error",!t(i).isAlive),vt(o,"opacity",t(i).isAlive?1:.25),Te(v,"src",`${ft??""}/images/male/${x??""}.png`),Te(v,"alt",t(i).name)},[()=>t(i).idx.toString().padStart(2,"0")]),g(d,j)}),s(te),we(te,d=>b=d,()=>b),s(ae),Je(2),s(y),X(()=>{var d;se.hidden=!t(H),Xe(he,et((d=t(a))!=null&&d.display.largeScale?"base-content text-3xl font-bold text-pretty break-all text-center":"base-content text-lg text-pretty break-all text-center"),"svelte-1d36lc1"),$(ve,t(H))}),g(n,y),Ke()}Ye(["click"]);function Jt(){Pe.connect()}function Pt(){Pe.disconnect()}var Lt=N('<div class="status status-success animate-ping"></div> <div class="status status-success"></div>',1),Nt=N('<div class="status status-warning animate-ping"></div> <div class="status status-warning"></div>',1),Mt=N('<div class="status status-error"></div>'),Bt=(n,e)=>e("connection.url",n.currentTarget.value),zt=(n,e)=>e("connection.token",n.currentTarget.value),Ut=(n,e)=>e("display.canvas.name",n.currentTarget.checked),Xt=(n,e)=>e("display.canvas.team",n.currentTarget.checked),Ht=(n,e)=>e("display.canvas.role",n.currentTarget.checked),Wt=(n,e)=>e("display.bubble.name",n.currentTarget.checked),Vt=(n,e)=>e("display.bubble.team",n.currentTarget.checked),Kt=(n,e)=>e("display.bubble.role",n.currentTarget.checked),Yt=(n,e)=>e("display.text.name",n.currentTarget.checked),qt=(n,e)=>e("display.text.team",n.currentTarget.checked),Ft=(n,e)=>e("display.text.role",n.currentTarget.checked),Gt=(n,e)=>e("display.largeScale",n.currentTarget.checked),Qt=N('<div class="navbar bg-base-100 flex justify-start gap-4 overflow-x-auto"><h1 class="text-3xl font-bold text-nowrap ml-2">aiwolf-nlp-viewer</h1> <div class="ml-auto"><div class="inline-grid *:[grid-area:1/1]"><!></div></div> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="WebSocket URL"></label> <label class="input min-w-3xs w-3xs"><iconify-icon></iconify-icon> <input type="text" class="grow" placeholder="Authorization Key"> <span class="badge badge-neutral badge-xs">Optional</span></label> <button class="btn btn-info">接続</button> <button class="btn btn-error">切断</button> <button class="btn">設定</button> <dialog class="modal"><div class="modal-box"><div class="form-control"><h3 class="text-lg font-bold mt-2">表示設定</h3> <h4 class="text-base font-bold mt-4">キャンバス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">メッセージボックス上のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">一覧のエージェント情報</h4> <div class="flex gap-4 my-2"><label class="label cursor-pointer"><span class="label-text">名前</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">チーム名</span> <input type="checkbox" class="checkbox"></label> <label class="label cursor-pointer"><span class="label-text">役職</span> <input type="checkbox" class="checkbox"></label></div> <h4 class="text-base font-bold mt-4">大画面向け</h4> <label class="label cursor-pointer my-2"><span class="label-text">有効</span> <input type="checkbox" class="checkbox"></label></div></div> <form method="dialog" class="modal-backdrop"><button>close</button></form></dialog> <label class="flex items-center cursor-pointer gap-2"><iconify-icon></iconify-icon> <input type="checkbox" value="dark" class="toggle theme-controller"> <iconify-icon></iconify-icon></label></div>',2);function Zt(n,e){Ve(e,!0);let a=Oe(void 0),m=Oe(void 0);const c=Ce.subscribe(h=>{je(a,Ae(h))}),H=Pe.subscribe(h=>{je(m,Ae(h.status))});Fe(()=>{c(),H()});function b(h,U){Ce.update(G=>{const oe=h.split("."),L=oe.pop();let D=G;for(const K of oe)K&&(D=D[K]);return D[L]=U,{...G}})}let E;var M=Qt(),q=l(r(M),2),W=r(q),ne=r(W);{var I=h=>{var U=Lt();Je(2),g(h,U)},y=h=>{var U=Ie(),G=fe(U);{var oe=D=>{var K=Nt();Je(2),g(D,K)},L=D=>{var K=Mt();g(D,K)};ee(G,D=>{t(m)==="connecting"?D(oe):D(L,!1)},!0)}g(h,U)};ee(ne,h=>{t(m)==="connected"?h(I):h(y,!1)})}s(W),s(q);var C=l(q,2),J=r(C);le(J,"class","h-[1em] opacity-50"),le(J,"inline",!0),le(J,"icon","mdi:link");var B=l(J,2);ie(B),B.__input=[Bt,b],s(C);var ae=l(C,2),te=r(ae);le(te,"class","h-[1em] opacity-50"),le(te,"inline",!0),le(te,"icon","mdi:key");var _e=l(te,2);ie(_e),_e.__input=[zt,b],Je(2),s(ae);var ge=l(ae,2);ge.__click=[Jt];var ce=l(ge,2);ce.__click=[Pt];var xe=l(ce,2);xe.__click=()=>E.showModal();var se=l(xe,2),ue=r(se),he=r(ue),ve=l(r(he),4),be=r(ve),d=l(r(be),2);ie(d),d.__change=[Ut,b],s(be);var i=l(be,2),P=l(r(i),2);ie(P),P.__change=[Xt,b],s(i);var j=l(i,2),T=l(r(j),2);ie(T),T.__change=[Ht,b],s(j),s(ve);var o=l(ve,4),p=r(o),v=l(r(p),2);ie(v),v.__change=[Wt,b],s(p);var O=l(p,2),u=l(r(O),2);ie(u),u.__change=[Vt,b],s(O);var f=l(O,2),A=l(r(f),2);ie(A),A.__change=[Kt,b],s(f),s(o);var Q=l(o,4),R=r(Q),S=l(r(R),2);ie(S),S.__change=[Yt,b],s(R);var F=l(R,2),x=l(r(F),2);ie(x),x.__change=[qt,b],s(F);var _=l(F,2),w=l(r(_),2);ie(w),w.__change=[Ft,b],s(_),s(Q);var z=l(Q,4),re=l(r(z),2);ie(re),re.__change=[Gt,b],s(z),s(he),s(ue),Je(2),s(se),we(se,h=>E=h,()=>E);var V=l(se,2),k=r(V);le(k,"inline",!0),le(k,"icon","mdi:white-balance-sunny");var Y=l(k,4);le(Y,"inline",!0),le(Y,"icon","mdi:moon-and-stars"),s(V),s(M),X(()=>{var h,U,G,oe,L,D,K,me,Re,ye,Ge,Qe;$e(B,(h=t(a))==null?void 0:h.connection.url),$e(_e,(U=t(a))==null?void 0:U.connection.token),ge.disabled=t(m)!=="disconnected",ce.disabled=t(m)==="disconnected",de(d,(G=t(a))==null?void 0:G.display.canvas.name),de(P,(oe=t(a))==null?void 0:oe.display.canvas.team),de(T,(L=t(a))==null?void 0:L.display.canvas.role),de(v,(D=t(a))==null?void 0:D.display.bubble.name),de(u,(K=t(a))==null?void 0:K.display.bubble.team),de(A,(me=t(a))==null?void 0:me.display.bubble.role),de(S,(Re=t(a))==null?void 0:Re.display.text.name),de(x,(ye=t(a))==null?void 0:ye.display.text.team),de(w,(Ge=t(a))==null?void 0:Ge.display.text.role),de(re,(Qe=t(a))==null?void 0:Qe.display.largeScale)}),g(n,M),Ke()}Ye(["input","click","change"]);var $t=N("<option> </option>"),en=N('<div class="divider"> </div>'),tn=N('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),nn=N('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p> <iconify-icon></iconify-icon>',3),an=N('<p class="overflow-hidden text-ellipsis whitespace-nowrap"> </p>'),sn=N('<p class="overflow-hidden text-ellipsis whitespace-nowrap"><!> </p>'),rn=N("<!> <button><!></button>",1),on=N('<main class="h-screen flex flex-col bg-base-300"><!> <div class="flex flex-1 overflow-hidden w-full flex-row h-full"><div class="overflow-y-auto pr-2 h-full"><!></div> <button class="cursor-ew-resize w-2 rounded bg-gray-300 hover:bg-gray-400 active:bg-gray-500 transition-colors border-0 my-2" aria-label="Resize"></button> <div class="overflow-y-auto pl-2 h-full"><div class="flex flex-col p-2"><select class="w-full select"></select> <ul class="list overflow-y-auto flex-1 my-2"><!></ul></div></div></div></main>');function Sn(n,e){Ve(e,!0);const[a,m]=ct(),c=()=>De(q,"$selectedId",a),H=()=>De(y,"$entries",a),b=()=>De(C,"$status",a),E=()=>De(I,"$currentPacket",a),M=()=>De(W,"$selectedIdx",a),q=ke(null),W=ke(null),ne={id:"",idx:-1,day:0,isDay:!0,agents:ht(5),event:"未接続",message:void 0,fromIdx:void 0,toIdx:void 0,bubbleIdx:void 0},I=ke(ne),y=ke({}),C=ke("");let J=Oe(void 0),B=Oe(80),ae=!1,te=null;function _e(o){if(!ae||!te)return;const p=te.getBoundingClientRect(),v=o-p.left,O=p.width;je(B,Ae(Math.min(90,Math.max(10,v/O*100))))}function ge(){ae=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none";const o=v=>{const O=v instanceof MouseEvent?v.clientX:v.touches[0].clientX;_e(O)},p=()=>{ae=!1,document.body.style.cursor="",document.body.style.userSelect="",window.removeEventListener("mousemove",o),window.removeEventListener("touchmove",o),window.removeEventListener("mouseup",p),window.removeEventListener("touchend",p)};window.addEventListener("mousemove",o),window.addEventListener("touchmove",o),window.addEventListener("mouseup",p),window.addEventListener("touchend",p)}nt(()=>{const o=Pe.entries.subscribe(f=>{y.set(f),q.update(A=>A||Object.keys(f)[0]),W.update(()=>c()?f[c()].length-1:null)}),p=Pe.subscribe(f=>{C.set(f.status)}),v=q.subscribe(f=>{var A;f&&((A=H()[f])==null?void 0:A.length)>0?W.set(H()[f].length-1):W.set(null)}),O=Ce.subscribe(f=>{je(J,Ae(f))}),u=dt([q,W,y],([f,A,Q])=>{if(!f||A===null)return ne;const R=Q[f];return!R||A<0||A>=R.length?ne:R[A]}).subscribe(f=>{I.set(f)});Fe(()=>{o(),p(),O(),v(),u()}),window.addEventListener("beforeunload",f=>{b()==="connecting"&&f.preventDefault()})});var ce=on();ot(o=>{rt.title="aiwolf-nlp-viewer"});var xe=r(ce);Zt(xe,{});var se=l(xe,2),ue=r(se),he=r(ue);Dt(he,{get packet(){return E()}}),s(ue);var ve=l(ue,2);ve.__mousedown=ge,ve.__touchstart=ge;var be=l(ve,2),d=r(be),i=r(d);ze(i,5,()=>Object.keys(H()),Ue,(o,p)=>{var v=$t(),O={},u=r(v,!0);s(v),X(()=>{O!==(O=t(p))&&(v.value=(v.__value=t(p))==null?"":t(p)),$(u,t(p))}),g(o,v)}),s(i);var P=l(i,2),j=r(P);{var T=o=>{var p=Ie(),v=fe(p);ze(v,1,()=>H()[c()]||[],Ue,(O,u,f)=>{var A=rn(),Q=fe(A);{var R=w=>{var z=en(),re=r(z);s(z),X(()=>$(re,`${t(u).day??""}日目 ${(t(u).isDay?"昼":"夜")??""}`)),g(w,z)};ee(Q,w=>{(f>0&&(t(u).day!==H()[c()][f-1].day||t(u).isDay!==H()[c()][f-1].isDay)||f===0)&&w(R)})}var S=l(Q,2);S.__click=()=>W.set(f);var F=r(S);{var x=w=>{var z=Ie(),re=fe(z);{var V=Y=>{var h=tn(),U=fe(h),G=r(U,!0);s(U);var oe=l(U,2);le(oe,"inline",!0),le(oe,"icon","mdi:skip-forward"),X(L=>$(G,L),[()=>{var L;return Z((L=t(J))==null?void 0:L.display.text,t(u),t(u).bubbleIdx)}]),g(Y,h)},k=Y=>{var h=Ie(),U=fe(h);{var G=L=>{var D=nn(),K=fe(D),me=r(K,!0);s(K);var Re=l(K,2);le(Re,"inline",!0),le(Re,"icon","mdi:arrow-u-down-right-bold"),X(ye=>$(me,ye),[()=>{var ye;return Z((ye=t(J))==null?void 0:ye.display.text,t(u),t(u).bubbleIdx)}]),g(L,D)},oe=L=>{var D=an(),K=r(D,!0);s(D),X(me=>$(K,me),[()=>{var me;return Z((me=t(J))==null?void 0:me.display.text,t(u),t(u).bubbleIdx)+"<"+t(u).message}]),g(L,D)};ee(U,L=>{t(u).message==="Skip"?L(G):L(oe,!1)},!0)}g(Y,h)};ee(re,Y=>{t(u).message==="Over"?Y(V):Y(k,!1)})}g(w,z)},_=w=>{var z=sn(),re=r(z);{var V=h=>{var U=Ze();X(G=>$(U,G),[()=>{var G;return Z((G=t(J))==null?void 0:G.display.text,t(u),t(u).fromIdx)}]),g(h,U)},k=h=>{var U=Ie(),G=fe(U);{var oe=L=>{var D=Ze();X(K=>$(D,K),[()=>{var K;return Z((K=t(J))==null?void 0:K.display.text,t(u),t(u).toIdx)}]),g(L,D)};ee(G,L=>{(t(u).event==="追放"||t(u).event==="襲撃")&&L(oe)},!0)}g(h,U)};ee(re,h=>{t(u).event==="投票"||t(u).event==="占い"?h(V):h(k,!1)})}var Y=l(re);s(z),X(()=>$(Y,` ${t(u).event??""}`)),g(w,z)};ee(F,w=>{t(u).event==="トーク"||t(u).event==="囁き"?w(x):w(_,!1)})}s(S),X(()=>Xe(S,`btn ${(f===M()?"btn-primary":"")??""}`)),g(O,A)}),g(o,p)};ee(j,o=>{c()&&o(T)})}s(P),s(d),s(be),s(se),we(se,o=>te=o,()=>te),s(ce),X(()=>{Te(ue,"style",`width: ${t(B)??""}%`),Te(be,"style",`width: ${100-t(B)-.5}%;`)}),it(i,c,o=>ut(q,o)),g(n,ce),Ke(),m()}Ye(["mousedown","touchstart","click"]);export{Sn as component};
